function StringWithFormat(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return e.replace(/{(\d+)}/g,function(e,n){return t[n-1]})}function NumberFormat(e,t){return(Array(t).join("0")+e).slice(-t)}function tweenTalentSkill(e){return egret.Tween.get(e).to({x:e.x+100,alpha:1},200,egret.Ease.sineIn).wait(1e3).to({x:e.x+200,alpha:.1},400,egret.Ease.sineOut).wait(100).call(Game.removeFromParent,e)}function tweenNpcSkill(e){return egret.Tween.get(e).to({x:e.x+100,alpha:1},200,egret.Ease.sineIn).wait(1e3).to({x:e.x+200,alpha:.1},400,egret.Ease.sineOut).wait(100).call(Game.removeFromParent,e)}function tweenBleedDamage(e){return e.anchorOffsetX=Math.floor(e.width/2),e.anchorOffsetY=Math.floor(e.height/2),e.scaleX=0,e.scaleY=0,e.alpha=1,egret.Tween.get(e).to({scaleX:1,scaleY:1},80).wait(140).to({x:e.x,y:e.y-120,scaleX:1,scaleY:1,alpha:1},900,egret.Ease.backOut).call(Game.removeFromParent,e)}function tweenSongjinKillStrike(e){return e.scaleX=0,e.scaleY=0,e.x=e.x,e.y=e.y+5,e.alpha=1,egret.Tween.get(e).to({scaleX:.5,scaleY:.5},50).to({scaleX:1,scaleY:1},50).to({scaleX:1.5,scaleY:1.5},50).wait(200).to({x:e.x,y:e.y-120,alpha:1},800,egret.Ease.backOut).call(Game.removeFromParent,e)}function tweenHurtStrikeSelf(e){return e.anchorOffsetX=Math.floor(e.width/2),e.anchorOffsetY=Math.floor(e.height/2),e.scaleX=0,e.scaleY=0,e.alpha=1,egret.Tween.get(e).to({scaleX:.3,scaleY:.3},50).to({x:e.x,y:e.y-50,scaleX:.8,scaleY:.8,alpha:1},160,egret.Ease.backOut).wait(430).to({x:e.x,y:e.y+60,scaleX:.8,scaleY:.8,alpha:0},360,egret.Ease.backOut).call(Game.removeFromParent,e)}function tweenHurtStrike(e){return e.anchorOffsetX=Math.floor(e.width/2),e.anchorOffsetY=Math.floor(e.height/2),e.scaleX=0,e.scaleY=0,e.alpha=.2,egret.Tween.get(e).to({scaleX:1.5,scaleY:1.5,alpha:1},100).to({scaleX:1,scaleY:1},100).wait(240).to({x:e.x,y:e.y-80,alpha:0},240,egret.Ease.backOut).call(Game.removeFromParent,e)}function tweenHurtSelf(e){return e.anchorOffsetX=Math.floor(e.width/2),e.anchorOffsetY=Math.floor(e.height/2),e.scaleX=.5,e.scaleY=.5,e.alpha=1,egret.Tween.get(e).to({scaleX:1,scaleY:1},50).to({x:e.x,y:e.y+30,scaleX:.8,scaleY:.8,alpha:1},200,egret.Ease.backOut).wait(430).to({x:e.x,y:e.y+60,scaleX:.8,scaleY:.8,alpha:0},360,egret.Ease.backOut).call(Game.removeFromParent,e)}function tweenHurt(e){return e.anchorOffsetX=Math.floor(e.width/2),e.anchorOffsetY=Math.floor(e.height/2),e.scaleX=.3,e.scaleY=.3,e.alpha=.2,egret.Tween.get(e).to({scaleX:1.5,scaleY:1.5,alpha:1},100).to({scaleX:1,scaleY:1},100).wait(240).to({x:e.x,y:e.y-80,alpha:0},240,egret.Ease.backOut).call(Game.removeFromParent,e)}function tweenAbsorbSelf(e){return e.anchorOffsetX=Math.floor(e.width/2),e.anchorOffsetY=Math.floor(e.height/2),e.scaleX=0,e.scaleY=0,e.alpha=0,egret.Tween.get(e).to({scaleX:.3,scaleY:.3},50).to({x:e.x,y:e.y+40,scaleX:1,scaleY:1,alpha:1},200,egret.Ease.backOut).wait(400).to({x:e.x,y:e.y+60,scaleX:1,scaleY:1,alpha:0},400,egret.Ease.backOut).call(Game.removeFromParent,e)}function tweenAbsorb(e){return e.anchorOffsetX=Math.floor(e.width/2),e.anchorOffsetY=Math.floor(e.height/2),e.scaleX=0,e.scaleY=0,e.alpha=1,egret.Tween.get(e).to({scaleX:1.5,scaleY:1.5},50).to({scaleX:1,scaleY:1},160).wait(430).to({x:e.x-60,y:e.y-60,scaleX:1,scaleY:1,alpha:0},400,egret.Ease.backOut).call(Game.removeFromParent,e)}function tweenDodgeSelf(e){return e.anchorOffsetX=Math.floor(e.width/2),e.anchorOffsetY=Math.floor(e.height/2),e.scaleX=0,e.scaleY=0,e.alpha=0,egret.Tween.get(e).to({scaleX:.3,scaleY:.3},50).to({x:e.x,y:e.y+50,scaleX:1,scaleY:1,alpha:1},160,egret.Ease.backOut).wait(430).to({x:e.x,y:e.y+60,scaleX:1,scaleY:1,alpha:0},360,egret.Ease.backOut).call(Game.removeFromParent,e)}function tweenDodge(e){return e.anchorOffsetX=Math.floor(e.width/2),e.anchorOffsetY=Math.floor(e.height/2),e.scaleX=0,e.scaleY=0,e.alpha=1,egret.Tween.get(e).to({scaleX:1.5,scaleY:1.5},50).to({scaleX:1,scaleY:1},160).wait(430).to({x:e.x-60,y:e.y-60,scaleX:1,scaleY:1,alpha:0},400,egret.Ease.backOut).call(Game.removeFromParent,e)}function tweenExp(e){return e.anchorOffsetX=Math.floor(e.width/2),e.anchorOffsetY=Math.floor(e.height/2),e.scaleX=0,e.scaleY=0,e.alpha=.5,egret.Tween.get(e).to({scaleX:1,scaleY:1},50).to({scaleX:1,scaleY:1,alpha:1},400).wait(200).to({x:e.x+100,y:e.y,scaleX:1,scaleY:1,alpha:0},530,egret.Ease.backOut).call(Game.removeFromParent,e)}function tweenBleedHurtSelf(e){return e.anchorOffsetX=Math.floor(e.width/2),e.anchorOffsetY=Math.floor(e.height/2),e.scaleX=0,e.scaleY=0,e.alpha=1,egret.Tween.get(e).to({scaleX:.3,scaleY:.3},50).to({x:e.x,y:e.y+30,scaleX:.8,scaleY:.8,alpha:1},160,egret.Ease.backOut).wait(430).to({x:e.x,y:e.y+60,scaleX:.8,scaleY:.8,alpha:0},360,egret.Ease.backOut).call(Game.removeFromParent,e)}function MakeDelayExecute(e,t,n){var i=function(){i.stop(),i.timer=egret.setTimeout(function(){e.call(t),i.timer=null},t,n)};return i.stop=function(){null!=i.timer&&(egret.clearTimeout(i.timer),i.timer=null)},i}function Clamp(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),t>e?t:e>n?n:e}function FormatYYYYMMDDHHMM(e,t){var n=new Date(1e3*e),i=n.getFullYear(),a=NumberFormat(n.getMonth()+1,2),r=NumberFormat(n.getDate(),2);return t?StringWithFormat(table.l10n["Ymd H:M"],i,a,r,NumberFormat(n.getHours(),2),NumberFormat(n.getMinutes(),2)):StringWithFormat(table.l10n.Ymd,i,a,r)}function FormatMMSS(e){var t=Math.floor(e%(60*Game.Minute)/Game.Minute),n=Math.floor(e/Game.Second)%60;return NumberFormat(t,2)+":"+NumberFormat(n,2)}function FormatDDHH(e){return e>86400?lang.StringWithFormat("{1}day{2}hours",Math.floor(e/86400),Math.floor(e%86400/3600)):e>3600?lang.StringWithFormat("{1}hours",Math.floor(e/3600))+lang.StringWithFormat("{1}minut",Math.floor(e%3600/60)):lang.StringWithFormat("{1}minut",Math.floor(e/60))}function FormatTimeByRelativeDate(e,t){var n=new Date,i=new Date(1e3*e),a=NumberFormat(i.getHours(),2),r=NumberFormat(i.getMinutes(),2),o=NumberFormat(i.getSeconds(),2);if(i.getDay()!=n.getDay()){var s=i.getFullYear(),l=NumberFormat(i.getMonth()+1,2),u=NumberFormat(i.getDate(),2);return t?StringWithFormat(table.l10n["Ymd H:M:S"],s,l,u,a,r,o):StringWithFormat(table.l10n["Ymd H:M"],s,l,u,a,r)}return t?StringWithFormat(table.l10n["H:M:S"],a,r,o):StringWithFormat(table.l10n["H:M"],a,r)}function FormatToday(){var e=Game.getServerDate();return Number(""+e.getFullYear()+NumberFormat(e.getMonth()+1,2)+NumberFormat(e.getDate(),2)+NumberFormat(e.getHours(),2)+NumberFormat(e.getMinutes(),2))}function FormatBigNumber(e){return e>=1e7?(e/1e6).toFixed(1)+"M":e>=1e5?(e/1e3).toFixed(1)+"K":e.toString()}function updateDisplayList(e,t){if(this.$target){var n=this.$target,i=this._paddingLeft,a=this._paddingRight,r=this._paddingTop,o=this._paddingBottom;if(this.indexInViewCalculated)this.indexInViewCalculated=!1;else{if(this.calculateRowAndColumn(e,t),0==this._rowCount||0==this._columnCount)return void n.setContentSize(i+a,r+o);this.adjustForJustify(e,t),this.getIndexInView()}if(this.$useVirtualLayout&&(this.calculateRowAndColumn(e,t),this.adjustForJustify(e,t)),-1==this.startIndex||-1==this.endIndex)return void n.setContentSize(0,0);var s=this.endIndex;n.setVirtualElementIndicesInView(this.startIndex,s);for(var l,u,c,h,d,p=this._orientation==eui.TileOrientation.COLUMNS,g=this.startIndex,m=isNaN(this._horizontalGap)?0:this._horizontalGap,f=isNaN(this._verticalGap)?0:this._verticalGap,v=this._rowCount,y=this._columnCount,b=this._columnWidth,S=this._rowHeight,E=this.startIndex;s>=E;E++)if(l=this.$useVirtualLayout?this.target.getVirtualElementAt(E):this.target.getElementAt(E),egret.is(l,"eui.UIComponent")&&l.$includeInLayout){switch(p?(h=Math.ceil((g+1)/v)-1,d=Math.ceil((g+1)%v)-1,-1==d&&(d=v-1)):(h=Math.ceil((g+1)%y)-1,-1==h&&(h=y-1),d=Math.ceil((g+1)/y)-1),this._horizontalAlign){case egret.HorizontalAlign.RIGHT:u=e-(h+1)*(b+m)+m-a;break;case egret.HorizontalAlign.CENTER:u=e/2-(y*b+(y-1)*m)/2+h*(b+m);break;case egret.HorizontalAlign.LEFT:u=h*(b+m)+i;break;default:u=h*(b+m)+i}switch(this._verticalAlign){case egret.VerticalAlign.TOP:c=d*(S+f)+r;break;case egret.VerticalAlign.BOTTOM:c=t-(d+1)*(S+f)+f-o;break;case egret.VerticalAlign.MIDDLE:c=t/2-(v*S+(v-1)*f)/2+d*(S+f);break;default:c=d*(S+f)+r}this.sizeAndPositionElement(l,u,c,b,S),g++}var C=i+a,T=r+o,I=(b+m)*y-m,G=(S+f)*v-f;n.setContentSize(I+C,G+T)}}function g_GetDirIndex(e,t){var n=t.subtract(e);(n.x%1!=0||n.y%1!=0)&&egret.error("g_GetDirIndex not int");var i=0,a=Math.sqrt(n.x*n.x+n.y*n.y);if(0==a)return egret.error("zero distance"),-1;for(var r=~~((n.y<<10)/a),o=0;HALF_DIR>o&&!(r>g_nSin[o]);o++)i=o;if(g_nSin[i]!=r){var s=g_nSin[i]-r,l=r-g_nSin[i+1];s>l&&i++}return n.x>=0&&i>0&&(i=MAX_DIR-i),i}function g_GetDirIndex2(e,t){var n=t.subtract(e);(n.x%1!=0||n.y%1!=0)&&egret.error("g_GetDirIndex not int");var i=0,a=Math.sqrt(n.x*n.x+n.y*n.y);if(0==a)return egret.error("zero distance"),{dir:-1,sin:0,cos:0};for(var r=~~((n.y<<10)/a),o=~~((n.x<<10)/a),s=0;HALF_DIR>s&&!(r>g_nSin[s]);s++)i=s;if(g_nSin[i]!=r){var l=g_nSin[i]-r,u=r-g_nSin[i+1];l>u&&i++}return n.x>=0&&i>0&&(i=MAX_DIR-i),{dir:i,sin:r,cos:o}}function g_InternalDirSinCos(e,t,n){if(0>t||t>=n)return-1;var i=(t<<6)/n;return e[i]}function g_DirCos(e,t){return g_InternalDirSinCos(g_nCos,e,t)}function g_DirSin(e,t){return g_InternalDirSinCos(g_nSin,e,t)}function g_Dir64To8(e){return e+4>>3&7}function g_WithInRange(e,t,n){var i=e.subtract(t);return i.x*i.x+i.y*i.y<=n*n}function g_Move(e,t){var n=~~(g_DirCos(e,MAX_DIR)*t),i=~~(g_DirSin(e,MAX_DIR)*t);return egret.Point.create(n>>10,i>>10)}function RotateClockwise(e,t){return(e+t)%64}function RotateCounterClockwise(e,t){return(e+64-t)%64}function uuid(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=[],i=16,a=t.length;for(e=0;i>e;e++)n[e]=t[0|Math.random()*a];return n.join("")}function int(e){return~~e}function randMaxAbs(e){return randRange(-e,e)}function randMax(e){return randRange(0,e)}function randRange(e,t){var n=t-e+1;if(n>0){var i=n*Math.random(),a=Math.floor(e+i);return a}return 0}var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);n.prototype=t.prototype,e.prototype=new n},__awaiter=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(a,r){function o(e){try{l(i.next(e))}catch(t){r(t)}}function s(e){try{l(i["throw"](e))}catch(t){r(t)}}function l(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(o,s)}l((i=i.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,r&&(o=r[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(r,n[1])).done)return o;switch(r=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,r=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){l.label=n[1];break}if(6===n[0]&&l.label<o[1]){l.label=o[1],o=n;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(n);break}o[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(i){n=[6,i],r=0}finally{a=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var a,r,o,s,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},RemainingTime=function(){function e(e){void 0===e&&(e=0),this.delta=e}return Object.defineProperty(e.prototype,"delta",{get:function(){return Math.floor((this.time-Date.now())/Game.Second)},set:function(e){this.time=e*Game.Second+Date.now()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"deltaMillisecond",{get:function(){return this.time-Date.now()},set:function(e){this.time=e+Date.now()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minute",{get:function(){var e=this.time-Date.now();return 0>e&&(e=0),Math.floor(e%(60*Game.Minute)/Game.Minute)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hour",{get:function(){var e=this.time-Date.now();return 0>e&&(e=0),Math.floor(e/Game.Minute/60)},enumerable:!0,configurable:!0}),e.prototype.getMinuteSecond=function(){return NumberFormat(this.minute,2)+":"+NumberFormat(this.second,2)},e.prototype.getHourMinuteSecond=function(){return NumberFormat(this.hour,2)+":"+NumberFormat(this.minute,2)+":"+NumberFormat(this.second,2)},Object.defineProperty(e.prototype,"second",{get:function(){var e=this.time-Date.now();return 0>e&&(e=0),Math.floor(e/Game.Second)%60},enumerable:!0,configurable:!0}),e}();__reflect(RemainingTime.prototype,"RemainingTime");var grayFlilter=new egret.ColorMatrixFilter([.3,.3,.3,0,0,.3,.3,.3,0,0,.3,.3,.3,0,0,0,0,0,1,0]),Recharge;!function(e){function t(){return Account.isApp?e.rechargeConfig[1]:e.rechargeConfig[0]}function n(){net.Register(242,i),net.Register(243,a),net.Register(244,r),net.Register(2050,l),net.Register(2053,h),net.Register(2052,d),net.Register(2061,C),e.rechargeConfig=RES.getRes("config/payment_award/recharge_ware.json");var t=RES.getRes("config/payment_award/openingGroupon.json");e.OpeningGrouponEndTime=t.dayCount,e.minRankAmount=t.minRankAmount,e.info_GrouponAwards=[];for(var n=t.awards,o=0;o<n.length;o++)e.info_GrouponAwards.push({awards:n[o].awards,count:n[o].goldCoin,status:0});e.info_GrouponRankAwards=t.rankAwards,e.dailyGiftConfig=RES.getRes("config/payment_award/dailyGift.json"),e.fundingAwardConfig=RES.getRes("config/payment_award/fundingAward.json"),e.timingCardsConfig=RES.getRes("config/payment_award/timingCard.json"),e.firstboxConfig=RES.getRes("config/payment_award/firstboxAward.json")}function i(t){e.rankList=[];for(var n=net.def.S2COpeningGrouponRankList.decode(t),i=0;i<n.list.length;i++)e.rankList.push({round:i+1,name:n.list[i].name,time:n.list[i].amount});Game.dispatcher.dispatchEventWith(Game.EVENT.OpeningGrouponRanklist)}function a(t){var n=net.def.S2COpeningGrouponAward.decode(t);n.award&&badge.onLight(badge.action.OpeningGrouponAward,!0),e.serverAmount!=n.amount&&(e.serverAmount=n.amount||0,Game.dispatcher.dispatchEventWith(Game.EVENT.OpeningGrouponAmount))}function r(t){var n=net.def.S2COpeningGrouponStatus.decode(t);e.charged=n.charged,e.serverAmount!=n.serverAmount&&(e.serverAmount=n.serverAmount||0,Game.dispatcher.dispatchEventWith(Game.EVENT.OpeningGrouponAmount)),e.personAmount!=n.personAmount&&(e.personAmount=n.personAmount||0,Game.dispatcher.dispatchEventWith(Game.EVENT.OpeningGrouponAmount));for(var i=!1,a=!1,r=0;r<n.status.length;r++)e.grouponStatus[r]!=n.status[r]&&(e.grouponStatus[r]=n.status[r],i=!0),1==e.grouponStatus[r]&&(a=!0);i&&Game.dispatcher.dispatchEventWith(Game.EVENT.OpeningGrouponStatus),badge.onLight(badge.action.OpeningGrouponAward,a)}function o(e,t){return e.status==t.status?e.idx-t.idx:1==e.status?-1:1==t.status?1:e.status-t.status}function s(){Game.isCrossServer()||UI.RechargeUI.open()}function l(t){var n=net.def.S2CDailyGift.decode(t);0==n.gifts.length&&(e.DailyGift={});for(var i=0;i<n.gifts.length;i++)e.DailyGift[n.gifts[i].getWardId()]=n.gifts[i].getUsed();e.IsBuySevenDaysGift=n.isBuySevenDaysGift,Game.dispatcher.dispatchEventWith(Game.EVENT.DailyGiftInfo)}function u(){var t=0;for(var n in e.DailyGift)e.DailyGift[n]&&t++;return 3!=t&&!e.IsBuySevenDaysGift}function c(){return Account.isApp?e.dailyGiftConfig[1]:e.dailyGiftConfig[0]}function h(e){var t=net.def.S2COpenFundingTalk.decode(e),n=new UI.PrologueDialogue;n.dialogue=Game.TextParser.parse(lang.Format("Đại hiệp đạt đến Lv{1}, có thể mua Quà <font color='#00B050'>Đầu Tư Lv({2})</font>, tiếu ngạo giang hồ",t.level,t.level)),n.answer=Game.TextParser.parse("Đi xem"),UIManager.push(n),n.setTimer(2e3),n.handle=function(){UIManager.pop(n),UI.RechargeActivityHall.open(),UI.RechargeActivityHall.instance.showFunding()}}function d(t){var n=net.def.S2CSyncFundingAward.decode(t);e.FundingAward=n,p(),Game.dispatcher.dispatchEventWith(Game.EVENT.FundingAward)}function p(){if(null==e.FundingAward)return!1;if(e.FundingAward.canBuy)return badge.onLight(badge.action.WelfareFunding,!1),!1;for(var t in e.FundingAward.levels){var n=e.FundingAward.levels[t],i=e.FundingAward.canAward[t];if(i&&PlayerAttribute.Level>=n)return badge.onLight(badge.action.WelfareFunding,!0),!0}return badge.onLight(badge.action.WelfareFunding,!1),!1}function g(t){return Account.isApp?e.fundingAwardConfig[1][t]:e.fundingAwardConfig[0][t]}function m(){if(e.FundingAward.canBuy)return!0;for(var t=0;t<e.FundingAward.canAward.length;t++)if(e.FundingAward.canAward[t])return!0;return!1}function f(t){return 2!=e.timingcards.length?!1:1==e.timingcards[t].status}function v(t){return 2!=e.timingcards.length?!1:0==e.timingcards[t].status||3==e.timingcards[t].status}function y(t){return 2!=e.timingcards.length?!1:0!=e.timingcards[t].status&&3!=e.timingcards[t].status}function b(){Payment.buy(E(e.WeeklyCard_Type).wareId)}function S(){Payment.buy(E(e.MonthlyCard_Type).wareId)}function E(t){return Account.isApp?e.timingCardsConfig[1][t]:e.timingCardsConfig[0][t]}function C(t){var n=net.def.S2CFirstBox.decode(t);e.FirstChargeGift=n.status,e.FirstBoxTodayDrawn=n.getTodaydrawn(),Game.dispatcher.dispatchEventWith(Game.EVENT.FirstChargeGift)}e.rechargeConfig=[],e.getRechargeWareIds=t,e.load=n,e.grouponStatus=[],e.grouponRanks=[],e.OpeningGrouponEndTime=30,e.serverAmount=0,e.personAmount=0,e.minRankAmount=0,e.charged=!1,e.sortStatus=o,e.openRechargeUI=s,e.DailyGift={},e.dailyGiftConfig=[],e.IsBuySevenDaysGift=!1,e.haveDailyGiftCanBuy=u,e.getConfig=c,e.FundingAward=null,e.fundingAwardConfig=[],e.badgeFunding=p,e.getFundingAwardWareId=g,e.isFunding=m,e.WeeklyCard_Type=0,e.MonthlyCard_Type=1,e.timingcards=[],e.timingCardsConfig=[],e.haveTimingCardDailyAward=f,e.CanBuyTimingCard=v,e.isTimingCard=y,e.buyWeeklyCard=b,e.buyMonthlyCard=S,e.getTimingCardCfg=E,e.FirstChargeGift=0,e.FirstBoxNone=0,e.FirstBoxUndrawn=1,e.FirstBoxdrawn=2,e.FirstBoxForbidDrawn=3,e.FirstBoxTodayDrawn=0,e.procSyncFirstChargeGift=C}(Recharge||(Recharge={}));var UI;!function(e){e.QualityParseImg={0:null,1:"ui/quality/q1.png",2:"ui/quality/q2.png",3:"ui/quality/q3.png",4:"ui/quality/q4.png",5:"ui/quality/q5.png"};var t=function(t){function n(){var n=t.call(this)||this;return n.icon="",n.ltCorner="",n.lbcorner="",n.rbcorner="",n.plugin="",n.timelimit="",n.consignIcon="",n.smallIcon="",n.jxFontNote="",n.addImg="",n.qualityMovieEnabled=!0,n.rbcolor=16777215,n.light="",n.qualityMovie=new e.MovieClipComponent,n.qualityMovie.touchEnabled=!1,n.qualityMovie.auto=!0,n.qualityMovie.verticalCenter=0,n.qualityMovie.horizontalCenter=0,n}return __extends(n,t),n.prototype.UpdatePiecesIcon=function(e){switch(e){case 7:case 8:case 18:this.plugin="ui/public/pieces_icon.png";break;default:this.plugin=null}},n.prototype.$hitTest=function(e,t){if(!this.$visible)return null;var n=this.$getInvertedConcatenatedMatrix(),i=n.a*e+n.c*t+n.tx,a=n.b*e+n.d*t+n.ty,r=this.$scrollRect?this.$scrollRect:this.$maskRect;if(r&&!r.contains(i,a))return null;if(this.$mask&&!this.$mask.$hitTest(e,t))return null;for(var o=this.$children,s=!1,l=null,u=o.length-1;u>=0;u--){var c=o[u];if(!c.$maskedObject&&c!=this.qualityMovie&&(l=c.$hitTest(e,t))){s=!0,l.$touchEnabled||(l=null);break}}return l?this.$touchChildren?l:this:s?this:null},n.prototype.makeQualityMovie=function(e){if(this.qualityMovieEnabled)switch(e){case 5:this.addChildAt(this.qualityMovie,3),this.qualityMovie.Load("mc/Ui_q5/Ui_q5.json","Ui_q5")}},n.prototype.makeQualityImage=function(t){this.qualityImg=e.QualityParseImg[t],5==t?this.makeQualityMovie(t):Game.removeFromParent.apply(this.qualityMovie)},n.prototype.qualityChanged=function(e){this.makeQualityImage(e)},Object.defineProperty(n.prototype,"quality",{get:function(){return this._quality},set:function(e){return null==e||e>6?(Game.removeFromParent.apply(this.qualityMovie),void(this.qualityImg="")):(this._quality=e,void this.qualityChanged(e))},enumerable:!0,configurable:!0}),n.prototype.dataChanged=function(){null!=this.data&&(this.quality=this.data.quality,this.icon=this.data.icon,this.rbcorner=null!=this.data.rbcorner?this.data.rbcorner:"",this.plugin=null!=this.data.plugin?this.data.plugin:"",this.lbcorner=null!=this.data.lbcorner?this.data.lbcorner:"",this.jxFontNote=null!=this.data.jxFontNote?this.data.jxFontNote:"",this.addImg=null!=this.data.addImg?this.data.addImg:"",this.action=null!=this.data.action?this.data.action:"",this.light=null!=this.data.light?this.data.light:"")},n}(eui.ItemRenderer);e.Cell=t,__reflect(t.prototype,"UI.Cell");var n=function(e){function t(){var t=e.call(this)||this;return t.skinName="CellSkin",t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.prototype.onRemoveFromStage=function(){this.clearBagcell()},t.prototype.dataChanged=function(){if(null==this.data)return void this.clearBagcell();var e=this.data.Item;if(this.BagId=this.data.Id,0==e.Type){var t=e;this.rbcorner="Lv"+t.Level}else if(16==e.Type){var n=e,i=PartnerEquipManager.GetPartnerEquipInfo(n.id);this.rbcorner="Cấp "+i.level,this.ltCorner=""+n.star+lang.String("partnerequip star")}else if(21==e.Type){var a=e;this.rbcorner="Lv"+a.requireLevel}else e.Count<=1?this.rbcorner=null:this.rbcorner=e.Count.toString();if(this.UpdatePiecesIcon(e.Type),this.icon=e.Icon,this.quality=e.Quality,0==e.Type||6==e.Type||16==e.Type||11==e.Type||21==e.Type)this.timelimit=null,this.consignIcon="";else{this.timelimit=e.GetExpiredIcon();var r=e,o=r.Type,s=r.DetailType;Consignment.IsConsignmentWare(o,s)?this.consignIcon=Consignment.CONSIGNMENT_CELL_ICON:this.consignIcon=""}switch(e.Type){case 20:this.smallIcon=Wuxingyinmanager.GetWuxingshiSmallIcon(e.DetailType);break;case 11:var l=e;this.jxFontNote=l.FontNoteIcon,this.lbcorner=l.Level>0?"+"+l.Level:"";break;default:this.lbcorner="",this.smallIcon="",this.jxFontNote="",this.ltCorner=""}},t.prototype.setBagItem=function(e){this.data=e},t.prototype.setItem=function(e,t,n,i){this.quality=i,this.icon=t,1>=n?this.rbcorner=null:this.rbcorner=n.toString(),this.genre=e,this.BagId=null,this.UpdatePiecesIcon(e)},t.prototype.clearBagcell=function(){this.genre=null,this.rbcorner=null,this.BagId=null,this.icon=null,this.plugin=null,this.quality=null,this.smallIcon=null,this.consignIcon=null,this.jxFontNote=null,this.addImg=null,this.light=null},t}(t);e.BagCell=n,__reflect(n.prototype,"UI.BagCell")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;t.left=0,t.right=0,t.top=0,t.bottom=0;var n=egret.MainContext.instance.stage;return t.x=n.$stageWidth/2,t.y=n.$stageHeight/2,t.anchorOffsetX=n.$stageWidth/2,t.anchorOffsetY=n.$stageHeight/2,t}return __extends(t,e),t.prototype._onAddToStage=function(e){this.$stage.addEventListener(egret.Event.RESIZE,this.onResize,this),this.onResize()},t.prototype._onRemoveFromStage=function(e){this.$stage.removeEventListener(egret.Event.RESIZE,this.onResize,this)},t.prototype.onResize=function(e){var t=this.$stage;this.x=t.$stageWidth/2,this.y=t.$stageHeight/2,this.anchorOffsetX=t.$stageWidth/2,this.anchorOffsetY=t.$stageHeight/2},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.addEventListener(eui.UIEvent.CLOSING,this.onClosing,this)},t.prototype.close=function(){var e=this.parent;e&&e.removeChild(this)},t.prototype.onClosing=function(e){e.preventDefault(),this.close()},t}(eui.Component);e.FitComponent=t,__reflect(t.prototype,"UI.FitComponent")}(UI||(UI={}));var mapLayer,mapMessageLayer,uiLayer,messageLayer,loadingLayer,announceLayer,visibleRegion,Setting;!function(e){function t(){e.auto="false"!=egret.localStorage.getItem("auto"),e.litemode="on"==egret.localStorage.getItem("litemode")}function n(){return e._AutoSellEquip}function i(t){return e._Smelt[t]}function a(t){var n=e._autoskill[t];return null==n?!0:n}function r(){return e._targetPriority}function o(t){e._targetPriority=t,v()}function s(){return e._sound}function l(t){e._sound=t,v()}function u(t){e.litemode=t,egret.localStorage.setItem("litemode",t?"on":"off"),v()}function c(t,n){e._autoskill[t]=n,v()}function h(t,n){e._Smelt[t]=n,v()}function d(t){e._AutoSellEquip=t,v()}function p(t){e.auto=t,egret.localStorage.setItem("auto",""+e.auto),Game.dispatcher.dispatchEventWith(Game.EVENT.AutoPlayChange)}function g(){var e=new net.def.RoleSetting;e.setting=m(),net.socket.write(59,e.toArrayBuffer())}function m(){var t=0;return e._autoskill[1]&&(t|=1),e._autoskill[2]&&(t|=2),e._autoskill[3]&&(t|=4),e._autoskill[4]&&(t|=8),e._autoskill[5]&&(t|=16),e._AutoSellEquip&&(t|=32),e._Smelt[2]&&(t|=64),e._Smelt[3]&&(t|=128),e._Smelt[4]&&(t|=256),e._sound&&(t|=512),e.litemode&&(t|=4096),t|=e._targetPriority<<10}function f(t){e._autoskill[1]=0!=(1&t),e._autoskill[2]=0!=(2&t),e._autoskill[3]=0!=(4&t),e._autoskill[4]=0!=(8&t),e._autoskill[5]=0!=(16&t),e._AutoSellEquip=0!=(32&t),e._Smelt[2]=0!=(64&t),e._Smelt[3]=0!=(128&t),e._Smelt[4]=0!=(256&t);var n=e.litemode;e.litemode=0!=(4096&t),e.litemode||n?(LiteMode.on(),PartnerNpcManager.clear()):(LiteMode.off(),PartnerNpcManager.delayFighting());var i=e._sound;e._sound=0!=(512&t),!i&&e._sound&&SoundUtil.resumeBGM(),0!=(2048&t)?e._targetPriority=AI.TargetProiority.player:0!=(1024&t)?e._targetPriority=AI.TargetProiority.monster:e._targetPriority=AI.TargetProiority.none,Game.dispatcher.dispatchEventWith(Game.EVENT.SettingChange)}e._autoskill={},e._AutoSellEquip=!1,e.autoRageSkill=!1,e._Smelt=[!0,!0,!1,!1,!1],e._sound=!1,e.litemode=!1,e.auto=!0,e.landscapeMode=!1,e.load=t,e.AutoSellEquip=n,e.Smelt=i,e.AutoSkill=a,e.TargetPriority=r,e.ChangeTargetPriority=o,e.Sound=s,e.ChangeSound=l,e.ChangeLiteMode=u,e.ChangeAutoSkill=c,e.ChangeSmelt=h,e.ChangeAutoSellEquip=d,e.ChangeAutoPlay=p;var v=MakeDelayExecute(g,null,100);e.Marshal=m,e.Unmarshal=f}(Setting||(Setting={}));var ImmigrateServer;!function(e){e.running=!1}(ImmigrateServer||(ImmigrateServer={}));var ServerSession;!function(e){function t(){return ImmigrateServer.running?e.destToken:e.sourceToken}function n(t){ImmigrateServer.running?(e.destToken=t,e.sourceToken=null):(e.sourceToken=t,e.destToken=null)}e.getToken=t,e.setToken=n}(ServerSession||(ServerSession={}));var Account;!function(e){function t(){e.ksServerList=decodeURIComponent(egret.getOption("ksServerList")),e.channel=egret.getOption("ksChannel"),e.uid=egret.getOption("ksUid"),e.timestamp=egret.getOption("ksTimestamp"),e.sign=egret.getOption("ksSign"),e.isApp="app"==egret.getOption("ksClient")}e.guid=null,e.ksServerList=null,e.channel="",e.uid="",e.load=t}(Account||(Account={}));var Game;!function(e){function t(){return 1==e.serverMode}function n(){return 1==e.mergeServer}function i(t){e.FPS=t,e.MSPF=e.Second/e.FPS,PlayerAttribute.RagePerFrame=PlayerAttribute.RageRecoverySpeed/e.FPS}function a(){null!=this.parent&&this.parent.removeChild(this)}function r(t,n){for(;0>n;)n+=e.Series.SeriesCount;var i=(T[t]+n)%e.Series.SeriesCount;return I[i]}function o(){LoadManager.loaded.config.then(function(){G||l(),UIManager.start()})}function s(t){return e.loader.indexOf(t)>=0?void egret.error("duplicate loader",t):void e.loader.push(t)}function l(){G=!0;for(var t=0;t<e.Series.SeriesCount;t++){var n=I[t];T[n]=t}Setting.load(),WorldLine.Load(),KeyBoardSystem.init(),Skill.loadskills(),table.load(),GoldCoinShop.load(),Action.init(),MasterChallenge.init(),Buff.load(),badge.init(),SongJin.load(),HuashanPK.init(),ArenaChallenge.init(),AI.init(),Prologue.load(),SeaSunVillage.load(),TaohuaIsland.load(),FenglingBoat.load(),GuildWarTaskScene.load(),GuildWarMatchScene.load(),GuildWar2Scene.load(),GuildDungeon.load(),BravePalace.load(),Guild.load(),WildBoss.load(),GameTick.init(),LittleBoss.load(),Encounter.init(),CatchThief.load(),guide.init(),Operation.init(),DungeonHallMgr.init(),QinMausoleum.load(),PartnerNpcManager.load(),TitleManager.load(),Recharge.load(),CompositeGamesGroupon.load(),Auction.init(),EnhancementRequire.load(),RedPacket.load(),WulinLiansai.load(),PrizeWheel.load(),CrossServer.bossLoad(),GuildArmament.load(),YanEmperor.load(),HeroicCard.load(),egret.setTimeout(LiteMode.auto,null,3*e.MSPF),Activity.init(),bt.load(),Babel.Load(),collectCardManager.Load(),NienBoss.Load(),Refine.Load(),Rune.Load(),PersonalMatchScene.load(),CityHome.load(),Wuxingyinmanager.Load(),PartnerEquipEnhance.Load(),Consignment.Load(),PartnerQingyi.Load(),TriggerSkill.Load(),shareboss.load();for(var i=0,a=e.loader;i<a.length;i++){var r=a[i];r()}SecondTicker.addEventListener(Reminder.onActivityTime,null),Reminder.load(),RES.hasRes("config.zip")&&RES.destroyRes("config.zip")}function u(){return 1==table.maps[World.mapId].wild||"city"==table.maps[World.mapId].scene?!0:!1}function c(){return"city"==table.maps[World.mapId].scene}function h(e){UI.CommonNotifyPanel.instance.SetMsg(e),UI.CommonNotifyPanel.instance.Open()}function d(e){UI.CommonNotifyPanel.instance.SetErrorMsg(e),UI.CommonNotifyPanel.instance.Open()}function p(e,t,n){UI.CommonGetItemPanel.instance.SetItem(e,t,n),UI.CommonGetItemPanel.instance.Open()}e.ZeroPoint=egret.Point.create(0,0),e.cacheDuration=3e4,e.running=!0,e.version="0.2.1",e.serverMode=0,e.isCrossServer=t,e.middleDot="·",e.mergeServer=0,e.isMergeServer=n;var g;!function(e){e[e.SeriesMetal=0]="SeriesMetal",e[e.SeriesWood=1]="SeriesWood",e[e.SeriesWater=2]="SeriesWater",e[e.SeriesFire=3]="SeriesFire",e[e.SeriesEarth=4]="SeriesEarth",e[e.SeriesCount=5]="SeriesCount"}(g=e.Series||(e.Series={})),e.series2Icon=["icon/wuxing/wx_j.png","icon/wuxing/wx_m.png","icon/wuxing/wx_s.png","icon/wuxing/wx_h.png","icon/wuxing/wx_t.png",""];var m;!function(e){e[e.none=0]="none",e[e.start=1]="start",e[e.tianwang=1]="tianwang",e[e.emei=2]="emei",e[e.gaibang=3]="gaibang",e[e.wudu=4]="wudu",e[e.wudang=5]="wudang",e[e.shaolin=6]="shaolin",e[e.tianren=7]="tianren",e[e.tangmen=8]="tangmen",e[e.cuiyan=9]="cuiyan",e[e.kunlun=10]="kunlun",e[e.wuhuntang=11]="wuhuntang",e[e.count=12]="count"}(m=e.Faction||(e.Faction={})),e.factionSeries=[-1,g.SeriesMetal,g.SeriesWater,g.SeriesFire,g.SeriesWood,g.SeriesEarth,g.SeriesMetal,g.SeriesFire,g.SeriesWood,g.SeriesWater,g.SeriesEarth];var f;!function(e){e[e.CampNeutral=0]="CampNeutral",e[e.CampPlayer=1]="CampPlayer",e[e.CampMonster=2]="CampMonster",e[e.CampSong=3]="CampSong",e[e.CampJin=4]="CampJin",e[e.CampButcher=5]="CampButcher"}(f=e.Camp||(e.Camp={}));var v;!function(e){e[e.EquipClassNormal=0]="EquipClassNormal",e[e.EquipClassGreen=1]="EquipClassGreen",e[e.EquipClassBlue=2]="EquipClassBlue",e[e.EquipClassPurple=3]="EquipClassPurple",e[e.EquipClassOrange=4]="EquipClassOrange",e[e.EquipClassRed=5]="EquipClassRed",e[e.EquipClassCount=6]="EquipClassCount"}(v=e.EquipKlass||(e.EquipKlass={})),e.seriesStoneIdx=[[2,1,-1,0,-1],[0,2,-1,-1,1],[-1,-1,2,1,0],[1,-1,0,2,-1],[-1,0,1,-1,2]],e.seriesRestriction=[g.SeriesWood,g.SeriesEarth,g.SeriesFire,g.SeriesMetal,g.SeriesWater],e.seriesPromotion=[g.SeriesWater,g.SeriesFire,g.SeriesWood,g.SeriesEarth,g.SeriesMetal],e.seriesReverseRestriction=[g.SeriesFire,g.SeriesMetal,g.SeriesEarth,g.SeriesWater,g.SeriesWood],e.JadeCostGold=20;var y;!function(e){e[e.GoldCoin=0]="GoldCoin",e[e.SilverCoin=1]="SilverCoin",e[e.CopperCoin=2]="CopperCoin",e[e.Practice=3]="Practice",e[e.Arena=4]="Arena",e[e.Reading=5]="Reading",e[e.Zhenqi=6]="Zhenqi",e[e.Errantry=7]="Errantry",e[e.Pith=8]="Pith",e[e.GuildContribution=9]="GuildContribution",e[e.Jade=10]="Jade",e[e.BetCoin=11]="BetCoin",e[e.BetScore=12]="BetScore",e[e.Fubi=13]="Fubi",e[e.Count=14]="Count"}(y=e.Currency||(e.Currency={})),e.currency2AwardType=["goldCoin","silverCoin","copperCoin","practiceCoin","arenaCoin","readingCoin","zhenqi","errantry","pith","guildContribution","jade","betCoin","betScore","fubi"],e.currency2Icon=["ui/roleinfo/jin.png","ui/roleinfo/yin.png","ui/roleinfo/coin.png","","ui/roleinfo/coin_wu.png","icon/item/item_yulidan.png","","","icon/item/ylz.png","icon/item/hb_bg.png","","icon/item/cm_1.png","icon/item/cm_3.png","icon/item/fb.png"];
var b;!function(e){e[e.EquipHelmet=0]="EquipHelmet",e[e.EquipArmor=1]="EquipArmor",e[e.EquipCuff=2]="EquipCuff",e[e.EquipBoot=3]="EquipBoot",e[e.EquipWeapon=4]="EquipWeapon",e[e.EquipNecklace=5]="EquipNecklace",e[e.EquipRing=6]="EquipRing",e[e.EquipPendant=7]="EquipPendant",e[e.EquipCount=8]="EquipCount"}(b=e.EquipPart||(e.EquipPart={}));var S;!function(e){e[e.Friend=0]="Friend",e[e.BlackList=1]="BlackList",e[e.RecentContact=2]="RecentContact",e[e.Count=3]="Count"}(S=e.FriendPageType||(e.FriendPageType={}));var E;!function(e){e[e.None=0]="None",e[e.BLUE=1]="BLUE",e[e.PURPLE=2]="PURPLE",e[e.RED=3]="RED",e[e.SPECIAL=4]="SPECIAL"}(E=e.NpcGrade||(e.NpcGrade={})),e.RuneCount=28,e.BookCategory=4,e.BookAttributeCount=4,e.MaxBookLevel=8;var C;!function(e){e[e.Equip=0]="Equip",e[e.Prop=1]="Prop",e[e.Material=2]="Material",e[e.Count=3]="Count"}(C=e.BagPage||(e.BagPage={})),e.Second=1e3,e.FPS=30,e.MSPF=e.Second/e.FPS,e.ServerFPS=10,e.ServerMSPF=e.Second/e.ServerFPS,e.RageRatio=100,e.MaxRage=1200*e.RageRatio,e.PIXELSBYMETER=80,e.Minute=60*e.Second,e.Hour=60*e.Minute,e.ChangeFPS=i,e.HtmlTextParser=new egret.HtmlTextParser,e.removeFromParent=a;var T=[],I=[e.Series.SeriesMetal,e.Series.SeriesWood,e.Series.SeriesEarth,e.Series.SeriesWater,e.Series.SeriesFire];e.GetRestrictionSeries=r,e.start=o;var G=!1;e.loader=[],e.RegisterLoader=s;var A;!function(e){e[e.BuffTriggerType_Talent=1]="BuffTriggerType_Talent",e[e.BuffTriggerType_CatchThiefSkill=2]="BuffTriggerType_CatchThiefSkill",e[e.BuffTriggerType_TriggerSkill=3]="BuffTriggerType_TriggerSkill"}(A=e.BuffTriggerType||(e.BuffTriggerType={})),e.MAX_GUILDSKILL_LV=10,e.ITEM_MAXSTACK=65535,e.isWildMap=u,e.isCityHome=c,e.ShowNotifyMsg=h,e.ShowNotifyErrorMsg=d,e.ShowGetItemNotify=p;var k;!function(e){e[e.ActiveSkill=0]="ActiveSkill",e[e.PassiveSkill=1]="PassiveSkill"}(k=e.SkillType||(e.SkillType={}))}(Game||(Game={}));var WorldLine;!function(e){function t(){if(null==p&&a(),null==p||0==p.PBDate)return 0;var e=Game.getServerDate(),t=new Date(p.PBDate/1e4,p.PBDate%1e4/100-1,p.PBDate%100,0,0,0),n=new Date(e.getFullYear(),e.getMonth(),e.getDate()+1,0,0,0);return(n.getTime()-t.getTime())/1e3/86400}function n(e,n){if(null==e||""==e)return!0;var i=t();if(0==i)return!0;if(null==p[e])return!0;var a=p[e][""+n];return null==a?(egret.error("WorldLine: %s not found %d",e,n),!1):0==a?!0:i>=a}function i(e,n,i){if(null==e||""==e)return i;var a=t();if(0==a)return i;if(null==p[e])return i;var r=[];for(var o in p[e])r.push(o);r.sort();for(var s=r.length-1;s>=0;s--)if(a>=p[e][r[s]])return Number(r[s]);return n}function a(){var e="public_config/worldline.json";p=RES.getRes(e),null==p&&egret.error("cannot load config:",e),egret.log("Public Beta Date: %d, PBDays: %d",p.PBDate,t())}function r(e){if(null==e||""==e)return!0;var n=t();return 0==n?!0:null==p[e]?!0:n>=p[e]}function o(e){return n("Factions",e)}function s(e){return n("EquipSuitMake",e)}function l(){return i("MaxLevels",100,200)}function u(){return i("StrengthLevels",100,200)}function c(){return i("GemLevels",5,9)}function h(){return i("SuperWeapons",20,60)}function d(){return i("Avatars",10,30)}var p=null;e.Load=a,e.IsOpen=r,e.IsFacionOpen=o,e.IsEquipSuitMakeOpen=s,e.GetMaxRoleLevel=l,e.GetMaxStrengthLevel=u,e.GetMaxGemLevel=c,e.GetMaxSuperWeaponsLevel=h,e.GetMaxAvatarsLevel=d}(WorldLine||(WorldLine={}));var bt;!function(e){function t(){for(var t=RES.getRes("config/ai.json"),i=0,a=t;i<a.length;i++){var r=a[i];e.factories[r.id]&&egret.error("duplicate ai: id=%d",r.id),this.factories[r.id]=n(r)}}function n(e){switch(e.type){default:return egret.error("unknown ai type="+e.type),null;case"node":return i(e);case"leaf":return o(e)}}function i(e){switch(e.name){default:return egret.error("unknown node name="+e.name),null;case"loop":return a(p,e.value);case"selector":return a(h,e.value);case"sequence":return a(d,e.value);case"parallel":return a(g,e.value);case"parallelSelector":return a(m,e.value)}}function a(e,t){var n=s(t),i=function(){for(var t=[],i=0;i<n.length;i++)t[i]=n[i]();return new e(t)};return i}function r(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return function(){return new(e.bind.apply(e,[void 0].concat(t)))}}function o(t){switch(t.name){default:var i=e.leafFactoryCreator[t.name];return i?i(t.value):(egret.error("unknown leaf name="+t.name),null);case"wait":return r(v,t.value.time);case"returnTrue":return r(f,n(t.value)())}}function s(e){for(var t=[],i=0;i<e.length;i++){var a=e[i],r=n(a);t[i]=r}return t}var l=function(){function e(){}return e}();e.Blackboard=l,__reflect(l.prototype,"bt.Blackboard"),e.factories=egret.createMap(),e.leafFactoryCreator=egret.createMap(),e.load=t,e.loadLeaf=r;var u=function(){function e(){}return e.prototype.Initialize=function(e){},e.prototype.Uninitialize=function(){},e.prototype.Reset=function(){},e.prototype.Execute=function(e){return 0},e}();e.EmptyAction=u,__reflect(u.prototype,"bt.EmptyAction");var c=function(){function e(e){this.actions=e}return e.prototype.Initialize=function(e){for(var t=0,n=this.actions;t<n.length;t++){var i=n[t];i.Initialize(e)}this.index=0},e.prototype.Uninitialize=function(){for(var e=0,t=this.actions;e<t.length;e++){var n=t[e];n.Uninitialize()}},e.prototype.Reset=function(){for(var e=0,t=this.actions;e<t.length;e++){var n=t[e];n.Reset()}this.index=0},e}();__reflect(c.prototype,"btSequential");var h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.Execute=function(e){for(var t=this.actions.length,n=this.index;t>n;n++){var i=this.actions[this.index].Execute(e);if(1!=i)return i;if(this.index++,this.index>=this.actions.length)return 1}},t}(c);e.btSelector=h,__reflect(h.prototype,"bt.btSelector",["bt.Action"]);var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.Execute=function(e){for(var t=this.actions.length,n=this.index;t>n;n++){var i=this.actions[this.index].Execute(e);if(0!=i)return i;if(this.index++,this.index>=this.actions.length)return 0}},t}(c);e.btSequence=d,__reflect(d.prototype,"bt.btSequence",["bt.Action"]);var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.Execute=function(e){for(var t=this.actions.length,n=this.index;t>n;n++){var i=this.actions[this.index].Execute(e);switch(i){default:egret.error("unexpected status: !{status}");break;case 2:return 2;case 0:if(this.index++,this.index>=this.actions.length)return this.Reset(),2;break;case 1:return this.Reset(),2}}return 2},t}(c);e.btLoop=p,__reflect(p.prototype,"bt.btLoop",["bt.Action"]);var g=function(){function e(e){this.actions=e}return e.prototype.Initialize=function(e){for(var t=0,n=this.actions;t<n.length;t++){var i=n[t];i.Initialize(e)}this.todo=[],this.Reset()},e.prototype.Uninitialize=function(){for(var e=0,t=this.actions;e<t.length;e++){var n=t[e];n.Uninitialize()}},e.prototype.Reset=function(){this.todo=[];for(var e=0,t=this.actions;e<t.length;e++){var n=t[e];n.Reset(),this.todo.push(n)}},e.prototype.skip=function(e){var t=this.todo.length-1;t!=e&&(this.todo[e]=this.todo[t]),this.todo[t]=null,this.todo.pop()},e.prototype.Execute=function(e){for(var t=0;t<this.todo.length;){var n=this.todo[t];2==n.Execute(e)?t++:this.skip(t)}return this.todo.length>0?2:0},e}();e.btParallel=g,__reflect(g.prototype,"bt.btParallel",["bt.Action"]);var m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.Execute=function(e){for(var t=0;t<this.todo.length;){var n=this.todo[t].Execute(e);switch(n){case 2:t++;break;case 0:return 0;case 1:this.skip(t)}}return this.todo.length>0?2:1},t}(g);e.btParallelSelector=m,__reflect(m.prototype,"bt.btParallelSelector");var f=function(){function e(e){this.action=e}return e.prototype.Initialize=function(e){this.action.Initialize(e)},e.prototype.Uninitialize=function(){this.action.Uninitialize()},e.prototype.Reset=function(){this.action.Reset()},e.prototype.Execute=function(e){return 2==this.action.Execute(e)?2:0},e}();e.btTrue=f,__reflect(f.prototype,"bt.btTrue",["bt.Action"]);var v=function(){function e(e){this.delay=e}return e.prototype.Initialize=function(e){this.Reset()},e.prototype.Uninitialize=function(){},e.prototype.Reset=function(){this.timeUp=this.delay+egret.getTimer()},e.prototype.Execute=function(e){return this.timeUp>egret.getTimer()?2:0},e}();e.btWait=v,__reflect(v.prototype,"bt.btWait",["bt.Action"])}(bt||(bt={}));var mapCharacter=egret.createMap(),Character=function(){function e(){this.dir64=1,this.frozenTime=0,this.stunTime=0,this.isMirror=!1,this._logicPos=egret.Point.create(0,0),this.workingCmd=new Action.CommandAction,this.pendingCmd=new Action.CommandAction}return e.generate=function(){var t=this.objectPool.pop();return null==t&&(t=new e),t},Object.defineProperty(e.prototype,"MoveSpeed",{get:function(){return this._MoveSpeed},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"DisplayMoveSpeed",{get:function(){return this._MoveSpeed/Game.ServerFPS+" ("+NumberFormat(this._MoveSpeed/Game.PIXELSBYMETER,1)+" m/s)"},enumerable:!0,configurable:!0}),e.prototype.SetMoveSpeed=function(e){this._MoveSpeed=e},Object.defineProperty(e.prototype,"selected",{get:function(){return AI.bb.select==this.Id},enumerable:!0,configurable:!0}),e.prototype.setAvatar=function(e){switch(this.avatar=e,this.kind){case 2:var t=table.npcs[this.templateId],n=t.resource;this.avatar&&table.avatars[this.avatar]&&(n=table.avatars[this.avatar].resource),this.actor.updateResource(n);break;case 1:var i=table.faction[this.faction],n=i.resource;this.avatar&&table.avatars[this.avatar]&&(n=table.avatars[this.avatar].resource),this.actor.updateResource(n)}},e.prototype.load=function(e,t,n,i,a){switch(this.kind=e,this.templateId=n,this.faction=i,this.AttackSpeed=0,this.isMirror=t,this.guildName=null,this.frozenTime=0,this.stunTime=0,this.revisePos=null,this.workingCmd.clear(),this.pendingCmd.clear(),this.avatar=a,this.actor&&(Game.removeFromParent.call(this.actor),this.actor=null,egret.error("character actor != null")),e){case 2:var r=table.npcs[n],o=r.resource;switch(this.avatar&&table.avatars[this.avatar]&&(o=table.avatars[this.avatar].resource),this.actor=Actor.generate(o),this.actor.attachCharacter(this),this.actor.to(ActorAnimation.st,null,null),this.SetName(r.name),r.grade){case Game.NpcGrade.BLUE:this.actor.head.updateRoleNameSize(14);break;case Game.NpcGrade.PURPLE:this.actor.head.updateRoleNameSize(14),this.actor.addEffect("npc_aura_m",-1,ActorLayer.back,0,0);break;case Game.NpcGrade.RED:this.actor.head.updateRoleNameSize(14),this.actor.addEffect("npc_aura_m",-1,ActorLayer.back,0,0);break;case Game.NpcGrade.SPECIAL:this.actor.head.updateRoleNameSize(14);break;default:this.actor.head.updateRoleNameSize(14)}r.lifeBar?this.actor.head.changeLifeBarSkin(r.lifeBar):this.actor.head.hideLifeBar();break;case 1:var s=table.faction[i],o=s.resource;this.avatar&&table.avatars[this.avatar]&&(o=table.avatars[this.avatar].resource),this.actor=Actor.generate(o),this.actor.to(ActorAnimation.st,null,null),this.actor.attachCharacter(this),1==this.delegateKind?(this.actor.head.changeLifeBarSkin("SelfLifeBarSkin"),this.actor.head.updateRoleNameColor(color.Self),this.actor.head.updateRoleNameSize(14)):(this.actor.head.changeLifeBarSkin("PlayerLifeBarSkin"),this.actor.head.updateRoleNameSize(14)),this.actor.head.hideRoleName(),this.actor.head.hideRoleLifeBar();break;default:egret.error("[CreateCharacter] fail kind ="+e)}this.actor.to(ActorAnimation.st,null,null)},e.prototype.updateFactionTitle=function(e){this.factionTitle=e,this.actor.head.updateTitle(FactionTitle.getResource(this.factionTitle))},e.prototype.updateCommonTitle=function(e){this.commonTitle=e,this.actor.head.updateTitle2(CommonTitle.getResource(this.commonTitle))},Object.defineProperty(e.prototype,"delegateKind",{get:function(){return 0},enumerable:!0,configurable:!0}),e.prototype.liteModeLimit=function(){var e=this.kind,t=this.templateId;switch(e){case 2:var n=table.npcs[t];if(1==n.elite)return!1;switch(n.grade){case Game.NpcGrade.BLUE:case Game.NpcGrade.PURPLE:case Game.NpcGrade.RED:case Game.NpcGrade.SPECIAL:return!1}if(14024==t)return!1}return LiteMode.limit()?this.Id!=Player.instance.Id&&this.Id!=AI.bb.select:!1},Object.defineProperty(e.prototype,"invalid",{get:function(){return null==mapCharacter[this.Id]},enumerable:!0,configurable:!0}),e.prototype.changeSpeed=function(e){this.SetMoveSpeed(e),this.actor.changeRunSpeed()},e.prototype.addSceneTitle=function(e,t){switch(this.sceneTitle={type:e,id:t},e){case 1:this.actor.head.updateSceneTitle(SongJin.makeSceneTitle(t));break;case 0:this.actor.head.updateSceneTitle(null)}},e.prototype.select=function(){AI.SelectTarget(this.Id),Player.instance.revisePos=null,AI.stopMove()},e.prototype.SetLife=function(e){e>this.MaxLife&&(e=this.MaxLife),0>e&&(e=0),this.Life=e,this.actor.head.updateLife(e)},e.prototype.SetMaxLife=function(e){this.MaxLife=e,this.actor.head.updateMaxLife(e)},e.prototype.SetName=function(e){null==e.match(/<npcName=(\d+)\/>/)&&(this.Name=e,this.actor.head.roleName=e)},e.prototype.SetSeries=function(e){this.Series=e,this.actor.head.updateSeries(e)},e.prototype.updateIFFS=function(){var e=Scene.isHostile(this);if(1==this.kind||this.isMirror)e?(this.actor.head.changeLifeBarState("enemy"),this.actor.touchChildren=!0,this.actor.head.updateRoleNameColor(color.EnemyPlayer)):(this.actor.head.changeLifeBarState("friend"),this.actor.touchChildren=!1,this.actor.head.updateRoleNameColor(color.FriendPlayer));else{var t=table.npcs[this.templateId];if(e||this.Camp==Game.Camp.CampMonster)switch(this.actor.head.changeLifeBarState("enemy"),this.actor.touchChildren=!0,t.grade){case Game.NpcGrade.BLUE:this.actor.head.updateRoleNameColor(color.EnemyBule);break;case Game.NpcGrade.PURPLE:this.actor.head.updateRoleNameColor(color.EnemyPurple);break;case Game.NpcGrade.RED:case Game.NpcGrade.SPECIAL:this.actor.head.updateRoleNameColor(color.EnemyRed);break;default:this.actor.head.updateRoleNameColor(color.EnemyNormal)}else switch(this.actor.head.changeLifeBarState("friend"),this.actor.touchChildren=!1,t.grade){case Game.NpcGrade.BLUE:this.actor.head.updateRoleNameColor(color.FriendBule);break;case Game.NpcGrade.PURPLE:this.actor.head.updateRoleNameColor(color.FriendPurple);break;case Game.NpcGrade.RED:case Game.NpcGrade.SPECIAL:this.actor.head.updateRoleNameColor(color.FriendRed);break;default:this.actor.head.updateRoleNameColor(color.FriendNormal)}}},e.prototype.SetCamp=function(e){if(this.Camp=e,1==this.kind||this.isMirror)switch(this.Camp){case Game.Camp.CampSong:SongJin.isCombating()&&this.actor.head.updateCampName(lang.String("songjun"));break;case Game.Camp.CampJin:SongJin.isCombating()&&this.actor.head.updateCampName(lang.String("jinjun"));break;default:this.actor.head.updateCampName(null)}else this.actor.head.updateCampName(null);this.updateIFFS()},e.prototype.doDie=function(){this.clearCommand(),this.actor.onDie(),this.actor.to(ActorAnimation.die,null,null),this.frozenTime=0,this.stunTime=0},e.prototype.stand=function(){var e=new net.def.C2SStand;e.dir=this.dir64,e.posX=this.logicPos.x,e.posY=this.logicPos.y,net.socket.write(4,e.toArrayBuffer())},e.prototype.playSkillHurtEffect=function(e){var t=Skill.mapSkill[e];if(null!=t&&null!=t.hitanimition){var n=table.actor[this.actor.res];this.actor.addOneTimeEffect(t.hitanimition,ActorLayer.front,n.body-n.feet)}},e.prototype.beingReflectedDamage=function(e){this.actor.beingReflectedDamage(e,this.Id==Player.instance.Id)},e.prototype.onSkillHurt=function(e,t,n){var i=Player.instance;if(this.actor.popHurt(t,n,this.Id==i.Id),this.Id!=i.Id){var a=void 0;a=i.logicPos.equals(this.logicPos)||"aoe"!=Skill.mapSkill[e].type?i.dir64:g_GetDirIndex(Player.instance.logicPos,this.logicPos),this.dir64=(a+HALF_DIR)%MAX_DIR,this.actor.dir64=this.dir64,this.Life<=t?(this.actor.onShakeFinish(),this.actor.doHitBack(a)):this.actor.doHurt(a)}this.playSkillHurtEffect(e)},e.prototype.onSkillEffect=function(e,t){var n=Skill.mapSkill[e];null!=n&&null!=n.effectAnimition&&n.effectAnimition(this,this,this.dir64,null,t)},e.prototype.onStatusEffect=function(e,t,n){switch(t){case 2:this.actor.addEffect("em_20_sejx_b",n,ActorLayer.front,0,0);break;case 3:this.locate(this.dir64,e),this.frozenTime=egret.getTimer()+n,this.clearCommand(),this.actor.frozen=!0,this.actor.addEffect("tw_dingshen",n,ActorLayer.front,0,0);break;case 4:this.actor.addEffect("gb_20_lzyy_b",n,ActorLayer.front,0,0);break;case 5:this.locate(this.dir64,e),this.stunTime=egret.getTimer()+n,this.clearCommand(),this.actor.addEffect("wd_xuanyun",n,ActorLayer.front,0,this.actor.head.y+10+this.actor.feet);break;case 1:case 6:this.actor.addEffect("wu_dot",n,ActorLayer.front,0,0)}},Object.defineProperty(e.prototype,"dead",{get:function(){return this.Life<=0},enumerable:!0,configurable:!0}),e.prototype.__recycle=function(){this.actor=null,this.revisePos=null,this._logicPos.setTo(0,0),this.workingCmd.cmd&&this.workingCmd.cmd.release(),this.pendingCmd.cmd&&this.pendingCmd.cmd.release(),this.workingCmd.clear(),this.pendingCmd.clear()},e.prototype.release=function(){e.objectPool.push(this)},e.prototype.destroy=function(){null!=this.actor&&(this.actor.destroy(),this.actor=null),delete mapCharacter[this.Id],this.release()},e.prototype.doGone=function(){null!=this.actor&&(this.actor.doGone(),this.actor=null),delete mapCharacter[this.Id],this.release()},e.prototype.update=function(e){this.dead||(1==this.actor.frozen&&this.frozenTime<egret.getTimer()&&(this.actor.frozen=!1),this.runCommand(e)),egret.Capabilities.isMobile||1!=this.delegateKind||(this.dead?mapLayer.filters||(mapLayer.filters=[grayFlilter]):mapLayer.filters&&(mapLayer.filters=null))},e.prototype.clearCommand=function(){var e=this.workingCmd.cmd;e&&(this.workingCmd.clear(),e.abort(),e.release()),this.pendingCmd.cmd&&this.pendingCmd.cmd.release(),this.pendingCmd.clear()},e.prototype._runCommand=function(e){var t=this.workingCmd.cmd,n=this.pendingCmd.cmd;if(null==t){if(null==n)return void this.actor.to(ActorAnimation.st,null,null);this.workingCmd.copyFrom(this.pendingCmd),this.pendingCmd.clear(),t=n,t.begin()}else null!=n&&Action.prior(this.pendingCmd.action,this.workingCmd.action)&&(this.workingCmd.copyFrom(this.pendingCmd),this.pendingCmd.clear(),t.abort(),t.release(),t=n,t.begin());t.execute(e)||(t.end(),t.release(),this.workingCmd.copyFrom(this.pendingCmd),this.pendingCmd.clear(),t=this.workingCmd.cmd,null!=t&&t.begin())},e.prototype.runCommand=function(e){this._runCommand(e)},e.prototype.pushCommand=function(e,t){if(null!=this.revisePos&&this.workingCmd.action==Action.Status.Running){if(e!=Action.Status.Running)return this.pendingCmd.cmd&&this.pendingCmd.cmd.release(),this.pendingCmd.cmd=t,void(this.pendingCmd.action=e);this.revisePos=null}null!=this.workingCmd.cmd&&(this.workingCmd.cmd.abort(),this.workingCmd.cmd.release()),this.workingCmd.cmd=t,this.workingCmd.action=e,t.begin()},e.prototype.onMoveFinished=function(e){null!=this.revisePos&&this.revisePos.equals(this.logicPos)&&(this.revisePos=null)},e.prototype.moveTo=function(e,t){if(!this.dead){if(this.MoveSpeed<=0)return void egret.error("[MoveTo] Character:"+this.Id+" speed: "+this.MoveSpeed);if(!this.logicPos.equals(e)){var n=Action.CmdRun.generate(this,e,t);n.onFinished=this.onMoveFinished,this.pushCommand(Action.Status.Running,n)}}},e.prototype.rushTo=function(e,t){if(!this.dead){var n=new Action.CmdRush(this,e,t);this.pushCommand(Action.Status.Running,n)}},e.prototype.lookAt=function(e){this._logicPos.equals(e)||(this.dir64=g_GetDirIndex(this._logicPos,e))},e.prototype.getPopSkillInfo=function(e){if(2!=this.kind)return null;var t=table.npcs[this.templateId];if(null==t)return console.log("cannot find npc template",this.templateId),null;if(null!=t.icon&&null!=t.popupSkills_[e]){var n=Skill.mapSkill[e];if(null!=n)return n.name}return null},e.prototype.onSkillBegin=function(e){var t=this.getPopSkillInfo(e);t&&this.actor.popSkill(t,PopSkillType.NpcSkill)},e.prototype.CastAoeSkill=function(e,t,n){var i=Action.CmdAoeSkill.generate(this,n,e,t);i.onBegin=this.onSkillBegin,this.pushCommand(Action.Status.Casting,i)},e.prototype.CastDirSkill=function(e,t,n){var i=Action.CmdDirSkill.generate(this,n,e,t);i.onBegin=this.onSkillBegin,this.pushCommand(Action.Status.Casting,i)},e.prototype.CastCharSkill=function(e,t,n){var i=Action.CmdCharSkill.generate(this,n,e,t);i.onBegin=this.onSkillBegin,this.pushCommand(Action.Status.Casting,i)},e.prototype.doRevive=function(e){this.dead&&(this.clearCommand(),this.SetLife(e),this.actor.to(ActorAnimation.st,null,null))},e.prototype.locate=function(e,t){this.dir64!=e&&(this.dir64=e,this.actor&&this.actor.updatedir()),this.logicPos=t},Object.defineProperty(e.prototype,"selectable",{get:function(){return this.dead?!1:Scene.isHostile(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"logicPos",{get:function(){return this._logicPos},set:function(e){this._logicPos.copyFrom(e);var t=Scene.logicPos2DisplayPos(e);this.actor.x=t.x,this.actor.y=t.y,egret.Point.release(t)},enumerable:!0,configurable:!0}),e.prototype.localToGlobal=function(e,t){return this.actor.localToGlobal(e,t)},e.prototype.SetGuildName=function(e){this.guildName=e,this.actor.head.updateGuildName(e),e&&(Player.instance.guildName==e?this.actor.head.updateGuildColor(!0):this.actor.head.updateGuildColor(!1))},e.prototype.bleed=function(e){var t=this.actor;t&&t.popTextWithImage("ui/public/lvdu.png",!1,""+e,"Number/dot.fnt",tweenBleedDamage,-t.width/2-30+100,-t.bodyhight/2)},e.objectPool=new egret.Recycler,e}();__reflect(Character.prototype,"Character",["Action.Delegate"]);var monthlyactivity;!function(e){function t(){return G}function n(){var t=Game.getServerDate(),i=Activity.activites[Activity.ActivityKind.Activity_MonthlyAct];return i?t>=i.startTime&&t<=i.endTime?void(0==G&&(G=!0,UI.RechargeActivityHall.instance.AddMonthlyActButton())):t>i.endTime?void(1==G&&(G=!1,UI.RechargeActivityHall.instance.RemoveMonthlyActButton(),UIManager.pop(UI.RechargeActivityHall.instance),null!=e.loader&&e.loader.release(),SecondTicker.removeEventListener(n,null))):void 0:void 0}function i(){var t=Game.getServerDate(),i=Activity.activites[Activity.ActivityKind.Activity_MonthlyAct];if(!i)return SecondTicker.removeEventListener(n,null),null!=e.loader&&e.loader.release(),G=!1,UI.RechargeActivityHall.instance.RemoveMonthlyActButton(),void UIManager.pop(UI.RechargeActivityHall.instance);T.targetCount=T.profilemap[i.profile].targetCount,T.maxTask=T.profilemap[i.profile].maxTask,T.maxCounter=T.profilemap[i.profile].maxCounter,T.counterTaskCount=T.profilemap[i.profile].counterTaskCount,e.taskValue=[],I=[],e.counterTask=[];for(var a=0;a<T.maxTask;a++)e.taskValue.push(0);for(var a=0;a<T.maxCounter;a++)I.push(0);for(var a=0;a<T.counterTaskCount;a++)e.counterTask.push(0);var r="config"+T.profilemap[i.profile].clientCfg;e.loader||(e.loader=new RES.Loader),e.loader.url==r&&e.loader.dispatcher||(e.loader.release(),e.loader.get(r,function(t){e.loader.release(),e.act=t,e.valueID2Item={};for(var n=0;n<e.act.values.length;n++)e.valueID2Item[e.act.values[n].id]=e.act.values[n];T.counterTaskCount!=e.act.counterTasks.length&&egret.error("mgr.counterTaskCount != act.counterTasks.length",T.counterTaskCount,e.act.counterTasks.length),h(),d()}),t<=i.endTime&&SecondTicker.addEventListener(n,null))}function a(t,n){if(null==e.valueID2Item)return{id:0,name:"",desc:"",icon:"",quality:0,type:"clientitem",count:0,obtainId:0};var i=e.valueID2Item[t];if(null==i)return null;var a={id:i.id,name:i.name,desc:i.desc,icon:i.icon,quality:i.quality,type:"clientitem",count:e.taskValue[t],obtainId:i.obtainId};return null!=n&&(a.count=n),a}function r(e){return I[e-1]}function o(){T=RES.getRes("public_config/monthly_activity_mgr.json"),T.profilemap={};for(var e=0;e<T.profile.length;e++){var t=T.profile[e].id;T.profilemap[t]=T.profile[e]}}function s(){return T.minLevel}function l(){return PlayerAttribute.Level<T.minLevel?!1:!0}function u(e){var t=e.getFullYear(),n=e.getMonth()+1,i=e.getDate();return String(i)+"."+String(n)+"."+String(t)}function c(t,n){n||(n=1);var i=e.act.targets[t];if(!i)return{num:0,idx:null};if(I[i.counterID-1]>=i.maxTimes)return{num:0,idx:null,tips:e.errorMsg[3]};for(var a=i.maxTimes-I[i.counterID-1],r=10,o=0;o<i.elems.length;o++){var s=i.elems[o],l=0,u=UI.CostElementCell.getCurrentNumber(s);if(l=null!=s.content.count?Number(String(s.content.count)):Number(String(s.content)),l*n>u)return{num:0,idx:o,tips:e.errorMsg[2]};r=Math.min(r,Math.floor(u/l))}return{num:Math.min(a,r),idx:null,tips:e.errorMsg[3]}}function h(){var t=!1;if(e.act){for(var n=0;n<e.act.targets.length;n++)if(c(n).num>=1){t=!0;break}badge.onLight(badge.action.MonthlyActCanAchieveTarget,t)}}function d(){if(e.act){for(var t=0;t<T.counterTaskCount;t++){var n=e.act.counterTasks[t];if(I[n.counterID-1]>=n.target&&0==e.counterTask[t])return void badge.onLight(badge.action.MonthlyActCanAchieveCountTask,!0)}badge.onLight(badge.action.MonthlyActCanAchieveCountTask,!1)}}function p(){var e=Activity.activites[Activity.ActivityKind.Activity_MonthlyAct];return null==e?"":u(e.endTime)}function g(t){e.taskValue=[],I=[],e.counterTask=[];for(var n=0;n<t.value.length;n++)e.taskValue.push(t.value[n]);for(var n=0;n<t.counter.length;n++)I.push(t.counter[n]);for(var n=0;n<t.countertask.length;n++)e.counterTask.push(t.countertask[n]);h(),d()}function m(t){switch(t.repCode){case 0:PopUpMessage.push(e.errorMsg[0],color.RED,!1);break;case 4:PopUpMessage.push(e.errorMsg[4],color.RED,!1);break;case 1:PopUpMessage.push(e.errorMsg[1],color.RED,!1);break;case 2:PopUpMessage.push(e.errorMsg[2],color.RED,!1);break;case 3:PopUpMessage.push(e.errorMsg[3],color.RED,!1)}Game.dispatcher.dispatchEventWith(Game.EVENT.MonthlyActUpdateTarget)}function f(t){I[t.counterID-1]=t.counter;for(var n=0;n<t.values.length;n++)e.taskValue[n]=t.values[n];Game.dispatcher.dispatchEventWith(Game.EVENT.MonthlyActUpdateTarget),Game.dispatcher.dispatchEventWith(Game.EVENT.MonthlyActUpdateCounterTask),h(),d()}function v(t){e.counterTask[t.counterTaskID]=t.counterTask,Game.dispatcher.dispatchEventWith(Game.EVENT.MonthlyActUpdateCounterTask),d()}function y(e){for(var t=[],n=0;n<e.awards.length;n++){var i=table.parseAward(e.awards[n]);"monthlyTask"==i.type?t.push(a(i.content.id,i.content.count)):t.push(i)}UIManager.pushPage(new UI.MonthlyActivityAwardPage(t))}function b(t){var n=a(t.taskID);null!=n&&(t.value>e.taskValue[t.taskID]&&PopUpMessage.push(lang.StringWithFormat("monthlyact gain taskValue{1} num{2}",n.name,t.value-e.taskValue[t.taskID]),color.GREEN),e.taskValue[t.taskID]=t.value,h(),Game.dispatcher.dispatchEventWith(Game.EVENT.MonthlyActUpdateTarget))}function S(t){null!=t&&(e.act.values[t]?UI.ResourceObtain.Open([e.act.values[t].obtainId]):UI.ResourceObtain.Open([UI.ObtResId.jade]))}function E(e){var t=e.countID,n=e.value;null!=I&&(I[t-1]=n,Game.dispatcher.dispatchEventWith(Game.EVENT.MonthlyActUpdateCounterTask))}function C(){return e.act?{name:e.act.name,icon:e.act.icon}:null}e.Jade={name:"jade",desc:"jade desc",icon:"icon/item/mgh_3.png",quality:4,obtainId:29},e.act=null,e.jadePurchaseCnt=0;var T,I,G=!1;e.IsOpenning=t,e.onTimer=n,e.OnStateUpdate=i,e.GetTransData=a,e.GetCounter=r,e.Init=o,e.GetMinLevel=s,e.CheckLevel=l,e.CheckTarget=c,e.getEndDateString=p,e.onSyncTaskObject=g,e.errorMsg=["Lỗi chưa biết","Tính năng đã đóng","Vật phẩm cần không đủ","Số lần đạt tối đa","Tính năng chưa mở"],e.onSyncActRep=m,e.onSyncTarget=f,e.onSyncCounterTask=v,e.onMonthlyActAward=y,e.onMonthlyActSyncSingleTask=b,e.resourceObtain=S,e.onMonthlySyncCounter=E,e.getRadioButtonInfo=C}(monthlyactivity||(monthlyactivity={}));var color;!function(e){e[e.RED=16711722]="RED",e[e.NewGREEN=1492056]="NewGREEN",e[e.NewBLUE=47594]="NewBLUE",e[e.GOLD=10974227]="GOLD",e[e.GRAY=10066329]="GRAY",e[e.BLACK=0]="BLACK",e[e.Elite=45296]="Elite",e[e.PINK=16711935]="PINK",e[e.WHITE=16777215]="WHITE",e[e.GREEN=2869835]="GREEN",e[e.BLUE=1546239]="BLUE",e[e.PURPLE=12408063]="PURPLE",e[e.YELLOW=16773376]="YELLOW",e[e.ORANGE=16737837]="ORANGE",e[e.Warning=16724273]="Warning",e[e.HeadLines=16777215]="HeadLines",e[e.Title1=14269824]="Title1",e[e.Title1_Value=16119285]="Title1_Value",e[e.Title2=7139163]="Title2",e[e.Title2_Value=15790320]="Title2_Value",e[e.Title3=9934194]="Title3",e[e.MainBody=16762711]="MainBody",e[e.Subtitle=9276267]="Subtitle",e[e.TimeColor=11058399]="TimeColor",e[e.GoldCoin=16767232]="GoldCoin",e[e.SilverCoin=16755201]="SilverCoin",e[e.CopperCoin=14929284]="CopperCoin",e[e.ChatDefalt=14269824]="ChatDefalt",e[e.ChatWarning=16728128]="ChatWarning",e[e.ChatChannelGuild=7663871]="ChatChannelGuild",e[e.ChatChannelWorld=7470942]="ChatChannelWorld",e[e.ChatChannelNear=14408667]="ChatChannelNear",e[e.ChatPlayerName=10793839]="ChatPlayerName",e[e.ChatChannelPrivate=16677357]="ChatChannelPrivate",e[e.EnemyRed=16713728]="EnemyRed",e[e.EnemyPurple=16742259]="EnemyPurple",e[e.EnemyBule=44799]="EnemyBule",e[e.EnemyNormal=9934194]="EnemyNormal",e[e.EnemyPlayer=16742259]="EnemyPlayer",e[e.FriendRed=8692065]="FriendRed",e[e.FriendPurple=8692065]="FriendPurple",e[e.FriendBule=8692065]="FriendBule",e[e.FriendNormal=8692065]="FriendNormal",e[e.FriendPlayer=11985266]="FriendPlayer",e[e.Self=16777215]="Self",e[e.EnemyGuild=14383442]="EnemyGuild",e[e.FriendGuild=5037788]="FriendGuild"}(color||(color={}));var SuperWeapon;!function(e){function t(){for(var t={},n=1;n<=e.MaxWeapons;n++)t[n]=new f(n);return t}function n(t){if(null!=t){for(var n=Player.instance,i=t.items.length,a=PlayerAttribute.superWeapons.items,r=1;r<=e.MaxWeapons;r++)a[r].level=0;for(var r=0;i>r;r++){var o=t.items[r];a[o.id].level=o.level}PlayerAttribute.superWeapons.wearId=t.wearId,null!=n.actor&&n.actor.updateSuperWeaponEffect(t.wearId),PlayerAttribute.UpdateFightingPower(t.notify),null!=y?y.onWeaponDataChanged():null!=n.actor&&badge.onLight(badge.action.SuperWeaponTip,m())}}function i(e,t){var n=mapCharacter[e];if(null==n)return void egret.error("[S2CSuperWeaponOutlook] id="+e+" not found");e==Player.instance.Id&&(PlayerAttribute.superWeapons.wearId=t);var i=n.actor;null!=i&&i.updateSuperWeaponEffect(t),null!=y&&y.onWeaponDataChanged()}function a(e){var t=new net.def.C2SSuperWeaponLevelUp;t.weaponId=e,net.socket.write(162,t.toArrayBuffer())}function r(e,t){var n=new net.def.C2SSetSuperWeaponOutlook;n.isPutOn=e,n.wearId=t,net.socket.write(163,n.toArrayBuffer())}function o(e){e&&PlayerAttribute.UpdateFightingPower(!0),null!=y&&y.onLevelUpResult(e)}function s(){}function l(){return null==y&&(y=new UI.SuperWeaponUI),y}function u(){var e=l();UIManager.pushPage(e)}function c(){null!=y&&y.isOpened&&UIManager.pop(y)}function h(){return null!=y&&y.isOpened}function d(){return b}function p(e){b=e;var t=Player.instance.actor;null!=t&&(b?t.updateSuperWeaponEffect(0):t.updateSuperWeaponEffect(PlayerAttribute.superWeapons.wearId))}function g(){for(var t=PlayerAttribute.superWeapons.items,n=1;n<=e.MaxWeapons;n++){var i=table.superWeaponCfg[n].costs,a=PlayerAttribute.bag.CalcCount(i.cost.genre,i.cost.detailType);if(0!=a){var r=t[n].level+1;if(!(r>WorldLine.GetMaxSuperWeaponsLevel())){1>r&&(r=1);var o=i.num[r];if(a>=o)return n}}}return 0}function m(){return g()>0}e.MaxWeapons=20;var f=function(){function e(e){this.id=e,this.level=0}return Object.defineProperty(e.prototype,"name",{get:function(){return table.superWeaponCfg[this.id].name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"desc",{get:function(){return table.superWeaponCfg[this.id].desc},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"icon",{get:function(){return table.superWeaponCfg[this.id].icon},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"image",{get:function(){return table.superWeaponCfg[this.id].image},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"realFp",{get:function(){var e=this.level;return 0==e?0:table.superWeaponCfg[this.id].props[e].fp},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"props",{get:function(){var e=this.level;return 1>e&&(e=1),table.superWeaponCfg[this.id].props[e]
},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cost",{get:function(){var e=this.level+1;1>e&&(e=1);var t=table.superWeaponCfg[this.id].costs,n={type:"item",content:{genre:t.cost.genre,detailType:t.cost.detailType,num:t.num[e]}};return n},enumerable:!0,configurable:!0}),e}();e.SuperWeaponItem=f,__reflect(f.prototype,"SuperWeapon.SuperWeaponItem");var v=function(){function e(){this.wearId=0,this.items=t()}return e.prototype.getFp=function(){var e=0;for(var t in this.items)e+=this.items[t].realFp;return e},e}();e.SuperWeapons=v,__reflect(v.prototype,"SuperWeapon.SuperWeapons"),e.updateSuperWeaponItems=n,e.updateOutlook=i,e.requestLevelUp=a,e.requestSetOutlook=r,e.levelUpResult=o,e.load=s;var y;e.showUi=u,e.hideUi=c,e.isUiOpened=h;var b=!1;e.isDisableAllPlayersEffect=d,e.disableAllPlayersEffect=p,e.getOneLevelupWeaponId=g,e.canShowReddot=m}(SuperWeapon||(SuperWeapon={}));var Vip;!function(e){function t(){for(var t={},n=1;n<=e.VipMaxLevel;n++)t[n]=new h(n);return t}function n(){var t=(PlayerAttribute.currency[Game.Currency.Pith],PlayerAttribute.vipItem),n=t.level+1;return n>e.VipMaxLevel?!1:!1}function i(e){if(null!=e){var t=PlayerAttribute.vipItem,n=t.level;t.level=e.level,t.wearId=e.wearId,t.exp=e.exp,t.boxStatus=e.boxStatus,PlayerAttribute.UpdateFightingPower(e.notify),e.notify&&n!=e.level&&UIManager.push(new UI.VipLevelUp(n,e.level)),null!=d&&d.onVipDataChanged(),n!=t.level&&t.level>0&&Game.dispatcher.dispatchEventWith(Game.EVENT.UpdateVip);for(var i=!0,a=1;a<=t.level&&(i=0!=(t.boxStatus&1<<a-1),i);a++);badge.onLight(badge.action.VipPrivilegeBox,!i),Game.dispatcher.dispatchEventWith(Game.EVENT.VipPithChange)}}function a(e){var t=new net.def.C2SVipBuyItem;t.level=e,net.socket.write(160,t.toArrayBuffer())}function r(t){return null==t||0>t||t>e.VipMaxLevel?"":t==e.VipMaxLevel?"icon/vip/vend.png":"icon/vip/v"+t+".png"}function o(){return null==d&&(d=new UI.VipUI),d}function s(){if(Game.isCrossServer())return void PopUpMessage.push(lang.String("operation not permitted"),color.RED);var e=o();e.isOpened||UIManager.pushPage(e)}function l(){null!=d&&d.isOpened&&UIManager.pop(d)}function u(){return null!=d&&d.isOpened}e.VipMaxLevel=12;var c=[0,5,10,15,20,25,30,35,40,45,50,50,50],h=function(){function t(e){this.level=e,this.wearId=0,this.exp=0}return Object.defineProperty(t.prototype,"value",{get:function(){return table.vipBoxes[this.level].value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"price",{get:function(){return table.vipBoxes[this.level].price},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"award",{get:function(){return table.vipBoxes[this.level].award},enumerable:!0,configurable:!0}),t.prototype.getActivatedLevel=function(){return this.level},t.prototype.getBounus=function(){return this.level>=0&&this.level<c.length?c[this.level]:0},t.prototype.hasBuyBox=function(t){return 0>=t||t>e.VipMaxLevel?!1:0!=(this.boxStatus&1<<t-1)},t}();e.VipItem=h,__reflect(h.prototype,"Vip.VipItem"),e.newVipItems=t,e.isPlayerCanActivate=n,e.updateVipItem=i,e.requestBuyItem=a,e.getVipIcon=r;var d;e.showVipUi=s,e.hideVipUi=l,e.isVipUiOpened=u}(Vip||(Vip={}));var Bag=function(){function e(){this.items={},this.equips={},this.props={},this.material={},this.equipsSize=0,this.propsSize=0,this.otherSize=0,this.counts={}}return e.prototype.getCount=function(e,t){var n=this.counts[e];if(null==n)return 0;var i=n[t];return null==i?0:i},e.prototype.addCount=function(e,t,n){var i=this.counts[e];null==i&&(i={},this.counts[e]=i);var a=i[t];null==a?i[t]=n:i[t]+=n},e.Page=function(e){switch(e){case 0:return Game.BagPage.Equip;case 1:case 6:case 16:case 11:case 21:return Game.BagPage.Prop;case 2:case 3:case 4:case 5:case 7:case 8:case 9:case 10:case 12:case 14:case 15:case 17:case 18:case 19:case 20:case 13:return Game.BagPage.Material;default:egret.error("unexpected genre="+e)}},e.TipState=function(e){switch(e){case 0:return"equip";case 1:case 6:case 16:case 11:case 21:return"prop";case 2:case 3:case 4:case 5:case 7:case 8:case 9:case 10:case 12:case 14:case 15:case 17:case 18:case 19:case 20:case 13:return"material";default:egret.error("unexpected genre="+e)}},e.prototype.capacity=function(t){switch(t){case Game.BagPage.Equip:return e.MaxSize-this.equipsSize;case Game.BagPage.Prop:return e.propMaxSize-this.propsSize;case Game.BagPage.Material:return e.otherMaxSize-this.otherSize;default:egret.error("unexpected page="+t)}},e.prototype.calcItemOccupancy=function(t,n,i){var a=table.props[t][n].maxStackCount;return{page:e.Page(t),occupancy:int((i+a-1)/a)}},e.prototype.locate=function(t){var n=e.Page(t);switch(n){case Game.BagPage.Equip:return this.equips;case Game.BagPage.Prop:return this.props[t];case Game.BagPage.Material:return this.material[t];default:egret.error("unexpected genre="+t+" page="+n)}},e.prototype.getBook=function(e){var t=this.locate(6);if(null==t)return null;for(var n in t){var i=this.items[n].Item;if(i.Id==e)return i}return null},e.prototype.hasBook=function(e){var t=this.locate(6);if(null==t)return!1;for(var n in t){var i=this.items[n].Item;if(i.Id==e)return!0}return!1},e.prototype.AddItem=function(t){var n=t.Id,i=t.Item;switch(t.Item.BagId=n,this.items[n]=t,e.Page(i.Type)){case Game.BagPage.Equip:var a=i;null==this.equips[a.Part]&&(this.equips[a.Part]={}),this.equips[a.Part][n]=!0,this.equipsSize++;break;case Game.BagPage.Prop:null==this.props[i.Type]&&(this.props[i.Type]={}),this.props[i.Type][n]=!0,this.propsSize++;break;case Game.BagPage.Material:null==this.material[i.Type]&&(this.material[i.Type]={}),this.material[i.Type][n]=!0,this.otherSize++}switch(i.Type){case 0:case 6:case 16:case 11:case 21:break;default:this.addCount(i.Type,i.DetailType,i.Count)}return this.equipsSize>=e.MaxSize-e.MinRoom4Tip?(Game.dispatcher.dispatchEventWith(Game.EVENT.BagFull),void UI.NotEnoughBagSpace(Game.BagPage.Equip)):(this.propsSize>=e.propMaxSize-e.MinRoom4Tip&&UI.NotEnoughBagSpace(Game.BagPage.Prop),void(this.otherSize>=e.otherMaxSize-e.MinRoom4Tip&&UI.NotEnoughBagSpace(Game.BagPage.Material)))},e.prototype.checkAndTipRoomSpace=function(t){return void 0===t&&(t=null),this.equipsSize>=e.MaxSize-e.MinRoom4Tip?(UI.NotEnoughBagSpace(Game.BagPage.Equip,t),!0):this.propsSize>=e.propMaxSize-e.MinRoom4Tip?(UI.NotEnoughBagSpace(Game.BagPage.Prop,t),!0):this.otherSize>=e.otherMaxSize-e.MinRoom4Tip?(UI.NotEnoughBagSpace(Game.BagPage.Material,t),!0):!1},e.prototype.GetSortedEquips=function(){var e=[];for(var t in this.equips)for(var n in this.equips[t]){var i=Number(n);e.push(this.items[i])}e.sort(this.sortEquipByFinghtingPower);var a=42-e.length;if(a>0)for(var r=0;a>r;r++)e.push(null);return e},e.prototype.GetPropItem=function(){var e=[];for(var t in this.props)for(var n in this.props[t]){var i=parseInt(n);e.push(this.items[i])}var a=42-e.length;if(a>0)for(var r=0;a>r;r++)e.push(null);return e},e.prototype.GetItemList=function(e){var t=[],n=this.locate(e);if(null==n)return t;for(var i in n){var a=parseInt(i),r=this.items[a];t.push(r)}return t},e.prototype.GetPartnerEquip=function(e){var t=[],n=this.locate(16);if(null==n)return t;for(var i in n){var a=parseInt(i),r=this.items[a],o=r.Item.id;if(o>0){var s=PartnerEquipManager.GetPartnerEquipInfo(o);s.part==e&&t.push(r)}}return t},e.prototype.GetAllPartnerEquips=function(){var e=[],t=this.locate(16);if(null==t)return e;for(var n in t){var i=parseInt(n),a=this.items[i];e.push(a)}return e},e.prototype.GetAllWenShis=function(){var e=[],t=this.locate(21);if(null==t)return e;for(var n in t){var i=parseInt(n),a=this.items[i];e.push(a)}return e},e.prototype.GetGemItem=function(){var e=[],t=this.locate(5);if(null==t)return e;for(var n in t){var i=parseInt(n);e.push(this.items[i])}return e.sort(this.sortGemByClass),e},e.prototype.GetJueXueItem=function(e){var t=[],n=this.locate(11);if(null==n)return t;for(var i in n){var a=parseInt(i),r=this.items[a].Item;(0>=e||e==r.Part)&&t.push(this.items[a])}return t},e.prototype.sortGemByClass=function(e,t){var n=e.Item,i=t.Item;if(n.Genre!=i.Genre)return i.Genre-n.Genre;var a=n.DetailType,r=i.DetailType;if(5==n.Genre){var o=Math.floor(a/1e3),s=Math.floor(r/1e3),l=Math.floor(a%1e3),u=Math.floor(r%1e3);return l==u?2==o?-1:2==s?1:o-s:u-l}return r-a},e.prototype.GetMaterialItem=function(){var e=[];for(var t in this.material)for(var n in this.material[t]){var i=parseInt(n);e.push(this.items[i])}var a=42-e.length;if(a>0)for(var r=void 0,o=0;a>o;o++)e.push(r);return e.sort(this.sortGemByClass),e},e.prototype.sortEquipByFinghtingPower=function(e,t){var n=e.Item,i=t.Item;return n.Quality!=i.Quality?i.Quality-n.Quality:n.Part!=i.Part?n.Part-i.Part:i.MaxFightingPower-n.MaxFightingPower},e.prototype.findBagItem=function(e,t){if(0==e)return egret.error("no support"),null;var n=this.locate(e);if(null==n)return null;for(var i in n){var a=this.items[i].Item;if(a instanceof Item.Prop&&a.DetailType==t)return this.items[i];if(a instanceof Item.Book){if(a.Id==t)return this.items[i]}else if(a instanceof Item.JueXue&&a.Id==t)return this.items[i]}},e.prototype.findEquip=function(e,t,n){var i=[];for(var a in this.equips[e])if(this.equips[e][a]){var r=this.items[a].Item;if(!r)continue;r.Id==t&&r.Klass==n&&i.push(r)}return i},e.prototype.findItem=function(e,t){var n=[];if(0==e){var i=this.equips[t];null!=i&&n.push(Number(i))}else{var a=this.locate(e);if(null==a)return n;for(var i in a){var r=this.items[i].Item;r instanceof Item.Prop&&r.DetailType==t?n.push(Number(i)):r instanceof Item.Book?r.Id==t&&n.push(Number(i)):r instanceof Item.JueXue&&r.Id==t&&n.push(Number(i))}}return n},e.prototype.findItembyId=function(e){return null==this.items[e]?!1:!0},e.prototype.Clean=function(){this.items={},this.equips={},this.props={},this.material={},this.equipsSize=0,this.propsSize=0,this.otherSize=0,this.counts={}},e.prototype.CalcCount=function(e,t){return this.getCount(e,t)},e.prototype.GetItem=function(e){return this.items[e].Item},e.prototype.GetBagItem=function(e){return this.items[e]},e.prototype.GetItemCount=function(e){return this.items[e].Item.Count},e.prototype.UpdateItemCount=function(e,t){var n=this.items[e].Item.Count;this.items[e].Item.Count=t;var i=this.items[e].Item;this.addCount(i.Type,i.DetailType,t-n)},e.prototype.RemoveItem=function(t){var n=this.items[t],i=this.items[t].Item;if(delete this.items[t],0==i.Type){var a=i;this.equipsSize--,delete this.equips[a.Part][t],badge.onLight(badge.action.Smelting,!1)}else{var r=e.Page(i.Type);switch(r){case Game.BagPage.Prop:this.propsSize--,delete this.props[i.Type][t];break;case Game.BagPage.Material:this.otherSize--,delete this.material[i.Type][t];break;default:egret.error("unexpected genre="+i.Type)}switch(i.Type){case 0:case 6:case 11:case 21:break;default:var o=i;this.addCount(i.Type,o.DetailType,-o.Count)}}return n},e.prototype.UpdateItemExpiration=function(e,t){t&&this.items[e].Item instanceof Item.Prop&&this.items[e].Item.SetExpired()},e.MaxSize=100,e.propMaxSize=100,e.otherMaxSize=800,e.MinRoom4Tip=20,e}();__reflect(Bag.prototype,"Bag");var Item;!function(e){function t(t,n,i){var a;switch(t){case 5:a=new e.Gem;break;case 7:a=new e.BookDebris;break;default:a=new e.Prop}return a.Genre=t,a.DetailType=n,a.Count=i,a}function n(e){var n=(e.getId(),t(e.type,e.detailType,e.count));return n.ExpireTime=e.expireTime,n}var i=4294967295;e.makeProp2=t,e.makeProp=n;var a=function(){function t(){}return t.prototype.IsExpired=function(){return this.ExpireTime==i},t.prototype.SetExpired=function(){this.ExpireTime=i},t.prototype.GetExpiredDesc=function(){return 0==this.ExpireTime?null:this.IsExpired()?lang.String("expired"):lang.String("time limit")},t.prototype.GetExpiredIcon=function(){return 0==this.ExpireTime?null:this.IsExpired()?"ui/bag/overdue.png":"ui/bag/limit.png"},Object.defineProperty(t.prototype,"Icon",{get:function(){return table.props[this.Genre][this.DetailType].source},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Quality",{get:function(){return table.props[this.Genre][this.DetailType].quality},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Desc",{get:function(){var e=table.props[this.Genre][this.DetailType].desc;return this.IsExpired()?e=e+('\n<font color="'+egret.toColorString(16711680)+'">')+lang.String("itemExpired")+"</font>":this.ExpireTime>0&&(e=e+"\n"+lang.StringWithFormat("itemExpirationTime",FormatYYYYMMDDHHMM(this.ExpireTime))),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rawName",{get:function(){return table.props[this.Genre][this.DetailType].name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Name",{get:function(){var t=this.Quality;return null==t&&(t=0),'<font color="'+egret.toColorString(e.QualityColor[t])+'">'+table.props[this.Genre][this.DetailType].name+"</font>"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"operation",{get:function(){return table.props[this.Genre][this.DetailType].operation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"MaxStackCount",{get:function(){return table.props[this.Genre][this.DetailType].maxStackCount},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Type",{get:function(){return this.Genre},enumerable:!0,configurable:!0}),t.prototype.OpenBoxLackResource=function(e,t){var n=lang.String("operation confirm"),i=lang.StringWithFormat("open box need {1} go to get it or not",t);UI.ConfirmBox.Show(UI.ConfirmBoxStyle["default"],n,i,function(){return UI.ResourceObtain.Open([e]),!0},null,null)},t.prototype.Use=function(){if(this.Usable){var e=table.props[this.Genre][this.DetailType].params,t=1;if(null!=e){t=e.requireCount;var n=e.value.level||0;if(PlayerAttribute.Level<n)return void PopUpMessage.push(lang.StringWithFormat("require level {1}",n),color.Warning);if(null!=e.value.consumeType)if("item"==e.value.consumeType){var i=e.value.consumeValue[0],a=e.value.consumeValue[1],r=e.value.consumeValue[2],o=PlayerAttribute.bag.getCount(i,a);if(r>o&&null!=e.value.consumeResourceId)return void this.OpenBoxLackResource(e.value.consumeResourceId,e.value.consumeDesc)}else{for(var s=-1,l=0;l!=Game.currency2AwardType.length;l++)if(e.value.consumeType==Game.currency2AwardType[l]){s=l;break}if(-1==s)return;var u=e.value.consumeValue[0],c=PlayerAttribute.currency[s];if(s==Game.Currency.SilverCoin&&(c+=PlayerAttribute.currency[Game.Currency.GoldCoin]),u>c&&null!=e.value.consumeResourceId)return void this.OpenBoxLackResource(e.value.consumeResourceId,e.value.consumeDesc)}}Bag.Page(this.Genre)==Game.BagPage.Prop&&this.Count>1&&UI.UseItemStack.instance.selectNumer>1&&!this.manualuse&&1==t?PlayerAttribute.useItemStack(this.BagId,UI.UseItemStack.instance.selectNumer):PlayerAttribute.useItem(this.BagId)}},Object.defineProperty(t.prototype,"baseAttributeDesc",{get:function(){var e=table.props[this.Genre][this.DetailType].params;if(null!=e)switch(e.type){case"dailyAwardZhenqi":return Meridian.GetHuiXianDanDesc();case"composePartner":return Partner.GetComposePartnerDesc(this);case"award":var t=color.GREEN,n=e.value.level||0;if(0==n)return;return PlayerAttribute.Level<n&&(t=color.Warning),lang.StringWithFormat("use item require level {1}","<font color="+egret.toColorString(t)+">"+n+"</font>");case"paidAward":var i="",a="",r=e.value.level||0;if(r>0){var o=PlayerAttribute.Level>=r?color.GREEN:color.Warning;i=lang.StringWithFormat("use item require level {1}","<font color="+egret.toColorString(o)+">"+r+"</font>")}if("item"==e.value.consumeType){var s=e.value.consumeValue[0],l=e.value.consumeValue[1],u=e.value.consumeValue[2],c=PlayerAttribute.bag.getCount(s,l),h=c>=u?color.GREEN:color.Warning;a=lang.StringWithFormat("use item need paid {1}","<font color="+egret.toColorString(h)+">"+e.value.consumeDesc+"</font>")}else{for(var d=-1,p=0;p!=Game.currency2AwardType.length;p++)if(e.value.consumeType==Game.currency2AwardType[p]){d=p;break}if(-1==d)return;var g=e.value.consumeValue[0],m=PlayerAttribute.currency[d];d==Game.Currency.SilverCoin&&(m+=PlayerAttribute.currency[Game.Currency.GoldCoin]);var f=m>=g?color.GREEN:color.Warning;a=lang.StringWithFormat("use item need paid {1}","<font color="+egret.toColorString(f)+">"+e.value.consumeDesc+"</font>")}var v=i;return""!=v&&(v+="\n"+a),v;default:return}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Usable",{get:function(){var e=table.props[this.Genre][this.DetailType].params;if(null==e)return!0;switch(e.type){case"dailyAwardZhenqi":return Meridian.CheckUseHuiXianDan(this);case"composePartner":return Partner.CheckComposePartner(this,!1);case"firework":var t=Game.isCityHome()||!1,n="guild"==(table.maps[World.mapId].scene||"");return t||n;case"award":var i=e.requireCount||1,a=PlayerAttribute.bag.getCount(this.Genre,this.DetailType);return a>=i;default:return!0}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"manualuse",{get:function(){return 1==this.Genre?table.props[this.Genre][this.DetailType].manualuse||!1:!1},enumerable:!0,configurable:!0}),t.prototype.Marshal=function(){var e=new net.def.S2CItem;return e.type=this.Genre,e.detailType=this.DetailType,e.count=this.Count,e.expireTime=this.ExpireTime,e},t}();e.Prop=a,__reflect(a.prototype,"Item.Prop",["Item.IItem"])}(Item||(Item={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="CellSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.onTouchTap=function(){var t=e.ItemTips.instance;if(null!=this.data&&(null==this.data.forbidTip||!this.data.forbidTip)){var n=this.extractByLevel(this.data);null==n&&(n=this.data),"juexueInstance"==n.type?e.UseItemJueXue.instance.onOpenUI3(n.content.item.BagId):(t.desc=n.desc,t.data=n,UIManager.push(e.ItemTips.instance))}},n.prototype.onRefresh=function(){this.dataChanged()},Object.defineProperty(n.prototype,"AwardDesc",{get:function(){return this.dataChanged(),this.awardDesc},enumerable:!0,configurable:!0}),n.OnDataChanged=function(e){if(e.clearcell(),null!=e.data){var t=e.extractByLevel(e.data);null==t&&(t=e.data),e.light=e.data.light,e.awardDesc="";var n="<font color='{1}'>{2}</font>";switch(t.type){case"item":var i=table.props[t.content.genre][t.content.detailType];e.icon=i.source,e.UpdatePiecesIcon(t.content.genre),e.quality=i.quality;var a=table.props[t.content.genre][t.content.detailType].expireTime;null!=a&&(e.timelimit="ui/bag/limit.png"),null!=t.content.count?(e.rbcorner=""+t.content.count,e.awardDesc=lang.Format(n,egret.toColorString(Item.QualityColor[e.quality]),i.name+" x"+t.content.count)):e.awardDesc=lang.Format(n,egret.toColorString(Item.QualityColor[e.quality]),i.name),null!=t.content.rbcolor&&(e.rbcolor=t.content.rbcolor),20==t.content.genre?e.smallIcon=Wuxingyinmanager.GetWuxingshiSmallIcon(t.content.detailType):e.smallIcon="";break;case"partnerEquip":var r=table.partnerEquips[t.content.id];e.icon=r.source,e.quality=r.quality,e.ltCorner=lang.StringWithFormat("partnerequip {1} level",r.level),e.rbcorner=lang.StringWithFormat("partnerequip {1} star",t.content.star),e.awardDesc=lang.Format(n,egret.toColorString(Item.QualityColor[e.quality]),r.name);break;case"equipInstance":var o=t.content;e.icon=o.Icon,e.quality=o.Quality,e.rbcorner=lang.StringWithFormat("{1}level",o.Level),e.awardDesc=lang.Format(n,egret.toColorString(Item.QualityColor[e.quality]),o.Name);break;case"equip":var s=Item.EquipParsePart[t.content.part],l=t.content.id,u=Game.Faction[PlayerAttribute.faction],c=table.equips[s][l];e.icon=c[u].icon,e.rbcorner=lang.StringWithFormat("{1}level",c.level),null!=t.content.quality?e.quality=t.content.quality:e.quality=4,e.awardDesc=lang.Format(n,egret.toColorString(Item.QualityColor[e.quality]),c[u].name);break;case"partner":var h=t.content,d=Partner.GetPartnerCfg(h);e.icon=d.icon,e.quality=d.quality,e.rbcorner="",e.awardDesc=lang.Format(n,egret.toColorString(Item.QualityColor[d.quality]),d.name);break;case"clientitem":e.icon=t.icon,e.rbcorner=String(t.count),e.quality=t.quality,null!=t.plugin&&""!=t.plugin&&(e.plugin="ui/public/pieces_icon.png"),t.name&&(e.awardDesc=lang.Format(n,egret.toColorString(Item.QualityColor[e.quality]),t.name));break;case"exp":case"goldCoin":case"silverCoin":case"copperCoin":case"practiceCoin":case"arenaCoin":case"readingCoin":case"pith":case"guildContribution":case"jade":case"betCoin":case"collectCardExp":case"fubi":var p=new table.CurrencyAward(t.type,t.content);e.icon=p.icon,e.quality=p.quality,e.rbcorner=String(p.content||""),e.awardDesc=p.getDesc(null);break;case"collecttreasurecard":var g=activityCollectTreasure.getCardConfig();e.icon=g.icon,e.quality=g.quality,e.rbcorner=t.content,e.awardDesc=lang.Format(n,egret.toColorString(Item.QualityColor[e.quality]),lang.String("unattunedcard")+" x"+t.content);break;case"juexueInstance":var m=t.content.item;e.icon=m.Icon,e.quality=m.Quality,e.lbcorner=m.Level>0?"+"+m.Level:"",e.jxFontNote=m.FontNoteIcon,e.awardDesc=m.Name;break;case"jxBook15Turntable":var f=new table.JxBook15Turntable(t.type,t.content);e.icon=f.icon,e.quality=f.quality,e.rbcorner=String(f.content||""),e.awardDesc=f.getDesc(null);break;case"wenshiInstance":var v=t.content;e.icon=v.Icon,e.quality=v.Quality,e.awardDesc=v.Name;break;case"globalwheelCurrency":e.icon=Game.currency2Icon[t.content.type],e.quality=5,e.rbcorner=t.content.percentage+"%",e.awardDesc="Trong kho thưởng toàn server "+lang.String(Game.currency2AwardType[t.content.type])+"-"+e.rbcorner;break;default:egret.error("unkown award cell type")}}},n.prototype.dataChanged=function(){n.OnDataChanged(this)},n.prototype.onRemoveFromStage=function(){this.clearcell()},n.prototype.clearcell=function(){this.icon="",this.quality=null,this.rbcorner="",this.plugin="",this.smallIcon="",this.light=null,Game.removeFromParent.apply(this.qualityMovie)},n.prototype.extractByLevel=function(e){switch(e.type){case"levelaward":var t=PlayerAttribute.Level;if(null==e.content[t]&&(t-=t%10),null!=e.content[t])return e.content[t]}return null},n}(e.Cell);e.AwardCell=t,__reflect(t.prototype,"UI.AwardCell")}(UI||(UI={}));var badge;!function(e){function t(t,n,i,a,r){e.dispatcher.addEventListener(G[t],n,i,a,r)}function n(t,n,i,a){e.dispatcher.removeEventListener(G[t],n,i,a)}function i(t){e.dispatcher.dispatchEventWith(G[t])}function a(){var t=MakeDelayExecute(function(){if(""==Player.instance.guildName)return void l(G.SendRedPacket,!1);if(RedPacket.times>=RedPacket.DailyTimes)return void l(G.SendRedPacket,!1);for(var e in RedPacket.taskRedPackets)if(RedPacket.taskRedPackets[e].count>0)return void l(G.SendRedPacket,!0);l(G.SendRedPacket,!1)},null,100);Game.dispatcher.addEventListener(Game.EVENT.TaskRedPacketChange,t,null),Game.dispatcher.addEventListener(Game.EVENT.GuildWelcome,t,null),Game.dispatcher.addEventListener(Game.EVENT.GuildQuit,t,null),Game.dispatcher.addEventListener(Game.EVENT.UpdateSkill,function(){PlayerAttribute.skillpoint>0&&PlayerAttribute.Level>=5?l(G.AddSkillPoint,!0):l(G.AddSkillPoint,!1)},null),Game.dispatcher.addEventListener(Game.EVENT.AbilityPoint,function(){PlayerAttribute.abilitypoint>0?l(G.AddAbilityPoint,!0):l(G.AddAbilityPoint,!1)},null),Game.dispatcher.addEventListener(Game.EVENT.BagFull,function(e){l(G.Smelting,!0)},null),Game.dispatcher.addEventListener(Game.EVENT.MailNewArrival,function(e){l(G.MailNewArrival,!0)},null),Game.dispatcher.addEventListener(Game.EVENT.AddItem,function(e){r(e),u(e),d(e),o(e),C(e),c(e),h()},null),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,function(e){r(e),d(e),u(e),o(e),C(e),c(e),h()},null),Game.dispatcher.addEventListener(Game.EVENT.RemoveItem,function(e){d(e),r(e),o(e),C(e),c(e),h()},null),Game.dispatcher.addEventListener(Game.EVENT.BagItemChange,function(){h()},null),Game.dispatcher.addEventListener(Game.EVENT.DailyMarkAward,function(e){e.data.signed||l(G.DailyMarkAward,!0)},null),Game.dispatcher.addEventListener(Game.EVENT.SeaSunData,function(){PlayerAttribute.Level>=SeaSunVillage.Level&&(SeaSunVillage.curTimes>0?l(G.SeaSunVillage,!0):l(G.SeaSunVillage,!1))},null),Game.dispatcher.addEventListener(Game.EVENT.CurrencyChange[Game.Currency.Reading],function(e){w()},null),Game.dispatcher.addEventListener(Game.EVENT.CurrencyChange[Game.Currency.Zhenqi],function(){L()},null),Game.dispatcher.addEventListener(Game.EVENT.CurrencyChange[Game.Currency.GuildContribution],function(){e.onLightGuildGarden()},null),Game.dispatcher.addEventListener(Game.EVENT.MeridiansUpgrade,function(){L()},null),Game.dispatcher.addEventListener(Game.EVENT.CurrencyChange[Game.Currency.CopperCoin],function(){k(),w(),R()},null),Game.dispatcher.addEventListener(Game.EVENT.BooksChange,function(){for(var t=0;t<Game.BookCategory;t++){var n=PlayerAttribute.books[t];null!=n&&l(e.BookLevelUp[n.category],n.canLevelUp()||n.canUpgrade())}},null)}function r(e){var t=e.data.Item;2==t.Type&&k()}function o(e){var t=e.data.Item;13==t.Type&&P()}function s(){PlayerAttribute.abilitypoint>0&&l(G.AddAbilityPoint,!0),PlayerAttribute.skillpoint>0&&PlayerAttribute.Level>=5&&l(G.AddSkillPoint,!0)}function l(t,n){Game.isCrossServer()||e.blackboard[t]!=n&&(e.blackboard[t]=n,i(t))}function u(t){var n=t.data.Item;if(6==n.Type){var i=n;i.Quality>PlayerAttribute.books[i.category].Quality?l(e.BookChange[i.category],!0):l(e.BookChange[i.category],!1)}if(7==n.Type){var a=n,i=table.books[a.DetailType],r=PlayerAttribute.books[i.category],o=table.bookCost.crafting[i.quality];null==r?PlayerAttribute.bag.CalcCount(7,i.id)>=o&&l(e.BookChange[i.category],!0):i.quality>r.Quality?PlayerAttribute.bag.CalcCount(7,i.id)>=o&&l(e.BookChange[i.category],!0):r.canUpgrade()&&l(e.BookLevelUp[i.category],!0)}}function c(e){var t=e.data.Item;t.Genre==GuildWarMatchScene.donateG&&t.DetailType==GuildWarMatchScene.donateD&&GuildWarMatchScene.CheckBadge()}function h(){for(var t=!1,n=0;n<Item.JueXuePartsCount;n++){var i=PlayerAttribute.juexues[n+1],a=PlayerAttribute.bag.GetJueXueItem(n+1);if(null==i)a.length>0?(l(e.JueXueCell[n],!0),t=!0):l(e.JueXueCell[n],!1);else{for(var r=!1,o=0;o<a.length;o++){var s=a[o].Item;if(s.FightingPower>i.FightingPower){r=!0;break}}r?(l(e.JueXueCell[n],!0),t=!0):l(e.JueXueCell[n],!1)}}l(G.JueXue,t)}function d(e){var t=e.data.Item;5==t.Genre&&PlayerGem.CheckGemBadge()}function p(e,t){switch(e){case 0:l(G.PartnerEnlistCoin,t);break;case 1:l(G.PartnerEnlistGold,t)}}function g(e){var t=e.Item;if(8==t.Genre){if(null!=Partner.idMap[t.DetailType])return;var n=PlayerAttribute.bag.CalcCount(8,t.DetailType),i=Partner.composeCost[t.Quality];return void(n>=i&&l(G.PartnerComPose,!0))}return 9==t.Genre&&2==t.DetailType?void _():void 0}function m(e){if(b()&&14==e.Item.Type){var t=e.Item;PartnerEquipManager.IsPatnerEquipMaterial(t.Genre,t.DetailType)&&f()}}function f(){if(b())for(var e=0;e!=PartnerEquipManager.partnerEquipList.length;e++){var t=PartnerEquipManager.partnerEquipList[e],n=t.getId(),i=t.getStar();if(!(0>=n)){var a=PartnerEquipManager.GetMaxStar(n);if(!(i>=a)){var r=PartnerEquipManager.GetUpgradeStarCost(n,i),o=PartnerEquipManager.GetMaterialGD(r[0].type,n),s=o[0],u=o[1],c=r[0].num[i],h=PlayerAttribute.GetItemCount(s,u);if(!(c>h)){var d=PartnerEquipManager.GetMaterialGD(r[1].type,n),p=d[0],g=d[1],m=r[1].num[i],f=PlayerAttribute.GetItemCount(p,g);if(!(m>f))return l(G.PartnerEquip,!0),!0}}}}}function v(e){if(b()&&16==e.Item.Type)for(var t=e.Item,n=PartnerEquipManager.GetPartnerEquipInfo(t.id),i=n.part,a=n.level,r=n.weight,o=0;o!=Partner.maxWorkPartnerCnt;o++){var s=Partner.GetWorkPartnerObj(o+1);if(null!=s){var u=PartnerEquipManager.GetPartnerEquipLevelLimit(o);if(!(a>u)){var c=i+o*PartnerEquipManager.PARTNEREQUIP_EACHPARTNERCOUNT,h=0,d=PartnerEquipManager.partnerEquipList[c];if(d.getId()>0){var p=PartnerEquipManager.GetPartnerEquipInfo(d.getId());h=p.weight}if(0==h||r>h)return void l(G.PartnerEquip,!0)}}}}function y(){U=egret.getTimer()+500,l(G.PartnerEquip,!1)}function b(){return egret.getTimer()>=U}function S(){if(b())for(var e=0;e!=Partner.maxWorkPartnerCnt;e++){var t=Partner.GetWorkPartnerObj(e+1);if(null==t)return;for(var n=PartnerEquipManager.GetPartnerEquipLevelLimit(e),i=0;i!=PartnerEquipManager.PARTNEREQUIP_EACHPARTNERCOUNT;i++){var a=PlayerAttribute.bag.GetPartnerEquip(i);if(!(a.length<=0)){var r=e*PartnerEquipManager.PARTNEREQUIP_EACHPARTNERCOUNT+i,o=0,s=0,u=PartnerEquipManager.partnerEquipList[r];if(null!=u){if(u.id>0){var c=PartnerEquipManager.GetPartnerEquipInfo(u.id);o=c.level,s=c.weight}for(var h=0;h!=a.length;h++){var d=a[h].Item,p=PartnerEquipManager.GetPartnerEquipInfo(d.id);if(!(p.level>n||s>=p.weight))return void l(G.PartnerEquip,!0)}}}}}}function E(){for(var t=PlayerAttribute.Level,n=PlayerAttribute.bag.CalcCount(9,2)*Partner.partnerItemExp,i=0;i<Partner.workList.length;i++)if(Partner.workList[i]>0){var a=Partner.GetPartnerObj(Partner.workList[i]);a.level<t&&a.exp+n>=table.partnerExp[a.level-1].exp&&l(e.PartnerSockets[i],!0)}}function C(e){var t=e.data.Item;15==t.Type&&x()}function T(){Game.isCrossServer()||M()}function I(t){var n=t.Item;if(Setting.AutoSellEquip()&&Setting.Smelt(n.Quality))return!1;var i=PlayerAttribute.Equips[n.Part];return null==i||i.Level<SwapAttribute.MinLevel||n.Level<SwapAttribute.MinLevel||i.Quality<n.Quality?!1:void l(e.SwapAttributeParts[n.Part],!0)}var G;!function(e){e[e.AddAbilityPoint=0]="AddAbilityPoint",e[e.AddSkillPoint=1]="AddSkillPoint",e[e.Smelting=2]="Smelting",e[e.AutoEquip=3]="AutoEquip",e[e.SendRedPacket=4]="SendRedPacket",e[e.MapSwicth=5]="MapSwicth",e[e.Enhance=6]="Enhance",e[e.OpeningGrouponAward=7]="OpeningGrouponAward",e[e.DailyMarkAward=8]="DailyMarkAward",e[e.AuctionQin=9]="AuctionQin",e[e.MasterChallenge=10]="MasterChallenge",e[e.ArenaChallenge=11]="ArenaChallenge",e[e.RewardRetrieve=12]="RewardRetrieve",e[e.LittleBoss=13]="LittleBoss",e[e.SeaSunVillage=14]="SeaSunVillage",e[e.AuctionGuildWar=15]="AuctionGuildWar",e[e.GuildGarden=16]="GuildGarden",e[e.WelfareFunding=17]="WelfareFunding",e[e.ActivityAward1=18]="ActivityAward1",e[e.ActivityAward2=19]="ActivityAward2",e[e.ActivityAward3=20]="ActivityAward3",e[e.ActivityAward4=21]="ActivityAward4",e[e.MailNewArrival=22]="MailNewArrival",e[e.MeridianUpdate=23]="MeridianUpdate",e[e.LevelUpSeasunTitle=24]="LevelUpSeasunTitle",e[e.LevelUpFactionTitle=25]="LevelUpFactionTitle",e[e.TaoHuaIsland=26]="TaoHuaIsland",e[e.BookLevelUp1=27]="BookLevelUp1",e[e.BookLevelUp2=28]="BookLevelUp2",e[e.BookLevelUp3=29]="BookLevelUp3",e[e.BookLevelUp4=30]="BookLevelUp4",e[e.FriendApply=31]="FriendApply",e[e.JueXue=32]="JueXue",e[e.TenFoldExpTime=34]="TenFoldExpTime",e[e.UseItemBox=35]="UseItemBox",e[e.OfflineAward=36]="OfflineAward",e[e.GuildNewApplication=37]="GuildNewApplication",e[e.AuctionCrossBoss=38]="AuctionCrossBoss",e[e.AuctionSelf=39]="AuctionSelf",e[e.AuctionTitle=40]="AuctionTitle",e[e.AuctionGem=41]="AuctionGem",e[e.AuctionBookDebris=42]="AuctionBookDebris",e[e.PartnerEnlistCoin=43]="PartnerEnlistCoin",e[e.PartnerEnlistGold=44]="PartnerEnlistGold",e[e.SevenGift=45]="SevenGift",e[e.BookChange1=46]="BookChange1",e[e.BookChange2=47]="BookChange2",e[e.BookChange3=48]="BookChange3",e[e.BookChange4=49]="BookChange4",e[e.WeeklyCard=50]="WeeklyCard",e[e.MonthlyCard=51]="MonthlyCard",e[e.VipPrivilegeBox=52]="VipPrivilegeBox",e[e.BookSkillSelf=54]="BookSkillSelf",e[e.PartnerComPose=55]="PartnerComPose",e[e.PartnerUpgrage=56]="PartnerUpgrage",e[e.ActivedEquipMake=57]="ActivedEquipMake",e[e.Dungeon_CatchThief=58]="Dungeon_CatchThief",e[e.Dungeon_FerryBoat=59]="Dungeon_FerryBoat",e[e.PartnerSocket1=60]="PartnerSocket1",e[e.PartnerSocket2=61]="PartnerSocket2",e[e.PartnerSocket3=62]="PartnerSocket3",e[e.GemMountSelf=63]="GemMountSelf",e[e.WildBossTip1=64]="WildBossTip1",e[e.MoneyTree=65]="MoneyTree",e[e.PartnerSocket4=66]="PartnerSocket4",e[e.AuctionPartnerPieces=67]="AuctionPartnerPieces",e[e.AuctionBox=68]="AuctionBox",e[e.LevelUpGift=69]="LevelUpGift",e[e.AuctionCrystal=70]="AuctionCrystal",e[e.SuperWeaponTip=71]="SuperWeaponTip",e[e.WildBossTip2=72]="WildBossTip2",e[e.EquipMaking=73]="EquipMaking",e[e.AuctionEnabled=74]="AuctionEnabled",e[e.AuctionAvatar=75]="AuctionAvatar",e[e.AuctionWeaponPieces=76]="AuctionWeaponPieces",e[e.YanemperorLogin=77]="YanemperorLogin",e[e.AuctionGlobalOther=78]="AuctionGlobalOther",e[e.DailyRechargeAward=79]="DailyRechargeAward",e[e.WulinLiansai=80]="WulinLiansai",e[e.ActiveRechargeAward=81]="ActiveRechargeAward",e[e.ActiveConsumptionAward=82]="ActiveConsumptionAward",e[e.ActivedSwapAttribute=83]="ActivedSwapAttribute",e[e.CollectTreasureIdentify=84]="CollectTreasureIdentify",e[e.CollectTreasureAmountAward=85]="CollectTreasureAmountAward",e[e.Recharge7DayAward=86]="Recharge7DayAward",e[e.FortunelPlanGold=87]="FortunelPlanGold",e[e.FortunelPlanSilver=88]="FortunelPlanSilver",e[e.AvatarLevelUp=92]="AvatarLevelUp",e[e.PartnerEquip=94]="PartnerEquip",e[e.AuctionBaiShiBi=95]="AuctionBaiShiBi",e[e.AuctionChengZhuangTuPu=96]="AuctionChengZhuangTuPu",e[e.LoginGift=97]="LoginGift",e[e.GrouponBuy=98]="GrouponBuy",e[e.WeekendRecruit=99]="WeekendRecruit",e[e.BuyRefund=102]="BuyRefund",e[e.SwapAttributePart0=103]="SwapAttributePart0",e[e.SwapAttributePart1=104]="SwapAttributePart1",e[e.SwapAttributePart2=105]="SwapAttributePart2",e[e.SwapAttributePart3=106]="SwapAttributePart3",e[e.SwapAttributePart4=107]="SwapAttributePart4",e[e.SwapAttributePart5=108]="SwapAttributePart5",e[e.SwapAttributePart6=109]="SwapAttributePart6",e[e.SwapAttributePart7=110]="SwapAttributePart7",e[e.CollectCardActiveKind1=111]="CollectCardActiveKind1",e[e.CollectCardActiveKind2=112]="CollectCardActiveKind2",e[e.CollectCardActiveKind3=113]="CollectCardActiveKind3",e[e.CollectCardUpgradeStarKind1=114]="CollectCardUpgradeStarKind1",e[e.CollectCardUpgradeStarKind2=115]="CollectCardUpgradeStarKind2",e[e.CollectCardUpgradeStarKind3=116]="CollectCardUpgradeStarKind3",e[e.CollectCardUpgradeLevelKind1=117]="CollectCardUpgradeLevelKind1",e[e.CollectCardUpgradeLevelKind2=118]="CollectCardUpgradeLevelKind2",e[e.CollectCardUpgradeLevelKind3=119]="CollectCardUpgradeLevelKind3",e[e.JueXueCell1=120]="JueXueCell1",e[e.JueXueCell2=121]="JueXueCell2",e[e.JueXueCell3=122]="JueXueCell3",e[e.JueXueCell4=123]="JueXueCell4",e[e.JueXueCell5=124]="JueXueCell5",e[e.JueXueCell6=125]="JueXueCell6",e[e.JxBook15=126]="JxBook15",e[e.YesouTaskAward=2005]="YesouTaskAward",e[e.YesouTaskPhaseAward=2006]="YesouTaskPhaseAward",e[e.GuildWarSignup1=2101]="GuildWarSignup1",e[e.GuildWarSignup2=2102]="GuildWarSignup2",e[e.GuildWarSignup3=2103]="GuildWarSignup3",e[e.GuildWarSignup4=2104]="GuildWarSignup4",e[e.GuildWarBattle=2105]="GuildWarBattle",e[e.GuildWarDonate=2106]="GuildWarDonate",e[e.GuildArmamentChangeAward=2107]="GuildArmamentChangeAward",e[e.GuildWar2Battle=2108]="GuildWar2Battle",e[e.GemAutoMount=2201]="GemAutoMount",e[e.GemAutoUpgrade=2202]="GemAutoUpgrade",e[e.DoubleEggs=2203]="DoubleEggs",e[e.HeroicCardAward=2204]="HeroicCardAward",e[e.HeroicCardTaskFinish=2205]="HeroicCardTaskFinish",e[e.FirstChargeGift=2206]="FirstChargeGift",e[e.MonthlyActCanAchieveTarget=2207]="MonthlyActCanAchieveTarget",e[e.MonthlyActCanAchieveCountTask=2208]="MonthlyActCanAchieveCountTask",e[e.Babel=2209]="Babel",e[e.HuashanPKDailyAward=2210]="HuashanPKDailyAward",e[e.CompositeSevenDayGift=2211]="CompositeSevenDayGift",e[e.CompositeGrouponAward=2212]="CompositeGrouponAward",e[e.Bet=2213]="Bet",e[e.GuildDungeonOpen=2214]="GuildDungeonOpen",e[e.GuildDungeonCanOpen=2215]="GuildDungeonCanOpen",e[e.NienBoss=2216]="NienBoss",e[e.LotteryTicket=2217]="LotteryTicket",e[e.Refine=2218]="Refine",e[e.Rune1=2219]="Rune1",e[e.Rune2=2220]="Rune2",e[e.Rune3=2221]="Rune3",e[e.Rune4=2222]="Rune4",e[e.Wuxingyin=2223]="Wuxingyin",e[e.PartnerEquipEnhance0=2224]="PartnerEquipEnhance0",e[e.PartnerEquipEnhance1=2225]="PartnerEquipEnhance1",e[e.PartnerEquipEnhance2=2226]="PartnerEquipEnhance2",e[e.PartnerEquipEnhance3=2227]="PartnerEquipEnhance3",e[e.BravePalaceActivated=2228]="BravePalaceActivated",e[e.ConsignmentTimeout=2229]="ConsignmentTimeout",e[e.ConsignmentFetchMoney=2230]="ConsignmentFetchMoney",e[e.PartnerQingyiUnlockGroup=2231]="PartnerQingyiUnlockGroup",e[e.PartnerQingyiSkillLevelup=2232]="PartnerQingyiSkillLevelup",e[e.SmashEggs=2233]="SmashEggs",e[e.DoubleEggsCardAwad=2234]="DoubleEggsCardAwad",e[e.TreasureBowl=2235]="TreasureBowl",e[e.GlobalWheel=2236]="GlobalWheel",e[e.GlobalLuckWheel=2237]="GlobalLuckWheel"
}(G=e.action||(e.action={})),e.SwapAttributeParts=[G.SwapAttributePart0,G.SwapAttributePart1,G.SwapAttributePart2,G.SwapAttributePart3,G.SwapAttributePart4,G.SwapAttributePart5,G.SwapAttributePart6,G.SwapAttributePart7],e.GuildWarSignup=[G.GuildWarSignup1,G.GuildWarSignup2,G.GuildWarSignup3,G.GuildWarSignup4],e.PartnerSockets=[G.PartnerSocket1,G.PartnerSocket2,G.PartnerSocket3,G.PartnerSocket4],e.BookLevelUp=[G.BookLevelUp1,G.BookLevelUp2,G.BookLevelUp3,G.BookLevelUp4],e.BookChange=[G.BookChange1,G.BookChange2,G.BookChange3,G.BookChange4],e.ActivityAwardAction=[G.ActivityAward1,G.ActivityAward2,G.ActivityAward3,G.ActivityAward4],e.DungeonHallAction=[-1,G.Dungeon_CatchThief,G.Dungeon_FerryBoat],e.LightOnce_OnLogin=[],e.LightOnce_OnLogin_Ret=[Recharge.haveDailyGiftCanBuy],e.JueXueCell=[G.JueXueCell1,G.JueXueCell2,G.JueXueCell3,G.JueXueCell4,G.JueXueCell5,G.JueXueCell6],e.blackboard={},e.dispatcher=new egret.EventDispatcher,e.addEventListener=t,e.removeEventListener=n,e.dispatchEventWith=i;var A=function(i){function a(){var e=i.call(this)||this;return e.actions=[],e.source="ui/public/reddot.png",e.height=20,e.width=20,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.touchEnabled=!1,e}return __extends(a,i),a.prototype.onAddToStage=function(){this.dataChanged(),this.regEvent()},a.prototype.regEvent=function(){for(var e=0;e<this.actions.length;e++)t(this.actions[e],this.dataChanged,this)},Object.defineProperty(a.prototype,"action",{set:function(e){if(this.actions.length>0&&(this.unregEvent(),this.actions=[]),null==e||""==e)return void(this.visible=!1);var t=e.split(",");for(var n in t)this.actions.push(parseInt(t[n]));this.visible=this.active,this.regEvent()},enumerable:!0,configurable:!0}),a.prototype.unregEvent=function(){for(var e=0;e<this.actions.length;e++)n(this.actions[e],this.dataChanged,this)},a.prototype.onRemoveFromStage=function(){this.unregEvent()},a.prototype.dataChanged=function(){this.visible=this.active},Object.defineProperty(a.prototype,"active",{get:function(){for(var t=0;t<this.actions.length;t++)if(1==e.blackboard[this.actions[t]])return!0;return!1},set:function(t){for(var n=0;n<this.actions.length;n++)e.blackboard[this.actions[n]]=t;this.dataChanged()},enumerable:!0,configurable:!0}),a}(eui.Image);e.Image=A,__reflect(A.prototype,"badge.Image"),e.init=a;var k=MakeDelayExecute(function(){l(G.LevelUpFactionTitle,FactionTitle.LevelUpReddot())},null,350),P=MakeDelayExecute(function(){l(G.SuperWeaponTip,SuperWeapon.canShowReddot())},null,350);e.playerBadge=s,e.onLight=l;var w=MakeDelayExecute(function(){for(var t=0;t<Game.BookCategory;t++){var n=PlayerAttribute.books[t];null!=n&&l(e.BookLevelUp[n.category],n.canLevelUp()||n.canUpgrade())}},null,400),L=MakeDelayExecute(function(){var e=table.meridian.cost[Meridian.grade*Meridian.MaxMeridians+Meridian.id],t=!1;PlayerAttribute.currency[Game.Currency.Zhenqi]>=e&&Meridian.level<Meridian.MaxLevel&&(t=!0),l(G.MeridianUpdate,t)},null,500);e.checkGuildWar=c,e.checkGemMount=d;var R=MakeDelayExecute(function(){PlayerGem.CheckGemBadge()},null,1500);e.onLightPartnerEnlist=p,e.checkPartner=g,e.checkPartnerEquipOnNewMaterial=m,e.checkPartnerEquipOnNewEquip=v;var U=0;e.closePartnerEquipBadge=y,e.checkPartnerEquipOnWorkPartner=S;var _=MakeDelayExecute(E,null,100),x=MakeDelayExecute(function(){l(G.AvatarLevelUp,Avatar.canShowReddot())},null,350);e.login=T;var M=MakeDelayExecute(function(){for(var t=0;t<e.LightOnce_OnLogin.length;t++)l(e.LightOnce_OnLogin[t],e.LightOnce_OnLogin_Ret[t]());f(),S()},null,3e3);e.onLightGuildGarden=MakeDelayExecute(function(){var e=!1;PlayerAttribute.currency[Game.Currency.GuildContribution]>=PrizeWheel.cost&&PrizeWheel.countLimit-PrizeWheel.UsedCount>0&&(e=!0),l(G.GuildGarden,e)},null,350),e.checkSwapAttribute=I}(badge||(badge={}));var Ticker=function(){function e(e){this.timer=new egret.Timer(e,0)}return e.prototype.addEventListener=function(e,t){return this.timer.running||this.timer.start(),this.timer.addEventListener(egret.TimerEvent.TIMER,e,t)},e.prototype.removeEventListener=function(e,t){this.timer.removeEventListener(egret.TimerEvent.TIMER,e,t),!this.timer.willTrigger(egret.TimerEvent.TIMER)&&this.timer.running&&this.timer.stop()},e.prototype.start=function(){this.timer.willTrigger(egret.TimerEvent.TIMER)&&!this.timer.running&&this.timer.start()},e.prototype.stop=function(){this.timer.stop()},e}();__reflect(Ticker.prototype,"Ticker");var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.speedUpTime=2,e.speedCutTime=2,e.maxSpeed=1080,e.uniformSpeedTime=0,e.offset=165,e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.timer=new egret.Timer(50,-1),e.timer.addEventListener(egret.TimerEvent.TIMER,e.onTimer,e),e}return __extends(n,t),n.prototype.onCurrencyChanged=function(){this.currency=this.getCurrency()},n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);for(var e=this.wheel.numChildren,n=0;e>n;n++){var i=this.wheel.getChildAt(n);i.data=this.getCell(n)}e=this.tag.numChildren;for(var n=0;e>n;n++){var i=this.tag.getChildAt(n);i.source=this.getCellTag(n)}},n.prototype.getCurrentSpeed=function(){return this.usedTime<this.speedUpTime?this.usedTime*(this.maxSpeed/this.speedUpTime):null!=this.result?this.maxSpeed:this.usedTime<this.speedUpTime+this.uniformSpeedTime||null==!this.result?this.maxSpeed:this.maxSpeed-this.usedTime*(this.maxSpeed/this.speedUpTime)},n.prototype.onNotifyResult=function(e){var t=e.data,n=t.length;n>0&&(this.result=t[n-1]),this.startAngle=this.pointer.rotation;var i=0,a=30*this.result-this.offset,r=0;this.usedTime<this.speedUpTime?(i=(this.getCurrentSpeed()+this.maxSpeed)*(this.speedUpTime-this.usedTime)/2,r=this.maxSpeed/this.speedUpTime*this.usedTime*this.usedTime/2):(r=this.maxSpeed/this.speedUpTime*this.speedUpTime*this.speedUpTime/2,this.usedTime=this.speedUpTime),this.startAngle-=r;var o=this.maxSpeed*this.speedCutTime/2,s=a-this.startAngle-r-i-o;s+=1800,this.uniformSpeedTime=s/this.maxSpeed},n.prototype.startRoll=function(e){if(!Player.instance.dead&&!this.timer.running&&null==this.result){var t=this.getCost(e);return PlayerAttribute.currency[Game.Currency.GoldCoin]<t?void Recharge.openRechargeUI():void(this.roll(e)&&(this.light.visible=!1,this.usedTime=0,this.startAngle=this.pointer.rotation,this.timer.reset(),this.timer.start()))}},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnRoll:this.startRoll(!1);break;case this.btnRoll10:this.startRoll(!0);break;case this.btnRules:var n=new e.Rule;n.skinName="HolidayWheelRuleSkin",UIManager.push(n);break;case this.btnWheelShop:this.onTapShop()}},n.prototype.getCell=function(e){return null},n.prototype.getCellTag=function(e){return null},n.prototype.getCurrency=function(){return 0},n.prototype.getCost=function(e){return 0},n.prototype.roll=function(e){return!1},n.prototype.draw=function(){},n.prototype.onTapShop=function(){},n.prototype.onTimer=function(){var e=.05;this.usedTime+=e;var t=0,n=this.usedTime;if(n>this.speedUpTime&&(n=this.speedUpTime),t+=this.maxSpeed/this.speedUpTime*n*n/2,this.usedTime>this.speedUpTime){var n=this.usedTime-this.speedUpTime;n>=this.uniformSpeedTime&&null!=this.result&&(n=this.uniformSpeedTime),t+=this.maxSpeed*n}var i=!1;if(null!=this.result&&this.usedTime>this.speedUpTime+this.uniformSpeedTime){var n=this.usedTime-(this.speedUpTime+this.uniformSpeedTime);n>this.speedCutTime&&(n=this.speedCutTime,i=!0),t+=this.maxSpeed*n-this.maxSpeed/this.speedCutTime*n*n/2}this.pointer.rotation=(t+this.startAngle)%360,i&&(this.draw(),this.light.rotation=this.pointer.rotation+165+149.7,this.light.visible=!0,this.result=null,this.timer.stop())},n}(eui.Component);e.BasePrizeWheel=t,__reflect(t.prototype,"UI.BasePrizeWheel",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.icon="",t.skillId=-1,t.shap=new egret.Shape,t.touchCaptured=!1,t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onClick,t),t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,t.onTouchBegin,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.skillId=-1,t}return __extends(t,e),t.prototype.onTouchBegin=function(e){this.skillId<0||PlayerAttribute.canCastSkill(this.skillId)&&(this.stage.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchCancle,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onStageTouchEnd,this),this.touchCaptured=!0,e.updateAfterEvent())},t.prototype.onStageTouchEnd=function(e){var t=e.currentTarget;t.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchCancle,this),t.removeEventListener(egret.TouchEvent.TOUCH_END,this.onStageTouchEnd,this),this.touchCaptured=!1,this.invalidateState()},t.prototype.onTouchCancle=function(e){var t=e.$currentTarget;t.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchCancle,this),t.removeEventListener(egret.TouchEvent.TOUCH_END,this.onStageTouchEnd,this),this.touchCaptured=!1},t.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.onPlayerInited,this.updateSkillId,this),Game.dispatcher.addEventListener(Game.EVENT.PartnerWorkPosChange,this.updateSkillId,this),null!=this.timerId&&egret.clearInterval(this.timerId),this.updateSkillId(),this.timerId=egret.setInterval(this.animationUpdateHandler,this,100)},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.onPlayerInited,this.updateSkillId,this),Game.dispatcher.removeEventListener(Game.EVENT.PartnerWorkPosChange,this.updateSkillId,this),null!=this.timerId&&(egret.clearInterval(this.timerId),this.timerId=null)},t.prototype.updateSkillId=function(){return-1==this.skillId?(this.skillId=PlayerAttribute.getRageSkillId(),this.icon="",null!=Skill.mapSkill[this.skillId]&&(this.icon=Skill.mapSkill[this.skillId].icon),void this.drawCDMask()):(this.icon=Skill.mapSkill[this.skillId].icon,void this.drawCDMask())},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this);this.width/2;this.addChild(this.shap),this.thumb.mask=this.shap,this.updateSkillId()},t.prototype.drawCDMask=function(){if(this.skillId<0)return!1;var e=PlayerAttribute.getCDPercent(this.skillId);if(0>=e&&(e=0),this.rate==e)return!0;this.rate=e,e>0?this.thumb.visible=!0:this.thumb.visible=!1;var t=this.width/2;return this.shap.graphics.clear(),0==e?!1:(this.shap.graphics.beginFill(0),this.shap.graphics.moveTo(t,t),this.shap.graphics.drawArc(t,t,t,Math.PI+Math.PI/2,Math.PI+Math.PI/2-2*Math.PI*e/100,!0),this.shap.graphics.lineTo(t,t),this.shap.graphics.endFill(),!0)},t.prototype.animationUpdateHandler=function(){0==this.drawCDMask()&&null!=this.thumb&&(this.thumb.visible=!1)},t.prototype.onClick=function(e){var t=Player.instance;return null==t?!1:void t.tryCastSkill(this.skillId)},t}(eui.Component);e.BaseSkillButton=t,__reflect(t.prototype,"UI.BaseSkillButton",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.content.text=this.orgContentMsg},t.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:case this.btnCancel:case this.btnClose:UIManager.pop(this);break;case this.btnOK:this.onOK()}},t}(e.FitComponent);e.ShopPrompt=t,__reflect(t.prototype,"UI.ShopPrompt",["eui.UIComponent","egret.DisplayObject"]);var n=function(e){function t(){var t=e.call(this)||this;return t.skinName="SilverCoinPromptSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:case this.btnCancel:UIManager.pop(this);break;case this.btnOK:this.cb(this.toggle.selected)}},t}(e.FitComponent);e.SliverCoinPrompt=n,__reflect(n.prototype,"UI.SliverCoinPrompt");var i=function(e){function t(t){var n=e.call(this)||this;return n.skinName="ConfirmBoxSkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.data=t,n.title=lang.String("not enough silvercoin"),n.orgContentMsg=lang.StringWithFormat("if replace {1} silver with gold",n.data.currentPrice-PlayerAttribute.currency[Game.Currency.SilverCoin]),n.onOK=n.onSure,n}return __extends(t,e),t.prototype.onSure=function(){return PlayerAttribute.currency[Game.Currency.GoldCoin]+PlayerAttribute.currency[Game.Currency.SilverCoin]-this.data.currentPrice<0?(UIManager.push(new r),void UIManager.pop(this)):(this.data.buy(this.data.pos,this.data.param),void UIManager.pop(this))},t}(t);e.SilverPrompt=i,__reflect(i.prototype,"UI.SilverPrompt");var a=function(e){function t(t,n){var i=e.call(this)||this;return i.skinName="ConfirmBoxSkin",i.addEventListener(egret.TouchEvent.TOUCH_TAP,i.onTouchTap,i),i.title=lang.String("not enough silvercoin"),i.orgContentMsg=lang.StringWithFormat("if replace {1} silver with gold",t-PlayerAttribute.currency[Game.Currency.SilverCoin]),i.onOK=n,i}return __extends(t,e),t}(t);e.SilverPromptByCost=a,__reflect(a.prototype,"UI.SilverPromptByCost");var r=function(e){function t(){var t=e.call(this)||this;return t.skinName="ConfirmBoxSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.title=lang.String("not enough goldcoin"),t.orgContentMsg=lang.String("not enough goldcoin, goto recharge"),t.onOK=t.onSure,t}return __extends(t,e),t.prototype.onSure=function(){UIManager.pop(this),Recharge.openRechargeUI()},t}(t);e.GoldCoinPrompt=r,__reflect(r.prototype,"UI.GoldCoinPrompt");var o=function(e){function t(){var t=e.call(this)||this;return t.skinName="ConfirmBoxSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.title=lang.String("not enough arenaCoin"),t.orgContentMsg=lang.String("not enough arenaCoin ,goto arenaChallenge"),t.onOK=t.onSure,t}return __extends(t,e),t.prototype.onSure=function(){ArenaChallenge.onOpenArena(),UIManager.pop(this),UIManager.closeMall()},t}(t);e.ArenaCoinPrompt=o,__reflect(o.prototype,"UI.ArenaCoinPrompt")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.rbcolor=16777215,t}return __extends(t,e),t.prototype.dataChanged=function(){null!=this.data&&(this.data.enhancement<=0?this.lbcorner=null:this.lbcorner="+"+this.data.enhancement,null!=this.data.level&&(this.rbcorner=lang.StringWithFormat("{1}level",this.data.level)),this.icon=this.data.icon,void 0!==this.data.qualityMovieEnabled&&(this.qualityMovieEnabled=this.data.qualityMovieEnabled),this.quality=this.data.quality)},t}(e.Cell);e.EquipCell=t,__reflect(t.prototype,"UI.EquipCell")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.loadAsset()},t.prototype.loadAsset=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,i;return __generator(this,function(a){switch(a.label){case 0:return e=RES.getRes("mc/roshambo/roshambo.json"),t=RES.getRes("mc/roshambo/roshambo_sheet.json"),n="mc/roshambo",null!=e&&null!=t?[3,2]:(RES.createGroup(n,["mc/roshambo/roshambo.json","mc/roshambo/roshambo_sheet.json"]),[4,RES.loadGroup(n,0)]);case 1:a.sent(),e=RES.getRes("mc/roshambo/roshambo.json"),t=RES.getRes("mc/roshambo/roshambo_sheet.json"),a.label=2;case 2:return this.npcRoshambo=new egret.MovieClip(e.generateMovieClipData("roshambo")),this.npcRoshambo.scaleX=.85,this.npcRoshambo.scaleY=.85,this.npcRoshambo.x=64,this.npcRoshambo.y=83,this.npcRoshambo.play(-1),i=[],i[0]={texture:t.getTexture("ro")},i[1]={texture:t.getTexture("sham")},i[2]={texture:t.getTexture("bo")},this.list.dataProvider=new eui.ArrayCollection(i),this.npcGroup.addChild(this.npcRoshambo),this.list.touchChildren=!0,this.assetLoaded(),[2]}})})},t.prototype.assetLoaded=function(){},t.prototype.freeAssets=function(){var e=RES.getRes("mc/roshambo/roshambo.json");null!=e&&(e.clearCache(),RES.destroyRes("mc/roshambo/roshambo.json"));var t=RES.getRes("mc/roshambo/roshambo_sheet.json");null!=t&&(t.dispose(),RES.destroyRes("mc/roshambo/roshambo_sheet.json"))},t}(e.FitComponent);e.Roshambo=t,__reflect(t.prototype,"UI.Roshambo",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.init(),this.registerEvent()},t.prototype.init=function(){this.reset(!0),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoveFromStage,this)},t.prototype.onAddToStage=function(){var e=this.getVipDonateCountMax()-this.getDonatedCount();this.Count=e>0?1:0,this.UpdateView()},t.prototype.onRemoveFromStage=function(){},t.prototype.reset=function(e){void 0===e&&(e=!1),this.UpdateCountState(),this.nReputation=0,this.nFund=0,this.nContribution=0,e&&(this.Count=0),this.nTotalConsume=0},t.prototype.registerEvent=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this)},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnClose:case this.btnCancle:this.onClickClose(e);break;case this.btnPlus:this.onClickPlus(e);break;case this.btnMinus:this.onClickMinus(e);break;case this.btnOK:this.onClickOK(e)}},t.prototype.onClickOK=function(e){var t=new net.def.C2SGuildDonate;t.setCurrencyType(this.getDonateCurrencyType()),t.setDonateCount(this.Count),this.Count>0&&(net.socket.write(2018,t.toArrayBuffer()),net.socket.write(83,null)),UIManager.pop(this),this.reset(!0)},t.prototype.onClickClose=function(e){UIManager.pop(this),this.reset(!0)},t.prototype.onClickPlus=function(e){this.Count=this.Count+1,this.UpdateView()},t.prototype.onClickMinus=function(e){this.Count=this.Count-1,this.UpdateView()},t.prototype.UpdateCountState=function(){var e=this.getDonatedCount(),t=this.getVipDonateCountMax();this.txtCountState&&(this.txtCountState.text=t-e+"/"+t)},t.prototype.UpdateView=function(){var e=this.getDonatedCount(),t=this.getDonateInfoMap();this.reset();for(var n=e+1;n<=e+this.Count;++n){var i=t[n];this.nTotalConsume+=i.consume,this.nReputation+=i.guildReputation,this.nFund+=i.guildFund,this.nContribution+=i.guildContribution}},Object.defineProperty(t.prototype,"Count",{get:function(){return this.nCount},set:function(e){0>e&&(e=0);var t=this.getVipDonateCountMax()-this.getDonatedCount();0>t&&(t=0),e>t&&(e=t),this.nCount=e},enumerable:!0,configurable:!0}),t}(e.FitComponent);e.GuildDonateCoin=t,__reflect(t.prototype,"UI.GuildDonateCoin",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="CollectCardUISkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.page=0,e.kind=1,e.card=-1,e}return __extends(n,t),Object.defineProperty(n,"kind",{get:function(){return this._instance?this._instance.kind:1},set:function(e){this._instance&&(this._instance.kind=e)},enumerable:!0,configurable:!0}),Object.defineProperty(n,"card",{get:function(){return this._instance?this._instance.card:-1},set:function(e){this._instance&&(this._instance.card=e)},enumerable:!0,configurable:!0}),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.open=function(e){var t=collectCardManager.kindConfig[this.kind].require;return PlayerAttribute.Level<t?void PopUpMessage.push(lang.StringWithFormat("unlock:level{1}",t),color.RED):(null==this._instance&&(this._instance=new n,null==e&&(this._instance.page=0)),null!=e&&(this._instance.page=e),void UIManager.pushPage(this._instance))},n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.tab.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this),this.tabKind.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onKindItemTap,this)},n.prototype.onAddToStage=function(){this.changePage(this.page),this.tab.selectedIndex=this.page},n.prototype.onRemoveFromStage=function(){},n.prototype.changePage=function(t){switch(t){case n.TABINDEX_CARD:this.pageCard||(this.pageCard=new e.PageCollectCard),this.pageCard.onTapKindItem(this.kind),this.pageCard.parent!=this.view&&(this.view.removeChildren(),this.view.addChild(this.pageCard)),this.tabKind.visible=!0,this.tabKind1badgeLight=badge.blackboard[badge.action.CollectCardActiveKind1],this.tabKind2badgeLight=badge.blackboard[badge.action.CollectCardActiveKind2],this.tabKind3badgeLight=badge.blackboard[badge.action.CollectCardActiveKind3];break;case n.TABINDEX_UPGRADESTAR:this.pageUpgradeStar||(this.pageUpgradeStar=new e.PageCollectCardUpgradeStar),this.pageUpgradeStar.onTapKindItem(this.kind),this.pageUpgradeStar.parent!=this.view&&(this.view.removeChildren(),this.view.addChild(this.pageUpgradeStar)),this.tabKind.visible=!0,this.tabKind1badgeLight=badge.blackboard[badge.action.CollectCardUpgradeStarKind1],this.tabKind2badgeLight=badge.blackboard[badge.action.CollectCardUpgradeStarKind2],this.tabKind3badgeLight=badge.blackboard[badge.action.CollectCardUpgradeStarKind3];break;case n.TABINDEX_UPGRADELEVEL:this.pageUpgradeLevel||(this.pageUpgradeLevel=new e.PageCollectCardUpgradeLevel),this.pageUpgradeLevel.onTapKindItem(this.kind),this.pageUpgradeLevel.parent!=this.view&&(this.view.removeChildren(),this.view.addChild(this.pageUpgradeLevel)),this.tabKind.visible=!0,this.tabKind1badgeLight=badge.blackboard[badge.action.CollectCardUpgradeLevelKind1],this.tabKind2badgeLight=badge.blackboard[badge.action.CollectCardUpgradeLevelKind2],this.tabKind3badgeLight=badge.blackboard[badge.action.CollectCardUpgradeLevelKind3];break;case n.TABINDEX_SPLIT:this.pageSplit||(this.pageSplit=new e.PageCollectCardSplit),this.pageSplit.parent!=this.view&&(this.view.removeChildren(),this.view.addChild(this.pageSplit)),this.tabKind.visible=!1,this.tabKind1badgeLight=!1,this.tabKind2badgeLight=!1,this.tabKind3badgeLight=!1}},n.prototype.onItemTap=function(){var e=this.tab.selectedIndex;this.page!=e&&(this.page=e,this.changePage(e))},n.prototype.onKindItemTap=function(e){var t=e.itemIndex+1,n=collectCardManager.kindConfig[t].require;return PlayerAttribute.Level<n?(PopUpMessage.push(lang.StringWithFormat("unlock:level{1}",n),color.RED),void(this.tabKind.selectedIndex=this.kind-1)):(this.kind=t,void this.onChangeKind(t))},n.prototype.onChangeKind=function(e){switch(this.page){case n.TABINDEX_CARD:if(!this.pageCard)return;this.pageCard.onTapKindItem(e);break;case n.TABINDEX_UPGRADESTAR:if(!this.pageUpgradeStar)return;this.pageUpgradeStar.onTapKindItem(e);break;case n.TABINDEX_UPGRADELEVEL:if(!this.pageUpgradeLevel)return;this.pageUpgradeLevel.onTapKindItem(e)}},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:UIManager.pop(this)}},n.prototype.UpdateTabKindBadge=function(){if(null!=this.tabKind)switch(this.page){case n.TABINDEX_CARD:this.tabKind.visible=!0,this.tabKind1badgeLight=badge.blackboard[badge.action.CollectCardActiveKind1],this.tabKind2badgeLight=badge.blackboard[badge.action.CollectCardActiveKind2],this.tabKind3badgeLight=badge.blackboard[badge.action.CollectCardActiveKind3];break;case n.TABINDEX_UPGRADESTAR:this.tabKind.visible=!0,this.tabKind1badgeLight=badge.blackboard[badge.action.CollectCardUpgradeStarKind1],this.tabKind2badgeLight=badge.blackboard[badge.action.CollectCardUpgradeStarKind2],this.tabKind3badgeLight=badge.blackboard[badge.action.CollectCardUpgradeStarKind2];break;case n.TABINDEX_UPGRADELEVEL:this.tabKind.visible=!0,this.tabKind1badgeLight=badge.blackboard[badge.action.CollectCardUpgradeLevelKind1],this.tabKind2badgeLight=badge.blackboard[badge.action.CollectCardUpgradeLevelKind2],this.tabKind3badgeLight=badge.blackboard[badge.action.CollectCardUpgradeLevelKind2];break;case n.TABINDEX_SPLIT:this.tabKind.visible=!1,this.tabKind1badgeLight=!1,this.tabKind2badgeLight=!1,this.tabKind3badgeLight=!1}},n.TABINDEX_CARD=0,n.TABINDEX_UPGRADESTAR=1,n.TABINDEX_UPGRADELEVEL=2,n.TABINDEX_SPLIT=3,n}(e.FitComponent);e.CollectCardUI=t,__reflect(t.prototype,"UI.CollectCardUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var Operation;!function(e){function t(){a[i.EquipBag]=UIManager.openEquipBag,a[i.FenglingBoat]=function(){DungeonHallMgr.OpenDungeonWithTarget(DungeonHallMgr.DungeonTarget_FerryBoat)},a[i.TaohuaIsland]=TaohuaIsland.onOpenTaohuaIsland,a[i.Enhancement]=UIManager.openEnhancement,a[i.OpenFoursymbolsEntrance]=function(){UI.FourSymbolsEntrance.open()},a[i.OpenGuangMingDingEntrance]=function(){UI.GuangMingDingEntrance.open()},a[i.MasterChallenge]=MasterChallenge.openChallenge,a[i.Meridian]=UIManager.openMeridian,a[i.SeasunVillage]=function(){UIManager.pushPage(new UI.SeaSunEntrance)},a[i.Arena]=ArenaChallenge.onOpenArena,a[i.Book]=UIManager.openBookUI,a[i.SongJin]=function(){UIManager.pushPage(new UI.SongJinWar)},a[i.OpenRechargeUI]=Recharge.openRechargeUI,a[i.OpenTitleUI]=UIManager.openTitleUI,a[i.OpenPartnerUI]=UIManager.openPartnerUI,a[i.MysteryShop]=UIManager.openMysteryShop,a[i.HuashanPK]=HuashanPK.OpenHuashanPK,a[i.CatchThief]=function(){DungeonHallMgr.OpenDungeonWithTarget(DungeonHallMgr.DungeonTarget_CatchThief)},a[i.OpenRechargeActivityHall]=UI.RechargeActivityHall.open,a[i.OpenFactionTitle]=function(){UIManager.pushPage(UI.TitleBreakThrough.instance)},a[i.OpenSwapEquip]=UIManager.openSwapEquip,a[i.OpenSuperWeaponUI]=SuperWeapon.showUi,a[i.OpenWorldMap]=function(){return Game.isWildMap()?void UIManager.pushPage(UI.MapCabinet.instance):void PopUpMessage.push(lang.String("can not escape"),color.RED)},a[i.LittleBoss]=a[i.OpenWorldMap],a[i.OpenGuildGarden]=function(){Guild.onCity2GuildMain(),UI.GuildHome.instance.OpenGardenPage()},a[i.OpenIzakaya]=UIManager.openPetEnlist,a[i.OpenMeridianUI]=UIManager.openMeridian,a[i.OpenGemUI]=UIManager.openGem,a[i.OpenGuildManor]=function(){net.socket.write(94,null)},a[i.QinMausoleum]=function(){""!=Player.instance.guildName&&UIManager.pushPage(new UI.QinEntrance)},a[i.Auction]=Auction.showUi,a[i.EnterGuildGarden]=function(){},a[i.CrosvrBoss]=CrossServer.openCrossBossUI,a[i.WildBoss1]=WildBoss.startWildBoss1,a[i.WildBoss2]=WildBoss.startWildBoss2,a[i.Wanderings]=UI.openWanderingsUI,a[i.WulinLiansai]=function(){WulinLiansai.OpenPanel(!0)},a[i.CrossServerSongjin]=function(){UIManager.pushPage(new UI.CrossServerSongJinWar)},a[i.GuildActBusiTask]=function(){""!=Player.instance.guildName&&UI.GuildBusiTask.open()},a[i.GuildBusiTaskHelp]=function(e){""!=Player.instance.guildName&&UI.GuildBusiTaskHelp.open(e)},a[i.Battle]=UIManager.openBattle,a[i.PartnerShop]=UIManager.openPetEnlist,a[i.WildBossUI]=function(){UI.openWanderingsUI(1)},a[i.TenfoldExp]=function(){UIManager.pushPage(new UI.TenfoldGain)},a[i.GuildShop]=function(){""!=Player.instance.guildName?UIManager.pushPage(UI.GuildShop.instance):UIManager.openGoldCoinShop()},a[i.BindCoinShop]=function(){UIManager.openGoldCoinShop()},a[i.GuildBusiTask]=function(){""!=Player.instance.guildName&&UI.GuildBusiTask.open()},a[i.DailyMark]=function(){UI.WelfareHall.open()},a[i.GuildDonate]=function(){""!=Player.instance.guildName&&UIManager.pushPage(UI.GuildDonate.instance)},a[i.EquipMake]=function(){""!=Player.instance.guildName&&UI.EquipMaking.open()},a[i.PrizeWheel]=function(){UIManager.pushPage(UI.GuildGarden.instance)},a[i.GuildWarHome]=function(){""==Player.instance.guildName?PopUpMessage.push(lang.String("no guild"),color.RED):UIManager.pushPage(UI.GuildWarHome.instance)},a[i.OfflineExp]=function(){OfflineTime.show&&UIManager.pushPage(new UI.OfflineExpAwardUI)},a[i.OpenYanEmperor]=function(){UI.YanEmperorTransfer.open(-1)},a[i.YanEmperorTransfer]=UI.YanEmperorTransfer.open,a[i.GuildArmament]=function(e){return table.maps[World.mapId].wild?void(""!=Player.instance.guildName&&(UIManager.push(UI.GuildArmamentUI.instance),GuildArmament.applyArmsInfo(Number(e)))):void PopUpMessage.push(lang.String("armament only can enter in wild map"),color.RED)},a[i.YesouTask]=function(){yesouTaskManager.OpenYesouUI()},a[i.Babel]=function(){Babel.OpenAndJoin()},a[i.GuildWar2UI]=function(){GuildWarMatchScene.OnClickBtnReminder()},a[i.GuildWar2Battle]=function(){GuildWarMatchScene.ApplyJoinMatch(GuildWarMatchScene.IsGuildWar2())},a[i.OpeningWheel]=function(){UI.RechargeActivityHall.open(),UI.RechargeActivityHall.instance.showOpeningWheel()},a[i.OpenWeekendRecruit]=function(){WeekendRecruit.activity.open&&UI.PetEnlist.open(2),UI.PetEnlist.open()},a[i.OpenFlashSale]=function(){UI.RechargeActivityHall.open(),UI.RechargeActivityHall.instance.showFlashSale()},a[i.OpenActivityRecharge]=function(){UI.RechargeActivityHall.open(),UI.RechargeActivityHall.instance.showLeiChong()},a[i.OpenActivityConsumption]=function(){UI.RechargeActivityHall.open(),UI.RechargeActivityHall.instance.showLeiXiao()},a[i.ActivityRecharge7Day]=function(){UI.RechargeActivityHall.open(),UI.RechargeActivityHall.instance.showRecharge7Day()},a[i.UpdateIssues]=UI.UpdateIssuesUI.open,a[i.EnterMap]=function(e){var t=table.maps[e];if(World.mapId!=e)if(t.wild){var n=new net.def.C2SApplyEnterMap;n.setMapId(e),net.socket.write(23,n.toArrayBuffer())}else"city"==t.scene&&CityHome.c2s_home()},a[i.CollectTreasure]=activityCollectTreasure.OpenCollectTreasureUI,a[i.Bet]=Bet.OpenMainUI,a[i.GuildDungeon]=function(){GuildDungeon.Hotkey2Open(!0)},a[i.BravePalace]=function(){WorldLine.IsOpen("BravePalace")&&BravePalace.OpenUI()},a[i.ShareBossTry2Return]=shareboss.Try2ReturnBattle,a[i.GroupBossOpenPage]=DungeonGroup.OpenDungeonPage,a[i.LotteryTicket]=function(){UI.LotteryTicketUI.open()},a[i.CityTieJiang]=function(){WorldLine.IsOpen("PartnerEquip")&&WorldLine.IsOpen("PartnerEquipEnahnce")&&UI.NPC_TieJiangEntrance.open()},a[i.OpenPartnerEquipSplitUI]=function(){UIManager.push(new UI.PartnerEquipSplitUI)},a[i.YesouKillAnyNpc]=function(){Game.isCityHome()&&CityHome.c2s_leave()},a[i.YesouWorship]=function(){CityHome.GotoWorship()},a[i.RefinePanel]=function(){return PlayerAttribute.Level<Refine.openLevel?void PopUpMessage.push(lang.StringWithFormat("open on level {1}",Refine.openLevel),color.RED):(UIManager.pushPage(UI.JingCuiPanel.instance),void UI.JingCuiPanel.instance.changePage(0))},a[i.RunePanel1]=function(){Rune.openDetailPanel(0)},a[i.RunePanel2]=function(){Rune.openDetailPanel(1)},a[i.RunePanel3]=function(){Rune.openDetailPanel(2)},a[i.RunePanel4]=function(){Rune.openDetailPanel(3)},a[i.PersonalMatch]=function(){UIManager.pushPage(new UI.PersonalMatchUI)},a[i.PrologueStep]=function(){Prologue.onP1Step()},a[i.OpenWuxingyinPanel]=function(){UI.WuxingyinPanel.open(0)},a[i.OpenWuxingyinUI]=function(){UI.WuxingyinUI.open()},a[i.SignUpJianMenGuan]=function(){UI.JianMenGuanUI.open()},a[i.OpenJingZhiWuxingyinUI]=function(){UI.WuxingyinUI.open()}}function n(e,t){var n=a[e];null==n?egret.error("view="+e+" not found"):n(t)}var i;!function(e){e[e.None=0]="None",e[e.EquipBag=1]="EquipBag",e[e.FenglingBoat=2]="FenglingBoat",e[e.TaohuaIsland=3]="TaohuaIsland",e[e.Enhancement=4]="Enhancement",e[e.MasterChallenge=5]="MasterChallenge",e[e.Meridian=6]="Meridian",e[e.SeasunVillage=7]="SeasunVillage",e[e.Arena=8]="Arena",e[e.Book=9]="Book",e[e.SongJin=10]="SongJin",e[e.OpenTitleUI=11]="OpenTitleUI",e[e.OpenPartnerUI=12]="OpenPartnerUI",e[e.MysteryShop=13]="MysteryShop",e[e.Auction=14]="Auction",e[e.EnterGuildGarden=15]="EnterGuildGarden",e[e.OpenRechargeUI=16]="OpenRechargeUI",e[e.OpeningWheel=17]="OpeningWheel",e[e.OpenRechargeActivityHall=18]="OpenRechargeActivityHall",e[e.OpenFactionTitle=19]="OpenFactionTitle",e[e.HuashanPK=20]="HuashanPK",e[e.CatchThief=21]="CatchThief",e[e.OpenSwapEquip=22]="OpenSwapEquip",e[e.OpenSuperWeaponUI=23]="OpenSuperWeaponUI",e[e.LittleBoss=24]="LittleBoss",e[e.OpenIzakaya=25]="OpenIzakaya",e[e.OpenMeridianUI=26]="OpenMeridianUI",e[e.OpenGemUI=27]="OpenGemUI",e[e.OpenWeekendRecruit=28]="OpenWeekendRecruit",e[e.OpenFlashSale=29]="OpenFlashSale",e[e.OpenActivityRecharge=30]="OpenActivityRecharge",e[e.OpenActivityConsumption=31]="OpenActivityConsumption",e[e.EnterMap=32]="EnterMap",e[e.ActivityRecharge7Day=33]="ActivityRecharge7Day",e[e.UpdateIssues=34]="UpdateIssues",e[e.OpenPartnerEquipSplitUI=35]="OpenPartnerEquipSplitUI",e[e.PrologueStep=36]="PrologueStep",e[e.OpenFoursymbolsEntrance=37]="OpenFoursymbolsEntrance",e[e.OpenWuxingyinPanel=38]="OpenWuxingyinPanel",e[e.OpenWuxingyinUI=39]="OpenWuxingyinUI",e[e.OpenWorldMap=57]="OpenWorldMap",e[e.OpenGuildGarden=58]="OpenGuildGarden",e[e.OpenGuildManor=59]="OpenGuildManor",e[e.QinMausoleum=60]="QinMausoleum",e[e.WildBoss1=61]="WildBoss1",e[e.WildBoss2=62]="WildBoss2",e[e.Wanderings=63]="Wanderings",e[e.WulinLiansai=64]="WulinLiansai",e[e.NienBoss=65]="NienBoss",e[e.CrosvrBoss=66]="CrosvrBoss",e[e.CrossServerSongjin=67]="CrossServerSongjin",e[e.GuildActBusiTask=68]="GuildActBusiTask",e[e.GuildBusiTaskHelp=69]="GuildBusiTaskHelp",e[e.Battle=70]="Battle",e[e.PartnerShop=71]="PartnerShop",e[e.WildBossUI=72]="WildBossUI",e[e.TenfoldExp=73]="TenfoldExp",e[e.GuildShop=74]="GuildShop",e[e.BindCoinShop=75]="BindCoinShop",e[e.GuildBusiTask=76]="GuildBusiTask",e[e.DailyMark=77]="DailyMark",e[e.GuildDonate=78]="GuildDonate",e[e.EquipMake=79]="EquipMake",e[e.PrizeWheel=80]="PrizeWheel",e[e.GuildWarHome=81]="GuildWarHome",e[e.OfflineExp=82]="OfflineExp",e[e.OpenYanEmperor=83]="OpenYanEmperor",e[e.YanEmperorTransfer=84]="YanEmperorTransfer",e[e.GuildArmament=85]="GuildArmament",e[e.YesouTask=86]="YesouTask",e[e.Babel=87]="Babel",e[e.GuildWar2UI=88]="GuildWar2UI",e[e.GuildWar2Battle=89]="GuildWar2Battle",e[e.CollectTreasure=90]="CollectTreasure",e[e.Bet=91]="Bet",e[e.GuildDungeon=92]="GuildDungeon",e[e.LotteryTicket=93]="LotteryTicket",e[e.CityTieJiang=94]="CityTieJiang",e[e.YesouKillAnyNpc=95]="YesouKillAnyNpc",e[e.YesouWorship=96]="YesouWorship",e[e.RefinePanel=97]="RefinePanel",e[e.RunePanel1=98]="RunePanel1",e[e.RunePanel2=99]="RunePanel2",e[e.RunePanel3=100]="RunePanel3",e[e.RunePanel4=101]="RunePanel4",e[e.PersonalMatch=102]="PersonalMatch",e[e.BravePalace=103]="BravePalace",e[e.ShareBossTry2Return=104]="ShareBossTry2Return",e[e.GroupBossOpenPage=105]="GroupBossOpenPage",e[e.SignUpJianMenGuan=106]="SignUpJianMenGuan",e[e.OpenGuangMingDingEntrance=107]="OpenGuangMingDingEntrance",e[e.OpenJingZhiWuxingyinUI=108]="OpenJingZhiWuxingyinUI"
}(i=e.Type||(e.Type={}));var a={};e.init=t,e.open=n}(Operation||(Operation={}));var MAX_DIR=64,HALF_DIR=MAX_DIR/2,QUARTER_DIR=MAX_DIR/4,EIGHTH_DIR=MAX_DIR/8,Payment;!function(e){function t(e){var t=new net.def.C2SPay;t.wareId=e,net.socket.write(44,t.toArrayBuffer())}e.buy=t}(Payment||(Payment={}));var PopUpMessage;!function(e){function t(){s=0}function n(){if(u.length>0)for(var e=0;a>e;e++)if(u.length>0){var t=u[0];i(t.text,t.color,!1)&&(u=u.slice(1))}}function i(e,t,n){if(!e||""==e)return!1;var i=egret.getTimer();if(i-l>o){for(var h=messageLayer.numChildren-1;h>=0;h--){var d=messageLayer.getChildAt(h);d instanceof UI.Message&&(egret.Tween.removeTweens(d),messageLayer.removeChildAt(h))}s=0,l=i,c()}if(s>=a)return(null==n||n)&&(u.push({text:e,color:t}),u.length>=r&&(u=u.slice(1))),!1;var p=new UI.Message;p.touchEnabled=!1,p.message=e,p.color=t;var g=egret.MainContext.instance.stage;return p.y=~~(.2*g.stageHeight+30*s),p.y>=g.stageHeight&&(p.y=g.stageHeight),p.alpha=0,p.scaleX=.1,p.scaleY=.1,messageLayer.addChild(p),egret.Tween.get(p).wait(100*s).to({alpha:1,scaleX:1,scaleY:1},100).wait(1500).to({y:p.y-200,alpha:0},300).call(Game.removeFromParent,p),s++,!0}var a=6,r=3*a,o=1500,s=0,l=0,u=[],c=MakeDelayExecute(n,null,o+100);e.clear=t,e.push=i}(PopUpMessage||(PopUpMessage={}));var QRCode=function(){function e(e){var t=document.getElementById("gameDiv");this.htmlCode=document.createElement("img"),this.htmlCode.src=e,this.htmlCode.style.position="absolute",this.htmlCode.style.display="none",t.appendChild(this.htmlCode)}return e.prototype.showHtmlCode=function(){this.htmlCode&&(this.htmlCode.style.display="inline")},e.prototype.hideHtmlCode=function(){this.htmlCode&&(this.htmlCode.style.display="none")},e.prototype.setPosition=function(e,t,n,i){if(null!=this.htmlCode){var a=document.getElementById("gameDiv"),r=egret.MainContext.instance.stage,o=a.clientWidth/r.stageWidth,s=a.clientHeight/r.stageHeight;this.htmlCode.style.width=n*o+"px",this.htmlCode.style.height=i*s+"px",this.htmlCode.style.left=e*o+"px",this.htmlCode.style.top=t*s+"px"}},e.prototype.destroy=function(){this.htmlCode&&(this.htmlCode.parentNode.removeChild(this.htmlCode),this.htmlCode=null)},e}();__reflect(QRCode.prototype,"QRCode");var RecentContact;!function(e){function t(){n()}function n(){e.recentContact={},l=0;var t=egret.localStorage.getItem(o+"_"+Player.instance.Name);if(null!=t){e.recentContact=JSON.parse(t);for(var n in e.recentContact)null!=e.recentContact[n]&&(l+=1)}}function i(){egret.localStorage.setItem(o+"_"+Player.instance.Name,JSON.stringify(e.recentContact))}function a(t,n){if(null==e.recentContact[t]&&(l+=1),e.recentContact[t]=new s(n,Game.getServerDate().getTime()),l>r){var a=2147483647,o="";for(var u in e.recentContact)e.recentContact[u].time/1e3<a&&(o=u,a=e.recentContact[u].time/1e3);delete e.recentContact[o],l-=1}i(),null!=UI.FriendsUI.instance&&UI.FriendsUI.instance.UpdateRecentContact()}var r=15,o="Contact",s=function(){function e(e,t){this.faction=e,this.time=t}return e}();__reflect(s.prototype,"ContactInfo");var l,u=function(){function e(e,t,n){this.name="",this.level=0,this.fp=0,this.faction=0,this.guildName="",this.txtCustom="",this.nType=0,this.name=e,this.faction=t,this.txtOffline=n,this.nType=Game.FriendPageType.RecentContact,this.txtCustom=lang.String("last contact"),this.Relationship="";var i=new Date(n),a=i.toLocaleDateString(),r=i.getHours(),o=i.getMinutes();this.txtCustom+=a+" "+r+":"+NumberFormat(o,2)}return Object.defineProperty(e.prototype,"icon",{get:function(){return 0==this.faction?"":table.faction[this.faction].portrait},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"txtFaction",{get:function(){return 0==this.faction?"":table.faction[this.faction].name},enumerable:!0,configurable:!0}),e}();e.RecentContactInfo=u,__reflect(u.prototype,"RecentContact.RecentContactInfo"),e.Init=t,e.load=n,e.save=i,e.addrecentContact=a}(RecentContact||(RecentContact={}));var UI;!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.onTouchTap=function(){this.close()},t.prototype.close=function(){UIManager.pop(this)},t}(e.FitComponent);e.Rule=t,__reflect(t.prototype,"UI.Rule")}(UI||(UI={}));var GameMap=function(){function e(e,t){var n=this;this.oldX=0,this.oldY=0,this.speed=.0015,this.loaded=!1,this._isReady=!1,this.effects={},this.url=e.file,this.wild=e.wild,this.scene=e.scene,this.mapId=e.id;RES.getRes(this.url);this.lastId=0,this.loader=new RES.Loader,this.netHashCode=t,this.loader.get(this.url,function(e){n.onLoaded(e)},1e3)}return e.prototype.setInfo=function(e,t){this.wild=e.wild,this.scene=e.scene,this.mapId=e.id,this.netHashCode=t},e.prototype.onLoaded=function(e){var t=e.attributes.width*e.attributes.tilewidth,n=e.attributes.height*e.attributes.tileheight,i=new tiled.TMXTilemap(t,n,e,"mapimg/");this.tmxTileMap=i,i.addEventListener(egret.ProgressEvent.PROGRESS,this.onProgress,this),i.addEventListener(tiled.TMXLoadEvent.INIT_COMPLETE,this.onMapInitComplete,this),i.render(),i.touchEnabled=!0},e.prototype.onProgress=function(e){null==Scene.loadingView||this.loaded||Scene.loadingView.onProgress(e.bytesLoaded,e.bytesTotal)},e.prototype.appendEffect=function(e,t,n){var i=this.effects[e];null==i&&(i=new RES.Loader,this.effects[e]=i),null==i.dispatcher&&(RES.addRel(t),i.get(t,n))},e.prototype.addEffect=function(e,t){var n=this;this.lastId++;var i="effect"+this.lastId;this.appendEffect(i,e,function(e){var a=n.effects[i];return null==a?void egret.error("[ERROR] actor.addOneTimeEffect "+i+" not found"):(t(e),null!=a.url&&RES.delRel(a.url),a.release(),void delete n.effects[i])})},e.prototype.onMapLoaded=function(){var t=this.tmxTileMap,n=t.getObjects();this.cameraRegion=[];for(var i={},a=0;a<n.length;a++)if(i[n[a].name]=n[a],"cameraRegion"==n[a].name)for(var r=0;r<n[a].getObjectCount();r++){var o=n[a].getObjectByIndex(r);this.cameraRegion.push(new egret.Rectangle(o.x,o.y,o.width,o.height))}this.objectGroup=i;for(var s={},l=t.getLayers(),a=0;a<l.length;a++){var u=l[a];s[u.name]=u}this.layers=s,this.tilewidth=t.tilewidth,this.tileheight=t.tileheight*e.ratioY,this.width=t.tilewidth*t.rows,this.height=t.tileheight*t.cols*e.ratioY;for(var c=[],h=s[e.LayerObstacle],d=0;d<t.rows;d++){c[d]=[];for(var p=0;p<t.cols;p++)null!=h&&h.getTileId(d*h.tilewidth,p*h.tileheight)>0?c[d][p]=0:c[d][p]=1}this.obstacles=c,this.graph=new astar.Graph(c,{diagonal:!1});var g=s.preview;null!=g&&(g.scaleX=10,g.scaleY=10),this.loaded=!0},e.prototype.onMapInitComplete=function(){var e=this.tmxTileMap;e.removeEventListener(tiled.TMXLoadEvent.INIT_COMPLETE,this.onMapInitComplete,this),this.loaded||this.onMapLoaded(),this._isReady||this.setMapReady()},e.prototype.setMapReady=function(){this._isReady||(this._isReady=!0,this.ready())},e.prototype.ready=function(){if(mapLayer.addChild(this.tmxTileMap),GameTick.addEventListener(this.update,this),null!=net.socket){var e=net.socket.hashCode;null!=e&&this.netHashCode==e?test.autoReady&&net.socket.write(2,null):(console.warn("[world][ready] mapid="+this.mapId+" socket "+this.netHashCode+" != "+e),window.location.reload())}else console.warn("[world][ready] mapid="+this.mapId+" socket == null");Scene.Ready()},e.prototype.clear=function(){this.lastId=0;for(var t in this.effects){var n=this.effects[t];null!=n.url&&RES.delRel(n.url),n.release(),delete this.effects[t]}this.tmxTileMap.parent==mapLayer&&mapLayer.removeChild(this.tmxTileMap);for(var t in Skill.CircleArea.objs)Skill.CircleArea.objs[t].clear();for(var t in Skill.DropBombs.objs)Skill.DropBombs.objs[t].clear();if(GameTick.removeEventListener(this.update,this),this.layers)for(var i=this.layers[e.LayerRole],a=i.numChildren-1;a>=0;a--){var r=i.removeChildAt(a);r.destroy&&r.destroy()}else egret.error("clear World.layers == null");ECS.world.clear(),egret.Tween.removeTweens(this.tmxTileMap)},e.sortByLeftUp=function(e,t){return e.y==t.y?e.x==t.x?e.hashCode-t.hashCode:e.x-t.x:e.y-t.y},e.prototype.update=function(){for(var t=this.layers[e.LayerRole],n=this.layers[e.LayerShade],i=t.$children.sort(e.sortByLeftUp),a=i.length,r=0;a>r;r++){var o=i[r];if(t.addChildAt(o,r),o.x<0||o.y<0||o.x>=n.width||o.y>=n.height)return;n.getTileId(o.x,o.y)>0?o.alpha=.5:o.alpha=1}},e.prototype.findTargetPos=function(t,n,i,a){var r=!1,o=new egret.Rectangle(n.x,n.y,n.width,n.height);if(null!=this.cameraRegion&&this.cameraRegion.length>0)for(var s=0;s<this.cameraRegion.length;s++){var l=new egret.Rectangle(this.cameraRegion[s].x+n.x,this.cameraRegion[s].y+n.y,this.cameraRegion[s].width,this.cameraRegion[s].height);if(l.contains(t.x,t.y)){o=l,r=!0;break}}var u=this.width,c=this.height/e.ratioY;r&&(u=o.width,c=o.height);var h=0,d=0;return i>u?h=i/2-u/2-o.x:(h=i/2-t.x,o.x+h>0?h=-o.x:o.x+u+h<i&&(h=i-u-o.x)),a>c?d=a/2-c/2-o.y:(d=a/2-t.y,o.y+d>0?d=-o.y:o.y+c+d<a&&(d=a-o.y-c)),0==h&&0==d?null:{retx:h,rety:d}},e.prototype.force2focus=function(e){var t=this.tmxTileMap;if(null==t)return null;var n=e.localToGlobal(0,0),i=egret.MainContext.instance.stage,a=i.stageWidth,r=i.stageHeight,o=this.findTargetPos(n,t,a,r);return null==o?null:void t.moveMap(o.retx,o.rety)},e.prototype.follow2focus=function(e,t){var n=this.tmxTileMap;if(null==n)return null;var i=egret.MainContext.instance.stage,a=i.stageWidth,r=i.stageHeight,o=this.findTargetPos(e.localToGlobal(0,0),n,a,r);if(null==o)return null;var s=o.retx-this.oldX,l=o.rety-this.oldY,u=Math.sqrt(s*s+l*l);if(2*Math.abs(s)>a||2*Math.abs(l)>r)return n.moveMap(o.retx,o.rety),this.oldX=o.retx,void(this.oldY=o.rety);if(!(10>u)){var c=this.speed*t*u,h={x:s/u,y:l/u},d={x:h.x*c,y:h.y*c};this.oldX=d.x,this.oldY=d.y,n.moveMap(d.x,d.y)}},e.prototype.focus=function(e,t){return-1==t?void this.force2focus(e):void this.follow2focus(e,t)},e.prototype.destory=function(){this.loader.release(),this.cameraRegion=[];var e=this.tmxTileMap;this.tmxTileMap=null,e.destory(),e.removeChildren()},e.ratioY=2,e.LayerRole="role",e.LayerObstacle="obstacle",e.LayerShade="shade",e.LayerGround="ground",e}();__reflect(GameMap.prototype,"GameMap");var World,Scene;!function(e){function t(t,n){x=!1,e.loadingView.onProgress(1,2);var i=table.maps[t],a=i.file;if(null==World)return void(World=new GameMap(i,n));var r=World.scene;null!=r&&e.onLeaveMap(r),h(),World.clear(),World.url==a?(World.setInfo(i,n),World.ready()):(World.destory(),World=new GameMap(i,n)),RES.forceRecycle(RES.cacheDuration)}function n(e,t){return null!=R[e]?void egret.error("enter map handle="+e+" already exist"):void(R[e]=t)}function i(e,t){return null!=U[e]?void egret.error("leave map handle="+e+" already exist"):void(U[e]=t)}function a(e,t){return null!=_[e]?void egret.error("boss life change handle="+e+" already exist"):void(_[e]=t)}function r(e,t,n){var i=_[e];return null==i?void egret.error("boss life change handle="+e+" not exist"):void i(t,n)}function o(e){var t=R[e];return null==t?void egret.error("enter map handle="+e+" not exist"):void t()}function s(e){var t=U[e];return null==t?void egret.error("leave map handle="+e+" not exist"):void t()}function l(){var t=e.handleIdle[World.scene];if(null!=t)return t(World.objectGroup);if(Setting.holdpoint)return Setting.holdpoint;var n=World.objectGroup.monster,i=n.getObjectCount();if(0>=i)return null;var a=~~(Math.random()*i),r=n.getObjectByIndex(a);return null==r?null:C(new egret.Point(~~(r.x+r.width/2),~~(r.y+r.height/2)))}function u(e){var t=Player.instance;if(t.Id==e.Id)return!1;if(t.Camp==Game.Camp.CampNeutral||e.Camp==Game.Camp.CampNeutral)return!1;if(t.Camp==Game.Camp.CampButcher||e.Camp==Game.Camp.CampButcher){var n=t.isMirror?1:t.kind,i=e.isMirror?1:e.kind;return n!=i?!0:1!=World.pkAllowed?!1:1==t.kind&&""!=t.guildName&&t.guildName==e.guildName?!1:!0}return t.Camp==e.Camp?!1:TmpCamp.IsRelated(t.Camp,e.Camp)}function c(){return x}function h(){for(var e in mapSpeech){var t=mapSpeech[e];null!=t&&t.release()}mapSpeech={},PopUpMessage.clear(),announce.C.clear(),AI.unload(),PartnerNpcManager.clear();for(var n=0;n<messageLayer.numChildren;n++){var i=messageLayer.getChildAt(n);egret.Tween.removeTweens(i)}messageLayer.removeChildren();for(var a in mapCharacter){var r=mapCharacter[a];null!=r&&r.destroy()}for(var o in ECS.SceneObjectComponent.objs){var s=ECS.SceneObjectComponent.objs[o];s.gameobject.destory()}for(var n=0;n<mapMessageLayer.numChildren;n++){var i=mapMessageLayer.getChildAt(n);egret.Tween.removeTweens(i)}mapMessageLayer.removeChildren()}function d(){x=!0}function p(e){if(null!=World.layers){var t=World.layers[GameMap.LayerGround];t&&t.addChild(e)}}function g(e){if(null==World.layers)return void egret.error("addChild World.layers == null");var t=World.layers[GameMap.LayerRole];return null==t?(egret.error("layers[LayerRole] == null"),!1):(t.addChild(e),!0)}function m(e){var t=World.layers[GameMap.LayerRole];null==t?egret.error("layers[LayerRole] == null"):t.getChildIndex(e)>=0?t.removeChild(e):egret.error("remove obj fail "+World.mapId)}function f(e,t,n){return World.layers[GameMap.LayerRole].globalToLocal(e,t,n)}function v(e,t,n){return World.layers[GameMap.LayerRole].localToGlobal(e,t,n)}function y(e){var t=int(e.x/World.tilewidth),n=int(e.y/World.tileheight);return egret.Point.create(t,n)}function b(e,t){return egret.Point.create(e*World.tilewidth,t*World.tileheight)}function S(t){null==e.focusCharactor&&(e.focusCharactor=Player.instance),null!=e.focusCharactor.actor&&World.focus(e.focusCharactor,t)}function E(e,t){var n=e.x,i=~~(e.y/GameMap.ratioY);return t?t.setTo(n,i):t=egret.Point.create(n,i),t}function C(e,t){var n=e.x,i=e.y*GameMap.ratioY;return t?t.setTo(n,i):t=egret.Point.create(n,i),t}function T(e,t){if(0>e||e>World.width||0>t||t>World.height)return!0;var n=int(e/World.tilewidth),i=int(t/World.tileheight);return 0==World.obstacles[n][i]}function I(e,t,n,i){var a=n-e,r=i-t;if(0>n||n>=World.width||0>i||i>=World.height)return!0;if(T(n,i))return!0;var o=Line.getTemp(e,t,a,r);if(0>a)for(var s=n+World.tilewidth;e>s;){var l=o.cutX(s);if(l.ok&&T(s,l.y))return!0;s+=World.tilewidth}else if(a>0)for(var s=n-World.tilewidth;s>e;){var l=o.cutX(s);if(l.ok&&T(s,l.y))return!0;s-=World.tilewidth}if(0>r)for(var u=i+World.tileheight;t>u;){var c=o.cutY(u);if(c.ok&&T(c.x,u))return!0;u+=World.tileheight}else if(r>0)for(var u=i-World.tileheight;u>t;){var c=o.cutY(u);if(c.ok&&T(c.x,u))return!0;u-=World.tileheight}return!1}function G(e,t,n){if(e.x<0||e.x>=World.width||e.y<0||e.y>=World.height)return egret.error("point=("+e.x+","+e.y+") World.width="+World.width+" World.height="+World.height),null;if(t.x<0||t.x>=World.width||t.y<0||t.y>=World.height)return egret.error("point=("+t.x+","+t.y+") World.width="+World.width+" World.height="+World.height),null;if(t.x%1!=0||t.y%1!=0)return void egret.error("p2 not int",t);var i=y(e),a=y(t);if(i.equals(a))return[t.clone()];var r=World.graph.grid,o=(egret.getTimer(),astar.search(World.graph,r[i.x][i.y],r[a.x][a.y],{closest:n}));if(o.length<=0)return null;var s=[],l=o.length;s.push(e.clone());for(var u=0;l>u;u++){var c=o[u],h=egret.Point.create(Math.round(c.x*World.tilewidth+World.tilewidth/2),Math.round(c.y*World.tileheight+World.tileheight/2));s.push(h)}return L(s),s.reverse(),s.pop(),s}function A(t,n,i){return e.HitObstacle(t.x,t.y,n,i)?!1:(t.x=n,t.y=i,!0)}function k(e,t,n,i,a,r){var o=t.x-e.x,s=t.y-e.y;if(0==o&&0==s)return!1;var l=g_GetDirIndex(e,t);return-1==l?!1:g_WithInRange(e,t,r)?(A(e,t.x,t.y),!1):(o=a*r,s=i*r,n.x+=o,n.y+=s,A(e,n.x>>10,n.y>>10)?!e.equals(t):!1)}function P(e,t){var n=egret.Point.create(e.x,e.y),i=Player.instance.MoveSpeed/Game.ServerFPS,a=w(n,t,i);return egret.Point.release(n),a}function w(e,t,n){if(e.equals(t))return!0;var i=g_GetDirIndex2(e,t),a=(i.dir,i.sin),r=i.cos;for(M.x=e.x<<10,M.y=e.y<<10;;)if(!k(e,t,M,a,r,n))return e.equals(t)}function L(e){for(var t=e.length,n=t-1;n>=0;n--)for(var i=0;n-2>=i;i++){var a=e[n],r=e[i];if(P(r,a)){for(var o=n-1;o>i;o--)e.splice(o,1);n=i,t=e.length;break}}return e}e.load=t,e.handleIdle={};var R={},U={},_={};e.listenEnterMap=n,e.listenLeaveMap=i,e.listenBosslifeChange=a,e.onBosslifeChange=r,e.onEnterMap=o,e.onLeaveMap=s,e.onPlayerIdle=l,e.isHostile=u;var x=!1;e.isReady=c,e.clear=h,e.Ready=d,e.addChildToGround=p,e.addChild=g,e.removeChild=m,e.globalToLocal=f,e.localToGlobal=v,e.logicPos2TileCoords=y,e.tileCoords2LogicPos=b,e.followSpeed=1,e.focus=S,e.logicPos2DisplayPos=E,e.displayPos2LogicPos=C,e.isObstacle=T,e.HitObstacle=I,e.SearchPath=G,e.playerReachable=P;var M={x:0,y:0};e.reachable=w,e.floyd=L}(Scene||(Scene={}));var ScreenAdapter=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.calculateStageSize=function(e,t,n,i,a){var r=t,o=n,s=i,l=a,u=t/s||0,c=n/l||0;switch(e){case egret.StageScaleMode.EXACT_FIT:break;case egret.StageScaleMode.FIXED_HEIGHT:s=Math.round(t/c);break;case egret.StageScaleMode.FIXED_WIDTH:l=Math.round(n/u);break;case egret.StageScaleMode.NO_BORDER:u>c?o=Math.round(l*u):r=Math.round(s*c);break;case egret.StageScaleMode.SHOW_ALL:u>c?r=Math.round(s*c):o=Math.round(l*u);break;case egret.StageScaleMode.FIXED_NARROW:u>c?s=Math.round(t/c):l=Math.round(n/u);break;case egret.StageScaleMode.FIXED_WIDE:u>c?l=Math.round(n/u):s=Math.round(t/c);break;case"custom":if(egret.Capabilities.isMobile)u>c?s=Math.round(t/c):l=Math.round(n/u);else if(880>n)u>c?s=Math.round(t/c):l=Math.round(n/u);else{var h=1920,d=1080;t>h?(r=h,s=h):(r=t,s=t),n>d?(o=d,l=d):(o=n,l=n)}break;default:s=t,l=n}return s%2!=0&&(s+=1),l%2!=0&&(l+=1),r%2!=0&&(r+=1),o%2!=0&&(o+=1),{stageWidth:s,stageHeight:l,displayWidth:r,displayHeight:o}},t}(egret.HashObject);__reflect(ScreenAdapter.prototype,"ScreenAdapter",["egret.sys.IScreenAdapter"]);var SoundUtil;!function(e){function t(t,n){if(void 0===n&&(n=!1),null!=t&&""!=t){if(!Setting.Sound())return void(e._bgmResName=t);if(!Game.running)return void(e._bgmResName=t);if(!n||e._bgmResName!=t||!e._isBGMPlaying){a(),e._bgmResName=t,e._isBGMPlaying=!0;var i=e.bgmloader[t];null==i&&(RES.addRel(t),i=new RES.Loader,e.bgmloader[t]=i),i.dispatcher||i.get(t,function(t){e._bgmChannel=t.play(0,0),e._bgmChannel.volume=.1,i.dispatcher=null})}}}function n(){t(e._bgmResName,!1)}function i(){if(e._bgmChannel){e._bgmChannel.stop(),e._isBGMPlaying=!1,e._bgmChannel=null;var t=e.bgmloader[e._bgmResName];null!=t&&t.release()}}function a(){if(e._bgmChannel){e._bgmChannel.stop(),e._isBGMPlaying=!1,e._bgmResName="",e._bgmChannel=null;var t=e.bgmloader[e._bgmResName];null!=t&&t.release()}}function r(e,t){return void 0===t&&(t=1),__awaiter(this,void 0,void 0,function(){var n,i,a,r,o,s;return __generator(this,function(l){switch(l.label){case 0:return Setting.Sound()&&Game.running?(n=RES.getRes(e),i=egret.getTimer(),null!=n?[3,2]:[4,RES.getResAsync(e)]):[2];case 1:n=l.sent(),l.label=2;case 2:return a=egret.getTimer(),r=(a-i)/Game.Second,o=n.length,r>o*t?[2]:(s=n.play(r%o,t-~~(r/o)),s.volume=.5,[2])}})})}function o(){if(!s){var e=RES.getRes("sound/click.mp3");if(e){var t=e.play();t.volume=0}}}e.bgmloader={},e._bgmResName="",e._bgmChannel=null,e._isBGMPlaying=!0,e.playBGM=t,e.resumeBGM=n,e.pauseBGM=i,e.stopBGM=a,e.playSoundEffect=r;var s=!1;e.initplay=o}(SoundUtil||(SoundUtil={}));var mapSpeech={},Speech=function(){function e(e,t){this.charId=e,this.texts=t,this.timerId=egret.setTimeout(this.loop,this,2*Game.Second)}return e.prototype.loop=function(){var e=mapCharacter[this.charId];if(null!=e&&null!=e.actor){var t=e.actor,n=Math.round(Math.random()*(this.texts.length-1));null==this.dialogue&&(this.dialogue=new UI.SpeechBubble,this.dialogue.x=t.head.x-40,this.dialogue.y=t.head.y-20,t.addChildAt(this.dialogue,2)),this.dialogue.setText(this.texts[n]),this.timerId=egret.setTimeout(this.loop,this,2*Game.Second)}},e.prototype.release=function(){null!=this.timerId&&(egret.clearTimeout(this.timerId),this.timerId=null),this.charId=null,this.texts=null,null!=this.dialogue&&(Game.removeFromParent.apply(this.dialogue),this.dialogue=null)},e}();__reflect(Speech.prototype,"Speech");var table;!function(e){function t(e){for(var t=e[e.length-1].nodePos,n=new Array(t),i=1;i<e.length;i++)for(var a=e[i-1].nodePos,r=e[i-1].nodeVar,o=e[i].nodePos,s=e[i].nodeVar,l=s-r,u=o-a,c=a;o>=c;c++)n[c-1]=l*(c-a)/u+r;return n}function n(e){for(var t=Math.floor(e[e.length-1].nodePos),n=new Array(t),i=1;i<e.length;i++)for(var a=Math.floor(e[i-1].nodePos),r=e[i-1].nodeVar,o=Math.floor(e[i].nodePos),s=e[i].nodeVar,l=Math.floor(s-r),u=Math.floor(o-a),c=a;o>=c;c++)n[c-1]=Math.floor(l*(c-a)/u)+Math.floor(r);return n}function i(t){return t>=0&&t<e.gemAutoMountConfig.plans.length?e.gemAutoMountConfig.plans[t]:null}function a(e,t){var n;n=e?et.guildAward:et.personalAward;for(var i=n.length-1;i>=0;i--)if(t>=n[i].week)return n[i];return null}function r(){var e=["config/scenes/guildwar2/guild_award.json","config/scenes/guildwar2/personal_award.json"];et={guildAward:null,personalAward:null},et.guildAward=RES.getRes(e[0]),et.personalAward=RES.getRes(e[1])}function o(t,n){if(t>=0&&t<e.rankAwardCfg.types.length){var i=e.rankAwardCfg.types[t];if(n>=1&&n<=i.round.length)return i.round[n-1]}return null}function s(){var t=["public_config/rankaward/rankaward_level.json","public_config/rankaward/rankaward_fp.json"];e.rankAwardCfg={types:[]};for(var n=0;n<t.length;n++){for(var i=RES.getRes(t[n]),a=0;a<i.roundAwards.length;a++)for(var r=i.roundAwards[a],o=0;o<r.awards.length;o++){var s=r.awards[o];s.minAwardRank==s.maxAwardRank?s.name="Thưởng Hạng "+s.minAwardRank:s.name="Thưởng Hạng "+s.minAwardRank+"-"+s.maxAwardRank}i.round=[];for(var a=0;a<i.round2Award.length;a++)i.round.push(i.roundAwards[i.round2Award[a]-1]);e.rankAwardCfg.types.push(i)}}function l(){e.l10n=RES.getRes("l10n.json");var t=RES.getRes("config/maps.json"),n=t.length;e.maps={};for(var i=0;n>i;i++){var a=t[i];if(e.maps[a.id]=a,a.preload){for(var o=[],l=a.preload.length,L=0;l>L;L++)o.push(a.preload[L]);o.length>0&&RES.createGroup("map_"+a.id,o)}}for(var R in e.maps)0!=e.maps[R].wild&&(null==e.wilds[e.maps[R].level]&&(e.wilds[e.maps[R].level]=[]),e.wilds[e.maps[R].level].push({Id:Number(R),map:e.maps[R]}));x(),e.equipfp=RES.getRes("config/equipfp.json"),e.bookCost=RES.getRes("public_config/bookcost.json"),e.npcs=RES.getRes("public_config/npcs.json");for(var U in e.npcs){var Y=e.npcs[U];Y.popupSkills_={};for(var i=Y.skills.length-1;i>=0;i--){var Q=Y.skills[i];null!=Q.popup&&Q.popup&&(Y.popupSkills_[Q.id]=!0)}}e.objs=RES.getRes("config/objs.json"),e.npc_dialogues=RES.getRes("config/npc_dialogues.json");for(var Z=RES.getRes("public_config/faction.json"),i=0;i<Z.length;i++){var $=Z[i];e.faction[$.id]=$}e.skillpower=RES.getRes("public_config/skillpower.json");for(var et=RES.getRes("public_config/level.json"),i=0;i<et.length;i++){var $=et[i];e.level[$.level]=$,e.maxLevel<$.level&&(e.maxLevel=$.level)}var tt=RES.getRes("public_config/levelupgift.json");for(var R in tt)e.levelUpGift[R]={awards:tt[R],status:!1};var nt=RES.getRes("public_config/levelupgiftvip.json");for(var R in nt)e.levelUpGiftVIP[R]={awards:nt[R],status:!1};for(var it=RES.getRes("config/level_features.json"),i=0;i<it.length;i++){var $=it[i];e.level_features[$.level]=$}var at=RES.getRes("public_config/enhancement.json");e.enhancement[Game.EquipPart.EquipWeapon]=at.Weapon,e.enhancement[Game.EquipPart.EquipNecklace]=at.Necklace,e.enhancement[Game.EquipPart.EquipRing]=at.Ring,e.enhancement[Game.EquipPart.EquipPendant]=at.Pendant,e.enhancement[Game.EquipPart.EquipHelmet]=at.Helmet,e.enhancement[Game.EquipPart.EquipArmor]=at.Armor,e.enhancement[Game.EquipPart.EquipCuff]=at.Cuff,e.enhancement[Game.EquipPart.EquipBoot]=at.Boot,e.enhancement[Game.EquipPart.EquipCount]=at.Extra;var rt=RES.getRes("public_config/enhance_convert.json");n=rt.length;for(var i=0;n>i;i++){var $=rt[i];e.enhanceconvert[$.level]=$.count}e.enhanceCost=RES.getRes("public_config/enhance_cost.json"),m(),f(),v(),b(),S(),E(),y(),C(),I(),G(),A(),k(),P(),w(),_(),F(),O(),N(),M(),D(),V(),q(),j(),H(),e.LoadBravePalaceCfg(),e.LoadGroupDungeon(),e.LoadMapEffectConfig(),e.LoadPassiveSkill(),monthlyactivity.Init(),e.effects=RES.getRes("config/effect.json"),e.actor=RES.getRes("config/character.json"),e.offlineAward=RES.getRes("public_config/offlineaward.json"),e.cumulativeLoginBonus=RES.getRes("config/cumulative_login_bonus.json"),e.compositGamesSevenDayGift=RES.getRes("config/compositegames/sevendaygift.json"),e.gemAttr=RES.getRes("public_config/gem_attribute.json"),e.meridian=RES.getRes("public_config/meridian.json"),e.partnerExp=RES.getRes("public_config/partner/partner_exp.json"),e.partnerCfg=RES.getRes("public_config/partner/partner.json"),e.partnerBreakthrough=RES.getRes("public_config/partner/partner_breakthrough.json"),e.partnerPiecesSale=RES.getRes("public_config/partner/partner_pieces_sale.json"),T(),e.encounter=RES.getRes("public_config/encounter.json"),e.dailyMark=RES.getRes("public_config/dailymark.json"),e.fakePartnerSkill=RES.getRes("config/fakenpc/fakepartnerskills.json"),e.dungeonAssistCfg=RES.getRes("public_config/dungeonassist.json"),g(),p(),c(),h(),d(),e.wanderings=RES.getRes("config/wanderingsitem.json");for(var ot in e.wanderings)for(var i=0;i<e.wanderings[ot].length;i++)e.mapWanderings[e.wanderings[ot][i].kind]=e.wanderings[ot][i];X();var st=RES.getRes("public_config/moneytree.json");e.moneytreeTimes=st.irrigatetimes,u();var lt=RES.getRes("public_config/shop/guildshop_daily.json"),ut=RES.getRes("public_config/shop/guildshop_monthly.json");e.guildShop[0]=lt,e.guildShop[1]=ut,B(),W(),yesouTaskManager.Load(),PartnerEquipManager.Load(),e.huashanpkPublicConfig=RES.getRes("public_config/huashanpk_award.json"),e.guildwarConfig=RES.getRes("public_config/guildwar.json"),e.gemAutoMountConfig=RES.getRes("config/gem/auto_mount.json"),HuashanPK.load(),K(),GuildArmament.LoadRes(),Babel.LoadRes(),s(),r(),e.gameTipData_=RES.getRes("config/game_tips.json"),J(),collectCardManager.LoadCfg(),e.notices=RES.getRes("config/updateIssues.json"),CityHome.loadConfig(),z()}function u(){e.wllsConfigs=RES.getRes("public_config/wulinliansai.json")}function c(){var t=RES.getRes("config/guildwaraward.json");for(var n in t)e.guildWarAward[parseInt(n)]=t[n]}function h(){var t=RES.getRes("config/heroic_card_taskaward.json");for(var n in t)e.HeroCardShowAward[parseInt(n)]=t[n]}function d(){var t=[];t=RES.getRes("public_config/guildwartask.json");for(var n=0;n<t.length;n++)e.guildwarTask[t[n].taskId]=t[n]}function p(){var t=RES.getRes("config/weaponrankgift.json");for(var n in t)e.weaponRankGift[parseInt(n)]=t[n]}function g(){var t;t=RES.getRes("config/resourceObtain.json");for(var n=0;n<t.length;n++)e.resObtainCfg[t[n].id]=t[n]}function m(){for(var t=0;t<Z.length;t++){for(var n=RES.getRes(Z[t]),i={},a=0;a<n.length;a++)i[n[a].id]=n[a];e.equips[t]=i}}function f(){for(var t in $)for(var n=Number(t),i=RES.getRes($[n]),a=0;a<i.length;a++){var r=i[a];null==e.props[n]&&(e.props[n]={}),null!=r.params&&null==r.params.requireCount&&(r.params.requireCount=1),e.props[n][r.id]=r}}function v(){for(var t=RES.getRes("public_config/item_book.json"),n=0;n<t.length;n++){var i=t[n];i.category--,e.books[i.id]=i}}function y(){for(var t=RES.getRes("public_config/item_wenshi.json"),n=0;n<t.length;n++){var i=t[n];e.wenshis[i.id]=i}}function b(){for(var t="public_config/item_material.json",n=RES.getRes(t),i=0;i<n.length;i++){var a=n[i],r=a.genre;null==e.props[r]&&(e.props[r]={}),e.props[r][a.id]=a}}function S(){for(var t="public_config/item_partnerequip.json",n=RES.getRes(t),i=0;i!=n.length;i++){var a=n[i];e.partnerEquips[a.detail]=a}}function E(){var t="public_config/item_juexue.json";e.juexues=RES.getRes(t),(null==e.juexues||0==e.juexues.length)&&egret.error("load file error:"+t);var n="public_config/item_juexue_attrs.json";e.juexueattrs=RES.getRes(n),null==e.juexueattrs&&egret.error("load file error:"+n);var i="public_config/item_juexue_suit.json";e.juexuesuits=RES.getRes(i),(null==e.juexuesuits||0==e.juexuesuits.length)&&egret.error("load file error:"+i);var a="public_config/item_juexue_levelup.json";e.juexuelevelup=RES.getRes(a),null==e.juexuelevelup&&egret.error("load file error:"+a)}function C(){e.challenges=RES.getRes("config/masterchallenge/challenge.json")}function T(){for(var t=RES.getRes("public_config/talent_skill.json"),n=0;n<t.length;n++){var i=t[n].id,a=t[n];(null==a.kind||""==a.kind)&&(a.kind="default"),a.popBgImagePath_="";var r=Skill.mapSkillKind[a.kind];null!=r&&(a.popBgImagePath_=r.popBgImage),e.talentSkillCfg[i]=a}}function I(){var t="public_config/wildboss.json",n=RES.getRes(t);if(null!=n){e.wildBossCfg={maxTotalTimes:n.maxTotalTimes,showPropByOpenSvrDay:n.showPropByOpenSvrDay,missions:{}};for(var i=0;i<n.missions.length;i++){var a=n.missions[i];e.wildBossCfg.missions[a.id]=a}}}function G(){var t="public_config/littleboss.json",n=RES.getRes(t);if(null!=n){e.littleBossCfg={};for(var i=0;i<n.length;i++){var a=n[i];e.littleBossCfg[a.id]=a}}}function A(){var t="public_config/rewardretrieve.json",n=RES.getRes(t);if(null!=n){e.rewardRetrieveItems={};for(var i=0;i<n.length;i++){var a=n[i];e.rewardRetrieveItems[a.id]=a}}}function k(){var t="config/rewardretrieve/awards.json",n=RES.getRes(t);null!=n&&(e.rewardRetrieveAwards=n)}function P(){var t="public_config/vipbox.json";e.vipBoxes=RES.getRes(t),null==e.vipBoxes&&egret.error("cannot load config:",t),e.vipBoxes[0]=e.vipBoxes[1],t="public_config/vipexp.json",e.vipExps=RES.getRes(t),null==e.vipExps&&egret.error("cannot load config:",t),e.vipExps[0]=e.vipExps[1]}function w(){var t,n;e.equipBaseAttrs=[];for(var i=0;6>i;i++){t="public_config/equip"+i+"_baseattribute.json",n=RES.getRes(t);for(var a=[],r=n.length,o=0;r>o;o++){var s=10*(o+1);if(s!=n[o].level){egret.error("config file error:"+t);break}a[o]={};for(var l=n[o].equips,u=l.length,c=0;u>c;c++){var h=U(l[c].part);a[o][h]=l[c]}}e.equipBaseAttrs.push(a)}}function L(t,n,i){var a=null,r=int((n-1)/10),o=e.equipBaseAttrs[t];return r>=0&&(r>=o.length&&(r=o.length-1),a=o[r][i]),a}function R(e){return null!=e.attack&&0!=e.attack?Buff.GetDesc(1,[e.attack],!0):null!=e.life&&0!=e.life?Buff.GetDesc(17,[e.life],!0):null!=e.defense&&0!=e.defense?Buff.GetDesc(7,[e.defense],!0):""}function U(e){switch(e){default:return-1;case"weapon":return Game.EquipPart.EquipWeapon;case"necklace":return Game.EquipPart.EquipNecklace;case"ring":return Game.EquipPart.EquipRing;case"pendant":return Game.EquipPart.EquipPendant;case"helmet":return Game.EquipPart.EquipHelmet;case"armor":return Game.EquipPart.EquipArmor;case"cuff":return Game.EquipPart.EquipCuff;case"boots":return Game.EquipPart.EquipBoot}}function _(){var t="public_config/auction_time.json";e.auctionGuildCates=RES.getRes(t),null==e.auctionGuildCates&&egret.error("cannot load config:",t)}function x(){var t=RES.getRes("public_config/avatar/avatar_cost.json"),n=RES.getRes("public_config/avatar/avatar_attribute.json"),i=RES.getRes("public_config/avatar/avatar.json"),a={};for(var r in t){for(var o=t[r],s={genre:o.genre,detailType:o.detailType,cost:[]},l=0,u=o.cost;l<u.length;l++)for(var c=u[l],h=c.start;h<=c.end;h++)s.cost[h-1]=c.count;a[Number(r)]=s}var d={};for(var r in n)for(var s=[],p=0,g=n[r];p<g.length;p++){for(var c=g[p],h=c.start;h<=c.end;h++)s[h-1]={fp:c.fp*h,attack:c.attack*h,defense:c.defense*h,life:c.life*h,strike:c.strike*h,antiStrike:c.antiStrike*h,hit:c.hit*h,dodge:c.dodge*h,recoverLife:c.recoverLife*h,seriesAggravation:c.seriesAggravation*h};d[Number(r)]=s}e.avatars={};for(var r in i){var o=i[r],m=a[o.cost],f=parseInt(r);e.avatars[f]={id:f,name:o.name,resource:o.resource,costs:m.cost,item:{genre:m.genre,detailType:m.detailType},attributes:d[o.attribute]}}}function M(){var e,t="public_config/guildGrowInfo.json";e=RES.getRes(t),null==e&&egret.error("cannot load config:",t),Guild.maxMembercounts=[],Guild.maxMembercounts.push(0);for(var n=0;n<e.maxMember.length;n++)Guild.maxMembercounts.push(e.maxMember[n]);Guild.maxReputations=[],Guild.maxReputations.push(0);for(var n=0;n<e.needReputation.length;n++)Guild.maxReputations.push(e.needReputation[n]);Guild.maxReputations.push(0),RES.hasRes("config.zip")||RES.destroyRes(t)}function D(){var t="public_config/guildsalary.json";e.guildSalary=RES.getRes(t),null==e.guildSalary&&egret.error("cannot load config:",t),RES.hasRes("config.zip")||RES.destroyRes(t)
}function N(){var t,n="public_config/guildskill.json";t=RES.getRes(n),null==t&&egret.error("cannot load config:",n),e.mapGuildSkill={};for(var i=0;i<t.length;i++){var a=t[i];e.mapGuildSkill[a.id]=a}RES.hasRes("config.zip")||RES.destroyRes(n)}function F(){var t="public_config/superweapons.json";e.superWeaponCfg=RES.getRes(t);var n;t="public_config/superweapon_cost.json",n=RES.getRes(t);var i;t="public_config/superweapon_prop.json",i=RES.getRes(t);for(var a=1;a<=SuperWeapon.MaxWeapons;a++){var r=e.superWeaponCfg[a],o=n[r.costId];r.costs={cost:{genre:o.cost.genre,detailType:o.cost.detailType},num:{}};for(var s=0;s<o.num.length;s++)for(var l=o.num[s].levelFrom;l<=o.num[s].levelTo;l++)r.costs.num[l]=o.num[s].count;var u=i[r.propsId];r.props={};for(var s=0;s<u.length;s++)for(var l=u[s].levelFrom;l<=u[s].levelTo;l++){var c=null;l>1?(c=r.props[l-1],c||egret.error("superwepon prop config error")):c={},r.props[l]={attack:(u[s].addValue.attack||0)+(c.attack||0),defense:(u[s].addValue.defense||0)+(c.defense||0),life:(u[s].addValue.life||0)+(c.life||0),fp:(u[s].addValue.fp||0)+(c.fp||0),strike:(u[s].addValue.strike||0)+(c.strike||0),antiStrike:(u[s].addValue.antiStrike||0)+(c.antiStrike||0),hit:(u[s].addValue.hit||0)+(c.hit||0),dodge:(u[s].addValue.dodge||0)+(c.dodge||0),recoverLife:(u[s].addValue.recoverLife||0)+(c.recoverLife||0),seriesAggravation:(u[s].addValue.seriesAggravation||0)+(c.seriesAggravation||0)}}}}function O(){var t="config/vipprivilegedesc.json";e.vipPrivilegeDesc=RES.getRes(t)}function B(){var t="public_config/tenfoldexp.json";e.tenFoldExpCfg=RES.getRes(t)}function W(){var t="public_config/guilddonate.json",n=RES.getRes(t);null==n&&egret.error("cannot load config:",t);var i=n.vipDonateCount,a=n.goldDonateInfo,r=n.silverDonateInfo;e.mapVipDonateCount={};for(var o=0;o<i.length;++o){var s=i[o];e.mapVipDonateCount[s.vipLv]=s}e.mapGoldDonateInfo={};for(var o=0;o<a.length;++o){var l=a[o];l.countRange[0]>l.countRange[1]&&egret.error("countRange:[min,max] min > max",t);for(var u=l.countRange[0];u<=l.countRange[1];++u)e.mapGoldDonateInfo[u]=l}e.mapSilverDonateInfo={};for(var o=0;o<r.length;++o){var l=r[o];l.countRange[0]>l.countRange[1]&&egret.error("countRange:[min,max] min > max",t);for(var u=l.countRange[0];u<=l.countRange[1];++u)e.mapSilverDonateInfo[u]=l}}function V(){var t="public_config/guildbusitask.json";e.guildBusiTask=RES.getRes(t),null==e.guildBusiTask&&egret.error("cannot load config:",t),RES.hasRes("config.zip")||RES.destroyRes(t)}function q(){var t="public_config/guildbuildhouse.json";e.guildEquipbuildHouse=RES.getRes(t),null==e.guildEquipbuildHouse&&egret.error("cannot load config:",t),RES.hasRes("config.zip")||RES.destroyRes(t)}function H(){var t="public_config/heroic_card.json";e.heroicCardCfg=RES.getRes(t)}function j(){var t="public_config/equipmake.json";e.equipMakeConfig=RES.getRes(t),null==e.equipMakeConfig&&egret.error("cannot load config:",t),RES.hasRes("config.zip")||RES.destroyRes(t)}function Y(t){var n=e.huashanpkPublicConfig.awards.length;if(0==n)return null;for(var i=-1,a=0;n>a&&t>=e.huashanpkPublicConfig.awards[a].round;a++)i=a;return-1==i?null:e.huashanpkPublicConfig.awards[i]}function K(){var t="config/dailytips.json";e.dailyTipsCfg=RES.getRes(t),RES.hasRes("config.zip")||RES.destroyRes(t)}function Q(){var t=new Array;if(!e.dailyTipsCfg)return t;for(var n=Game.countEraDay(),i=new Date,a=1e4*i.getFullYear()+100*(i.getMonth()+1)+i.getDate(),r=e.dailyTipsCfg.length,o=0;r>o;o++){var s=e.dailyTipsCfg[o];1==s.kind?n>=s.dateFrom&&n<s.dateTo&&t.push(s):a>=s.dateFrom&&a<=s.dateTo&&t.push(s)}return e.notices&&egret.localStorage.getItem("noticeVersion")!=e.notices.version&&t.unshift({title:e.notices.title,desc:e.notices.desc,icon:e.notices.icon,operation:e.notices.operation}),t}function X(){for(var t in e.wanderings)for(var n=e.wanderings[t].length,i=0;n>i;i++)if(13==e.wanderings[t][i].kind)return void(QinMausoleum.awardsData=e.wanderings[t][i].awards)}function J(){var t="public_config/equiprinse.json";e.equipRinse=RES.getRes(t),RES.hasRes("config.zip")||RES.destroyRes(t)}function z(){e.HaloResources[1]="tw_twzhanyi",e.HaloResources[2]="buff_defense_03_a",e.HaloResources[3]="buff_power_01",e.HaloResources[4]="buff_power_06",e.HaloResources[5]="buff_rebound_07"}e.ParseSegmentVar=t,e.ParseSegmentVarInt=n,e.wanderings={},e.mapWanderings={},e.wllsConfigs=[],e.level={},e.maxLevel=0,e.levelUpGift={},e.levelUpGiftVIP={},e.level_features={},e.faction={},e.books={},e.wenshis={},e.equips=[],e.props={},e.partnerEquips={},e.juexues=[],e.juexuesuits=[],e.enhancement=[],e.wilds={},e.blendMode={},e.enhanceconvert={},e.enhanceCost=[],e.resObtainCfg={},e.fakePartnerSkill=[];var Z=["public_config/equip_helmet.json","public_config/equip_armor.json","public_config/equip_cuff.json","public_config/equip_boots.json","public_config/equip_weapon.json","public_config/equip_necklace.json","public_config/equip_ring.json","public_config/equip_pendant.json"],$={1:"public_config/item_box.json",5:"public_config/item_gem.json",7:"public_config/item_bookdebris.json",8:"public_config/item_partner.json",18:"public_config/equip_pieces.json"};e.challenges=[],e.partnerExp=[],e.partnerCfg=[],e.partnerBreakthrough=[],e.talentSkillCfg={};e.tmx={},e.moneytreeTimes=[],e.dungeonAssistCfg=[],e.guildShop=[[],[]],e.guildwarTask={},e.GetGemAutoMountPlanConfig=i;var et;e.getGuildwar2AwardConfig=a,e.getRankAwardConfig=o,e.load=l,e.guildWarAward=[],e.HeroCardShowAward=[],e.weaponRankGift=[],e.getEquipBaseAttr=L,e.getAttrDesc=R,e.getHuashanPKAwardByRound=Y,e.getValidDailyTips=Q,e.HaloResources=egret.createMap()}(table||(table={}));var test;!function(e){function t(t){for(var n=0,i=e.tracks;n<i.length;n++){var a=i[n];Game.removeFromParent.apply(a)}e.tracks=[];for(var r=0;r<t.length;r++){var o=new egret.TextField;o.text=""+r;var s=Scene.logicPos2DisplayPos(t[r]);o.x=s.x,o.y=s.y,Scene.addChild(o),e.tracks.push(o)}}function n(){for(var t=0,n=e.tracks;t<n.length;t++){var i=n[t];Game.removeFromParent.apply(i)}}function i(){e.old=PlayerAttribute.Exp,u=setInterval(function(){console.log("Nhận EXP: "+(PlayerAttribute.Exp-e.old)),e.old=PlayerAttribute.Exp},6e4),console.log("Bắt đầu tính hiệu suất EXP")}function a(){clearTimeout(u),console.log("Tắt tính hiệu suất EXP")}function r(){SecondTicker.addEventListener(s,null)}function o(){SecondTicker.removeEventListener(s,null)}function s(){var e={n:0,l:0};for(var t in c)e.n+=c[t].n,e.l+=c[t].l,"3"==t&&console.log(t,c[t]);c={}}function l(e,t){null==c[e]?c[e]={n:1,l:length}:(c[e].l+=length,c[e].n+=1)}e.autoReady=!0,e.debugAttribute=!1,e.tracks=[],e.addtrack=t,e.deltrack=n,e.old=0;var u;e.startCalcExp=i,e.stopCalcExp=a,e.startStatNetPack=r,e.stopStatNetPack=o;var c={};e.statNetPack=l}(test||(test={}));var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,n,i){e=e.replace("resource/","");var a=RES.getRes(e);null==a?RES.getResAsync(e).then(function(e){t.call(i,e)})["catch"](function(e){n.call(i,e)}):egret.callLater(t,i,a)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var AutoNamed;!function(e){function t(){r=RES.getRes("config/random_name/first_name.json"),o=RES.getRes("config/random_name/male_name.json"),e.femaleName=RES.getRes("config/random_name/female_name.json")}function n(){if(null==r||null==o)return"";for(var e=0;128>e;e++){var t=r[Math.floor(Math.random()*r.length)]+o[Math.floor(Math.random()*o.length)];if(t.length>=s&&t.length<=l)return t}return""}function i(){if(null==r||null==e.femaleName)return"";for(var t=0;128>t;t++){var n=r[Math.floor(Math.random()*r.length)]+e.femaleName[Math.floor(Math.random()*e.femaleName.length)];if(n.length>=s&&n.length<=l)return n}return""}function a(t){if(null==r||null==e.femaleName)return"";if(0>t||t>=e.femaleName.length)return"";for(var n=0;128>n;n++){var i=r[Math.floor(Math.random()*r.length)]+e.femaleName[t];if(i.length>=s&&i.length<=l)return i}return""}var r,o,s=4,l=16;e.init=t,e.randomMale=n,e.randomFemale=i,e.randomScrollName=a}(AutoNamed||(AutoNamed={}));var TmpCamp;!function(e){function t(e,t){return e>t?t+","+e:e+","+t}function n(n,i){return null==e.relations?!0:1==this.relations[t(n,i)]}function i(){e.relations=null}function a(n,i){null==e.relations&&(e.relations={});for(var a=!1,r=0,o=n.enemies;r<o.length;r++){var s=o[r],l=s.camp;l==i&&(a=!0);for(var u=0,c=s.list;u<c.length;u++){var h=c[u];h==i&&(a=!0),e.relations[t(l,h)]=!0}}return a}e.IsRelated=n,e.clear=i,e.update=a}(TmpCamp||(TmpCamp={}));var announce;!function(e){function t(e,t){return e.priority==t.priority?t.time-e.time:e.priority-t.priority}var n=function(){function e(e,t,n){this.messages=[],this.layer=e,this.speed=n,this.playing=!1,this.tf=new UI.AnnounceUI;var i=this.tf;i.anchorOffsetY=10,i.y=t}return e.prototype.showAnnounce=function(e,t){this.playing=!0;var n=this.tf,i=this.layer;n.width=Math.ceil(3*i.width/4),n.x=Math.ceil(i.width/8),n.textFlow=Game.TextParser.parse(e,t),n.UpdateMask(),i.addChild(n),n.msgbg.width=Math.ceil(3*i.width/4),n.label.x=Math.ceil(7*i.width/8),n.label.anchorOffsetX=n.label.width/2,n.label.width<n.width?egret.Tween.get(n.label).to({x:Math.ceil(3*i.width/8)},this.speed).wait(200).to({alpha:0},100).to({alpha:1},200).wait(500).to({alpha:0},100).to({alpha:1},200).wait(700).to({alpha:0},100).to({alpha:1},200).wait(700).call(Game.removeFromParent,n).call(this.pop,this):egret.Tween.get(n.label).to({x:0},5*this.speed).call(Game.removeFromParent,n).call(this.pop,this)},e.prototype.pop=function(){var e=this.messages.shift();null!=e?this.showAnnounce(e.text,e.attachments):this.playing=!1},e.prototype.clear=function(){this.messages=[],this.playing=!1},e.prototype.push=function(e,n,i){this.playing?(this.messages.push({text:n,priority:e,attachments:i,time:egret.getTimer()}),this.messages.sort(t)):this.showAnnounce(n,i)},e}();e.Marquee=n,__reflect(n.prototype,"announce.Marquee")}(announce||(announce={}));var AI;!function(e){function t(){var e={id:null,minDistance:700,kind:0},t={x:480,y:480},n=Player.instance;for(var i in mapCharacter){var a=mapCharacter[i];if(null!=a&&a.Id!=n.Id&&!a.dead&&Scene.isHostile(a)){if(Math.abs(n.logicPos.x-a.logicPos.x)>t.x||Math.abs(n.logicPos.y-a.logicPos.y)>t.y)continue;var r=egret.Point.distance(a.logicPos,n.logicPos),o=a.isMirror?1:a.kind;switch(Setting.TargetPriority()){default:e.minDistance>r&&(e.id=a.Id,e.minDistance=r,e.kind=o);break;case T.monster:o==e.kind?e.minDistance>r&&(e.id=a.Id,e.minDistance=r,e.kind=o):2!=e.kind&&(e.id=a.Id,e.minDistance=r,e.kind=o);break;case T.player:o==e.kind?e.minDistance>r&&(e.id=a.Id,e.minDistance=r,e.kind=o):1!=e.kind&&(e.id=a.Id,e.minDistance=r,e.kind=o)}}}return e.id}function n(){I=!0,e.bb.player=Player.instance,e.action=bt.factories[1](),e.action.Initialize(e.bb)}function i(){if(I){var t=egret.getTimer();e.bb.player.frozenTime<t&&e.bb.player.stunTime<t&&e.action.Execute(e.bb)}}function a(){e.bb.beacon&&e.bb.beacon.parent&&Scene.removeChild(e.bb.beacon),e.action&&e.action.Uninitialize(),I=!1}function r(t){if(null!=World&&t.target==World.tmxTileMap&&(!e.joystick||t.touchPointID!=e.joystick.touchID)&&!e.bb.joystick&&Scene.isReady()){var n=Scene.globalToLocal(t.stageX,t.stageY);n.x=n.x,n.y=n.y;var i=Scene.displayPos2LogicPos(n);i.x=~~i.x,i.y=~~i.y;var a=Scene.SearchPath(Player.instance.logicPos,i,!0);null!=a&&(i=a[0],Scene.logicPos2DisplayPos(i,n),e.bb.beacon.x=n.x,e.bb.beacon.y=n.y,Player.instance.revisePos=null,Scene.addChild(e.bb.beacon),d(null),h(null))}}function o(){var t=egret.MainContext.instance.stage;t.addEventListener(egret.TouchEvent.TOUCH_END,r,null,!1,1e4);var n=new UI.MovieClipComponent;n.width=2,n.height=2,n.contentJustify=!1,n.justify=!1,n.auto=!0,n.Load("skill/beacon/beacon.json","beacon"),e.bb.beacon=n,bt.leafFactoryCreator.move=function(){return bt.loadLeaf(g)},bt.leafFactoryCreator.touchSceneObj=function(){return bt.loadLeaf(p)},bt.leafFactoryCreator.revise=function(){return bt.loadLeaf(v)},bt.leafFactoryCreator.idle=function(){return bt.loadLeaf(b)},bt.leafFactoryCreator.selectSkill=function(){return bt.loadLeaf(y)},bt.leafFactoryCreator.castSkill=function(){return bt.loadLeaf(m)},bt.leafFactoryCreator.waitAction=function(){return bt.loadLeaf(f)},bt.leafFactoryCreator.clientNpcAttack=function(){return bt.loadLeaf(S)},bt.leafFactoryCreator.followPlayer=function(e){return bt.loadLeaf(E,e.pos)},bt.leafFactoryCreator.joystickMove=function(){return bt.loadLeaf(C)}}function s(){Game.removeFromParent.apply(e.bb.beacon)}function l(e){if(e){var t=mapCharacter[e];return t&&!t.dead&&Scene.isHostile(t)?!0:!1}return!1}function u(n){var i=Skill.mapSkill[n];return"self"==i.lockType||"selfaoe"==i.lockType?e.bb.player.dead?e.bb.skillTarget=null:e.bb.skillTarget=e.bb.player.Id:l(e.bb.select)?e.bb.skillTarget=e.bb.select:h(t()),e.bb.skillTarget?(e.bb.skill=n,0):1}function c(t){var n=Scene.logicPos2DisplayPos(t);e.bb.beacon.x=n.x,e.bb.beacon.y=n.y,Scene.addChild(e.bb.beacon)}function h(t){e.bb.skillTarget=t,e.bb.select=t,t?e.bb.touchObj=null:e.bb.skill=null}function d(t){(!t||ECS.SceneObjectComponent.objs[t])&&(e.bb.touchObj=t,t&&(e.bb.select=null))}var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.Execute=function(e){if(!e.touchObj)return 1;var t=e.player;if(t.workingCmd.action==Action.Status.Casting)return 1;var n,i=ECS.SceneObjectComponent.objs[e.touchObj];if(!i)return 1;if(egret.$TempPoint.setTo(i.x,i.y),g_WithInRange(t.logicPos,egret.$TempPoint,66))return i.touch(),e.touchObj=null,t.navClear(),0;var a=g_GetDirIndex(egret.$TempPoint,t.logicPos),r=g_Move(a,MAX_DIR);n=egret.$TempPoint.add(r);var o=t.getCurTargetPoint();null!=t.navPath&&t.navPath.length>0&&(o=t.navPath[0]);var s=Scene.SearchPath(t.logicPos,n,!1);if(null!=s){if(null!=o&&g_WithInRange(o,s[0],66))return 2;t.nav(s)}return 2},t}(bt.EmptyAction);e.TouchSceneObj=p,__reflect(p.prototype,"AI.TouchSceneObj");var g=function(){function e(){}return e.prototype.Initialize=function(e){this.timeout=0,this.oldPoint=egret.Point.create(0,0),this.desPoint=egret.Point.create(0,0)},e.prototype.Uninitialize=function(){},e.prototype.Reset=function(){this.oldPoint=egret.Point.create(0,0),this.desPoint=egret.Point.create(0,0)},e.prototype.Execute=function(e){var t=e.player;if(t.dead)return 1;if(!e.beacon||!e.beacon.stage)return 1;egret.$TempPoint.setTo(e.beacon.x,e.beacon.y);var n=Scene.displayPos2LogicPos(egret.$TempPoint);switch(t.workingCmd.action){case Action.Status.Idle:break;case Action.Status.Running:if(this.desPoint.equals(Game.ZeroPoint)||!n.equals(this.desPoint))break;return this.timeout=egret.getTimer()+200,2;default:return this.timeout=egret.getTimer()+200,1}return g_WithInRange(t.logicPos,n,t.MoveSpeed/Game.ServerFPS)?(Game.removeFromParent.apply(e.beacon),0):(this.oldPoint.equals(t.logicPos)&&this.timeout<egret.getTimer()&&t.navClear(),null!=t.navPath&&t.navPath.length>0&&g_WithInRange(t.navPath[0],n,100)?2:t.navTo(n,!0,!1)?(this.oldPoint.copyFrom(t.logicPos),this.timeout=egret.getTimer()+200,2):1)},e}();e.Move2Beacon=g,__reflect(g.prototype,"AI.Move2Beacon",["bt.Action"]);var m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.Execute=function(e){var t=e.player;if(t.workingCmd.action==Action.Status.Casting)return 1;if(!e.skill)return 1;var n=e.skillTarget;if(!n)return 1;var i=PlayerAttribute.findSkill(e.skill);if(null==i||i.Locked)return e.skill=null,1;if(!PlayerAttribute.canCastSkill(e.skill))return e.skill=null,1;var a=mapCharacter[n];if(!a||a.dead)return e.skill=null,1;var r=Skill.mapSkill[i.Id],o=Skill.mapSkill[r.id];if("self"==o.lockType||"selfaoe"==o.lockType){if(n!=e.player.Id)return e.skill=null,1}else if(!Scene.isHostile(a))return e.skill=null,1;var s=a.logicPos,l=.9;if(r.distance>0&&!g_WithInRange(t.logicPos,s,r.distance*l)){var u=g_GetDirIndex2(t.logicPos,s),c=(u.dir,u.sin),h=u.cos,d=egret.Point.distance(t.logicPos,s),p=egret.Point.create(t.logicPos.x+(h*d>>10),t.logicPos.y+(c*d>>10)),g=t.getCurTargetPoint();null!=t.navPath&&t.navPath.length>0&&(g=t.navPath[0]);var m=Scene.SearchPath(t.logicPos,p,!1);if(null==m&&(m=Scene.SearchPath(t.logicPos,s,!0)),null!=m){if(null!=g&&g_WithInRange(g,m[0],100))return 2;t.nav(m)}return 2}var f=i.GetFinalLevel();switch(r.type){case"char":t.SendCharSkill(r.id,f,a.Id);break;case"aoe":r.castTarget?t.SendAoeSkill(r.id,f,a.logicPos):t.SendAoeSkill(r.id,f,t.logicPos);break;case"dir":var v=void 0;v=t.logicPos.equals(a.logicPos)?t.dir64:g_GetDirIndex(t.logicPos,a.logicPos),t.SendDirSkill(r.id,f,v);break;default:egret.error("skill="+r.id+" type="+r.type+" not found")}e.skill=null,t.navPath=null;var y=Skill.GetSkillTime(o.actionTime,t.AttackSpeed).lifeTime;return e.wait=egret.getTimer()+Math.max(y,100),0},t}(bt.EmptyAction);e.CastSkill=m,__reflect(m.prototype,"AI.CastSkill");var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.Execute=function(e){var t=e.player,n=e.wait;return n?t.workingCmd.action!=Action.Status.Casting?n<egret.getTimer()?0:2:(e.wait=null,0):0},t}(bt.EmptyAction);e.WaitAction=f,__reflect(f.prototype,"AI.WaitAction");var v=function(){function e(){}return e.prototype.Initialize=function(e){},e.prototype.Uninitialize=function(){},e.prototype.Reset=function(){this.curPoint=null},e.prototype.Execute=function(e){var t=e.player;return t.workingCmd.action!=Action.Status.Idle?0:t.revisePos?null!=this.curPoint&&t.revisePos.equals(this.curPoint)?t.revisePos.equals(this.curPoint)?(this.curPoint=null,t.revisePos=null,0):void 0:(this.curPoint=t.revisePos,t.moveTo(t.revisePos,!0),2):0},e}();e.ReviseMove=v,__reflect(v.prototype,"AI.ReviseMove",["bt.Action"]);var y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.Execute=function(e){var t=Setting.auto&&null==UI.gathering;if(Setting.landscapeMode||t||!l(e.select)||(t=!0),e.skill||!t||e.joystick)return 0;var n=this.getSkill();return n&&u(n.Id)?0:1},t.prototype.getSkill=function(){if(Setting.autoRageSkill){var e=PlayerAttribute.rageSkill;if(e&&PlayerAttribute.canCastSkill(e.Id)&&!e.Locked)return e}for(var t=PlayerAttribute.skillSlots,n=PlayerAttribute.mapSkills,i=0;i<t.length;i++){var a=t[i];if(1==Setting.AutoSkill(n[a.id].Idx)){var r=PlayerAttribute.findSkill(a.id);if(null!=r&&!r.Locked&&PlayerAttribute.canCastSkill(r.Id))return r}}var o=PlayerAttribute.skills[0];return PlayerAttribute.canCastSkill(o.Id)?o:null},t}(bt.EmptyAction);e.SelectSkill=y,__reflect(y.prototype,"AI.SelectSkill");var b=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.Execute=function(e){if(UI.gathering)return 1;var t=e.player;if(t.workingCmd.action!=Action.Status.Idle)return 1;var n=e.select;if(null!=mapCharacter[n])return 1;if(t.navExist())return 0;var i,a=ECS.SceneObjectComponent.objs[e.touchObj];if(a){if(egret.$TempPoint.setTo(a.x,a.y),g_WithInRange(t.logicPos,egret.$TempPoint,66))return s(),a.touch(),e.touchObj=null,0;var r=g_GetDirIndex(egret.$TempPoint,t.logicPos),o=g_Move(r,MAX_DIR);i=egret.$TempPoint.add(o)}else{if(!Setting.auto)return 1;i=Scene.onPlayerIdle()}return null!=i?((i.x%1!=0||i.y%1!=0)&&(egret.error("p not int"),i.x=~~i.x,i.y=~~i.y),t.navTo(i,!0,!1),0):1},t}(bt.EmptyAction);e.Idle=b,__reflect(b.prototype,"AI.Idle");var S=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return __extends(n,t),n.prototype.Execute=function(t){var n=t.npc;if(n.workingCmd.action==Action.Status.Casting)return 0;if(e.bb.player.workingCmd.action!=Action.Status.Casting)return 1;var i=e.bb.skillTarget;if(i==e.bb.player.Id)return 1;if(null==i)return 1;var a=mapCharacter[i];if(null==a)return 1;var r=Skill.mapSkill[n.skillId],o=.9;if(r.distance>0&&!g_WithInRange(n.logicPos,a.logicPos,r.distance*o)){var s=g_GetDirIndex(n.logicPos,a.logicPos),l=egret.Point.distance(n.logicPos,a.logicPos),u=g_Move(s,l-r.distance*o*.9),c=n.logicPos.add(u);return n.moveTo(c),0}switch(r.type){case"char":n.castCharSkill(r.id,1,i);break;case"aoe":n.castAoeSkill(r.id,1,a.logicPos);break;case"dir":var s=void 0;s=n.logicPos.equals(a.logicPos)?n.dir64:g_GetDirIndex(n.logicPos,a.logicPos),n.castDirSkill(r.id,1,s)}return 0},n}(bt.EmptyAction);e.ClientNpcAttack=S,__reflect(S.prototype,"AI.ClientNpcAttack");var E=function(e){function t(t){var n=e.call(this)||this;return n.pos=t,n.cd=0,n}return __extends(t,e),t.prototype.Execute=function(e){var t=e.npc;if(t.workingCmd.action==Action.Status.Casting)return 1;var n,i=Player.instance;if(i.workingCmd.action==Action.Status.Running)n=g_Move((i.dir64+32)%64,100+100*this.pos);else switch(this.pos){case 0:n=g_Move(32,240);break;case 1:n=g_Move(16,240);break;case 2:n=g_Move(48,240);break;default:n=g_Move(0,240)}t.workingCmd.action==Action.Status.Idle&&(this.cd=0,this.desPoint=null);var a=i.logicPos.add(n),r=egret.getTimer();return null==this.desPoint||!g_WithInRange(this.desPoint,a,60)&&this.cd<=r?(this.desPoint=a,this.cd=r+200,g_WithInRange(t.logicPos,this.desPoint,t.MoveSpeed/Game.ServerFPS)?0:(t.moveTo(this.desPoint),0)):(g_WithInRange(t.logicPos,this.desPoint,t.MoveSpeed/Game.ServerFPS),0)},t}(bt.EmptyAction);e.FollowPlayer=E,__reflect(E.prototype,"AI.FollowPlayer");var C=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.Execute=function(e){if(!e.joystick)return 1;if(e.skillTarget&&e.skill)return 1;var t=e.player;if(t.dead)return 1;if(t.workingCmd.action==Action.Status.Casting)return 1;if(null!=e.dir){var n=g_Move(e.dir,5*t.MoveSpeed/Game.ServerFPS);return n=t.logicPos.add(n),n.x>=World.width&&(n.x=World.width-1),n.y>=World.height&&(n.y=World.height-1),n.x<0&&(n.x=0),n.y<0&&(n.y=0),t.navTo(n,!0,!0),0}return 1},t}(bt.EmptyAction);e.JoystickMove=C,__reflect(C.prototype,"AI.JoystickMove"),e.findEnemy=t;var T;!function(e){e[e.none=0]="none",e[e.monster=1]="monster",e[e.player=2]="player"}(T=e.TargetProiority||(e.TargetProiority={})),e.reviseAction=new v,e.bb=new bt.Blackboard;var I=(new egret.Point,!1);e.load=n,e.update=i,e.unload=a,e.init=o,e.stopMove=s,e.isEnemy=l,e.useSkill=u,e.MoveTo=c,e.SelectTarget=h,e.TouchObj=d}(AI||(AI={}));var table;!function(e){function t(e){switch(e.type){case"item":var t=new s;return t.type=e.type,t.content=e.content,t.icon;case"partnerEquip":var n=new l;return n.type=e.type,n.content=e.content,n.icon;case"silverCoin":case"copperCoin":case"goldCoin":case"practiceCoin":case"arenaCoin":case"readingCoin":case"pith":case"skillpoint":case"collectCardExp":case"exp":case"fubi":var i=new u(e.type,e.content);return i.icon;case"monthlyTask":return"";case"collecttreasurecard":return activityCollectTreasure.getCardConfig().icon;case"jxBook15Turntable":var a=new h(e.type,e.content);return a.icon;default:egret.warn("cannot get award icon, type = "+e.type)}}function n(e){switch(e.type){case"item":var t=new s;return t.type=e.type,t.content=e.content,t.quality;case"partnerEquip":var n=new l;return n.type=e.type,n.content=e.content,n.quality;case"silverCoin":case"copperCoin":case"goldCoin":case"practiceCoin":case"arenaCoin":case"readingCoin":case"pith":case"skillpoint":case"collectCardExp":case"exp":case"fubi":var i=new u(e.type,e.content);return i.quality;case"monthlyTask":return 4;case"collecttreasurecard":return activityCollectTreasure.getCardConfig().quality;case"jxBook15Turntable":var a=new h(e.type,e.content);return a.quality;default:egret.warn("cannot get award quality, type = "+e.type)}}function i(e){switch(e.type){case"item":var t=new s;return t.type=e.type,t.content=e.content,t.name;case"partnerEquip":var n=new l;return n.type=e.type,n.content=e.content,n.name;case"silverCoin":case"copperCoin":case"goldCoin":case"practiceCoin":case"arenaCoin":case"readingCoin":case"pith":case"skillpoint":case"collectCardExp":case"fubi":var i=new u(e.type,e.content);return i.name;case"exp":return lang.String(this.type);case"monthlyTask":return monthlyactivity.GetTransData(e.content.id).name;case"collecttreasurecard":return activityCollectTreasure.getCardConfig().name;case"jxBook15Turntable":var a=new h(e.type,e.content);return a.name;case"globalwheelCurrency":return lang.String(Game.currency2AwardType[e.type]);default:egret.warn("cannot get award name, type = "+e.type)}}function a(e){var t=e.params;switch(e.type){case 0:return{type:"exp",content:t[0]};case 1:return{type:"item",content:{genre:t[0],detailType:t[1],count:t[2]}};case 6:return{type:"partnerEquip",content:{id:t[0],star:t[2]}};case 2:var n=PlayerAttribute.GetItem(t[0]);if(0==n.Item.Type){var i=n.Item;return{type:"equipInstance",content:i}}break;case 3:return t[0]>=Game.currency2AwardType.length?(egret.error("parseAward fail currency="+t[0]),null):{type:Game.currency2AwardType[t[0]],content:t[1]};case 4:return{type:"partner",content:t[0]};case 5:return{type:"skillpoint",content:t[0]};case 7:return{type:"monthlyTask",content:{id:t[0],count:t[1]}};case 8:return{type:"collecttreasurecard",content:t[0]};case 9:return{type:"collectCardExp",content:t[0]};case 10:var a=PlayerAttribute.GetItem(t[0]);if(11==a.Item.Type){var r=n.Item;return{type:"juexueInstance",content:{item:r,juexues:PlayerAttribute.juexues}}}break;case 11:return{type:"jxBook15Turntable",content:t[0]};case 12:if(t.length>1){var o=new Item.WenShi;return o.InitAwardView(t[0],t[1],t[2],t[3],t[4],t[5],t[6]),{type:"wenshiInstance",content:o}}var s=PlayerAttribute.GetItem(t[0]),o=s.Item;return{type:"wenshiInstance",content:o};default:return egret.error("parseAward fail type="+e.type),null}}function r(e){for(var t=[],n=0;n<e.length;n++)t.push(a(e[n]));return t}function o(e){var t=[];if("list"==e.type)for(var n=0;n<e.content.length;n++)"clientitem"==e.content[n].type?t.push(e.content[n]):t.push({type:e.content[n].type,content:e.content[n].content});else t.push({type:e.type,content:e.content});return t}var s=function(){function t(){}return Object.defineProperty(t.prototype,"name",{get:function(){return e.props[this.content.genre][this.content.detailType].name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"quality",{get:function(){return e.props[this.content.genre][this.content.detailType].quality},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"icon",{get:function(){return e.props[this.content.genre][this.content.detailType].source},enumerable:!0,configurable:!0}),t}();e.ItemAward=s,__reflect(s.prototype,"table.ItemAward",["table.Award"]);var l=function(){function t(){}return Object.defineProperty(t.prototype,"name",{get:function(){return e.partnerEquips[this.content.id].name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"quality",{get:function(){return e.partnerEquips[this.content.id].quality},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"icon",{get:function(){return e.partnerEquips[this.content.id].source},enumerable:!0,configurable:!0}),t}();e.PartnerEquipAward=l,__reflect(l.prototype,"table.PartnerEquipAward",["table.Award"]);var u=function(){function e(e,t){this.type=e,this.content=t}return Object.defineProperty(e.prototype,"name",{get:function(){return lang.String(this.type)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"icon",{get:function(){var t=e.currency[this.type];return t?t.icon:""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"quality",{get:function(){var t=e.currency[this.type];return t?"silverCoin"==this.type&&this.content>=1e3?4:t.quality:4},enumerable:!0,configurable:!0}),e.prototype.getName=function(t){var n=e.currency[this.type];return n?lang.String(n.name):""},e.prototype.getDesc=function(t){var n=e.currency[this.type];return n?null==this.content?t||!n.lot?t:lang.String(n.lot):lang.StringWithFormat(n.desc,this.content):t},e.currency={exp:{icon:"icon/item/exp01.png",quality:2,desc:"exp X {1}",name:"exp",lot:"a lot of exp"},goldCoin:{icon:"icon/item/gold1.png",quality:4,desc:"goldCoin X {1}",name:"goldCoin",lot:"a lot of goldCoin"},silverCoin:{icon:"icon/item/gold.png",quality:3,desc:"silverCoin X {1}",name:"silverCoin",lot:"a lot of silverCoin"},copperCoin:{icon:"icon/item/coppercoin.png",quality:2,desc:"copperCoin X {1}",name:"copperCoin",lot:"a lot of copperCoin"},practiceCoin:{icon:"icon/item/lld1.png",quality:4,desc:"practiceCoin X {1}",name:"practiceCoin"},arenaCoin:{icon:"icon/item/lld2.png",quality:4,desc:"arenaCoin X {1}",name:"arenaCoin"},readingCoin:{icon:"icon/item/item_yulidan.png",quality:3,desc:"readingCoin X {1}",name:"readingCoin",lot:"a lot of readingCoin"},pith:{icon:"icon/item/ylz.png",quality:4,desc:"pith X {1}",name:"pith"},guildContribution:{icon:"ui/guild/guild_gongxian.png",quality:2,desc:"guildContribution X {1}",name:"guildContribution"},jade:{icon:monthlyactivity.Jade.icon,quality:monthlyactivity.Jade.quality,desc:monthlyactivity.Jade.desc,name:monthlyactivity.Jade.name},skillpoint:{quality:5},betCoin:{icon:"icon/item/cm_1.png",quality:4,desc:"betCoin X {1}",name:"betCoin"},collectCardExp:{icon:"icon/item/exp02.png",quality:2,desc:"collect card exp X {1}",name:"collect card exp",lot:"collect card a lot of exp"},fubi:{icon:"icon/item/fb.png",quality:4,desc:"fubi X {1}",name:"currency fubi",lot:"a lot of goldCoin"}},e}();e.CurrencyAward=u,__reflect(u.prototype,"table.CurrencyAward",["table.Award"]);var c=function(){function e(e,t){this.type=e,this.content=t}return Object.defineProperty(e.prototype,"name",{get:function(){return activityCollectTreasure.getCardConfig().name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"icon",{get:function(){return activityCollectTreasure.getCardConfig().icon},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"quality",{get:function(){return activityCollectTreasure.getCardConfig().quality},enumerable:!0,configurable:!0}),e.prototype.getName=function(e){return activityCollectTreasure.getCardConfig().name},e.prototype.getDesc=function(e){return activityCollectTreasure.getCardConfig().desc},e}();e.CollectTreasureCardAward=c,__reflect(c.prototype,"table.CollectTreasureCardAward",["table.Award"]);var h=function(){function e(e,t){this.type=e,this.content=t}return Object.defineProperty(e.prototype,"name",{get:function(){return"Vòng Quay Kiếm Hiệp"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"icon",{get:function(){return"icon/item/wheel_coin.png"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"quality",{get:function(){return 5},enumerable:!0,configurable:!0}),e.prototype.getName=function(e){return this.name},e.prototype.getDesc=function(e){return"Số lần vòng quay mừng sinh nhật, có thể vào trang chủ tham gia hoạt động Vòng Quay Sinh Nhật"},e}();e.JxBook15Turntable=h,__reflect(h.prototype,"table.JxBook15Turntable",["table.Award"]),e.getAwardIcon=t,e.getAwardQuality=n,e.getAwardName=i,e.parseAward=a,e.parseAwards=r,e.parseListAwards=o}(table||(table={}));var BlackList;!function(e){function t(){n()}function n(){e.blacklist={},s=0;var t=egret.localStorage.getItem(u+"_"+Player.instance.Name);if(null!=t){e.blacklist=JSON.parse(t);for(var n in e.blacklist)null!=e.blacklist[n]&&(s+=1)}}function i(){var t="";t=JSON.stringify(e.blacklist),egret.localStorage.setItem(u+"_"+Player.instance.Name,t)}function a(t,n){return Player.instance.Name==t?void PopUpMessage.push(lang.String("forbit add self to black list"),color.RED):null!=e.blacklist[t]?void PopUpMessage.push(lang.String("already in black list"),color.RED):s>=l?void PopUpMessage.push(lang.String("black list is full"),color.RED):(e.blacklist[t]=new o(n),s+=1,i(),PopUpMessage.push(lang.StringWithFormat("add {1} to black list",t),color.RED),void(null!=UI.FriendsUI.instance&&UI.FriendsUI.instance.UpdateBlackList()))}function r(t){null!=e.blacklist[t]&&(delete e.blacklist[t],i(),PopUpMessage.push(lang.StringWithFormat("remove {1} from black list",t),color.RED),null!=UI.FriendsUI.instance&&UI.FriendsUI.instance.UpdateBlackList())}var o=function(){function e(e){this.faction=e}return e}();__reflect(o.prototype,"BlackList");var s,l=50,u="Blacklist",c=function(){function e(e,t){this.name="",this.level=0,this.fp=0,this.faction=0,this.guildName="",this.txtCustom="",this.nType=0,this.name=e,this.level=99,this.fp=0,this.faction=t,this.offlineTime=0,this.nType=Game.FriendPageType.BlackList,this.txtCustom=lang.String("last online")
}return Object.defineProperty(e.prototype,"icon",{get:function(){return 0==this.faction?"":table.faction[this.faction].portrait},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"txtFaction",{get:function(){return 0==this.faction?"":table.faction[this.faction].name},enumerable:!0,configurable:!0}),e}();e.BlackListInfo=c,__reflect(c.prototype,"BlackList.BlackListInfo"),e.Init=t,e.load=n,e.save=i,e.addBlackList=a,e.removePlayerFromBlackList=r}(BlackList||(BlackList={}));var ActorAnimation;!function(e){e[e.st=0]="st",e[e.wlk=1]="wlk",e[e.die=2]="die",e[e.at01=3]="at01",e[e.at02=4]="at02"}(ActorAnimation||(ActorAnimation={}));var ActorLayer;!function(e){e[e.front=0]="front",e[e.back=1]="back"}(ActorLayer||(ActorLayer={}));var PopSkillType;!function(e){e[e.PartnerTalentSkill=0]="PartnerTalentSkill",e[e.PartnerRageSkill=1]="PartnerRageSkill",e[e.NpcSkill=2]="NpcSkill"}(PopSkillType||(PopSkillType={}));var MovieClipDataLoader=function(){function e(){}return e.prototype.get=function(e,t){var n=RES.getRes(e);null!=n?(this.url=e,t(n)):this.fetch(e,t)},e.prototype.fetch=function(e,t){this.url=e,this.dispatcher=RES.getDispatcher(e),this.handle=t,this.dispatcher.once(egret.Event.COMPLETE,this.onEvent,this)},e.prototype.onEvent=function(e){this.handle(e.data),this.handle=null},e.prototype.release=function(){null!=this.movieClipData&&(this.movieClipData=null),null!=this.dispatcher&&(this.dispatcher.removeEventListener(egret.Event.COMPLETE,this.onEvent,this),this.dispatcher=null),this.handle=null,this.url=null},e}();__reflect(MovieClipDataLoader.prototype,"MovieClipDataLoader");var Actor=function(e){function t(){var t=e.call(this)||this;return t.bodys={},t.effects={},t.head=new UI.ActorHead,t.addChild(t.head),t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,t.onTouchTap,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.generate=function(e){var n=this.objectPool.pop();return null==n&&(n=new t),n.load(e),n},t.init=function(){if(null==this.selected){var e=RES.getRes("mc/target/target.json");this.selected=new egret.MovieClip(e.generateMovieClipData("target")),this.selected.x=0,this.selected.y=0,this.selected.play(-1)}},t.prototype.updateResource=function(e){this.res=e,null!=this.body&&(Game.removeFromParent.apply(this.body),this.body=null);for(var t in this.bodys){var n=this.bodys[t];null!=n.url&&RES.delRel(n.url),n.release()}this.bodyhight=table.actor[this.res].body,this.head.y=-table.actor[this.res].head,this.feet=table.actor[this.res].feet,this.frontEffects.y=-this.feet,this.backEffects.y=-this.feet,this.loadbody(this.status,this.totalFrame,this.playTimes)},t.prototype.load=function(e){this.status=ActorAnimation.st,this.res=e,this.body=null,this.lastId=0,this.dir64=0,this.curDir64=0,this.bodyhight=table.actor[this.res].body,this.head.y=-table.actor[this.res].head,this.feet=table.actor[this.res].feet,null==this.frontEffects&&(this.frontEffects=new egret.DisplayObjectContainer,this.addChildAt(this.frontEffects,3),this.frontEffects.touchEnabled=!1),null==this.backEffects&&(this.backEffects=new egret.DisplayObjectContainer,this.addChildAt(this.backEffects,0),this.backEffects.touchEnabled=!1),this.frontEffects.y=-this.feet,this.backEffects.y=-this.feet,this.loadbody(this.status,null,null),this.touchChildren=!1,this.touchEnabled=!1},t.prototype.$hitTest=function(e,t){if(!this["char"]||!this["char"].selectable)return null;if(!this.$visible)return null;var n=this.$getInvertedConcatenatedMatrix(),i=n.a*e+n.c*t+n.tx,a=n.b*e+n.d*t+n.ty,r=this.$scrollRect?this.$scrollRect:this.$maskRect;if(r&&!r.contains(i,a))return null;if(this.$mask&&!this.$mask.$hitTest(e,t))return null;for(var o=this.$children,s=!1,l=null,u=o.length-1;u>=0;u--){var c=o[u];if(!c.$maskedObject){switch(c){case this.frontEffects:case this.backEffects:continue}if(l=c.$hitTest(e,t)){s=!0,l.$touchEnabled||(l=null);break}}}return l?this.$touchChildren?l:this:s?this:null},t.prototype.onTouchTap=function(e){this["char"]&&this["char"].selectable&&(this["char"].select(),e.stopImmediatePropagation())},t.prototype.__recycle=function(){this.backEffects.removeChildren(),this.frontEffects.removeChildren(),this.body&&(Game.removeFromParent.call(this.body),this.body=null),this.lastId=0,this.res=null},t.prototype.release=function(){this.res;for(var e in this.bodys){var n=this.bodys[e];null!=n.url&&RES.delRel(n.url),n.release()}for(var e in this.effects){var i=this.effects[e];null!=i.loader.url&&RES.delRel(i.loader.url),i.loader.release(),i.displayObject&&(Game.removeFromParent.call(i.displayObject),i.displayObject=null),delete this.effects[e]}egret.Tween.removeTweens(this),this["char"]=null,this.head.destory(),t.objectPool.push(this)},t.prototype.onAddToStage=function(){turnTimer.addEventListener(egret.TimerEvent.TIMER,this.update,this)},t.prototype.onRemoveFromStage=function(){turnTimer.removeEventListener(egret.TimerEvent.TIMER,this.update,this)},t.prototype.attachCharacter=function(e){this["char"]=e},t.prototype.makeDummy=function(){return null==this.dummy&&(this.dummy=new egret.Bitmap(RES.getRes("ui/public/dummy.png")),this.dummy.anchorOffsetY=this.dummy.height,this.dummy.anchorOffsetX=this.dummy.width/2,this.dummy.touchEnabled=!0),this.dummy},t.findBodyResource=function(e,n,i){var a=1,r=i;r>5&&(a=-1,r=10-r);var o=ActorAnimation[n]+"_"+r,s="actor/"+e+"/"+o+".json";if(!RES.hasRes(s))switch(n){case ActorAnimation.st:if(1!=i)return t.findBodyResource(e,ActorAnimation.st,1);case ActorAnimation.at01:return 1==i?t.findBodyResource(e,ActorAnimation.st,i):t.findBodyResource(e,ActorAnimation.at01,1);case ActorAnimation.at02:return t.findBodyResource(e,ActorAnimation.at01,i);case ActorAnimation.wlk:return t.findBodyResource(e,ActorAnimation.st,i);case ActorAnimation.die:return 1==i?t.findBodyResource(e,ActorAnimation.st,i):t.findBodyResource(e,ActorAnimation.die,1)}return{url:s,key:o,scaleX:a}},t.prototype.loadbody=function(e,n,i){var a=this;if(null==this["char"]&&LiteMode.limit()||null!=this["char"]&&this["char"].liteModeLimit())return null!=this.body&&this==this.body.parent&&this.removeChild(this.body),void this.addChildAt(this.makeDummy(),this.getChildIndex(this.backEffects)+1);var r=g_Dir64To8(this.dir64)+1;r>8&&(r-=8);var o=t.findBodyResource(this.res,e,r),s=o.key,l=o.url,u=o.scaleX,c=this.bodys[s];if(null==c&&(c=new MovieClipDataLoader,this.bodys[s]=c),null!=c.movieClipData)return void this.onBodyLoaded(e,u,c.movieClipData,0,n,i);if(null==c.dispatcher)if(RES.addRel(l),2!=RES.getState(l)){if(null!=this.body&&(this.body.visible=!1),this.addChildAt(this.makeDummy(),this.getChildIndex(this.backEffects)+1),null!=c.dispatcher)return;var h=egret.getTimer(),d=this.res;c.fetch(l,function(t){if(d!=a.res)return void egret.error("[ERROR]actor load",d,a.res);var o=t.generateMovieClipData(s);a.bodys[s].movieClipData=o;var l=g_Dir64To8(a.dir64)+1;l>8&&(l-=8),e==a.status&&r==l&&a.onBodyLoaded(e,u,o,egret.getTimer()-h,n,i)})}else{var p=RES.getRes(l),g=p.generateMovieClipData(s);c.url=l,c.movieClipData=g,this.onBodyLoaded(e,u,g,0,n,i)}},t.calcWlkFrame=function(e,t,n,i){var a=table.actor[e];null==a.baseSpeed&&(a.baseSpeed=table.actor[e].step*n/i);var r=Math.round(n*t/a.baseSpeed);return r},t.prototype.onBodyLoaded=function(e,n,i,a,r,o){var s=1;null==this.body?(this.body=new egret.MovieClip(i),this.body.touchEnabled=!0,this.body.name=ActorAnimation[e],this.body.scaleX=n):(this.body.name==ActorAnimation[e]&&(s=this.body.currentFrame),this.body.name=ActorAnimation[e],this.body.movieClipData=i,this.body.scaleX=n);var l=i.frameRate;switch(r&&(e==ActorAnimation.at01||e==ActorAnimation.at02)&&(l=Math.ceil(Game.FPS*i.numFrames/r)),e){case ActorAnimation.wlk:null!=this["char"]&&(l=t.calcWlkFrame(this.res,this["char"].MoveSpeed,i.frameRate,i.numFrames))}this.body.frameRate=l;var u=Math.round(a*this.body.frameRate/Game.Second/this.body.movieClipData.numFrames);o||(o=1,(this.status==ActorAnimation.st||this.status==ActorAnimation.wlk)&&(o=-1)),this.body.gotoAndPlay((s-1+u)%this.body.movieClipData.numFrames,o),null!=this.dummy&&null!=this.dummy.parent&&this.removeChild(this.dummy),null==this.body.parent&&this.addChildAt(this.body,this.getChildIndex(this.backEffects)+1),this.body.visible=!0},Object.defineProperty(t.prototype,"name",{get:function(){return this.head.roleName},enumerable:!0,configurable:!0}),t.prototype.changeRunSpeed=function(){if(null!=this.body&&null!=this["char"]&&this.status==ActorAnimation.wlk){var e=this.body.movieClipData.frameRate;this.body.frameRate=t.calcWlkFrame(this.res,this["char"].MoveSpeed,e,this.body.movieClipData.numFrames)}},t.prototype.changeAttackSpeed=function(e){null!=this.body&&null!=this["char"]&&(this.status==ActorAnimation.at01||this.status==ActorAnimation.at02)&&(this.body.frameRate=Math.ceil(Game.FPS*this.body.movieClipData.numFrames/e))},t.prototype.removeShieldEffect=function(e){this.removeEffect("shield"+e)},t.prototype.removeEffect=function(e){var t=this.effects[e];if(null!=t){var n=t.loader;null!=n.url&&RES.delRel(n.url),n.release();var i=t.displayObject;null!=i&&(Game.removeFromParent.apply(i),t.displayObject=null)}},t.prototype.appendEffect=function(e,t,n){var i=this.effects[e];if(null==i&&(i={loader:new RES.Loader,displayObject:null},this.effects[e]=i),null==i.loader.dispatcher){egret.getTimer();RES.addRel(t),i.loader.get(t,n)}},t.prototype.onDie=function(){for(var e in this.effects)if("weapon"!=e){var t=this.effects[e];null!=t.loader.url&&RES.delRel(t.loader.url),t.loader.release(),t.displayObject=null,e.match(/^effect\d+/)&&delete this.effects[e]}var n=this.effects.weapon;n&&n.displayObject&&this.backEffects.addChild(n.displayObject)},t.prototype.addShieldEffect=function(e){var t=this;if(!this["char"].liteModeLimit()){var n,i="shield"+e;switch(e){case 0:n="wd_zwww2";break;case 1:n="npc_fang1";break;case 2:n="cy_hthb";break;default:return egret.error("[AddShieldEffect] index="+e+" not found")}var a=egret.getTimer(),r="skill/"+n+"/"+n+".json";this.appendEffect(i,r,function(e){var o=(egret.getTimer()-a,e.generateMovieClipData(n)),s=new egret.MovieClip(o);s.blendMode=table.blendMode[r],t.effects[i].displayObject=s,s.play(-1),t.frontEffects.addChild(s)})}},t.prototype.destroy=function(){this.removeSelected(),null!=this.removing&&(egret.clearTimeout(this.removing),this.removing=null),null!=this.parent&&Scene.removeChild(this),this.release()},t.prototype.doGone=function(){if(this.removeSelected(),null==this.removing)if(null!=this.body&&this.status==ActorAnimation.die){var e=~~(Game.Second*(this.body.movieClipData.numFrames-this.body.currentFrame)/this.body.frameRate);if(0>=e)return Scene.removeChild(this),void this.release();this.removing=egret.setTimeout(this.onRemovingTime,this,e+4e3)}else null!=this.parent?(Scene.removeChild(this),this.release()):(Scene.removeChild(this),this.release())},t.prototype.onRemovingTime=function(){this.removing=null,Scene.removeChild(this),this.release()},t.prototype.removeSelected=function(){t.selected.parent==this&&this.removeChild(t.selected)},t.prototype.to=function(e,t,n){if(null!=e&&this.status!=e){if(e!=ActorAnimation.die){if(this.frozen)return}else this.popHealImmediately(),this.popHurtImmediately();this.totalFrame=t,this.playTimes=n,this.status=e,this.loadbody(e,t,n)}},t.prototype.update=function(){1!=this.flag?(this.popHealImmediately(),this.flag=!0):(this.popHurtImmediately(),this.flag=!1),this.status!=ActorAnimation.die&&((this.status==ActorAnimation.at01||this.status==ActorAnimation.at02)&&this.body&&!this.body.isPlaying&&this.to(ActorAnimation.st,null,null),null!=this["char"]&&this["char"].selectable&&(this["char"].selected?t.selected.parent!=this.backEffects&&this.addChildAt(t.selected,0):this.removeSelected()),this.updatedir())},t.prototype.updatedir=function(){var e=this["char"];if(null!=e){var t=this.dir64;if(e.dir64!=t){var n=e.dir64-t;n>HALF_DIR?n-=MAX_DIR:-HALF_DIR>n&&(n+=MAX_DIR);var i=int(n/2);0==i?t=e.dir64:t+=i,t>=MAX_DIR&&(t-=MAX_DIR),0>t&&(t+=MAX_DIR)}g_Dir64To8(t)!=g_Dir64To8(this.dir64)?(this.dir64=t,this.loadbody(this.status,this.totalFrame,this.playTimes)):null==this.dummy||null==this.dummy.parent||e.liteModeLimit()?this.dir64=t:(this.dir64=t,this.loadbody(this.status,this.totalFrame,this.playTimes))}},Object.defineProperty(t.prototype,"frozen",{get:function(){return this._frozen},set:function(e){this._frozen=e,null!=this.body&&(1==e?this.body.stop():(this.body.play(),this.to(ActorAnimation.st,null,null)))},enumerable:!0,configurable:!0}),t.prototype.popPetSkill_=function(e){var t=UI.popupSkill.generate("player",e),n=this.localToGlobal(-200,-this.bodyhight-120);t.y=n.y,t.x=n.x,t.anchorOffsetX=Math.floor(t.width/2),t.anchorOffsetY=Math.floor(t.height/2),t.alpha=0,mapMessageLayer.addChild(t),tweenTalentSkill(t)},t.prototype.popNpcSkill_=function(e){var t=UI.popupSkill.generate("npc",e),n=this.localToGlobal(-200,-this.bodyhight-140);t.y=n.y,t.x=n.x,t.anchorOffsetX=Math.floor(t.width/2),t.anchorOffsetY=Math.floor(t.height/2),t.alpha=0,mapMessageLayer.addChild(t),tweenNpcSkill(t)},t.prototype.popBattleResult=function(e){var t="ui/big/winLose_2.png";e&&(t="ui/big/winLose_1.png"),this.popBattleResultImage(t,!1,"","",tweenNpcSkill,-50,-this.bodyhight/2)},t.prototype.popBattleResultImage=function(e,t,n,i,a,r,o){if(null!=this.parent&&!this["char"].liteModeLimit()){var s=UI.PopupText.generate(n,i,e,t);s.visible=!0;var l=this.localToGlobal(r,o);s.x=l.x+randMaxAbs(10),s.y=l.y+randMaxAbs(10),uiLayer.addChild(s),a(s)}},t.prototype.popSkill=function(e,t){if(null!=this.parent&&!this["char"].liteModeLimit())switch(t){case PopSkillType.NpcSkill:this.popNpcSkill_(e);break;default:this.popPetSkill_(e)}},t.prototype.popTextWithImage=function(e,t,n,i,a,r,o){if(null!=this.parent&&!this["char"].liteModeLimit()){var s=UI.PopupText.generate(n,i,e,t),l=this.localToGlobal(r,o);s.x=l.x+randMaxAbs(10),s.y=l.y+randMaxAbs(10),mapMessageLayer.addChild(s),a(s)}},t.prototype.popHeal=function(e){null==this.collectHeal?this.collectHeal=e:this.collectHeal+=e},t.prototype.popHealImmediately=function(){null!=this.collectHeal&&0!=this.collectHeal&&(this.popTextWithImage("",!1,"+"+this.collectHeal,"Number/life_add.fnt",tweenHurt,0,-this.bodyhight/2),this.collectHeal=0)},t.prototype.doHitBack=function(e){var t=g_Move(e,100),n=Scene.logicPos2DisplayPos(t);egret.Tween.removeTweens(this),egret.Tween.get(this).to({x:this.x+n.x,y:this.y+n.y},100)},t.prototype.doHurt=function(e){egret.Tween.removeTweens(this);var t=g_Move(e,10),n=Scene.logicPos2DisplayPos(t);egret.Tween.get(this).to({x:this.x+n.x,y:this.y+n.y},100).to({x:this.x,y:this.y},100,egret.Ease.backInOut).call(this.onShakeFinish,this)},t.prototype.onShakeFinish=function(){if(null!=this["char"]){var e=Scene.logicPos2DisplayPos(this["char"].logicPos);this.x=e.x,this.y=e.y}},t.prototype.addOneTimeEffect=function(e,t,n){var i=this;if(void 0===n&&(n=0),!this["char"].liteModeLimit()){this.lastId++;var a="effect"+this.lastId,r="skill/"+e+"/"+e+".json",o=egret.getTimer();this.appendEffect(a,r,function(s){var l=i.effects[a];if(null==l)return void egret.error("[ERROR] actor.addOneTimeEffect "+a+" not found");null!=l.loader.url&&RES.delRel(l.loader.url),l.loader.release(),delete i.effects[a];var u=egret.getTimer()-o,c=s.generateMovieClipData(e),h=EffectSprite.generate(r,c);h.blendMode=table.blendMode[r];var d=h.movieClipData.numFrames*Game.Second/h.movieClipData.frameRate;u>=d||i._addEffect(h,u,d,t,0,-n)})}},t.prototype.removeHalo=function(e){this.removeEffect("holo"+e)},t.prototype.addHalo=function(e){var t=this;if(!this["char"].liteModeLimit()){var n=table.HaloResources[e];if(n){var i="holo"+e,a="skill/"+n+"/"+n+".json",r=egret.getTimer();this.appendEffect(i,a,function(e){var o=(egret.getTimer()-r,e.generateMovieClipData(n)),s=EffectSprite.generate(a,o);s.blendMode=table.blendMode[a],t.effects[i].displayObject=s,s.play(-1),t.frontEffects.addChild(s)})}}},t.prototype._addEffect=function(e,t,n,i,a,r){switch(e.playDeltaTime(t,-1),e.y+=r,e.x+=a,n>=0&&e.setLifeTime(n-t),i){case ActorLayer.front:this.frontEffects.addChild(e);break;case ActorLayer.back:this.backEffects.addChild(e)}},t.prototype.addEffect=function(e,t,n,i,a){var r=this;if(!this["char"].liteModeLimit()){this.lastId++;var o="effect"+this.lastId,s="skill/"+e+"/"+e+".json",l=egret.getTimer();this.appendEffect(o,s,function(u){var c=r.effects[o];if(null==c)return void egret.error("[ERROR] actor.addEffect "+o+" not found");null!=c.loader.url&&RES.delRel(c.loader.url),c.loader.release(),delete r.effects[o];var h=egret.getTimer()-l;if(!(t>=0&&h>=t)){var d=u.generateMovieClipData(e),p=EffectSprite.generate(s,d);p.blendMode=table.blendMode[s],r._addEffect(p,h,t,n,i,a)}})}},t.prototype.removeSuperWeaponEffect=function(){var e="weapon";this.removeEffect(e)},t.prototype.addSuperWeaponEffect=function(e){var t=this,n="weapon",i=table.superWeaponCfg[e].effect,a="skill/"+i+"/"+i+".json",r=this.effects[n];if(null==r&&(r={loader:new MovieClipDataLoader,displayObject:null},this.effects[n]=r),null!=r.loader.url)if(r.loader.url!=a)RES.delRel(r.loader.url),r.loader.release(),null!=r.displayObject&&(Game.removeFromParent.apply(r.displayObject),r.displayObject=null);else if(null!=r.displayObject)return void(null==r.displayObject.parent&&this.backEffects.addChild(r.displayObject));var o=egret.getTimer();this.appendEffect(n,a,function(e){var r=(egret.getTimer()-o,e.generateMovieClipData(i)),s=new egret.MovieClip(r);s.blendMode=table.blendMode[a],t.effects[n].displayObject=s,s.play(-1),t.backEffects.addChild(s)})},t.prototype.updateSuperWeaponEffect=function(e){if(SuperWeapon.isDisableAllPlayersEffect()||0>=e||e>SuperWeapon.MaxWeapons)return void this.removeSuperWeaponEffect();if(!this["char"].liteModeLimit()){var t="weapon",n=this.effects[t];null==n&&(n={loader:new RES.Loader,displayObject:null},this.effects[t]=n),this.addSuperWeaponEffect(e)}},t.prototype.addCommonEffect=function(e,t){var n=this;this.lastId++;var i="effect"+this.lastId;this.appendEffect(i,e,function(e){var a=n.effects[i];return null==a?void egret.error("[ERROR] actor.addCommonEffect "+i+" not found"):(t(e),null!=a.loader.url&&RES.delRel(a.loader.url),a.loader.release(),void delete n.effects[i])})},t.prototype.popImageDodge=function(e){e?this.popTextWithImage("ui/public/dodge.png",!1,"","",tweenDodgeSelf,0,-50):this.popTextWithImage("ui/public/miss.png",!1,"","",tweenDodge,-75,-125)},t.prototype.popImageAbsorb=function(e){e?this.popTextWithImage("ui/public/absorption.png",!1,"","",tweenAbsorbSelf,0,-50):this.popTextWithImage("ui/public/xishoured.png",!1,"","",tweenAbsorb,-75,-125)},t.prototype.popHurt=function(e,t,n){t?n?this.popTextWithImage("",!1,"-"+e,"Number/myhurt.fnt",tweenHurtStrikeSelf,60,50):this.popTextWithImage("",!1,""+e,"Number/strike_number.fnt",tweenHurtStrike,60,-200):n?this.popHurtDelay(e):this.popTextWithImage("",!1,""+e,"Number/damage.fnt",tweenHurt,0,-150)},t.prototype.popHurtDelay=function(e){null==this.collectHurt?this.collectHurt=e:this.collectHurt+=e},t.prototype.popHurtImmediately=function(){null!=this.collectHurt&&0!=this.collectHurt&&(this.popTextWithImage("",!1,"-"+this.collectHurt,"Number/myhurt.fnt",tweenHurtSelf,0,-50),this.collectHurt=0)},t.prototype.beingReflectedDamage=function(e,t){t?this.popTextWithImage("ui/public/hongfantan.png",!1,"-"+e,"Number/damage.fnt",tweenHurtSelf,0,-this.bodyhight/2-50):this.popTextWithImage("ui/public/Anti_injury.png",!1,""+e,"Number/rebound.fnt",tweenHurt,0,-this.bodyhight/2-150)},t.prototype.popExp=function(e){this.popTextWithImage("ui/public/exp.png",!1,"+"+e,"Number/exp_number.fnt",tweenExp,135,-this.bodyhight/2-50)},t.prototype.popBleedHurtImmediately=function(){this.collectBleed&&(this.popTextWithImage("ui/public/hongdu.png",!1,"-"+this.collectBleed,"Number/myhurt.fnt",tweenBleedHurtSelf,15,0),this.collectBleed=0)},t.prototype.pushBleedHurt=function(e){null==this.collectBleed?this.collectBleed=e:this.collectBleed+=e},t.objectPool=new egret.Recycler,t}(egret.DisplayObjectContainer);__reflect(Actor.prototype,"Actor");var CharacterSkill=function(){function e(){}return e.prototype.init=function(e,t,n,i,a){this.Id=e,this.Level=t,this.Locked=n,this.Idx=i,this.ExtendLevel=a},e.prototype.GetFinalLevel=function(){return null==Skill.mapSkill[this.Id]?1:this.Level+this.ExtendLevel>Skill.MAX_LEVEL?Skill.MAX_LEVEL:this.Level+this.ExtendLevel},e}();__reflect(CharacterSkill.prototype,"CharacterSkill");var ClientNpc=function(){function e(){this.dir64=1,this._logicPos=new egret.Point,this.workingCmd=new Action.CommandAction}return Object.defineProperty(e.prototype,"MoveSpeed",{get:function(){return Player.instance.MoveSpeed},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"delegateKind",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"revisePos",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"AttackSpeed",{get:function(){return 0},enumerable:!0,configurable:!0}),e.prototype.liteModeLimit=function(){return!1},Object.defineProperty(e.prototype,"selectable",{get:function(){return!1},enumerable:!0,configurable:!0}),e.prototype.init=function(e,t,n){this.resource=e,this.Name=t,this.skillId=n,this.reset()},e.prototype.reset=function(){null==this.actor&&(this.actor=Actor.generate(this.resource)),this.invalid=!1,this.actor.to(ActorAnimation.st,null,null),this.SetName(this.Name),this.actor.head.updateGuildName(""),this.actor.attachCharacter(this),this.actor.head.updateSeries(null),this.actor.head.updateCampName(null),this.actor.head.updateSceneTitle(null),this.actor.head.hideLifeBar(),this.actor.touchEnabled=!1,this.actor.touchChildren=!1,this.actor.to(ActorAnimation.st,null,null)},e.prototype.SetName=function(e){""!=e&&(this.Name=e,this.actor.head.roleName=e,this.actor.head.updateRoleNameColor(color.WHITE))},e.prototype.destroy=function(){this.workingCmd.cmd&&this.workingCmd.cmd.release(),this.workingCmd.clear(),this.invalid=!0,null!=this.actor&&(this.actor.destroy(),this.actor=null)},e.prototype.clearCommand=function(){var e=this.workingCmd.cmd;null!=e&&(this.workingCmd.clear(),e.abort(),e.release())},e.prototype.update=function(e){var t=this.workingCmd.cmd;return null==t?void this.actor.to(ActorAnimation.st,null,null):void(t.execute(e)||(t.end(),t.release(),this.workingCmd.clear()))},e.prototype.pushCommand=function(e,t){null!=this.workingCmd.cmd&&(this.workingCmd.cmd.abort(),this.workingCmd.cmd.release()),this.workingCmd.cmd=t,this.workingCmd.action=e,t.begin()},e.prototype.moveTo=function(e){if(!this.logicPos.equals(e)){var t=Action.CmdRun.generate(this,e,!0);this.pushCommand(Action.Status.Running,t)}},e.prototype.castAoeSkill=function(e,t,n){var i=Action.CmdAoeSkill.generate(this,n,e,t);this.pushCommand(Action.Status.Casting,i)},e.prototype.castDirSkill=function(e,t,n){var i=Action.CmdDirSkill.generate(this,n,e,t);this.pushCommand(Action.Status.Casting,i)},e.prototype.castCharSkill=function(e,t,n){var i=Action.CmdCharSkill.generate(this,n,e,t);this.pushCommand(Action.Status.Casting,i)},e.prototype.lookAt=function(e){this._logicPos.equals(e)||(this.dir64=g_GetDirIndex(this._logicPos,e))},e.prototype.locate=function(e,t){this.dir64=e,this.logicPos=t},Object.defineProperty(e.prototype,"logicPos",{get:function(){return this._logicPos},set:function(e){this._logicPos.copyFrom(e);var t=Scene.logicPos2DisplayPos(e);this.actor.x=t.x,this.actor.y=t.y},enumerable:!0,configurable:!0}),e}();__reflect(ClientNpc.prototype,"ClientNpc",["Action.Delegate"]);var ClientNpcAI=function(){function e(e,t){this.blackboard=new bt.Blackboard,this.node=bt.factories[2](),this.blackboard.npc=e,this.delegate=e,this.node.Initialize(this.blackboard)}return e.prototype.attach=function(e,t){this.node.Uninitialize(),this.blackboard.npc=e,this.delegate=e,this.node.Initialize(this.blackboard)},e.prototype.release=function(){this.blackboard.npc=null,this.delegate=null,this.node.Uninitialize()},e.prototype.update=function(){null==this.delegate||this.delegate.invalid||this.node.Execute(this.blackboard)},e}();__reflect(ClientNpcAI.prototype,"ClientNpcAI");var PartnerNpcManager;!function(e){function t(e){for(var t=0,n=0;n<table.fakePartnerSkill.length;n++){var i=table.fakePartnerSkill[n];if(e==i.partnerid){t=i.skillid;break}}return t}function n(){Game.dispatcher.addEventListener(Game.EVENT.PlayerDie,i,null),Game.dispatcher.addEventListener(Game.EVENT.PlayerRevive,s,null),Game.dispatcher.addEventListener(Game.EVENT.PartnerWorkPosChange,s,null)}function i(){null!=c&&(egret.clearTimeout(c),c=null);for(var t in e.ai)e.ai[t].release();for(var n in e.mapPartnerFakeNpc)e.mapPartnerFakeNpc[n].destroy(),delete e.mapPartnerFakeNpc[n]}function a(){for(var t in e.ai)e.ai[t].update()}function r(t){for(var n in e.mapPartnerFakeNpc)e.mapPartnerFakeNpc[n].update(t)}function o(){if(!l()){var n=Player.instance,i={};for(var a in e.ai)e.ai[a].delegate=null;for(var r=0;r<Partner.workList.length;r++){var o=Partner.workList[r];if(o>0){i[o]=r;break}}for(var a in e.mapPartnerFakeNpc)null==i[parseInt(a)]&&(e.mapPartnerFakeNpc[a].destroy(),delete e.mapPartnerFakeNpc[a]);for(var a in i){var o=parseInt(a),s=i[a],u=e.mapPartnerFakeNpc[o];if(null==u){var c=Partner.GetPartnerCfg(o),h=c.resource,d=c.name,p=t(o);u=new ClientNpc,u.init(h,d,p),e.mapPartnerFakeNpc[o]=u}else u.reset();null==e.ai[s]?e.ai[s]=new ClientNpcAI(u,s):e.ai[s].attach(u,s);var g=void 0;switch(this.pos){case 0:g=g_Move((64+n.dir64+32)%64,120);break;case 1:g=g_Move((64+n.dir64+16)%64,120);break;case 2:g=g_Move((64+n.dir64-16)%64,120);break;default:g=g_Move((64+n.dir64+32)%64,240)}u.logicPos=n.logicPos.add(g),u.locate(Player.instance.dir64,u.logicPos),null==u.actor.parent&&Scene.addChild(u.actor)}}}function s(){null!=c&&(egret.clearTimeout(c),c=null),c=egret.setTimeout(o,null,500)}function l(){if(LiteMode.force)return!0;var e=table.maps[World.mapId].scene;return null==e?!1:1==u[e]}var u={"songjin/enroll":!0,"songjin/enroll2":!0,"songjin/combat":!0,"songjin/enroll_experience":!0,"wildboss/beatboss":!0,"qinMausoleum/f1":!0,"qinMausoleum/f2":!0,catchthief:!0,ferryboat:!0,arena:!0,taohuaIsland:!0,guild:!0,wulinliansai:!0,"nienboss/nienboss":!0,"songjinx/enroll":!0,"songjinx/enroll2":!0,"songjinx/combat":!0,"crossserver/boss":!0,"crossserver/farm":!0,guildwartask:!0,guildwarmatch:!0,guildwar2:!0,babel:!0,babelprepare:!0,guilddungeon:!0,nienboss:!0,personalmatch:!0,city:!0,bravepalace:!0,shareboss:!0,"jianmenguan/combat":!0,"jianmenguan/enroll":!0};e.mapPartnerFakeNpc={},e.ai={};var c;e.getFakePartnerSkillId=t,e.load=n,e.clear=i,e.updateAI=a,e.update=r,e.delayFighting=s}(PartnerNpcManager||(PartnerNpcManager={}));var PlayerResource=function(){function e(e,t){var n=table.faction[e],i=n.resource;t&&table.avatars[t]&&(i=table.avatars[t].resource),this.faction=e,this.body=i,this.resbody=[],this.resskill=[],this.ParnerSkillloader=egret.createMap(),this.addRelBody(),this.addRelSkill()}return e.prototype.addRelBody=function(){for(var e=ActorAnimation.st;e<=ActorAnimation.at02;e++)for(var t=1;5>=t;t++){var n="actor/"+this.body+"/"+ActorAnimation[e]+"_"+t+".json";RES.hasRes(n)&&(this.resbody.push(n),RES.addRel(n))}},e.prototype.addrelskill=function(e){for(var t=e.length,n=[],i=0;t>i;i++){var a=e[i];if(a.kind==Skill.AnimationKind.MovieClip){var r=a.name,o=table.effects[r];switch(o){case 5:case 16:for(var s=1;o>=s;s++){var l="skill/"+r+"/"+r+"_"+s+".json";RES.addRel(l),n.push(l)}break;default:var u="skill/"+r+"/"+r+".json";RES.addRel(u),n.push(u)}}else{var r=a.name,u="dbbin/"+r+"/"+r+"_ske.dbbin";RES.addRel(u),n.push(u)}}return n},e.prototype.addRelSkill=function(){for(var e=table.faction[this.faction],t=e.skills.length,n=0;t>n;n++){var i=e.skills[n].id,a=Skill.mapSkill[i].resources,r=this.addrelskill(a);this.resskill.concat(r)}},e.prototype.addRelPartnerSkill=function(e){for(var t=Skill.mapSkill[e].resources,n=this.addrelskill(t),i=0,a=n;i<a.length;i++){var r=a[i];this.ParnerSkillloader[r]||(this.ParnerSkillloader[r]=new RES.Loader),this.ParnerSkillloader[r].dispatcher||this.ParnerSkillloader[r].get(r,null)}},e.prototype.delRelPartnerSkill=function(){for(var e in this.ParnerSkillloader)this.ParnerSkillloader[e].release(),delete this.ParnerSkillloader[e]},e.prototype.reset=function(e,t){var n=table.faction[e],i=n.resource;t&&table.avatars[t]&&(i=table.avatars[t].resource),this.faction!=e&&(this.delRelSkill(),this.faction=e,this.addRelSkill()),this.body!=i&&(this.delRelBody(),this.body=i,this.addRelBody())},e.prototype.delRelBody=function(){for(var e=this.resbody.length,t=0;e>t;t++)RES.delRel(this.resbody[t]);this.resbody=[]},e.prototype.delRelSkill=function(){for(var e=this.resskill.length,t=0;e>t;t++)RES.delRel(this.resskill[t]);this.resskill=[]},e}();__reflect(PlayerResource.prototype,"PlayerResource");var Player=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.init=function(){null==this.instance&&(this.instance=new t)},t.prototype.load=function(n,i,a,r,o){e.prototype.load.call(this,n,!1,a,r,o),null==t.cacheResource?t.cacheResource=new PlayerResource(r,o):t.cacheResource.reset(r,o)},t.prototype.setAvatar=function(n){e.prototype.setAvatar.call(this,n),t.cacheResource.reset(this.faction,this.avatar)},t.prototype.SetMaxLife=function(t){e.prototype.SetMaxLife.call(this,t)},t.prototype.onLifeChange=function(e){e>0&&this.actor.popHeal(e)},t.prototype.pushCommand=function(e,t){null!=this.workingCmd.cmd&&(this.workingCmd.cmd.abort(),this.workingCmd.cmd.release()),this.workingCmd.cmd=t,this.workingCmd.action=e,t.begin()},t.prototype.doDie=function(){AI.unload(),this.actor.onDie(),e.prototype.doDie.call(this),PlayerAttribute.ClearCoolDown(),Game.dispatcher.dispatchEventWith(Game.EVENT.PlayerDie)},t.prototype.doRevive=function(t){e.prototype.doRevive.call(this,t),AI.load(),Game.dispatcher.dispatchEventWith(Game.EVENT.PlayerRevive)},t.prototype.init=function(){Game.dispatcher.dispatchEventWith(Game.EVENT.onPlayerInited)},t.prototype.navNext=function(){if(null==this.navPath||0==this.navPath.length)return!1;var e;do{if(0==this.navPath.length)break;e=this.navPath.pop()}while(null==e||this.logicPos.equals(e));if(null==e)return!1;var t=new net.def.C2SRun;return t.setDesX(e.x),t.setDesY(e.y),net.socket.write(3,t.toArrayBuffer()),!0},t.prototype.navClear=function(){this.navPath=null},t.prototype.navExist=function(){return null!=this.navPath&&this.navPath.length>0},t.prototype.getCurTargetPoint=function(){if(this.workingCmd.action==Action.Status.Running){var e=this.workingCmd.cmd;return e.desPoint}return null},t.prototype.nav=function(e){if(!(this.MoveSpeed<=0||this.dead)){if(0==e.length)return void egret.error("path == null?");var t=this.getCurTargetPoint();(null==t||!g_WithInRange(t,e[0],100)&&!g_WithInRange(t,e[e.length-1],100))&&(this.navPath=e,this.navNext())}},t.prototype.navTo=function(e,t,n){if(e.x<0||e.x>=World.width||e.y<0||e.y>=World.height)return egret.error("point=("+e.x+","+e.y+") World.width="+World.width+" World.height="+World.height),!1;if(this.dead)return!1;if(this.MoveSpeed<=0)return!1;if(this.logicPos.equals(e))return!1;if(!n)if(this.navExist()){if(g_WithInRange(this.navPath[0],e,100))return!0}else{var i=this.getCurTargetPoint();if(null!=i&&g_WithInRange(i,e,100))return!0}return this.navPath=Scene.SearchPath(this.logicPos,e,t),this.navNext()},t.prototype.onSkillQuake=function(){egret.Tween.get(mapLayer).to({x:20,y:20},100).to({x:0,y:0},100)},Object.defineProperty(t.prototype,"selectable",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.SendAoeSkill=function(e,t,n){if(!this.dead){if(null==PlayerAttribute.findSkill(e))return void egret.error("[CmdSkill] skillId:"+e+" not found from player");Skill.mapSkill[e];PlayerAttribute.CoolDown(e,!0);var i=new net.def.C2SAoeSkill;i.id=e,i.posX=n.x,i.posY=n.y,net.socket.write(7,i.toArrayBuffer())}},t.prototype.SendDirSkill=function(e,t,n){if(!this.dead){if(null==PlayerAttribute.findSkill(e))return void egret.error("[CmdSkill] skillId:"+e+" not found from player");Skill.mapSkill[e];PlayerAttribute.CoolDown(e,!0);var i=new net.def.C2SDirSkill;
i.id=e,i.dir=n,net.socket.write(12,i.toArrayBuffer())}},Object.defineProperty(t.prototype,"delegateKind",{get:function(){return 1},enumerable:!0,configurable:!0}),t.prototype.SendCharSkill=function(e,t,n){if(!this.dead){if(null==PlayerAttribute.findSkill(e))return void egret.error("[CmdSkill] skillId:"+e+" not found from player");Skill.mapSkill[e];PlayerAttribute.CoolDown(e,!0);var i=new net.def.C2SCharSkill;i.id=e,i.setTarget(n),net.socket.write(6,i.toArrayBuffer())}},t.prototype.destroy=function(){this.navPath=null,e.prototype.destroy.call(this)},t.prototype.release=function(){},t.prototype.runCommand=function(e){this._runCommand(e)},t.prototype.onSkillBegin=function(e){if(null==PlayerAttribute.findSkill(e)&&e!=PlayerAttribute.rageSkill.Id)egret.error("[CmdSkill] skillId:"+e+" not found from player");else{Skill.mapSkill[e];if(PlayerAttribute.CoolDown(e,!1),PlayerAttribute.rageSkill.Id==e&&e!=PlayerAttribute.DefaultRageSkillId){var t=Partner.GetMainPartnerRageSkillInfo();null!=t&&t.skillId==e&&this.actor.popSkill(t.skillName,PopSkillType.PartnerRageSkill)}}},t.prototype.onMoveFinished=function(t){e.prototype.onMoveFinished.call(this,t),t&&this.navExist()&&this.navNext()},t.prototype.onStatusEffect=function(t,n,i){switch(e.prototype.onStatusEffect.call(this,t,n,i),n){case 3:case 5:PlayerAttribute.ClearCoolDown(),AI.bb.wait=0}},t.prototype.updateIFFS=function(){this.actor.head.changeLifeBarState("self");for(var e in mapCharacter){var t=mapCharacter[e];t&&t!=this&&t.updateIFFS()}},t.prototype.SetGuildName=function(e){this.guildName=e,this.actor.head.updateGuildName(e),e&&this.actor.head.updateGuildColor(!0);for(var t in mapCharacter){var n=mapCharacter[t];n&&n!=this&&n.guildName&&(n.guildName==e?n.actor.head.updateGuildColor(!0):n.actor.head.updateGuildColor(!1))}},t.prototype.tryCastSkill=function(e){return this.dead?!1:PlayerAttribute.canCastRageSkill(e,!0)&&PlayerAttribute.canCastSkill(e)?null==PlayerAttribute.findSkill(e)?!1:AI.useSkill(e)?(AI.stopMove(),!0):!1:!1},t.prototype.bleed=function(e){var t=this.actor;t&&t.pushBleedHurt(e)},t}(Character);__reflect(Player.prototype,"Player");var FightAttribute=function(){function e(){this.Attack=0,this.Defense=0,this.SeriesAttack=[0,0,0,0,0],this.SeriesDefense=[0,0,0,0,0],this.Hit=0,this.Dodge=0,this.SeriesAggravation=0,this.SeriesMitigation=0,this.Strike=0,this.AntiStrike=0,this.SeriesNeglectDefense=[0,0,0,0,0],this.RecoverLife=0,this.DamageBounce=0,this.ReduceImmobilizedTime=0,this.ReduceRetardTime=0,this.ReduceDizzyTime=0,this.ReduceWeakenTime=0,this.ReduceToxicTime=0,this.EnhanceImmobilizedTime=0,this.EnhanceRetardTime=0,this.EnhanceWeakenTime=0,this.DizzyAddition=0,this.EnhanceToxicTime=0,this.StrikeDamageAggravation=0,this.StrikeDamageMitigation=0,this.RageRecoverySpeed=0,this.JueXueAttack=0,this.JueXueDefence=0,this.JueXueStrike=0,this.JueXueAntiStrike=0,this.JueXueAttackAggravation=0,this.JueXueAttackMitigation=0}return e}();__reflect(FightAttribute.prototype,"FightAttribute");var PlayerAttribute;!function(e){function t(e){ut=e,Game.dispatcher.dispatchEventWith(Game.EVENT.OnRageChange)}function n(e){t(ut+e)}function i(){return ut}function a(t){e.RageRecoverySpeed=t,e.RagePerFrame=e.RageRecoverySpeed/Game.FPS}function r(t){e.Exp+=t}function o(t,n){e.Level<TenfoldAward.LIMIT_LEVEL&&t>=TenfoldAward.LIMIT_LEVEL&&UI.battle.addDExpBtn(),e.Level<SwapAttribute.MinLevel&&t>=SwapAttribute.MinLevel&&badge.onLight(badge.action.ActivedSwapAttribute,!0),e.Level<WulinLiansai.NEEDLEVEL&&t>=WulinLiansai.NEEDLEVEL&&badge.onLight(badge.action.WulinLiansai,!0),MasterChallenge.makeBadge(t);var i=t%10-1;i>0&&rt(i)&&badge.onLight(badge.action.AutoEquip,!0);var a=LittleBoss.getNextMapId();if(null!=a){var r=LittleBoss.getNextLevel();e.Level<r&&t>=r&&UI.battle&&UI.LittleBossIcon.show(a,UI.battle.activityBtnGroup)}var o=e.Level,u=t,c=t-e.Level,h=0;e.Level<=180&&180>=t?h=t-e.Level:e.Level<=180&&t>180&&(h=180-e.Level),e.Level=t,e.MaxExp=table.level[t].exp,e.Exp=n,e.skillpoint=e.skillpoint+h,e.abilitypoint=e.abilitypoint+5*c,badge.playerBadge(),Recharge.badgeFunding();for(var d=0;d<e.skills.length;d++){var p=e.skills[d];p.Locked=Skill.mapSkill[p.Id].needLevel>e.Level}Game.dispatcher.dispatchEventWith(Game.EVENT.LevelUp),q(!0),UIManager.push(new UI.LevelUpNoticeUI(o,u)),l(o,u),s()}function s(){var t=!1;for(var n in table.levelUpGift)if(!table.levelUpGift[n].status&&e.Level>=Number(n)){t=!0;break}badge.onLight(badge.action.LevelUpGift,t)}function l(t,n){if(30>=n)return!1;var i=10*Math.floor(n/10)+1;if(t>i||i>n)return!1;for(var a=0;a<Game.EquipPart.EquipCount;a++){var r=e.bag.equips[a];for(var o in r){var s=e.bag.GetBagItem(Number(o));if(1==UI.EquipUse.instance.equipPush(s))return void(null==UI.EquipUse.instance.parent&&UIManager.push(UI.EquipUse.instance))}}}function u(t,n){for(var i=e.skillSlots,a=0;a<i.length;a++){var r=i[a];if(a!=t&&n==r.id)return i[a]=i[t],i[t]=r,null!=i[t]&&v(i[t].id,!1),void(null!=i[a]&&v(i[a].id,!1))}var o=Skill.mapSkill[n];v(n,!1),i[t].id=n,i[t].name=o.name,i[t].icon=o.icon}function c(t){var n=Skill.mapSkill[t],i=e.GetSkillFinalLevel(t);if(n.rage>0){var a=Game.MaxRage;return 100*(a-ut)/a}var r=ct[t];if(null==r||r.modifiable)return 0;var o=r.time,s=egret.getTimer();return 100*(o-s)/n.cd[i-1]}function h(){for(var e in ct)ct[e].modifiable&&(ct[e].time=0,ct[e].modifiable=!1)}function d(e,t){ct[e]={modifiable:!1,time:egret.getTimer()+t}}function p(t){if(null==e.rageSkill){var n=new CharacterSkill;n.Id=-1,n.Level=0,e.rageSkill=n}var i=Partner.GetRageSkill(),a=i.id;if(t||e.rageSkill.Id!=i.id||e.rageSkill.Level!=i.level){var r=e.rageSkill.Id,o=ct[r];e.rageSkill.Id=a,e.rageSkill.Level=i.level,null!=o&&delete ct[r],d(a,0),Game.dispatcher.dispatchEventWith(Game.EVENT.RageSkillChange)}}function g(t){switch(t){case 20001:case 20002:case 20003:case 20004:case 20007:case 20038:case e.DefaultRageSkillId:return!0;default:return!1}}function m(e,t){return g(e)?null==World?!0:1==World.mapId&&Prologue.canRageSkill()?!0:Game.isWildMap()?!0:(t&&PopUpMessage.push(lang.String("cannot use rage skill in current map"),color.RED),!1):!0}function f(t){var n=Skill.mapSkill[t];if(null==n)return!1;var a=(e.GetSkillFinalLevel(t),i());if(null!=n.rage&&a<n.rage)return!1;var r=ct[t],o=egret.getTimer();return null==r?!1:o>r.time}function v(e,t){ct[e]={modifiable:t,time:Skill.getSkillCD(e)+egret.getTimer()}}function y(i){Game.MaxRage>ut&&!Player.instance.dead&&(n(~~i*e.RagePerFrame),ut>Game.MaxRage&&t(Game.MaxRage))}function b(){for(var t=-1,n=0;n<e.enhancement.length;n++){var i=e.enhancement[n];(0>t||t>i)&&(t=i)}return t}function S(){var t=e.skillSlots,n=new net.def.C2SChangeSkillSlot;n.slots=[];for(var i=0;i<t.length;i++)n.slots[i]=t[i].id;net.socket.write(29,n.toArrayBuffer())}function E(t,n){e.mapSkills[t].Level=n}function C(t,n){e.mapSkills[t].ExtendLevel=n}function T(t,n){null!=e.passiveSkill[t]&&(e.passiveSkill[t].extendLevel=n)}function I(t){if(null==e.mapSkills[t])return 1;var n=e.mapSkills[t];return n.GetFinalLevel()}function G(t){return t.Level<=e.Level?!0:!1}function A(t){return t==e.rageSkill.Id?e.rageSkill:e.mapSkills[t]}function k(t){if(badge.checkPartner(t),badge.checkPartnerEquipOnNewEquip(t),e.bag.AddItem(t),badge.checkPartnerEquipOnNewMaterial(t),Partner.recruiting||PopUpMessage.push(lang.StringWithFormat("get item {1}{2}",t.Item.Name,t.Item.Count),color.GREEN),6==t.Item.Type){var n=t.Item;if(null==e.books[n.category])return void n.Use()}switch(Game.dispatcher.dispatchEventWith(Game.EVENT.AddItem,!1,t,!1),t.Item.Type){case 1:null==UI.TreasureUse.instance.parent&&UI.TreasureUse.instance.check(t.Item)&&(UI.TreasureUse.instance.id=t.Item.DetailType,UI.TreasureUse.instance.showPage());break;case 0:1==UI.EquipUse.instance.equipPush(t)?null==UI.EquipUse.instance.parent&&UIManager.push(UI.EquipUse.instance):badge.checkSwapAttribute(t)}}function P(t){for(var n in t)e.books[n]=t[n];q(!1),Game.dispatcher.dispatchEventWith(Game.EVENT.BooksChange)}function w(t){e.books[t.category]=t,q(!0),badge.onLight(badge.BookChange[t.category],!1),Game.dispatcher.dispatchEventWith(Game.EVENT.BooksChange)}function L(t){e.wenshis[t.pos]=t,q(!0),Game.dispatcher.dispatchEventWith(Game.EVENT.WenShiChange)}function R(t){for(var n in t)e.Equips[n]=t[n];EquipmentSet.onEquipChanged(),q(!1),Game.dispatcher.dispatchEventWith(Game.EVENT.EquipsChange)}function U(t){PlayerGem.CheckGemBadge(),e.Equips[t.Part]=t,EquipmentSet.onEquipChanged(),q(!0),Game.dispatcher.dispatchEventWith(Game.EVENT.EquipsChange)}function _(){for(var t=0,n=-1,i=0;i<e.enhancement.length;i++){var a=e.enhancement[i];a>0&&(t+=table.enhancement[i][a-1].power),(0>n||n>a)&&(n=a)}for(var r=table.enhancement[Game.EquipPart.EquipCount],o=r.length-1;o>=0;o--)if(n>=r[o].level){t+=r[o].power;break}return t}function x(){for(var t=0,n=0;n<e.skills.length;n++){var i=Skill.mapSkill[e.skills[n].Id];e.Level<i.needLevel||e.skills[n].Level<1||(t+=table.skillpower[e.skills[n].GetFinalLevel()-1])}return t}function M(){var t=0;for(var n in e.Equips)null!=e.Equips[n]&&(t+=e.Equips[n].FightingPower);return t+=EquipmentSet.fp}function D(){for(var t=0,n=-1,i=0;i<e.enhancement.length;i++){var a=e.enhancement[i];a>0&&(t+=table.enhancement[i][a-1].power),(0>n||n>a)&&(n=a)}for(var r=table.enhancement[Game.EquipPart.EquipCount],o=r.length-1;o>=0;o--)if(n>=r[o].level){t+=r[o].power;break}return t}function N(){var t=0;for(var n in e.books)null!=e.books[n]&&(t+=e.books[n].FP);return t}function F(e){var t={};for(var n in e)if(null!=e[n]){var i=e[n].SuitId,a=e[n].Quality;null==t[i]&&(t[i]={}),null==t[i][a]?t[i][a]=1:t[i][a]+=1}var r={};r.Attr=[],r.Fp=[];var o=function(e,t){return t-e},s=function(e,t){for(var n=0;n<e.length;n++)if(e[n]==t)return!1;return!0};for(var l in t){var i=parseInt(l),u=t[i],c=Item.JueXue.GetSuitName(i),h=[],d=[];for(var a in u)d.push(parseInt(a));d=d.sort(o);for(var p=d[0],g=u[p],m=Item.JueXue.GetSuit(i,p),f=0;f<m.activate.length;f++){var v=m.activate[f];if(s(h,v)&&g>=v&&(r.Attr.push({suitid:i,quality:p,attr:m.attrs[f],name:c,count:g,limit:v}),r.Fp.push(m.fightPower[f]),h.push(v),h.length>=m.activate.length))break}if(h.length>=m.activate.length)break;for(var y=1;y<d.length;y++){var b=d[y];g+=u[b];for(var S=Item.JueXue.GetSuit(i,b),E=0;E<S.activate.length;E++){var C=S.activate[E];!(s(h,C)&&g>=C&&(r.Attr.push({suitid:i,quality:b,attr:S.attrs[E],name:c,count:g,limit:C}),r.Fp.push(S.fightPower[E]),h.push(C),h.length>=S.activate.length))}if(h.length>=S.activate.length)break}}return r}function O(e){var t=0;for(var n in e)null!=e[n]&&(t+=e[n].FightingPower);for(var i=F(e),a=0;a<i.Fp.length;a++)t+=i.Fp[a];return t}function B(e){var t=0;for(var n in e)null!=e[n]&&(t+=e[n].FightPower);return t}function W(){var t=lang.Format("{1},{2},{3},{4},{5},{6},{7},{8},{9},{10},{11},{12},{13},{14},{15},{16},{17},{18},{19},{20},{21},{22},{23},{24}",Player.instance.FightingPower,table.level[e.Level].fightingPower,x(),M(),Guild.GetGuildSkillFp(),PassiveSkillManager.GetPassiveSkillFp(),PartnerEquipManager.GetAllPartnerEquipFightingPower(),D(),PlayerGem.GetTotalPower(),Meridian.fp,Partner.GetTotalPower(),FactionTitle.getCurFP(),CommonTitle.getFP(),N(),e.superWeapons.getFp(),Avatar.getFp(),collectCardManager.GetTotalFp(),Refine.GetTotalFp(),Rune.GetTotalFp(),Wuxingyinmanager.fightingPower,PartnerEquipEnhance.GetFightingPower(),PartnerQingyi.GetFightingPower(),O(e.juexues),B(e.wenshis));egret.log(t)}function V(t){var n=table.level[e.Level].fightingPower;n+=x(),n+=M(),n+=Guild.GetGuildSkillFp(),n+=PassiveSkillManager.GetPassiveSkillFp(),n+=PartnerEquipManager.GetAllPartnerEquipFightingPower(),n+=D(),n+=PlayerGem.GetTotalPower(),n+=Meridian.fp,n+=Partner.GetTotalPower(),n+=FactionTitle.getCurFP(),n+=CommonTitle.getFP(),n+=N(),n+=e.superWeapons.getFp(),n+=Avatar.getFp(),n+=collectCardManager.GetTotalFp(),n+=Refine.GetTotalFp(),n+=Rune.GetTotalFp(),n+=Wuxingyinmanager.fightingPower,n+=PartnerEquipEnhance.GetFightingPower(),n+=PartnerQingyi.GetFightingPower(),n+=O(e.juexues),n+=B(e.wenshis),t&&n!=e.fp&&UI.FPPromote.show(n-e.fp),e.fp=n,Player.instance.FightingPower=n,Game.dispatcher.dispatchEventWith(Game.EVENT.OnUpdateFp),ht=null}function q(e){null!=ht&&(egret.clearTimeout(ht),V(!1),ht=null),e?V(e):ht=egret.setTimeout(V,null,50,e)}function H(){null!=ht&&(egret.clearTimeout(ht),ht=null,V(!1))}function j(t,n){n>0&&(Partner.recruiting||PopUpMessage.push(lang.StringWithFormat("get "+Game.Currency[t]+" currency {1}",n),color.GREEN),t==Game.Currency.BetCoin&&UI.BetCoinPromote.show(n)),e.currency[t]+=n,e.currency[t]<1e4?e.currencyTxt[t]=e.currency[t].toString():e.currencyTxt[t]=""+Math.floor(e.currency[t]/1e4)+lang.String("wan")}function Y(t){e.currency=t;for(var n=0;n<e.currency.length;n++)e.currency[n]<1e4?e.currencyTxt[n]=e.currency[n].toString():e.currencyTxt[n]=""+Math.floor(e.currency[n]/1e4)+lang.String("wan")}function K(e){null!=e&&Q(e,1)}function Q(e,t){null==t&&(t=1);var n=new net.def.C2SUseItem;n.setId(e),n.setCount(t),net.socket.write(13,n.toArrayBuffer())}function X(t,n,i){if(!(0>=i)){var a=0,r=e.bag.findItem(t,n);(0==t||11==t)&&i>1&&(i=1);for(var o=0;o<r.length;o++){var s=r[o],l=e.bag.GetItemCount(s);l>=i?(a=i,i=0):(a=l,i-=a),Q(s,a)}}}function J(e,t){var n=(Z(e),new net.def.C2SRemoveItem);n.setId(e),n.setCount(t),net.socket.write(19,n.toArrayBuffer())}function z(t){return e.bag.RemoveItem(t)}function Z(t){return e.bag.GetBagItem(t)}function $(t,n){return e.bag.CalcCount(t,n)}function et(t,n,i){var a=e.bag.GetBagItem(t),r=e.bag.GetItem(t),o=n-r.Count;if(o>0){switch(Partner.recruiting||PopUpMessage.push(lang.StringWithFormat("get item {1}{2}",r.Name,o),color.GREEN),r.Type){case 1:null==UI.TreasureUse.instance.parent&&UI.TreasureUse.instance.check(a.Item)&&(UI.TreasureUse.instance.id=a.Item.DetailType,UI.TreasureUse.instance.showPage())}badge.checkPartner(a),badge.checkPartnerEquipOnNewEquip(a)}e.bag.UpdateItemCount(t,n),e.bag.UpdateItemExpiration(t,i),badge.checkPartnerEquipOnNewMaterial(a),Game.dispatcher.dispatchEventWith(Game.EVENT.UpdateItem,!1,a,!1)}function tt(e,t){var n=e.Item,i=t.Item;return nt(n,i)}function nt(e,t){return at(e,t)}function it(e){var t=e.Quality,n=e.Level;return 79*t*t+37*n}function at(e,t){var n=it(e),i=it(t);return n>i?-1:i>n?1:0}function rt(t){var n=e.Equips[t],i=e.bag.equips[t];if(null==i)return!1;for(var a in i){var r=parseInt(a),o=e.bag.items[r].Item;if(G(o)&&(null==n||nt(n,o)>0))return!0}return!1}function ot(){var t={};for(var n in e.bag.equips)for(var i in e.bag.equips[n]){var a=parseInt(i);null==t[n]&&(t[n]=[]);var r=e.bag.items[a];e.checkEquipLimit(r.Item)&&t[n].push(r)}for(var n=0;n<Game.EquipPart.EquipCount;n++){var o=t[n];if(!(null==o||o.length<=0)){o.sort(tt);var s=o[0],l=e.Equips[n];(null==l||nt(l,s.Item)>0)&&K(s.Id)}}}function st(){e.skills=[];for(var t=table.faction[e.faction],n=0;n<t.skills.length;n++){var i=t.skills[n],a=new CharacterSkill;a.init(i.id,i.level,Skill.mapSkill[i.id].needLevel>e.Level,n,0),e.skills.push(a),e.mapSkills[i.id]=a}}function lt(){return e.rageSkill?e.rageSkill.Id:e.DefaultRageSkillId}e.fp=0,e.bag=new Bag,e.vipItem=new Vip.VipItem(0),e.fa=new FightAttribute,e.superWeapons=new SuperWeapon.SuperWeapons,e.juexues={},e.wenshis={},e.DefaultRageSkillId=101,e.RageRecoverySpeed=20*Game.RageRatio,e.RagePerFrame=e.RageRecoverySpeed/Game.FPS;var ut=0;e.SetRage=t,e.AddRage=n,e.GetRage=i,e.SetRageRecoverySpeed=a;var ct={};e.skillSlots=[],e.currency=[],e.currencyTxt=[],e.skillpoint=0,e.Level=1,e.abilitypoint=0,e.strength=0,e.agility=0,e.outerPower=0,e.innerPower=0,e.skills=[],e.mapSkills={},e.canRename=!1,e.AddExp=r,e.doLevelUp=o,e.SetSkillSlot=u,e.getCDPercent=c,e.ClearCoolDown=h,e.updateCoolDown=d,e.UpdateRageSkill=p,e.IsWildRageSkillId=g,e.canCastRageSkill=m,e.canCastSkill=f,e.CoolDown=v,e.generateRage=y,e.getEnhanceExtraLevel=b,e.ApplyChangeSkillSelected=S,e.SetSkilllevel=E,e.SetSkillExtendLevel=C,e.SetPassiveSkillExtendLevel=T,e.GetSkillFinalLevel=I,e.checkEquipLimit=G,e.findSkill=A,e.AddItem=k,e.mountBooks=P,e.mountBook=w,e.mountWenShi=L,e.mountEquips=R,e.mountEquip=U,e.getEnhancementFP=_,e.GetJueXueSuit=F,e.GetJueXueFightPower=O,e.GetWenShiPower=B,e.ShowFightPower=W;var ht;e.UpdateFightingPower=q,e.StopUpdateFightingPower=H,e.ChangeCurreny=j,e.SyncCurreny=Y,e.useItem=K,e.useItemStack=Q,e.useItemByGD=X,e.discarditem=J,e.RemoveItem=z,e.GetItem=Z,e.GetItemCount=$,e.UpdateItemInfo=et,e.CompareBetterEquip=nt,e.hasBetterEquip=rt,e.AutoEquip=ot,e.loadFactionSkill=st,e.getRageSkillId=lt}(PlayerAttribute||(PlayerAttribute={}));var Action;!function(e){var t=function(){function e(){this.desPoint=egret.Point.create(0,0),this.vector={x:0,y:0}}return e.generate=function(t,n,i){var a=this.objectPool.pop();return a||(a=new e),a.init(t,n,i),a},Object.defineProperty(e.prototype,"actionName",{get:function(){return"run"},enumerable:!0,configurable:!0}),e.prototype.release=function(){e.objectPool.push(this)},e.prototype.__recycle=function(){this.delegate=null,this.onFinished=null,this.desPoint.setTo(0,0),this.vector.x=0,this.vector.y=0},e.prototype.init=function(e,t,n){this.delegate=e,this.ignoreObstacles=n,this.desPoint.setTo(t.x,t.y)},e.prototype.begin=function(){this.dt=0,this.delegate.actor.to(ActorAnimation.wlk,null,null);var e=this.delegate.logicPos;if(this.vector.x=e.x<<10,this.vector.y=e.y<<10,!e.equals(this.desPoint)){var t=g_GetDirIndex2(e,this.desPoint),n=t.dir,i=t.sin,a=t.cos;this.dir=n,this.sin=i,this.cos=a}},e.prototype.end=function(){null!=this.onFinished&&this.onFinished.call(this.delegate,this.delegate.logicPos.equals(this.desPoint)),this.delegate=null},e.prototype.abort=function(){this.end()},e.prototype.execute=function(e){return this.dt+=e,this.run(this.desPoint,this.delegate.MoveSpeed,e)},e.prototype.run=function(e,t,n){var i=this.delegate.logicPos,a=!1,r=~~(this.dt/Game.ServerMSPF);r>=1?this.dt-=Game.ServerMSPF*r:a=!0,t=t*n/Game.Second;var o=e.x-i.x,s=e.y-i.y;if(0==o&&0==s)return!1;var l=this.dir;return g_WithInRange(i,e,t)?(this.runStep(l,i,e),!1):(o=~~(this.cos*t),s=~~(this.sin*t),this.vector.x+=o,this.vector.y+=s,this.runStep(l,i,egret.Point.create(this.vector.x>>10,this.vector.y>>10))?!this.delegate.logicPos.equals(e):a)},e.prototype.runStep=function(e,t,n){return!this.ignoreObstacles&&Scene.HitObstacle(t.x,t.y,n.x,n.y)?!1:(this.delegate.locate(e,n),!0)},e.objectPool=new egret.Recycler,e}();e.CmdRun=t,__reflect(t.prototype,"Action.CmdRun",["Action.Node"]);var n=function(e){function t(t,n,i){var a=e.call(this)||this;return a.init(t,n,!1),a.speed=i,a}return __extends(t,e),t.prototype.execute=function(e){return this.dt=e,this.run(this.desPoint,this.speed,e)},t.prototype.release=function(){},t.prototype.__recycle=function(){},t}(t);e.CmdRush=n,__reflect(n.prototype,"Action.CmdRush")}(Action||(Action={}));var Action;!function(e){var t=function(){function e(){this.skillId=-1,this.skillLevel=-1}return Object.defineProperty(e.prototype,"actionName",{get:function(){return Skill.mapSkill[this.skillId].action},enumerable:!0,configurable:!0}),e.prototype.__recycle=function(){this["char"]=null,this.timestamp=0,this.state&&(this.state.release(),this.state=null),this.startTime=null,this.totalTime=null,this.skillId=-1,this.skillLevel=-1,this.onBegin=null,this.process=0},e.prototype.begin=function(){null!=this.onBegin&&this.onBegin.call(this["char"],this.skillId);var e=egret.getTimer(),t=Skill.mapSkill[this.skillId],n=Skill.CalcTime(t.actionTime,this["char"].AttackSpeed);this.totalTime=n,this["char"].actor.to(ActorAnimation[this.actionName],n/Game.MSPF,1),this.startTime=e,this.timestamp=0,this.process=0,this.runTimeLine(0)},e.prototype.end=function(){this.state=null,this["char"].actor.to(ActorAnimation.st,null,null),this["char"]=null,this.onBegin=null},e.prototype.abort=function(){this.end()},e.prototype.onSkillState=function(){return null},e.prototype.play=function(e){},e.prototype.runTimeLine=function(e){this.timestamp;this.timestamp=e;for(var t=Skill.mapSkill[this.skillId],n=t.timeline.length,i=this.process;n>i;i++){var a=t.timeline[i],r=Skill.CalcTime(a.time,this["char"].AttackSpeed);if(!(this.timestamp>=r))break;this.play(a),this.process++}return Skill.CalcTime(t.actionTime,this["char"].AttackSpeed)},e.prototype.execute=function(e){var t=egret.getTimer(),n=t-this.startTime,i=this.runTimeLine(n);if(i>0)return this.totalTime!=i&&(this["char"].actor.changeAttackSpeed(i/Game.MSPF),this.totalTime=i),i>n;if(null==this.state){var a=this.onSkillState();if(null==a)return!1;this.state=a}return this.state.execute(e)},e}();e.CmdSkill=t,__reflect(t.prototype,"Action.CmdSkill");var n=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.generate=function(e,n,i,a){var r=this.objectPool.pop();return r||(r=new t),r.init(e,n,i,a),r},t.prototype.release=function(){t.objectPool.push(this)},t.prototype.init=function(e,t,n,i){this.skillId=n,this.skillLevel=i,this["char"]=e,this.dir64=t},t.prototype.begin=function(){this["char"].dir64=this.dir64,e.prototype.begin.call(this)},t.prototype.play=function(e){e.play(this["char"],null,this.dir64,null,this.skillLevel)},t.prototype.onSkillState=function(){var e=Skill.mapSkill[this.skillId],t=e.stateCreater;return null!=t?t(this["char"],this.dir64):null},t.objectPool=new egret.Recycler,t}(t);e.CmdDirSkill=n,__reflect(n.prototype,"Action.CmdDirSkill",["Action.Node"]);var i=function(e){function t(){var t=e.call(this)||this;return t.pos=egret.Point.create(0,0),t}return __extends(t,e),t.generate=function(e,n,i,a){var r=this.objectPool.pop();return r||(r=new t),r.init(e,n,i,a),r},t.prototype.release=function(){t.objectPool.push(this)},t.prototype.__recycle=function(){e.prototype.__recycle.call(this),this.pos.setTo(0,0)},t.prototype.init=function(e,t,n,i){this.skillId=n,this.skillLevel=i,this["char"]=e,this.pos.setTo(t.x,t.y)},t.prototype.begin=function(){var t=Skill.mapSkill[this.skillId];(t.castTarget&&"self"!=t.lockType||t.castTarget&&"selfaoe"!=t.lockType)&&this["char"].lookAt(this.pos),e.prototype.begin.call(this)},t.prototype.play=function(e){var t=Skill.mapSkill[this.skillId];("self"==t.lockType||"selfaoe"==t.lockType)&&this.pos.copyFrom(this["char"].logicPos);var n=this["char"].dir64;this["char"].logicPos.equals(this.pos)||(n=g_GetDirIndex(this["char"].logicPos,this.pos)),"selfaoe"==t.lockType?e.play(this["char"],null,n,null,this.skillLevel):e.play(this["char"],null,n,this.pos,this.skillLevel)},t.prototype.onSkillState=function(){var e=Skill.mapSkill[this.skillId],t=e.stateCreater;return null!=t?t(this["char"],this.pos):null},t.objectPool=new egret.Recycler,t}(t);e.CmdAoeSkill=i,__reflect(i.prototype,"Action.CmdAoeSkill",["Action.Node"]);var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.generate=function(e,n,i,a){var r=this.objectPool.pop();return r||(r=new t),r.init(e,n,i,a),r},t.prototype.release=function(){t.objectPool.push(this)},t.prototype.__recycle=function(){e.prototype.__recycle.call(this),this.targetId=null},t.prototype.init=function(e,t,n,i){this.skillId=n,this.skillLevel=i,this["char"]=e,this.targetId=t},Object.defineProperty(t.prototype,"target",{get:function(){return mapCharacter[this.targetId]},enumerable:!0,configurable:!0}),t.prototype.begin=function(){null!=this.target&&this["char"].lookAt(this.target.logicPos),e.prototype.begin.call(this)},t.prototype.play=function(e){e.play(this["char"],this.target,this["char"].dir64,this["char"].logicPos,this.skillLevel)},t.objectPool=new egret.Recycler,t}(t);e.CmdCharSkill=a,__reflect(a.prototype,"Action.CmdCharSkill",["Action.Node"])}(Action||(Action={}));var Action;!function(e){function t(e,t){r[e][t]=!0}function n(){r=[];for(var e=a.Idle;e<=a.Last;e++)r[e]=[];for(var e=a.Idle;e<=a.Last;e++)t(e,a.Idle),t(a.Idle,e);t(a.Running,a.Running),t(a.Casting,a.Running)}function i(e,t){return!1}var a;!function(e){e[e.Idle=0]="Idle",e[e.Running=1]="Running",e[e.Casting=2]="Casting",e[e.Last=2]="Last"}(a=e.Status||(e.Status={}));var r;e.init=n,e.prior=i;var o=function(){function t(){this.clear()}return t.prototype.clear=function(){this.action=e.Status.Idle,this.cmd=null},t.prototype.copyFrom=function(e){this.action=e.action,this.cmd=e.cmd},Object.defineProperty(t.prototype,"actionName",{get:function(){return null==this.cmd?ActorAnimation[ActorAnimation.st]:this.cmd.actionName},enumerable:!0,configurable:!0}),t}();e.CommandAction=o,__reflect(o.prototype,"Action.CommandAction")}(Action||(Action={}));var Activity;!function(e){function t(t){var n=t.startTime,i=t.endTime,a=e.activites[t.id];n&&i&&0!=t.profile?(a||(a=new s,e.activites[t.id]=a),a.id=t.id,a.startTime=new Date(n.year,n.month-1,n.day,n.hour,n.minute,n.second),a.endTime=new Date(i.year,i.month-1,i.day,i.hour,i.minute,i.second),a.profile=t.profile):a&&(e.activites[t.id]=null);var r=u[t.id];null==r?egret.error("view="+a.id+" not found"):r()}function n(e){for(var n=net.def.S2CSyncActivites.decode(e),i=0,a=n.activites;i<a.length;i++){var r=a[i];t(r)}}function i(e){var n=net.def.Activity.decode(e);t(n)}function a(){net.Register(299,n),net.Register(300,i),NienBoss.loadActivity(),u[o.Activity_NienBoss]=function(){NienBoss.activity.init()},ActivityRecharge.load(),u[o.Activity_Recharge]=function(){ActivityRecharge.activity.init()},ActivityConsumption.load(),u[o.Activity_Consumption]=function(){ActivityConsumption.activity.init()},u[o.Activity_MonthlyAct]=monthlyactivity.OnStateUpdate,OpeningWheel.load(),u[o.Activity_Wheel]=function(){OpeningWheel.activity.init()},WeekendRecruit.load(),u[o.Activity_PartnerRecruit]=function(){WeekendRecruit.activity.init()},ActivityFlashSale.load(),u[o.Activity_FlashSale]=function(){ActivityFlashSale.activity.init()},Recharge7Day.load(),u[o.Activity_Recharge7Day]=function(){Recharge7Day.activity.init()},activityCollectTreasure.load(),u[o.Activity_CollectTreasure]=function(){activityCollectTreasure.activity.init()},DailyRecharge.load(),Bet.load(),u[o.Activity_Bet]=function(){Bet.activity.init()},ActivityLotteryTicket.load(),u[o.Activity_LotteryTicket]=function(){ActivityLotteryTicket.activity.init()},FortunePlan.load(),u[o.Activity_FortunePlan]=function(){FortunePlan.activity.init()},HalfYearDraw.load(),u[o.Activity_HalfYearDraw]=function(){HalfYearDraw.activity.init()},ActivityLoginGift.load(),u[o.Activity_LoginGift]=function(){ActivityLoginGift.activity.init()},ActivityGrouponBuy.load(),u[o.Activity_GrouponBuy]=function(){ActivityGrouponBuy.activity.init()},ActivityBuyRefund.load(),u[o.Activity_BuyRefund]=function(){ActivityBuyRefund.activity.init()},ActivityLuckyWheel.load(),u[o.Activity_LuckWheel]=function(){ActivityLuckyWheel.activity.init()},ActivityJxBook15.load(),u[o.Activity_JxBook15]=function(){ActivityJxBook15.activity.init()},ActivitySmashEggs.load(),u[o.Activity_SmashEggs]=function(){ActivitySmashEggs.activity.init()},ActivityDoubleEggs.load(),u[o.Activity_DoubleEggs]=function(){ActivityDoubleEggs.activity.init()},ActivityTreasureBowl.load(),u[o.Activity_TreasureBowl]=function(){ActivityTreasureBowl.activity.init()},ActivityGlobalWheel.load(),u[o.Activity_GlobalWheel]=function(){ActivityGlobalWheel.activity.init()},ActivityGlobalLuckWheel.load(),u[o.Activity_GlobalLuckWheel]=function(){ActivityGlobalLuckWheel.activity.init()}}function r(t){if(!e.activites||!e.activites[t])return"";var n=Game.getServerDate(),i=e.activites[t].endTime.getTime()-n.getTime();if(i>24*Game.Hour){var a=~~(i/Game.Hour/24),r=~~(i%(24*Game.Hour)/Game.Hour);return lang.StringWithFormat("{1}day{2}hours",a,r)}return i>Game.Hour?lang.StringWithFormat("{1}hours",~~(i/Game.Hour)):"Ít hơn 1 giờ"}var o;!function(e){e[e.Activity_Recharge=1]="Activity_Recharge",e[e.Activity_Consumption=2]="Activity_Consumption",e[e.Activity_MonthlyAct=3]="Activity_MonthlyAct",e[e.Activity_Wheel=4]="Activity_Wheel",e[e.Activity_PartnerRecruit=5]="Activity_PartnerRecruit",e[e.Activity_FlashSale=6]="Activity_FlashSale",e[e.Activity_Recharge7Day=7]="Activity_Recharge7Day",e[e.Activity_CollectTreasure=8]="Activity_CollectTreasure",e[e.Activity_Bet=9]="Activity_Bet",e[e.Activity_LotteryTicket=10]="Activity_LotteryTicket",e[e.Activity_NienBoss=11]="Activity_NienBoss",e[e.Activity_FortunePlan=12]="Activity_FortunePlan",e[e.Activity_HalfYearDraw=13]="Activity_HalfYearDraw",e[e.Activity_LoginGift=14]="Activity_LoginGift",e[e.Activity_GrouponBuy=15]="Activity_GrouponBuy",e[e.Activity_BuyRefund=16]="Activity_BuyRefund",e[e.Activity_LuckWheel=17]="Activity_LuckWheel",e[e.Activity_JxBook15=18]="Activity_JxBook15",e[e.Activity_SmashEggs=19]="Activity_SmashEggs",e[e.Activity_DoubleEggs=20]="Activity_DoubleEggs",e[e.Activity_TreasureBowl=21]="Activity_TreasureBowl",e[e.Activity_GlobalWheel=22]="Activity_GlobalWheel",e[e.Activity_GlobalLuckWheel=23]="Activity_GlobalLuckWheel"}(o=e.ActivityKind||(e.ActivityKind={}));var s=function(){function e(){}return e}();__reflect(s.prototype,"TaskActivity");var l=function(){function t(e){this.profiles=[],this.kindId=e}return t.prototype.inTime=function(){var t=Game.getServerDate();return e.activites&&e.activites[this.kindId]?t>=e.activites[this.kindId].startTime&&t<e.activites[this.kindId].endTime:!1},t.prototype.onTimer=function(){var e=this.inTime();1==this.open&&0==e?(this.open=!1,this.timer=null,SecondTicker.removeEventListener(this.onTimer,this),Game.dispatcher.dispatchEventWith(this.eventName,!1,this.open),this.badgeId&&badge.onLight(this.badgeId,this.open),this.openCallback&&this.openCallback(this.open)):(1!=e||this.open||(this.open=!0,Game.dispatcher.dispatchEventWith(this.eventName,!1,this.open),this.badgeId&&badge.onLight(this.badgeId,this.open),this.openCallback&&this.openCallback(this.open)),null==this.timer&&(this.timer=!0,SecondTicker.addEventListener(this.onTimer,this)))},t.prototype.init=function(){var t=this;if(!e.activites[this.kindId])return void(1==this.open&&(this.open=!1,SecondTicker.removeEventListener(this.onTimer,this),Game.dispatcher.dispatchEventWith(this.eventName,!1,this.open),this.badgeId&&badge.onLight(this.badgeId,this.open),this.openCallback&&this.openCallback(this.open)));for(var n=e.activites[this.kindId].profile,i="",a=0;a<this.profiles.length;a++){var r=this.profiles[a];r.id==n&&(i=r.file)}this.loader||(this.loader=new RES.Loader),this.loader.url==i&&this.loader.dispatcher||(this.loader.release(),this.loader.get(i,function(e){t.loader.release(),t.settings=e,t.initSelf(),t.onTimer()}))},Object.defineProperty(t.prototype,"taskActivity",{get:function(){var t=e.activites;return t&&t[this.kindId]?t[this.kindId]:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reaminingTime",{get:function(){var t=e.activites;if(!t||!t[this.kindId])return"";var n=Game.getServerDate(),i=t[this.kindId].endTime.getTime()-n.getTime();if(i>24*Game.Hour){var a=~~(i/Game.Hour/24),r=~~(i%(24*Game.Hour)/Game.Hour);return lang.StringWithFormat("{1}day{2}hours",a,r)}return i>Game.Hour?lang.StringWithFormat("{1}hours",~~(i/Game.Hour)):"Ít hơn 1 giờ"},enumerable:!0,configurable:!0}),t}();e.MissionActivity=l,__reflect(l.prototype,"Activity.MissionActivity"),e.activites=egret.createMap();var u={};e.init=a,e.getLastTime=r}(Activity||(Activity={}));var ActivityBuyRefund;!function(e){function t(){e.activity=new Activity.MissionActivity(Activity.ActivityKind.Activity_BuyRefund),e.activity.eventName=Game.EVENT.ActivityBuyRefund;var t=RES.getRes("public_config/operation/buyrefund/buyrefund.json");e.activity.profiles=t.profile,e.activity.initSelf=function(){e.cfg=e.activity.settings,Game.dispatcher.dispatchEventWith(Game.EVENT.ActivityBuyRefund)},net.Register(241,n)}function n(t){var n=net.def.S2CSyncBuyRefundTask.decode(t);e._data=n.toRaw(),o(),Game.dispatcher.dispatchEventWith(Game.EVENT.ActivityBuyRefund)}function i(){if(null==e.activity.taskActivity)return-1;var t=~~((Game.getServerDate().getTime()-e.activity.taskActivity.startTime.getTime())/864e5);return t-1}function a(e){for(var t=0;t<e.length;t++)if(0==e[t])return t;return-1}function r(e){for(var t=0,n=0;n<e.length;n++)0!=e[n]&&t++;return t}function o(){if(null!=e._data){for(var t=i(),n=0;0>t&&n<e._data.buyed.values.length;n++)if(0==e._data.buyed.values[n])return void badge.onLight(badge.action.BuyRefund,!0);for(var n=0;t>=0&&t<e._data.buyed.values.length&&n<e._data.buyed.values.length;n++)if(0!=e._data.buyed.values[n]&&a(e._data.mark[n].values)>=0)return void badge.onLight(badge.action.BuyRefund,!0);
badge.onLight(badge.action.BuyRefund,!1)}}e.load=t,e.GetRefundDay=i,e.GetRefundIndex=a,e.GetRefundedNum=r,e.onLight=o}(ActivityBuyRefund||(ActivityBuyRefund={}));var activityCollectTreasure;!function(e){function t(){return e.unattunedcard}function n(){e.activity=new Activity.MissionActivity(Activity.ActivityKind.Activity_CollectTreasure),e.activity.eventName=Game.EVENT.CollectTreasureOpen;var t=RES.getRes("public_config/operation/collecttreasure/collecttreasure.json");e.activity.profiles=t.profiles,e.activity.openCallback=function(e){h(e)},e.activity.initSelf=function(){e.unattunedcard=e.activity.settings.unattunedcard,e.cardCfg=[];for(var t=e.activity.settings.cards,n=0;n<t.length;n++)e.cardCfg.push({id:t[n].id,name:t[n].name,weight:t[n].weight,count:0});e.amountCfg=[];for(var i=e.activity.settings.collectAward,n=0;n<i.length;n++)e.amountCfg.push({id:n+1,count:i[n].collects,status:null,awards:table.parseListAwards(i[n].award)});e.rankAwardCfg=[];for(var a=e.activity.settings.rankAward,n=0;n<a.length;n++){var r=void 0;a[n].weightLimit=e.activity.settings.rankScoreLimit,r=a[n].rankMin==a[n].rankMax?lang.StringWithFormat("rank{1}award",a[n].rankMin):lang.StringWithFormat("rank{1}award",a[n].rankMin+"-"+a[n].rankMax),e.rankAwardCfg.push({name:r,awards:table.parseListAwards(a[n].award),desc:lang.StringWithFormat("{1}above",a[n].weightLimit)})}e.rankData=[];for(var o=lang.String("leave the seat of honour open"),n=0;30>n;n++)e.rankData.push({rank:n+1,name:o,vip:null,value:null,guild:null})}}function i(e){if(0>=e)return"Đã quá hạn";if(60>e)return"Dưới 1 phút";if(3600>e){var t=~~(e/60);return t+" phút"}if(86400>e){var n=~~(e/3600),t=~~(e%3600/60);return n+" giờ "+t+" phút"}var i=~~(e/86400),a=~~(e%86400/3600);return i+" ngày "+a+" giờ"}function a(e){return s()?null==C?"-":i(C.leftTime-e):"Đã kết thúc"}function r(){return I}function o(t){return s()?PlayerAttribute.Level>=e.activity.settings.levelLimit?!0:(t&&PopUpMessage.push(lang.StringWithFormat("open on level {1}",e.activity.settings.levelLimit),color.Warning),!1):!1}function s(){return Activity.activites&&Activity.activites[Activity.ActivityKind.Activity_CollectTreasure]?!0:!1}function l(t){return s()?t?e.activity.settings.open10Cost:e.activity.settings.open1Cost:0}function u(){return e.myRank?e.myRank:lang.String("haveNoRank")}function c(){return e.activity.settings.background}function h(t){null!=t&&(t?UI.battle&&UI.battle.topGroup&&(e.CollectTreasureIcon||(e.CollectTreasureIcon=new UI.IconButton,e.CollectTreasureIcon.img=e.activity.settings.buttonImg,e.CollectTreasureIcon.action=badge.action.CollectTreasureIdentify+", "+badge.action.CollectTreasureAmountAward,e.CollectTreasureIcon.onTap=function(t){d(),e.CollectTreasureIcon.stopMovie()}),e.CollectTreasureIcon.parent!=UI.battle.leftGroup&&(UI.battle.addToLeftGroup(e.CollectTreasureIcon,0),e.CollectTreasureIcon.playMovie(-1))):(e.CollectTreasureIcon&&Game.removeFromParent.apply(e.CollectTreasureIcon),badge.onLight(badge.action.CollectTreasureAmountAward,!1),badge.onLight(badge.action.CollectTreasureIdentify,!1)))}function d(){e.mainUIVisiable||s()&&o(!0)&&UIManager.pushPage(new UI.CollectTreasureMainUI)}function p(){return net.socket.write(2070,null),!0}function g(){return net.socket.write(2073,null),!0}function m(t){var n=t?10:1;if(!(e.unattunedcard.count<n)){var i=(l(t),new net.def.C2SCollectTreasureApplyOpenCard);return i.openCount=n,net.socket.write(2071,i.toArrayBuffer()),!0}}function f(e){return s()&&o(!1)?!0:!1}function v(e){if(f(e)){var t=new net.def.C2SCollectTreasureApplyAward;return t.id=e,net.socket.write(2072,t.toArrayBuffer()),!0}}function y(t){e.unattunedcard.count+=t.emptyCardCount,PopUpMessage.push(lang.StringWithFormat("common get something {1} *num{2}",e.unattunedcard.name,t.emptyCardCount),color.RED);var n=lang.StringWithFormat("collecttreasure get emptybox",t.emptyCardCount);ChatSys.push2("",ChatSys.Identity.Sender_Identity_None,n,null,ChatSys.channel_system,0,0,"",!0),Game.dispatcher.dispatchEventWith(Game.EVENT.CollectTreasureDataChanged)}function b(t){C=t,e.totalValue=t.totalScore,e.unattunedcard.count=t.emptyCardCount,E(!1)?badge.onLight(badge.action.CollectTreasureIdentify,!0):badge.onLight(badge.action.CollectTreasureIdentify,!1);var n=t.cardCount;I=0;for(var i=0;i<e.cardCfg.length;i++)i<n.length?(e.cardCfg[i].count=n[i],n[i]>0&&I++):e.cardCfg[i].count=0;var a=t.award;badge.onLight(badge.action.CollectTreasureAmountAward,!1);for(var i=0;i<e.amountCfg.length;i++)I<e.amountCfg[i].count?e.amountCfg[i].status=0:i<a.length&&!a[i]?(e.amountCfg[i].status=1,badge.onLight(badge.action.CollectTreasureAmountAward,!0)):e.amountCfg[i].status=2;Game.dispatcher.dispatchEventWith(Game.EVENT.CollectTreasureDataChanged)}function S(t){T=t;var n=T.list;n.sort(function(e,t){return t.score-e.score}),e.myRank=null;for(var i=lang.String("leave the seat of honour open"),a=0;a<e.rankData.length;a++)a<n.length?(e.rankData[a].name=n[a].name,e.rankData[a].vip=n[a].vip,e.rankData[a].value=n[a].score,n[a].name==Player.instance.Name&&(e.myRank=""+e.rankData[a].rank)):(e.rankData[a].name=i,e.rankData[a].vip=null,e.rankData[a].value=null);Game.dispatcher.dispatchEventWith(Game.EVENT.CollectTreasureRankList)}function E(t){if(!s())return!1;if(!o(!1))return!1;if(null!=C&&C.leftTime<=0)return!1;var n=t?10:1;return e.unattunedcard.count&&e.unattunedcard.count>=n?!0:!1}e.cardCfg=[],e.amountCfg=[],e.rankData=[],e.mainUIVisiable=!1;var C,T,I=0;e.getCardConfig=t,e.load=n,e.getLastTime=a,e.getAmount=r,e.checkLevel=o,e.isActivity=s,e.getCost=l,e.getMyRank=u,e.getMapsource=c,e.OpenCollectTreasureUI=d,e.applyCardData=p,e.applyRankList=g,e.applyOpenCard=m,e.canApplyAward=f,e.applyAward=v,e.onSyncEmptyCardData=y,e.onSyncCardData=b,e.onSyncRankList=S,e.canOpenCard=E}(activityCollectTreasure||(activityCollectTreasure={}));var ActivityConsumption;!function(e){function t(){e.activity=new Activity.MissionActivity(Activity.ActivityKind.Activity_Consumption),e.activity.eventName=Game.EVENT.ActivityConsumptionOpen;var t=RES.getRes("public_config/operation/consumption/consumption.json");e.activity.profiles=t.profile,e.activity.initSelf=function(){e.awardsConfig=[];for(var t=0;t<e.activity.settings.length;t++){var n=table.parseListAwards(e.activity.settings[t].award);e.awardsConfig.push({amount:e.activity.settings[t].amount,awards:n})}},net.Register(312,n),net.Register(313,i),net.Register(314,a)}function n(t){var n=net.def.S2CSyncTaskRecharge.decode(t);e.totalConsumption=n.getGold(),e.awardsStatus=n.getStatus(),r()}function i(t){var n=net.def.Value.decode(t);e.totalConsumption=n.getValue(),Game.dispatcher.dispatchEventWith(Game.EVENT.ActivityTotalConsumption)}function a(t){var n=net.def.S2CAwards.decode(t);e.awardsStatus=n.getAwards(),r(),Game.dispatcher.dispatchEventWith(Game.EVENT.ActivityConsumptionStatus)}function r(){for(var t=!1,n=0;n<e.awardsStatus.length;n++)if(1==e.awardsStatus[n]){t=!0;break}badge.onLight(badge.action.ActiveConsumptionAward,t)}e.load=t}(ActivityConsumption||(ActivityConsumption={}));var ActivityDoubleEggs;!function(e){function t(){e.activity=new Activity.MissionActivity(Activity.ActivityKind.Activity_DoubleEggs),e.activity.eventName=Game.EVENT.ActivityDoubleEggs;var t=RES.getRes("public_config/operation/doubleeggs/doubleeggs.json");e.activity.profiles=t.profile,e.activity.initSelf=function(){e._cfg=e.activity.settings,e._goods=[];for(var t=e._cfg.shop.goods,n=0;n<t.length;n++)e._goods.push(Shop.MakeGoods(n,t[n],r,o));i()},UI.RechargeActivityHall.instance.registerFeature("DoubleEggs",new s),net.Register(2172,n)}function n(t){var n=net.def.S2CDoubleEggs.decode(t);e._data=n.toRaw(),i(),a(),Game.dispatcher.dispatchEventWith(Game.EVENT.ActivityDoubleEggs)}function i(){if(null!=e._goods&&null!=e._data&&e._data.dailyBuyGoodsRecord.length==e._goods.length)for(var t=0;t<e._goods.length;t++){var n=e._goods[t];n.param.curDailyBuyLimit=e._data.dailyBuyGoodsRecord[t]}}function a(){if(null!=e._data){e._buyRecord={};for(var t=0;t<e._data.dailyBuyedGiftPakages.length;t+=2){var n=e._data.dailyBuyedGiftPakages[t],i=e._data.dailyBuyedGiftPakages[t+1];e._buyRecord[""+n]=0!=i}}}function r(){return null==e._cfg?"":e._cfg.zhanhuoInfo.award}function o(t,n){if(null==e._cfg)return!0;var i=e._cfg.zhanhuoInfo.award.content,a=PlayerAttribute.GetItemCount(i.genre,i.detailType);if(a<n.curPrice)return PopUpMessage.push(lang.StringWithFormat("DoubleEggs not enough shopToken{1}",n.curPrice),color.RED),!0;var r=new net.def.UInt32;return r.value=t,net.socket.write(203,r.toArrayBuffer()),!1}e.load=t;var s=function(){function t(){this._button=null,this._content=null}return Object.defineProperty(t.prototype,"open",{get:function(){return e.activity.inTime()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"button",{get:function(){return null==this._button&&(this._button=new UI.RadioButton,this._button.label="Thiên Cơ Mật Cảnh",this._button.action=badge.action.DoubleEggs+","+badge.action.DoubleEggsCardAwad,this._button.icon="ui/city1/btn_shuandan.png",this._button.groupName="rechargeActivity",this._button.skinName="RadioTemp3Skin"),this._button},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"content",{get:function(){return null==this._content&&(this._content=new UI.DoubleEggs),this._content},enumerable:!0,configurable:!0}),t.prototype.onLight=function(e){badge.onLight(badge.action.DoubleEggs,e)},t.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.ActivityDoubleEggs,this.onEvent,this)},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.ActivityDoubleEggs,this.onEvent,this)},t.prototype.onEvent=function(e){UI.RechargeActivityHall.instance.onActivityEvent(e.data,this)},t}();e.Feature=s,__reflect(s.prototype,"ActivityDoubleEggs.Feature",["UI.ActivityFeature"])}(ActivityDoubleEggs||(ActivityDoubleEggs={}));var ActivityFlashSale;!function(e){function t(){e.activity=new Activity.MissionActivity(Activity.ActivityKind.Activity_FlashSale),e.activity.eventName=Game.EVENT.ActivityFlashSaleOpen;var t=RES.getRes("public_config/operation/scarebuying/scarebuying.json");e.activity.profiles=t.profile,e.activity.initSelf=function(){e.goodsConfig=[];for(var t=0;t<e.activity.settings.length;t++){for(var n=[],i=e.activity.settings[t].goods,a=0;a<i.length;a++){var r={type:i[a].type,content:i[a].content},o={idx:a,item:r,awards:i[a].awards||[],price:i[a].price,discount:i[a].discount,amount:i[a].limitCount,saleState:"waiting"};n.push(o)}e.goodsConfig.push(n)}},net.Register(2079,a),net.Register(2080,i),net.Register(2081,r)}function n(){return Math.floor((e.status.lastTime.getTime()-Game.getServerDate().getTime())/Game.Second)}function i(t){var n=net.def.UInt32Silce.decode(t);e.awardsAmount=n.getValues(),Game.dispatcher.dispatchEventWith(Game.EVENT.ActivityFlashSaleAmount)}function a(t){var n,i,a=net.def.UInt32Silce.decode(t),r=a.getValues();if(r[2]>0){var o=Game.getServerDate().getTime()+r[2]*Game.Second;n=new Date(o),i=!0}else{var o=Game.getServerDate().getTime()+r[1]*Game.Second;n=new Date(o),i=!1}e.status={sale:r[0],lastTime:n,batch:r[3],nextRound:i};for(var s=[],l=4;l<r.length;l++)s.push(r[l]);e.awardsAmount=s,Game.dispatcher.dispatchEventWith(Game.EVENT.ActivityFlashSaleStatus)}function r(e){var t=net.def.UInt32.decode(e),n="";switch(t.value){case 1:n=lang.String("not enough goldcoin");break;case 2:n=lang.String("shop not enough stock");break;case 3:n=lang.String("abnormal error");break;case 4:n=lang.String("scarebuying too slow to timeout");default:return}PopUpMessage.push(n,color.RED)}function o(t){if(1!=e.status.sale)return void PopUpMessage.push(lang.String("not open"),color.RED);var n=new net.def.UInt32;n.setValue(t),net.socket.write(2065,n.toArrayBuffer())}function s(){net.socket.write(2066,null)}function l(){net.socket.write(2064,null)}e.status=null,e.load=t,e.getLastTime=n,e.c2s_buy=o,e.c2s_Unsubscribe=s,e.c2s_apply=l}(ActivityFlashSale||(ActivityFlashSale={}));var ActivityGlobalLuckWheel;!function(e){function t(){e.activity=new Activity.MissionActivity(Activity.ActivityKind.Activity_GlobalLuckWheel),e.activity.eventName=Game.EVENT.ActivityGlobalLuckWheel;var t=RES.getRes("public_config/operation/globalluckwheel/globalluckwheel.json");e.activity.profiles=t.profile,e.activity.initSelf=function(){e._cfg=e.activity.settings,e._goods=[];for(var t=e._cfg.shopgoods,n=0;n<t.length;n++)e._goods.push(Shop.MakeGoods(n,t[n],u,c));h(),badge.onLight(badge.action.GlobalLuckWheel,!0)},UI.RechargeActivityHall.instance.registerFeature("GlobalLuckWheel",new d),net.Register(2177,i),net.Register(2178,a),net.Register(2179,n)}function n(t){var n=net.def.S2CPlayerGlobalWheelTask.decode(t);e._playerdata=n.toRaw(),h(),l(),Game.dispatcher.dispatchEventWith(Game.EVENT.ActivityGlobalLuckWheel)}function i(t){var n=net.def.C2SGlobalWheelTask.decode(t);e._globaldata=n.toRaw(),l(),Game.dispatcher.dispatchEventWith(Game.EVENT.ActivityGlobalLuckWheel)}function a(t){var n=net.def.UInt32Silce.decode(t);e._lotteryret=n.toRaw(),Game.dispatcher.dispatchEventWith(Game.EVENT.ActivityGlobalLuckWheelLottery)}function r(e){var t=new net.def.UInt32;t.value=e,net.socket.write(2207,t.toArrayBuffer())}function o(){net.socket.write(2208,null)}function s(e){var t=new net.def.UInt32;t.value=e,net.socket.write(2209,t.toArrayBuffer())}function l(){}function u(){return null==e._cfg?{}:e._cfg.integralAward}function c(t,n){if(null==e._cfg)return!0;var i=e._cfg.integralAward.content,a=PlayerAttribute.GetItemCount(i.genre,i.detailType);if(a<n.curPrice)return PopUpMessage.push(lang.StringWithFormat("GlobalLuckWheel not enough shopToken{1}",n.curPrice),color.RED),!0;var r=new net.def.UInt32;return r.value=t,net.socket.write(2210,r.toArrayBuffer()),!1}function h(){if(null!=e._goods&&null!=e._playerdata&&e._playerdata.dailyBuyGoodsRecord.length==e._goods.length)for(var t=0;t<e._goods.length;t++){var n=e._goods[t];n.param.curDailyBuyLimit=e._playerdata.dailyBuyGoodsRecord[t]}}e.load=t,e.Lottery=r,e.DoLottery=o,e.subscribe=s,e.onLight=l,e.currency=u;var d=function(){function t(){this._button=null,this._content=null}return Object.defineProperty(t.prototype,"open",{get:function(){return e.activity.inTime()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"button",{get:function(){return null==this._button&&(this._button=new UI.RadioButton,this._button.label="Hoạt động Tầm Bảo",this._button.action=""+badge.action.GlobalLuckWheel,this._button.icon="ui/city1/qfxy.png",this._button.groupName="rechargeActivity",this._button.skinName="RadioTemp3Skin"),this._button},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"content",{get:function(){return null==this._content&&(this._content=new UI.GlobalLuckWheel),this._content},enumerable:!0,configurable:!0}),t.prototype.onLight=function(e){badge.onLight(badge.action.GlobalLuckWheel,e)},t.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.ActivityGlobalLuckWheel,this.onEvent,this)},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.ActivityGlobalLuckWheel,this.onEvent,this)},t.prototype.onEvent=function(e){UI.RechargeActivityHall.instance.onActivityEvent(e.data,this)},t}();e.Feature=d,__reflect(d.prototype,"ActivityGlobalLuckWheel.Feature",["UI.ActivityFeature"])}(ActivityGlobalLuckWheel||(ActivityGlobalLuckWheel={}));var ActivityGlobalWheel;!function(e){function t(){e.activity=new Activity.MissionActivity(Activity.ActivityKind.Activity_GlobalWheel),e.activity.eventName=Game.EVENT.ActivityGlobalWheel;var t=RES.getRes("public_config/operation/globalwheel/globalwheel.json");e.activity.profiles=t.profile,e.activity.initSelf=function(){e._cfg=e.activity.settings,badge.onLight(badge.action.GlobalWheel,!0)},UI.RechargeActivityHall.instance.registerFeature("GlobalWheel",new l),net.Register(2175,n),net.Register(2176,i)}function n(t){var n=net.def.C2SGlobalWheelTask.decode(t);e._globaldata=n.toRaw(),s(),Game.dispatcher.dispatchEventWith(Game.EVENT.ActivityGlobalWheel)}function i(t){var n=net.def.UInt32Silce.decode(t);e._lotteryret=n.toRaw(),Game.dispatcher.dispatchEventWith(Game.EVENT.ActivityGlobalWheelLottery)}function a(e){var t=new net.def.UInt32;t.value=e,net.socket.write(2204,t.toArrayBuffer())}function r(e){var t=new net.def.UInt32;t.value=e,net.socket.write(2206,t.toArrayBuffer())}function o(){net.socket.write(2205,null)}function s(){}e.load=t,e.Lottery=a,e.subscribe=r,e.DoLottery=o,e.onLight=s;var l=function(){function t(){this._button=null,this._content=null}return Object.defineProperty(t.prototype,"open",{get:function(){return e.activity.inTime()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"button",{get:function(){return null==this._button&&(this._button=new UI.RadioButton,this._button.label="Hoạt động May Mắn",this._button.action=""+badge.action.GlobalWheel,this._button.icon="ui/city1/qfjj.png",this._button.groupName="rechargeActivity",this._button.skinName="RadioTemp3Skin"),this._button},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"content",{get:function(){return null==this._content&&(this._content=new UI.GlobalWheel),this._content},enumerable:!0,configurable:!0}),t.prototype.onLight=function(e){badge.onLight(badge.action.GlobalWheel,e)},t.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.ActivityGlobalWheel,this.onEvent,this)},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.ActivityGlobalWheel,this.onEvent,this)},t.prototype.onEvent=function(e){UI.RechargeActivityHall.instance.onActivityEvent(e.data,this)},t}();e.Feature=l,__reflect(l.prototype,"ActivityGlobalWheel.Feature",["UI.ActivityFeature"])}(ActivityGlobalWheel||(ActivityGlobalWheel={}));var ActivityGrouponBuy;!function(e){function t(){e.activity=new Activity.MissionActivity(Activity.ActivityKind.Activity_GrouponBuy),e.activity.eventName=Game.EVENT.ActivityGrouponBuy;var t=RES.getRes("public_config/operation/grouponbuy/grouponbuy.json");e.activity.profiles=t.profile,e.activity.initSelf=function(){var t=e.activity.settings;e.minRankAmount=t.minRankAmount,e.info_GrouponAwards=[];for(var n=t.awards,i=0;i<n.length;i++)e.info_GrouponAwards.push({awards:n[i].award.content,count:n[i].gold,status:0});e.info_GrouponRankAwards=[];for(var a=t.rankawards,i=0;i<a.length;i++)e.info_GrouponRankAwards.push(a[i].award.content)},net.Register(221,n),net.Register(222,i),net.Register(240,a)}function n(t){e.rankList=[];for(var n=net.def.S2COpeningGrouponRankList.decode(t),i=0;i<n.list.length;i++)e.rankList.push({round:i+1,name:n.list[i].name,time:n.list[i].amount});Game.dispatcher.dispatchEventWith(Game.EVENT.GrouponBuyRanklist)}function i(t){var n=net.def.S2COpeningGrouponAward.decode(t);n.award&&badge.onLight(badge.action.GrouponBuy,!0),e.serverAmount!=n.amount&&(e.serverAmount=n.amount||0,Game.dispatcher.dispatchEventWith(Game.EVENT.GrouponBuyAmount))}function a(t){var n=net.def.S2COpeningGrouponStatus.decode(t);e.charged=n.charged,e.serverAmount!=n.serverAmount&&(e.serverAmount=n.serverAmount||0,Game.dispatcher.dispatchEventWith(Game.EVENT.GrouponBuyAmount)),e.personAmount!=n.personAmount&&(e.personAmount=n.personAmount||0,Game.dispatcher.dispatchEventWith(Game.EVENT.GrouponBuyAmount));for(var i=!1,a=!1,r=0;r<n.status.length;r++)e.grouponStatus[r]!=n.status[r]&&(e.grouponStatus[r]=n.status[r],i=!0),1==e.grouponStatus[r]&&(a=!0);i&&Game.dispatcher.dispatchEventWith(Game.EVENT.GrouponBuyStatus),badge.onLight(badge.action.GrouponBuy,a)}function r(e,t){return e.status==t.status?e.idx-t.idx:1==e.status?-1:1==t.status?1:e.status-t.status}e.grouponStatus=[],e.rankList=[],e.serverAmount=0,e.personAmount=0,e.minRankAmount=0,e.charged=!1,e.load=t,e.sortStatus=r}(ActivityGrouponBuy||(ActivityGrouponBuy={}));var ActivityJxBook15;!function(e){function t(){e.activity=new Activity.MissionActivity(Activity.ActivityKind.Activity_JxBook15),e.activity.eventName=Game.EVENT.ActivityJxBook15;var t=RES.getRes("public_config/operation/jxbook15/jxbook15.json");e.activity.profiles=t.profile,e.activity.initSelf=function(){e.cfg=e.activity.settings},UI.RechargeActivityHall.instance.registerFeature("JxBook15",new i),net.Register(297,n)}function n(t){var n=net.def.S2CJxBook15Task.decode(t);e._data=n.toRaw(),Game.dispatcher.dispatchEventWith(Game.EVENT.ActivityJxBook15)}e.load=t;var i=function(){function t(){this._button=null,this._content=null}return Object.defineProperty(t.prototype,"open",{get:function(){return e.activity.inTime()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"button",{get:function(){return null==this._button&&(this._button=new UI.RadioButton,this._button.label="Mật Đồ Thần Bí",this._button.action=""+badge.action.JxBook15,this._button.icon="ui/city1/znq.png",this._button.groupName="rechargeActivity",this._button.skinName="RadioTemp3Skin"),this._button},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"content",{get:function(){return null==this._content&&(this._content=new UI.JxBook15),this._content},enumerable:!0,configurable:!0}),t.prototype.onLight=function(e){},t.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.ActivityJxBook15,this.onEvent,this)},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.ActivityJxBook15,this.onEvent,this)},t.prototype.onEvent=function(e){UI.RechargeActivityHall.instance.onActivityEvent(e.data,this)},t}();e.Feature=i,__reflect(i.prototype,"ActivityJxBook15.Feature",["UI.ActivityFeature"])}(ActivityJxBook15||(ActivityJxBook15={}));var ActivityLoginGift;!function(e){function t(){e.activity=new Activity.MissionActivity(Activity.ActivityKind.Activity_LoginGift),e.activity.eventName=Game.EVENT.ActivityLoginGift;var t=RES.getRes("public_config/operation/logingift/logingift.json");e.activity.profiles=t.profile,e.activity.initSelf=function(){e.cfg=e.activity.settings},net.Register(220,n)}function n(t){var n=net.def.S2CSyncCumulativeLogin.decode(t);e._data=n.toRaw(),r(),Game.dispatcher.dispatchEventWith(Game.EVENT.LoginGiftLogin)}function i(){if(null==e._data)return!1;for(var t=0;t<e._data.bonus.length;t++)if(!e._data.bonus[t])return!1;return!0}function a(){if(null==e._data)return{idx:null,next:null};var t,n=e._data.count;e._data.count>=e._data.bonus.length?(n=e._data.bonus.length,t=null):t=e._data.count;for(var i=0;n>i;i++)if(!e._data.bonus[i])return{idx:i,next:t};return{idx:null,next:t}}function r(){if(i())badge.onLight(badge.action.LoginGift,!1);else{var e=a();null!=e.idx?badge.onLight(badge.action.LoginGift,!0):null!=e.next?badge.onLight(badge.action.LoginGift,!1):badge.onLight(badge.action.LoginGift,!1)}}e.load=t,e.finish=i,e.withDay=a,e.onLight=r}(ActivityLoginGift||(ActivityLoginGift={}));var ActivityLotteryTicket;!function(e){function t(e){return 3!=e.length?(egret.error("checkNotZero values length error"),!1):0!=e[0]&&0!=e[1]&&0!=e[2]}function n(e){return 0>e||e>=f.length?f[0]:f[e]}function i(e){return 0>e||e>=f.length?v[0]:v[e]}function a(){if(0==e.LastBettingsDate||0==e.globalLottery.length)return null;for(var t=0;t<e.globalLottery.length;t++)if(e.LastBettingsDate==e.globalLottery[t][0])return e.globalLottery[t].slice(1);return null}function r(e){var t=a();if(null==t)return!1;for(var n=0;n<t.length;n++)if(t[n]==e)return!0;return!1}function o(e){if(3!=e.length)return egret.error("checkNotZero values length error"),0;if(0==e[0]||0==e[1]||0==e[2])return 0;var t=a();if(null==t)return 0;for(var n=1,i=0;i<e.length;i++)for(var r=0;r<t.length;r++)e[i]==t[r]&&n++;return n}function s(e){return 0>e||e>=y.length?y[0]:y[e]}function l(){if(!e.activity.taskActivity)return"";var t=e.activity.taskActivity.endTime,n=new Date(t.getFullYear(),t.getMonth(),t.getDate()-1,20,0,0,0),i=Game.getServerDate();if(n>i){var a=~~(e.LastBettingsDate/1e4),r=~~(e.LastBettingsDate%1e4/100),o=~~(e.LastBettingsDate%1e4%100),s=new Date(a,r-1,o+1,20,0,0,0);return FormatDDHH(~~((s.getTime()-i.getTime())/1e3))}return FormatDDHH(~~((t.getTime()-i.getTime())/1e3))}function u(){e.activity=new Activity.MissionActivity(Activity.ActivityKind.Activity_LotteryTicket),e.activity.eventName=Game.EVENT.ActivityLotteryTicket;var t=RES.getRes("public_config/operation/lotteryticket/lotteryticket.json");e.activity.profiles=t.profile,e.activity.initSelf=function(){e.cfg=e.activity.settings},net.Register(2107,c)}function c(t){var n=net.def.UInt32Silce.decode(t);switch(n.values[0]){case 0:if((n.values.length-1)%4!=0)return void egret.error("lottery global task data error");var i=(n.values.length-1)/4;e.globalLottery=[];for(var a=0;i>a;a++)e.globalLottery.push([n.values[4*a+1],n.values[4*a+2],n.values[4*a+3],n.values[4*a+4]]);break;case 1:if(n.values.length-1!=35)return void egret.error("lottery player task data error");e.CanBuyTickets=n.values[1],e.BettingsDate=n.values[2],e.LastBettingsDate=n.values[19],e.Bettings=[],e.LastBettings=[];for(var a=0;4>a;a++)e.Bettings.push([n.values[4*a+3],n.values[4*a+4],n.values[4*a+5],n.values[4*a+6]]),e.LastBettings.push([n.values[4*a+20],n.values[4*a+21],n.values[4*a+22],n.values[4*a+23]]);break;default:return void egret.error("lottery sync data unkown type")}h(),Game.dispatcher.dispatchEventWith(Game.EVENT.ActivityLotterySyncInfo)}function h(){var t=a();if(null!=t){for(var n=0;n<e.LastBettings.length;n++)if(0==e.LastBettings[n][3]&&o(e.LastBettings[n].slice(0,3))>0)return void badge.onLight(badge.action.LotteryTicket,!0);badge.onLight(badge.action.LotteryTicket,!1)}}function d(){var e=new net.def.UInt32Silce;e.values.push(0),net.socket.write(2085,e.toArrayBuffer())}function p(e,t){var n=new net.def.UInt32Silce;n.values.push(1),n.values.push(e),(i=n.values).push.apply(i,t),net.socket.write(2085,n.toArrayBuffer());var i}function g(e){var t=new net.def.UInt32Silce;t.values.push(2),t.values.push(e),net.socket.write(2085,t.toArrayBuffer())}function m(e){var t=new net.def.UInt32Silce;t.values.push(3),t.values.push(e),net.socket.write(2085,t.toArrayBuffer())}e.CanBuyTickets=0,e.globalLottery=[],e.BettingsDate=0,e.Bettings=[],e.LastBettingsDate=0,e.LastBettings=[];var f=["","icon/shengxiao/1su.png","icon/shengxiao/2niu.png","icon/shengxiao/3hu.png","icon/shengxiao/4mao.png","icon/shengxiao/5long.png","icon/shengxiao/6she.png","icon/shengxiao/7ma.png","icon/shengxiao/8yang.png","icon/shengxiao/9hou.png","icon/shengxiao/10ji.png","icon/shengxiao/11gou.png","icon/shengxiao/12zhu.png"],v=["Không","Tý","Sửu","Dần","Mão","Thìn","Tỵ","Ngọ","Mùi","Thân","Dậu","Tuất","Hợi"],y=["Chưa trúng thưởng","Thưởng May Mắn","Giải Ba","Giải Nhì","Giải Nhất"];e.checkNotZero=t,e.getImage=n,e.getName=i,e.foundZoidacs=a,e.matchZodiac=r,e.getRank=o,e.getRankName=s,e.getExpired=l,e.load=u,e.c2s_reqSync=d,e.c2s_reqLottery=p,e.c2s_reqAward=g,e.c2s_buyTicket=m}(ActivityLotteryTicket||(ActivityLotteryTicket={}));var ActivityLuckyWheel;!function(e){function t(){return null==e.task?(console.log("task = null"),!1):e.task.count<=0?(console.log("count = "+e.task.count),!1):(net.socket.write(200,null),!0)}function n(){net.socket.write(201,null)}function i(){e.activity=new Activity.MissionActivity(Activity.ActivityKind.Activity_LuckWheel),e.activity.eventName=Game.EVENT.ActivityLuckyWheel;var t=RES.getRes("public_config/operation/luckywheel/luckywheel.json");e.activity.profiles=t.profile,e.activity.initSelf=function(){e.cfg=e.activity.settings},UI.RechargeActivityHall.instance.registerFeature("LuckWheel",new o),net.Register(310,a),net.Register(309,r)}function a(e){var t=net.def.S2CLuckyWheelResult.decode(e);Game.dispatcher.hasEventListener(Game.EVENT.ActivityLuckyWheelResult)?Game.dispatcher.dispatchEventWith(Game.EVENT.ActivityLuckyWheelResult,!1,{prizeIdx:t.prizeIdx,multipleIdx:t.multipleIdx},!1):n()}function r(t){var n=net.def.S2CSyncLuckyWheel.decode(t);e.task={count:n.count,gold:n.gold,next:n.next},Game.dispatcher.dispatchEventWith(Game.EVENT.SyncActivityLuckyWheel,!1,e.task,!1)}e.roll=t,e.draw=n,e.load=i;var o=function(){function t(){this._button=null,this._content=null}return Object.defineProperty(t.prototype,"open",{get:function(){return e.activity.inTime()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"button",{get:function(){return null==this._button&&(this._button=new UI.RadioButton,this._button.label="Vòng Quay May Mắn",this._button.action=null,this._button.icon="ui/city1/czzp.png",this._button.groupName="rechargeActivity",this._button.skinName="RadioTemp3Skin"),this._button},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"content",{get:function(){return null==this._content&&(this._content=new UI.LuckyWheelUI),this._content},enumerable:!0,configurable:!0}),t.prototype.onLight=function(e){},t.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.ActivityLuckyWheel,this.onEvent,this)},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.ActivityLuckyWheel,this.onEvent,this)},t.prototype.onEvent=function(e){UI.RechargeActivityHall.instance.onActivityEvent(e.data,this)},t}();e.Feature=o,__reflect(o.prototype,"ActivityLuckyWheel.Feature",["UI.ActivityFeature"])}(ActivityLuckyWheel||(ActivityLuckyWheel={}));var ActivityRecharge;!function(e){function t(){e.activity=new Activity.MissionActivity(Activity.ActivityKind.Activity_Recharge),e.activity.eventName=Game.EVENT.ActivityRechargeOpen;var t=RES.getRes("public_config/operation/recharge/recharge.json");e.activity.profiles=t.profile,e.activity.initSelf=function(){e.awardsConfig=[];for(var t=0;t<e.activity.settings.length;t++){var n=table.parseListAwards(e.activity.settings[t].award);e.awardsConfig.push({amount:e.activity.settings[t].amount,awards:n})}},net.Register(301,n),net.Register(302,i),net.Register(303,a)}function n(t){var n=net.def.S2CSyncTaskRecharge.decode(t);e.totalRecharge=n.getGold(),e.awardsStatus=n.getStatus(),r()}function i(t){var n=net.def.Value.decode(t);e.totalRecharge=n.getValue(),Game.dispatcher.dispatchEventWith(Game.EVENT.ActivityTotalRecharge)}function a(t){var n=net.def.S2CAwards.decode(t);e.awardsStatus=n.getAwards(),r(),Game.dispatcher.dispatchEventWith(Game.EVENT.ActivityRechargeStatus)}function r(){for(var t=!1,n=0;n<e.awardsStatus.length;n++)if(1==e.awardsStatus[n]){t=!0;break}badge.onLight(badge.action.ActiveRechargeAward,t)}e.load=t}(ActivityRecharge||(ActivityRecharge={}));var ActivitySmashEggs;!function(e){function t(){e.activity=new Activity.MissionActivity(Activity.ActivityKind.Activity_SmashEggs),e.activity.eventName=Game.EVENT.ActivitySmashEggs;var t=RES.getRes("public_config/operation/smasheggs/smasheggs.json");e.activity.profiles=t.profile,e.activity.initSelf=function(){e.cfg=e.activity.settings},UI.RechargeActivityHall.instance.registerFeature("SmashEggs",new r),net.Register(2170,i),net.Register(2171,a)}function n(t){if(e.cfg.smashCost>PlayerAttribute.currency[Game.Currency.GoldCoin])return void PopUpMessage.push(lang.String("not enough goldcoin"),color.GREEN);var n=new net.def.C2SSmashEggIdx;n.type=0,n.idx=t,net.socket.write(2201,n.toArrayBuffer())}function i(t){var n=net.def.S2CEggTypeVector.decode(t);e._data=n.toRaw(),Game.dispatcher.dispatchEventWith(Game.EVENT.ActivitySmashEggs)}function a(t){var n=net.def.S2CEggAwardResult.decode(t);e._award=n.toRaw(),Game.dispatcher.dispatchEventWith(Game.EVENT.ActivitySmashEggsAward)}e.load=t,e.DoSmashEgg=n;var r=function(){function t(){this._button=null,this._content=null}return Object.defineProperty(t.prototype,"open",{get:function(){return e.activity.inTime()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"button",{get:function(){return null==this._button&&(this._button=new UI.RadioButton,this._button.label="Đập Trứng",this._button.action=""+badge.action.SmashEggs,this._button.icon="ui/city1/znq.png",this._button.groupName="rechargeActivity",this._button.skinName="RadioTemp3Skin"),this._button},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"content",{get:function(){return null==this._content&&(this._content=new UI.SmashEggs),this._content},enumerable:!0,configurable:!0}),t.prototype.onLight=function(e){badge.onLight(badge.action.SmashEggs,e)
},t.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.ActivitySmashEggs,this.onEvent,this)},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.ActivitySmashEggs,this.onEvent,this)},t.prototype.onEvent=function(e){UI.RechargeActivityHall.instance.onActivityEvent(e.data,this)},t}();e.Feature=r,__reflect(r.prototype,"ActivitySmashEggs.Feature",["UI.ActivityFeature"])}(ActivitySmashEggs||(ActivitySmashEggs={}));var ActivityTreasureBowl;!function(e){function t(){e.activity=new Activity.MissionActivity(Activity.ActivityKind.Activity_TreasureBowl),e.activity.eventName=Game.EVENT.ActivityTreasureBowl;var t=RES.getRes("public_config/operation/treasurebowl/treasurebowl.json");e.activity.profiles=t.profile,e.activity.initSelf=function(){e.cfg=e.activity.settings;for(var t=0;t<e.cfg.chooseItem.length;t++)for(var n=0;n<e.cfg.chooseItem[t].length;n++)e.cfg.chooseItem[t][n].forbidTip=!0},UI.RechargeActivityHall.instance.registerFeature("TreasureBowl",new o),net.Register(2173,a),net.Register(2174,r)}function n(t,n){for(var i=0;8>i&&-1!=this.ChooseItem[i].type;i++)if(this.ChooseItem[i].type==t&&this.ChooseItem[i].idx==n)return void PopUpMessage.push("Danh sách này đã được chọn",color.RED);if(i>=8)return void PopUpMessage.push("Danh sách chọn đã đầy",color.RED);if(e.TypeItemNum[t]>=this.cfg.itemChooseNum[t])return void PopUpMessage.push("Loại đạo cụ này đã đầy",color.RED);e.TypeItemNum[t]++;var a={type:t,idx:n};this.ChooseItem[i]=a,this.ItemListData[i]=e.cfg.chooseItem[t][n],Game.dispatcher.dispatchEventWith(Game.EVENT.ActivityTreasureBowlItem)}function i(t){this.TypeItemNum[e.ChooseItem[t].type]--;for(var n=t;7>n&&-1!=this.ChooseItem[n+1].type;n++)this.ChooseItem[n].type=this.ChooseItem[n+1].type,this.ChooseItem[n].idx=this.ChooseItem[n+1].idx,this.ItemListData[n]=this.ItemListData[n+1];this.ChooseItem[n].type=-1,this.ChooseItem[n].idx=-1,this.ItemListData[n]=null,Game.dispatcher.dispatchEventWith(Game.EVENT.ActivityTreasureBowlItem)}function a(t){var n=net.def.S2CTreasureBowlTask.decode(t);e._data=n.toRaw(),Game.dispatcher.dispatchEventWith(Game.EVENT.ActivityTreasureBowl)}function r(t){var n=net.def.S2CTreasureBowlAwardIdx.decode(t);e._award=n.toRaw(),Game.dispatcher.dispatchEventWith(Game.EVENT.ActivityTreasureBowlAward)}e.load=t,e.addItem=n,e.delItem=i;var o=function(){function t(){this._button=null,this._content=null}return Object.defineProperty(t.prototype,"open",{get:function(){return e.activity.inTime()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"button",{get:function(){return null==this._button&&(this._button=new UI.RadioButton,this._button.label="Tụ Bảo Bồn",this._button.action=""+badge.action.TreasureBowl,this._button.icon="ui/city1/znq.png",this._button.groupName="rechargeActivity",this._button.skinName="RadioTemp3Skin"),this._button},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"content",{get:function(){return null==this._content&&(this._content=new UI.TreasureBowl),this._content},enumerable:!0,configurable:!0}),t.prototype.onLight=function(e){badge.onLight(badge.action.TreasureBowl,e)},t.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.ActivityTreasureBowl,this.onEvent,this)},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.ActivityTreasureBowl,this.onEvent,this)},t.prototype.onEvent=function(e){UI.RechargeActivityHall.instance.onActivityEvent(e.data,this)},t}();e.Feature=o,__reflect(o.prototype,"ActivityTreasureBowl.Feature",["UI.ActivityFeature"])}(ActivityTreasureBowl||(ActivityTreasureBowl={}));var ArenaChallenge;!function(e){function t(t,n,i){e.toplist=[];for(var a=0;a<t.length;a++)e.toplist.push({name:t[a].name,rank:t[a].rank,faction:t[a].faction,fp:t[a].fp,revengable:!1,isMirror:!1});e.rivals=[];for(var a=0;a<n.length;a++)e.rivals.push({name:n[a].name,rank:n[a].rank,faction:n[a].faction,fp:n[a].fp,revengable:!0,isMirror:n[a].isMirror});e.enemies=[];for(var a=0;a<i.length;a++)e.enemies.push({name:i[a].name,rank:i[a].rank,faction:i[a].faction,fp:i[a].fp,revengable:i[a].revengable,uuid:i[a].uuid,isMirror:i[a].isMirror});Game.dispatcher.dispatchEventWith(Game.EVENT.ArenaChallenge)}function n(e){var t=new net.def.C2SArenaChallenge;t.setIndex(e),net.socket.write(34,t.toArrayBuffer())}function i(t){if(null!=e.enemies[t]){var n=new net.def.UUID;n.uuid=e.enemies[t].uuid,net.socket.write(35,n.toArrayBuffer())}}function a(){net.socket.write(33,null)}function r(){return 0==Game.isWildMap()?void PopUpMessage.push(lang.String("operation not permitted"),color.RED):PlayerAttribute.Level<e.signLevel?void PopUpMessage.push(lang.StringWithFormat("open on level {1}",e.signLevel),color.RED):(a(),UIManager.pushPage(UI.ArenaUI.instance),void badge.onLight(badge.action.ArenaChallenge,!1))}function o(e){var t=e.win;e.awardForLevelUp.silverCoin,e.awardForChallenge.exp,e.awardForChallenge.reading,e.awardForChallenge.silverCoin;E=new UI.ArenaResult,1==t?E.currentState="succeed":E.currentState="fail",E.setChallengeAwards(e.awardForChallenge.getExp(),e.awardForChallenge.getSilverCoin(),e.awardForChallenge.getReading(),e.awardForChallenge.getArena()),E.setLevelUpAwards(e.awardForLevelUp.getSilverCoin()),E.setRankinfo(e.lastTopRank,e.curTopRank,e.curRank)}function s(){Scene.listenEnterMap(e.scene,l),Scene.listenLeaveMap(e.scene,u)}function l(){UI.ArenaUI.Close(),UI.HUD.instance.showBattle(),C=new UI.ChallengeNote,C.second=93,UI.battle.addChild(C),C.currentState="arena",C.btnExit.addEventListener(egret.TouchEvent.TOUCH_TAP,c,null)}function u(){null!=C&&(UI.battle.removeChild(C),C.btnExit.removeEventListener(egret.TouchEvent.TOUCH_TAP,c,null),C=null),null!=E&&(UIManager.pushPage(E),E=null)}function c(){net.socket.write(36,null)}function h(){var e=d();return e>0}function d(){var t=PlayerAttribute.vipItem.level-1;if(0>t)return 0;var n=b[t]-e.buyTimes;return 0>n?0:n}function p(){return e.freeChances+e.paidChances}function g(t,n,i){null!=t&&(e.freeChances=t),null!=n&&(e.paidChances=n),PlayerAttribute.Level>=e.signLevel&&(p()<=0?badge.onLight(badge.action.ArenaChallenge,!1):S()),null!=i&&(e.buyTimes=i)}function m(){var e=Game.getServerDate().getTime();e-T>I?(T=e,a()):PopUpMessage.push(lang.String("arena refresh cd"),color.RED)}function f(e){if(null!=e&&e.isMirror){var t=new net.def.Name;t.name=e.name,net.socket.write(146,t.toArrayBuffer())}}function v(t){f(e.rivals[t])}function y(t){f(e.enemies[t])}e.onS2CArenaInfo=t,e.onC2SArenaChallenge=n,e.onC2SArenaRevenge=i,e.onC2SArenaMatch=a,e.onOpenArena=r,e.onS2CArenaResult=o,e.init=s,e.canBuyTimes=h;var b=[0,1,2,3,4,5,5,5,5,5,5,5];e.getBuyTimes=d,e.getJoinTimes=p,e.setChances=g;var S=MakeDelayExecute(function(){p()>0&&badge.onLight(badge.action.ArenaChallenge,!0)},null,3*Game.Minute);e.rank=1e3,e.highestRank=1e3,e.buyTimes=0,e.toplist=[],e.rivals=[],e.enemies=[];var E,C;e.signLevel=14,e.scene="arena";var T=0,I=5e3;e.refreshMatchInfo=m,e.onViewRival=v,e.onViewEnemy=y}(ArenaChallenge||(ArenaChallenge={}));var Auction;!function(e){function t(){for(var t=y.Guild;t<=y.Self;t++)b[t]={},S[t]=new Array,e.auctionRedhot[t]={};var a=table.auctionGuildCates.length;e.guildBonusCache=new Array(a);for(var t=0;a>t;t++)b[y.Guild][t]=new Array;for(var t=0;t<e.enabledItemCategory.length;t++)b[y.Global][e.enabledItemCategory[t].cate]=new Array;for(var t=0;22>t;t++){for(var r=0;r<e.enabledItemCategory.length;r++)if(t==e.enabledItemCategory[r].cate){e.globalSimpleCateMap[t]=!0;break}e.globalAllCates.push(t)}b[y.Self][0]=new Array,e.CurrencyType={Guild:Game.Currency.GoldCoin,Global:Game.Currency.SilverCoin,Bonus:Game.Currency.SilverCoin},e.currencyStr[e.CurrencyType.Guild]=lang.String("goldCoin"),e.currencyStr[e.CurrencyType.Global]=lang.String("silverCoin"),e.currencyStr[e.CurrencyType.Bonus]=lang.String("silverCoin"),a!=e.auctionGuildRedhot.length&&egret.error("auction guild redhot error");for(var t=0;t<Math.min(a,e.auctionGuildRedhot.length);t++)e.auctionRedhot[y.Guild][table.auctionGuildCates[t].category]=e.auctionGuildRedhot[t];e.auctionGlobalRedhot.length!=e.enabledItemCategory.length&&egret.error("auction global redhot error");for(var t=0;t<Math.min(e.enabledItemCategory.length,e.auctionGlobalRedhot.length);t++)e.auctionRedhot[y.Global][e.enabledItemCategory[t].cate]=e.auctionGlobalRedhot[t];n(),e.auctionRedhot[y.Self][0]=e.auctionSelfRedhot[0],net.Register(78,i)}function n(){for(var t=0;t<e.enabledItemCategory.length;t++)e.enabledItemCategory[t].cate>=e.auctionGlobalOther&&(e.globalOhtersRethotTag[e.enabledItemCategory[t].cate]=!0)}function i(t){var n=net.def.S2CAuctionRedhotInfo.decode(t);for(var i in n.values){var a=n.values[i];if(null!=e.auctionRedhot[a.type])if(null!=e.auctionRedhot[a.type][a.categorey])badge.onLight(e.auctionRedhot[a.type][a.categorey],!0);else{if(a.type==y.Global)continue;egret.error("auction redhot type:"+a.type+", categorey:"+a.categorey+" not found")}else egret.error("auction redhot type:"+a.type+" not found")}}function a(e,t){return b[e][t]}function r(t){for(var n=t.items,i=t.category,a=[],r=[],o=[],s=[],l=0;l<n.length;l++){var u=n[l];14==u.genre&&2017==u.detailType?a.push(u):12==u.genre&&(u.detailType>=2009||u.detailType<=2017)?r.push(u):e.globalSimpleCateMap[u.genre]?o.push(u):s.push(u)}var c=y.Global,h=Game.getServerDate().getTime(),d=-1;if(i.length>1)d=e.auctionGlobalOther,b[c][d]=s,S[c][d]=h,null!=C&&C.updateUi(c,d),badge.onLight(e.auctionRedhot[c][d],e.globalOhtersRethotTag[d]&&s.length>0),d=e.auctionGlobalOther+1,b[c][d]=a,S[c][d]=h,null!=C&&C.updateUi(c,d),badge.onLight(e.auctionRedhot[c][d],e.globalOhtersRethotTag[d]&&a.length>0),d=e.auctionGlobalOther+2,b[c][d]=r,S[c][d]=h,null!=C&&C.updateUi(c,d),badge.onLight(e.auctionRedhot[c][d],e.globalOhtersRethotTag[d]&&r.length>0);else{var p=i[0];b[c][p]=o,S[c][p]=h,null!=C&&C.updateUi(c,p),14==p&&(d=e.auctionGlobalOther+1,b[c][d]=a,S[c][d]=h,null!=C&&C.updateUi(c,d),badge.onLight(e.auctionRedhot[c][d],e.globalOhtersRethotTag[d]&&a.length>0)),12==p&&(d=e.auctionGlobalOther+2,b[c][d]=r,S[c][d]=h,null!=C&&C.updateUi(c,d),badge.onLight(e.auctionRedhot[c][d],e.globalOhtersRethotTag[d]&&r.length>0))}}function o(t){if(t.isGuild){var n=y.Guild,i=t.category[0];e.guildBonusCache[i]=t.bonus,b[n][i]=t.items,S[n][i]=Game.getServerDate().getTime(),null!=C&&C.updateUi(n,i)}else r(t)}function s(e){var t=y.Self,n=0;b[t][n]=e.items,S[t][n]=Game.getServerDate().getTime(),null!=C&&C.updateUi(t,n)}function l(e,t,n){var i=Game.getServerDate().getTime();null==S[e][t]&&(S[e][t]=0);var a=i-S[e][t];return n||a>E?(h(e,t),!0):!1}function u(e,t){for(var n=e.length,i=0;n>i;i++){var a=e[i];if(a.itemId.toHex()==t)return a.count=0,!0}return!1}function c(e,t,n,i,a){var r=e.length;if(n)for(var o=0;r>o;o++){var s=e[o];if(s.itemId.toHex()==t){s.curPrice=i,s.hasCompete=a;break}}else u(e,t)}function h(t,n){if(t==y.Self)return void net.socket.write(172,null);var i=new net.def.C2SGetAuctionList;switch(t){case y.Guild:i.setIsGuild(!0),i.category.push(n);break;case y.Global:i.setIsGuild(!1),n>=e.auctionGlobalOther?(a=i.category).push.apply(a,e.globalAllCates):i.category.push(n)}net.socket.write(170,i.toArrayBuffer());var a}function d(e,t,n,i,a){var r=new net.def.C2SAuctionBuy;r.setCount(a),r.setIsCompete(n),r.setIsGuild(t),r.setItemId(e),r.setPrice(i),net.socket.write(171,r.toArrayBuffer())}function p(t){var n,i=t.isCompete?"compete status":"onetime price status";t.success?(n=lang.StringWithFormat(i,lang.String("success")),PopUpMessage.push(n,color.GREEN),t.isCompete&&badge.onLight(e.auctionRedhot[y.Self][0],!0)):(n=2==t.errCode?lang.String("price has changed"):1==t.errCode?lang.String("item has been bought"):lang.StringWithFormat(i,lang.String("fail")),PopUpMessage.push(n,color.RED));var r=!0;t.success||1!=t.errCode||(r=!1);var o=t.itemId.toHex();if(t.nowPrice>0||!r){var s=void 0,l=t.category;if(t.isGuild)s=y.Guild;else{s=y.Global;for(var h in b[s])for(var d=b[s][h],p=0;p<d.length;p++){var g=d[p];if(g.itemId.toHex()==o){l=Number(h);break}}}var m=null;if(r)m=a(s,l);else for(var h in b[s])if(u(b[s][h],o)){l=Number(h);break}null!=m&&(r?c(m,o,t.isCompete,t.nowPrice,t.success):u(m,o)),m=a(y.Self,0),null!=m&&(r?c(m,o,t.isCompete,t.nowPrice,t.success):u(m,o)),null!=C&&C.notifyAfterBuy(s,l)}}function g(e){if(badge.onLight(badge.action.AuctionEnabled,!1),e.hasGlobalItem)return void badge.onLight(badge.action.AuctionEnabled,!0);if(e.canBuyGuildItem)if(e.guildStartTime<=0)badge.onLight(badge.action.AuctionEnabled,!0);else{var t=e.guildStartTime*Game.Second,n=function(){badge.onLight(badge.action.AuctionEnabled,!0)};MakeDelayExecute(n,null,t)()}}function m(e){badge.onLight(badge.action.AuctionEnabled,!0),ChatSys.pushSys(lang.String("global auction start"))}function f(){null==C&&(C=new UI.AuctionUi),C.showing||UIManager.pushPage(C)}function v(){null!=C&&C.showing&&(UIManager.pop(C),C=null)}var y;!function(e){e[e.Guild=0]="Guild",e[e.Global=1]="Global",e[e.Self=2]="Self"}(y=e.ViewType||(e.ViewType={})),e.currencyStr={};var b={},S={},E=5e3;e.auctionGlobalOther=22,e.enabledItemCategory=[{cate:2,name:"Quân Hàm"},{cate:5,name:"Bảo Thạch"},{cate:7,name:"Mảnh Mật Tịch"},{cate:8,name:"Mảnh Môn Khách"},{cate:1,name:"Quà"},{cate:15,name:"Mặt Nạ"},{cate:13,name:"Thần Binh"},{cate:e.auctionGlobalOther+1,name:"Hòa Thị Bích"},{cate:e.auctionGlobalOther+2,name:"Đồ Phổ"},{cate:e.auctionGlobalOther,name:"Khác"}],e.globalAllCates=[],e.globalSimpleCateMap={},e.globalOhtersRethotTag={},e.auctionRedhot={},e.auctionGuildRedhot=[badge.action.AuctionQin,badge.action.AuctionGuildWar,badge.action.AuctionCrossBoss],e.auctionGlobalRedhot=[badge.action.AuctionTitle,badge.action.AuctionGem,badge.action.AuctionBookDebris,badge.action.AuctionPartnerPieces,badge.action.AuctionBox,badge.action.AuctionAvatar,badge.action.AuctionWeaponPieces,badge.action.AuctionBaiShiBi,badge.action.AuctionChengZhuangTuPu,badge.action.AuctionGlobalOther],e.auctionSelfRedhot=[badge.action.AuctionSelf],e.init=t,e.initOthersRedhotTag=n,e.getCacheData=a,e.filterItems=r,e.cacheAuctionList=o,e.cacheSelfAuctionList=s,e.checkUpdate=l,e.requestBuy=d,e.onBuyResult=p,e.updatePlayerAuctionStatus=g,e.onAuctionCompeteStartNotify=m;var C=null;e.showUi=f,e.hideUi=v}(Auction||(Auction={}));var Avatar;!function(e){function t(e){var t=new net.def.Index;t.index=e,net.socket.write(167,t.toArrayBuffer())}function n(e){var t=new net.def.Index;t.index=e,net.socket.write(168,t.toArrayBuffer())}function i(){var t=0;for(var n in e.list)t+=table.avatars[n].attributes[e.list[n].level-1].fp;return t}function a(){for(var t in table.avatars){var n=table.avatars[t].id,i=1;if(null!=e.list[n]&&(i=e.list[t].level),!(i>=WorldLine.GetMaxAvatarsLevel())){var a=table.avatars[n].item,r=table.avatars[n].costs[i-1],o=PlayerAttribute.bag.CalcCount(a.genre,a.detailType);if(o>=r)return n}}return 0}function r(){return a()>0}e.list={},e.LevelUp=t,e.Use=n,e.getFp=i,e.getOneLeveluId=a,e.canShowReddot=r}(Avatar||(Avatar={}));var Babel;!function(e){function t(){e.config=RES.getRes("public_config/babel/babelconfig.json"),e.awards=RES.getRes("config/babel/awards.json")}function n(){Scene.listenEnterMap(e.BabelScene,u),Scene.listenLeaveMap(e.BabelScene,c),Scene.listenEnterMap(e.BabelPrepareScene,h),Scene.listenLeaveMap(e.BabelPrepareScene,d),SecondTicker.addEventListener(S,null)}function i(t){e.dataPKInfo=t;for(var n=e.dataPKInfo.getPlayers(),i=0;i!=n.length;i++)if(n[i].getName()==Player.instance.Name){e.selfCamp=n[i].getCamp();break}e.dataPKInfo.getStage()==e.STAGE_PREPARE?UIManager.pushPage(UI.BabelPreparePlayerInfoPanel.instance):UIManager.pushPage(UI.BabelPlayerInfoPanel.instance)}function a(e){UI.BabelPlayerInfoPanel.instance.ShowFinalAward(e)}function r(t){e.dataSummaryPKInfo=t,Game.dispatcher.dispatchEventWith(Game.EVENT.BabelSyncSummaryInfo),t.getStage()==e.STAGE_PK?Scene.handleIdle[e.BabelScene]=null:Scene.handleIdle[e.BabelScene]=function(){return null}}function o(t){null==UI.BabelSignPanel.instance.parent&&(e.notifyBadgeToday=!0,badge.onLight(badge.action.Babel,!1),UIManager.pushPage(UI.BabelSignPanel.instance)),e.dataTeamInfo=t,Game.dispatcher.dispatchEventWith(Game.EVENT.BabelSyncTeamInfo)}function s(t){e.dataFriendList=t,e.invitedPlayers=[],UIManager.pushPage(UI.BabelInvitePanel.instance),UI.BabelInvitePanel.instance.SetFriendData(t)}function l(e){this.dataPrepareSceneInfo=e,UI.BabelPrepareNote.instance.updateData()}function u(){E||(E=!0,UIManager.pop(UI.BabelPKNote.instance),UI.battle.addChild(UI.BabelPKNote.instance),Scene.handleIdle[e.BabelScene]=function(){return null},UI.setDisableAllPlayerTitles(!0),SuperWeapon.disableAllPlayersEffect(!0))}function c(){E&&(E=!1,UI.battle.removeChild(UI.BabelPKNote.instance),Scene.handleIdle[e.BabelScene]=null,UI.setDisableAllPlayerTitles(!1),SuperWeapon.disableAllPlayersEffect(!1))}function h(){C||(C=!0,UIManager.pop(UI.BabelPrepareNote.instance),UI.battle.addChild(UI.BabelPrepareNote.instance),Scene.handleIdle[e.BabelPrepareScene]=function(){return null})}function d(){C&&(C=!1,UIManager.pop(UI.BabelPrepareNote.instance))}function p(){UI.BabelPlayerInfoPanel.instance.autoClose=!1,net.socket.write(2058,null)}function g(){net.socket.write(2052,null)}function m(){net.socket.write(2053,null)}function f(t){for(var n=0;n!=e.invitedPlayers.length;n++)if(t==e.invitedPlayers[n])return;e.invitedPlayers.push(t);var i=new net.def.Name;i.setName(t),net.socket.write(2054,i.toArrayBuffer())}function v(e){var t=table.maps[World.mapId].scene;if(null!=t)return void ChatSys.sendPrivateMsg(e,lang.String("babel i am busy invite me later"));var n=function(){return y(e,!1),!0},i=function(){return!1},a=lang.String("babel room invitation"),r=lang.StringWithFormat("babel {1} invite you join team",e);UI.ConfirmBox.Show(UI.ConfirmBoxStyle.team,a,r,function(){return y(e,!0),!0},n,i)}function y(e,t){var n=new net.def.C2SBabelInviteResponse;n.inviter=e,n.accept=t,net.socket.write(2055,n.toArrayBuffer())}function b(){return Game.eraDay+1<e.config.openDays?void PopUpMessage.push(lang.StringWithFormat("babel cannot sign game open after {1} days",e.config.openDays),color.RED):PlayerAttribute.Level<e.config.levelLimit?void PopUpMessage.push(lang.StringWithFormat("babel level below {1} cannot sign",e.config.levelLimit),color.RED):void net.socket.write(2056,null)}function S(){if(!e.notifyBadgeToday){for(var t=Game.getServerDate(),n=1e4*t.getHours()+100*t.getMinutes()+t.getSeconds(),i=e.STAGE_END,a=0;a!=e.config.stageTime.length;a++)if(n>=e.config.stageTime[a][0]&&n<=e.config.stageTime[a][1]){i=e.config.stageTime[a][2];break}i==e.STAGE_PREPARE&&PlayerAttribute.Level>=e.config.levelLimit&&badge.onLight(badge.action.Babel,!0)}}e.config=null,e.awards=null,e.dataPKInfo=null,e.dataSummaryPKInfo=null,e.dataTeamInfo=null,e.dataFriendList=null,e.dataPrepareSceneInfo=null,e.invitedPlayers=[],e.INVALIDCAMP=9999,e.STAGE_PREPARE=1,e.STAGE_PK=2,e.STAGE_END=3,e.selfCamp=9999,e.BabelScene="babel",e.BabelPrepareScene="babelprepare";var E=!1,C=!1;e.notifyBadgeToday=!1,e.LoadRes=t,e.Load=n,e.onSyncPKInfo=i,e.onSyncFinalAwards=a,e.onSyncSummaryPKInfo=r,e.onSyncTeamInfo=o,e.onSyncFriendList=s,e.onSyncPrepareSceneInfo=l,e.EnterPKScene=u,e.LeavePKScene=c,e.EnterPrepareScene=h,e.LeavePrepareScene=d,e.applyPKInfo=p,e.OpenAndJoin=g,e.ShowInviteList=m,e.InviteFriend=f,e.OnGetInvite=v,e.AcceptInvitation=y,e.Sign=b}(Babel||(Babel={}));var Bet;!function(e){function t(){return e.history.length>0?e.history[e.history.length-1]:null}function n(){if(1==T()&&B.myBetTotal>0){D={betTotal:B.myBetTotal,bets:[]};for(var e=0;e<B.bets.length;e++)B.bets[e].myBet>0&&D.bets.push({id:B.bets[e].id,bet:B.bets[e].myBet})}}function i(){if(a()){for(var e=0;e<D.bets.length;e++)if(!S(D.bets[e].id,D.bets[e].bet))return Game.dispatcher.dispatchEventWith(Game.EVENT.BetClientDataChange),e>0;return PopUpMessage.push("Đặt cược nhanh thành công",color.RED),Game.dispatcher.dispatchEventWith(Game.EVENT.BetClientDataChange),!0}return!1}function a(){return 0==e.myBetTotal&&d(0,!1)&&D.betTotal>0?!0:!1}function r(){return e.CanBet(0,!1)&&e.myBetTotal>0&&e.applyBet()&&PopUpMessage.push("Đã tự động chốt",color.RED),!1}function o(){e.betAreas=[],e.betAreaLittleBig=[],e.betAreaBaozi=[],e.betAreaSpot=[]}function s(){var t=e.activity.settings;W={levelLimit:t.levelLimit,vipLimit:t.vipLimit,betLimit:t.betLimit},o();for(var n=t.bets,i=0;i<n.length;i++){var a={id:n[i].id,icon:n[i].icon,payRate:n[i].payRate,betPlayerNum:0,betTotal:0,myBet:0,win:!1};e.betAreas.push(a),n[i].excludeBaozi?e.betAreaLittleBig.push(a):n[i].onlyBaozi?e.betAreaBaozi.push(a):e.betAreaSpot.push(a)}if(e.betShopCfg=[],t.silver2BetLimit>0){var r=new Shop.CoinGoods;r.currency=Game.Currency.SilverCoin,r.count=1,r.param=Game.Currency.BetCoin,r.discount=100,r.quality=3,r.price=V,r.buy=function(e,t){return v(t),!0},e.betShopCfg.push(r)}var s=new Shop.CoinGoods;if(s.currency=Game.Currency.GoldCoin,s.count=1,s.param=Game.Currency.BetCoin,s.discount=100,s.quality=3,s.price=V,s.buy=function(e,t){return y(t),!0},e.betShopCfg.push(s),t.bet2silverLimit>0){var l=new Shop.CoinGoods;l.currency=Game.Currency.BetCoin,l.count=V,l.param=Game.Currency.SilverCoin,l.discount=100,l.quality=3,l.price=1,l.buy=function(e,t){return b(t),!0},e.betShopCfg.push(l)}for(var c=t.shop,i=0;i<c.length;i++){var h=new Shop.PropGoods,d=c[i];h.price=d.price,h.currency=Game.Currency.BetScore,h.pos=i,h.discount=100,h.genre=d.content.genre,h.detailType=d.content.detailType,h.count=d.content.count,h.param={discountIcon:d.discountIcon,leftStock:null,stockNum:d.stockNum||0,resetId:d.resetId||0,price:d.price},h.buy=u,e.betShopCfg.push(h)}e.initNum=e.initNum+1}function l(){e.activity=new Activity.MissionActivity(Activity.ActivityKind.Activity_Bet),e.activity.eventName=Game.EVENT.ActivityBetOpen;var t=RES.getRes("public_config/operation/bet/bet.json");e.activity.profiles=t.profiles,e.activity.openCallback=function(e){h(e)},e.activity.initSelf=s}function u(e,t){var n=t;return n.resetId>0&&U(n.resetId-1)>=n.stockNum?(PopUpMessage.push("Đã hết",color.RED),!1):m()<n.price?(PopUpMessage.push(StringWithFormat("Vé Thưởng không đủ {1}, Xèng thắng khi cược sẽ tặng một phần vé thưởng",n.price),color.RED),!0):C(e,1)}function c(){return Activity.activites&&Activity.activites[Activity.ActivityKind.Activity_Bet]?!0:!1}function h(t){null!=t&&(t?UI.battle&&UI.battle.topGroup&&(e.MainIcon||(e.MainIcon=new UI.IconButton,e.MainIcon.img="ui/zuUi/icon_caishen.png",e.MainIcon.action=""+badge.action.Bet,e.MainIcon.onTap=function(t){_(),e.MainIcon.stopMovie()}),e.MainIcon.parent!=UI.battle.leftGroup&&(UI.battle.addToLeftGroup(e.MainIcon,0),e.MainIcon.playMovie(-1))):(e.MainIcon&&Game.removeFromParent.apply(e.MainIcon),badge.onLight(badge.action.Bet,!1)))}function d(t,n){var i=e.myBetTotal+t;return null==B?(n&&PopUpMessage.push("Đợi dữ liệu...",color.RED),!1):1!=T()?(n&&PopUpMessage.push("Hiện không phải thời gian đặt cược",color.RED),!1):G()<=0?(n&&PopUpMessage.push("Thời gian cược đã kết thúc",color.RED),!1):PlayerAttribute.Level<W.levelLimit?(n&&PopUpMessage.push(StringWithFormat("Cấp chưa đạt Lv{1}",W.levelLimit),color.RED),!1):PlayerAttribute.vipItem.level<W.vipLimit?(n&&PopUpMessage.push(StringWithFormat("Cấp VIP chưa đạt {1}",W.vipLimit),color.RED),!1):M()?N?(n&&PopUpMessage.push("Lượt này đã cược",color.RED),!1):PlayerAttribute.currency[Game.Currency.BetCoin]<=0?(n&&PopUpMessage.push("Xèng không đủ",color.RED),!1):0>i?(n&&PopUpMessage.push(StringWithFormat("Đại hiệp vẫn chưa cược",W.betLimit),color.RED),!1):i>W.betLimit?(n&&PopUpMessage.push(StringWithFormat("Tối đa chỉ được đặt cược {1}Xèng",W.betLimit),color.RED),!1):!0:(n&&PopUpMessage.push(StringWithFormat("Số lần đặt cược hôm nay đã đủ {1} lần",x()),color.RED),!1)}function p(){return PlayerAttribute.currency[Game.Currency.BetCoin]-e.myBetTotal}function g(){return PlayerAttribute.currency[Game.Currency.BetCoin]}function m(){return PlayerAttribute.currency[Game.Currency.BetScore]}function f(){return net.socket.write(2075,null),!0}function v(e){if(!(0>e)){var t=V*e;if(!(PlayerAttribute.currency[Game.Currency.SilverCoin]<t)){var n=new net.def.C2SBetExchangeCoin;n.currency=Game.Currency.SilverCoin,n.exchange=e,net.socket.write(2076,n.toArrayBuffer())}}}function y(e){if(!(0>e)){var t=V*e;if(!(PlayerAttribute.currency[Game.Currency.GoldCoin]<t)){var n=new net.def.C2SBetExchangeCoin;n.currency=Game.Currency.GoldCoin,n.exchange=e,net.socket.write(2076,n.toArrayBuffer())}}}function b(e){if(!(0>e||PlayerAttribute.currency[Game.Currency.BetCoin]<e)){var t=new net.def.C2SBetExchangeCoin;t.exchange=e,net.socket.write(2077,t.toArrayBuffer())}}function S(t,n){return d(n,!0)&&t>0&&t<=e.betAreas.length?1==t&&e.betAreas[1].myBet>0||2==t&&e.betAreas[0].myBet>0?(PopUpMessage.push("Không thể đồng thời đặt cược Đại và Tiểu",color.RED),!1):0>n?e.betAreas[t-1].myBet+n<0?!1:(e.betAreas[t-1].myBet+=n,e.myBetTotal+=n,!0):p()<n?!1:e.myBetTotal+n>W.betLimit?!1:e.myBetTotal+n>g()?!1:(e.betAreas[t-1].myBet+=n,e.myBetTotal+=n,!0):!1}function E(){if(!d(0,!0))return!1;if(e.myBetTotal>0){var t=new net.def.C2SBetApplyBet;t.bets=[];for(var n=0;n<e.betAreas.length;n++)if(e.betAreas[n].myBet>0){var i=new net.def.BetDetail;i.id=n+1,i.bet=e.betAreas[n].myBet,t.bets.push(i)}return net.socket.write(2078,t.toArrayBuffer()),N=!0,!0}return PopUpMessage.push("Hiệp sĩ vẫn chưa cược",color.RED),!1}function C(e,t){var n=new net.def.C2SBetShopBuy;return n.setPos(e),n.setId(e+1),n.setCount(t),net.socket.write(2079,n.toArrayBuffer()),!1}function T(){return null!=B?B.status:0}function I(){var e=T();switch(e){case 0:return"<font color="+color.RED+">Đang nghỉ ngơi</font>";case 1:return"<font color="+color.GREEN+">Đang cược</font>";case 2:return"<font color="+color.YELLOW+">Kết quả</font>";case 3:return"<font color="+color.RED+">Đã kết thúc</font>"}return"-"}function G(){var e=Game.countOpenSeconds();if(null!=B&&e>=O){var t=B.lefttime-(e-O);return 0>t&&(t=0),t}return-1}function A(){var e=Game.countOpenSeconds();if(null!=B&&e>=O){var t=B.actLefttime-(e-O);return 0>t&&(t=0),t}return-1}function k(){return P(A())}function P(e){if(0>=e)return"-";if(60>e)return"Dưới 1 phút";if(3600>e){var t=~~(e/60);return lang.StringWithFormat("{1}minut",t)}if(86400>e){var n=~~(e/3600);return lang.StringWithFormat("{1}hours",n)}var i=~~(e/86400),a=~~(e%86400/3600);return lang.StringWithFormat("{1}day{2}hours",i,a)}function w(t){var i=1==t.status&&0==t.myBetTotal&&e.myBetTotal>0;i||(e.myBetTotal=0),B=t;for(var a=0;a<e.betAreas.length;a++)e.betAreas[a].betPlayerNum=0,e.betAreas[a].betTotal=0,i||(e.betAreas[a].myBet=0),e.betAreas[a].win=!1;for(var a=0;a<B.bets.length;a++){var r=B.bets[a].id;r>0&&r<=e.betAreas.length&&(e.betAreas[r-1].betPlayerNum=B.bets[a].playerCount,e.betAreas[r-1].betTotal=B.bets[a].betTotal,i||(e.betAreas[r-1].myBet=B.bets[a].myBet))}N=B.myBetTotal>0;for(var a=0;a<B.wins.length;a++){var r=B.wins[a];r>0&&r<=e.betAreas.length&&(e.betAreas[r-1].win=!0)}e.history=[];for(var a=0;a<B.histroy.length;a++){var o=B.histroy[a];e.history.push({id:a+1,result:o,spot1:~~(o/100)%10,spot2:~~(o/10)%10,spot3:o%10})}e.betTimeCount=t.betTimeCount,n(),O=Game.countOpenSeconds(),badge.onLight(badge.action.Bet,d(0,!1)),Game.dispatcher.dispatchEventWith(Game.EVENT.BetDataChange)}function L(e){F=e.counter,R(),Game.dispatcher.dispatchEventWith(Game.EVENT.BetShopDataChange)}function R(){for(var t=0;t<e.betShopCfg.length;t++){var n=e.betShopCfg[t].param;if(n.resetId>0){var i=n.stockNum-U(n.resetId-1);0>i&&(i=0),n.leftStock=i}}}function U(e){return e>=0&&e<F.length?F[e]:-1}function _(){return e.initNum<=0?void PopUpMessage.push(StringWithFormat("Đang tải dữ liệu, hãy thử lại sau"),color.RED):PlayerAttribute.Level<W.levelLimit?void PopUpMessage.push(StringWithFormat("Hoạt động này Lv{1} mở",W.levelLimit),color.RED):PlayerAttribute.vipItem.level<W.vipLimit?(PopUpMessage.push(StringWithFormat("Cấp VIP chưa đạt {1}",W.vipLimit),color.RED),!1):void(e.mainUIVisiable||c()&&UI.ActivityBetMainUI.open())}function x(){var e=PlayerAttribute.Level;return e>=30&&40>e?20:e>=40&&50>e?30:e>=50&&60>e?40:e>=60?-1:0}function M(){if(PlayerAttribute.vipItem.level>=3)return!0;var t=x();return-1==t?!0:t<=e.betTimeCount?!1:!0}var D={betTotal:0,bets:[]};e.initNum=0;var N=!1;e.myBetTotal=0,e.betAreas=[],e.betAreaLittleBig=[],e.betAreaBaozi=[],e.betAreaSpot=[],e.history=[];var F=[],O=0,B=null,W={levelLimit:30,vipLimit:3,betLimit:100};e.betShopCfg=[],e.mainUIVisiable=!1;var V=10;e.betTimeCount=0,e.getLastResult=t,e.recordMybets=n,e.restoreMyLastBets=i,e.CanAutoRestoreBet=a,e.autoApplyBet=r,e.init=s,e.load=l,e.Buy=u,e.isActivity=c,e.CanBet=d,e.getViewBetCoin=p,e.getBetCoin=g,e.getBetScore=m,e.applyBetData=f,e.applyExchangeBetCoin1=v,e.applyExchangeBetCoin2=y,e.applySellBetCoin=b,e.addClientBet=S,e.applyBet=E,e.getStatus=T,e.getStatusStr=I,e.getLeftTime=G,e.getActLeftTime=A,e.getActLeftTimeStr=k,e.onSyncBetData=w,e.onSyncBetShopData=L,e.OpenMainUI=_,e.BetTimesCheck=M}(Bet||(Bet={}));var table;!function(e){function t(){var e,t="public_config/bravepalace.json";e=RES.getRes(t),null==e&&egret.error("cannot load config:",t),BravePalace.cfg={activate:e.activate,needlevel:e.needlevel,startTime:e.startTime,awardView:e.awardView,canOpen:e.canOpen}}e.LoadBravePalaceCfg=t}(table||(table={}));var BravePalace;!function(e){function t(e){null!=I&&(I.remainingTime.delta=e.remainingTime),UI.BravePalaceSceneResult.instance.currentState="failed",1==e.win&&(UI.BravePalaceSceneResult.instance.currentState="succeed"),UIManager.pushPage(UI.BravePalaceSceneResult.instance)}function n(e){null!=I&&(I.score1=e)}function i(t,n,i,a){-1!=t&&(I.textDifficultLevel=e.szSceneLevelName[t]),-1!=n&&(I.remainingTime.delta=n),-1!=i&&(I.playerNumber=i),-1!=a&&(G=a)}function a(){Scene.handleIdle[T]=u,Scene.listenEnterMap(T,r),Scene.listenLeaveMap(T,l)}function r(){null==I&&(I=new UI.ChallengeNote),e.chapter1Stones=[new RemainingTime(0),new RemainingTime(0),new RemainingTime(0)],I.currentState=T,UI.battle.addChild(I),I.btnExit.addEventListener(egret.TouchEvent.TOUCH_TAP,s,null),UI.BravePalaceBoard.instance.visible=!1,UI.BravePalaceBoard.instance.currentState="state2",UIManager.push(UI.BravePalaceBoard.instance)}function o(t){UI.BravePalaceBoard.instance.currentState="state1";for(var n=0;n<t.length;n++)e.chapter1Stones[n].deltaMillisecond=t[n];UI.BravePalaceBoard.instance.Update()}function s(){var e=lang.String("operation confirm"),t=lang.StringWithFormat("bravepalace confirm to leave?");UI.ConfirmBox.Show(UI.ConfirmBoxStyle["default"],e,t,GuildDungeon.tryLeaveScene,null,null)}function l(){null!=I&&(UI.battle.removeChild(I),I.btnExit.removeEventListener(egret.TouchEvent.TOUCH_TAP,s,null),I=null),Game.dispatcher.dispatchEventWith(Game.EVENT.LeaveScene),UIManager.pop(UI.BravePalaceBoard.instance)}function u(e){return null}function c(){return p()?void UIManager.pushPage(UI.BravePalaceUI.instance):void PopUpMessage.push("Lv50 mở phó bản này",color.RED)}function h(){if(!e.cfg.activate)return!1;for(var t=!1,n=0;n<e.cfg.startTime.dayByWeek.length;n++)if(Game.getServerDate().getDay()==e.cfg.startTime.dayByWeek[n]){t=!0;break}return t}function d(){var t=Game.getServerDate(),n=3600*e.cfg.startTime.hour+60*e.cfg.startTime.minute,i=3600*t.getHours()+60*t.getMinutes()+t.getSeconds();return i>=n&&i-n<=e.cfg.canOpen?!0:!1}function p(){return PlayerAttribute.Level>=e.cfg.needlevel}function g(){UI.BravePalaceUI.instance.Loaded&&UI.BravePalaceUI.instance.Update(),UI.BravePalaceLvSelect.instance.Loaded&&UI.BravePalaceLvSelect.instance.Update()}function m(t){e.nSelectedLevel=t.selectedLevel,e.nMaxLevel=t.maxLevel,e.runningLevel=t.runningLevel,e.sceneState=t.sceneState,e.closeymd=t.closeYmd,g(),f()}function f(){if(p()){var t=Game.getServerDate(),n=3600*e.cfg.startTime.hour+60*e.cfg.startTime.minute,i=3600*t.getHours()+60*t.getMinutes()+t.getSeconds(),a=1e4*t.getFullYear()+100*(t.getMonth()+1)+t.getDate();return e.closeymd>=a?void badge.onLight(badge.action.BravePalaceActivated,!1):e.sceneState==C.Running?(badge.onLight(badge.action.BravePalaceActivated,!0),void v()):void(n>i?MakeDelayExecute(v,null,(n-i)*Game.Second)():i<n+e.cfg.canOpen?(badge.onLight(badge.action.BravePalaceActivated,!0),v()):badge.onLight(badge.action.BravePalaceActivated,!1))
}}function v(){if(Game.isWildMap()){var e=60;Reminder.PushReminder(Reminder.EventName.BravePalace,e*Game.Minute,"Phó bản Bang")}}function y(){return p()?e.sceneState==C.Running?void net.socket.write(2090,null):h()?d()?void net.socket.write(2090,null):void PopUpMessage.push("Không tại thời gian mở phó bản",color.RED):void PopUpMessage.push("Hôm nay chưa mở phó bản",color.RED):void PopUpMessage.push("Lv50 mở phó bản này",color.RED)}function b(e){if(!Guild.isGuildManager())return void PopUpMessage.push("CHỉ Bang Chủ hoặc Bang Phó có thể điều chỉnh độ khó!",color.RED);var t=new net.def.C2SBravePalaceChangeLevel;t.level=e,net.socket.write(2091,t.toArrayBuffer())}function S(e){switch(e.msgId){case E.BP_MSG_CREATEHEALINGFISH:UI.BravePalaceBoard.instance.SetWarrning("<font color=#2bca4b size = 14>Một nhóm địch đến từ tứ phía</font>","<font color=#ff662d>Hãy mau đi diệt, đừng để họ tập trung!</font>",5);break;case E.BP_MSG_CREATEGROUNDFIRE:UI.BravePalaceBoard.instance.SetWarrning("<font color=#2bca4b size = 14>Một loạt U Minh Chú Hỏa sắp bộc phát</font>","<font color=#ff662d>Hãy mau đi dập lửa, đừng để ngọn lửa lan rộng!</font>",5);break;case E.BP_MSG_CHAPTER1_TIPS:PopUpMessage.push("Thời gian mở của 3 Long Trụ không vượt quá 3 giây mới mở thành công",color.NewBLUE);break;case E.BP_MSG_FIRE_LEFT3:PopUpMessage.push(lang.StringWithFormat("bravepalace fire left {1}",3),color.NewBLUE);break;case E.BP_MSG_FIRE_LEFT2:PopUpMessage.push(lang.StringWithFormat("bravepalace fire left {1}",2),color.NewBLUE);break;case E.BP_MSG_FIRE_LEFT1:PopUpMessage.push(lang.StringWithFormat("bravepalace fire left {1}",1),color.NewBLUE)}}var E;!function(e){e[e.BP_MSG_CREATEHEALINGFISH=0]="BP_MSG_CREATEHEALINGFISH",e[e.BP_MSG_CREATEGROUNDFIRE=1]="BP_MSG_CREATEGROUNDFIRE",e[e.BP_MSG_CHAPTER1_TIPS=2]="BP_MSG_CHAPTER1_TIPS",e[e.BP_MSG_FIRE_LEFT3=3]="BP_MSG_FIRE_LEFT3",e[e.BP_MSG_FIRE_LEFT2=4]="BP_MSG_FIRE_LEFT2",e[e.BP_MSG_FIRE_LEFT1=5]="BP_MSG_FIRE_LEFT1",e[e.BP_MSG_FLAG1_OPEN=6]="BP_MSG_FLAG1_OPEN",e[e.BP_MSG_FLAG2_OPEN=7]="BP_MSG_FLAG2_OPEN",e[e.BP_MSG_FLAG3_OPEN=8]="BP_MSG_FLAG3_OPEN"}(E=e.SimpleMsgType||(e.SimpleMsgType={}));var C;!function(e){e[e.Closed=0]="Closed",e[e.Running=1]="Running"}(C=e.SceneState||(e.SceneState={})),e.nSelectedLevel=0,e.nMaxLevel=0,e.runningLevel=0,e.sceneState=0,e.closeymd=20190101;var T="bravepalace";e.szLevelName=["Xuân","Hạ","Thu","Đông","Quang Minh Đỉnh"],e.szSceneLevelName=["Xuân Điện","Hạ Điện","Thu Điện","Đông Điện","Quang Minh Đỉnh"],e.szStatusName=["Chưa bắt đầu","Đang tiến hành"];var I,G=0;e.OnSyncGuildDungeonResult=t,e.OnChangeScore=n,e.OnChangeSceneInfo=i,e.load=a,e.OnStoneChange=o,e.OpenUI=c,e.IsOpenDay=h,e.IsOpenTime=d,e.PlayerLevelCheck=p,e.OnBaseInfoSync=m,e.DoReminder=f,e.ShowRemindIcon=v,e.EnterScene=y,e.SelectSceneLevel=b,e.OnSimpleMsg=S}(BravePalace||(BravePalace={}));var CatchThief;!function(e){function t(t){e.note.second=t}function n(){null==e.note&&(e.note=new UI.CatchThiefNote),UI.battle.addChild(e.note),e.note.HideTimeGroup(),e.note.btnExit.addEventListener(egret.TouchEvent.TOUCH_TAP,a,this)}function i(t,n){null==e.note&&(e.note=new UI.CatchThiefNote),e.note.ShowTimeGroup(),e.note.second=t,e.note.prepareSecond=n}function a(){var t=lang.String("operation confirm"),n=lang.StringWithFormat("catchthief confirm leave");UI.ConfirmBox.Show(UI.ConfirmBoxStyle["default"],t,n,e.quit,null,null)}function r(){return net.socket.write(141,null),!0}function o(){null!=e.note&&(e.note.btnExit.removeEventListener(egret.TouchEvent.TOUCH_TAP,r,this),UI.battle.removeChild(e.note),e.note.releaseResource(),e.note=null),null!=e.finalPanel&&(UIManager.pop(e.finalPanel),e.finalPanel=null)}function s(){Scene.listenEnterMap(e.scene,n),Scene.listenLeaveMap(e.scene,o)}function l(t,n){var i="succeed";0>=t&&(i="fail"),e.finalPanel=UI.CatchThiefResult.instance,e.finalPanel.currentState=i,e.finalPanel.onSyncResult(t,n),UIManager.pushPage(e.finalPanel)}function u(t){null==e.note&&(e.note=new UI.CatchThiefNote),e.note.HP=t}function c(){null==e.note&&(e.note=new UI.CatchThiefNote),e.note.btnskill.visible=!0}function h(){null==e.note&&(e.note=new UI.CatchThiefNote),e.note.btnskill.visible=!1}function d(e,t,n){49==e&&Player.instance.actor.addEffect("npc_aura_m",n,ActorLayer.back,0,0)}function p(){var e=PlayerAttribute.vipItem.level;return 5>e?lang.StringWithFormat("elevate vip{1} add {2} times",5,1):9>e?lang.StringWithFormat("elevate vip{1} add {2} times",9,1):11>e?lang.StringWithFormat("elevate vip{1} add {2} times",11,1):""}e.scene="catchthief",e.levelLimit=21,e.updateRestTime=t,e.StartGame=i,e.quit=r,e.load=s,e.onSyncResult=l,e.onSyncHP=u,e.showSkillBtn=c,e.hideSkillBtn=h,e.OnEventBuffTrigger=d,e.getVipHint=p}(CatchThief||(CatchThief={}));var CityHome;!function(e){function t(){Scene.listenEnterMap(e.scene,i),Scene.listenLeaveMap(e.scene,a)}function n(){e.statuaryConfig=RES.getRes("config/city_statuary.json")}function i(){Scene.handleIdle[e.scene]=null,e.addCityEntrance()}function a(){e.hud&&(Game.removeFromParent.apply(e.hud),e.hud=null)}function r(){net.socket.write(108,null)}function o(){net.socket.write(141,null)}function s(){e.hud||(e.hud=new UI.CityHomeHUD),e.hud.parent!=UI.battle.wildGroup&&UI.battle.wildGroup.addChild(e.hud)}function l(t){if(e.statuaryInfo=t,Game.dispatcher.dispatchEventWith(Game.EVENT.CityStatuaryInfoChange),!e.statuaryInfo.getAuto()){if(!WorldLine.IsOpen("CityWorship"))return void PopUpMessage.push(lang.String("not open yet!"),color.RED);UIManager.pushPage(new UI.CityStatuaryInfo)}}function u(){net.socket.write(109,null)}function c(){return null==e.statuaryInfo||""==e.statuaryInfo.getLeaderName()?void PopUpMessage.push(lang.String("city worship no leader"),color.RED):PlayerAttribute.Level<e.statuaryConfig.worshipLevel?void PopUpMessage.push(lang.StringWithFormat("city worship need level {1}",e.statuaryConfig.worshipLevel),color.RED):void r()}e.scene="city",e.statuaryInfo=null,e.statuaryConfig=null,e.load=t,e.loadConfig=n,e.c2s_home=r,e.c2s_leave=o,e.addCityEntrance=s,e.onSyncStatuaryInfo=l,e.Worship=u,e.GotoWorship=c}(CityHome||(CityHome={}));var collectCardManager;!function(e){function t(){for(var t=RES.getRes("public_config/collectcard/collectard_kind.json"),n=0,i=t;n<i.length;n++){var a=i[n];e.kindConfig[a.kind]=a}var r=[];r=RES.getRes("public_config/collectcard/cards.json");for(var o=0;o!=r.length;o++){var s=r[o];e.cardsConfigs[s.id]=r[o]}var l=[];l=RES.getRes("public_config/collectcard/suits.json");for(var o=0;o!=l.length;o++){var u=l[o];e.suitConfigs[u.id]=l[o]}e.attributeParis=RES.getRes("public_config/collectcard/attributes.json");var c=[];c=RES.getRes("public_config/collectcard/splitexp.json");for(var o=0;o!=c.length;o++){var h=c[o].quality,d=c[o].exp;e.splitExp[h]=d}var p=[];p=RES.getRes("config/collectcard/attribdesc.json");for(var o=0;o!=p.length;o++){var g=p[o].attrib,m=p[o].desc,f=p[o].formatDesc;e.attribDescCfg[g]=m,e.attribFormatDescCfg[g]=f}var v=[];v=RES.getRes("public_config/collectcard/cardfp.json");for(var o=0;o!=v.length;o++){var h=v[o].quality;e.cardFpConfigs[h]=v[o]}for(var o in e.cardsConfigs){var y=Number(o),b=table.props[19][y];e.cardIconSource[y]=b.source}}function n(){e.qualityBG[1]="ui/CollectCard/1.png",e.qualityBG[2]="ui/CollectCard/2.png",e.qualityBG[3]="ui/CollectCard/3.png",e.qualityBG[4]="ui/CollectCard/4.png",e.qualityBG[5]="ui/CollectCard/5.png",e.kindNames[1]="collect card kind name 1",e.kindNames[2]="collect card kind name 2",e.kindNames[3]="collect card kind name 3",e.levelImg[1]="ui/CollectCard/level1.png",e.levelImg[2]="ui/CollectCard/level2.png",e.levelImg[3]="ui/CollectCard/level3.png",e.levelImg[4]="ui/CollectCard/level4.png",e.levelImg[5]="ui/CollectCard/level5.png",e.levelImg[6]="ui/CollectCard/level6.png",e.levelImg[7]="ui/CollectCard/level7.png",e.levelImg[8]="ui/CollectCard/level8.png",e.levelImg[9]="ui/CollectCard/level9.png",e.levelImg[10]="ui/CollectCard/level10.png",X[1]="collect card quality name 1",X[2]="collect card quality name 2",X[3]="collect card quality name 3",X[4]="collect card quality name 4",X[5]="collect card quality name 5",e.cardCellIconQualityBg[1]="ui/CollectCard/pz1.png",e.cardCellIconQualityBg[2]="ui/CollectCard/pz2.png",e.cardCellIconQualityBg[3]="ui/CollectCard/pz3.png",e.cardCellIconQualityBg[4]="ui/CollectCard/pz4.png",e.cardCellIconQualityBg[5]="ui/CollectCard/pz5.png",J[1]=badge.action.CollectCardActiveKind1,J[2]=badge.action.CollectCardActiveKind2,J[3]=badge.action.CollectCardActiveKind3,z[1]=badge.action.CollectCardUpgradeStarKind1,z[2]=badge.action.CollectCardUpgradeStarKind2,z[3]=badge.action.CollectCardUpgradeStarKind3,Z[1]=badge.action.CollectCardUpgradeLevelKind1,Z[2]=badge.action.CollectCardUpgradeLevelKind2,Z[3]=badge.action.CollectCardUpgradeLevelKind3,Game.dispatcher.addEventListener(Game.EVENT.AddItem,H,null),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,H,null),Game.dispatcher.addEventListener(Game.EVENT.RemoveItem,H,null)}function i(t){return e.cardsConfigs[t]}function a(t){return e.suitConfigs[t]}function r(t,n){for(var i in e.suitConfigs){var a=e.suitConfigs[Number(i)];if(a.kind==t&&a.level==n)return a}return null}function o(e){this.curTotalExp=e,Game.dispatcher.dispatchEventWith(Game.EVENT.CollectCardSyncExp),Y()}function s(t){e.activatedCards=[];for(var n=0;n!=t.length;n++){var i=t[n],a=i.getId(),r=i.getStar(),o=i.getLevel();e.activatedCards[a]={id:a,star:r,level:o,fp:0}}u();for(var n in e.activatedCards)c(e.activatedCards[Number(n)].id);PlayerAttribute.UpdateFightingPower(e.fpNotify),Game.dispatcher.dispatchEventWith(Game.EVENT.CollectCardSyncCards),j(),Y(),K()}function l(){e.fpNotify=!0}function u(){var t={};for(var n in e.activatedCards){var a=e.activatedCards[Number(n)],r=i(a.id);if(null!=a&&null!=r){null==t[r.kind]&&(t[r.kind]={});for(var o=0;o<=a.level;o++)null==t[r.kind][o]&&(t[r.kind][o]=0),t[r.kind][o]+=1}}e.curSuits={};for(var s in t){var l=0,u=0,c=Number(s);for(var h in t[c]){var d=Number(h),p=t[c][d];for(var n in e.suitConfigs){var g=e.suitConfigs[n];g.kind==c&&g.level==d&&g.level>=l&&p>=g.num&&(l=g.level,u=g.id)}}u>0&&(e.curSuits[c]=u)}e.suitAttrbutes={};for(var s in e.curSuits){var c=Number(s),m=e.curSuits[c],f={},v=e.suitConfigs[m];if(null!=v){for(var n=0;n!=v.attributes.length;n++){var y=v.attributes[n];f[y.attribute]=y.args[0]}e.suitAttrbutes[c]=f}}}function c(t){var n=e.activatedCards[t],a=i(t);if(null!=n&&null!=a){var r=a.quality,o=e.cardFpConfigs[r];if(null!=o){var s=o.baseFp,l=o.starFp[n.star],u=o.levelFp[n.level];n.fp=~~((s+u)*(100+l)/100)}}}function h(e,t,n){for(var a=i(e),r=p(t),o=0;o!=a.starAttributes.length;o++)if(a.starAttributes[o].attribute==r)return a.starAttributes[o].args[n];return 0}function d(e,t,n){for(var a=i(e),r=0;r!=a.levelAttributes.length;r++)if(a.levelAttributes[r].attribute==t)return a.levelAttributes[r].args[n];return 0}function p(t){for(var n=0;n!=e.attributeParis.length;n++){if(t==e.attributeParis[n].attribute1)return e.attributeParis[n].attribute2;if(t==e.attributeParis[n].attribute2)return e.attributeParis[n].attribute1}return""}function g(t){return lang.String(e.kindNames[t])}function m(t,n,i){var a=[],r=new Q(t,n,i),o=r.cardAttributes,s=function(t){var n=o[t],i=e.attribFormatDescCfg[t],r=i.replace(/{(\d+)}/g,function(e,t){return String(n)});a.push(r)};for(var l in o)s(l);return a}function f(t){var n={};for(var a in e.activatedCards){var r=Number(a),o=new Q(r,e.activatedCards[r].star,e.activatedCards[r].level),s=i(Number(a));if(s.kind==t)for(var l in o.cardAttributes){var u=o.cardAttributes[l],c=n[l];null==c&&(c=0),c+=u,n[l]=c}}var h=[],d=function(t){var i=n[t],a=e.attribFormatDescCfg[t],r=a.replace(/{(\d+)}/g,function(e,t){return String(i)});h.push(r)};for(var l in n)d(l);return h}function v(t){return null!=e.cardCellIconQualityBg[t]?e.cardCellIconQualityBg[t]:e.cardCellIconQualityBg[1]}function y(t){return null!=e.qualityBG[t]?e.qualityBG[t]:e.qualityBG[1]}function b(t){return null!=e.levelImg[t]?e.levelImg[t]:""}function S(t){return e.activatedCards[t]?e.activatedCards[t].level:0}function E(t){return null!=e.activatedCards[t]}function C(t){return e.activatedCards[t]}function T(e){return E(e)?I(e):G(e)}function I(e){var t=C(e);return null==t?0:t.fp}function G(t){var n=i(t);if(null==n)return 0;var a=n.quality,r=e.cardFpConfigs[a];return null==r?0:r.baseFp}function A(t){var n=[];for(var a in e.activatedCards){var r=i(Number(a));null!=r&&r.kind==t&&n.push(Number(a))}return n}function k(t){var n=[];for(var i in e.cardsConfigs){var a=e.cardsConfigs[Number(i)];a.kind==t&&n.push(a.id)}return n}function P(){var t=0;for(var n in e.activatedCards){var i=e.activatedCards[Number(n)];t+=i.fp}for(var n in e.curSuits){var r=Number(n),o=e.curSuits[r];if(null!=o){var s=a(o);t+=s.fp}}return t}function w(t){var n=0;for(var r in e.activatedCards){var o=e.activatedCards[Number(r)],s=i(o.id);s.kind==t&&(n+=o.fp)}var l=e.curSuits[t];if(null!=l){var u=a(l);n+=u.fp}return n}function L(t){var n=e.cardIconSource[t];return null==n&&(n=""),n}function R(t){var n=[],a=e.activatedCards[t],r=i(t);if(null==r)return n;for(var o=null!=a?a.star:0,s=o+1>e.MAXSTAR?e.MAXSTAR:o+1,l=0;l!=r.starAttributes.length;l++){var u=r.starAttributes[l].attribute,c=e.attribDescCfg[u],h=r.starAttributes[l].args[o],d=r.starAttributes[l].args[s];n.push({attrib:c,curParam:h,nextParam:d})}return n}function U(t){var n=[],a=e.activatedCards[t],r=i(t);if(null==r)return n;for(var o=null!=a?a.level:0,s=o+1>e.MAXSTAR?e.MAXSTAR:o+1,l=0;l!=r.levelAttributes.length;l++){var u=r.levelAttributes[l].attribute,c=e.attribDescCfg[u],h=r.levelAttributes[l].args[o],d=r.levelAttributes[l].args[s];n.push({attrib:c,curParam:h,nextParam:d})}return n}function _(t,n){var a=0;for(var r in e.activatedCards){var o=e.activatedCards[Number(r)],s=i(Number(r));s.kind==t&&o.level>=n&&(a+=1)}return a}function x(t,n){for(var i in e.suitConfigs){var a=e.suitConfigs[Number(i)];if(a.kind==t&&a.level==n)return a.id}return 0}function M(t){var n=[],i=e.suitConfigs[t];if(null==i)return n;for(var a=function(t){var a=i.attributes[t],r=a.attribute,o=a.args[0],s=e.attribFormatDescCfg[r],l=s.replace(/{(\d+)}/g,function(e,t){return String(o)});n.push(l)},r=0;r!=i.attributes.length;r++)a(r);return n}function D(t){var n=[],i=g(t),o=e.curSuits[t],s=-1;if(null!=o){var l=a(o);s=l.level}var u=r(t,s);if(0>s){var c=lang.String("collect card no suit attrib");n.push({sumaryMsg:c,attribs:[]})}else{var h=u.num,d=_(t,s),c=lang.StringWithFormat("collect card suit info {1}level {2}kind {3}curNum {4}needNum",s,i,d,h);o=x(t,s);var p=M(o);n.push({sumaryMsg:c,attribs:p})}if(s>=e.MAXLEVEL){var c=lang.String("collect card reach max suit level");n.push({sumaryMsg:c,attribs:[]})}else{var m=s>=e.MAXLEVEL?e.MAXLEVEL:s+1,f=r(t,m),v=f.num,y=_(t,m),b=lang.StringWithFormat("collect card suit info {1}level {2}kind {3}curNum {4}needNum",m,i,y,v),S=x(t,m),E=M(S);n.push({sumaryMsg:b,attribs:E})}return n}function N(){var t=[];for(var n in e.activatedCards){var a=Number(n),r=PlayerAttribute.GetItemCount(19,a);if(r>0){var o=i(a);null!=o&&t.push({id:a,num:r,quality:o.quality})}}return t}function F(t){var n=i(t);if(null==n)return 0;var a=n.quality,r=e.splitExp[a];return null==r?0:r}function O(e){var t=table.props[19][e].quality;return null==t&&(t=0),'<font color="'+egret.toColorString(Item.QualityColor[t])+'">'+table.props[19][e].name+"</font>"}function B(e){var t=X[e];return null==t?"":'<font color="'+egret.toColorString(Item.QualityColor[e])+'">'+lang.String(t)+"</font>"}function W(t){var n=e.activatedCards[t];if(null==n)return 0;var a=i(t);if(null==a)return 0;var r=a.upgradeStarCost[n.star];return null==r&&(r=0),r}function V(t){var n=e.activatedCards[t];if(null==n)return 0;var a=i(t);if(null==a)return 0;var r=a.upgradeLevelCost[n.level];return null==r?0:r}function q(e){var t=X[e];return null==t?"":lang.String(t)}function H(e){var t=e.data;19==t.Item.Type&&(j(),K())}function j(){for(var t in J){var n=Number(t),a=J[n],r=!1;for(var o in e.cardsConfigs){var s=Number(o),l=i(s);if(l.kind==n&&!E(s)){var u=PlayerAttribute.GetItemCount(19,s);if(u>0&&PlayerAttribute.Level>=e.kindConfig[1].require){r=!0;break}}}badge.onLight(a,r)}UI.CollectCardUI.instance.UpdateTabKindBadge()}function Y(){for(var t in z){var n=Number(t),a=z[n],r=!1;for(var o in e.activatedCards){var s=Number(o),l=i(s);if(l.kind==n){var u=e.activatedCards[s],c=u.star;if(!(c>=e.MAXSTAR)){var h=l.upgradeStarCost[u.star];if(e.curTotalExp>=h){r=!0;break}}}}badge.onLight(a,r)}UI.CollectCardUI.instance.UpdateTabKindBadge()}function K(){for(var t in Z){var n=Number(t),a=Z[n],r=!1;for(var o in e.activatedCards){var s=Number(o),l=i(s);if(l.kind==n){var u=e.activatedCards[s],c=u.level;if(!(c>=e.MAXLEVEL)){var h=l.upgradeLevelCost[u.level];if(PlayerAttribute.GetItemCount(19,s)>=h){r=!0;break}}}}badge.onLight(a,r)}UI.CollectCardUI.instance.UpdateTabKindBadge()}e.MAXSTAR=10,e.MAXLEVEL=10;var Q=function(){function t(t,n,i){this.cardAttributes={},this.fp=0,this.id=t,this.star=n,this.level=i;for(var a=e.cardsConfigs[t],r=0;r!=a.baseAttributes.length;r++){var o=a.baseAttributes[r].attribute,s=a.baseAttributes[r].args[0],l=h(t,o,n),u=d(t,o,i),c=~~((s+u)*(100+l)/100);this.cardAttributes[o]=c}var p=a.quality,g=e.cardFpConfigs[p];if(null!=g){var m=g.baseFp,f=g.starFp[n],v=g.levelFp[i];this.fp=~~((m+v)*(100+f)/100)}}return t}();e.CardItem=Q,__reflect(Q.prototype,"collectCardManager.CardItem"),e.cardsConfigs=egret.createMap(),e.suitConfigs=egret.createMap(),e.attributeParis=[],e.splitExp=egret.createMap(),e.attribDescCfg=egret.createMap(),e.attribFormatDescCfg=egret.createMap(),e.cardFpConfigs=egret.createMap(),e.cardIconSource=egret.createMap(),e.cardCellIconQualityBg=egret.createMap(),e.curTotalExp=0;var X=egret.createMap(),J=egret.createMap(),z=egret.createMap(),Z=egret.createMap();e.activatedCards=egret.createMap(),e.curSuits=egret.createMap(),e.suitAttrbutes=egret.createMap(),e.qualityBG=egret.createMap(),e.kindNames=egret.createMap(),e.levelImg=egret.createMap(),e.kindConfig=egret.createMap(),e.disabelStar="ui/CollectCard/disabelStar.png",e.enableStar="ui/CollectCard/enableStar.png",e.fpNotify=!1,e.LoadCfg=t,e.Load=n,e.GetCardConfig=i,e.GetSuitConfig=a,e.GetKindLevelSuitConfig=r,e.onSyncExp=o,e.onSyncActivatedCards=s,e.onLogin=l,e.GetPairAttributeName=p,e.GetKindName=g,e.GetCardAttributeDesc=m,e.GetKindAttributeDesc=f,e.GEtCellQualityBG=v,e.GetQualityBG=y,e.GetLevelImg=b,e.GetCardLevel=S,e.IsActivated=E,e.GetActivatedCard=C,e.GetCardFp=T,e.GetActivatedCardFp=I,e.GetUnActivatedCardFp=G,e.GetKindActivatedCards=A,e.GetKindCards=k,e.GetTotalFp=P,e.GetKindTotalFp=w,e.GetCardIconSource=L,e.GetCardStarAttributeCompares=R,e.GetCardLevelAttributeCompares=U,e.GetCardSuitCompareInfo=D,e.GetBagCardNums=N,e.GetCardSplitExp=F,e.GetCardColorName=O,e.GetColorQualityName=B,e.GetUpgradeStarCostExp=W,e.GetUpgradeLevelCost=V,e.GetQualityName=q,e.onItemChange=H,e.RefreshActiveBadge=j,e.RefreshUpgradeStarBadge=Y,e.RefreshUpgradeLevelBadge=K}(collectCardManager||(collectCardManager={}));var CompositeGamesGroupon;!function(e){function t(){net.Register(2092,i),net.Register(2093,a),net.Register(2094,r),net.Register(2095,n);var t=RES.getRes("config/compositegames/groupon.json");e.CompositeGrouponEndTime=t.dayCount,e.minRankAmount=t.minRankAmount,e.info_GrouponAwards=[];for(var o=t.awards,s=0;s<o.length;s++)e.info_GrouponAwards.push({awards:o[s].awards,count:o[s].goldCoin,status:0});e.info_GrouponRankAwards=t.rankAwards}function n(t){var n=net.def.Index.decode(t);e.leftDays=n.getIndex()}function i(t){e.rankList=[];for(var n=net.def.S2COpeningGrouponRankList.decode(t),i=0;i<n.list.length;i++)e.rankList.push({round:i+1,name:n.list[i].name,time:n.list[i].amount});Game.dispatcher.dispatchEventWith(Game.EVENT.CompositeGrouponRanklist)}function a(t){var n=net.def.S2COpeningGrouponAward.decode(t);n.award&&badge.onLight(badge.action.CompositeGrouponAward,!0),e.serverAmount!=n.amount&&(e.serverAmount=n.amount||0,Game.dispatcher.dispatchEventWith(Game.EVENT.CompositeGrouponAmount))}function r(t){var n=net.def.S2COpeningGrouponStatus.decode(t);e.charged=n.charged,e.serverAmount!=n.serverAmount&&(e.serverAmount=n.serverAmount||0,Game.dispatcher.dispatchEventWith(Game.EVENT.CompositeGrouponAmount)),e.personAmount!=n.personAmount&&(e.personAmount=n.personAmount||0,Game.dispatcher.dispatchEventWith(Game.EVENT.CompositeGrouponAmount));for(var i=!1,a=!1,r=0;r<n.status.length;r++)e.grouponStatus[r]!=n.status[r]&&(e.grouponStatus[r]=n.status[r],i=!0),1==e.grouponStatus[r]&&(a=!0);i&&Game.dispatcher.dispatchEventWith(Game.EVENT.CompositeGrouponStatus),badge.onLight(badge.action.CompositeGrouponAward,a)}function o(e,t){return e.status==t.status?e.idx-t.idx:1==e.status?-1:1==t.status?1:e.status-t.status}e.grouponStatus=[],e.grouponRanks=[],e.CompositeGrouponEndTime=30,e.serverAmount=0,e.personAmount=0,e.minRankAmount=0,e.charged=!1,e.leftDays=0,e.load=t,e.sortStatus=o}(CompositeGamesGroupon||(CompositeGamesGroupon={}));var CompositeGamesSevenDayGift;!function(e){function t(){for(var t=0;t<e.data.bonus.length;t++)if(!e.data.bonus[t])return!1;return!0}function n(){var t,n=e.data.count;e.data.count>=e.data.bonus.length?(n=e.data.bonus.length,t=null):t=e.data.count;for(var i=0;n>i;i++)if(!e.data.bonus[i])return{idx:i,next:t};return{idx:null,next:t}}function i(){if(t())badge.onLight(badge.action.CompositeSevenDayGift,!1);else{var e=n();null!=e.idx?badge.onLight(badge.action.CompositeSevenDayGift,!0):null!=e.next?badge.onLight(badge.action.CompositeSevenDayGift,!1):badge.onLight(badge.action.CompositeSevenDayGift,!1)}}e.finish=t,e.withDay=n,e.onLight=i}(CompositeGamesSevenDayGift||(CompositeGamesSevenDayGift={}));var Consignment;!function(e){function t(){Game.dispatcher.addEventListener(Game.EVENT.AddItem,h,null),Game.dispatcher.addEventListener(Game.EVENT.RemoveItem,h,null),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,h,null);for(var t=RES.getRes("public_config/consignment/warelist.json"),i=0;i!=t.length;i++){var a=t[i],r=a.unitPrice,o=a.unitPrice*a.maxPriceRate,s=(o-r)/10;a.priceList=[];for(var l=0;10>=l;l++){var u=r+Math.ceil(s*l);a.priceList.push(u)}var c=n(a.genre,a.detailType);e.ConfigWareList[c]=a}for(var d=RES.getRes("public_config/consignment/waretype.json"),i=0;i!=d.length;i++){var p=d[i];e.ConfigWareType[p.typeId]=p}e.ConfigShelf=RES.getRes("public_config/consignment/shelf.json"),e.ConfigSetting=RES.getRes("public_config/consignment/setting.json")}function n(e,t){return e+"-"+t}function i(t,i){var a=n(t,i);return e.ConfigWareList[a]}function a(e,t){return null!=i(e,t)}function r(t){return e.ConfigShelf.prices[t]}function o(e){UI.ConsignmentPanel.instance.selectPage=e,UIManager.pushPage(UI.ConsignmentPanel.instance)}function s(e){this.dataTypeWareList=e,Game.dispatcher.dispatchEventWith(Game.EVENT.ConsignmentSyncTypeWareList)}function l(e){var t=function(e,t){return e.getPrice()-t.getPrice()};this.dataSpecificItemList=e,this.dataSpecificItemList.getList().sort(t),Game.dispatcher.dispatchEventWith(Game.EVENT.ConsignmentSyncSpecificItemList)}function u(e){var t=function(e,t){return e.getLeftTime()!=t.getLeftTime()?e.getLeftTime()-t.getLeftTime():e.getKey()<t.getKey()?1:-1};this.dataSellerInfo=e,this.dataSellerInfo.getList().sort(t),Game.dispatcher.dispatchEventWith(Game.EVENT.ConsignmentSyncSellerInfo);for(var n=!1,i=this.dataSellerInfo.getList(),a=0;a!=i.length;a++){var r=i[a];if(r.getLeftTime()<=0){n=!0;break}}badge.onLight(badge.action.ConsignmentTimeout,n)}function c(e){this.dataSellerMoney=e,Game.dispatcher.dispatchEventWith(Game.EVENT.ConsignmentSyncSellerMoney);var t=e>0?!0:!1;badge.onLight(badge.action.ConsignmentFetchMoney,t)}function h(){var e=egret.getTimer();v>e||(v=e+f,egret.setTimeout(p,null,f))}function d(){if(!e.wareListInitFlag){e.wareListInitFlag=!0,e.bagWareList=[];for(var t in e.ConfigWareList){var n=e.ConfigWareList[t],i=n.genre,a=n.detailType,r=PlayerAttribute.GetItemCount(i,a),o=[i,a,r];e.bagWareList.push(o)}}}function p(){e.wareListInitFlag||d();for(var t=!1,n=0;n!=e.bagWareList.length;n++){var i=e.bagWareList[n][0],a=e.bagWareList[n][1],r=PlayerAttribute.GetItemCount(i,a);e.bagWareList[n][2]!=r&&(e.bagWareList[n][2]=r,t=!0)}t&&Game.dispatcher.dispatchEventWith(Game.EVENT.ConsignmentItemChange)}function g(){return e.wareListInitFlag||d(),e.bagWareList}function m(){if(null==e.dataSellerInfo)return 0;var t=e.dataSellerInfo.getShelfNum(),n=e.dataSellerInfo.getList().length;return t-n}e.ConfigWareList={},e.ConfigWareType={},e.ConfigSetting=null,e.ConfigShelf=null,e.PAGE_BUY=0,e.PAGE_SELL=1,e.CONSIGNMENT_CELL_ICON="icon/other/consignment.png",e.dataTypeWareList=null,e.dataSpecificItemList=null,e.dataSellerInfo=null,e.dataSellerMoney=0,e.wareListInitFlag=!1,e.bagWareList=[];var f=1e3,v=0;e.Load=t,e.MakeWareKey=n,e.GetWareInfo=i,e.IsConsignmentWare=a,e.GetShelfPrice=r,e.Open=o,e.OnSyncTypeWareList=s,e.OnSyncSpecificItemList=l,e.OnSyncSellerInfo=u,e.OnSyncSellerMoney=c,e.InitBagWareList=d,e.UpdateBagWareList=p,e.GetBagWareList=g,e.GetFreeShelfNum=m}(Consignment||(Consignment={}));var CrossServer;!function(e){function t(){return null==v&&(v=new UI.WildBossNoteUI(UI.WildBossNoteViewType.CrossServerBoss)),v}function n(){UI.HUD.instance.showBattle();var n=t(),i=e.bossMap[World.mapId];n.txtBossName=e.bossConfig[i].name,n.npcPic=e.bossConfig[i].icon,n.crossBossIdx=i,UI.battle.addChild(n),Game.removeFromParent.apply(n.myScoreGroup),UI.setDisableAllPlayerTitles(!0),SuperWeapon.disableAllPlayersEffect(!0)}function i(){null!=v&&(UI.battle.removeChild(v),v=null),UI.setDisableAllPlayerTitles(!1),SuperWeapon.disableAllPlayersEffect(!1)}function a(e,t){null!=v&&v.updateBossHP(t,e)}function r(){Scene.listenEnterMap(e.sceneName,n),Scene.listenLeaveMap(e.sceneName,i),Scene.handleIdle[e.sceneName]=function(){return null},Scene.listenBosslifeChange(e.sceneName,a),e.bossConfig=RES.getRes("config/crossserver/boss.json"),e.bossMap={};for(var t=0;t<e.bossConfig.length;t++)e.bossMap[e.bossConfig[t].mapId]=t,e.bossConfig[t].status=g.Close;net.Register(327,s),net.Register(269,l)}function o(t){if(!Player.instance.guildName)return void PopUpMessage.push(lang.String("no guild"),color.RED);if(PlayerAttribute.Level<e.bossOpenLevel)return void PopUpMessage.push(lang.StringWithFormat("require level {1}",e.bossOpenLevel),color.RED);if(!e.bossStatue)return void PopUpMessage.push(lang.String("not open"),color.RED);for(var n=Game.getServerDate(),i=!1,a=0;a<Reminder.events[Reminder.EventName.CrossServerBoss].timeLine.length;a++){var r=Reminder.events[Reminder.EventName.CrossServerBoss].timeLine[a];if(n.getHours()==r.hour&&n.getMinutes()-r.minute<=m){i=!0;break}}if(!i)return void PopUpMessage.push(lang.StringWithFormat("join time limit {1}",m),color.RED);for(var o=-1,a=0;a<Reminder.events[Reminder.EventName.CrossServerBoss].timeLine.length;a++){var r=Reminder.events[Reminder.EventName.CrossServerBoss].timeLine[a];if(n.getHours()==r.hour&&n.getMinutes()-r.minute<=Reminder.events[Reminder.EventName.CrossServerBoss].duration/Game.Minute){o=a;break}}if(0>o||o>=e.leftJoinCounts.length||e.leftJoinCounts[o]<=0)return void PopUpMessage.push(lang.StringWithFormat("join count limit {1}",f),color.RED);var s=new net.def.Index;s.setIndex(t),net.socket.write(214,s.toArrayBuffer())}function s(t){if(null!=v){for(var n=net.def.S2CCrossserverBossRanklist.decode(t),i=n.ranks,a=[],r=0;r<i.length;r++)a[r]={rank:r+1,name:i[r].name,damage:Math.floor(i[r].damage/1e3)};if(v.updateRankingListData(a),v.restTime=n.restTime,0!=n.status){switch(null==e.resultUI&&(e.resultUI=new UI.CrossServerBossResult),n.status){case 1:e.resultUI.currentState="win";break;case 2:e.resultUI.currentState="lose"}UIManager.pushPage(e.resultUI),e.resultUI.updateRankListData(a,1==n.status)}}}function l(t){var n=net.def.UInt32Silce.decode(t);e.leftJoinCounts=n.values,Game.dispatcher.dispatchEventWith(Game.EVENT.CrossServerBossStatusChanged)}function u(t){e.bossStatue=!0,y=Math.ceil(t/Game.Second),SecondTicker.addEventListener(h,null),Game.dispatcher.dispatchEventWith(Game.EVENT.CrossServerBossStatusChanged),net.socket.write(215,null)}function c(){for(var t=0;t<e.bossConfig.length;t++)e.bossConfig[t].status=g.Open}function h(){y--,0>=y&&(SecondTicker.removeEventListener(h,null),e.bossStatue=!1,Game.dispatcher.dispatchEventWith(Game.EVENT.CrossServerBossStatusChanged))}function d(){PlayerAttribute.Level>=e.bossOpenLevel?UIManager.pushPage(new UI.CrossServerBossEntrance):PopUpMessage.push(lang.StringWithFormat("require level {1}",e.bossOpenLevel),color.RED)}function p(){for(var t=PlayerAttribute.Level,n=0;n<e.bossConfig.length;n++)if(t>=e.bossConfig[n].needLevel&&e.bossConfig[n].status!=g.Finish)return!0;return!1}var g;!function(e){e[e.Close=0]="Close",e[e.Open=1]="Open",e[e.Finish=2]="Finish"}(g=e.BossStatusType||(e.BossStatusType={})),e.sceneName="crossserver/boss",e.bossOpenLevel=40;var m=15,f=3;e.bossConfig=[];var v;e.bossStatue=!1;var y=0;e.leftJoinCounts=[],e.getUiNote=t,e.bossLoad=r,e.bossEnter=o,e.StartTimer=u,e.initBossStatus=c,e.openCrossBossUI=d,e.checkCrossBossAllStatus=p}(CrossServer||(CrossServer={}));var DailyRecharge;!function(e){function t(){var t=RES.getRes("public_config/operation/dailyrecharge/dailyrecharge.json");e.threshold=t.threshold;for(var o=[],s=t.awards,l=0;l<s.length;l++){var u=s[l],c=table.parseListAwards(u.award);o.push({day:u.day,award:c})}e.awardsConfig=[];for(var h=null,l=0;l<o.length;l++){var d=o[l];if(null!=h)for(var p=h.day+1;p<d.day;p++)e.awardsConfig.push({day:p,awards:h.award});e.awardsConfig.push({day:d.day,awards:d.award}),h=d}e.dataDisplayAwards.push({day:null,award:{type:"clientitem",icon:"icon/item/gold.png",name:lang.String("silverCoin"),quality:4,desc:lang.String("silverCoin"),count:0},state:0});for(var g=e.awardsConfig.length,m=0,l=g-1;l>=0;l--)for(var f=0;f<e.awardsConfig[l].awards.length;f++)"silverCoin"==e.awardsConfig[l].awards[f].type?m+=e.awardsConfig[l].awards[f].content:e.dataDisplayAwards.push({day:e.awardsConfig[l].day,award:e.awardsConfig[l].awards[f],state:0});e.dataDisplayAwards[0].award.count=m,e.dataDisplayAwards[0].award.desc=lang.StringWithFormat("rechargeEveryDay total silverCoin {1}",m),net.Register(340,i),net.Register(341,a),net.Register(347,n),net.Register(339,r)}function n(t){var n=net.def.Value.decode(t);e.gold=n.Value,Game.dispatcher.dispatchEventWith(Game.EVENT.DailyRechargeGold)}function i(t){var n=net.def.S2CSyncContinuousRecharge.decode(t);e.awardsStatus=n.status,o(),e.day=n.day,e.gold=n.gold,Game.dispatcher.dispatchEventWith(Game.EVENT.DailyRechargeGold),Game.dispatcher.dispatchEventWith(Game.EVENT.DailyRechargeSyncState)}function a(t){var n=net.def.Value.decode(t);e.day=n.Value,Game.dispatcher.dispatchEventWith(Game.EVENT.DailyRechargeGold)}function r(t){var n=net.def.S2CAwards.decode(t);e.awardsStatus=n.awards,o(),Game.dispatcher.dispatchEventWith(Game.EVENT.DailyRechargeSyncState)}function o(){for(var t=e.awardsConfig.length,n=!1,i=!1,a=0;t>a;a++){if(!e.awardsStatus[a]){n=!0;break}if(1==e.awardsStatus[a]){i=!0,n=!0;break}}badge.onLight(badge.action.DailyRechargeAward,i),n!=e.open&&(e.open=n);for(var a=e.awardsStatus.length-1;a>=0;a--)for(var r=a+1,o=0;o<e.dataDisplayAwards.length;o++)null!=e.dataDisplayAwards[o].day&&e.dataDisplayAwards[o].day==r&&(e.dataDisplayAwards[o].state=e.awardsStatus[a])}function s(){return e.gold<e.threshold?lang.StringWithFormat("recharge {1} gold to finish","<font color="+egret.toColorString(color.Title1_Value)+">"+(e.threshold-e.gold)+"</font>"):2==e.awardsStatus[e.day-1]?"Đã nhận thưởng hôm nay":"Chưa nhận thưởng hôm nay"}function l(e){var t=new net.def.Index;t.setIndex(e),net.socket.write(104,t.toArrayBuffer())}e.dataDisplayAwards=[],e.open=!1,e.load=t,e.getTodayStatus=s,e.drawAward=l}(DailyRecharge||(DailyRecharge={}));var table;!function(e){function t(){var e,t="public_config/groupdungeon.json";e=RES.getRes(t);for(var n=0;n<e.length;n++)DungeonGroup.dungeonInfo[e[n].groupType]=e[n];var i=egret.localStorage.getItem("dungeonGroupMsgFilter");null!=i?DungeonGroup.filter=JSON.parse(i):DungeonGroup.filter=[!0,!0,!0]}e.LoadGroupDungeon=t}(table||(table={}));var DungeonGroup;!function(e){function t(t,n){for(var i=e.dungeonInfo[n],a=0;a<i.needItemOwner.length;a++){var r=i.needItemOwner[a];
if(PlayerAttribute.bag.CalcCount(r.content.genre,r.content.detailType)<r.content.count)return 1==t&&(null!=r.obtainId&&UI.ResourceObtain.Open([r.obtainId]),PopUpMessage.push(lang.String("not engough item"),color.RED)),!1}return!0}function n(t,n){var i=e.dungeonInfo[n];return PlayerAttribute.Level<i.needLv?(1==t&&PopUpMessage.push(lang.StringWithFormat("require level {1}",i.needLv),color.RED),!1):PlayerAttribute.fp<i.needFp?(1==t&&PopUpMessage.push(lang.StringWithFormat("fp is less than {1}",i.needFp),color.RED),!1):PartnerQingyi.GetMyDataGroupLevel(i.qingyiGroup.id)<i.qingyiGroup.need?(1==t&&PopUpMessage.push(lang.StringWithFormat("{1} qingyi is less than {2}",PartnerQingyi.GetGroupName(i.qingyiGroup.id),PartnerQingyi.ConfigLevelList[i.qingyiGroup.need].name),color.RED),!1):!0}function i(t){if(null!=e.inviteInfoMap[t]){var n=e.inviteTotalInfo.getItemIndex(e.inviteInfoMap[t]),i=e.finalInviteInfo.getItemIndex(e.inviteInfoMap[t]);delete e.inviteInfoMap[t],-1!=n&&e.inviteTotalInfo.removeItemAt(n),-1!=i&&e.finalInviteInfo.removeItemAt(i),e.finalInviteInfo.length<=0&&1==E&&null!=e.RequestIcon.parent&&Game.removeFromParent.apply(e.RequestIcon)}}function a(){for(;e.finalInviteInfo.length>0;){var t=e.finalInviteInfo.getItemAt(0);i(t.idx)}}function r(){e.finalInviteInfo.removeAll();for(var t=0;t<e.inviteTotalInfo.length;t++){var n=e.inviteTotalInfo.getItemAt(t);1==e.filter[n.from]&&e.finalInviteInfo.addItem(n)}}function o(){UI.battle&&UI.battle.rightBottomGroup&&(e.RequestIcon||(e.RequestIcon=new UI.IconButton,e.RequestIcon.img="ui/common1/question.png",e.RequestIcon.width=70,e.RequestIcon.height=70,e.RequestIcon.onTap=function(t){UIManager.pushPage(UI.UIDungeonGroupBeInvited.instance),e.RequestIcon.freeMovie(),Game.removeFromParent.apply(e.RequestIcon),E=!1}),e.RequestIcon.parent!=UI.battle.rightBottomGroup&&(UI.battle.addToRightBottomGroup(e.RequestIcon,0),E=!0,e.RequestIcon.playMovie(-1)))}function s(t,i,a,r,s,l){if(World.wild&&Player.instance.Name!=a){e.inviteTotalInfo.length>=100&&(delete e.inviteInfoMap[e.inviteTotalInfo.getItemAt(0).idx],e.inviteTotalInfo.removeItemAt(0)),e.finalInviteInfo.length>=100&&e.finalInviteInfo.removeItemAt(0);var u=e.dungeonInfo[i];if(n(!1,i)){var c=Math.floor(Game.getServerDate().getTime()/1e3),h={idx:e.inviteInfoCnt,groupID:t,dungeonName:u.name,groupType:i,inviter:a,desc:lang.StringWithFormat("dgroup invite to {1}",u.name),icon:u.icon,from:s,endTime:c+l};e.inviteInfoMap[e.inviteInfoCnt]=h,e.inviteTotalInfo.addItem(h),1==e.filter[s]&&(o(),e.finalInviteInfo.addItem(h),e.inviteTotalInfo.refresh(),2==s?ChatSys.push2(a,0,lang.StringWithFormat("dungeongroup invite",a,t,i,2),null,ChatSys.channel_private,r,PlayerAttribute.faction,"",!1):1==s&&ChatSys.push2(a,0,lang.StringWithFormat("dungeongroup invite",a,t,i,2),null,ChatSys.channel_guild,r,PlayerAttribute.faction,"",!1)),MakeDelayExecute(function(){e.RemoveInviteItemByID(h.idx)},null,l*Game.Second)(),e.inviteInfoCnt++}}}function l(e){s(e.groupID,e.groupType,e.inviter.name,e.inviter.faction,e.from,e.restTime)}function u(t){switch(t.type){case 0:PopUpMessage.push(lang.String("dgroup is full"),color.RED);break;case 1:PopUpMessage.push(lang.String("dgroup not exist"),color.RED);break;case 2:var n=e.dungeonInfo[t.value];PopUpMessage.push(lang.StringWithFormat("{1} qingyi is less than {2}",PartnerQingyi.GetGroupName(n.qingyiGroup.id),PartnerQingyi.ConfigLevelList[n.qingyiGroup.need].name),color.RED)}}function c(t){e.leadreIndex=t.leaderIdx,UI.UIDungeonGroup.instance.loaded&&(UI.UIDungeonGroup.instance.OnChangeLeader(),Game.dispatcher.dispatchEventWith(Game.EVENT.OnDungeonGroupChangeLeader))}function h(t){null!=e.PlayerList[t.memberIndex]&&(e.PlayerList[t.memberIndex]={empty:!0,viplevel:0,name:"",faction:0,level:0,fp:0,state:0,idx:t.memberIndex,ticketNum:null},UI.UIDungeonGroup.instance.Refresh())}function d(t){null!=e.PlayerList[t.index]&&(e.PlayerList[t.index]={empty:t.player.empty,viplevel:t.player.viplv,name:t.player.name,faction:t.player.faction,level:t.player.level,fp:t.player.fp,state:t.player.state,idx:t.index,ticketNum:t.player.ticketNum},UI.UIDungeonGroup.instance.Refresh())}function p(t){if(World.wild){e.myIndex=-1,e.PlayerList=[];for(var n=0;n<t.players.length;n++)e.PlayerList.push({empty:t.players[n].empty,viplevel:t.players[n].viplv,name:t.players[n].name,faction:t.players[n].faction,level:t.players[n].level,fp:t.players[n].fp,state:t.players[n].state,idx:n,ticketNum:t.players[n].ticketNum}),t.players[n].name==Player.instance.Name&&(e.myIndex=n);-1!=e.myIndex&&(e.groupID=t.id,e.groupType=t.type,e.leadreIndex=t.leaderIdx,UIManager.push(UI.UIDungeonGroup.instance),UI.UIDungeonGroup.instance.Refresh(),UI.UIDungeonGroup.instance.remainingTime.delta=t.restTime)}}function g(e){if(!World.wild)return void PopUpMessage.push(lang.String("operation not permitted"),color.RED);if(n(!0,e)&&t(!0,e)){var i=new net.def.C2SDGroupCreateGroup;i.type=e,net.socket.write(2104,i.toArrayBuffer())}}function m(e,i){if(!World.wild)return PopUpMessage.push(lang.String("operation not permitted"),color.RED),!1;if(!n(!0,i)||!t(!0,i))return!1;var a=new net.def.C2SDGroupJoin;return a.groupID=e,net.socket.write(2106,a.toArrayBuffer()),!0}function f(t){var n=0;e.inviteList=[];for(var i={},a=0;a<t.friends.length;a++)i[t.friends[a].name]=1,e.inviteList.push({name:t.friends[a].name,lv:t.friends[a].level,fp:t.friends[a].fp,faction:t.friends[a].faction,idx:n,uuid:t.friends[a].uuid,selected:!1}),n++;UI.UIDungeonGroupInvite.instance.OnDataArrive()}function v(){PopUpMessage.push("Đội đã bị giải tán",color.RED),UIManager.pop(UI.UIDungeonGroup.instance),UIManager.pop(UI.UIDungeonGroupInvite.instance),e.groupID=0,e.myIndex=-1,e.leadreIndex=0,e.groupType=0,e.PlayerList=[]}function y(){(WorldLine.IsOpen("QingyiScene")||WorldLine.IsOpen("QingyiHeroScene"))&&UIManager.pushPage(UI.UIGroupDungeonPage.instance)}function b(e){function t(e,t){return e.id<t.id?1:e.id>t.id?-1:0}var n=[];for(var i in this.dungeonInfo){var a=this.dungeonInfo[i];a.level==e&&n.push(a)}return n.sort(t),n}var S;!function(e){e[e.DungeonTypeNormal=1]="DungeonTypeNormal",e[e.DungeonTypeHard=2]="DungeonTypeHard"}(S=e.DungeonType||(e.DungeonType={})),e.dungeonInfo={},e.inviteTotalInfo=new eui.ArrayCollection,e.finalInviteInfo=new eui.ArrayCollection,e.inviteInfoMap={},e.inviteInfoCnt=0,e.groupID=0,e.myIndex=-1,e.leadreIndex=0,e.groupType=0,e.restTime=0,e.PlayerList=[],e.inviteList=[],e.OnPlayerItemCheck=t,e.OnPlayerAttrCheck=n;var E=!1;e.RemoveInviteItemByID=i,e.RemoveAllSelectedInvite=a,e.UpdateInviteFilter=r,e.OnNewInvite=s,e.OnSingleInvite=l,e.OnCommonMsg=u,e.OnChangeLeader=c,e.OnSyncMemberLeave=h,e.OnSyncOneMember=d,e.OnSyncGroupInfo=p,e.Try2CreateGroup=g,e.JoinGroup=m,e.OnSyncInviteList=f,e.Dismiss=v,e.OpenDungeonPage=y,e.GetDungeonGroupInfo=b}(DungeonGroup||(DungeonGroup={}));var DungeonHallMgr;!function(e){function t(){_=MakeDelayExecute(g,null,5e3)}function n(){e.dataMemberList.removeAll();for(var t=0;3!=t;t++)e.dataMemberList.addItem(U);e.dataMemberList.refresh()}function i(){for(var t=0,n=0;n!=e.dataMemberList.length;n++)"empty"!=e.dataMemberList.getItemAt(n).state&&t++;return t}function a(t){if(t.getInRoom()){for(var n=0;n!=e.dataMemberList.length;n++)if(""==e.dataMemberList.getItemAt(n).name){e.dataMemberList.replaceItemAt({level:t.getLevel(),fp:t.getFp(),faction:t.getFaction(),name:t.getName(),bMaster:t.getIsMaster(),online:t.getOnline(),conds:t.getConds(),state:"member"},n);break}e.dataMemberList.refresh(),f(t.getName(),!1)}if(t.getName()==Player.instance.Name&&(Game.dispatcher.dispatchEventWith(Game.EVENT.DungeonHallEnterRoom),null!=UI.dungeonHallUI)){UI.dungeonHallUI.HideAllCond();var i=t.getConds();e.conds[e.curTarget]=i;for(var n=0;n!=i.length;n++)UI.dungeonHallUI.SetCond(n+1,i[n].getCondType(),i[n].getCondValue())}}function r(t){var n=t.getTarget();e.conds[n]=t.getConds(),e.mapConds[n]={};for(var i=0;i!=e.conds[n].length;i++){var a=e.conds[n][i].getCondType();a==e.CondType_DailyLeftTimes?e.mapConds[n][e.CondType_DailyLeftTimes]=e.conds[n][i].getCondValue():a==e.CondType_NeedLevel&&(e.mapConds[n][e.CondType_NeedLevel]=e.conds[n][i].getCondValue())}o(n)?badge.onLight(badge.DungeonHallAction[n],!0):badge.onLight(badge.DungeonHallAction[n],!1)}function o(e){return PlayerAttribute.Level>=s(e)&&l(e)>0?!0:!1}function s(t){return null==e.mapConds[t]?0:e.mapConds[t][e.CondType_NeedLevel]||0}function l(t){return null==e.mapConds[t]?0:e.mapConds[t][e.CondType_DailyLeftTimes]||0}function u(t){for(var n=0;n<t.length;n++){for(var i=t[n],a=i.getFaction(),r=i.getLevel(),o=i.getFp(),s=i.getName(),l=null,u=0;u!=table.dungeonAssistCfg.length;u++)if(table.dungeonAssistCfg[u].faction==a){l=table.dungeonAssistCfg[u];break}if(null==l)return;for(var c=l.icon,h=0;h!=e.dataMemberList.length;h++)if("empty"==e.dataMemberList.getItemAt(h).state){e.dataMemberList.replaceItemAt({name:s,fp:o,level:r,icon:c,faction:a,state:"assist"},h);break}e.dataMemberList.refresh()}}function c(){for(var t=0,n=0;n!=e.dataMemberList.length;n++)"member"==e.dataMemberList.getItemAt(n).state&&t++;return t}function h(){for(var t=0,n=0;n!=e.dataMemberList.length;n++)"assist"==e.dataMemberList.getItemAt(n).state&&t++;return t}function d(t){return t==e.DungeonTarget_None?(e.dataRoomList.removeAll(),e.dataRoomList.refresh(),n(),void Game.dispatcher.dispatchEventWith(Game.EVENT.DungeonHallQuitRoom)):(Game.dispatcher.dispatchEventWith(Game.EVENT.DungeonHallEnterRoom),e.curTarget=t,e.curTargetName=e.Targets[t],void(null!=UI.dungeonHallUI&&(UI.dungeonHallUI.curTargetName=e.curTargetName)))}function p(e,t,n){var i=function(){return A(e,n,!1),!0},a=lang.String("dungeon room invitation"),r=lang.StringWithFormat("dungeon {1} invite you to join room",e);UI.ConfirmBox.Show(UI.ConfirmBoxStyle.team,a,r,function(){return A(e,n,!0),!0},i,i),x=e,M=n,_()}function g(){UIManager.pop(UI.ConfirmBox.instance),""!=x&&A(x,M,!1)}function m(){for(var t=[],n=friend.friendData,i=0;i<n.length;i++){0==n[i].offlineTime&&t.push({name:n[i].name,level:n[i].level,fp:n[i].fp,faction:n[i].faction,online:!0,inviteState:G(n[i].name)})}e.dataInviteFriend.replaceAll(t)}function f(t,n){for(var i=0;i<e.dataInviteFriend.length;i++)if(e.dataInviteFriend.getItemAt(i).name==t){e.dataInviteFriend.getItemAt(i).inviteState=n;break}e.dataInviteFriend.refresh()}function v(){if(!(e.dataInviteAssist.length>0)){for(var t=table.encounter.mercenary,n=[],i=t.length,a=table.npcs,r=0;i>r;r++){var o=t[r],s=a[o.id];n.push({id:r+1,name:s.name,fp:Encounter.fp,level:Encounter.level,price:o.price,icon:o.icon})}e.dataInviteAssist=new eui.ArrayCollection(n)}}function y(){return e.curTarget==e.DungeonTarget_None?(PopUpMessage.push(lang.String("dungeon need select a target"),color.RED),0):(friend.refreshFriends(),m(),v(),UI.DungeonInvite.instance.currentState="member",void UIManager.pushPage(UI.DungeonInvite.instance))}function b(){UIManager.pop(UI.DungeonInvite.instance)}function S(){k(237,null)}function E(e,t,n){if(egret.getTimer()>t)return void PopUpMessage.push(lang.String("dungeon this team link out of time"),color.RED);var i=new net.def.C2SDungeonApplyJoinRoom;i.setMaster(e),i.setRoomId(n),k(238,i.toArrayBuffer())}function C(t){if(T(t)){var n=new net.def.C2SDungeonInviteRoom;n.name=t,n.target=e.curTarget,k(240,n.toArrayBuffer()),Game.dispatcher.dispatchEventWith(Game.EVENT.DungeonHallEnterRoom)}}function T(t){if(e.waitInvite[t])return!1;var n=!0;for(var i in e.waitInvite){n=!1;break}return n&&SecondTicker.addEventListener(I,null),e.waitInvite[t]=Game.getServerDate().getTime()+5e3,f(t,!0),!0}function I(){var t=Game.getServerDate().getTime(),n=!0;for(var i in e.waitInvite)t>e.waitInvite[i]?(f(i,!1),delete e.waitInvite[i]):n=!1;n&&SecondTicker.removeEventListener(I,null)}function G(t){return e.waitInvite[t]?!0:!1}function A(e,t,n){if(x="",!n||!WulinLiansai.IsInRoom()){var i=new net.def.C2SDungeonAcceptInviteResult;i.name=e,i.roomId=t,i.accept=n,k(241,i.toArrayBuffer())}}function k(e,t){return Game.isWildMap()?void net.socket.write(e,t):void PopUpMessage.push(lang.String("dungeon you should oprate in wild map"),color.RED)}function P(t){if(t==e.DungeonTarget_None)return void PopUpMessage.push(lang.String("dungeon need select a target"),color.RED);l(t);if(l(t)<=0)return void PopUpMessage.push(lang.String("dungeon no daily left time"),color.RED);if(!WulinLiansai.IsInRoom()){var n=new net.def.C2SDungeonQuickJoin;n.setTarget(t),e.SendDungeonCmd(244,n.toArrayBuffer())}}function w(){return i()>0}function L(){e.curTarget=e.DungeonTarget_None,n(),Game.dispatcher.dispatchEventWith(Game.EVENT.DungeonHallQuitRoom)}function R(e){null!=UI.dungeonHallUI&&UI.dungeonHallUI.OnStateChange(e)}e.Targets=[],e.Targets[0]="Luyện cấp Dã Ngoại",e.Targets[1]="Bắt Trộm Khoáng",e.Targets[2]="Phong Lăng Độ",e.DungeonTarget_None=0,e.DungeonTarget_CatchThief=1,e.DungeonTarget_FerryBoat=2,e.curTargetName=e.Targets[0],e.curTarget=0,e.dataMemberList=new eui.ArrayCollection;var U={level:0,fp:0,faction:1,name:"",bCaptain:!1,state:"empty"};e.dataRoomList=new eui.ArrayCollection,e.dataInviteFriend=new eui.ArrayCollection,e.dataInviteAssist=new eui.ArrayCollection,e.waitInvite={},e.conds={},e.CondType_DailyLeftTimes=1,e.CondType_NeedLevel=2,e.CondType_InWildMap=3;var _,x="",M=0;e.DungeonRoom_State_Idle=1,e.DungeonRoom_State_WaitFriend=2,e.DungeonRoom_State_Opening=3,e.DungeonRoom_State_Invalid=4,e.DungeonRoom_State_Count=5,e.CondType=[],e.CondType[e.CondType_DailyLeftTimes]="dungeon condtype daily left times",e.CondType[e.CondType_NeedLevel]="dungeon condtype need level",e.init=t,e.ClearRoomMemberData=n,e.GetRoomMemberCount=i,e.onSyncMemberList=a,e.mapConds={},e.onSyncConds=r,e.canDungeonConds=o,e.getDungeonCond_NeedLevel=s,e.getDungeonCond_LeftTimes=l,e.onSyncAssist=u,e.GetMemberNum=c,e.GetAssistNum=h,e.onSyncRoomInfo=d,e.ShowInviteConfirmPanel=p,e.updateDataInviteFriend=m,e.ShowDungeonInvite=y,e.CloseDungeonInvite=b,e.ApplyQuitRoom=S,e.ApplyJoinRoom=E,e.InviteRoom=C,e.AcceptInvitation=A,e.SendDungeonCmd=k,e.OpenDungeonWithTarget=P,e.IsInRoom=w,e.ClearRoomData=L,e.OnStateChange=R}(DungeonHallMgr||(DungeonHallMgr={}));var Encounter;!function(e){function t(){null==h&&(h=new UI.BossHUD,h.icon="ui/map/boss100.png"),UI.battle.addChild(h),h.currentState="encounter",isNaN(h.remainingTime.delta)&&(h.remainingTime.delta=95),h.onExit=o}function n(){null!=h&&(UI.battle.removeChild(h),h.onExit=null,h=null),null!=d&&(UIManager.pop(d),d.onReturn=null,d=null)}function i(e){var t=net.def.AwardResultList.decode(e);null==d&&(d=new UI.EncountersResult,d.onReturn=o),d.awards=table.parseAwards(t.awards),d.currentState="succeed",UIManager.push(d)}function a(e){null==d&&(d=new UI.EncountersResult,d.onReturn=o),d.currentState="fail",UIManager.push(d)}function r(e){var t=net.def.S2CSyncSceneEncounter.decode(e);null==h&&(h=new UI.BossHUD,h.icon="ui/map/boss100.png"),h.bossName=table.npcs[t.bossId].name,h.remainingTime.delta=t.time}function o(){net.socket.write(141,null)}function s(t){var n=net.def.S2CSyncEncounter.decode(t);e.events=[],e.level=n.level,e.fp=n.fp;var i=n.events.length,a=table.encounter.event;e.rate=n.rate;for(var r,o=0;i>o;o++){var s=n.events[o],u=a[s.eventId-1],c=new RemainingTime(s.expiredTime);(null==r||c.delta<r)&&(r=c.delta),e.events.push({name:u.name,id:s.id,eventId:s.eventId,award:u.award,npc:u.npc,label:u.label,remainingTime:c,minuteSecond:c.getMinuteSecond()})}Game.dispatcher.dispatchEventWith(Game.EVENT.SyncEncounter),null!=e.expiredTimer&&egret.clearTimeout(e.expiredTimer),null!=r&&(e.expiredTimer=egret.setTimeout(l,null,1e3*r))}function l(){var t=[],n=e.events.length;if(0!=n){for(var i,a=0;n>a;a++){var r=e.events[a],o=r.remainingTime.delta;o>0&&(r.minuteSecond=r.remainingTime.getMinuteSecond(),t.push(r),(null==i||i>o)&&(i=o))}e.events=t,Game.dispatcher.dispatchEventWith(Game.EVENT.SyncEncounter),null!=e.expiredTimer&&egret.clearTimeout(e.expiredTimer),null!=i&&(e.expiredTimer=egret.setTimeout(l,null,1e3*i))}}function u(e,t){null==h&&(h=new UI.BossHUD,h.icon="ui/map/boss100.png"),h.maxLife=t,h.life=e}function c(){Scene.listenEnterMap(e.scene,t),Scene.listenLeaveMap(e.scene,n),Scene.listenBosslifeChange(e.scene,u),net.Register(187,s),net.Register(188,r),net.Register(190,i),net.Register(191,a)}var h,d;e.onEnterMap=t,e.onLeaveMap=n,e.quit=o,e.init=c,e.scene="enounter",e.show=!1}(Encounter||(Encounter={}));var EquipMake;!function(e){function t(e,t,n){var i=new net.def.C2SEquipMake;i.part=e,i.isPerfect=n,i.levelIndex=t,net.socket.write(216,i.toArrayBuffer())}function n(e){e.success||PopUpMessage.push(lang.String("EquipMakeFail_MakeFail"),color.RED),UI.EquipMaking.onMakeResult(e.success,e.equipId)}e.requestMake=t,e.onMakeResult=n}(EquipMake||(EquipMake={}));var EquipmentSet;!function(e){function t(e){for(var t=[],n=0,i=e;n<i.length;n++){for(var a=i[n],r=[],o=0,s=a.buffs;o<s.length;o++){var l=s[o];r.push(Buff.GetDesc(l[0],l.slice(1)))}t.push({set:a.set,fp:a.fp,buffs:r})}return t}function n(){for(var n=RES.getRes("public_config/equipmentsets.json"),i=0;i<Game.EquipPart.EquipCount;i++)e.equips[i]=egret.createMap();for(var a=0,r=n;a<r.length;a++){for(var o=r[a],s={id:o.id,name:o.name,quality:o.quality,equips:[],attributes:t(o.attributes)},l=0,u=o.equips;l<u.length;l++){var c=u[l],h=Item.EquipParsePart[c.part];e.equips[h][c.id]=s.id,s.equips.push({part:h,id:c.id})}e.infos[s.id]=s}}function i(){e.fp=0;for(var t={},n=0;n<Game.EquipPart.EquipCount;n++){var i=PlayerAttribute.Equips[n];if(i){var a=e.equips[i.Part][i.Id];a&&(t[a]=t[a]?t[a]+1:1)}}for(var a in t)for(var r=e.infos[a],o=t[a],s=0,l=r.attributes;s<l.length;s++){var u=l[s];u.set>o||(e.fp+=u.fp)}}function a(t,n,i){var a=e.equips[t][n];if(!a)return"";var r=e.infos[a];if(!r)return"";for(var o=[],s=egret.toColorString(Item.QualityColor[r.quality]),l=0,u=r.attributes;l<u.length;l++){var c=u[l];o.push(StringWithFormat("[{1}]{2}",c.set,c.buffs.join("\n")))}return"<font color='"+s+"'>"+o.join("\n")+"</font>"}function r(){var t=[];for(var n in e.infos){var i=e.infos[n];WorldLine.IsEquipSuitMakeOpen(i.equips[0].id)&&t.push({label:i.name,value:i.id,quality:i.quality})}return t}e.fp=0,e.infos=egret.createMap(),e.equips=[],e.onEquipChanged=i,e.GetDesc=a,e.GetNameListData=r,Game.RegisterLoader(n)}(EquipmentSet||(EquipmentSet={}));var EquipmentSetMaker;!function(e){function t(e){var t=new s;t.id=e.id,t.items=[];for(var n=0,i=e.material;n<i.length;n++){var a=i[n],o=a.content;switch(a.type){case"equip":t.equip=new r,t.equip.id=o.id,t.equip.part=Item.EquipParsePart[o.part],t.equip.klass=o["class"];break;case"item":var l=new table.ItemAward;l.type=a.type,l.content={genre:o.genre,detailType:o.detailType,count:o.count},l.obtainId=a.obtainId,t.items.push(l);break;default:t.coin={type:a.type,content:a.content}}}return t}function n(){var n=RES.getRes("public_config/equipmentset_maker.json");e.level=n.level;for(var i=0,a=n.groups;i<a.length;i++){var r=a[i],s=new o;s.product=r.product,s.name=r.name,s.formula=[];for(var l=Item.EquipParsePart[s.product.part],u=0,c=r.formula;u<c.length;u++){var h=c[u],d=t(h);s.formula.push(d),null==e.equips[l]&&(e.equips[l]={}),null==e.equips[l][s.product.id]&&(e.equips[l][s.product.id]={}),null==e.equips[l][s.product.id][d.equip.id]&&(e.equips[l][s.product.id][d.equip.id]={}),e.equips[l][s.product.id][d.equip.id][d.equip.klass]=s.formula.length-1}null==e.setting[l]&&(e.setting[l]={}),e.setting[l][s.product.id]=s}}function i(e,t,n){var i=new net.def.C2SMakeEquipmentSet;i.formula=e,i.part=t,i.itemId=n,net.socket.write(149,i.toArrayBuffer())}function a(t,n){for(var i,a=e.setting[t][n].formula,r=[],o=PlayerAttribute.Equips[t],s=0;s<a.length;s++){var l=a[s].equip.findEquips();r.push.apply(r,l),o&&o.Id==a[s].equip.id&&o.Klass==a[s].equip.klass&&(i=o)}return{wear:i,list:r}}var r=function(){function e(){}return e.prototype.findEquips=function(){var e=PlayerAttribute.bag.findEquip(this.part,this.id,this.klass);return e},e}();__reflect(r.prototype,"MaterialEquip");var o=function(){function e(){}return e}();__reflect(o.prototype,"Group");var s=function(){function e(){}return e}();__reflect(s.prototype,"Formula"),e.setting={},e.equips={},Game.RegisterLoader(n),e.make=i,e.findEquips=a}(EquipmentSetMaker||(EquipmentSetMaker={}));var FenglingBoat;!function(e){function t(t){e.times=t}function n(e){null!=m&&(m.second=e)}function i(e){null!=m&&(m.gate=e)}function a(){}function r(e){}function o(e,t){f=new UI.FenglingResult,f.currentState="succeed",f.setAwardlist(0,e,t,0),UIManager.pushPage(f)}function s(){Scene.handleIdle[y]=function(){return null},Scene.listenEnterMap(v,d),Scene.listenLeaveMap(v,p),Scene.listenEnterMap(y,l),Scene.listenLeaveMap(y,h)}function l(){UI.HUD.instance.showBattle(),null==m&&(m=new UI.ChallengeNote),m.currentState="ferry",m.second=5,UI.battle.addChild(m),m.btnExit.addEventListener(egret.TouchEvent.TOUCH_TAP,u,null)}function u(){var t=lang.String("operation confirm"),n=lang.StringWithFormat("fenglingdu confirm leave");UI.ConfirmBox.Show(UI.ConfirmBoxStyle["default"],t,n,e.onLeaveBoat,null,null)}function c(){return net.socket.write(141,null),!0}function h(){null!=m&&(UI.battle.removeChild(m),m.btnExit.removeEventListener(egret.TouchEvent.TOUCH_TAP,c,null),m=null),null!=f&&(UIManager.pop(f),f=null)}function d(){}function p(){}function g(){var e=PlayerAttribute.vipItem.level;return 3>e?lang.StringWithFormat("elevate vip{1} add {2} times",3,1):5>e?lang.StringWithFormat("elevate vip{1} add {2} times",5,1):8>e?lang.StringWithFormat("elevate vip{1} add {2} times",8,1):""}var m,f,v="ferryberth",y="ferryboat";e.LIMITLEVEL=25,e.MAXCHANCE=1,e.times=0,e.s2cJointimes=t,e.s2cSail=n,e.s2cBoatgate=i,e.onOpenFenglingBoat=a,e.s2cJoincount=r,e.s2cResult=o,e.load=s,e.onLeaveBoat=c,e.getVipHint=g}(FenglingBoat||(FenglingBoat={}));var flopaward;!function(e){function t(){net.Register(216,n),net.Register(217,i)}function n(t){var n=net.def.FlopAward.decode(t),i=n.name;e.flopData[i]={CountDown:n.value,CloseEnable:Math.max(n.value-r,0),Costs:n.items,Awards:{}},UIManager.push(new UI.FlopAwardUI(i))}function i(t){var n=net.def.FlopAward.decode(t),i=n.name,a=n.value;return null==n.items||0==n.items.length?void egret.error("flopaward name= "+i+" config no award"):void(null!=e.flopData[i]&&null!=e.flopData[i].Awards&&(e.flopData[i].Awards[a]=n.items,Game.dispatcher.dispatchEventWith(Game.EVENT.FlopAwardChange,!1,{name:i,index:a})))}function a(e){var t=new net.def.C2SCloseFlopAwardPage;t.pageName=e,net.socket.write(2111,t.toArrayBuffer())}var r=5;e.flopData={},e.load=t,Game.RegisterLoader(t),e.OnPageClose=a}(flopaward||(flopaward={}));var FortunePlan;!function(e){function t(){e.activity=new Activity.MissionActivity(Activity.ActivityKind.Activity_FortunePlan),e.activity.eventName=Game.EVENT.FortunePlanActivityOpen;var t=RES.getRes("public_config/operation/fortuneplan/fortuneplan.json");e.activity.profiles=t.profile,e.activity.initSelf=function(){e.dataInvestAwards=[];for(var t=e.activity.settings.displayawards,n=0;n<t.length;n++){var i=t[n],a=table.parseListAwards(i.award),r=null;i.bindcoinaward&&(r=table.parseListAwards(i.bindcoinaward)),e.dataInvestAwards.push({level:i.level,totalday:i.totalday,investcoin:i.investcoin,investbindcoin:i.investbindcoin,award:a,bindcoinaward:r})}t=e.activity.settings.displaysend;for(var n=0;n<t.length;n++){var i=t[n],a=table.parseListAwards(i.award),r=null;i.bindcoinaward&&(r=table.parseListAwards(i.bindcoinaward)),e.dataRefundAwards.push({level:i.level,totalday:i.totalday,investcoin:i.investcoin,investbindcoin:i.investbindcoin,award:a,bindcoinaward:r})}},badge.onLight(badge.action.FortunelPlanGold,!1),badge.onLight(badge.action.FortunelPlanSilver,!1),net.Register(363,i)}function n(t,n){if(e.state==e.FortunePlanState.State_Refund){var i=new net.def.C2SFortunePlanAwardOperation;return i.isbindcoin=n,i.level=t,void net.socket.write(283,i.toArrayBuffer())}var r=a(t,n),o="";n==h.BindCoin&&PlayerAttribute.currency[Game.Currency.SilverCoin]<r?o=lang.StringWithFormat("if replace {1} silver with gold",r-PlayerAttribute.currency[Game.Currency.SilverCoin]):n==h.Coin?o=lang.StringWithFormat("Make Sure {1} {2} FortunePlan set level{3}",r,lang.String("goldCoin"),t):n==h.BindCoin&&(o=lang.StringWithFormat("Make Sure {1} {2} FortunePlan set level{3}",r,lang.String("silverCoin"),t)),UI.ConfirmBox.Show(UI.ConfirmBoxStyle["default"],lang.String("operation confirm"),o,function(){var e=new net.def.C2SFortunePlanAwardOperation;return e.isbindcoin=n,e.level=t,net.socket.write(283,e.toArrayBuffer()),!0},null,null)}function i(t){var n=net.def.S2CSyncPlayerFortunePlanData.decode(t);if(e.state=n.state,e.day=n.day,e.coinlevel=n.coinLevel,e.bindcoinlevel=n.bindcoinLevel,e.awardflag=n.getawardflag,e.splitday=n.splitday,0==e.state)return badge.onLight(badge.action.FortunelPlanGold,!1),void badge.onLight(badge.action.FortunelPlanSilver,!1);if(e.state==c.State_Refund){var i=void 0,a=!1;if(e.coinlevel>0)for(var r=0;r<=e.dataRefundAwards[e.coinlevel-1].totalday;r++){var o=r+1,s=e.day;if(e.day>e.dataRefundAwards[e.coinlevel-1].totalday&&(s=e.dataRefundAwards[e.coinlevel-1].totalday),i=e.awardflag>>o-1&1,0==i&&s>=o){a=!0;break}}if(badge.onLight(badge.action.FortunelPlanGold,a),a=!1,e.bindcoinlevel>0)for(var r=0;r<=e.dataRefundAwards[e.bindcoinlevel-1].totalday;r++){var o=r+1;i=e.awardflag>>o+15&1;var s=e.day;if(e.day>e.dataRefundAwards[e.bindcoinlevel-1].totalday&&(s=e.dataRefundAwards[e.bindcoinlevel-1].totalday),0==i&&s>=o){a=!0;break}}badge.onLight(badge.action.FortunelPlanSilver,a)}Game.dispatcher.dispatchEventWith(Game.EVENT.FortunePlanDataChange)}function a(t,n){if(n==h.BindCoin&&(0==t||0==e.bindcoinlevel))return e.dataInvestAwards[t-1].investbindcoin;if(n==h.BindCoin){var i=e.dataInvestAwards[t-1].investbindcoin-e.dataInvestAwards[e.bindcoinlevel-1].investbindcoin;return i>0?i:e.dataInvestAwards[t-1].investbindcoin}if(n==h.Coin&&0==t||0==e.coinlevel)return e.dataInvestAwards[t-1].investcoin;if(n==h.Coin){var i=e.dataInvestAwards[t-1].investcoin-e.dataInvestAwards[e.coinlevel-1].investcoin;return i>0?i:e.dataInvestAwards[t-1].investcoin}}function r(t,n){return 0==t?0:n==h.BindCoin?e.dataInvestAwards[t-1].investbindcoin:e.dataInvestAwards[t-1].investcoin}function o(){net.socket.write(282,null)}function s(t,n){return null==t?0:n==h.BindCoin?e.awardflag>>t+15&1:n==h.Coin?e.awardflag>>t-1&1:void 0}function l(){for(var t=0,n=0;n<e.dataInvestAwards.length&&e.dataInvestAwards[n].bindcoinaward;n++)t++;return t}function u(){var t="",n=new Date(e.activity.taskActivity.startTime.getTime()+24*(e.splitday-1)*Game.Hour),i=n.getMonth()+1,a=n.getDate(),r=new Date(e.activity.taskActivity.startTime.getTime()+24*e.splitday*Game.Hour),o=r.getMonth()+1,s=r.getDate();return e.state==c.State_Invest?t=StringWithFormat('<font color="#429630">Thời gian gửi: </font><font color="#83BC73">ngày {2}-{1} đến {4}-{3}',e.activity.taskActivity.startTime.getMonth()+1,e.activity.taskActivity.startTime.getDate(),i,a):e.state==c.State_Refund&&(t=StringWithFormat('<font color="#429630">Thời gian nhận: </font><font color="#83BC73"> ngày {2}-{1} đên {4}-{3}</font>\n<font color="#429630">Mỗi ngày đang nhập kích hoạt số nhận 1 lần</font>',o,s,e.activity.taskActivity.endTime.getMonth()+1,e.activity.taskActivity.endTime.getDate())),t}var c;!function(e){e[e.State_Invest=1]="State_Invest",e[e.State_Refund=2]="State_Refund"}(c=e.FortunePlanState||(e.FortunePlanState={}));var h;!function(e){e[e.BindCoin=0]="BindCoin",e[e.Coin=1]="Coin"}(h=e.CoinType||(e.CoinType={})),e.dataInvestAwards=[],e.dataRefundAwards=[],e.load=t,e.AwardOperation=n,e.GetNeedCoin=a,e.GetLevelCoin=r,e.AskPlanerData=o,e.GetAwardState=s,e.GetBindAwardCount=l,e.GetActivityDateString=u}(FortunePlan||(FortunePlan={}));var Foursymbols;!function(e){function t(){e.setting=RES.getRes("public_config/foursymbols/foursymbols.json"),e.MaxFightingTime=e.setting.fightingTime+e.setting.overtime*e.setting.overtimeCount;for(var t=0,a=e.setting.palaces;t<a.length;t++){var d=a[t];e.palaces[d.id]=d;var p=RES.getRes(d.awardsFile);e.palaces[d.id].awardsClient=p}for(var f=RES.getRes("public_config/foursymbols/foursymbolsrank.json"),v=0;v<f.rankaward.length;v++)e.rankAwardList.push({rank:f.rankaward[v].rank,awards:table.parseListAwards(f.rankaward[v].award),count:f.rankaward[v].count});for(var y=RES.getRes("public_config/foursymbols/guangmingdingrank.json"),v=0;v<y.rankaward.length;v++)e.gmdrankAwardList.push({rank:y.rankaward[v].rank,awards:table.parseListAwards(y.rankaward[v].award),count:y.rankaward[v].count});Scene.listenEnterMap(L,m),Scene.listenLeaveMap(L,g),Scene.handleIdle[L]=n,net.Register(356,h),net.Register(355,o),net.Register(358,s),net.Register(357,u),net.Register(359,r),net.Register(2180,c),net.Register(360,i),net.Register(319,l)}function n(t){if(null==e.hud||e.hud.status!=k.StatusFighting)return null;var n=World.objectGroup.monster,i=n.getObjectCount();if(0>=i)return null;var a=~~(Math.random()*i),r=n.getObjectByIndex(a);return null==r?null:Scene.displayPos2LogicPos(new egret.Point(~~(r.x+r.width/2),~~(r.y+r.height/2)))}function i(t){var n=net.def.Value.decode(t);null!=e.hud&&e.hud.playTimeCost(n.Value)}function a(t){var n=e.palaces[t];return table.maps[n.mapId].name+"-"+n.name}function r(t){var n=net.def.S2CFoursymbolsSettlement.decode(t);switch(e.hud.status){case k.StatusSettlement:var i=new UI.FourSymbolsAwardUI;i.palaceName=e.hud.palace,i.phase=e.hud.phase+"/"+e.hud.totalPhase,i.restTime=e.setting.settlementTime,i.updateAwards(n.awards),UIManager.push(i);break;case k.StatusEnd:p(n.awards,n.win)}}function o(t){var n=net.def.S2CSyncFoursymbolsTask.decode(t);e.freeTimes=n.freeTimes,e.buyTimes=n.buyTimes,e.extendTimes=n.extendTimes,e.maxPalace=n.maxPalace,e.gmdBuyTimes=n.gmdBuyTimes,e.gmdFreeTimes=n.gmdFreeTimes,e.gmdExtendTimes=n.gmdExtendTimes,Game.dispatcher.dispatchEventWith(Game.EVENT.FoursymbolsSyncTask)}function s(e){var t=net.def.S2CSyncFoursymbolsRecord.decode(e);Game.dispatcher.dispatchEventWith(Game.EVENT.FoursymbolsSyncRecord,!1,t,!1)}function l(t){var n=net.def.S2CSyncFourSymbosFastest.decode(t),i=n.records.length;e.FastestRecords=[];for(var a=0;i>a;a++){var r=n.records[a];e.FastestRecords.push({name:r.name,cost:r.cost})}Game.dispatcher.dispatchEventWith(Game.EVENT.FoursymbolsSyncFastest)}function u(t){var n=net.def.S2CFoursymbolsRank.decode(t);e.RankCache.update(n),Game.dispatcher.dispatchEventWith(Game.EVENT.GeneralRankChange,!1,UI.RankKind.FoursymbolsRank,!1)}function c(t){var n=net.def.S2CFoursymbolsRank.decode(t);e.GMDRankCache.update(n),Game.dispatcher.dispatchEventWith(Game.EVENT.GeneralRankChange,!1,UI.RankKind.FoursymbolsRank,!1)}function h(t){if(WorldLine.IsOpen("FoursymbolsScene")){var n=net.def.S2CSyncFoursymbolsStatus.decode(t);if(e.overtimeCount=n.overtimeCount,null==e.hud){e.hud=new UI.FourSymbolsHUD;var i=e.palaces[n.palace];e.hud.totalPhase=i.rules.length,e.hud.palace=a(n.palace)}switch(e.hud.update(n.phase,n.status,n.timeCost,n.totalTime),e.hud.parent!=UI.battle&&UI.battle.addChild(e.hud),n.status){case k.StatusBuyOvertime:d(n.considerTime)}}}function d(e){null==R&&(R=new UI.FourSymbolBuyOverTime),R.timer=Math.ceil(e/Game.Second+1),UIManager.push(R)}function p(t,n){var i=new UI.FourSymbolsResult;i.palaceName=e.hud.palace,i.updateAwards(t),UIManager.push(i),i.play(n,e.hud.timeCost,e.hud.totalTime,e.hud.phase,e.hud.totalPhase)}function g(){null!=e.hud&&(Game.removeFromParent.apply(e.hud),e.hud.clearResourceReference(),e.hud=null),null!=R&&(Game.removeFromParent.apply(R),R=null)}function m(){}function f(t){var n=e.palaces[t];if(e.setting.levelLimit>PlayerAttribute.Level)return void PopUpMessage.push(lang.StringWithFormat("open on level {1}",e.setting.levelLimit),color.RED);if(t>e.maxPalace+1)return void PopUpMessage.push(StringWithFormat("{1} chưa mở, không thể khiêu chiến!",n.name),color.RED);if(t>=24){if(e.gmdFreeTimes+e.gmdExtendTimes<=0)return void PopUpMessage.push("Hết lượt khiêu chiến!",color.RED)}else if(e.freeTimes+e.extendTimes<=0)return void PopUpMessage.push("Hết lượt khiêu chiến!",color.RED);var i=n.attribute,a=Wuxingyinmanager.GetAllDungeonAttributsDesc(i);if(n.attack>0&&a[0].value<n.attack)return void PopUpMessage.push(StringWithFormat("{1} chưa đạt điều kiện!",a[0].key),color.RED);
if(n.defense>0&&a[1].value<n.defense)return void PopUpMessage.push(StringWithFormat("{1} chưa đạt điều kiện!",a[1].key),color.RED);var r=new net.def.Index;r.index=t,net.socket.write(126,r.toArrayBuffer())}function v(t){var n=e.palaces[t],i=n.attribute,a=Wuxingyinmanager.GetAllDungeonAttributsDesc(i);return a[0].value<n.attack?!1:a[1].value<n.defense?!1:!0}function y(){for(var t=Clamp(e.maxPalace+1,1,24),n=t;n>0;n--)if(v(n))return n;return 1}function b(){for(var t=Clamp(e.maxPalace+1,25,50),n=t;n>0;n--)if(v(n))return n;return 1}function S(){World.scene==L&&net.socket.write(130,null)}function E(){if(World.scene==L)switch(e.hud.status){case k.StatusEnd:net.socket.write(130,null);break;default:net.socket.write(141,null)}}function C(){net.socket.write(127,null)}function T(t){if(e.buyTimes<=0||e.buyTimes<t)return PopUpMessage.push("Số lần không đủ",color.RED),!1;var n=PlayerAttribute.bag.CalcCount(e.setting.item.genre,e.setting.item.detailType),i=t*e.setting.item.count;if(i>n)return UI.ResourceObtain.Open([UI.ObtResId.foursymbolsKey]),!1;var a=new net.def.Value;return a.Value=t,net.socket.write(128,a.toArrayBuffer()),!0}function I(t){if(e.gmdBuyTimes<=0||e.gmdBuyTimes<t)return PopUpMessage.push("Số lần không đủ",color.RED),!1;var n=PlayerAttribute.bag.CalcCount(e.setting.gmditem.genre,e.setting.gmditem.detailType),i=t*e.setting.gmditem.count;if(i>n)return UI.ResourceObtain.Open([UI.ObtResId.guangmingdingKey]),!1;var a=new net.def.Value;return a.Value=t,net.socket.write(2212,a.toArrayBuffer()),!0}function G(e){1==e?net.socket.write(129,null):2==e&&net.socket.write(2213,null)}function A(){var e=Game.getServerDate().getTime();null==this.lastUpdateTime&&(this.lastUpdateTime=0);var t=e-this.lastUpdateTime;t<=Leaderboard.CACHE_TIME||(net.socket.write(134,null),this.lastUpdateTime=e)}var k;!function(e){e[e.StatusBegin=0]="StatusBegin",e[e.StatusPreparing=1]="StatusPreparing",e[e.StatusFighting=2]="StatusFighting",e[e.StatusBuyOvertime=3]="StatusBuyOvertime",e[e.StatusSettlement=4]="StatusSettlement",e[e.StatusEnd=5]="StatusEnd",e[e.StatusClosing=6]="StatusClosing"}(k=e.Status||(e.Status={}));var P=function(){function e(){}return e.prototype.viewPlayerDetail=function(e){if(e!=Player.instance.Name){var t=new UI.ChatPlayerDsc;UIManager.pushNoTween(t),friend.search(e)}},e}();__reflect(P.prototype,"RankItem",["Leaderboard.Item"]);var w=function(){function e(e){this.hasData=!1,this.type=e}return e.prototype.requestServerData=function(){var e=Game.getServerDate().getTime();null==this.lastUpdateTime&&(this.lastUpdateTime=0);var t=e-this.lastUpdateTime;t<=Leaderboard.CACHE_TIME||(G(this.type),this.lastUpdateTime=e)},e.prototype.update=function(e){this.hasData=!0,this.selfValue=FormatMMSS(e.cost),this.selfRank=e.rank,this.items=[];for(var t=e.ranks.length,n=0;t>n;n++){var i=e.ranks[n],r=new P;r.name=i.name,r.value=FormatMMSS(i.cost*Game.Second),r.vipLv=i.vip,r.faction=i.faction,r.rank=n+1,r.txtRank=a(i.palace),0!=n?this.items.push(r):this.firstRankItem=r}this.lastUpdateTime=Game.getServerDate().getTime()},e}();e.Rank=w,__reflect(w.prototype,"Foursymbols.Rank",["Leaderboard.Data"]),e.RankCache=new w(1),e.GMDRankCache=new w(2),e.FastestRecords=[],e.overtimeCount=0;var L="foursymbols";e.buyTimes=0,e.freeTimes=0,e.extendTimes=0,e.maxPalace=0,e.gmdBuyTimes=0,e.gmdFreeTimes=0,e.gmdExtendTimes=0,e.palaces=egret.createMap(),e.rankAwardList=[],e.gmdrankAwardList=[],e.init=t,e.getFullPalaceName=a;var R;e.openFinalResult=p,e.apply=f,e.checkPalaceCondition=v,e.findMaxPalace=y,e.findMaxGuangMingDing=b,e.skip=S,e.quit=E,e.buyOvertime=C,e.buy=T,e.buyGuangMingDing=I,e.applyRank=G,e.applyFastest=A,Game.RegisterLoader(t)}(Foursymbols||(Foursymbols={}));var guide;!function(e){function t(t,n,i,a,r){e.dispatcher.addEventListener(S[t],n,i,a,r)}function n(t,n,i,a){e.dispatcher.removeEventListener(S[t],n,i,a)}function i(t){(null==e.moviehandle||e.moviehandle.weight<t.weight)&&(e.moviehandle=t)}function a(t){if(!Game.isCrossServer()){var n=net.def.S2CSyncGuideTask.decode(t);e.info=e.config.tasks[n.id];var i;if(null==e.task?e.task={id:n.id,kind:e.info.kind,value:n.value}:(i=e.task.id,e.task.id=n.id,e.task.kind=e.info.kind,e.task.value=n.value),i!=e.task.id&&null!=e.info.story&&!c()){var a=new UI.PrologueDialogue;a.dialogue=Game.TextParser.parse(e.info.story.dialogue),a.answer=Game.TextParser.parse(e.info.story.option),UIManager.push(a),a.setTimer(2e3),a.handle=function(){d(),UIManager.pop(a)}}e.moviehandle=null,e.info.operation==S.GuideArenaShop&&(c()?ArenaShop.specialGoods=null:ArenaShop.specialGoods=o(),Game.dispatcher.dispatchEventWith(Game.EVENT.SyncArenaGoods)),e.info.operation==S.MysteryShop&&(c()?MysteryShop.specialGoods=null:MysteryShop.specialGoods=s(),Game.dispatcher.dispatchEventWith(Game.EVENT.SyncMysteryGoods)),r(),egret.callLater(g,null)}}function r(){e.info&&e.info.kind>0?(e.ui||(e.ui=new UI.GuideTask),UI.battle&&UI.battle.guideGroup&&e.ui.parent!=UI.battle.guideGroup&&UI.battle.guideGroup.addChild(e.ui),e.ui.parent&&egret.callLater(e.ui.onSyncGuideTask,e.ui)):e.ui&&Game.removeFromParent.apply(e.ui)}function o(){var e=new Shop.PropGoods;return e.count=20,e.genre=8,e.detailType=6,e.price=0,e.currency=Game.Currency.Arena,e.discount=100,e.buy=l,e.guide=!0,e}function s(){var e=new Shop.EquipGoods;return e.quality=4,e.part=Game.EquipPart.EquipBoot,e.level=9,e.id=1,e.price=0,e.currency=Game.Currency.CopperCoin,e.discount=100,e.buy=l,e.guide=!0,e}function l(t,n){if(!c()){null!=e.movieClip&&Game.removeFromParent.apply(e.movieClip);var i=new net.def.C2SCompleteGuideTask;i.id=e.task.kind,net.socket.write(28,i.toArrayBuffer())}return!1}function u(){if(null!=e.info.desc)return e.info.desc;var t=e.task.value>e.info.target?e.info.target:e.task.value;return StringWithFormat(e.config.types[e.info.kind].desc,e.info.target,t)}function c(){return e.task.value>=e.info.target}function h(){null!=e.info.next&&0==e.config.tasks[e.info.next].kind&&UIManager.pushPage(new UI.MissionSlogan("end")),net.socket.write(69,null)}function d(){return c()?(h(),!0):null!=e.info.operation?(e.handle[e.info.operation](),!0):!1}function p(){E=null,null!=e.task&&e.task.id>=97&&!c()||g()}function g(){null!=E&&egret.clearTimeout(E),0==e.info.kind?null!=e.movieClip&&(Game.removeFromParent.apply(e.movieClip),e.movieClip.free(),e.movieClip=null):c()?(E=egret.setTimeout(p,null,2e4),Game.dispatcher.dispatchEventWith(Game.EVENT.GuideCompleted),null!=e.moviehandle&&(e.moviehandle.handle(),e.moviehandle=null)):null!=e.info.operation?(E=egret.setTimeout(p,null,2e4),Game.dispatcher.dispatchEventWith(Game.EVENT.GuideReminder),e.dispatcher.dispatchEventWith(S[e.info.operation]),null!=e.moviehandle&&(e.moviehandle.handle(),e.moviehandle=null)):null!=e.movieClip&&Game.removeFromParent.apply(e.movieClip)}function m(){null!=E&&egret.clearTimeout(E),E=egret.setTimeout(p,null,200)}function f(){for(var t=RES.getRes("public_config/guide.json"),n=t.types,i={},r=0;r<t.tasks.length;r++){var o=t.tasks[r];i[o.id]=o}e.config={types:n,tasks:i},net.Register(14,a),e.handle[S.GuideEquip]=UIManager.openPlayerUI,e.handle[S.GuideSkill]=UIManager.openSkillUI,e.handle[S.GuideAbility]=UIManager.openPlayerUI,e.handle[S.GuideSell]=UIManager.openEquipBag,e.handle[S.GuideTaohuaIslandPlant]=TaohuaIsland.onOpenTaohuaIsland,e.handle[S.GuideTaohuaIslandRob]=TaohuaIsland.onOpenTaohuaIsland,e.handle[S.GuideEnhancement]=UIManager.openEnhancement,e.handle[S.GuideMasterChallenge]=MasterChallenge.openChallenge,e.handle[S.GuideMeridian]=UIManager.openMeridian,e.handle[S.GuideArena]=ArenaChallenge.onOpenArena,e.handle[S.MysteryShop]=UIManager.openMysteryShop,e.handle[S.GuideArenaShop]=UIManager.openArenaShop,e.handle[S.GuideComposePartner]=UIManager.openPartnerUI,e.handle[S.GuideRecruitPartner]=function(){UIManager.openGoldPetEnlist()},e.handle[S.GuideMountPartner]=UIManager.openPartnerUI,e.handle[S.GuideLevelUpPartner]=UIManager.openPartnerUI,e.handle[S.GuideResetPartner]=UIManager.openPartnerUI,e.handle[S.GuideBreakThoughtPartner]=UIManager.openPartnerUI,e.handle[S.CraftBook]=UIManager.openBookUI,e.handle[S.GuideLevelUpBook]=UIManager.openBookUI,e.handle[S.OpenWorldMap]=function(){return Game.isWildMap()?void UIManager.pushPage(UI.MapCabinet.instance):void PopUpMessage.push(lang.String("can not escape"),color.RED)},e.handle[S.SevenGift]=function(){UI.WelfareHall.open(),UI.WelfareHall.instance.ShowSevenGift()},e.handle[S.LevelUpFactionTitle]=UIManager.openPlayerUI,e.handle[S.GuideHuashanPK]=HuashanPK.OpenHuashanPK,e.handle[S.GuideSeasunVillage]=function(){UIManager.pushPage(new UI.SeaSunEntrance)},e.handle[S.MasterChallengeSign]=MasterChallenge.signChallenge;var s=function(){e.completed()||UI.battle.playGuideMovie(e.info.operation)},l=function(){switch(e.info.operation){case e.GuideOperation.GuideCatchThief:case e.GuideOperation.GuideFengLingDu:return void UI.openWanderingsUI(2)}};e.handle[S.GuideCatchThief]=l,e.handle[S.GuideFengLingDu]=l,e.handle[S.GuideSongJin]=UIManager.openSongJin,e.handle[S.AutoGemUpgrade]=UIManager.openGem,e.handle[S.AutoGemMount]=UIManager.openGem,e.handle[S.TenfoldGain]=s,e.handle[S.GuideGuild]=UIManager.openGuild,e.handle[S.WanderingsEntrance]=function(){var e=DungeonHallMgr.getDungeonCond_LeftTimes(DungeonHallMgr.DungeonTarget_FerryBoat);e>0?UI.openWanderingsUI(2):UI.openWanderingsUI(0)},e.handle[S.HuaShanPK]=HuashanPK.OpenHuashanPK,e.handle[S.YesouKillAnyNpc]=function(){Game.isCityHome()&&CityHome.c2s_leave()}}function v(){return null==e.movieClip&&(e.movieClip=new UI.MovieClipComponent,e.movieClip.contentJustify=!1,e.movieClip.justify=!1,e.movieClip.position="TL",e.movieClip.width=2,e.movieClip.height=2,e.movieClip.horizontalCenter=0,e.movieClip.verticalCenter=0,e.movieClip.removeWhenComplete=!1,e.movieClip.Load("skill/Ui_guide/Ui_guide.json","Ui_guide")),e.movieClip}function y(t){var n=v(),i=n.parent;i!=t&&(null!=i&&i.removeChild(e.movieClip),t.addChild(n)),n.visible=!0,n.play(20)}function b(t){null!=e.movieClip&&t==e.movieClip.parent&&t.removeChild(e.movieClip)}var S;!function(e){e[e.GuideEquip=1]="GuideEquip",e[e.GuideSkill=2]="GuideSkill",e[e.GuideAbility=3]="GuideAbility",e[e.GuideSell=4]="GuideSell",e[e.GuideTaohuaIslandPlant=5]="GuideTaohuaIslandPlant",e[e.GuideTaohuaIslandRob=6]="GuideTaohuaIslandRob",e[e.GuideEnhancement=7]="GuideEnhancement",e[e.Reserved=8]="Reserved",e[e.GuideMasterChallenge=9]="GuideMasterChallenge",e[e.GuideMeridian=10]="GuideMeridian",e[e.GuideArena=11]="GuideArena",e[e.MysteryShop=12]="MysteryShop",e[e.GuideArenaShop=13]="GuideArenaShop",e[e.GuideComposePartner=14]="GuideComposePartner",e[e.GuideRecruitPartner=15]="GuideRecruitPartner",e[e.GuideMountPartner=16]="GuideMountPartner",e[e.GuideLevelUpPartner=17]="GuideLevelUpPartner",e[e.GuideResetPartner=18]="GuideResetPartner",e[e.GuideBreakThoughtPartner=19]="GuideBreakThoughtPartner",e[e.CraftBook=20]="CraftBook",e[e.GuideLevelUpBook=21]="GuideLevelUpBook",e[e.OpenWorldMap=22]="OpenWorldMap",e[e.LevelUpFactionTitle=24]="LevelUpFactionTitle",e[e.GuideHuashanPK=25]="GuideHuashanPK",e[e.GuideSeasunVillage=26]="GuideSeasunVillage",e[e.GuideCatchThief=27]="GuideCatchThief",e[e.GuideFengLingDu=28]="GuideFengLingDu",e[e.GuideSongJin=29]="GuideSongJin",e[e.AutoGemUpgrade=30]="AutoGemUpgrade",e[e.TenfoldGain=31]="TenfoldGain",e[e.GuideGuild=32]="GuideGuild",e[e.MasterChallengeSign=33]="MasterChallengeSign",e[e.WanderingsEntrance=34]="WanderingsEntrance",e[e.HuaShanPK=35]="HuaShanPK",e[e.SevenGift=36]="SevenGift",e[e.AutoGemMount=42]="AutoGemMount",e[e.YesouKillAnyNpc=44]="YesouKillAnyNpc"}(S=e.GuideOperation||(e.GuideOperation={})),e.handle={};var E;e.dispatcher=new egret.EventDispatcher,e.addEventListener=t,e.removeEventListener=n,e.pushMovie=i,e.updateUI=r,e.makeArenaGoods=o,e.makeMysteryGoods=s,e.complete=l,e.desc=u,e.completed=c,e.onTouchTap=d,e.notify=g,e.delayNotify=m,e.init=f,e.AddMovieClip=y,e.removeMovieClip=b}(guide||(guide={}));var GuildArmament;!function(e){function t(){e.armsLevelConfigs=RES.getRes("public_config/guildarmament/armlevelconfig.json"),e.armsRobConfigs=RES.getRes("public_config/guildarmament/armrobconfig.json"),e.armsTypeConfigs=RES.getRes("public_config/guildarmament/armtypeconfig.json"),e.cityConfigs=RES.getRes("public_config/guildarmament/cityconfig.json"),e.stateConfigs=RES.getRes("public_config/guildarmament/stateconfig.json"),e.armsBuffConfigs=RES.getRes("public_config/guildarmament/armbuffconfig.json"),e.convoySetting=RES.getRes("public_config/guildarmament/convoysetting.json"),e.armsSetting=RES.getRes("public_config/guildarmament/armsetting.json")}function n(){for(var e=0;e!=B.length;e++)Scene.listenEnterMap(B[e],i),Scene.listenLeaveMap(B[e],a);Scene.listenEnterMap(W,r),Scene.listenLeaveMap(W,o),Scene.handleIdle[W]=function(){return null}}function i(){V=new UI.ChallengeNote,UI.battle.addChild(V),V.currentState="guildarmament",V.score1=0,V.score2=0,V.btnExit.addEventListener(egret.TouchEvent.TOUCH_TAP,s,null)}function a(){null!=V&&(UI.battle.removeChild(V),V=null)}function r(){net.socket.write(2045,null)}function o(){null!=q&&(UI.battle.removeChild(q),q=null)}function s(){var e=lang.String("operation confirm"),t=lang.StringWithFormat("armament leave scene confirm msg");UI.ConfirmBox.Show(UI.ConfirmBoxStyle.team,e,t,function(){return net.socket.write(141,null),!0},null,null)}function l(e,t){var n=new net.def.C2SArmamentWorldIndex;n.setCityId(e),n.setWorldIndex(t),net.socket.write(2029,n.toArrayBuffer())}function u(e,t){var n=new net.def.C2SArmamentWorldIndex;n.setCityId(e),n.setWorldIndex(t),net.socket.write(2031,n.toArrayBuffer())}function c(e){var t=new net.def.Index;t.setIndex(e),net.socket.write(2030,t.toArrayBuffer())}function h(){net.socket.write(2032,null)}function d(t){e.armsInfo=t.getInfos(),Game.dispatcher.dispatchEventWith(Game.EVENT.GuildArmamentSyncArmsInfo)}function p(t,n){e.myScore=t,e.guildScore=n,Game.dispatcher.dispatchEventWith(Game.EVENT.GuildArmamentSyncScoreInfo);for(var i=!1,a=0;a!=t.length;a++){var r=y(a);if(t[a]>0&&t[a]>=r.changeRate){i=!0;break}}badge.onLight(badge.action.GuildArmamentChangeAward,i)}function g(t){e.todayCollectTimes=t.getCollectTimes(),e.todayRobTimes=t.getRobTimes(),Game.dispatcher.dispatchEventWith(Game.EVENT.GuildArmamentSyncPlayerInfo)}function m(){var e=Game.eraDay+1;return 7>e?!1:(e+1)%7==0?!1:!0}function f(t){var n=v(t);if(null==n)return null;for(var i=0;i!=e.armsLevelConfigs.length;i++)if(e.armsLevelConfigs[i].level==n.level)return e.armsLevelConfigs[i];return null}function v(t){for(var n=0;n!=e.cityConfigs.length;n++)if(e.cityConfigs[n].id==t)return e.cityConfigs[n];return null}function y(t){for(var n=0;n!=e.armsTypeConfigs.length;n++)if(e.armsTypeConfigs[n].armsType==t)return e.armsTypeConfigs[n];return null}function b(e){var t=[],n=v(e);if(null==n)return t;for(var i=0;i!=n.arms.length;i++)for(var a=n.arms[i],r=0;r!=a;r++){var o=y(i);null!=o&&t.push(o.scoreItem)}return t}function S(t){for(var n=0;n!=e.armsBuffConfigs.length;n++)if(e.armsBuffConfigs[n].buffId==t)return e.armsBuffConfigs[n];return null}function E(t){for(var n=0;n!=e.armsBuffConfigs.length;n++)if(e.armsBuffConfigs[n].armsType==t)return e.armsBuffConfigs[n];return null}function C(t){var n=E(t);if(null==n)return null;for(var i=e.guildScore[t],a=0,r=n.needScore.length-1,o=0;o!=n.needScore.length&&!(i<=n.needScore[o]);o++)a=o;var s=a>=r?r:a+1,l=n.needScore[a],u=n.needScore[s],c={curLevel:a,curLevelScore:l,nextLevel:s,nextLevelScore:u};return c}function T(){net.socket.write(2033,null)}function I(e){var t=new net.def.Index;t.setIndex(e),net.socket.write(2034,t.toArrayBuffer())}function G(){net.socket.write(2035,null)}function A(e){this.robHistory=e,null==UI.GuildArmamentRobHistory.instance.parent?UIManager.push(UI.GuildArmamentRobHistory.instance):Game.dispatcher.dispatchEventWith(Game.EVENT.GuildArmamentSyncRobHistory)}function k(e){null!=V&&(V.score2=e)}function P(e){null!=V&&(V.score1=e)}function w(t){e.effectiveBuffs=t,Game.dispatcher.dispatchEventWith(Game.EVENT.GuildArmamentSyncEffectiveBuffs)}function L(){net.socket.write(2038,null)}function R(e){var t=S(e),n=_(e);if(null==t||null==n||n.getLevel()<=0)return"";var i=t.tips.replace(/{(\d+)}/g,function(e,t){return String(n.getArg())}),a=lang.StringWithFormat("armament buff last time {1} seconds",t.buffTime[n.getLevel()]);return i+"\n\n"+a}function U(e,t){var n=E(e),i=n.tips,a=n.args[t],r=i.replace(/{(\d+)}/g,function(e,t){return String(a)});return r}function _(t){for(var n=0;n!=e.effectiveBuffs.length;n++)if(e.effectiveBuffs[n].getBuffId()==t)return e.effectiveBuffs[n];return null}function x(t){e.cityState=t,Game.dispatcher.dispatchEventWith(Game.EVENT.GuildArmamentSyncCityState)}function M(e){var t=new net.def.Index;t.setIndex(e),net.socket.write(2040,t.toArrayBuffer())}function D(e){var t=new net.def.Index;t.setIndex(e),net.socket.write(2042,t.toArrayBuffer())}function N(e){var t=new net.def.Index;t.setIndex(e),net.socket.write(2043,t.toArrayBuffer())}function F(t){e.convoySceneInfo=t,null==q&&(q=new UI.GuildArmamentConvoyNote,UI.battle.addChild(q)),q.convoyStage=e.convoySceneInfo.getStage(),q.second=e.convoySceneInfo.getStageLeftTime(),q.setProtectBoxNum(t.getProtectBoxNum()),q.setCamp(t.getCamp()),q.setKillStreak(t.getKillStreak())}function O(t){var n=[];t.getAwardNum()>0&&n.push({type:"item",content:{genre:e.convoySetting.convoyBoxGenre,detailType:e.convoySetting.convoyBoxDetail,count:t.getAwardNum()}}),t.getProtectBoxNum()>0&&n.push({type:"item",content:{genre:e.convoySetting.protectBoxGenre,detailType:e.convoySetting.protectBoxDetail,count:t.getProtectBoxNum()}});var i=new UI.GuildArmamentConvoyResult;i.currentState=t.getWin()?"succeed":"fail",i.dataList.replaceAll(n),UIManager.pushPage(i)}e.armsLevelConfigs=[],e.armsRobConfigs=[],e.armsTypeConfigs=[],e.cityConfigs=[],e.stateConfigs=[],e.armsBuffConfigs=[],e.convoySetting=null,e.armsSetting=null,e.myScore=[],e.guildScore=[],e.armsInfo=[],e.robHistory=[],e.effectiveBuffs=[];var B=["tiekuang","nongchang","shikuang","yiguan"],W="convoy";e.STATE_NONE=0,e.STATE_COLLECT=1,e.STATE_CONVOY=2,e.CONVOY_STAGE_PREPARE=1,e.CONVOY_STAGE_PK=2,e.CONVOY_STAGE_END=3,e.CONVOY_CAMP_PROTECTOR=0,e.CONVOY_CAMP_ROBBER=1,e.CONVOY_CAMP_MONSTER=2;var V,q;e.cityState=null,e.convoySceneInfo=null,e.todayCollectTimes=0,e.todayRobTimes=0,e.LoadRes=t,e.load=n,e.enterWorld=l,e.beginCollect=u,e.applyArmsInfo=c,e.endCollect=h,e.onSyncArmsInfo=d,e.onSyncScoreInfo=p,e.onSyncPlayerInfo=g,e.isOpen=m,e.getArmsLevelConfig=f,e.getCityConfig=v,e.getArmsTypeConfig=y,e.getCityScoreItems=b,e.getBuffConfigByBuffId=S,e.getBuffConfigByArmsType=E,e.getBuffLevelInfo=C,e.applyPlayerInfo=T,e.changeAward=I,e.applyRobHistory=G,e.onSyncRobHistory=A,e.onSyncScenePlayerScore=k,e.onSyncSceneGuildScore=P,e.onSyncEffecttiveBuffs=w,e.applyEffectiveBuffs=L,e.getBuffTips=R,e.getBuffTips2=U,e.getBuffInfo=_,e.onSyncCityState=x,e.applyCityState=M,e.openConvoy=D,e.enterConvoy=N,e.onSyncConvoySceneInfo=F,e.onSyncConvoyResult=O}(GuildArmament||(GuildArmament={}));var GuildDonateMgr;!function(e){function t(){net.socket.write(2019,null)}function n(e,t){l=e,u=t,UI.GuildDonate.instance&&UI.GuildDonate.instance.UpdateDonateState(),UI.GuildDonateGoldCoin.instance&&UI.GuildDonateGoldCoin.instance.UpdateCountState(),UI.GuildDonateSilverCoin.instance&&UI.GuildDonateSilverCoin.instance.UpdateCountState()}function i(){return l}function a(){return u}function r(){return table.mapVipDonateCount?table.mapVipDonateCount[PlayerAttribute.vipItem.getActivatedLevel()]:null}function o(){var e=r();return e?e.goldCount-l+"/"+e.goldCount:""}function s(){var e=r();return e?e.silverCount-u+"/"+e.silverCount:""}var l=0,u=0;e.RequestDonatedCount=t,e.UpdateDonatedCount=n,e.GetGoldDonatedCount=i,e.GetSilverDonatedCount=a,e.GetVipDonateCountMax=r,e.GetGoldDonateStateString=o,e.GetSilverDonateStateString=s}(GuildDonateMgr||(GuildDonateMgr={}));var GuildDungeon;!function(e){function t(){Scene.handleIdle[v]=h,Scene.listenEnterMap(v,n),Scene.listenLeaveMap(v,i),e.awardsConfig=RES.getRes("config/scenes/guildDungeon.json")}function n(){null==y&&(y=new UI.ChallengeNote),y.currentState=v,UI.battle.addChild(y),y.btnExit.addEventListener(egret.TouchEvent.TOUCH_TAP,a,null)}function i(){null!=y&&(UI.battle.removeChild(y),y.btnExit.removeEventListener(egret.TouchEvent.TOUCH_TAP,a,null),y=null),Game.dispatcher.dispatchEventWith(Game.EVENT.LeaveScene)}function a(){var t=lang.String("operation confirm"),n=lang.StringWithFormat("gd confirm to leave?");UI.ConfirmBox.Show(UI.ConfirmBoxStyle["default"],t,n,e.tryLeaveScene,null,null)}function r(){return net.socket.write(141,null),!0}function o(e,t,n){null!=y&&(y.textDifficultLevel=e,y.remainingTime.delta=t,null!=n&&(y.playerNumber=n))}function s(){e.open?badge.onLight(badge.action.GuildDungeonOpen,!0):badge.onLight(badge.action.GuildDungeonOpen,!1)}function l(t){e.open=t.open,e.runningLevel=t.runningLevel,s(),o(e.DungeonLevelName[e.runningLevel],t.runningRemainTime,t.playerNumber)}function u(t){e.currentMaxDungeonLevel=t.currentMaxLevel,e.open=t.open,e.openByWhom=t.runningByWhom,e.runningLevel=t.runningLevel,e.randomBossPos=t.randPos,e.dailyAwarded=t.todayAwardTimes,s(),1==e.open&&World.wild&&PlayerAttribute.Level>=e.needPlayerLevel&&m(1,"Vào phó bản"),UI.GuildDungeonPage.instance.loaded&&UI.GuildDungeonPage.instance.UpdatePage(),e.lastSyncTime=Game.getServerDate()}function c(t){o(e.DungeonLevelName[e.runningLevel],0),0==t&&(UI.GuildDungeonResult.instance.show([],[],0),UIManager.pushPage(UI.GuildDungeonResult.instance))}function h(e){return null}function d(t){var n=PlayerAttribute.bag.CalcCount(14,2020);return n<e.itemCost?void PopUpMessage.push("Vé Khiêu Chiến không đủ, không thể mở phó bản!",color.RED):void UI.ConfirmBox.Show(UI.ConfirmBoxStyle["default"],"Thiên Bảo Khố","Dùng 1 Vé Thiên Bảo Khố để mở phó bản Thiên Bảo Khố",function(){var e=new net.def.C2SReqOpenGuildDungeon;return e.dungeonLevel=t,net.socket.write(2082,e.toArrayBuffer()),!0},function(){return!0},function(){return!0})}function p(){var e=new net.def.C2SReqOpenGuildDungeon;net.socket.write(2082,e.toArrayBuffer())}function g(t){return null==Guild.guildInfo?void PopUpMessage.push(lang.String("no guild"),color.RED):PlayerAttribute.Level<e.needPlayerLevel?void PopUpMessage.push("Chưa đạt Lv50, không thể vào phó bản!",color.RED):1!=e.open||null!=t&&0!=t?void UIManager.pushPage(UI.GuildDungeonPage.instance):void p()}function m(e,t){Reminder.PushReminder(Reminder.EventName.GuildDungeon,e*Game.Minute,t)}function f(e){for(var t=[],n=[],i=0;i<e.normal.length;i++){var a=table.parseAward(e.normal[i]);t.push(a)}for(var i=0;i<e.owner.length;i++){var a=table.parseAward(e.owner[i]);n.push(a)}UI.GuildDungeonResult.instance.show(t,n,1),UIManager.pushPage(UI.GuildDungeonResult.instance)}e.randomList=[[3,4,2,1],[2,4,3,1],[4,3,1,2],[1,4,2,3],[2,1,3,4],[2,4,1,3],[2,3,1,4],[1,2,4,3],[1,3,4,2],[4,1,3,2],[3,2,1,4],[3,1,2,4],[3,2,4,1],[2,3,4,1],[4,2,3,1],[4,2,1,3],[4,3,2,1],[4,1,2,3],[3,4,1,2],[1,3,2,4],[2,1,4,3],[1,4,3,2],[1,2,3,4],[3,1,4,2]],e.szMysteryLead=["Thanh Long","Bạch Hổ","Chu Tước","Huyền Vũ"],e.DungeonLevelName=["Thường","Mạo Hiểm","Khó"],e.itemCost=1,e.needPlayerLevel=50,e.MaxDailyAward=25;var v="guilddungeon";e.currentMaxDungeonLevel=0,e.randomBossPos=0,e.dailyAwarded=0,e.open=!1,e.openByWhom="",e.runningLevel=0,e.load=t;var y;e.tryLeaveScene=r,e.UpdateRunningInfo=l,e.UpdateSceneInfo=u,e.OnSyncGuildDungeonResult=c,e.OpenDungeon=d,e.JoinDungeon=p,e.Hotkey2Open=g,e.showReminder=m,e.OnSyncGuildDungeonNormalAward=f}(GuildDungeon||(GuildDungeon={}));var GuildShopCore;!function(e){function t(e,t,n){var i=s(e,t);if(null==i)return!0;if(PlayerAttribute.currency[Game.Currency.GuildContribution]<i.price*n)return UI.ResourceObtain.Open([UI.ObtResId.guildcontribute]),PopUpMessage.push(lang.String("guild money not enough"),color.RED),!0;var a=new net.def.C2SGuildShopBuy;return a.setShopId(e),a.setPos(t),a.setId(t+1),a.setCount(n),net.socket.write(2016,a.toArrayBuffer()),!1}function n(t,n){if(t>=0&&t<e.taskValue.length){var i=e.taskValue[t];if(n>=0&&n<i.length)return i[n]}return-1}function i(e,t){var i=s(e,t);return null!=i?i.stockNum>0?i.stockNum-n(e,i.resetId-1):Shop.MaxLeftStack:-1}function a(e,n){var i=n;return t(i.shopId,e,1)}function r(e){if(e>=0&&e<table.guildShop.length){var t=table.guildShop[e];return t}return null}function o(e){if(e>=0&&e<table.guildShop.length){for(var t=table.guildShop[e],n=[],r=0;r<t.length;r++){var o=new Shop.PropGoods,s=t[r];o.price=s.price,o.currency=Game.Currency.GuildContribution,o.pos=r,o.discount=100,o.genre=s.content.genre,o.detailType=s.content.detailType,o.count=s.content.count,o.param={shopId:e,discountIcon:s.discountIcon,leftStock:i(e,r),money:PlayerAttribute.currency[Game.Currency.GuildContribution]},o.buy=a,n.push(o)}return n}return null}function s(e,t){var n=r(e);return null!=n&&t>=0&&t<n.length?n[t]:null}function l(t){e.taskValue[0]=t.dailyReset,e.taskValue[1]=t.monthlyReset,Game.dispatcher.dispatchEventWith(Game.EVENT.GuildShopDataChange)}e.taskValue=[[],[]],e.ApplyGuildShopBuy=t,e.GetTaskValue=n,e.GetLeftStock=i,e.Buy=a,e.GetShopConfig=r,e.GetShopData=o,e.GetGoodsCfg=s,e.ProcS2CSyncGuildShop=l}(GuildShopCore||(GuildShopCore={}));var GuildWar2Scene;!function(e){function t(){Scene.handleIdle[I]=function(){return null},Scene.listenEnterMap(I,n),Scene.listenLeaveMap(I,i),C=[]}function n(){UI.HUD.instance.showBattle(),null==S&&(S=new UI.GuildWar2BattleInfo),UI.battle.addChild(S),S.btnExit.addEventListener(egret.TouchEvent.TOUCH_TAP,a,null),S.btnMember.addEventListener(egret.TouchEvent.TOUCH_TAP,o,null),S.UpdateScore(null),UI.setDisableAllPlayerTitles(!0),SuperWeapon.disableAllPlayersEffect(!0),RES.cacheDuration=5e3,null==E&&(E=new UI.GuildArmamentBuff,UI.battle.addChild(E)),GuildArmament.applyEffectiveBuffs()}function i(){null!=S&&(UI.battle.removeChild(S),S.btnExit.removeEventListener(egret.TouchEvent.TOUCH_TAP,i,null),S.btnMember.removeEventListener(egret.TouchEvent.TOUCH_TAP,o,null),S=null),null!=E&&(UI.battle.removeChild(E),E=null),UI.setDisableAllPlayerTitles(!1),SuperWeapon.disableAllPlayersEffect(!1),RES.cacheDuration=Game.cacheDuration,Game.dispatcher.dispatchEventWith(Game.EVENT.LeaveScene)}function a(){var t=lang.String("operation confirm"),n=lang.StringWithFormat("guildwar2 matchscene confirm leave");UI.ConfirmBox.Show(UI.ConfirmBoxStyle["default"],t,n,e.ConfirmLeaveScene,null,null)}function r(){return net.socket.write(141,null),!0}function o(){return UI.GuildWar2GuildList.instance.open(!0,!1),!0}function s(){net.socket.write(2063,null)}function l(){return C}function u(e,t){return t.score-e.score}function c(e){if(C=e.list,null!=C){C.sort(u);for(var t=0;t<C.length;t++)C[t].rank=null}UI.GuildWar2GuildList.instance.opened||UI.GuildWar2GuildList.instance.open(!1,!0),Game.dispatcher.dispatchEventWith(Game.EVENT.GuildWar2GuildListChange)}function h(e){T=e,S.UpdateScore(e)}function d(e){S.UpdateState(e.state,e.time),A=e.getState()}function p(e){null!=E&&E.selectBuff(e)}function g(e){if(null!=E){if(A!=G)return void PopUpMessage.push(lang.String("armament only in pk state can use buff"),color.RED);var t=new net.def.Index;t.setIndex(e),net.socket.write(2037,t.toArrayBuffer())}}function m(e){P=null,AI.stopMove(),k=e.time,Game.dispatcher.dispatchEventWith(Game.EVENT.GuildWar2GuideChange,!1,e.time)}function f(e){k=e}function v(){return k}function y(e){if(P=null,e>=1&&4>=e)for(var t=World.objectGroup.revival,n="trap"+e,i=t.getObjectCount()-1;i>=0;i--){var a=t.getObjectByIndex(i);if(null==a)return null;if(a.name==n)return P=Scene.displayPos2LogicPos(new egret.Point(~~(a.x+a.width/2),~~(a.y+a.height/2))),void b(null)}}function b(e){if(null==P)return null;var t=P;P=null;var n=Player.instance;AI.bb;if(!n.logicPos.equals(t)){var i=g_GetDirIndex(t,n.logicPos),a=g_Move(i,MAX_DIR);return AI.MoveTo(t.add(a)),null}return null}var S,E,C,T,I="guildwar2",G=1,A=-1,k=0;e.load=t,e.ConfirmLeaveScene=r,e.ApplyMembersList=s,e.GetGuildList=l,e.procSyncGuildWar2GuildList=c,e.procSyncGuildWar2Score=h,e.procSyncGuildWarMatchTime=d,e.clickBuff=p,e.useBuff=g,e.procSyncGuildWar2Guide=m,e.setGuideTime=f,e.getGuideTime=v;var P;e.gotoTrap=y}(GuildWar2Scene||(GuildWar2Scene={}));var GuildWarMatchScene;!function(e){function t(){return null!=e.timeLine&&e.timeLine.weekNo<=at?at-e.timeLine.weekNo+1:0}function n(){return null!=e.timeLine?e.timeLine.weekNo:0}function i(){return null!=e.timeLine?e.timeLine.weekNo>at:!1}function a(t){return null!=e.timeLine?1==e.timeLine.step&&e.timeLine.leftTime>0?!0:(t&&PopUpMessage.push(lang.String("is not donate time"),color.RED),!1):void 0}function r(t){return null!=e.timeLine?Player.instance.guildPos<=0?!1:Guild.GuildWarGetTaskProgress()<=1?(t&&PopUpMessage.push(lang.String("do not finish guild task"),color.RED),!1):a(t)?0==PlayerAttribute.bag.getCount(e.donateG,e.donateD)?(t&&PopUpMessage.push(lang.String("do not have guildwar donate item"),color.RED),!1):!0:!1:!1}function o(e,t){return i()?!1:s(e,t)&&v()?!0:!1}function s(t,n){if(i())return!1;if(null!=e.timeLine){if(2!=e.timeLine.step||e.timeLine.leftTime<=0)return!1;if(e.timeLine.myFight>0)return!1;if(t>0){var a=l(t);if(null==a||a.guild1&&a.guild2)return!1}if(0>=t&&e.timeLine.myRight>0||e.timeLine.myRight==c(t))return!0}return!1}function l(e){return null!=nt&&e>=1&&e<=nt.citys.length?nt.citys[e-1]:void 0}function u(e){if(s(e,!1)){var t=l(e),n=c(e);if(t.guild1||t.guild2)for(var i=0;i<nt.citys.length;i++)if(i+1!=e&&c(i+1)==n){var a=l(i+1);if(!a.guild1&&!a.guild2)return!0}}return!1}function c(e){return 1==e?1:e>=2&&3>=e?2:e>=4&&7>=e?3:4}function h(e){switch(e){case 1:return 1;case 2:return 3;case 3:return 7;case 4:return 15}return 0}function d(t){return null!=e.timeLine&&t>=1&&t<=h(e.timeLine.openLevel)?p(t):null}function p(e){if(e>=1&&e<=table.guildwarConfig.citys.length){var t=table.guildwarConfig.citys[e-1].name;return t}return""}function g(t,n){var a=i();if(t!=a)return!1;if(a){if(PlayerAttribute.Level<50)return!1;if(e.timeLine.myFight<=0)return!1}return null!=e.timeLine?PlayerAttribute.Level<30?!1:Player.instance.guildPos<=0?!1:3!=e.timeLine.step||e.timeLine.leftTime<=0?!1:!0:!1}function m(){return f()}function f(){return!1}function v(){return Player.instance.guildPos!=Guild.GuildPosition.GuildPos_Leader&&Player.instance.guildPos!=Guild.GuildPosition.GuildPos_ViceLeader?!1:!0}function y(e){if(o(e,!0)){var t=new net.def.C2SSignupGuildWarMatchScene;t.cityId=e,net.socket.write(2022,t.toArrayBuffer()),D()}}function b(e){if(u(e)){var t=function(){return y(e),!0},n=lang.String("operation confirm"),i="Thành này đã có bang báo danh, thành khác vẫn còn trống, xác nhận tiếp tục báo danh thành này?";return void UI.ConfirmBox.Show(UI.ConfirmBoxStyle["default"],n,i,t,null,null)}y(e)}function S(e){g(e,!0)&&net.socket.write(2023,null)}function E(){net.socket.write(2026,null)}function C(){Scene.handleIdle[lt]=function(){return null},Scene.listenEnterMap(lt,O),Scene.listenLeaveMap(lt,B),tt=[]}function T(){return tt}function I(e){$.UpdateState(e.state,e.time),rt=e.getState()}function G(e){$.UpdateScore(e.scoreMine,e.scoreTheirs)}function A(e){$.UpdateMemberCount(e.count),Game.dispatcher.dispatchEventWith(Game.EVENT.GuildWarMatchMemberCountChange)}function k(e){e.members.sort(function(e,t){return e.score<t.score?1:t.score<e.score?-1:e.fightpower<t.fightpower?1:t.fightpower<e.fightpower?-1:0}),tt=e.members,Game.dispatcher.dispatchEventWith(Game.EVENT.GuildWarMatchMemberListChange)}function P(){return nt}function w(e){nt=e,Game.dispatcher.dispatchEventWith(Game.EVENT.GuildWarMatchCityListChange)}function L(){if(null==nt)return!1;var e=nt.getCitys();for(var t in e)if(e[t].getOwner()==Player.instance.guildName)return!0;return!1}function R(){return e.timeLine}function U(){return null==e.timeLine?UI.GuildWarHome.pageLogin:r(!1)?UI.GuildWarHome.pageExpedition:3==e.timeLine.step?i()?UI.GuildWarHome.pageCityBattle:UI.GuildWarHome.pageExpedition:e.timeLine.myFight>0||e.timeLine.myOwn>0||e.timeLine.myRight>0?UI.GuildWarHome.pageChooseCity:1==e.timeLine.step?UI.GuildWarHome.pageExpedition:UI.GuildWarHome.pageChooseCity}function _(){if(badge.onLight(badge.action.GuildWarDonate,!1),badge.onLight(badge.action.GuildWarBattle,!1),badge.onLight(badge.action.GuildWarSignup1,!1),badge.onLight(badge.action.GuildWarSignup2,!1),badge.onLight(badge.action.GuildWarSignup3,!1),badge.onLight(badge.action.GuildWarSignup4,!1),badge.onLight(badge.action.GuildWar2Battle,!1),null!=e.timeLine&&null!=e.timeLine&&e.timeLine.leftTime>0)switch(e.timeLine.step){case 1:r(!1)&&badge.onLight(badge.action.GuildWarDonate,!0);
break;case 2:o(0,!1)&&badge.onLight(badge.GuildWarSignup[e.timeLine.myRight-1],!0);break;case 3:var t=i();g(t,!1)&&(t?badge.onLight(badge.action.GuildWar2Battle,!0):badge.onLight(badge.action.GuildWarBattle,!0));break;case 4:}}function x(t){if(e.timeLine=t,st=!0,Game.dispatcher.dispatchEventWith(Game.EVENT.GuildWarMatchTimeLineChange),null!=e.timeLine&&e.timeLine.leftTime>0)switch(e.timeLine.step){case 1:if(ot&&e.timeLine.leftTime<86400&&r(!1)&&Guild.GuildWarGetTaskProgress()<=4){ot=!1;var n=K(e.timeLine.leftTime);ChatSys.sendSystemMsg(lang.StringWithFormat("donate has left time {1}, pls finish guild task",n),ChatSys.channel_guild,"")}break;case 2:if(i())break;if(s(0,!1))v()&&N(3,"Báo danh"),e.timeLine.firstNotify&&ChatSys.sendSystemMsg(lang.String("my guild has signup right"),ChatSys.channel_guild,"");else if(e.timeLine.firstNotify&&e.timeLine.myFight>0){var a=table.guildwarConfig.citys[e.timeLine.myFight-1].name;ChatSys.sendSystemMsg(lang.StringWithFormat("my guild has fight right for city{1}",a),ChatSys.channel_guild,"")}break;case 3:g(i(),!1)&&N(3,"Tham gia chiến đấu");break;case 4:e.timeLine.firstNotify&&N(3,"Xem chiếm")}_()}function M(){var e=Reminder.EventName.GuildWarMatch;return i()&&(e=Reminder.EventName.GuildWarMatch2),e}function D(){st=!1,Reminder.PopReminder(M())}function N(e,t){Reminder.PushReminder(M(),e*Game.Minute,t),st=!0}function F(){if(null!=e.timeLine&&e.timeLine.leftTime>0)switch(e.timeLine.step){case 1:st&&r(!1)?UIManager.push(new UI.Donations):UI.GuildWarHome.instance.OpenPage(UI.GuildWarHome.pageChooseCity);break;case 2:st&&o(0,!1)?UI.GuildWarHome.instance.OpenPage(UI.GuildWarHome.pageChooseCity):UI.GuildWarHome.instance.OpenPage(UI.GuildWarHome.pageChooseCity);break;case 3:st&&g(i(),!1)?S(i()):UI.GuildWarHome.instance.OpenPage(UI.GuildWarHome.pageChooseCity);break;case 4:e.timeLine.firstNotify?UI.GuildWarHome.instance.OpenPage(UI.GuildWarHome.pageChooseCity):UI.GuildWarHome.instance.OpenPage(UI.GuildWarHome.pageChooseCity);break;default:UI.GuildWarHome.instance.OpenPage(UI.GuildWarHome.pageChooseCity)}else UI.GuildWarHome.instance.OpenPage(UI.GuildWarHome.pageChooseCity);return D(),!0}function O(){UI.HUD.instance.showBattle(),null==$&&($=new UI.GuildWarTime),$.currentState="guildwarmatch",UI.battle.addChild($),$.btnExit.addEventListener(egret.TouchEvent.TOUCH_TAP,j,null),$.btnMember.addEventListener(egret.TouchEvent.TOUCH_TAP,W,null),$.UpdateScore(0,0),UI.setDisableAllPlayerTitles(!0),SuperWeapon.disableAllPlayersEffect(!0),RES.cacheDuration=5e3,null==et&&(et=new UI.GuildArmamentBuff,UI.battle.addChild(et)),GuildArmament.applyEffectiveBuffs()}function B(){null!=$&&(UI.battle.removeChild($),$.btnExit.removeEventListener(egret.TouchEvent.TOUCH_TAP,B,null),$.btnMember.removeEventListener(egret.TouchEvent.TOUCH_TAP,W,null),$=null),null!=et&&(UI.battle.removeChild(et),et=null),UI.setDisableAllPlayerTitles(!1),SuperWeapon.disableAllPlayersEffect(!1),RES.cacheDuration=Game.cacheDuration,Game.dispatcher.dispatchEventWith(Game.EVENT.LeaveScene)}function W(){return UIManager.push(UI.ReadyArea.instance),!0}function V(){net.socket.write(2024,null)}function q(){var t=PlayerAttribute.bag.getCount(e.donateG,e.donateD),n={num:t,con:~~(.2*t+.9),exp:100*t,score:10*t};return n}function H(){r(!0)&&net.socket.write(2025,null)}function j(){var t=lang.String("operation confirm"),n=lang.StringWithFormat("guildwarmatchscene confirm leave");UI.ConfirmBox.Show(UI.ConfirmBoxStyle["default"],t,n,e.ConfirmLeaveScene,null,null)}function Y(){return net.socket.write(141,null),!0}function K(e){if(0>=e)return"Đã quá hạn";if(60>e)return"Dưới 1 phút";if(3600>e){var t=~~(e/60);return t+" phút"}if(86400>e){var n=~~(e/3600),t=~~(e%3600/60);return n+" giờ "+t+" phút"}var i=~~(e/86400),a=~~(e%86400/3600);return i+" ngày "+a+" giờ"}function Q(){return i()&&(2==e.timeLine.step||3==e.timeLine.step)?e.timeLine.myFight>0?'<font color="#41cb5e">Bang ta đã nhận được tư cách tham chiến</font>':'<font color="#eb433f">Tạm chưa nhận được tư cách tham chiến</font>':""}function X(){var t="",n=Guild.GuildWarGetTaskProgress();switch(n){case 0:case 1:t="Mau đến Phục Ngưu Sơn, thu thập Khai Sơn Lệnh";break;case 2:t="Cần bang hoàn thành Phó Bản Đoạt Sơn Môn";break;case 3:t="Cần bang hoàn thành Phó Bản Thế Như Chẻ Tre";break;case 4:t="Cần bang hoàn thành Phó Bản Phục Ngưu Sơn Chiến";break;default:var a=e.getTimeLine();if(null!=a){var r=K(a.leftTime),o=K(a.nextTime);switch(a.step){case 0:t="Đợi cống hiến vật tư đợt sau, còn:"+o;break;case 1:t=a.leftTime>0?"Cống hiến vật tư, còn: "+r:i()?"Đợi tổng kết tư cách công thành, còn: "+o:"Chờ báo danh đoạt thành, còn: "+o;break;case 2:t=!i()&&0==a.myFight&&a.leftTime>0?"Báo danh đoạt thành, còn: "+r:"Chờ mở chiến trường, còn: "+o;break;case 3:t=a.leftTime>0?"Báo danh chiến trường, còn: "+r:"Chờ chiến trường kết thúc, còn: "+o;break;case 4:t=a.leftTime>0?"Tổng kết chiến trường, còn: "+r:"Đợi cống hiến vật tư đợt sau, còn:"+o;break;case 5:t="Tạm dừng, hãy chờ cập nhật"}}}return t}function J(e){return i()?GuildWar2Scene.clickBuff(e):void(null!=et&&et.selectBuff(e))}function z(e){if(i())return GuildWar2Scene.useBuff(e);if(null!=et){if(rt!=it)return void PopUpMessage.push(lang.String("armament only in pk state can use buff"),color.RED);var t=new net.def.Index;t.setIndex(e),net.socket.write(2037,t.toArrayBuffer())}}function Z(){var t=!0;return t?e.IsGuildWar2()?!0:null!=e.timeLine&&e.timeLine.weekNo==at&&(e.timeLine.step>=4||0==e.timeLine.step)?!0:!1:!0}e.donateG=14,e.donateD=2e3;var $,et,tt,nt,it=1,at=4,rt=-1,ot=!0,st=!1,lt="guildwarmatch";e.GetSignupCityLevel=t,e.GetWeekNo=n,e.IsGuildWar2=i,e.IsDonateTime=a,e.CanDonate=r,e.CanSignupCity=o,e.HasSignupCityRight=s,e.getCityLevel=c,e.getOpenCityCount=h,e.getGuildWar2AwardCityName=d,e.getCityName=p,e.CanJoinBattle=g,e.OnPlayerLogin=m,e.OnCheckReminder=f,e.IsGuildOfficer=v,e.ConfirmSignupGuildWarMatch=b,e.ApplyJoinMatch=S,e.ApplyCityInfo=E,e.load=C,e.GetMemberList=T,e.procSyncGuildWarMatchTime=I,e.procSyncGuildWarMatchScore=G,e.procSyncGuildWarMatchMemberCount=A,e.procSyncGuildWarMatchMemberList=k,e.getCitysInfo=P,e.porcSyncGuildWarMatchCityList=w,e.haveCity=L,e.getTimeLine=R,e.getDefaultPage=U,e.CheckBadge=_,e.porcSyncGuildWarMatchTimeLine=x,e.popReminder=D,e.showReminder=N,e.OnClickBtnReminder=F,e.ApplyMembersList=V,e.GetDonateInfo=q,e.ApplyDonate=H,e.ConfirmLeaveScene=Y,e.GetGuildWar2FightStatus=Q,e.GetStatusDesc=X,e.clickBuff=J,e.useBuff=z,e.canOpenGuildWar2=Z}(GuildWarMatchScene||(GuildWarMatchScene={}));var GuildWarTaskScene;!function(e){function t(t,i,a){t>0&&a>0?(e.CurrentSceneID=t,e.SceneRemaining=a,i>0?e.JointimeRemaining=i:e.JointimeRemaining=0,SecondTicker.addEventListener(n,null)):(e.JointimeRemaining=0,e.SceneRemaining=0,e.CurrentSceneID=0,SecondTicker.removeEventListener(n,null)),Game.dispatcher.dispatchEventWith(Game.EVENT.GuildWarTaskStart)}function n(){e.SceneRemaining>0?(e.JointimeRemaining>0&&e.JointimeRemaining--,e.SceneRemaining--):SecondTicker.removeEventListener(n,null),Game.dispatcher.dispatchEventWith(Game.EVENT.GuildWarTaskSceneTick)}function i(t){e.times=t}function a(e){null!=G&&(G.second=e)}function r(e){null!=G&&(G.gate=e)}function o(){Scene.handleIdle[k[I.guildwartask_fnsm]]=function(){return null},Scene.handleIdle[k[I.guildwartask_shanzei]]=function(){return null},Scene.handleIdle[k[I.guildwartask_moku]]=function(){return null},Scene.listenEnterMap(k[I.guildwartask_fnsm],s),Scene.listenEnterMap(k[I.guildwartask_shanzei],l),Scene.listenEnterMap(k[I.guildwartask_moku],u),Scene.listenLeaveMap(k[I.guildwartask_fnsm],p),Scene.listenLeaveMap(k[I.guildwartask_shanzei],p),Scene.listenLeaveMap(k[I.guildwartask_moku],p),P=RES.getRes("config/guildwarclientaward.json")}function s(){c(I.guildwartask_fnsm)}function l(){c(I.guildwartask_shanzei)}function u(){c(I.guildwartask_moku)}function c(e){UI.HUD.instance.showBattle(),null==G&&(G=new UI.ChallengeNote),null==A&&(A=new UI.GuildWarBossNote),A.type=e,G.currentState="guildwartaskscene",UI.battle.addChild(G),UI.battle.addChild(A),G.btnExit.addEventListener(egret.TouchEvent.TOUCH_TAP,h,null)}function h(){var t=lang.String("operation confirm"),n=lang.StringWithFormat("guildwartaskscene confirm leave");UI.ConfirmBox.Show(UI.ConfirmBoxStyle["default"],t,n,e.onLeaveBoat,null,null)}function d(){return net.socket.write(141,null),!0}function p(){null!=G&&(UI.battle.removeChild(G),G.btnExit.removeEventListener(egret.TouchEvent.TOUCH_TAP,d,null),G=null),null!=A&&(UI.battle.removeChild(A),A=null),null!=UI.GuildWarTaskResult.instance&&UIManager.pop(UI.GuildWarTaskResult.instance),Game.dispatcher.dispatchEventWith(Game.EVENT.LeaveScene)}function g(e){e.data.sort(function(e,t){return e.damage<t.damage?1:t.damage<e.damage?-1:0}),A.rank=[];for(var t=0;t<e.data.length;t++)10>t&&A.rank.push({rank:t+1,name:e.data[t].name,damage:Math.floor(e.data[t].damage/1e3)}),Player.instance.Name==e.data[t].name&&(A.myRank=t+1,A.myScore=e.data[t].damage);A.UpdateRank()}function m(e,t){0==e?(G.txtPrepare.visible=!0,G.gateGroup.visible=!1):(G.txtPrepare.visible=!1,G.gateGroup.visible=!0),r(e),a(t)}function f(e,t){switch(e){case 5:A.reviveCount=t;break;case 2:PopUpMessage.push(lang.StringWithFormat("guildwartaskscene start round{1}",t),color.RED);break;case 4:PopUpMessage.push(lang.String("guildwartaskscene engage"),color.RED)}}function v(e){switch(e){case 2:PopUpMessage.push(lang.String("guildwartaskscene already exist"),color.RED);break;case 3:PopUpMessage.push(lang.String("guildwartaskscene already start"),color.RED);break;case 5:PopUpMessage.push(lang.String("guildwartaskscene no world"),color.RED);break;case 4:PopUpMessage.push(lang.String("guildwartaskscene open time error"),color.RED);break;case 7:PopUpMessage.push(lang.String("guildwartaskscene other started"),color.RED);break;case 6:PopUpMessage.push(lang.String("guildwartaskscene FailedErrorDate"),color.RED)}}function y(e){for(var t=[],n=[],i=0;i<e.awards.length;i++){var a=table.parseAward(e.awards[i]);t.push(a)}for(var i=0;i<e.auction.length;i++){var a=table.parseAward(e.auction[i]);n.push(a)}UI.GuildWarTaskResult.instance.show(t,n,e.win),UIManager.pushPage(UI.GuildWarTaskResult.instance)}function b(){return P.guildwartask_fns}function S(){return P.guildwartask_fnsm}function E(){return P.guildwartask_shanzei}function C(){return P.guildwartask_moku}function T(){return P.guildwartask_xian}var I;!function(e){e[e.guildwartask_fnsm=0]="guildwartask_fnsm",e[e.guildwartask_shanzei=1]="guildwartask_shanzei",e[e.guildwartask_moku=2]="guildwartask_moku"}(I=e.GuildWarTaskType||(e.GuildWarTaskType={}));var G,A,k=["guildwartask_fnsm","guildwartask_shanzei","guildwartask_moku"];e.CurrentSceneID=0,e.JointimeRemaining=0,e.SceneRemaining=0,e.OnUpdateSceneInfo=t,e.tokenUsed=0,e.LIMITLEVEL=25,e.MAXCHANCE=1,e.times=0,e.MAX_DAILY_TOKEN_USE=20;var P;e.s2cJointimes=i,e.s2cSceneTime=a,e.s2cScenegate=r,e.load=o,e.onLeaveBoat=d,e.processSyncGuildWarTaskSceneDamage=g,e.processSyncGuildWarTaskSceneChapter=m,e.processGuildWarTaskMsg=f,e.processJoinGuildWarTaskSceneRet=v,e.porcGuildWarTaskFinished=y,e.getFuniushanAwards=b,e.getFuniushanmenAwards=S,e.getShanzeiqiantingAwards=E,e.getFuniushanmokuAwards=C,e.getZhanchengAwards=T}(GuildWarTaskScene||(GuildWarTaskScene={}));var HalfYearDraw;!function(e){function t(){return e.drawKeyTimes>0?!0:!1}function n(){return e.drawBoxTimes||0}function i(){return e.drawKeyTimes||0}function a(){return PlayerAttribute.Level<e.minLevel?(PopUpMessage.push(lang.StringWithFormat("halfyeardraw need level {1}",e.minLevel),color.RED),!1):e.activity.inTime()?t()?(net.socket.write(195,null),!0):(PopUpMessage.push(lang.String("halfyeardraw not free times"),color.RED),!1):(PopUpMessage.push(lang.String("out of time"),color.RED),!1)}function r(){return PlayerAttribute.Level<e.minLevel?(PopUpMessage.push(lang.StringWithFormat("halfyeardraw need level {1}",e.minLevel),color.RED),!1):void net.socket.write(196,null)}function o(t){null!=t&&(t?UI.battle&&UI.battle.leftGroup&&(e.HalfYearDrawIcon||(e.HalfYearDrawIcon=new UI.IconButton,e.HalfYearDrawIcon.img=e.activity.settings.buttonImg,e.HalfYearDrawIcon.onTap=function(t){s(),e.HalfYearDrawIcon.stopMovie()}),e.HalfYearDrawIcon.parent!=UI.battle.leftGroup&&(UI.battle.addToLeftGroup(e.HalfYearDrawIcon,0),e.HalfYearDrawIcon.playMovie(-1))):e.HalfYearDrawIcon&&Game.removeFromParent.apply(e.HalfYearDrawIcon))}function s(){return e.activity&&e.activity.open?PlayerAttribute.Level<e.activity.settings.minLevel?void PopUpMessage.push(StringWithFormat("Hoạt động này Lv{1} mở",e.activity.settings.minLevel),color.RED):void UI.HalfYearDrawHall.open():void 0}function l(){e.activity=new Activity.MissionActivity(Activity.ActivityKind.Activity_HalfYearDraw),e.activity.eventName=Game.EVENT.HalfYearDrawOpen;var t=RES.getRes("public_config/operation/halfyeardraw/halfyeardraw.json");e.activity.profiles=t.profile,e.activity.openCallback=function(e){o(e)},e.activity.initSelf=function(){e.minLevel=e.activity.settings.minLevel,e.drawBoxCost=e.activity.settings.drawBoxCost,e.drawBoxCostTen=e.activity.settings.drawBoxCostTen;for(var t=e.activity.settings.drawKeyUI,n=0,i=0;i<t.divisions.length;i++)n+=t.divisions[i];e.drawKeyUIConfig={imgWheel:t.imgWheel,imgWhirl:t.imgWhirl,imgPointer:t.imgPointer,imgBackGround:t.imgBackGround,angle:~~(360/n),divisions:t.divisions,offsets:t.offsets};var a=e.activity.settings.drawBoxUI;e.drawBoxUIConfig={imgBg:a.imgBg,awards:a.awards},e.shopGoods=[];for(var i=0;i!=e.activity.settings.shop.length;i++){var r=e.activity.settings.shop[i],o=new Shop.PropGoods;o.price=r.price,o.currency=Game.Currency.Fubi,o.pos=i,o.discount=r.discount||100,o.genre=r.content.genre,o.detailType=r.content.detailType,o.count=r.content.count,o.param={discountIcon:r.discountIcon,leftStock:null,stockNum:r.stockNum||0,price:r.price,goodsId:r.id},o.buy=u,e.shopGoods.push(o)}d()},net.Register(2116,h),net.Register(2114,p)}function u(t,n){if(PlayerAttribute.Level<e.minLevel)return PopUpMessage.push(lang.StringWithFormat("halfyeardraw need level {1}",e.minLevel),color.RED),!0;var i=e.shopGoods[t];if(null==i)return!1;var a=i.param.goodsId;if(0==a)return!1;var r=c(a);if(i.param.stockNum>0&&r>=i.param.stockNum)return!1;var o=i.price*i.discount/100;if(PlayerAttribute.currency[Game.Currency.Fubi]<o)return PopUpMessage.push(lang.String("halfyeardraw fubi not enough"),color.RED),!0;var s=new net.def.Index;return s.index=a,net.socket.write(198,s.toArrayBuffer()),!1}function c(t){return e.shopGoodsSoldCount[t]||0}function h(t){var n=net.def.S2CHalfyearDrawInfo.decode(t);e.drawBoxTimes=n.drawBoxTimes,e.drawKeyTimes=n.drawKeyTimes,e.shopGoodsSoldCount={};for(var i=0;i!=n.goods.length;i++){var a=n.goods[i].id,r=n.goods[i].count;e.shopGoodsSoldCount[a]=r}d(),Game.dispatcher.dispatchEventWith(Game.EVENT.HalfYearDrawSycnInfo)}function d(){for(var t=0;t!=e.shopGoods.length;t++){var n=e.shopGoods[t],i=n.param.goodsId,a=c(i);n.param.stockNum>0?n.param.leftStock=n.param.stockNum-a:n.param.leftStock=null}}function p(t){var n=net.def.S2CHalfyearDrawKeyResult.decode(t);if(n.getRuning())Game.dispatcher.dispatchEventWith(Game.EVENT.HalfYearDrawChanceResult,null,n.getIndex());else{var i=e.activity.settings.randDrawKey,a=i[n.getIndex()],r=a[0];UI.HalfyearDrawKeyResult.open(r)}}function g(t,n){if(PlayerAttribute.Level<e.minLevel)return PopUpMessage.push(lang.StringWithFormat("halfyeardraw need level {1}",e.minLevel),color.RED),!1;if(1==n||10==n){Partner.recruiting=!0;var i=new net.def.C2SHalfyearDrawBoxApply;i.type=t,i.times=n,net.socket.write(197,i.toArrayBuffer())}}e.drawBoxCost=0,e.drawBoxCostTen=0,e.minLevel=0,e.shopGoodsSoldCount={},e.DRAWAWARDTYPE_KEY=1,e.DRAWAWARDTYPE_MONEY=2,e.shopGoods=[],e.isWheelFree=t,e.getDrawBoxTimes=n,e.getDrawKeyTimes=i,e.roll=a,e.draw=r,e.openHalfYearDrawHall=s,e.load=l,e.Buy=u,e.updateShopGoods=d,e.drawAward=g}(HalfYearDraw||(HalfYearDraw={}));var HeroicCard;!function(e){function t(){net.Register(2057,o),a()}function n(){var e=Game.countEraDay();return e>=table.heroicCardCfg.startActEraDay&&e<table.heroicCardCfg.endAwardEraDay}function i(){var e=Game.countEraDay();return e>=table.heroicCardCfg.startActEraDay&&e<table.heroicCardCfg.endActEraDay}function a(){(Game.eraDay<table.heroicCardCfg.startActEraDay||Game.eraDay<table.heroicCardCfg.endAwardEraDay)&&(SecondTicker.addEventListener(r,null),Game.eraDay<table.heroicCardCfg.endAwardEraDay&&r())}function r(){var t=n();1==e.open&&0==t?(e.open=!1,SecondTicker.removeEventListener(r,null),Game.dispatcher.dispatchEventWith(Game.EVENT.HeroicCardOpen,null,!1)):1==t&&0==e.open&&(e.open=!0,Game.dispatcher.dispatchEventWith(Game.EVENT.HeroicCardOpen,null,!0))}function o(){var e=new UI.PrologueDialogue;e.dialogue=Game.TextParser.parse(lang.String("HeroicCard Open")),e.answer=Game.TextParser.parse("Đi xem"),UIManager.push(e),e.handle=function(){UIManager.pop(e),UI.WelfareHall.open(),UI.WelfareHall.instance.ShowHeroicCardPage()}}function s(t){return null==e.hcMsTasks[t]?!0:e.hcMsTasks[t].targetId>=table.heroicCardCfg.missions[t].tasks.length?!0:!1}function l(t){e.HeroicPoint=t.heroicPoint,e.AwardedPoint=t.awardedPoint,e.hcMsTasks=new Array;for(var n=!1,i=0;i<t.tasks.length;i++){var a=new h;if(a.targetId=t.tasks[i].targetId,a.value=t.tasks[i].value,e.hcMsTasks.push(a),a.targetId<table.heroicCardCfg.missions[i].tasks.length){var r=table.heroicCardCfg.missions[i].tasks[a.targetId].target;a.value>=r&&(n=!0)}}PlayerAttribute.Level>=e.SYS_OPEN_LEVEL&&badge.onLight(badge.action.HeroicCardTaskFinish,n);for(var o=!1,s=table.heroicCardCfg.awards,i=0;i<s.length;i++)if(e.AwardedPoint<s[i].point&&e.HeroicPoint>=s[i].point){o=!0;break}PlayerAttribute.Level>=e.SYS_OPEN_LEVEL&&badge.onLight(badge.action.HeroicCardAward,o),Game.dispatcher.dispatchEventWith(Game.EVENT.HeroicCardAllUpdate)}function u(t){e.HeroicPoint=t.heroicPoint,null==e.hcMsTasks&&(e.hcMsTasks=new Array),e.hcMsTasks[t.missionId].targetId=t.task.targetId,e.hcMsTasks[t.missionId].value=t.task.value,Game.dispatcher.dispatchEventWith(Game.EVENT.HeroicCardSingleUpdate);for(var n=!1,i=0;i<e.hcMsTasks.length;i++){var a=e.hcMsTasks[i].targetId,r=e.hcMsTasks[i].value;if(a<table.heroicCardCfg.missions[i].tasks.length){var o=table.heroicCardCfg.missions[i].tasks[a].target;r>=o&&(n=!0)}}PlayerAttribute.Level>=e.SYS_OPEN_LEVEL&&badge.onLight(badge.action.HeroicCardTaskFinish,n)}var c;!function(e){e[e.Heroiccard_kill_mission=0]="Heroiccard_kill_mission",e[e.Heroiccard_enhance_mission=1]="Heroiccard_enhance_mission",e[e.Heroiccard_gem_mission=2]="Heroiccard_gem_mission",e[e.Heroiccard_equip_mission=3]="Heroiccard_equip_mission",e[e.Heroiccard_partner_mission=4]="Heroiccard_partner_mission",e[e.Heroiccard_songjin_mission=5]="Heroiccard_songjin_mission",e[e.Heroiccard_liansai_mission=6]="Heroiccard_liansai_mission",e[e.Heroiccard_recharge_mission=7]="Heroiccard_recharge_mission",e[e.Heroiccard_UsingCnt=8]="Heroiccard_UsingCnt"}(c=e.MissionId||(e.MissionId={})),e.SYS_OPEN_LEVEL=30,e.MAX_HEROIC_POINT=920;var h=function(){function e(){}return e}();__reflect(h.prototype,"HeroicCardTaskValue"),e.load=t,e.inTime=n,e.inActTime=i,e.open=!1,e.isFinished=s,e.OnSyncTaskStatus=l,e.OnSyncOneTaskStatus=u}(HeroicCard||(HeroicCard={}));var HuashanPK;!function(e){function t(t){e.note.restTime=t}function n(){null==e.note&&(e.note=new UI.HuashanPKNote),UI.battle.addChild(e.note)}function i(){null!=e.note&&(UI.battle.removeChild(e.note),e.note=null)}function a(t){null==e.note&&(e.note=new UI.HuashanPKNote),e.note.syncInfo(t.round,t.npcCount,t.restTime,t.NextAwardRound)}function r(){Scene.listenEnterMap(e.scene,n),Scene.listenLeaveMap(e.scene,i)}function o(){e.roundAwardConfigs=RES.getRes("config/scenes/huashanpkroundaward.json")}function s(){net.socket.write(141,null)}function l(t,n){n?(u(t),e.maxRound=t):h(t)}function u(e){var t=new UI.HuashanPKResult;t.panel.skinName="PanelWinSkin",t.panel.btnBack.visible=!1,t.currentState="succeed",t.gate=e,t.setAwardlist(c(e)),t.resetRemainTime(),egret.setTimeout(function(){UIManager.pushPage(t)},null,1e3)}function c(t){for(var n=0;n!=e.roundAwardConfigs.length;n++)if(t>=e.roundAwardConfigs[n].roundBegin&&t<=e.roundAwardConfigs[n].roundEnd)return e.roundAwardConfigs[n].awards}function h(e){var t=new UI.HuashanPKResult;t.panel.skinName="PanelLoseSkin",t.panel.btnBack.visible=!1,t.currentState="fail",t.gate=e,t.resetRemainTime(),egret.setTimeout(function(){UIManager.pushPage(t)},null,1e3)}function d(){net.socket.write(49,null)}function p(){net.socket.write(50,null)}function g(t){e.firstListData.removeAll();for(var n=t.getRecords(),i=0;i<n.length;i++)e.firstListData.addItem({round:n[i].getRound(),name:n[i].getName(),time:FormatYYYYMMDDHHMM(n[i].getTime())});e.firstListData.refresh()}function m(e){UI.HuashanPKUI.onSyncPlayerInfo(e);var t=e.getDailyAwardSilverCoin()>0?!0:!1;badge.onLight(badge.action.HuashanPKDailyAward,t)}function f(){if(PlayerAttribute.Level<e.levelLimit)return void PopUpMessage.push(lang.StringWithFormat("open on level {1}",e.levelLimit),color.RED);UIManager.pushPage(UI.HuashanPKUI.instance);var t=egret.getTimer();(!v||t>v)&&(net.socket.write(72,null),net.socket.write(70,null),v=t+1e3)}e.scene="huashanpk",e.firstListData=new eui.ArrayCollection,e.levelLimit=20,e.maxRound=0,e.updateRestTime=t,e.syncInfo=a,e.init=r,e.roundAwardConfigs=[],e.load=o,e.onC2SExit=s,e.onSyncResult=l,e.onVictory=u,e.calcAward=c,e.onFail=h,e.nextDegree=d,e.retry=p,e.onSyncRecords=g,e.onSyncAchievementAward=m;var v;e.OpenHuashanPK=f}(HuashanPK||(HuashanPK={}));var JianMenGuan;!function(e){function t(){var t=egret.getTimer()-T;T=egret.getTimer(),null!=e.area&&e.area.breathe(t)}function n(t,n){var i=e.teams[t];null==i&&(i=new E,e.teams[t]=i),i.camp=t,i.score=n.score,i.tick=n.tick}function i(t){var n=net.def.Value.decode(t),i=n.Value;e.area.status=i}function a(t){var n=net.def.HodingAreaStatus.decode(t);null!=e.holdingArea&&(e.holdingArea.restTime=n.time,e.holdingArea.count=n.count)}function r(e,t){for(var n=0,i=t;n<i.length;n++){var a=i[n];if(a.rank<=e&&e<a.rank+a.count)return a.award}return t[t.length-1].award}function o(t){var n=net.def.S2CSyncJianMenGuanResult.decode(t),i=new UI.JianMenGuanResult;switch(e.mycamp){case Game.Camp.CampSong:i.friendTop=n.song.name+":"+n.song.damage,null!=n.jin&&(i.enemyTop=n.jin.name+":"+n.jin.damage);break;case Game.Camp.CampJin:i.friendTop=n.jin.name+":"+n.jin.damage,null!=n.song&&(i.enemyTop=n.song.name+":"+n.song.damage)}i.damage=n.damage,i.rank=n.rank,n.winCamp==e.mycamp?(i.currentState="win",i.awards.dataProvider=new eui.ArrayCollection([e.awardConfig.win.award]),n.damage>0&&(i.rankAwards.dataProvider=new eui.ArrayCollection([r(n.rank,e.awardConfig.win.rankAwards)]))):(i.currentState="lose",i.awards.dataProvider=new eui.ArrayCollection([e.awardConfig.lose.award]),n.damage>0&&(i.rankAwards.dataProvider=new eui.ArrayCollection([r(n.rank,e.awardConfig.lose.rankAwards)]))),UIManager.push(i)}function s(t){var i=net.def.S2CSyncJianMenGuan.decode(t);if(null==e.hud&&(e.hud=new UI.JianMenGuanHUD),e.mycamp=i.camp,e.hud.restTime=i.time,null!=i.area){null==e.area&&(e.area=new C),e.area.camp=i.area.camp,e.area.status=i.area.status;var a=i.area.counter;null!=a&&(e.area.process.camp=a.camp,e.area.process.tick=a.value),e.area.process.valid=null!=a}null!=i.song&&n(Game.Camp.CampSong,i.song),null!=i.jin&&n(Game.Camp.CampJin,i.jin),e.area.updateScore(),e.hud.parent!=UI.battle&&UI.battle.addChild(e.hud)}function l(){var e=new UI.Rule;e.skinName="JianMenGuanRuleSkin",UIManager.push(e)}function u(){null==e.holdingArea&&(e.holdingArea=new UI.HoldingArea,e.holdingArea.onExit=function(){UI.ConfirmBox.Show(UI.ConfirmBoxStyle["default"],lang.String("operation confirm"),lang.String("songjinx confirm leave"),function(){return net.socket.write(141,null),!0},null,null)},e.holdingArea.onClickRules=l),e.holdingArea.parent!=UI.battle&&UI.battle.addChild(e.holdingArea)}function c(){null!=e.holdingArea&&(Game.removeFromParent.apply(e.holdingArea),e.holdingArea.clearResourceReference())}function h(e){var t=ECS.GameObject.generate(),n=ECS.DisplayContainerComponent.generate(null,t);t.addComponent(n);var i=ECS.DragonBoneRenderer.generate("zhengduo",t);return i.playTimes=0,i.animationName="ts_2",i.onloaded=function(){var e=i.armatureDisplay;e.touchEnabled=!1,n.container.addChildAt(e,0)},t.addComponent(i),ECS.world.add(t),n.container.x=e.x,n.container.y=e.y/GameMap.ratioY,Scene.addChildToGround(n.container),i}function d(){var n=World.objectGroup.combatzone,i=n.getObjectCount();if(0>=i)return null;var a=n.getObjectByIndex(0);if(null==a)return null;var r=Scene.displayPos2LogicPos(new egret.Point(~~(a.x+a.width/2),~~(a.y+a.height/2)));e.controlArea=h(r),T=egret.getTimer(),GameTick.addEventListener(t,this),e.teams={}}function p(){null!=e.hud&&(Game.removeFromParent.apply(e.hud),e.hud.clearResourceReference(),e.hud=null),e.controlArea.gameobject.destory(),e.controlArea=null,GameTick.removeEventListener(t,this),e.teams=null,e.area=null}function g(){return PlayerAttribute.Level<e.config.level&&PopUpMessage.push(lang.String("levelTooLow"),color.RED),y()||e.config.debug.enable?void net.socket.write(2112,null):void PopUpMessage.push(lang.String("out of time"),color.RED)}function m(){net.socket.write(141,null)}function f(e){var t=World.objectGroup.combatzone,n=t.getObjectCount();if(0>=n)return null;var i=t.getObjectByIndex(0);return null==i?null:Scene.displayPos2LogicPos(new egret.Point(~~(i.x+i.width/2),~~(i.y+i.height/2)))}function v(){var t="jianmenguan/enroll",n="jianmenguan/combat";Scene.listenEnterMap(t,u),Scene.listenLeaveMap(t,c),Scene.listenEnterMap(n,d),Scene.listenLeaveMap(n,p),Scene.handleIdle[n]=f,net.Register(2155,s),net.Register(2156,i),net.Register(2157,a),net.Register(2158,o),e.config=RES.getRes("public_config/jianmenguan/jianmenguan.json"),e.config.mode.captureTime=e.config.mode.captureTime*Game.Second,e.config.mode.overtime=e.config.mode.overtime*Game.Second,e.config.mode.defenseTime=e.config.mode.defenseTime*Game.Second,e.config.prepareTime=e.config.prepareTime*Game.Second,e.awardConfig=RES.getRes("public_config/jianmenguan/award.json")}function y(){for(var t=Game.getServerDate().getTime(),n=Game.getServerDate(),i=0,a=e.config.timers;i<a.length;i++){var r=a[i];if(n.setHours(r.hour,r.minute,0,0),n.getTime()<=t&&t<n.getTime()+e.config.prepareTime)return!0}return!1}var b=function(){function e(){}return e.None=0,e.Song=1,e.Jin=16,e.Both=17,e}();__reflect(b.prototype,"OccupyStatus");var S=function(){function t(){}return Object.defineProperty(t.prototype,"camp",{get:function(){return this._camp},set:function(t){this._camp=t,this.camp==e.mycamp?e.hud.SetCounter("friend",0,e.config.mode.captureTime):e.hud.SetCounter("enemy",0,e.config.mode.captureTime)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tick",{get:function(){return this._tick},set:function(t){this._tick=t,e.hud.progress.value=this._tick},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"valid",{get:function(){return this._valid},set:function(t){this._valid=t,e.hud.progress.visible=t},enumerable:!0,configurable:!0}),t}();__reflect(S.prototype,"Counter");var E=function(){function e(){}return e}();__reflect(E.prototype,"Team");var C=function(){function t(){this.process=new S}return Object.defineProperty(t.prototype,"camp",{get:function(){return this._camp},set:function(t){this._camp=t;var n;this._camp==Game.Camp.CampNeutral?(n="ts_2",e.hud.currentState="neutral",e.hud.bg.source="ui/common1/sw_0.png"):this._camp==e.mycamp?(n="ts_1",e.hud.currentState="friend",e.hud.bg.source="ui/common1/sw_1.png"):(n="ts_3",e.hud.currentState="enemy",e.hud.bg.source="ui/common1/sw_2.png"),e.controlArea.lastAnimationName()!=n&&e.controlArea.play(n),this.updateScore()},enumerable:!0,configurable:!0}),t.prototype.update=function(t,n){this.process.valid?this.process.camp==t?(this.process.tick+=n,this.process.tick>=e.config.mode.captureTime&&(this.camp=t,this.process.valid=!1,t==e.mycamp?e.hud.Capture("friend"):e.hud.Capture("enemy"))):(this.process.tick>0&&(t==Game.Camp.CampNeutral?this.process.tick-=n:this.process.tick-=e.config.mode.captureFactor*n),this.process.tick<=0&&(this.process.valid=!1)):this.camp!=t&&(this.process.camp=t,this.process.tick=0,this.process.valid=!0,this.camp!=Game.Camp.CampNeutral&&(e.teams[this.camp].tick=0,this.updateScore()))},t.prototype.ProcessDefense=function(t){if(this.camp==Game.Camp.CampNeutral)return!1;var n=e.teams[this.camp];if(n.score/e.config.mode.defenseFactor>=e.config.mode.defenseTime){switch(this.camp){case Game.Camp.CampSong:0!=(this.status&b.Jin)||this.process.valid||(n.tick+=t,this.updateScore());break;case Game.Camp.CampJin:0!=(this.status&b.Song)||this.process.valid||(n.tick+=t,this.updateScore())}if(n.tick>=e.config.mode.overtime)return!0}else{switch(this.camp){case Game.Camp.CampSong:this.status==b.Song?n.score+=e.config.mode.defenseFactor*t:n.score+=t;break;case Game.Camp.CampJin:this.status==b.Jin?n.score+=e.config.mode.defenseFactor*t:n.score+=t}this.updateScore()}},t.prototype.updateScore=function(){if(null!=e.teams[Game.Camp.CampSong]&&null!=e.teams[Game.Camp.CampJin]){var t=e.config.mode.defenseTime,n=e.config.mode.defenseFactor,i=e.teams[Game.Camp.CampSong].score/n,a=e.teams[Game.Camp.CampJin].score/n;e.hud.setScore(e.mycamp==Game.Camp.CampSong,""+Math.floor(99*i/t)),e.hud.setScore(e.mycamp==Game.Camp.CampJin,""+Math.floor(99*a/t)),this.camp==e.mycamp?e.hud.progress2.currentState="friend":e.hud.progress2.currentState="enemy",e.hud.progress2.maximum=e.config.mode.overtime,this.camp==Game.Camp.CampSong?(e.hud.SetOvertimeVisible(i>=t&&!this.process.valid),e.hud.progress2.value=e.teams[Game.Camp.CampSong].tick,e.teams[Game.Camp.CampSong].tick>=e.config.mode.overtime&&i>=t&&e.hud.setScore(e.mycamp==Game.Camp.CampSong,"100")):this.camp==Game.Camp.CampJin?(e.hud.SetOvertimeVisible(a>=t&&!this.process.valid),e.hud.progress2.value=e.teams[Game.Camp.CampJin].tick,e.teams[Game.Camp.CampJin].tick>=e.config.mode.overtime&&a>=t&&e.hud.setScore(e.mycamp==Game.Camp.CampJin,"100")):e.hud.SetOvertimeVisible(!1)}},t.prototype.breathe=function(t){switch(e.area.status){case b.Song:this.update(Game.Camp.CampSong,t),e.hud.progress.value=e.area.process.tick;break;case b.Jin:this.update(Game.Camp.CampJin,t),e.hud.progress.value=e.area.process.tick;break;case b.None:this.update(e.area.camp,t),e.hud.progress.value=e.area.process.tick,this.camp!=Game.Camp.CampNeutral&&e.teams[this.camp].tick>0&&(e.teams[this.camp].tick=0,e.hud.progress2.value=0)}this.ProcessDefense(t)},t}();__reflect(C.prototype,"ControlArea");var T=0;e.getRankAward=r,e.procSyncJianMenGuanResult=o,e.OpenRuleUI=l,e.CreateContralArea=h,e.signup=g,e.leave=m,e.init=v,e.isEnrollTime=y,Game.RegisterLoader(v)}(JianMenGuan||(JianMenGuan={}));var LittleBoss;!function(e){function t(){badge.onLight(badge.action.LittleBoss,!0),null!=e.expiredTimer&&(egret.clearTimeout(e.expiredTimer),e.expiredTimer=null)}function n(){return null==w&&(w=P.newInstance()),w}function i(i){e.current=i.current;for(var o,s=!1,l=n(),u=0;u<i.items.length;u++)l.items[u].id=i.items[u].id,l.items[u].restTime.delta=i.items[u].countdownTime,l.items[u].enterCount=i.items[u].enterCount,l.items[u].enabled=i.items[u].enterCount<l.items[u].maxCount&&i.items[u].countdownTime<=0,!s&&PlayerAttribute.Level>r(l.items[u].id)&&l.items[u].enterCount<l.items[u].maxCount&&l.items[u].restTime.delta<=0&&(s=!0),l.items[u].enterCount<l.items[u].maxCount&&l.items[u].restTime.delta>0&&(null==o||l.items[u].restTime.delta<o)&&(o=l.items[u].restTime.delta);badge.onLight(badge.action.LittleBoss,s),null!=e.expiredTimer&&(egret.clearTimeout(e.expiredTimer),e.expiredTimer=null),s||null==o||(e.expiredTimer=egret.setTimeout(t,null,o*Game.Second)),l.items.sort(a)}function a(e,t){return e.id-t.id}function r(e){var t=1;if(e>0){var n=table.littleBossCfg[e];t=null==n?100:n.level}return t}function o(){var e=0;for(var t in table.littleBossCfg)table.littleBossCfg[t].level>0&&(0==e||table.littleBossCfg[t].level<e)&&(e=table.littleBossCfg[t].level);return e}function s(){var t=e.current+1,n=table.littleBossCfg[t];return null==n?null:n.mapId}function l(){return r(e.current)}function u(){var t=table.littleBossCfg[e.current+1];
return r(null==t?e.current:e.current+1)}function c(e,t){null!=L&&(L.remainingTime.delta=t,L.updateRestTime())}function h(e){var t=v(e);if(0>t)return"";var i=n();return i.items[t].tips}function d(e){var t=v(e);if(0>t)return!1;var i=n();return i.items[t].enabled}function p(){net.socket.write(138,null)}function g(t){if(PlayerAttribute.bag.checkAndTipRoomSpace("Túi đã đầy, hãy thu xếp trước!"))return!0;var n=v(t);return 0>n?!1:n>e.current?!1:(UI.LittleBossInfo.open(n),!1)}function m(e,t){var i=n().items[e];if(!i.enabled)return i.enterCount>=i.maxCount?PopUpMessage.push(lang.String("challenge times fail"),color.RED):i.restTime.delta>0&&PopUpMessage.push(lang.String("boss reviving"),color.RED),!1;var a=n().items[e].id,r=new net.def.C2SEnterWildBossMap;return r.setId(a),r.setQuickFinish(t),net.socket.write(139,r.toArrayBuffer()),!0}function f(){Scene.listenEnterMap(e.sceneName,S),Scene.listenLeaveMap(e.sceneName,E),Scene.listenBosslifeChange(e.sceneName,I)}function v(e){var t=n();if(null!=t)for(var i=0;i<t.items.length;i++)if(t.items[i].mapId==e)return i;return-1}function y(e){var t=n();if(null!=t)for(var i=0;i<t.items.length;i++)if(t.items[i].mapId==e)return t.items[i];return null}function b(e){null!=e&&1==e.success&&UI.HUD.instance.showBattle()}function S(){var e=C(),t=v(World.mapId);t>=0?e.missionIndex=t:e.missionIndex=-1,UI.battle.addChild(e),t>=0?(e.txtBossName=n().items[t].name,e.npcPic=n().items[t].pic):(e.txtBossName="",e.npcPic="")}function E(){var e=L;null!=e&&(UI.battle.removeChild(e),e=null)}function C(){return null==L&&(L=new UI.LittleBossNote),L}function T(e){var t=new UI.WildBossEnd,i=v(World.mapId),a="";if(i>=0&&(a=n().items[i].pic),t.updateLittleBossData(e,a),e.getNewMapId()>0){RES.hasRes("ui/words.sheet")&&null==RES.getRes("ui/words.sheet")&&RES.asyncLoad("ui/words.sheet",function(){});var r=function(){return UI.FirstPassLittleBoss.open(e.getNewMapId()),!0};t.setCloseCallBack(r)}e.getQuick()?UIManager.push(t):egret.setTimeout(function(){UIManager.push(t)},null,2e3)}function I(e,t){null!=L&&L.updateBossHP(t,e)}function G(){for(var e=n(),t=u(),i=e.items.length,a=0;i>a;a++){var r=e.items[a];if(!(table.littleBossCfg[r.id].level>t)&&r.enabled)return!0}return!1}function A(){var e=0;return e>0}var k=function(){function t(e){this.id=e,this.enterCount=0,this.enabled=!1,this.restTime=new RemainingTime(0)}return Object.defineProperty(t.prototype,"name",{get:function(){return table.littleBossCfg[this.id].name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mapId",{get:function(){return table.littleBossCfg[this.id].mapId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxCount",{get:function(){return table.littleBossCfg[this.id].maxCount},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tips",{get:function(){var e="",t=this.maxCount-this.enterCount;return 0>t&&(t=0),e=lang.StringWithFormat("left count",t),0==t?e:this.restTime.deltaMillisecond<=0?(this.enabled=!0,e):(e+="\n",this.enabled?e:e+=lang.StringWithFormat("revive countdown",this.restTime.getMinuteSecond()))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pic",{get:function(){var e=table.maps[this.mapId];return null!=e?e.icon:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"first",{get:function(){return this.id>e.current},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"desc",{get:function(){return table.littleBossCfg[this.id].desc},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"awardsList",{get:function(){return table.littleBossCfg[this.id].awards},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resource",{get:function(){return table.littleBossCfg[this.id].resource},enumerable:!0,configurable:!0}),t}();e.Mission=k,__reflect(k.prototype,"LittleBoss.Mission");var P=function(){function e(){}return e.newInstance=function(){var t=new e;return t.init(),t},e.prototype.init=function(){this.items=[];var e=this.items;Object.getOwnPropertyNames(table.littleBossCfg).forEach(function(t,n,i){var a=table.littleBossCfg[t].id;e.push(new k(a))})},e}();e.Missions=P,__reflect(P.prototype,"LittleBoss.Missions"),e.sceneName="littleboss/littleboss";var w=null;e.current=0,e.getMissions=n,e.updateMissions=i,e.getOpenLevel=o,e.getNextMapId=s,e.getCurrentLevel=l,e.getNextLevel=u,e.updateStatus=c,e.getTips=h,e.canEnter=d,e.requestServerMissions=p,e.requestEnterLittleBossMap=g,e.sureEnterLittleBossMap=m,e.load=f,e.getLittleBossMissionIndex=v,e.getLittleBossMissionByMapId=y,e.onEnterLittleBossMapResult=b,e.onEnterMap=S,e.onLeaveMap=E;var L;e.getUiNote=C,e.onMissionEnd=T,e.updateHP=I,e.canQuickFinishAll=G,e.quickFinishAll=A}(LittleBoss||(LittleBoss={}));var Mail;!function(e){function t(){Game.dispatcher.dispatchEventWith(Game.EVENT.MailNewArrival)}function n(){net.socket.write(53,null)}function i(){var t=UI.MailUI.instance;t.maildata=[];for(var n=!1,i=[],a=[],r=0;r<e.mailTable.length;r++)0==e.mailTable[r].read?(i.push(e.mailTable[r]),n=!0):a.push(e.mailTable[r]);i.length>0?t.maildata=i.concat(a):t.maildata=a,null==t.parent?(UIManager.pushPage(t),t.onRefresh()):t.onRefresh(),badge.onLight(badge.action.MailNewArrival,!1)}function a(t,n,i){var a=UI.MailText.instance,r=e.mailMapTable[t],o=e.mailTable[r];i.length<=0&&(e.mailTable[r].read=!0),a.setMailtext(t,o.sender,o.title,o.sentTime,n,i),null==a.parent?(UIManager.pushPage(a),a.onRefresh()):a.onRefresh()}function r(e){var t=new net.def.C2SMail;t.setId(e),net.socket.write(54,t.toArrayBuffer())}e.onS2CNewmail=t,e.onC2SAskmailtitle=n,e.onS2CMailTitle=i,e.onS2CMailDetail=a,e.mailTable=[],e.onC2SMaildetail=r}(Mail||(Mail={}));var MasterChallenge;!function(e){function t(){Scene.listenEnterMap(m,i),Scene.listenLeaveMap(m,n)}function n(){null!=e.notePanel&&(UIManager.pop(e.notePanel),e.notePanel.btnExit.removeEventListener(egret.TouchEvent.TOUCH_TAP,h,null),e.notePanel=null)}function i(){e.notePanel=new UI.ChallengeNote,e.notePanel.second=90,e.notePanel.Id=e.gateId,UI.battle.addChild(e.notePanel),e.notePanel.currentState="master",e.notePanel.btnExit.addEventListener(egret.TouchEvent.TOUCH_TAP,h,this)}function a(){for(var e=0,t=0;t!=table.challenges.length;t++){var n=table.challenges[t].level;n>0&&(0==e||e>n)&&(e=n)}return e}function r(t){return PlayerAttribute.Level<table.challenges[t].level?void PopUpMessage.push(lang.StringWithFormat("open on level {1}",table.challenges[t].level),color.RED):t<e.MaxChapter&&e.challengeLeft<=0?void(e.ibLeft>0?UIManager.pushPage(UI.ChallengeTimes.instance):PopUpMessage.push(lang.String("challenge times fail"),color.GREEN)):t>e.MaxChapter?void PopUpMessage.push(lang.String("challenge previous gate fail"),color.GREEN):(UIManager.pop(UI.ChallengeCopyUI.instance),e.gateId=t,f=d(t),UI.HUD.instance.showBattle(),void o(t,!1))}function o(e,t){var n=new net.def.C2SMasterChallenge;n.chapter=e,null!=t&&t?net.socket.write(62,n.toArrayBuffer()):net.socket.write(58,n.toArrayBuffer())}function s(){UIManager.pushPage(UI.ChallengeCopyUI.instance)}function l(){"open"==d(e.MaxChapter)&&r(e.MaxChapter)}function u(t,n,i){e.finalPanel=new UI.ChallengeResult,e.finalPanel.panel.skinName="PanelWinSkin",e.finalPanel.panel.btnBack.visible=!1,e.finalPanel.currentState="succeed",e.finalPanel.Id=t,e.finalPanel.time=n,e.finalPanel.state=d(t),e.finalPanel.setAwardlist(i),v()}function c(t,n){switch(n){case 0:PopUpMessage.push(lang.String("challenge previous gate fail"),color.GREEN);break;case 3:PopUpMessage.push(lang.String("not enough anyCoin"),color.GREEN);break;case 1:case 2:case 4:e.finalPanel=new UI.ChallengeResult,e.finalPanel.currentState="fail",e.finalPanel.panel.skinName="PanelLoseSkin",e.finalPanel.panel.btnBack.visible=!1,e.finalPanel.Id=t,e.finalPanel.time=0,e.finalPanel.state=f,v.stop(),UIManager.push(e.finalPanel)}}function h(){net.socket.write(141,null)}function d(t){var n=PlayerAttribute.Level;return table.challenges[t].level>n?"closed":e.MaxChapter>t?"pass":t>e.MaxChapter?"closed":"open"}function p(t){e.MaxChapter<=0||(e.challengeLeft>0&&table.challenges[e.MaxChapter-1].level<=t||e.MaxChapter<e.ChapterCount&&table.challenges[e.MaxChapter].level<=t?badge.onLight(badge.action.MasterChallenge,!0):badge.onLight(badge.action.MasterChallenge,!1))}function g(e){var t=new net.def.C2SMasterChallenge;t.chapter=e,net.socket.write(62,t.toArrayBuffer())}e.MAXBAGROOM=5,e.EQUIPBAGROOM=4;var m="masterchallenge";e.ChapterCount=50,e.MaxChapter=0,e.challengeLeft=2,e.ibLeft=1;var f,v=MakeDelayExecute(function(){UIManager.pushPage(e.finalPanel)},null,1e3);e.init=t,e.getOpenLevel=a,e.onSignup=r,e.onC2SStart=o,e.openChallenge=s,e.signChallenge=l,e.onVectory=u,e.onFail=c,e.onC2SExit=h,e.getStagestate=d,e.makeBadge=p,e.auto=g}(MasterChallenge||(MasterChallenge={}));var Meridian;!function(e){function t(e,t,n){if(null==e){e={id:t[0],values:[]};for(var i=0;i<t.length-1;i++)e.values.push(0);59==e.id&&(e.values[0]=t[1])}return 59==e.id?e.values[1]+=t[2]*n:e.values[0]+=t[1]*n,e}function n(){e.acupoint==e.MaxAcupoints&&i(e.level),e.level++,e.attributes[e.id]=t(e.attributes[e.id],table.meridian.buffs[e.id],1);t(null,table.meridian.buffs[e.id],1);e.fp+=500;var n=e.level%(e.MaxAcupoints*e.MaxMeridians);n%e.MaxAcupoints==0?(e.acupoint=e.MaxAcupoints,Game.dispatcher.dispatchEventWith(Game.EVENT.MeridiansUpgrade)):(this.reload(),Game.dispatcher.dispatchEventWith(Game.EVENT.MeridiansLevelUp))}function i(t){if(e.level=t,e.level>=e.MaxLevel)e.grade=e.MaxGrade,e.id=e.MaxMeridians-1,e.acupoint=e.MaxAcupoints;else{var n=e.level%(e.MaxAcupoints*e.MaxMeridians);e.grade=int(e.level/(e.MaxAcupoints*e.MaxMeridians)),e.id=int(n/e.MaxAcupoints),e.acupoint=n%e.MaxAcupoints}}function a(){i(e.level),Game.dispatcher.dispatchEventWith(Game.EVENT.SyncMeridians)}function r(e){i(e),o(),Game.dispatcher.dispatchEventWith(Game.EVENT.SyncMeridians)}function o(){e.attributes={};for(var n=0;n<e.MaxMeridians;n++){e.attributes[n]=t(e.attributes[n],table.meridian.buffs[n],0);for(var i=0;i<e.grade;i++)e.attributes[n]=t(e.attributes[n],table.meridian.buffs[n],e.MaxAcupoints)}if(e.fp=500*e.level,!(e.level>=e.MaxLevel)){for(var n=0;n<e.id;n++)e.attributes[n]=t(e.attributes[n],table.meridian.buffs[n],e.MaxAcupoints);e.acupoint>0&&(e.attributes[e.id]=t(e.attributes[e.id],table.meridian.buffs[e.id],e.acupoint))}}function s(t){return e.useHuiXianDan>=e.MaxHuiXianDan?!1:!0}function l(){var t="#09e118";return e.useHuiXianDan>=e.MaxHuiXianDan&&(t="#09e118"),lang.StringWithFormat("use HuiXianDan {1}/{2}","<font color="+t+">"+e.useHuiXianDan+"</font>",e.MaxHuiXianDan)}function u(n){var i=e.attributes[n];return null==i&&(i=t(null,table.meridian.buffs[n],0)),Buff.GetDesc(i.id,i.values)}function c(n){var i,a=e.attributes[n];if(null!=a){i={id:a.id,values:[]};for(var r=a.values.length,o=0;r>o;o++)i.values.push(a.values[o])}return i=t(i,table.meridian.buffs[n],1),Buff.GetDesc(i.id,i.values)}function h(){for(var t="",n=0;n<e.MaxMeridians;n++){var i=e.attributes[n],a=""+t+Buff.GetName(i.id)+":  <font color='#0f5f5f5'>+{1}</font>\n";t=1==i.values.length?StringWithFormat(a,i.values[0]):StringWithFormat(a,i.values[1])}return t}e.useHuiXianDan=0,e.level=0,e.id=0,e.grade=0,e.acupoint=0,e.exp=0,e.MaxHuiXianDan=999,e.MaxGrade=20,e.MaxMeridians=8,e.MaxAcupoints=10,e.MaxLevel=e.MaxGrade*e.MaxMeridians*e.MaxAcupoints,e.fp=0,e.maiFnt=["rm","dm","cm","em","yw","zw","yq","zq"],e.gradeFnt=["j1","j1","j2","j3","j4","j5","j6","j7","j8","j9","j0","1","2","3","4","5","6","7","8","9","0"],e.levelUp=n,e.reload=a,e.load=r,e.CheckUseHuiXianDan=s,e.GetHuiXianDanDesc=l,e.getDesc=u,e.getNextDesc=c,e.getAllDesc=h}(Meridian||(Meridian={}));var MoneyTreeManager;!function(e){function t(e){r=e.getFinish(),o=e.getGainTimes(),s=e.getNextIrrigatePrice(),l=e.getNextIrrigateAward(),u=e.getGainAward(),c=e.getGainPeriod(),d=e.getCurIrrigateTimes(),h=table.moneytreeTimes[PlayerAttribute.vipItem.level].maxtimes-d,(0==s&&h>0||u>0)&&badge.onLight(badge.action.MoneyTree,!0),n()}function n(){var e=UI.WelfareHall.instance;if(null!=e&&null!=e.moneytree){if(r)return void(e.moneytree.currentState="finish");u>0?e.moneytree.currentState="gain":e.moneytree.currentState="irrigate",e.moneytree.gainTimes=o,e.moneytree.nextIrrigatePrice=s,e.moneytree.btnIrrigateText=s>0?lang.String("moneytree irrigate"):lang.String("free of charge"),e.moneytree.nextIrrigateAward=l,e.moneytree.gainAward=u,e.moneytree.gainPeriod=c,e.moneytree.leftIrrigateTimes=table.moneytreeTimes[PlayerAttribute.vipItem.level].maxtimes-d,e.moneytree.SetGainProgress(o,c)}}function i(){net.socket.write(247,null)}function a(){net.socket.write(248,null)}var r=!1,o=0,s=0,l=0,u=0,c=0,h=0,d=0;e.OnGetMoneyTreeInfo=t,e.updateUIData=n,e.Irrigate=i,e.Gain=a}(MoneyTreeManager||(MoneyTreeManager={}));var ChatSys;!function(e){function t(){e.messages.removeAll(),e.messages_System.removeAll(),e.messages_Guild.removeAll(),e.messages_World.removeAll(),e.messages_Map.removeAll(),e.messages_Private.removeAll(),e.messages_Private_Player.removeAll(),e.messages_Custom.removeAll()}function n(t,n,i){e.push2("",f.Sender_Identity_None,t,null,n,0,0,i,!0)}function i(t){e.push2("",f.Sender_Identity_None,t,null,e.channel_system,0,0,"",!0)}function a(t,n,i,a,l,u,c,h,d){if(null==BlackList.blacklist[t]){var p=t,g=e.chanelcolor[l],m=[];n!=f.Sender_Identity_None&&m.push({kind:Game.TextElementKind.Text,text:lang.String(v[n]),style:{textColor:g}}),p&&""!=p&&m.push({kind:Game.TextElementKind.Text,text:p+":",style:{textColor:color.ChatPlayerName}});for(var y=Game.TextParser.parse(i,a),b=[],S=0;S<y.length;S++){var E=y[S];if(E.kind==Game.TextElementKind.Text&&(E.style?E.style.textColor=g:E.style={textColor:g}),E.kind==Game.TextElementKind.Image){var C=E.value;E.value=new eui.Image(C.source),E.value.x=C.x,E.value.y=0,E.value.scaleX=.5,E.value.scaleY=.5;var T={kind:E.kind,text:E.text,value:C,style:{size:14}};b.push(T)}else b.push(E)}r(m,p,b,u,l,d,e.messages);var I="";switch(l){case e.channel_system:r(m,p,y,u,l,d,e.messages_System);break;case e.channel_guild:r(m,p,y,u,l,d,e.messages_Guild);break;case e.channel_world:r(m,p,y,u,l,d,e.messages_World);break;case e.channel_map:r(m,p,y,u,l,d,e.messages_Map);break;case e.channel_custom:r(m,p,y,u,l,d,e.messages_Custom);break;case e.channel_private:I=p,p==Player.instance.Name?(I=h,o(m,p,I,i,c,d)):(I=p,RecentContact.addrecentContact(p,u),o(m,p,I,i,u,d)),r(m,p,y,u,l,d,s(I))}if(e.latestChannel=l,e.latestParam=I,Game.dispatcher.dispatchEventWith(Game.EVENT.onChatReceived),l!=UI.ChatDetail.instance.curchannel||l==e.channel_private&&e.curChanelName!=I&&t!=Player.instance.Name){switch(l){case e.channel_guild:e.newMsg_Guild=!0;break;case e.channel_map:e.newMsg_Map=!0}Game.dispatcher.dispatchEventWith(Game.EVENT.onNewChatReceived,!1,l)}}}function r(e,t,n,i,a,r,o){o.length>20&&o.removeItemAt(0);var s=Game.getServerDate(),l="  "+NumberFormat(s.getHours(),2)+":"+NumberFormat(s.getMinutes(),2)+":"+NumberFormat(s.getSeconds(),2);t==Player.instance.Name&&0==r?o.addItem({realname:t,name:e,textElements:n,state:"my",faction:i,chanel:a,bSysMsg:r,timeStamp:l}):o.addItem({realname:t,name:e,textElements:n,state:"other",faction:i,chanel:a,bSysMsg:r,timeStamp:l})}function o(t,n,i,a,r,o){var s=!0;n==Player.instance.Name&&(s=!1);for(var l=0;l<e.messages_Private.length;l++)if(e.messages_Private.getItemAt(l).privatename==i)return void e.messages_Private.replaceItemAt({name:t,privatename:""+i,message:" "+a,faction:r,newMsg:s,bSysMsg:o},l);e.messages_Private.addItem({name:t,privatename:""+i,message:" "+a,faction:r,newMsg:s,bSysMsg:o})}function s(t){for(var n=0;n<e.messages_Private_Player.length;n++)if(e.messages_Private_Player.getItemAt(n).name==t)return e.messages_Private_Player.getItemAt(n).content;var i=new eui.ArrayCollection;return e.messages_Private_Player.addItem({name:""+t,content:i}),i}function l(t,n){t==e.channel_private&&""!=n?e.curChanelName=n:e.curChanelName=lang.String(e.chanelname[t])}function u(){return e.curChanelName}function c(e,t){e!=Player.instance.Name&&(UIManager.push(UI.ChatDetail.instance),UI.ChatDetail.instance.privateChatTgtFaction=t,Game.dispatcher.dispatchEventWith(Game.EVENT.SelectPrivateChanel,!1,e))}function h(t){switch(t){case e.channel_guild:return e.newMsg_Guild;case e.channel_map:return e.newMsg_Map;case e.channel_private:for(var n=0;n<e.messages_Private.length;n++)if(1==e.messages_Private.getItemAt(n).newMsg)return!0;return!1;default:return!1}}function d(t){switch(t){case e.channel_guild:e.newMsg_Guild=!1;break;case e.channel_map:e.newMsg_Map=!1}}function p(t,n){var i=new net.def.C2SChat;i.attachments=new net.def.ChatAttachments,i.setChannelId(e.channel_private),i.setMessage(n),i.setParam(t),net.socket.write(11,i.toArrayBuffer())}function g(t){e.customChannelSubId>0&&e.customChannelSubId!=t&&m(e.customChannelSubId),e.customChannelSubId=t,UI.ChatDetail.instance.registerCustomChannel()}function m(t){t==e.customChannelSubId&&(e.messages_Custom.removeAll(),e.customChannelSubId=0,UI.ChatDetail.instance.unRegisterCustomChannel())}e.chanelname=new Array("chanel name none","chanel name system","chanel name guild","chanel name world","chanel name map","chanel name private","chanel name custom"),e.chanelcolor=new Array(color.ChatDefalt,color.ChatDefalt,color.ChatChannelGuild,color.ChatChannelWorld,color.ChatChannelNear,color.ChatChannelPrivate,color.ChatChannelGuild);var f;!function(e){e[e.Sender_Identity_None=0]="Sender_Identity_None",e[e.Sender_Identity_Guild_Leader=1]="Sender_Identity_Guild_Leader",e[e.Sender_Identity_Guild_ViceLeader=2]="Sender_Identity_Guild_ViceLeader"}(f=e.Identity||(e.Identity={}));var v=new Array("chat sender identity guild none","chat sender identity guild leader","chat sender identity guild vice leader");e.channel_system=1,e.channel_guild=2,e.channel_world=3,e.channel_map=4,e.channel_private=5,e.channel_custom=6,e.customChannelSubId=0,e.sysheadpic="icon/chatHead/headsys.png",e.messages=new eui.ArrayCollection,e.messages_System=new eui.ArrayCollection,e.messages_Guild=new eui.ArrayCollection,e.messages_World=new eui.ArrayCollection,e.messages_Map=new eui.ArrayCollection,e.messages_Private=new eui.ArrayCollection,e.messages_Private_Player=new eui.ArrayCollection,e.messages_Custom=new eui.ArrayCollection,e.latestChannel=e.channel_world,e.latestParam="",e.curChanelName="",e.newMsg_Guild=!1,e.newMsg_Map=!1,e.clearAllChannel=t,e.sendSystemMsg=n,e.pushSys=i,e.push2=a,e.getPrivateChanelMessages=s,e.setChannelName=l,e.getChannelName=u,e.createNewPrivateChannel=c,e.checkNewMsg=h,e.updateNewMsg=d,e.sendPrivateMsg=p,e.registerCustomChannel=g,e.unRegisterCustomChannel=m}(ChatSys||(ChatSys={}));var NienBoss;!function(e){function t(){e.activity=new Activity.MissionActivity(Activity.ActivityKind.Activity_NienBoss);var t=RES.getRes("public_config/operation/nienbossmanager/nienbossmanager.json");e.activity.profiles=t.profile,e.activity.initSelf=function(){e.config=e.activity.settings;for(var t=0;t!=Reminder.events.length;t++)Reminder.events[t].id==Reminder.EventName.NienBoss&&(Reminder.events[t].name=e.config.activityName,Reminder.events[t].icon=e.config.activityIcon);e.waitLoading&&(e.waitLoading=!1,a()),e.open&&e.sceneOpen&&Reminder.PushReminder(Reminder.EventName.NienBoss,3*Game.Minute,"Vào phó bản")}}function n(){Scene.listenEnterMap(e.NienBossScene,i),Scene.listenLeaveMap(e.NienBossScene,r),Scene.listenBosslifeChange(e.NienBossScene,o)}function i(){null==e.config?e.waitLoading=!0:a()}function a(){UIManager.pop(UI.NienBossNote.instance),UI.battle.addChild(UI.NienBossNote.instance);var t=e.config.boss.npcId,n=table.npcs[t];UI.NienBossNote.instance.txtBossName=n.name,UI.NienBossNote.instance.npcPic=n.icon,UI.NienBossNote.instance.updateData(),UI.setDisableAllPlayerTitles(!0),SuperWeapon.disableAllPlayersEffect(!0),SecondTicker.addEventListener(s,null)}function r(){UI.battle.removeChild(UI.NienBossNote.instance),UI.setDisableAllPlayerTitles(!1),SuperWeapon.disableAllPlayersEffect(!1),SecondTicker.removeEventListener(s,null),e.curBossLife<=0&&egret.setTimeout(function(){var e=new UI.NienBossDetailPanel;e.currentState="result",UIManager.pushPage(e)},null,2e3)}function o(t,n){e.curBossLife=t,UI.NienBossNote.instance.updateBossHP(n,t)}function s(){null!=e.bossInfoStage&&e.bossInfoStage.leftTime>0&&e.bossInfoStage.leftTime--}function l(){return null!=e.bossInfoOpenState&&e.bossInfoOpenState.getOpen()&&e.bossInfoOpenState.getSceneOpen()?PlayerAttribute.Level<e.config.levelLimit?void PopUpMessage.push(lang.StringWithFormat("nienboss need level {1}",e.config.levelLimit),color.RED):(badge.onLight(badge.action.NienBoss,!1),void net.socket.write(2084,null)):void PopUpMessage.push(lang.String("nienboss activity not open"),color.RED)}function u(t){e.open=t.getOpen(),e.sceneOpen=t.getSceneOpen(),this.bossInfoOpenState=t,e.open&&e.sceneOpen?(null!=e.config&&Reminder.PushReminder(Reminder.EventName.NienBoss,3*Game.Minute,"Vào phó bản"),badge.onLight(badge.action.NienBoss,!0)):badge.onLight(badge.action.NienBoss,!1)}function c(t){return e.config.awards.objAward[t]}e.config=null,e.NienBossScene="nienboss",e.COLLECT_INTERVAL=2,e.STAGE_KILLBOSS=1,e.STAGE_END=2,e.bossInfoStage=null,e.bossInfoRank=null,e.bossInfoAward=null,e.bossInfoOpenState=null,e.open=!1,e.sceneOpen=!1,e.curBossLife=0,e.waitLoading=!1,e.loadActivity=t,e.Load=n,e.EnterScene=i,e.enterScene=a,e.LeaveScene=r,e.updateHP=o,e.ApplyJoin=l,e.onSyncOpenState=u,e.getObjAward=c}(NienBoss||(NienBoss={}));var OpeningWheel;!function(e){function t(t){if(!e.activity.inTime())return PopUpMessage.push(lang.String("out of time"),color.RED),!1;var n=new net.def.C2SRollHolidayWheel;return n.tenTimes=t,net.socket.write(231,n.toArrayBuffer()),!0}function n(){net.socket.write(232,null)}function i(e){var t=net.def.S2CNotifyHolidayWheel.decode(e);t.running?Game.dispatcher.dispatchEventWith(Game.EVENT.NotifyOpeningWheel,!1,t.prizes):a(t.prizes)}function a(t){for(var n=new UI.AwardResult,i=[],a=0,r=t;a<r.length;a++){var o=r[a];i.push(e.config[o])}n.setAwards(i),UIManager.push(n)}function r(e){var t=new net.def.Index;t.index=e,net.socket.write(233,t.toArrayBuffer())}function o(t){return e.shopDrawCounts[t]||0}function s(){e.activity=new Activity.MissionActivity(Activity.ActivityKind.Activity_Wheel),e.activity.eventName=Game.EVENT.OpeningWheelOpen;var t=RES.getRes("public_config/operation/openingwheel/openingwheel.json");e.activity.profiles=t.profile,e.activity.initSelf=function(){e.config=e.activity.settings.cells;var t=e.activity.settings.goods;e.shopConfig=[];for(var n=0;n<t.length;n++){for(var i=[],a=0;a<t[n].items.length;a++)i.push({type:"item",content:t[n].items[a]});e.shopConfig.push({idx:n,items:i,price:t[n].price,chance:t[n].chance})}},net.Register(323,i),net.Register(325,u),net.Register(324,l)}function l(t){var n=net.def.Currency.decode(t);e.currency=n.value,Game.dispatcher.dispatchEventWith(Game.EVENT.OpeningWheelCurrencyChanged)}function u(t){var n=net.def.S2CHolidayWheelShop.decode(t);c(n.times),e.currency=n.currency,Game.dispatcher.dispatchEventWith(Game.EVENT.OpeningWheelCurrencyChanged)}function c(t){e.shopDrawCounts=t,Game.dispatcher.dispatchEventWith(Game.EVENT.OpeningWheelShopChance)}function h(t){e.shopDrawCounts[t]+=1,Game.dispatcher.dispatchEventWith(Game.EVENT.OpeningWheelShopResult,!1,t)}function d(t){e.FreeTimes=t,Game.dispatcher.dispatchEventWith(Game.EVENT.OnSyncOpenningWheelFreeTimes)}e.cost=30,e.cost10=288,e.currency=0,e.FreeTimes=0,e.roll=t,e.draw=n,e.buy=r,e.getDrawTimes=o,e.config=[],e.load=s,e.syncChance=c,e.syncResult=h,e.OnSyncOpenningWheelFreeTimes=d}(OpeningWheel||(OpeningWheel={}));var Partner;!function(e){function t(){var t=vt-e.times1;return 0>t?t:t}function n(){var t=vt-e.times2;return 0>t?t:t}function i(){null!=It&&(egret.clearTimeout(It),It=null);for(var t,n=0;n<e.recruitCDs.length;n++)e.recruitCDs[n].delta-3<=0?PlayerAttribute.Level>=e.RecruitLimitLevel&&badge.onLightPartnerEnlist(n,!0):(null==t||t>e.recruitCDs[n].delta)&&(t=e.recruitCDs[n].delta);null!=t&&(It=egret.setTimeout(a,null,t*Game.Second))}function a(){i()}function r(){var e=Y(1);if(null!=e){var t=$(e.id);if(null!=t&&t.rageSkillId>0){var n=Skill.mapSkill[t.rageSkillId];return{skillId:t.rageSkillId,skillName:n.name}}}return null}function o(){var e=Y(1);if(null!=e){var t=M(e),n=$(e.id);if(null!=n&&n.rageSkillId>0&&t>0){var i={id:n.rageSkillId,level:t};return Skill.mapSkill[i.id].desc,i}}return{id:PlayerAttribute.DefaultRageSkillId,level:1}}function s(){for(var t=PlayerAttribute.Level,n="-",i=0;i<e.levelWorkPosLimit.length&&!(t>=e.levelWorkPosLimit[i].level);i++)n=""+e.levelWorkPosLimit[i].level;return n}function l(){for(var t=0,n=0;n<e.workList.length&&e.workList[n]>0;n++)t+=u(e.workList[n]);return t}function u(e){var t=j(e);return d(t,null)}function c(e,t){var n=j(e);return d(n,t)}function h(e,t,n){null==t&&(t=e.attr);var i=$(e.id);if(n>=0&&n<t.length){var a=(i.baseAttr[n][0],t[n]*e.level/10);return a+=i.baseAttr[n][2],[~~a]}return[0]}function d(e,t){if(null==e)return 0;null==t&&(t=e.attr);var n=0,i=$(e.id),a=K(e.id);if(null!=i&&a){for(var r=0;r<t.length;r++)n+=Buff.GetFightingPower(i.baseAttr[r][0],h(e,t,r));n+=~~(x(e)*a.power/Q(i.quality))}return n}function p(t){if(t instanceof Item.Prop&&8==t.Genre){var n=t,i=$(n.DetailType);if(null!=j(n.DetailType))return lang.String("already has this partner");var a=e.composeCost[i.quality];return t.Count<a?lang.StringWithFormat("need {1} pieces to compose",a):""}return"?"}function g(e,t){var n=p(e);return""!=n?(t&&"?"!=n&&PopUpMessage.push(n,color.RED),!1):!0}function m(){for(var t=0,n=0;n<e.workList.length&&e.workList[n]>0;n++)t++;return t}function f(e){return bt[e]}function v(e){return St[e]}function y(e){return yt[e-1]}function b(t){return null!=e.lastRecruitResult&&t>=0&&t<e.lastRecruitResult.awards.length?e.lastRecruitResult.awards[t]:null}function S(t){if(null!=e.lastRecruitResult&&t<e.lastRecruitResult.awards.length)for(var n=Math.max(0,t+1);n<e.lastRecruitResult.awards.length;n++)if(4==e.lastRecruitResult.awards[n].type)return n;return-1}function E(t){if(t%2==1){var n=~~((t-1)/2);return e.recruitCDs[n].delta<=0}return!1}function C(t){var n=~~((t-1)/2),i='<font color="#FF0000">'+e.recruitCDs[n].getHourMinuteSecond()+"</font>";return lang.StringWithFormat("free after some time{1}",i)}function T(e,t){var n=y(e);if(E(e))return!0;var i=0;switch(n.type){case Game.Currency.SilverCoin:i=PlayerAttribute.currency[Game.Currency.GoldCoin]+PlayerAttribute.currency[Game.Currency.SilverCoin];break;case Game.Currency.CopperCoin:i=PlayerAttribute.currency[Game.Currency.CopperCoin]}if(i<n.num){if(t)switch(n.type){case Game.Currency.SilverCoin:PopUpMessage.push(lang.String("not enough goldcoin"),color.RED);break;case Game.Currency.CopperCoin:PopUpMessage.push(lang.String("not enough copperCoin"),color.RED)}return!1}return!0}function I(e,t){var n=y(e);return PlayerAttribute.bag.capacity(Game.BagPage.Material)<n.times?(t&&PopUpMessage.push(lang.StringWithFormat("bag room full{1}",n.times),color.RED),!1):!0}function G(e){if(!g(e,!0))return!1;var t=e,n=new net.def.C2SPartnerId;return n.setId(t.DetailType),net.socket.write(259,n.toArrayBuffer()),!0}function A(t){if(PlayerAttribute.Level<e.RecruitLimitLevel)return PopUpMessage.push(lang.StringWithFormat("recruit partner level limit{1}",e.RecruitLimitLevel),color.RED),!1;if(!T(t,!0))return!1;if(!I(t,!0))return!1;e.recruiting=!0;var n=new net.def.C2SPartnerRecruit;return n.setType(t),n.setFree(E(t)),net.socket.write(250,n.toArrayBuffer()),!0}function k(e,t){var n=j(e);if(null==n)return!1;n.lock=!0;var i=new net.def.C2SPartnerResetAttrib;return i.setId(e),i.setLock(t),net.socket.write(252,i.toArrayBuffer()),!0}function P(e){var t=new net.def.C2SPartnerId;return t.setId(e),net.socket.write(253,t.toArrayBuffer()),!0}function w(e){var t=j(e);if(null==t)return!1;t.lock=!0;var n=new net.def.C2SPartnerId;return n.setId(e),net.socket.write(254,n.toArrayBuffer()),!0}function L(e){var t=j(e);if(null==t||t.workPos<=1)return!1;var n=new net.def.C2SPartnerApplyCaptain;return n.setPos(t.workPos),net.socket.write(258,n.toArrayBuffer()),!0}function R(e){var t=m();if(t>=nt())return PopUpMessage.push(lang.String("work partner list full"),color.RED),!1;var n=(Player.instance,t+1);if(null==Y(n)&&null!=j(e)){var i=new net.def.C2SPartnerEquip;return i.setId(e),i.setPos(n),net.socket.write(255,i.toArrayBuffer()),!0}return!1}function U(e){Player.instance;if(null!=Y(e)){if(!PartnerEquipManager.PartnerRestCheck(e-1))return!1;var t=new net.def.C2SPartnerUnEquip;return t.setPos(e),net.socket.write(256,t.toArrayBuffer()),!0}return!1}function _(e,t){t=Math.min(t,32767);var n=0,i=t;if(i>0){var a=new net.def.C2SPartnerEatExpItem;return a.setId(e),a.setIndex(n),a.setNum(i),net.socket.write(249,a.toArrayBuffer()),!0}return!1}function x(e){return null==e?0:e.breakthrough[0]}function M(t){return~~(x(t)/e.partnerBreakthroughThreshold)+1}function D(t){return~~(t/e.partnerBreakthroughThreshold)*e.partnerBreakthroughThreshold}function N(e,t,n){return 0}function F(t,n,i,a){if(PlayerAttribute.Level<e.BreakThroughLimitLevel)return PopUpMessage.push(lang.StringWithFormat("allow breakthrough when player level reach {1}",e.BreakThroughLimitLevel),color.RED),!1;var r=j(t),o=K(t);if(null==r||null==o)return!1;var s=x(r),l=B(t,s+10,n);if(null==l)return PopUpMessage.push(lang.String("already max partner level"),color.RED),!1;var u=D(r.level);if(x(r)>=u)return a&&(H(r)?PopUpMessage.push(lang.String("already max partner and breakthrough level"),color.RED):PopUpMessage.push(lang.String("already max breakthrough level"),color.RED)),!1;var c=O(n);if(c>Et)return!1;if(PlayerAttribute.currency[Game.Currency.CopperCoin]<l.copperCoin)return a&&(PopUpMessage.push(lang.String("not enough copperCoin"),color.RED),UI.ResourceObtain.Open([UI.ObtResId.CopperCoin])),!1;if(PlayerAttribute.bag.CalcCount(l.g,l.d)<l.n){if(a){var h=table.props[l.g][l.d];PopUpMessage.push(lang.StringWithFormat("item {1} not enough",h.name),color.RED),UI.ResourceObtain.Open([UI.ObtResId.breakThroughItem])}return!1}if(PlayerAttribute.bag.CalcCount(8,t)<l.pieces){if(a){var d=lang.String("partner pieces");PopUpMessage.push(lang.StringWithFormat("item {1} not enough",d),color.RED)}return!1}return!0}function O(e){for(var t=0,n=0;Tt>n;n++){var i=1<<n;0!=(e&i)&&t++}return t}function B(t,n,i){var a=K(t),r=$(t),o=Ct;if(null!=a&&null!=r&&n>=1&&n<=Q(r.quality)){var s=~~((n-1)/e.partnerBreakthroughThreshold),l=a.cost[s],u=l.costCopperCoin,c=0;return n%e.partnerBreakthroughThreshold==0&&(c=l.costPiecces),{g:l.costNor.g,d:l.costNor.d,n:l.costNor.n,pieces:c,gold:o,copperCoin:u}}return null}function W(e,t){var n=j(e),i=K(e);return null==n||null==i?!1:x(n)<=0?(t&&PopUpMessage.push(lang.String("partner not breakthrough"),color.RED),!1):PlayerAttribute.bag.capacity(Game.BagPage.Material)<2?(t&&PopUpMessage.push(lang.StringWithFormat("bag room full{1}",2),color.RED),!1):!0}function V(e,t,n){if(!F(e,t,n,!0))return!1;var i=new net.def.C2SPartnerBreakThrough;return i.setId(e),i.setLock(t),net.socket.write(260,i.toArrayBuffer()),!0}function q(e){if(!W(e,!0))return!1;var t=new net.def.C2SPartnerId;return t.setId(e),net.socket.write(261,t.toArrayBuffer()),!0}function H(e){var t=$(e.id);return null!=t&&Q(t.quality)==e.level}function j(t){var n=e.idMap[t];return null!=n?e.list[n]:null}function Y(t){var n=e.workList[t-1];return j(n)}function K(e){var t=$(e);return null!=t?Z(t.quality):null}function Q(t){return e.partnerLvLimit[t]}function X(e){return null!=e?'<font color="'+egret.toColorString(Item.QualityColor[e.quality])+'">'+e.name+"</font>":""}function J(e,t,n){if(null==e)return"";var i=lang.StringWithFormat("partner type:{1}","<font color='"+egret.toColorString(color.Title1_Value)+"'>"+e.desc+"</font>");return null!=n&&(i+="\n"+lang.StringWithFormat("fp:{1}","<font color='"+egret.toColorString(color.Title1_Value)+"'>"+n+"</font>")),null!=t&&(i+="\n"+lang.StringWithFormat("level:{1}","<font color='"+egret.toColorString(color.Title1_Value)+"'>"+t+"</font>")),i+="\n"+Buff.GetDesc(e.baseAttr[0][0],[e.baseAttr[0][2]],!0),i+="\n"+Buff.GetDesc(e.baseAttr[1][0],[e.baseAttr[1][2]],!0),i+="\n"+Buff.GetDesc(e.baseAttr[2][0],[e.baseAttr[2][2]],!0),i+="\n"+Buff.GetDesc(e.baseAttr[3][0],[e.baseAttr[3][2]],!0)
}function z(t,n){var i;if(null==n?(n=1,i=!1):i=!0,t.talentSkill>0){var a=lang.StringWithFormat("partner talentskill:{1}","<font color='"+egret.toColorString(color.Title1_Value)+"'>"+Features.TalentSkill.instance.GetSkillName(t.talentSkill)+"</font>");return a+="\n"+Features.TalentSkill.instance.GetSkillDesc(t.talentSkill,n,i,!1)}if(t.rageSkillId>0){var r=Skill.mapSkill[t.rageSkillId];if(null!=r){var a=lang.StringWithFormat("partner talentskill:{1}","<font color='"+egret.toColorString(color.Title1_Value)+"'>"+e.getSkillName(t)+"</font>");return a+="\n"+r.GetDesc(n,PlayerAttribute.Level),n&&i?"<font color='"+egret.toColorString(color.Title1)+"'>"+a+"</font>":"<font color='"+egret.toColorString(color.Title1)+"'>"+a+"</font>"}}}function Z(e){return e>=1&&e<=table.partnerBreakthrough.length?table.partnerBreakthrough[e-1]:null}function $(e){return e>=1&&e<=table.partnerCfg.length?table.partnerCfg[e-1]:null}function et(e){return e>=1&&e<=table.partnerExp.length?table.partnerExp[e-1].exp:0}function tt(e){for(var t=0,n=1;e>n;n++)t+=et(n);return t}function nt(){for(var t=PlayerAttribute.Level,n=0,i=0;i<e.levelWorkPosLimit.length;i++)if(t>=e.levelWorkPosLimit[i].level){n=e.levelWorkPosLimit[i].openCnt;break}for(var i=0;i<e.levelWorkPosVipAward.length;i++)if(PlayerAttribute.vipItem.level>=e.levelWorkPosVipAward[i].level){n=Math.max(n,e.levelWorkPosVipAward[i].openCnt);break}return n}function it(t,n){var i=j(t);if(null!=i){for(var a=i.level,r=n*e.partnerItemExp+i.exp,o=i.level,s=PlayerAttribute.Level;s>o;o++)r>=table.partnerExp[a-1].exp&&(r-=table.partnerExp[a-1].exp,a++);return{level:a,exp:r}}return null}function at(e,t){var n=j(e),i=j(t);if(null==n||null==i)return null;for(var a=n.level,r=n.exp,o=1;a>o;o++)r+=table.partnerExp[o-1].exp;for(var s=i.level,l=i.level,u=i.level,c=r,h=PlayerAttribute.Level;h>u;u++)c>=table.partnerExp[l-1].exp&&(c-=table.partnerExp[l-1].exp,l++);return{exp:r,curLevel:s,newLevel:l}}function rt(e){if(null==e)return 0;var t=$(e.id),n=10-e.workPos;e.workPos<=0&&(n=0);var i=100*n*100+100*t.quality+e.level;return i}function ot(e,t){var n=rt(e),i=rt(t);return i-n}function st(){e.list.sort(ot),e.idMap={};for(var t=e.list.length,n=0;t>n;n++){var i=e.list[n];if(null==i){for(var a=n;t>a;a++)e.list.pop();break}i.index=n,e.idMap[i.id]=n}}function lt(t,n){if(0==t.level){var i=e.idMap[t.id];return null!=i?(e.list[i]=null,delete e.idMap[t.id]):egret.error("[partner] remove undefined partner id",t.id),st(),void Game.dispatcher.dispatchEventWith(Game.EVENT.PartnerCountChange)}var a={id:t.id,level:t.level,exp:t.exp,attr:t.attrValues,breakthrough:t.breakthroughValues,index:e.list.length,workPos:0,lock:!1};null==e.idMap[t.id]?dt(a):pt(a),1==a.workPos&&PlayerAttribute.UpdateRageSkill(!1)}function ut(e){if(e.rageSkillId>0){var t=Skill.mapSkill[e.rageSkillId];if(null!=t)return t.name}if(e.talentSkill>0){var t=Features.TalentSkill.instance.GetSkillCfg(e.talentSkill);if(null!=t)return t.name}return lang.String("None")}function ct(e){if(e.rageSkillId>0){var t=Skill.mapSkill[e.rageSkillId];if(null!=t)return t.icon}if(e.talentSkill>0){var t=Features.TalentSkill.instance.GetSkillCfg(e.talentSkill);if(null!=t)return t.icon}return lang.String("")}function ht(e,t,n,i){var a=t;if(0>=a&&(a=1),e.rageSkillId>0){var r=Skill.mapSkill[e.rageSkillId];if(null!=r){var o=r.GetDesc(a,PlayerAttribute.Level);return t==a&&n?'<font color="#EDC755">'+o+"</font>":'<font color="#BCBCB8">'+o+"</font>"}}if(e.talentSkill>0){var r=Features.TalentSkill.instance.GetSkillCfg(e.talentSkill);if(null!=r)return Features.TalentSkill.instance.GetDesc(r,t,n,i)}return""}function dt(t){t.index=e.list.length,e.idMap[t.id]=t.index,e.list.push(t),st(),t.workPos>0&&PlayerAttribute.UpdateFightingPower(!e.firstSync),Game.dispatcher.dispatchEventWith(Game.EVENT.PartnerCountChange)}function pt(t){var n=e.idMap[t.id];t.index=n,t.workPos=e.list[n].workPos;var i=e.list[n].lock,a=e.list[n].level<t.level?!0:!1;e.list[n]=t,st(),t.workPos>0&&!i&&PlayerAttribute.UpdateFightingPower(!e.firstSync),a&&badge.checkPartnerEquipOnWorkPartner(),Game.dispatcher.dispatchEventWith(Game.EVENT.PartnerDataChange)}function gt(t){var n=$(t);if(null!=j(t))return lang.String("already has this partner");var i=e.composeCost[n.quality],a=PlayerAttribute.GetItemCount(8,t);return i>a?lang.StringWithFormat("need {1} pieces to compose",i):""}function mt(e){var t=gt(e);return""!=t?!1:!0}function ft(e){if(!mt(e))return!1;var t=new net.def.C2SPartnerId;return t.setId(e),net.socket.write(259,t.toArrayBuffer()),!0}e.workList=[],e.list=[],e.idMap={},e.recruitCDs=[new RemainingTime,new RemainingTime],e.freeTime=0,e.MaxFreeTime=5,e.partnerItemExp=300,e.BreakThroughLimitLevel=21,e.RecruitLimitLevel=15;var vt=20;e.restTimes1=t,e.restTimes2=n,e.levelWorkPosLimit=[{level:50,openCnt:4},{level:45,openCnt:3},{level:35,openCnt:2},{level:20,openCnt:1}],e.levelWorkPosVipAward=[{level:10,openCnt:4},{level:7,openCnt:3},{level:3,openCnt:2},{level:3,openCnt:1}],e.WorkPosLevel=[20,35,45,50],e.WorkPosVIP=[3,3,7,10];var yt=[{type:2,num:3e4,times:1},{type:2,num:27e4,times:10},{type:1,num:300,times:1},{type:1,num:2640,times:10}];e.composeCost=[0,0,10,20,40,60],e.partnerLvLimit=[0,0,80,100,120,150],e.maxWorkPartnerCnt=4;var bt=["","C","B","A","S","SS"],St=["","ui/pet/pet_c.png","ui/pet/pet_b.png","ui/pet/pet_a.png","ui/pet/pet_s.png","ui/pet/pet_ss.png"];e.partnerBreakthroughThreshold=10;var Et=2,Ct=25,Tt=4;e.firstSync=!0;var It;e.enlistNotice=i,e.GetMainPartnerRageSkillInfo=r,e.GetRageSkill=o,e.GetNextOpenPosLevel=s,e.GetTotalPower=l,e.GetPower=u,e.GetWashBonePower=c,e.GetPartnerPower=d,e.GetComposePartnerDesc=p,e.CheckComposePartner=g,e.getWorkPartnerCount=m,e.getQualityStr=f,e.getQualityIcon=v,e.getRecruitPartnerCost=y,e.getLastRecruitAward=b,e.getNextPartnerAward=S,e.checkFreeRecruitCD=E,e.getFreeRecruitCDString=C,e.checkRecruitCost=T,e.checkRecruitBagRoom=I,e.ApplyComposePartner=G,e.ApplyRecruitPartner=A,e.recruiting=!1,e.ApplyResetPartner=k,e.ApplyAgreePartnerAttr=P,e.ApplyRestorePartnerAttr=w,e.ApplyBeenCaptain=L,e.ApplyEquipPartner=R,e.ApplyUnEquipPartner=U,e.ApplyEatExpItem=_,e.getBreakthroughLevel=x,e.getTalentSkillLevel=M,e.getMaxBreakthroughLevel=D,e.getBreakthroughAttr=N,e.checkBreakthrough=F,e.getBreakthroughCost=B,e.checkResetBreakthrough=W,e.ApplyPartnerBreakthrough=V,e.ApplyResetPartnerBreakthrough=q,e.IsPartnerMaxLevel=H,e.GetPartnerObj=j,e.GetWorkPartnerObj=Y,e.GetBreakthroughCfg=K,e.GetPartnerLevelLimit=Q,e.GetPartnerName=X,e.GetPartnerBaseDesc=J,e.GetPartnerSkillDesc=z,e.GetPartnerCfg=$,e.GetLevelExpCfg=et,e.GetTotalLevelExpCfg=tt,e.GetOpenWorkPos=nt,e.GetPreviewExpLevel=it,e.calcInheritPreview=at,e.getSortValue=rt,e.SortPartnerList=st,e.onSyncPartnerWithMessage=lt,e.getSkillName=ut,e.getSkillIcon=ct,e.getSkillDesc=ht,e.CheckComposePartnerById=mt,e.ApplyComposePartnerById=ft}(Partner||(Partner={}));var PartnerEquipEnhance;!function(e){function t(){Game.dispatcher.addEventListener(Game.EVENT.AddItem,g,null),Game.dispatcher.addEventListener(Game.EVENT.RemoveItem,g,null),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,g,null),Game.dispatcher.addEventListener(Game.EVENT.PartnerDataChange,m,null),Game.dispatcher.addEventListener(Game.EVENT.PartnerWorkPosChange,m,null),Game.dispatcher.addEventListener(Game.EVENT.PartnerEquipSync,m,null);for(var t=RES.getRes("public_config/partnerequip/enhance.json"),n=0;n!=t.length;n++){var i=t[n],a=i.partId;e.config[a]={};for(var r=0;r!=i.levels.length;r++){var o=i.levels[r],s=o.level;e.config[a][s]=o}}}function n(t,n){return e.config[t]?e.config[t][n]:null}function i(t,n){if(o(t,n)){e.oldData=e.enhanceData,e.curSelectPartnerIndex=t;var i=new net.def.IndexList;i.indexs[0]=t,i.indexs[1]=n,net.socket.write(199,i.toArrayBuffer())}}function a(t,n){e.enhanceData=t,v(),r(),PlayerAttribute.UpdateFightingPower(n),Game.dispatcher.dispatchEventWith(Game.EVENT.PartnerEquipEnhanceSync)}function r(){e.showEffectPart=[];var t=Partner.GetWorkPartnerObj(e.curSelectPartnerIndex+1);if(null!=t)for(var n=PartnerEquipManager.getEquipPos(e.curSelectPartnerIndex),i=n[0],a=(n[1],0);a!=PartnerEquipManager.PartnerEquipPart.EquipCount;a++){var r=i+a,o=PartnerEquipManager.partnerEquipList[r];if(null!=o&&0!=o.getId()){var s=e.oldData[r],l=e.enhanceData[r];null!=s&&null!=l&&s!=l&&e.showEffectPart.push(a)}}}function o(t,i){var a=Partner.GetWorkPartnerObj(t+1);if(null==a)return!1;var r=t*PartnerEquipManager.PARTNEREQUIP_EACHPARTNERCOUNT+i,o=PartnerEquipManager.partnerEquipList[i];if(null==o||0==o.getId())return!1;var s=e.enhanceData[r];if(s>=PlayerAttribute.Level+e.PARTNEREQUIP_ENHANCE_LEVELADD)return PopUpMessage.push(lang.String("partnerequip enhance reach level limit"),color.RED),!1;var l=s+1,u=n(i,l);if(null==u)return!1;var c=u.cost[0],h=u.cost[1],d=u.cost[2],p=PlayerAttribute.GetItemCount(c,h);return d>p?(PopUpMessage.push(lang.String("partnerequip enhance not enough material"),color.RED),!1):!0}function s(t){return e.enhanceData[t]}function l(e){var t={},i=Partner.GetWorkPartnerObj(e+1);if(null==i)return t;for(var a=0;a!=PartnerEquipManager.PartnerEquipPart.EquipCount;a++){var r=e*PartnerEquipManager.PARTNEREQUIP_EACHPARTNERCOUNT+a,o=PartnerEquipManager.partnerEquipList[r];if(null!=o&&0!=o.getId()){var l=s(r);if(!(0>=l)){var u=n(a,l);if(null!=u){var c=u.buff[0],h=u.buff[1],d=t[c];null==d&&(d=0),d+=h,t[c]=d}}}}return t}function u(e){for(var t={},i=0;i!=PartnerEquipManager.PartnerEquipPart.EquipCount;i++){var a=e[i];if(!(0>=a)){var r=n(i,a);if(null!=r){var o=r.buff[0],s=r.buff[1],l=t[o];null==l&&(l=0),l+=s,t[o]=l}}}return t}function c(){for(var t=0,i=0;i!=Partner.maxWorkPartnerCnt;i++){var a=Partner.GetWorkPartnerObj(i+1);if(null!=a)for(var r=0;r!=PartnerEquipManager.PARTNEREQUIP_EACHPARTNERCOUNT;r++){var o=i*PartnerEquipManager.PARTNEREQUIP_EACHPARTNERCOUNT+r,s=PartnerEquipManager.partnerEquipList[o];if(null!=s&&0!=s.getId()){var l=e.enhanceData[o],u=n(r,l);null!=u&&(t+=u.power)}}}return t}function h(e){for(var t=0,i=0;i!=PartnerEquipManager.PartnerEquipPart.EquipCount;i++){var a=e[i];if(!(0>=a)){var r=n(i,a);null!=r&&(t+=r.power)}}return t}function d(t){var i=0,a=Partner.GetWorkPartnerObj(t+1);if(null==a)return i;for(var r=0;r!=PartnerEquipManager.PARTNEREQUIP_EACHPARTNERCOUNT;r++){var o=t*PartnerEquipManager.PARTNEREQUIP_EACHPARTNERCOUNT+r,s=PartnerEquipManager.partnerEquipList[o];if(null!=s&&0!=s.getId()){var l=e.enhanceData[o],u=n(r,l);null!=u&&(i+=u.power)}}return i}function p(t){var n=[],i=Partner.GetWorkPartnerObj(t+1);if(null==i)return n;for(var a=PartnerEquipManager.getEquipPos(t),r=a[0],o=[],s=0;s!=PartnerEquipManager.PartnerEquipPart.EquipCount;s++){var l=r+s,u=PartnerEquipManager.partnerEquipList[l];if(null!=u&&0!=u.getId()){var c=e.enhanceData[l];o.push(c)}else o.push(-1)}for(var h=9999,s=0;s!=PartnerEquipManager.PartnerEquipPart.EquipCount;s++)o[s]>=0&&o[s]<h&&(h=o[s]);if(9999==h)return n;for(var s=0;s!=PartnerEquipManager.PartnerEquipPart.EquipCount;s++)o[s]==h&&n.push(s);return n}function g(){var t=egret.getTimer();b>t||(b=t+e.badgeRefreshInterval,egret.setTimeout(f,null,e.badgeRefreshInterval))}function m(){var t=egret.getTimer();b>t||(b=t+e.badgeRefreshInterval,egret.setTimeout(v,null,e.badgeRefreshInterval))}function f(){var t=PlayerAttribute.GetItemCount(e.MaterialG,e.MaterialD);t!=y&&(y=t,v())}function v(){for(var t=PlayerAttribute.Level+e.PARTNEREQUIP_ENHANCE_LEVELADD,i=0;i!=Partner.maxWorkPartnerCnt;i++){badge.onLight(e.badgeList[i],!1);var a=Partner.GetWorkPartnerObj(i+1);if(null!=a)for(var r=0;r!=PartnerEquipManager.PARTNEREQUIP_EACHPARTNERCOUNT;r++){var o=i*PartnerEquipManager.PARTNEREQUIP_EACHPARTNERCOUNT+r,s=PartnerEquipManager.partnerEquipList[o];if(null!=s&&0!=s.getId()){var l=e.enhanceData[o];if(!(l>=t)){var u=l+1,c=n(r,u);if(null!=c){var h=c.cost[0],d=c.cost[1],p=c.cost[2],g=PlayerAttribute.GetItemCount(h,d);if(!(p>g)){badge.onLight(e.badgeList[i],!0);break}}}}}}}e.openFlag=!0,e.config={},e.enhanceData=[],e.oldData=[],e.curSelectPartnerIndex=0,e.showEffectPart=[],e.PARTNEREQUIP_ENHANCE_LEVELADD=10;var y=0;e.MaterialG=14,e.MaterialD=2038,e.badgeList=[2224,2225,2226,2227],e.badgeRefreshInterval=1e3;var b=0;e.Load=t,e.GetAttributeConfig=n,e.ApplyEnhance=i,e.onSyncEnhanceInfo=a,e.checkCanEnhance=o,e.getEnhanceLevel=s,e.getPartnerEnhanceAttribute=l,e.getPartnerEnhanceAttribute1=u,e.GetFightingPower=c,e.GetFightingPower1=h,e.GetFightingPower2=d,e.getAutoEnhanceList=p}(PartnerEquipEnhance||(PartnerEquipEnhance={}));var PartnerEquipManager;!function(e){function t(t,n){e.partnerEquipList=t,r(),PlayerAttribute.UpdateFightingPower(n),Game.dispatcher.dispatchEventWith(Game.EVENT.PartnerEquipSync)}function n(t){return~~(t/e.PARTNEREQUIP_EACHPARTNERCOUNT)}function i(){return R?(R=!1,!1):!0}function a(){return U?(U=!1,!0):!1}function r(){e.showEffectPart=[],e.showEffectPartner=[];var t=i(),r=a();if(t&&r){for(var o=s(L),l=o[0],u=(o[1],0);u!=_.EquipCount;u++){var c=l+u,h=e.oldPartnerEquipList[c],d=e.partnerEquipList[c];if(!(null==h&&null==d||null!=h&&null==d||(null==h&&null!=d&&d.getStar()>0&&e.showEffectPart.push(u),null==h||null==d))){var p=h.getId(),g=d.getId(),m=h.getStar(),f=d.getStar();p==g&&f>m&&e.showEffectPart.push(u),p!=g&&f>0&&e.showEffectPart.push(u)}}e.showEffectPart.length>0&&PopUpMessage.push(lang.String("partnerequip already mount and upgrade star"),color.GREEN);for(var v=[],u=0;u!=e.oldPartnerEquipList.length;u++){var h=e.oldPartnerEquipList[u],d=e.partnerEquipList[u];if(null!=h||null!=d)if(null!=h||null==d)if(null==h||null!=d){if(null!=h&&null!=d){var p=h.getId(),g=d.getId(),m=h.getStar(),f=d.getStar();(p!=g||m!=f)&&v.push(u)}}else v.push(u);else v.push(u)}for(var u=0;u!=v.length;u++){for(var y=n(v[u]),b=!1,S=0;S!=e.showEffectPartner.length;S++)if(y==e.showEffectPartner[S]){b=!0;break}b||e.showEffectPartner.push(y)}}}function o(){e.materialConfig=RES.getRes("public_config/partnerequip/material.json"),e.qualitySetting=RES.getRes("public_config/partnerequip/setting.json"),e.attributeConfig=RES.getRes("public_config/partnerequip/attribute.json"),e.upgradeStarConfig=RES.getRes("public_config/partnerequip/upgradestar.json"),e.splitConfig=RES.getRes("public_config/partnerequip/split.json")}function s(t){var n=t*e.PARTNEREQUIP_EACHPARTNERCOUNT,i=n+e.PARTNEREQUIP_EACHPARTNERCOUNT,a=[n,i];return a}function l(e){return table.partnerEquips[e]}function u(t){for(var n=l(t),i=0;i!=e.attributeConfig.length;i++)if(e.attributeConfig[i].part==n.part&&e.attributeConfig[i].level==n.level)return e.attributeConfig[i];return null}function c(t){for(var n=l(t),i=0;i!=e.splitConfig.length;i++)if(e.splitConfig[i].part==n.part&&e.splitConfig[i].quality==n.quality)return e.splitConfig[i];return null}function h(t){for(var n=l(t),i=0;i!=e.qualitySetting.length;i++)if(e.qualitySetting[i].quality==n.quality)return e.qualitySetting[i].attributeNum;return 0}function d(t){for(var n=l(t),i=0;i!=e.qualitySetting.length;i++)if(e.qualitySetting[i].quality==n.quality)return e.qualitySetting[i].maxStar;return 0}function p(t,n){for(var i=l(t),a=0;a!=e.upgradeStarConfig.length;a++){var r=e.upgradeStarConfig[a];if(i.part==r.part&&i.quality==r.quality)return r.cost}return null}function g(e,t){var n=l(t);switch(e){case"qualityMaterial":return m(n.quality);case"partMaterial":return f(n.part)}return null}function m(t){for(var n=0;n!=e.materialConfig.qualityMaterial.length;n++)if(e.materialConfig.qualityMaterial[n][0]==t)return[e.materialConfig.qualityMaterial[n][1],e.materialConfig.qualityMaterial[n][2],e.materialConfig.qualityMaterial[n][3]];return null}function f(t){for(var n=0;n!=e.materialConfig.partMaterial.length;n++)if(e.materialConfig.partMaterial[n][0]==t)return[e.materialConfig.partMaterial[n][1],e.materialConfig.partMaterial[n][2],e.materialConfig.partMaterial[n][3]];return null}function v(e,t){for(var n=0,i=u(e),a=h(e),r=0;r!=a;r++)n+=i.buffs[r].fps[t];return n}function y(e,t){for(var n=l(e),i=d(e),a=v(e,t),r=v(e,i),o="",s=0;s!=i;s++)o+=t>s?"<font color="+egret.toColorString(color.YELLOW)+">"+lang.String("partnerequip star")+"</font>":"<font color="+egret.toColorString(color.WHITE)+">"+lang.String("partnerequip empty star")+"</font>";return o+="\n"+lang.StringWithFormat("fp:{1}","<font color='"+egret.toColorString(color.Title1_Value)+"'>"+a+"/"+r+"</font>"),o+="\n"+lang.StringWithFormat("partnerequip tip part: {1}","<font color='"+egret.toColorString(color.Title1_Value)+"'>"+lang.String(_[n.part])+"</font>"),o+="\n"+lang.StringWithFormat("partnerequip tip level: {1}","<font color='"+egret.toColorString(color.Title1_Value)+"'>"+n.level+"</font>")}function b(e,t){for(var n=(l(e),u(e)),i=h(e),a="",r=function(e){var i=n.buffs[e],r=i.desc,o=i.args[t],s=r.replace(/{(\d+)}/g,function(e,t){return String(o)});a+=s,a+="\n"},o=0;o!=i;o++)r(o);return a}function S(e){var t=l(e);return t.level}function E(e){var t=Partner.GetWorkPartnerObj(e+1);return null==t?0:10*Math.floor(t.level/10)}function C(){for(var t=0,n=0;n!=e.partnerEquipList.length;n++){var i=e.partnerEquipList[n];i.getId()>0&&(t+=v(i.getId(),i.getStar()))}return t}function T(t){for(var n=s(t),i=n[0],a=n[1],r=0,o=i;o!=a;o++){var l=e.partnerEquipList[o];l.getId()>0&&(r+=v(l.getId(),l.getStar()))}return r}function I(e){var t=table.partnerEquips[e],n=t.quality;return'<font color="'+egret.toColorString(Item.QualityColor[n])+'">'+t.name+"</font>"}function G(e,t){var n=[],i=c(e),a=g(i.split.type,e),r=i.split.num[t];return n[0]=a[0],n[1]=a[1],n[2]=r,n}function A(){null!=x&&(egret.clearTimeout(x),x=null),x=egret.setTimeout(badge.checkPartnerEquipOnWorkPartner,null,1e3)}function k(t){for(var n=s(t),i=n[0],a=n[1],r=0,o=i;o!=a;o++){var l=e.partnerEquipList[o];null!=l&&l.getId()>0&&r++}if(0==r)return!0;var u=Bag.MaxSize-PlayerAttribute.bag.propsSize>=r;return u||(UI.BagView.instance.page=Game.BagPage.Prop,UIManager.openBag(),PopUpMessage.push(lang.String("partnerequip bag full cannot rest partner"),color.RED)),u}function P(t,n){for(var i=0;i!=e.materialConfig.partMaterial.length;i++)if(t==e.materialConfig.partMaterial[i][1]&&n==e.materialConfig.partMaterial[i][2])return!0;for(var i=0;i!=e.materialConfig.qualityMaterial.length;i++)if(t==e.materialConfig.qualityMaterial[i][1]&&n==e.materialConfig.qualityMaterial[i][2])return!0;return!1}function w(t){U=!0,L=t,e.oldPartnerEquipList=e.partnerEquipList,badge.closePartnerEquipBadge(),net.socket.write(230,null)}e.materialConfig=null,e.qualitySetting=[],e.attributeConfig=[],e.upgradeStarConfig=[],e.splitConfig=[],e.oldPartnerEquipList=[],e.partnerEquipList=[],e.showEffectPart=[],e.showEffectPartner=[];var L=0,R=!0,U=!1;e.onSyncPartnerEquips=t,e.GetPartnerIndexByEquipIndex=n,e.PARTNEREQUIP_MAXLEVEL=10,e.PARTNEREQUIP_EACHPARTNERCOUNT=6,e.PARTNEREQUIP_MAXCOUNT=24,e.disableStar="ui/common/disabelStar.png",e.enableStar="ui/common/enableStar.png";var _;!function(e){e[e.EquipWeapon=0]="EquipWeapon",e[e.EquipHelmet=1]="EquipHelmet",e[e.EquipCuff=2]="EquipCuff",e[e.EquipArmor=3]="EquipArmor",e[e.EquipRing=4]="EquipRing",e[e.EquipBoot=5]="EquipBoot",e[e.EquipCount=6]="EquipCount"}(_=e.PartnerEquipPart||(e.PartnerEquipPart={})),e.Load=o,e.getEquipPos=s,e.GetPartnerEquipInfo=l,e.GetAttributeConfig=u,e.GetSplitConfig=c,e.GetAttributeNum=h,e.GetMaxStar=d,e.GetUpgradeStarCost=p,e.GetMaterialGD=g,e.GetFP=v,e.GetEquipBaseDesc=y,e.GetEquipAttributeDesc=b,e.GetPartnerEquipNeedLevel=S,e.GetPartnerEquipLevelLimit=E,e.GetAllPartnerEquipFightingPower=C,e.GetPartnerEquipFightingPower=T,e.GetPartnerEquipName=I,e.GetSplitMaterial=G;var x;e.delayUpdatePartnerEquipBadge=A,e.PartnerRestCheck=k,e.IsPatnerEquipMaterial=P,e.AutoMountPartnerEquip=w}(PartnerEquipManager||(PartnerEquipManager={}));var PartnerQingyi;!function(e){function t(){for(var t=RES.getRes("public_config/partnerqingyi/groups.json"),n=0;n!=t.length;n++){var i=t[n];e.ConfigGroupList[i.groupId]=i,i.groupId>e.MaxGroupId&&(e.MaxGroupId=i.groupId)}for(var a=RES.getRes("public_config/partnerqingyi/levels.json"),n=0;n!=a.length;n++){var r=a[n];e.ConfigLevelList[r.level]=r,r.level>e.MaxQingyiLevel&&(e.MaxQingyiLevel=r.level)}for(var o=RES.getRes("public_config/partnerqingyi/skills.json"),n=0;n!=o.length;n++){var s=o[n];e.ConfigSkillList[s.id]=s}e.ConfigMaterialList=RES.getRes("public_config/partnerqingyi/materials.json");var l=RES.getRes("public_config/partnerqingyi/setting.json");e.openLevel=l.openLevel}function n(t){e.myDataPartnerList=t}function i(t){e.myDataGroupList=t,X();var n=t.getOpt();switch(n){case e.OPT_LOAD:Game.dispatcher.dispatchEventWith(Game.EVENT.PartnerQingyiOptLoad);break;case e.OPT_UNLOCKGROUP:Game.dispatcher.dispatchEventWith(Game.EVENT.PartnerQingyiOptUnlockGroup);break;case e.OPT_UPDATEQINGYIVALUE:Game.dispatcher.dispatchEventWith(Game.EVENT.PartnerQingyiOptUpdateQingyiValue);break;case e.OPT_SKILLLEVELUP:Game.dispatcher.dispatchEventWith(Game.EVENT.PartnerQingyiOptSkillLevelup),UI.PartnerQingyiSkillLevelup.open(Z),Z=0;break;case e.OPT_PARTNERDATACHANGE:Game.dispatcher.dispatchEventWith(Game.EVENT.PartnerQingyiOptPartnerDataChange)}var i=n!=e.OPT_LOAD&&n!=e.OPT_PARTNERDATACHANGE;PlayerAttribute.UpdateFightingPower(i)}function a(e){var t=new net.def.Index;t.index=e,net.socket.write(2100,t.toArrayBuffer())}function r(e,t,n){var i=new net.def.C2SPartnerQingyiUseItem;i.genre=e,i.detailType=t,i.groupId=n,net.socket.write(2101,i.toArrayBuffer())}function o(e){Z=e;var t=new net.def.Index;t.index=e,net.socket.write(2102,t.toArrayBuffer())}function s(t){return e.ConfigGroupList[t]}function l(e){var t=s(e);return null==t?"":t.name}function u(e,t){var n=s(e);if(null==n)return null;for(var i=0;i!=n.levelAttributeList.length;i++){var a=n.levelAttributeList[i];if(a.level==t)return a}return null}function c(e,t){var n=0>=t?!0:!1;0>=t&&(t=1);var i=[],a=u(e,t);if(null==a)return i;for(var r=0;r!=a.attributeTips.length;r++){var o=a.attributeTips[r],s=o[0],l=n?0:o[1],c=Buff.GetName(s);i.push({key:c,value:l})}return i}function h(e,t){for(var n=c(e,t),i="",a=0;a!=n.length;a++){var r=n[a],o=r.key+":"+r.value+", ";i+=o}return i.length>2&&(i=i.substr(0,i.length-2)),i}function d(t){return e.ConfigLevelList[t]}function p(t){return e.ConfigSkillList[t]}function g(t){var n=e.SKILLTYPE_INVALID,i=p(t);if(null!=i)switch(i.skillType){case"tiggerSkill":n=e.SKILLTYPE_TRIGGER;break;case"passiveSkill":n=e.SKILLTYPE_PASSIVE}return n}function m(e){var t=0,n=p(e);return null!=n&&(t=n.levelAttributeList.length),t}function f(e,t){var n=p(e);if(null==n)return null;for(var i=0;i!=n.levelAttributeList.length;i++){var a=n.levelAttributeList[i];if(a.level==t)return a}return null}function v(){return e.curMode==e.MODE_SELF?e.myDataPartnerList:e.otherDataPartnerList}function y(e){for(var t=v(),n=0;n!=t.list.length;n++){var i=t.list[n];if(i.getId()==e)return i}return null}function b(e){var t=y(e),n=null!=t?t.getLevel():0;return n}function S(e){var t=y(e),n=null!=t?t.getSkillLevel():0;return n}function E(){return e.curMode==e.MODE_SELF?e.myDataGroupList:e.otherDataGroupList}function C(e){for(var t=E(),n=0;n!=t.list.length;n++){var i=t.list[n];if(i.getId()==e)return i}return null}function T(t){var n=e.curMode;e.curMode=e.MODE_SELF;var i=I(t);return e.curMode=n,i}function I(e){var t=C(e),n=null!=t?t.getLevel():0;return n}function G(e){var t=C(e),n=null!=t?t.getQingyiValue():0;return n}function A(e){var t=C(e),n=null!=t?t.getSkillLevel():0;return n}function k(e){var t=0,n=Partner.GetPartnerObj(e);return null!=n&&(t=Partner.getTalentSkillLevel(n)),t}function P(e){var t=0,n=Partner.GetPartnerObj(e);return null!=n&&(t=n.level),t}function w(e){var t=s(e);return null==t?0:t.groupSkillId}function L(t){var n=s(t);if(null==n)return"";var i=n.groupSkillId,a=p(i);if(null==a)return"";var r=a.skillId,o=g(i);switch(o){case e.SKILLTYPE_TRIGGER:return R(r);case e.SKILLTYPE_PASSIVE:return U(r)}return""}function R(e){return TriggerSkill.GetSkillName(e)}function U(e){var t=PassiveSkillManager.GetSkillConfig(e);return null==t?"":t.name}function _(t,n){if(0>=n)return"";var i=s(t);if(null==i)return"";var a=i.groupSkillId,r=p(a);if(null==r)return"";var o=r.skillId,l=g(a);switch(l){case e.SKILLTYPE_TRIGGER:return x(o,n);case e.SKILLTYPE_PASSIVE:return M(o,n)}return""}function x(e,t){return TriggerSkill.GetSkillDesc(e,t,!0,!0)}function M(e,t){return PassiveSkillManager.GetAttributeDesc(e,t)}function D(t){var n=s(t);if(null==n)return"";var i=n.groupSkillId,a=p(i);if(null==a)return"";var r=a.skillId,o=g(i);switch(o){case e.SKILLTYPE_TRIGGER:return N(r);case e.SKILLTYPE_PASSIVE:return F(r)}return""}function N(e){return TriggerSkill.GetSkillIcon(e)}function F(e){var t=PassiveSkillManager.GetSkillConfig(e);return null==t?"":t.icon}function O(){var e=0,t=E();if(null!=t)for(var n=0;n!=t.list.length;n++){var i=t.list[n];e+=B(i.getId())}return e}function B(e){var t=I(e);if(0>=t)return 0;var n=u(e,t);if(null==n)return 0;for(var i=0,a=0;a!=n.attributeTips.length;a++){var r=n.attributeTips[a],o=r[0],s=r.slice(1,r.length),l=Buff.GetFightingPower(o,s);i+=l}var c=w(e),h=A(e),d=f(c,h);return null!=d&&(i+=d.power),i}function W(){var t=e.curMode;e.curMode=e.MODE_OTHER;var n=O();return e.curMode=t,n}function V(t,n,i){var a=s(t);if(null==a)return 0;for(var r=!1,o=0;o!=a.doubleMaterials.length;o++){var l=a.doubleMaterials[o],u=l[0],c=l[1];if(u==n&&c==i){r=!0;break}}for(var h=0,o=0;o!=e.ConfigMaterialList.length;o++){var d=e.ConfigMaterialList[o];if(d.genre==n&&d.detailType==i){h=d.addValue;break}}return r&&(h+=h),h}function q(e){var t=Partner.GetPartnerObj(e);return null!=t}function H(e,t){var n=s(e);if(null==n)return!1;for(var i=0;i!=n.partners.length;i++){var a=n.partners[i],r=b(a);if(r<t.value[i])return!1}return!0}function j(e,t){var n=s(e);if(null==n)return!1;for(var i=0;i!=n.partners.length;i++){var a=n.partners[i],r=S(a);if(r<t.value[i])return!1}return!0}function Y(e,t){var n=t.value[0],i=t.value[0],a=t.value[0];return PlayerAttribute.GetItemCount(n,i)>=a}function K(e,t){var n=t.value[0];return G(e)>=n}function Q(e,t){switch(t.type){case"partnerLevel":return H(e,t);case"partnerSkillLevel":return j(e,t);case"item":return Y(e,t);case"qingyiValue":return K(e,t)}return!1}function X(){J(),z()}function J(){var t=!1;for(var n in e.ConfigGroupList){for(var i=parseInt(n),a=!0,r=e.ConfigGroupList[i],o=I(i)+1,s=0;s!=r.levelAttributeList.length;s++){var l=r.levelAttributeList[s];if(l.level==o)for(var u=0;u!=l.breakConds.length;u++){var c=l.breakConds[u];if(!Q(i,c)){a=!1;break}}}o>e.MaxQingyiLevel&&(a=!1),e.badgeUnlockGroup[i]=a,a&&(t=a)}badge.onLight(badge.action.PartnerQingyiUnlockGroup,t)}function z(){var t=!1;for(var n in e.ConfigGroupList){var i=parseInt(n),a=!0,r=e.ConfigGroupList[i],o=r.groupSkillId,s=A(i);if(s>0){s+=1;var l=f(o,s);if(null!=l)for(var u=0;u!=l.breakConds.length;u++){var c=l.breakConds[u];if(!Q(i,c)){a=!1;break}}else a=!1}else a=!1;e.badgeSkillLevelup[i]=a,a&&(t=a)}badge.onLight(badge.action.PartnerQingyiSkillLevelup,t)}e.ConfigGroupList={},e.ConfigLevelList={},e.ConfigSkillList={},e.ConfigMaterialList=[],e.openLevel=0,e.MaxGroupId=0,e.MaxQingyiLevel=0,e.GROUP_MAX_PARTNERNUM=4,e.SKILLTYPE_INVALID=0,e.SKILLTYPE_TRIGGER=1,e.SKILLTYPE_PASSIVE=2,e.OPT_LOAD=0,e.OPT_UNLOCKGROUP=1,e.OPT_UPDATEQINGYIVALUE=2,e.OPT_SKILLLEVELUP=3,e.OPT_VIEWPLAYER=4,e.OPT_PARTNERDATACHANGE=5,e.badgeUnlockGroup={},e.badgeSkillLevelup={},e.MODE_SELF=0,e.MODE_OTHER=1,e.curMode=0,e.myDataPartnerList=null,e.myDataGroupList=null,e.otherDataPartnerList=null,e.otherDataGroupList=null;var Z=0;e.Load=t,e.onSyncPartners=n,e.onSyncGroups=i,e.UnlockGroup=a,e.UseItem=r,e.SkillLevelup=o,e.GetGroupConfig=s,e.GetGroupName=l,e.GetGroupLevelConfig=u,e.GetGroupLevelAttribute=c,e.GetGroupLevelAttributeDesc=h,e.GetLevelConfig=d,e.GetSkillConfig=p,e.GetSkillType=g,e.GetSkillMaxLevel=m,e.GetSkillLevelConfig=f,e.GetDataPartnerList=v,e.GetDataPartnerInfo=y,e.GetDataPartnerLevel=b,e.GetDataPartnerSkillLevel=S,e.GetDataGroupList=E,e.GetDataGroupInfo=C,e.GetMyDataGroupLevel=T,e.GetDataGroupLevel=I,e.GetDataQingyiValue=G,e.GetDataSkillLevel=A,e.GetPartnerSkillLevel=k,e.GetPartnerLevel=P,e.GetGroupSkillId=w,e.GetGroupSkillName=L,e.GetGroupSkillDesc=_,e.GetGroupSkillIcon=D,e.GetFightingPower=O,e.GetGroupFightingPower=B,e.GetFightingPowerOther=W,e.GetMaterialAddValue=V,e.HavePartner=q,e.UpdateBadge=X}(PartnerQingyi||(PartnerQingyi={}));var PersonalMatchScene;!function(e){function t(){Scene.handleIdle[I]=function(){return null},Scene.listenEnterMap(I,s),Scene.listenLeaveMap(I,l),r()}function n(){var e=Game.getServerDate();return e.getHours()==G.openTime?!0:!1}function i(){return G.openTime}function a(){return G.openTime+":00"}function r(){G=RES.getRes("config/crossserver/persionalmatch.json")}function o(e,t){var n=[];if(e>0)for(var i=0;i<G.rankAward.length;i++){var a=G.rankAward[i];if(e>=a.minRank&&e<=a.maxRank){n.push(a.award);break}}if(t>0){var a=G.scoreAward,r={type:a.type,icon:a.icon,name:a.name,quality:a.quality,content:a.content,count:a.count*t,plugin:a.plugin,desc:a.desc};n.push(r)}return n}function s(){UI.HUD.instance.showBattle(),null==e.notePanel&&(e.notePanel=new UI.PersonalMatchPannel),UI.battle.addChild(e.notePanel),UI.setDisableAllPlayerTitles(!0),SuperWeapon.disableAllPlayersEffect(!0),RES.cacheDuration=5e3}function l(){null!=e.notePanel&&(UI.battle.removeChild(e.notePanel),e.notePanel=null),UI.setDisableAllPlayerTitles(!1),SuperWeapon.disableAllPlayersEffect(!1),RES.cacheDuration=Game.cacheDuration,Game.dispatcher.dispatchEventWith(Game.EVENT.LeaveScene)}function u(t){if(null==e.battleInfo)return!1;if(!d())return!1;if(1>t||t>p())return!1;var n=new net.def.C2SPersonalMatchApplyViewMatch;return n.matchid=t,net.socket.write(2089,n.toArrayBuffer()),!0}function c(){return UI.PersonalMatchPage.instance.open(!0,!1),!0}function h(){net.socket.write(2088,null)}function d(){return null!=e.battleInfo?!e.battleInfo.fighting:!1}function p(){var e=g(!0);return 0>=e?8:1>=e?8:2==e?4:3==e?2:1}function g(t){var n=0,i=e.battleInfo;return null!=i&&(n=t&&2==i.status?i.round+1:i.round),n}function m(){var t=e.battleInfo;if(null!=t)switch(t.status){case 0:return"Chở tổng kết";case 1:return"Thi đấu";case 2:return"Sẵn sàng";case 3:return"Kết thúc"}return"-"}function f(){var e=g(!0);return 0>=e?"Giai đoạn chuẩn bị":1>=e?"Vòng 16":2==e?"Tứ Kết":3==e?"Bán Kết":"Chung Kết"}function v(t){var n=g(!1),i=e.battleInfo;null!=i&&1==i.status&&(n-=1);var a=16;return 0>=n?a=16:1>=n?a=8:2==n?a=4:3==n?a=2:n>=4&&(a=1),t>0&&a>t&&(t=a),t>8?"Top 16":t>4?"Top 8":t>2?"Top 4":t>1?"Á Quân":1==t?"Quán Quân":"-"}function y(){if(d()){var t=lang.String("operation confirm"),n=lang.StringWithFormat("peraonal match scene confirm leave");UI.ConfirmBox.Show(UI.ConfirmBoxStyle["default"],t,n,e.ConfirmLeaveScene,null,null)}}function b(){return net.socket.write(141,null),!0}function S(t){null!=e.battleInfo&&e.battleInfo.fighting&&!t.fighting&&Player.instance.actor.popBattleResult(t.myRank<=t.matchCount),e.battleInfo=t,Game.dispatcher.dispatchEventWith(Game.EVENT.PersonalMatchStatus)}function E(e,t){var n=p(),i=2*n;if(e.rank>i||t.rank>i)return e.rank-t.rank;var a=e.rank,r=t.rank;return a>n&&(a=i+1-a),r>n&&(r=i+1-r),a!=r?a-r:e.rank-t.rank}function C(t){e.rankInfo=t,e.rankInfo.list.sort(E),UI.PersonalMatchPage.instance.opened||UI.PersonalMatchPage.instance.open(!1,!0),Game.dispatcher.dispatchEventWith(Game.EVENT.PersonalMatchRank)}function T(t){e.damage.mine=t.mine,e.damage.his=t.his,Game.dispatcher.dispatchEventWith(Game.EVENT.PersonalMatchDamageChange)}var I="personalmatch";e.damage={mine:0,his:0};var G;e.load=t,e.isOpenTime=n,e.getOpenTime=i,e.getOpenTimeString=a,e.getAward=o,e.applyViewMatch=u,e.onOpenMembers=c,e.applyRankList=h,e.isViewer=d,e.getMatchCount=p,e.getViewRound=g,e.getStatus=m,e.getMatchName=f,e.getRankName=v,e.applyLeaveScene=y,e.ConfirmLeaveScene=b,e.procSyncPersonalMatchTime=S,e.procSyncPersonalMatchRankData=C,e.procSyncPersonalMatchDamage=T}(PersonalMatchScene||(PersonalMatchScene={}));var PlayerGem;!function(e){function t(){var e="GemUpgradeUseAdvanceLevel";J=!1,"on"==egret.localStorage.getItem(e)&&(J=!0);var t="GemUpgradeUsePlan";z=0;var n=egret.localStorage.getItem(t);""!=n&&(z=Number(n))}function n(e,t){var n=z;if(z=e,t){var i="GemUpgradeUsePlan";e>0?egret.localStorage.setItem(i,""+e):egret.localStorage.removeItem(i)
}return n}function i(){return z}function a(e,t){var n=J;if(J=e,t){var i="GemUpgradeUseAdvanceLevel";J?egret.localStorage.setItem(i,"on"):egret.localStorage.removeItem(i)}return n}function r(){return J}function o(e,t){return e.level!=t.level?e.level-t.level:e.part!=t.part?Z[e.part]-Z[t.part]:e.socket-t.socket}function s(){for(var t=[],n=0;n<Game.EquipPart.EquipCount;n++)for(var i=e.gems[n],a=i.length-1;a>=0;a--){var r=i[a];if(r>0){var s=r%1e3;t.push({part:n,socket:a,gemId:r,level:s})}}return t.length>0?(t.sort(o),t):void 0}function l(){var t=PlayerAttribute.bag.GetGemItem();if(t.length<=0)return badge.onLight(badge.action.GemAutoMount,!1),void badge.onLight(badge.action.GemAutoUpgrade,!1);null!=c(-1)?badge.onLight(badge.action.GemAutoMount,!0):badge.onLight(badge.action.GemAutoMount,!1);var n=e.GetEquipedGemByPriority();if(null!=n)for(var i=0;i<n.length;i++){var a=n[i],r=e.GetUpgradeCost(a.gemId,e.GetUpgradeUseAdvanceLevelGem());if(r.result==e.Result.Ok)return void badge.onLight(badge.action.GemAutoUpgrade,!0)}badge.onLight(badge.action.GemAutoUpgrade,!1)}function u(e){for(var t=0;t<e.length;t++){var n=c(e[t]);if(null!=n)return n}}function c(e){if(e>=0&&e<Game.EquipPart.EquipCount){var t=k(e);if(null!=t)return{part:e,socket:t[0]}}else for(var n=0;n<Game.EquipPart.EquipCount;n++){var i=c(n);if(null!=i)return i}return null}function h(e,t){for(var n=0,i=0;i<e.length;i++)for(var a=0;a<t.length;a++)n+=d(e[i],t[a]);return n}function d(t,n){var i=0;if(t>=0&&t<Game.EquipPart.EquipCount)for(var a=e.gems[t],r=0;r<a.length;r++){var o=a[r];if(o>0){var s=Math.floor(o/1e3);(0>n||s==n)&&i++}}else for(var l=0;l<Game.EquipPart.EquipCount;l++){var u=d(l,n);null!=u&&(i+=u)}return i}function p(e){for(var t,n=0;n<e.length;n++){var i=g(e[n]);null!=i&&(null==t||t.level<i.level)&&(t=i)}return t}function g(e){if(!(e>=1&&e<=N())){for(var t=void 0,n=1;n<=N();n++){var i=g(n);null!=i&&(null==t||t.level<=i.level)&&(t=i)}return t}for(var a=table.gemAttr.compose.length;a>=1;a--){var r=1e3*e+a,o=PlayerAttribute.bag.getCount(5,r);if(o>0)return{gemId:r,level:a,count:o}}return null}function m(t,n,i){t>=0&&t<e.gems.length&&n>=0&&n<e.gems[0].length&&(e.gems[t][n]=i,l())}function f(e,t,n){var i=new net.def.C2SGemOp;return i.setOpCode(0),i.setPart(e),i.setSocket(t),i.setGemId(n),net.socket.write(45,i.toArrayBuffer()),!0}function v(e,t){var n=(Player.instance,1);if(PlayerAttribute.bag.otherSize>Bag.otherMaxSize-n)return PopUpMessage.push(lang.StringWithFormat("bag room full{1}",n),color.GREEN),!1;var i=new net.def.C2SGemOp;return i.setOpCode(2),i.setPart(e),i.setSocket(t),i.setGemId(0),net.socket.write(45,i.toArrayBuffer()),!0}function y(e){var t=(Player.instance,6);if(PlayerAttribute.bag.otherSize>Bag.otherMaxSize-t)return void PopUpMessage.push(lang.StringWithFormat("bag room full{1}",t),color.GREEN);var n=new net.def.C2SGemOp;n.setOpCode(3),n.setPart(e),n.setSocket(0),n.setGemId(0),net.socket.write(45,n.toArrayBuffer())}function b(t,n){var i=e.gems[t][n];if(0>=i)return!1;var a=(Math.floor(i/1e3),x(i,!0));if(0!=a.result)return!1;var r=new net.def.C2SGemOp;return r.setOpCode(1),r.setPart(t),r.setSocket(n),r.setGemId(0),net.socket.write(45,r.toArrayBuffer()),!0}function S(e,t,n){var i=(Player.instance,A(e));if(i>t){if(n>0){var a=table.props[5][n];return a.source}return"ui/forge/add_bg.png"}return"ui/common1/suo_0.png"}function E(e,t,n){var i=(Player.instance,A(e));if(i>t){if(n>0){var a=table.props[5][n];return String(a.quality)}return null}return null}function C(t,n){return e.gems[t][n]}function T(t,n){var i=e.gems[t][n];return S(t,n,i)}function I(t,n){var i=e.gems[t][n];return i}function G(t,n){var i=e.gems[t][n],a=(Player.instance,A(t));return a>n&&i>0?i%1e3:0}function A(e){var t=(Player.instance,PlayerAttribute.Equips[e]);if(null!=t){var n=U(t.Level);return n}return 0}function k(t){var n=A(t);if(0==n)return null;for(var i=[],a=0;n>a;a++)0==e.gems[t][a]&&i.push(a);return 0==i.length?null:i}function P(){for(var t=0,n=0,i=0;i<e.gems.length;i++)for(var a=0;a<e.gems[i].length;a++){var r=e.gems[i][a],o=r%1e3;n+=o;var s=Math.floor(r/1e3),l=q(s,i,o);null!=l&&(t+=l.power)}var u=j(n);return null!=u&&(t+=u.power),t}function w(t){for(var n=0,i=0;i<e.gems[t].length;i++){var a=e.gems[t][i],r=a%1e3;n+=r}return n}function L(){for(var t=0,n=(Player.instance,0);n<e.gems.length;n++)for(var i=0;i<e.gems[n].length;i++){var a=e.gems[n][i],r=a%1e3;t+=r}return t}function R(t,n,i){for(var a=(Player.instance,0),r=Math.floor(i/1e3),o=0;o<e.gems[t].length;o++){var s=e.gems[t][o];if(s>0&&o!=n){var l=Math.floor(s/1e3);l==r&&a++}}return a}function U(e){for(var t=0;t<K.length;t++)if(e>=K[t].level)return K[t].socket;return 0}function _(t,n,i){var a=(Player.instance,e.gems[t][n]);return a>0?x(a,i):{result:X.NoGem,needCoin:0}}function x(e,t){var n=e%1e3,i=Math.floor(e/1e3);return M(i,n,t)}function M(e,t,n){var i=1,a=0;if(t>=WorldLine.GetMaxGemLevel())return{result:X.MaxLevel,needCoin:a};for(var r=t+1;i>0&&r>0;r--){var o=F(r);if(null==o)return{result:X.MaxLevel,needCoin:a};if(r>t)a+=o.costcoin,i=o.costgem-1;else{var s=1e3*e+r,l=PlayerAttribute.bag.getCount(5,s);!n&&r>=Q.AdvancedLevel&&(l=0);var u=l;l>i&&(u=i),i-=u,r>1&&(a+=i*o.costcoin,i*=o.costgem)}}return i>0?{result:X.GemNotEnough,needCoin:a}:PlayerAttribute.currency[Game.Currency.CopperCoin]<a?{result:X.CopperCoinNotEnough,needCoin:a}:{result:X.Ok,needCoin:a}}function D(){return table.gemAttr.compose.length}function N(){return table.gemAttr.classes.length}function F(e){return e>=1&&e<=table.gemAttr.compose.length?table.gemAttr.compose[e-1]:null}function O(e,t){var n=_(e,t,!0);if(-2==n.result)return null;var i=PlayerAttribute.currency[Game.Currency.CopperCoin];return i>=n.needCoin?'<font color="#09e118">'+i+'</font>/<font color="#bececb">'+n.needCoin+"</font>":'<font color="#f01616">'+i+'</font>/<font color="#bececb">'+n.needCoin+"</font>"}function B(e){for(var t=e%1e3,n=Math.floor(e/1e3),i=1,a=0,r=(Player.instance,t);r>0;r--){a*=3;var o=1e3*n+r,s=PlayerAttribute.bag.CalcCount(5,o);a+=s,r>1&&(i*=3)}return~~(a/i)}function W(t,n){var i="",a=(Player.instance,_(t,n,!0)),r=e.gems[t][n],o=B(r);PlayerAttribute.currency[Game.Currency.CopperCoin];return i=0==a.result||o>=2?'<font color="#09e118">'+(o+1)+'</font>/<font color="#bececb">3</font>':'<font color="#f01616">'+(o+1)+'</font>/<font color="#bececb">3</font>'}function V(e){for(var t=table.props[5][e],n=t.quality,i=Item.QualityColor[n],a="",r=Math.floor(e/1e3),o=e%1e3,s=0;s<Game.EquipPart.EquipCount;s++){var l=lang.String(Game.EquipPart[s]);a+='<font color="#bececb">'+l+" </font>",a+='<font color="'+egret.toColorString(i)+'">'+H(r,s,o,"  ")+"</font>",a+="\n"}return a}function q(e,t,n){return 0==e?j(n):table.gemAttr.classes[e].parts[t].levels[n-1]}function H(e,t,n,i){var a="",r=q(e,t,n);if(null!=r)for(var o=0;o<r.buffs.length;o++){0!=o&&(a+=i);var s=r.buffs[o];a+=""+String(Buff.GetDesc(s[0],[s[1]]))}return a}function j(e){for(var t=table.gemAttr.classes[0].parts[0].levels,n=null,i=0;i<t.length&&e>=t[i].level;i++)n=t[i];return n}function Y(e){for(var t=table.gemAttr.classes[0].parts[0].levels,n=null,i=0;i<t.length;i++)if(e<t[i].level){n=t[i];break}return n}var K=[{level:71,socket:6},{level:61,socket:5},{level:51,socket:4},{level:41,socket:3},{level:31,socket:2},{level:21,socket:1}];e.socketLevel=[21,31,41,51,61,71],e.gems=[[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]];var Q;!function(e){e[e.AdvancedLevel=3]="AdvancedLevel"}(Q||(Q={}));var X;!function(e){e[e.NoGem=-2]="NoGem",e[e.MaxLevel=-1]="MaxLevel",e[e.Ok=0]="Ok",e[e.GemNotEnough=1]="GemNotEnough",e[e.CopperCoinNotEnough=2]="CopperCoinNotEnough"}(X=e.Result||(e.Result={}));var J=!1,z=0;e.LoadLocalStorage=t,e.SetUpgradeUsePlan=n,e.GetUpgradeUsePlan=i,e.SetUpgradeUseAdvanceLevelGem=a,e.GetUpgradeUseAdvanceLevelGem=r;var Z={4:0,5:1,2:2,3:3,6:4,7:5,0:6,1:7};e.GetEquipedGemByPriority=s,e.CheckGemBadge=l,e.GetFirstEmptySocketFromParts=u,e.getFirstEmptySocket=c,e.CountEquipedGemByTypes=h,e.countEquipedGemByType=d,e.CountOwnedGemMaxLevelByTypes=p,e.countOwnedGemMaxLevelByType=g,e.ChangeGem=m,e.ApplyChangeGem=f,e.ApplyPickupGem=v,e.ApplyPickupAllGem=y,e.ApplyUpgradeGem=b,e.GetGemIcon=S,e.GetGemQuality=E,e.GetPartGem=C,e.GetIcon=T,e.GetQuality=I,e.GetGemLevel=G,e.GetSocketLimit=A,e.GetEmptySockets=k,e.GetTotalPower=P,e.GetEquipGemTotalLevel=w,e.GetTotalLevel=L,e.CountSameClass=R,e.GetMaxSocket=U,e.CheckUpgradeCost=_,e.GetUpgradeCost=x,e._GetUpgradeCost=M,e.GetGemMaxLevel=D,e.GetGemMaxType=N,e.GetLevelUpgradeCost=F,e.GetUpgradeCostDesc=O,e.GetUpgradeGemDesc=W,e.GetAttributeDesc=V,e.GetGemAttribute=q,e.GetGemAttributeDesc=H,e.GetGemExtAttribute=j,e.GetNextGemExtAttribute=Y}(PlayerGem||(PlayerGem={}));var PrizeWheel;!function(e){function t(){net.socket.write(101,null)}function n(){net.socket.write(102,null)}function i(t){var n=new UI.AwardResult;n.setAwards([e.prizes[t]]),UIManager.push(n)}function a(){var t=RES.getRes("public_config/prizewheel.json");e.cost=t.cost,e.countLimit=t.dayCountLimit;for(var n=0,i=t.prizes;n<i.length;n++){var a=i[n];e.prizes[a.id]=a}}function r(){return lang.StringWithFormat("left count",e.countLimit-e.UsedCount)}function o(){return e.countLimit-e.UsedCount}e.cost=0,e.countLimit=0,e.UsedCount=0,e.roll=t,e.draw=n,e.openResultUI=i,e.prizes={},e.load=a,e.getCountTxt=r,e.getLetfCount=o}(PrizeWheel||(PrizeWheel={}));var Prologue;!function(e){function t(){Scene.handleIdle[b]=i,null==e.hudUI&&(e.hudUI=new UI.PrologueHUD),e.hudUI.closeRemind(),UIManager.pushPage(e.hudUI),y(!0),Game.dispatcher.addEventListener(Game.EVENT.LevelUp,y,null)}function n(){Game.dispatcher.removeEventListener(Game.EVENT.LevelUp,y,null),delete Scene.handleIdle[b],UIManager.popNoTweens(e.hudUI),e.hudUI=null,UI.HUD.instance.updateToggleAutoVisible(!0),Setting.ChangeAutoPlay(!0),UI.HUD.instance.mainButtonGroup.visible=!0,null!=S&&(Game.removeFromParent.apply(S),S=null),null!=C&&(egret.clearTimeout(C),C=null),null!=T&&(egret.clearTimeout(T),T=null),null!=e.dialogue&&(Game.removeFromParent.apply(e.dialogue),e.dialogue.cleanTimer(),e.dialogue=null)}function i(t){var n,i;switch(e.progress){case 2:n=World.objectGroup.object,i=n.getObjectByIndex(0);break;case 5:n=World.objectGroup.monster3,i=n.getObjectByIndex(0);break;case 6:n=World.objectGroup.monster4,i=n.getObjectByIndex(0);break;case 10:n=World.objectGroup.npc,i=n.getObjectByIndex(0);break;default:return null}var r=Scene.displayPos2LogicPos(new egret.Point(~~(i.x+i.width/2),~~(i.y+i.height/2)));if(10!=e.progress)return r;var o=Player.instance;g_WithInRange(r,o.logicPos,66)&&(null==e.dialogue||null==e.dialogue.parent)&&a(2)}function a(t){switch(v(),t){case 1:e.dialogue.dialogue=Game.TextParser.parse(lang.StringWithFormat("[Prologue]Dialogue3",o())),e.dialogue.answer=Game.TextParser.parse(lang.String("answer to sure")),e.dialogue.icon="icon/portrait/partner/45.jpg",e.dialogue.currentState="other",e.dialogue.handle=function(){UIManager.pop(e.dialogue),e.dialogue.cleanTimer()},null!=S&&Game.removeFromParent.apply(S),e.dialogue.setTimer(5e3),UIManager.push(e.dialogue);break;case 2:e.dialogue.dialogue=Game.TextParser.parse(lang.StringWithFormat("[Prologue]Dialogue4",o())),e.dialogue.answer=Game.TextParser.parse(lang.String("answer to sure")),e.dialogue.currentState="other",e.dialogue.icon="icon/portrait/partner/45.jpg",UIManager.push(e.dialogue),e.dialogue.setTimer(5e3),e.dialogue.handle=function(){10==e.progress&&d(),e.dialogue.handle=null,UIManager.pop(e.dialogue),e.dialogue.cleanTimer()}}}function r(){net.socket.write(24,null)}function o(){return table.faction[PlayerAttribute.faction].gender?lang.String("BigFactionBrother"):lang.String("BigFactionSister")}function s(t){var n=net.def.S2CSyncPrologue.decode(t);e.progress=n.progress,e.hudUI.closeRemind(),e.hudUI.removeGuidePhase(),null!=T&&(egret.clearTimeout(T),T=null),0==e.progress?h():1==e.progress?e.hudUI.pushRemind(lang.String("[Prologue]Remind2")):2==e.progress?T=egret.setTimeout(function(){e.hudUI.pushRemind(lang.String("[Prologue]Remind3"))},null,Game.Second):3==e.progress?e.hudUI.showAward(e.progress):4==e.progress?e.hudUI.pushRemind(lang.String("[Prologue]Remind4")):5==e.progress?T=egret.setTimeout(function(){e.hudUI.pushRemind(lang.String("[Prologue]Remind5"))},null,2*Game.Second):6==e.progress?T=egret.setTimeout(function(){e.hudUI.guidePhase(6),e.hudUI.pushRemind(lang.String("[Prologue]Remind6"))},null,Game.Second):7==e.progress?e.hudUI.pushRemind(lang.String("[Prologue]Remind7")):8==e.progress?(T=egret.setTimeout(function(){u()},null,7*Game.Second),egret.setTimeout(function(){E||null!=C||(G=!0,l())},null,9*Game.Second)):9==e.progress?a(1):10==e.progress?e.hudUI.showAward(10):11==e.progress&&e.hudUI.showEnding(),UI.HUD.instance.updateToggleAutoVisible(!1),Setting.ChangeAutoPlay(!1),UI.HUD.instance.mainButtonGroup.visible=!1,G=!1,f(!1),e.progress>=6&&(UI.HUD.instance.updateToggleAutoVisible(!0),f(!0),UI.HUD.instance.mainButtonGroup.visible=!0),e.progress>=7&&Setting.ChangeAutoPlay(!0),e.progress>8&&(G=!0)}function l(){C=null,PlayerAttribute.GetRage()==Game.MaxRage?(null==S&&(S=new UI.GuideRageSkill),e.hudUI.push(S),E=!0):C=egret.setTimeout(l,null,~~(Game.MSPF*(Game.MaxRage-PlayerAttribute.GetRage())/PlayerAttribute.RagePerFrame))}function u(){switch(v(),e.progress){case 0:e.dialogue.dialogue=Game.TextParser.parse(lang.StringWithFormat("[Prologue]Dialogue2",o())),e.dialogue.answer=Game.TextParser.parse(lang.String("[Prologue]Answer2")),e.dialogue.currentState="other",e.dialogue.icon="icon/portrait/partner/21.jpg",UIManager.push(e.dialogue),e.dialogue.setTimer(2e3),e.dialogue.handle=function(){UIManager.pop(e.dialogue),d()};break;case 2:UI.openGathering(1.5*Game.Second,0),I&&egret.clearTimeout(I),I=egret.setTimeout(function(){UI.closeGathering(),d(),I=null},null,1.5*Game.Second);break;case 7:e.dialogue.dialogue=Game.TextParser.parse(lang.StringWithFormat("[Prologue]Dialogue5",o())),e.dialogue.answer=Game.TextParser.parse(lang.String("[Prologue]Answer5")),e.dialogue.currentState="other",e.dialogue.icon="icon/portrait/partner/46.jpg",UIManager.push(e.dialogue),e.dialogue.setTimer(2e3),e.dialogue.handle=function(){UIManager.pop(e.dialogue),d()};break;case 8:e.dialogue.dialogue=Game.TextParser.parse(lang.StringWithFormat("[Prologue]Dialogue6",o())),e.dialogue.answer=Game.TextParser.parse(lang.String("[Prologue]Answer6")),e.dialogue.currentState="other",e.dialogue.icon="icon/portrait/partner/46.jpg",UIManager.push(e.dialogue),e.dialogue.setTimer(2e3),e.dialogue.handle=function(){UIManager.pop(e.dialogue),e.dialogue.dialogue=Game.TextParser.parse(lang.StringWithFormat("[Prologue]Dialogue7",o())),e.dialogue.answer=Game.TextParser.parse(lang.String("[Prologue]Answer7")),e.dialogue.currentState="other",e.dialogue.icon="icon/portrait/partner/45.jpg",UIManager.push(e.dialogue),e.dialogue.setTimer(2e3),e.dialogue.handle=function(){UIManager.pop(e.dialogue)}};break;case 9:UI.openGathering(1.5*Game.Second,0),I&&egret.clearTimeout(I),I=egret.setTimeout(function(){UI.closeGathering(),d(),I=null},null,1.5*Game.Second);break;case 12:r()}}function c(){switch(e.progress){case 3:d();break;case 11:r()}}function h(){v(),e.dialogue.dialogue=Game.TextParser.parse(lang.StringWithFormat("[Prologue]Dialogue1",o())),e.dialogue.answer=Game.TextParser.parse(lang.String("answer to sure")),e.dialogue.icon=table.faction[PlayerAttribute.faction].portrait,e.dialogue.currentState="self",UIManager.push(e.dialogue),e.dialogue.setTimer(2e3),e.dialogue.handle=function(){UIManager.pop(e.dialogue),e.hudUI.pushRemind(lang.String("[Prologue]Remind1"))}}function d(){net.socket.write(206,null)}function p(){Scene.listenEnterMap(b,t),Scene.listenLeaveMap(b,n),net.Register(53,s);var i=RES.getRes("config/scenes/prologue.json");for(var a in i){var r=table.parseListAwards(i[a]);e.awardsConfig[a]=r}}function g(){return G||!1}function m(e){return A[e]}function f(e){for(var t=(PlayerAttribute.skillSlots,1);5>=t;t++)Setting.ChangeAutoSkill(t,e)}function v(){null==e.dialogue&&(e.dialogue=new UI.PrologueDialogue,e.dialogue.skinName="PrologueDialogueUISkin")}function y(t){var n=PlayerAttribute.Level;if(2>n?A=[!0,!1,!1]:2==n?A=[!0,!0,!1]:n>=3&&(A=[!0,!0,!0]),1!=t)switch(n){case 2:case 3:case 4:egret.setTimeout(function(){e.hudUI.unlockSkill(n)},null,1.5*Game.Second)}}var b="prologue";e.progress=0;var S,E,C,T;e.awardsConfig=egret.createMap(),e.talk=a;var I;e.onP1Step=u,e.onP2Step=c,e.goonStep=d,e.load=p;var G,A=[!0,!1,!1];e.canRageSkill=g,e.canSkill=m,e.autoCastSkill=f}(Prologue||(Prologue={}));var QinMausoleum;!function(e){function t(t){if(0!=t&&1!=t){var n=lang.String("qinmausoleum select area");return{result:!1,msg:n}}if(""==Player.instance.guildName){var n=lang.String("[qinMausoleum]not in guild");return{result:!1,msg:n}}if(PlayerAttribute.Level<e.openLevel){var n=lang.StringWithFormat("open on level {1}",e.openLevel);return{result:!1,msg:n}}var i=new net.def.C2SEnterQinMausoleum;return i.setIndex(t),net.socket.write(57,i.toArrayBuffer()),{result:!0,msg:""}}function n(){Scene.listenEnterMap(d,r),Scene.listenLeaveMap(d,a),Scene.listenEnterMap(p,o),Scene.listenLeaveMap(p,a)}function i(){UI.HUD.instance.showBattle(),null==h&&(h=new UI.QinB1HUD),h.currentState=m[World.mapId].state,h.txtBossName=table.npcs[m[World.mapId].npcId].name,h.npcPic=m[World.mapId].bossIco,h.mapName=table.maps[World.mapId].name,UI.battle.addChild(h),UI.setDisableAllPlayerTitles(!0),SuperWeapon.disableAllPlayersEffect(!0)}function a(){null!=h&&(UI.battle.removeChild(h),h=null),UI.setDisableAllPlayerTitles(!1),SuperWeapon.disableAllPlayersEffect(!1)}function r(){i()}function o(){i()}function s(e){null!=h&&(h.second=e.restTime,h.bossHp=e.restLife,h.bossShow=e.boss,h.updateTopList(e.ranks),h.scroe=e.guildScore,e.guildRank>0&&(h.myRank=e.guildRank),e.stage<=g.length?h.txtStage=lang.String(g[e.stage]):egret.error("S2CQinMausoleumStatus Stage "+e.stage+" > note length "))}function l(t){null==e.resultUI&&(e.resultUI=new UI.QinResult),e.resultUI.currentState="closed",e.resultUI.panel.skinName="PanelWinSkin";var n=function(e){var t=new Array;if(e)for(var n=e.length,i=0;n>i;i++){var a=table.parseAward(e[i]);t[i]=a}return t};e.resultUI.update(t.guildScore,t.guildRank,n(t.getGuildAwards()),n(t.getSelfAwards())),UIManager.push(e.resultUI)}function u(){null==e.resultUI&&(e.resultUI=new UI.QinResult),e.resultUI.currentState="lose",e.resultUI.panel.skinName="PanelLoseSkin",UIManager.push(e.resultUI)}function c(){net.socket.write(2027,null)}e.openLevel=30,e.awardsData=[],e.onSign=t;var h,d="qinMausoleum/f1",p="qinMausoleum/f2",g=["qinmausoleum stage1","qinmausoleum stage2","qinmausoleum stage3","qinmausoleum stage4","qinmausoleum stage5"],m={10028:{npcId:12204,bossIco:"ui/map/bossb2.png",state:"B1floor"},10029:{npcId:12205,bossIco:"ui/map/bossb3.png",state:"B1floor"},10030:{npcId:12206,bossIco:"ui/map/bossb3.png",state:"B2floor"}};e.load=n;e.s2cStatus=s,e.showResultRanklist=l,e.B2Lose=u,e.requestServerEntranceInfo=c}(QinMausoleum||(QinMausoleum={}));var RankAward;!function(e){function t(e){if(e>=0&&e<l.length){var t=new net.def.C2SRequestRankAward;t.rankType=e,t.round=-1,null!=l[e]&&(t.round=l[e].round||-1),net.socket.write(2036,t.toArrayBuffer())}}function n(e){e.rankType>=0&&e.rankType<l.length&&(l[e.rankType]=e,o=Game.countOpenSeconds(),s=e.nextTime,Game.dispatcher.dispatchEventWith(Game.EVENT.RankAwardDataChange))}function i(e){return e>=0&&e<l.length?l[e]:null}function a(){var e=s-(Game.countOpenSeconds()-o);if(0>=e)return"-";if(60>e)return"Dưới 1 phút";if(3600>e){var t=~~(e/60);return t+" phút"}if(86400>e){var n=~~(e/3600),t=~~(e%3600/60);return n+" giờ "+t+" phút"}var i=~~(e/86400),a=~~(e%86400/3600);return i+" ngày "+a+" giờ"}function r(){return Game.eraDay<32?!0:!1}e.RankAwardLevel=0,e.RankAwardFp=1;var o=0,s=0,l=[null,null];e.ApplyRankAwardData=t,e.procSyncRankData=n,e.GetRankAwardData=i,e.GetNextTimeStr=a,e.inTime=r}(RankAward||(RankAward={}));var FightingPower;!function(e){e.Life=.25,e.Attack=5,e.Defense=5,e.SeriesAttack=5,e.SeriesDefense=5,e.Hit=30,e.Dodge=30,e.Strike=20,e.AntiStrike=20,e.SeriesAggravate=5,e.SeriesMitigate=5,e.Luck=420}(FightingPower||(FightingPower={}));var Buff;!function(e){function t(t){var n="";return isNaN(t.fp)||0==t.fp||(n+=lang.StringWithFormat("fp:{1}","<font color='"+egret.toColorString(color.Title1_Value)+"'>"+t.fp+"</font>")+"\n"),isNaN(t.life)||0==t.life||(n+=e.GetDesc(17,[t.life],!0)+"\n"),isNaN(t.attack)||0==t.attack||(n+=e.GetDesc(1,[t.attack],!0)+"\n"),isNaN(t.defense)||0==t.defense||(n+=e.GetDesc(7,[t.defense],!0)+"\n"),isNaN(t.strike)||0==t.strike||(n+=e.GetDesc(31,[t.strike],!0)+"\n"),isNaN(t.antiStrike)||0==t.antiStrike||(n+=e.GetDesc(32,[t.antiStrike],!0)+"\n"),isNaN(t.hit)||0==t.hit||(n+=e.GetDesc(16,[t.hit],!0)+"\n"),isNaN(t.dodge)||0==t.dodge||(n+=e.GetDesc(15,[t.dodge],!0)+"\n"),isNaN(t.recoverLife)||0==t.recoverLife||(n+=e.GetDesc(36,[t.recoverLife],!0)),n}function n(e){if(0==e||null==e)return egret.error("attribute=<"+e+"> desc"),null;var t=m[e].name;return null==t?(egret.error("attribute=<"+e+"> desc"),null):t}function i(e,t,n){return a(e,[t[0]/100],n)}function a(e,t,n){if(0==e||null==e)return egret.error("attribute=<"+e+",["+t+"]> desc"),null;var i=m[e].desc;if(null==i)return egret.error("attribute=<"+e+",["+t+"]> desc"),null;if(null==n)return StringWithFormat.apply(void 0,[i].concat(t));for(var a=[],r=0;r<t.length;r++)a.push("<font color='"+egret.toColorString(color.Title1_Value)+"'>"+t[r]+"</font>");return StringWithFormat.apply(void 0,[i].concat(a))}function r(e){return parseFloat((e[e.length-1]/100).toFixed(2))}function o(e){return e[e.length-1]}function s(e,t){var n=f[e];if(null==n&&egret.error("buff["+e+"] not found"),null!=n.GetFP)return n.GetFP(t);for(var i=0,a=0;a<t.length;a++)i+=Math.floor(t[a]*n.FightingPower);return i}function l(){m=RES.getRes("config/buffdesc.json")}function u(e){return StringWithFormat(m[1].desc,e)}function c(e){return StringWithFormat(m[17].desc,e)}function h(e){return StringWithFormat(m[7].desc,e)}function d(e,t,n){return 0==e||null==e?(egret.error("attribute=<"+e+",["+t+"]> desc"),null):null==f[e].Desc?(egret.error("attribute=<"+e+"> not have desc"),null):f[e].Desc(e,t,n)}function p(e){return 0==e||null==e?(egret.error("attribute=<"+e+"]> desc"),null):null==f[e].Name?(egret.error("attribute=<"+e+"> not have name"),null):f[e].Name(e)}function g(e,t){return 0==e||null==e?(egret.error("attribute=<"+e+"]> id null"),null):null==t?(egret.error("attribute=<"+e+"]> values null"),null):null==f[e].EffectValue?(egret.error("attribute=<"+e+"]> EffectValue null"),null):f[e].EffectValue(t)}var m;e.getBaseAttributeDesc=t,e.GetFightingPower=s;var f={1:{Name:n,FightingPower:FightingPower.Attack,Desc:a,EffectValue:o},2:{Name:n,FightingPower:FightingPower.SeriesAttack,Desc:a,EffectValue:o},3:{Name:n,FightingPower:FightingPower.SeriesAttack,Desc:a,EffectValue:o},4:{Name:n,FightingPower:FightingPower.SeriesAttack,Desc:a,EffectValue:o},5:{Name:n,FightingPower:FightingPower.SeriesAttack,Desc:a,EffectValue:o},6:{Name:n,FightingPower:FightingPower.SeriesAttack,Desc:a,EffectValue:o},7:{Name:n,FightingPower:FightingPower.Defense,Desc:a,EffectValue:o},8:{Name:n,FightingPower:FightingPower.SeriesDefense,Desc:a,EffectValue:o},9:{Name:n,FightingPower:FightingPower.SeriesDefense,Desc:a,EffectValue:o},10:{Name:n,FightingPower:FightingPower.SeriesDefense,Desc:a,EffectValue:o},11:{Name:n,FightingPower:FightingPower.SeriesDefense,Desc:a,EffectValue:o},12:{Name:n,FightingPower:FightingPower.SeriesDefense,Desc:a,EffectValue:o},13:{Name:n,FightingPower:4e3,Desc:a,EffectValue:o},14:{Name:n,FightingPower:8e3,Desc:a,EffectValue:o},15:{Name:n,FightingPower:FightingPower.Dodge,Desc:a,EffectValue:o},16:{Name:n,FightingPower:FightingPower.Hit,Desc:a,EffectValue:o},17:{Name:n,FightingPower:FightingPower.Life,Desc:a,EffectValue:o},18:{Name:n,FightingPower:60,Desc:a,EffectValue:o},19:{Name:n,FightingPower:60,Desc:a,EffectValue:o},20:{Name:n,FightingPower:60,Desc:a,EffectValue:o},21:{Name:n,FightingPower:60,Desc:a,EffectValue:o},22:{Name:n,FightingPower:FightingPower.SeriesAttack,Desc:a,EffectValue:o},23:{Name:n,FightingPower:FightingPower.SeriesDefense,Desc:a,EffectValue:o},24:{Name:n,FightingPower:10,Desc:a,EffectValue:o},25:{Name:n,FightingPower:10,Desc:a,EffectValue:o},26:{Name:n,FightingPower:10,Desc:a,EffectValue:o},27:{Name:n,FightingPower:10,Desc:a,EffectValue:o},28:{Name:n,FightingPower:10,Desc:a,EffectValue:o},29:{Name:n,FightingPower:FightingPower.SeriesAggravate,Desc:a,EffectValue:o},30:{Name:n,FightingPower:FightingPower.SeriesMitigate,Desc:a,EffectValue:o},31:{Name:n,FightingPower:FightingPower.Strike,Desc:a,EffectValue:o},32:{Name:n,FightingPower:FightingPower.AntiStrike,Desc:a,EffectValue:o},33:{Name:n,FightingPower:10,Desc:a,EffectValue:o},34:{Name:n,FightingPower:10,Desc:a,EffectValue:o},35:{Name:n,FightingPower:420,Desc:a,EffectValue:o},36:{Name:n,FightingPower:2,Desc:a,EffectValue:o},37:{Name:n,FightingPower:5,Desc:a,EffectValue:o},38:{Name:n,FightingPower:5,Desc:a,EffectValue:o},39:{Name:n,FightingPower:5,Desc:a,EffectValue:o},40:{Name:n,FightingPower:5,Desc:a,EffectValue:o},41:{Name:n,FightingPower:5,Desc:a,EffectValue:o},42:{Name:n,FightingPower:5,Desc:a,EffectValue:o},43:{Name:n,FightingPower:1120,Desc:a,EffectValue:o},44:{Name:n,FightingPower:1120,Desc:a,EffectValue:o},45:{Name:n,FightingPower:FightingPower.SeriesDefense,Desc:a,EffectValue:o},46:{Desc:function(e,t,n){switch(t[0]){case Game.Series.SeriesMetal:return a(2,[t[1]],n);case Game.Series.SeriesWood:return a(3,[t[1]],n);case Game.Series.SeriesWater:return a(4,[t[1]],n);case Game.Series.SeriesFire:return a(5,[t[1]],n);case Game.Series.SeriesEarth:return a(6,[t[1]],n);default:return egret.error("attribute=<46,["+t+"]>"),""}},GetFP:function(e){return e[1]*FightingPower.SeriesAttack},EffectValue:o},47:{Desc:function(e,t,n){switch(t[0]){case Game.Series.SeriesMetal:return a(9,[t[1]],n);case Game.Series.SeriesWood:return a(12,[t[1]],n);case Game.Series.SeriesWater:return a(11,[t[1]],n);case Game.Series.SeriesFire:return a(8,[t[1]],n);case Game.Series.SeriesEarth:return a(10,[t[1]],n);default:return egret.error("attribute=<47,["+t+"]>"),""}},GetFP:function(e){return e[1]*FightingPower.SeriesDefense},EffectValue:o},48:{Desc:function(e,t,n){switch(t[0]){case Game.Series.SeriesMetal:return a(24,[t[1]],n);case Game.Series.SeriesWood:return a(25,[t[1]],n);case Game.Series.SeriesWater:return a(26,[t[1]],n);case Game.Series.SeriesFire:return a(27,[t[1]],n);case Game.Series.SeriesEarth:return a(28,[t[1]],n);default:return egret.error("attribute=<48,["+t+"]>"),""}},GetFP:function(e){return 10*e[1]},EffectValue:o},49:{Name:n,Desc:i,FightingPower:80,EffectValue:r},51:{Name:n,Desc:a,EffectValue:o,FightingPower:1120},52:{Name:n,FightingPower:1120,Desc:a,EffectValue:o},53:{Name:n,FightingPower:1120,Desc:a,EffectValue:o},54:{Name:n,FightingPower:1120,Desc:a,EffectValue:o},59:{GetFP:function(e){return e[1]*FightingPower.SeriesDefense},Desc:function(e,t,n){var i=Game.GetRestrictionSeries(Player.instance.Series,t[0]);switch(i){case Game.Series.SeriesMetal:return a(8,[t[1]],n);case Game.Series.SeriesWood:return a(9,[t[1]],n);case Game.Series.SeriesWater:return a(10,[t[1]],n);case Game.Series.SeriesFire:return a(11,[t[1]],n);case Game.Series.SeriesEarth:return a(12,[t[1]],n);default:return egret.error("attribute=<59,["+t+"]>"),""}},Name:function(e){var t=Game.seriesRestriction[Player.instance.Series];switch(t){case Game.Series.SeriesMetal:return n(8);case Game.Series.SeriesWood:return n(9);case Game.Series.SeriesWater:return n(10);case Game.Series.SeriesFire:return n(11);case Game.Series.SeriesEarth:return n(12);default:return egret.error("attribute=<59,["+t+"]>"),""}},EffectValue:o},60:{Name:n,FightingPower:175,Desc:a,EffectValue:o},61:{Name:n,FightingPower:23800,Desc:a,EffectValue:o},62:{Name:n,FightingPower:0,Desc:a,EffectValue:o},63:{Name:n,FightingPower:0,Desc:a,EffectValue:o},64:{Name:n,FightingPower:5600,Desc:a,EffectValue:o},65:{Name:n,FightingPower:1120,Desc:a,EffectValue:o},66:{Name:n,FightingPower:1120,Desc:a,EffectValue:o},67:{Name:n,FightingPower:1120,Desc:a,EffectValue:o},68:{Name:n,FightingPower:1120,Desc:a,EffectValue:o},69:{Name:n,FightingPower:1120,Desc:a,EffectValue:o},70:{Name:n,FightingPower:35,Desc:a,EffectValue:o},71:{Name:n,FightingPower:35,Desc:a,EffectValue:o},72:{Name:n,FightingPower:11269,Desc:a,EffectValue:o},75:{Name:n,FightingPower:0,Desc:a,EffectValue:o},76:{Name:n,FightingPower:0,Desc:a,EffectValue:o},77:{Name:n,FightingPower:0,Desc:i,EffectValue:r},78:{Name:n,FightingPower:0,Desc:i,EffectValue:r},79:{Name:n,FightingPower:10,Desc:a,EffectValue:o},80:{Name:n,FightingPower:5,Desc:a,EffectValue:o},81:{Name:n,FightingPower:5,Desc:a,EffectValue:o},82:{Name:n,FightingPower:6e3,Desc:a,EffectValue:o},83:{Name:n,FightingPower:6e3,Desc:a,EffectValue:o},84:{Name:n,FightingPower:6e3,Desc:a,EffectValue:o},85:{Name:n,FightingPower:6e3,Desc:a,EffectValue:o},86:{Name:n,FightingPower:50,Desc:i,EffectValue:r},87:{Name:n,FightingPower:50,Desc:i,EffectValue:r},88:{Name:n,FightingPower:50,Desc:i,EffectValue:r},89:{Name:n,FightingPower:50,Desc:i,EffectValue:r},90:{Name:n,FightingPower:50,Desc:i,EffectValue:r}};e.load=l,e.GetAttackDesc=u,e.GetLifeDesc=c,e.GetDefenseDesc=h,e.GetDesc=d,e.GetName=p,e.GetEffectValue=g}(Buff||(Buff={}));var Recharge7Day;!function(e){function t(){e.activity=new Activity.MissionActivity(Activity.ActivityKind.Activity_Recharge7Day),e.activity.eventName=Game.EVENT.Recharge7DayOpen;var t=RES.getRes("public_config/operation/recharge7day/recharge7day.json");e.activity.profiles=t.profile,e.activity.initSelf=function(){e.awardsConfig=[];for(var t=e.activity.settings.awards,n=0;n<t.length;n++){var i=t[n],a=table.parseListAwards(i.award);e.awardsConfig.push({day:i.day,awards:a})}},e.activity.openCallback=function(e){c(e)},net.Register(338,i),net.Register(333,a),net.Register(346,n),net.Register(337,r)}function n(t){var n=net.def.Value.decode(t);e.gold=n.Value,Game.dispatcher.dispatchEventWith(Game.EVENT.Recharge7DayGold)}function i(t){var n=net.def.S2CSyncContinuousRecharge.decode(t);e.awardsStatus=n.status,u(),e.day=n.day,e.gold=n.gold,Game.dispatcher.dispatchEventWith(Game.EVENT.Recharge7DayGold),Game.dispatcher.dispatchEventWith(Game.EVENT.Recharge7DaySyncState)}function a(t){var n=net.def.Value.decode(t);e.day=n.Value,Game.dispatcher.dispatchEventWith(Game.EVENT.Recharge7DayGold)}function r(t){var n=net.def.S2CAwards.decode(t);e.awardsStatus=n.awards,u(),Game.dispatcher.dispatchEventWith(Game.EVENT.Recharge7DaySyncState)}function o(e){var t=new net.def.Index;t.setIndex(e),net.socket.write(103,t.toArrayBuffer())}function s(){return e.activity.settings.threshold}function l(){return e.activity.settings.duration}function u(){for(var t=!1,n=0;n<e.awardsStatus.length;n++)if(1==e.awardsStatus[n]){t=!0;break}badge.onLight(badge.action.Recharge7DayAward,t)}function c(e){0==e&&badge.onLight(badge.action.Recharge7DayAward,!1)}e.load=t,e.drawAward=o,e.getThreshold=s,e.getDuration=l}(Recharge7Day||(Recharge7Day={}));var RecruitOpt;!function(e){function t(){e.recruitCfg=RES.getRes("config/recruitSys.json"),net.Register(2163,n)}function n(e){var t=net.def.S2CSyncRecruitResult.decode(e);if(t.recruit){Partner.recruiting=!1;var n=UI.PetEnlistResult.instance;n.updateAwards(t.awards),1==t.getAwards().length?n.currentState="one":n.currentState="ten",UIManager.push(n)}else UIManager.push(UI.PetEnlistShow.instance.show(0));Game.dispatcher.dispatchEventWith(Game.EVENT.RecruitResult)}function i(t){return 0>t||t>=e.recruitCfg.length?null:e.recruitCfg[t]}function a(e,t){var n=i(e);if(null==n)return{haveCount:0,count:0};if(0>t||t>=n.openCost.length)return{haveCount:0,count:0};var a=n.openCost[t],r=PlayerAttribute.bag.CalcCount(a.content.genre,a.content.detailType);return{haveCount:r,count:a.content.count}}function r(e,t){var n=a(e,t);return n.haveCount<=0||n.haveCount<n.count?!1:!0}function o(e,t){if(r(e,t)){var n=i(e),a=n.openCost[t];Partner.recruiting=!0;var o=new net.def.C2SRecruit;o.setId(n.id),o.setRecruitType(a.costType),net.socket.write(2117,o.toArrayBuffer())
}}e.recruitCfg=[],e.init=t,e.getRecruit=i,e.getRecruitCount=a,e.checkRecruitCost=r,e.Recruit=o,Game.RegisterLoader(t)}(RecruitOpt||(RecruitOpt={}));var RedPacket;!function(e){function t(){for(var t=RES.getRes("public_config/redpacket.json"),n=0,i=t;n<i.length;n++){var a=i[n];e.settings[a.kind]=a}}function n(t){if(!Player.instance.guildName)return void PopUpMessage.push(lang.String("require guild"),color.RED);if(e.times>=e.DailyTimes)return void PopUpMessage.push(lang.StringWithFormat("[redpacket][send]not enough daily times{1}",e.times),color.RED);var n=new net.def.C2SSendRedPacket;n.id=t,net.socket.write(158,n.toArrayBuffer())}function i(e){var t=new net.def.UUID;t.uuid=e,net.socket.write(159,t.toArrayBuffer()),Game.dispatcher.hasEventListener(Game.EVENT.S2CRedPacketDetail)||Game.dispatcher.once(Game.EVENT.S2CRedPacketDetail,r,null)}function a(e){var t=new net.def.UUID;t.uuid=e,net.socket.write(166,t.toArrayBuffer()),Game.dispatcher.hasEventListener(Game.EVENT.S2CRedPacketDetail)||Game.dispatcher.once(Game.EVENT.S2CRedPacketDetail,r,null)}function r(e){UI.RedPacketResult.instance.open(e.data)}function o(){UIManager.pushPage(UI.RedPacketUI.instance),net.socket.write(165,null)}function s(){var t="",n=0;for(var i in e.settings)n+=1,t+=n+"."+e.settings[i].desc+"\n";return t}function l(e){var t=!1;switch(e){case 37:case 38:case 39:case 40:case 41:t=!0}return t}e.MemberCountFactor=240;var u=function(){function t(){}return Object.defineProperty(t.prototype,"status",{get:function(){return e.status[this.kind]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"desc",{get:function(){return Game.HtmlTextParser.parse(e.settings[this.kind].desc)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"weight",{get:function(){return this.kind},enumerable:!0,configurable:!0}),t.prototype.handle=function(){e.status[this.kind]||Operation.open(e.settings[this.kind].operation)},t}();e.BaseCareer=u,__reflect(u.prototype,"RedPacket.BaseCareer",["RedPacket.Career"]);var c=function(){function t(){this.kinds=[]}return Object.defineProperty(t.prototype,"weight",{get:function(){return this.kinds[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"desc",{get:function(){for(var t=[],n=this.kinds.length,i=0;n>i;i++){var a=this.kinds[i];null==e.settings[a].order&&(e.settings[a].order=999),t.push(e.settings[a])}t.sort(function(e,t){return e.order>t.order?1:t.order>e.order?-1:0});for(var i=0;i<t.length;i++){var r=t[i],a=r.kind;if(!(e.status[a]&&n-1>i)){var o=0;switch(r.group){case 5:for(var s=0;s<Game.BookCategory;s++){var l=PlayerAttribute.books[s];l&&(o=Math.max(l.totalLevel(),o))}break;case 6:o=PlayerAttribute.getEnhanceExtraLevel();break;case 2:Player.instance.factionTitle>0&&(o=FactionTitle.getLevel());break;case 7:o=PlayerGem.GetTotalLevel();break;case 9:o=HuashanPK.maxRound;break;case 4:o=~~(Meridian.level/80);break;case 3:for(var u=0;u<Partner.list.length;u++){var c=Partner.list[u],h=Partner.GetPartnerCfg(c.id);4==h.quality&&(o=Math.max(o,c.level))}}return Game.HtmlTextParser.parse(StringWithFormat(r.career,o))}}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"status",{get:function(){for(var t=0,n=this.kinds;t<n.length;t++){var i=n[t];if(!e.status[i])return!1}return!0},enumerable:!0,configurable:!0}),t.prototype.handle=function(){for(var t=0,n=this.kinds;t<n.length;t++){var i=n[t];e.status[i]||Operation.open(e.settings[i].operation)}},t}();e.GroupCareer=c,__reflect(c.prototype,"RedPacket.GroupCareer",["RedPacket.Career"]);var h=function(){function t(e,t){this.kind=e,this.count=t}return Object.defineProperty(t.prototype,"total",{get:function(){var t=e.settings[this.kind].amount,n=0;return Guild.guildInfo&&(n=Guild.guildInfo.memberCount),t+~~(t*n/e.MemberCountFactor)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totaldesc",{get:function(){var t=e.settings[this.kind].amount,n=0;return Guild.guildInfo&&(n=Guild.guildInfo.memberCount),t+" + "+~~(t*n/e.MemberCountFactor)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"source",{get:function(){return e.settings[this.kind].desc},enumerable:!0,configurable:!0}),t}();e.TaskRedPacket=h,__reflect(h.prototype,"RedPacket.TaskRedPacket"),e.DailyTimes=20,e.taskRedPackets={},e.status={},e.guildRedPackets={},e.times=0,e.settings={},e.load=t,e.send=n,e.receive=i,e.FetchRedPacketDetail=a,e.openRedPacketResult=r,e.openHistoryUI=o,e.getHelpContent=s,e.isToastRedPacket=l}(RedPacket||(RedPacket={}));var Refine;!function(e){function t(){Game.dispatcher.addEventListener(Game.EVENT.AddItem,l,null),Game.dispatcher.addEventListener(Game.EVENT.RemoveItem,l,null),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,l,null),e.delayLoginUpdate();var t=RES.getRes("public_config/refineconfig.json");e.openLevel=t.openLevel;for(var n in t.attributes){var i=Item.EquipParsePart[n];null==e.attributes[i]&&(e.attributes[i]={});for(var a=t.attributes[n],r=0;r!=a.length;r++){var o=t.attributes[n][r],s=o.level;e.attributes[i][s]=o,s>e.maxLevel&&(e.maxLevel=s)}}for(var r=0;r!=Game.EquipPart.EquipCount;r++)e.levels[r]=0}function n(e){var t=new net.def.Index;t.index=e,net.socket.write(2086,t.toArrayBuffer())}function i(t){e.levels=t,PlayerAttribute.UpdateFightingPower(u),Game.dispatcher.dispatchEventWith(Game.EVENT.RefineDataChange),l(),u||(u=!0)}function a(t){return e.levels[t]}function r(t,n){return e.attributes[t][n]}function o(){for(var t=0,n=0;n!=Game.EquipPart.EquipCount;n++){var i=e.levels[n],a=r(n,i);null!=a&&(t+=a.power)}return t}function s(){for(var t=e.maxLevel,n=0;n!=Game.EquipPart.EquipCount;n++)e.levels[n]<t&&(t=e.levels[n]);return t}function l(){if(PlayerAttribute.Level<e.openLevel)return void badge.onLight(badge.action.Refine,!1);if(s()>=e.maxLevel)return void badge.onLight(badge.action.Refine,!1);var t=0,n=PlayerAttribute.Equips;if(null!=n){for(var i=99999,a=0;a!=Game.EquipPart.EquipCount;a++){var o=e.getRefineLevel(a);null!=n[a]&&o<e.maxLevel&&i>o&&(i=o,t=a)}var l=r(t,i+1);if(null==l)return void badge.onLight(badge.action.Refine,!1);var u=l.costItem[0],c=l.costItem[1],h=l.costItem[2],d=PlayerAttribute.GetItemCount(u,c)>=h;badge.onLight(badge.action.Refine,d)}}e.openLevel=999,e.attributes={},e.levels=[],e.maxLevel=0;var u=!1;e.delayLoginUpdate=MakeDelayExecute(function(){l()},null,3e3),e.Load=t,e.applyRefine=n,e.onSyncRefine=i,e.getRefineLevel=a,e.getConfig=r,e.GetTotalFp=o,e.getLowLevel=s,e.updateBadge=l}(Refine||(Refine={}));var Reminder;!function(e){function t(){e.timers=[];for(var t=0;t<e.events.length;t++){var i=e.events[t];if((i.id!=m.Babel||WorldLine.IsOpen("BabelScene"))&&(i.id!=m.GuildDungeon||WorldLine.IsOpen("GuildDungeon"))&&(i.id!=m.JianMenGuan||WorldLine.IsOpen("JianMenGuanScene"))&&(i.id!=m.BravePalace||WorldLine.IsOpen("BravePalace"))){i.id==m.JianMenGuan&&(i.timeLine=JianMenGuan.config.timers,i.duration=JianMenGuan.config.prepareTime);for(var a=0;a<i.timeLine.length;a++)e.timers.push({type:i.id,hour:i.timeLine[a].hour,minute:i.timeLine[a].minute,duration:i.duration,date:null})}}n()}function n(){for(var t=Game.getServerDate(),n=0;n<e.timers.length;n++){var i=new Date(t.getFullYear(),t.getMonth(),t.getDate(),e.timers[n].hour,e.timers[n].minute,0),r=i.getTime()-t.getTime();0>=r?e.timers[n].date=1440*Game.Minute+i.getTime():e.timers[n].date=i.getTime()}e.timers.sort(a)}function i(){for(var t=Game.getServerDate(),n=0;n<e.timers.length;n++){var i=new Date(t.getFullYear(),t.getMonth(),t.getDate(),e.timers[n].hour,e.timers[n].minute,0),a=t.getTime()-i.getTime(),r=e.timers[n].type,o=e.timers[n].duration-a;if(a>=0&&a<e.timers[n].duration){switch(r){case m.CrossServerBoss:Game.countDay()+1>=e.events[m.CrossServerBoss].openDayLimit&&CrossServer.StartTimer(o)}d(r)&&s(r,o,"");break}}}function a(e,t){return e.date-t.date}function r(e,t,n){s(e,t,n)}function o(e){UI.HUD.instance.battle.PopReminder(e)}function s(e,t,n){UI.HUD.instance.battle.onFeatureReminder(e,t,n)}function l(){for(var t,n=Game.getServerDate(),i=0;i<e.timers.length;i++)if(e.timers[i].date<=n.getTime()){e.timers[i].date+=1440*Game.Minute,t=i;var a=e.timers[i].type,r=e.timers[i].duration;switch(a){case m.CrossServerBoss:Game.countDay()+1>=e.events[m.CrossServerBoss].openDayLimit&&(CrossServer.initBossStatus(),CrossServer.StartTimer(r))}d(a)&&s(a,r,"");break}if(null!=t){var o=e.timers.splice(t,1);e.timers.push(o[0])}}function u(t){return null!=e.events[t]?e.events[t].name:""}function c(t){return null!=e.events[t]?e.events[t].action:""}function h(t){return null!=e.events[t]?e.events[t].icon:""}function d(t){switch(t){case m.GuildManor:return""!=Player.instance.guildName;case m.QinMausoleum:return""!=Player.instance.guildName&&PlayerAttribute.Level>=QinMausoleum.openLevel;case m.CrossServerBoss:return""!=Player.instance.guildName&&PlayerAttribute.Level>=CrossServer.bossOpenLevel&&CrossServer.checkCrossBossAllStatus()&&Game.countDay()+1>=e.events[m.CrossServerBoss].openDayLimit;case m.CrossServerSongJinWar:case m.PersonalMatch:return PlayerAttribute.Level>=SongJin.OpenLevelForCrossServer&&SongJin.hasXSvrTimes();case m.Yanemperor:return PlayerAttribute.Level>=YanEmperor.openLevel?(badge.onLight(badge.action.YanemperorLogin,!0),!0):!1;case m.Babel:return PlayerAttribute.Level>=Babel.config.levelLimit;case m.JianMenGuan:return PlayerAttribute.Level>=JianMenGuan.config.level;default:return!1}}function p(t){switch(t){case m.GuildManor:return net.socket.write(94,null),!0;case m.QinMausoleum:return UIManager.pushPage(new UI.QinEntrance),!0;case m.CrossServerBoss:return Game.countDay()+1>=e.events[m.CrossServerBoss].openDayLimit?(UIManager.pushPage(new UI.CrossServerBossEntrance),!0):!1;case m.CrossServerSongJinWar:return UIManager.pushPage(new UI.CrossServerSongJinWar),!0;case m.PersonalMatch:return UIManager.pushPage(new UI.PersonalMatchUI),!0;case m.GuildWarMatch:case m.GuildWarMatch2:return GuildWarMatchScene.OnClickBtnReminder();case m.Yanemperor:return UI.YanEmperorTransfer.open(-1),!0;case m.Babel:return Babel.OpenAndJoin(),!0;case m.GuildDungeon:return GuildDungeon.Hotkey2Open(),!0;case m.NienBoss:return NienBoss.ApplyJoin(),!0;case m.BravePalace:return BravePalace.OpenUI(),!0;case m.JianMenGuan:return UI.JianMenGuanUI.open(),!0;default:return!1}}function g(n){for(var i=~~(n/100),a=~~(n%100),r=0;r!=e.events.length;r++){var o=e.events[r];o.id==m.GuildManor&&(e.events[r].timeLine=[{hour:i,minute:a}])}t()}e.timers=[];var m;!function(e){e[e.GuildManor=0]="GuildManor",e[e.QinMausoleum=1]="QinMausoleum",e[e.CrossServerBoss=2]="CrossServerBoss",e[e.CrossServerSongJinWar=3]="CrossServerSongJinWar",e[e.GuildWarMatch=4]="GuildWarMatch",e[e.GuildWarMatch2=5]="GuildWarMatch2",e[e.Yanemperor=6]="Yanemperor",e[e.Babel=7]="Babel",e[e.GuildDungeon=8]="GuildDungeon",e[e.NienBoss=9]="NienBoss",e[e.PersonalMatch=10]="PersonalMatch",e[e.BravePalace=11]="BravePalace",e[e.JianMenGuan=12]="JianMenGuan"}(m=e.EventName||(e.EventName={})),e.events=[{id:m.GuildManor,timeLine:[{hour:19,minute:30}],name:"Lửa Trại Bang",action:"Hoạt động hẹn giờ",icon:"ui/city1/btn_kaohuo.png",duration:3*Game.Minute,openDayLimit:0},{id:m.QinMausoleum,timeLine:[{hour:10,minute:30},{hour:16,minute:30},{hour:21,minute:30}],name:"Tần Lăng",action:"Hoạt động hẹn giờ",icon:"ui/city1/btn_qinling.png",duration:7*Game.Minute,openDayLimit:0},{id:m.CrossServerBoss,timeLine:[{hour:12,minute:30},{hour:19,minute:30}],name:"BOSS Liên Server",action:"Hoạt động hẹn giờ",icon:"ui/map/cboss01.png",duration:15*Game.Minute,openDayLimit:5},{id:m.CrossServerSongJinWar,timeLine:[{hour:10,minute:0},{hour:12,minute:0},{hour:16,minute:0},{hour:22,minute:0},{hour:23,minute:0}],name:"Tống Kim",action:"Hoạt động hẹn giờ",icon:"ui/city1/btn_songjin.png",duration:3*Game.Minute,openDayLimit:0},{id:m.GuildWarMatch,timeLine:[],name:"Đệ Nhất Bang",action:"Hoạt động hẹn giờ",icon:"ui/map/bpls.png",duration:3*Game.Minute,openDayLimit:0},{id:m.GuildWarMatch2,timeLine:[],name:"Công Thành Chiến",action:"Hoạt động hẹn giờ",icon:"ui/map/bpls.png",duration:3*Game.Minute,openDayLimit:0},{id:m.Yanemperor,timeLine:[],name:"Kho Báu Viêm Đế",action:"Hoạt động hẹn giờ",icon:"ui/city1/btn_yanemperor.png",duration:3*Game.Minute,openDayLimit:0},{id:m.Babel,timeLine:[{hour:11,minute:0},{hour:17,minute:0},{hour:22,minute:30}],name:"Thông Thiên Tháp",action:"Hoạt động hẹn giờ",icon:"ui/city1/btn_ttt.png",duration:5*Game.Minute,openDayLimit:0},{id:m.GuildDungeon,timeLine:[],name:"Thiên Bảo Khố",action:"Hoạt động hẹn giờ",icon:"ui/city1/btn_qianbaoku.png",duration:3*Game.Minute,openDayLimit:0},{id:m.NienBoss,timeLine:[],name:"Boss Niên Thú",action:"Hoạt động hẹn giờ",icon:"ui/city1/ns_.png",duration:5*Game.Minute,openDayLimit:0},{id:m.PersonalMatch,timeLine:[{hour:20,minute:0}],name:"Toàn Dân Loạn Đấu",action:"Hoạt động hẹn giờ",icon:"ui/city1/btn_qmld.png",duration:3*Game.Minute,openDayLimit:0},{id:m.BravePalace,timeLine:[],name:"Dũng Võ Điện",action:"Hoạt động hẹn giờ",icon:"ui/city1/btn_yongWuDian.png",duration:3*Game.Minute,openDayLimit:0},{id:m.JianMenGuan,timeLine:[],name:"Kiếm Môn Quan Chiến",action:"Hoạt động hẹn giờ",icon:"ui/city1/btn_jianmenguang.png",duration:3*Game.Minute,openDayLimit:0}],e.load=t,e.checkReminder=i,e.PushReminder=r,e.PopReminder=o,e.onActivityTime=l,e.getName=u,e.getAction=c,e.getIcon=h,e.checkCondition=d,e.onClick=p,e.onSyncGuildToastTime=g}(Reminder||(Reminder={}));var RewardRetrieveLogic;!function(e){function t(){return null==p&&(p=new Array,Object.getOwnPropertyNames(table.rewardRetrieveItems).forEach(function(e,t,n){var i=table.rewardRetrieveItems[e].id;p.push(new d(i))})),p}function n(e){if(null==g){g={};for(var n=t(),i=n.length,a=0;i>a;a++)g[n[a].id]=a}var r=g[e];return null!=r?r:-1}function i(e){for(var i=t(),a=i.length,r=0;a>r;r++)i[r].count=0;for(var o=e.items.length,s=0,r=0;o>r;r++){var l=e.items[r].id,u=n(l);u>=0&&(i[u].count=e.items[r].count,i[u].count>i[u].max&&(i[u].count=i[u].max),i[u].count>s&&(s=i[u].count))}s>0?badge.onLight(badge.action.RewardRetrieve,!0):badge.onLight(badge.action.RewardRetrieve,!1),null!=m&&m.updateUi()}function a(t,n){return n==e.Currency_Perfect?table.rewardRetrieveAwards.goldcoin[t]:table.rewardRetrieveAwards.coppercoin[t]}function r(e,t,n){var i=PlayerAttribute.currency[e],a=i>=t;return!a&&e==Game.Currency.SilverCoin&&n?(i+=PlayerAttribute.currency[Game.Currency.GoldCoin],i>=t):a}function o(){}function s(e,t,n){var i=new net.def.C2SRetrieveAward;i.setId(e),i.setCurrency(t),i.setCount(n),net.socket.write(147,i.toArrayBuffer())}function l(e){var t=new net.def.C2SRetrieveAllAward;t.setCurrency(e),net.socket.write(148,t.toArrayBuffer())}function u(e){e==Game.Currency.SilverCoin?PopUpMessage.push(lang.String("not enough silvercoin"),color.RED):e==Game.Currency.GoldCoin?PopUpMessage.push(lang.String("not enough goldcoin"),color.RED):PopUpMessage.push(lang.String("not enough copperCoin"),color.RED)}function c(){}function h(e){m=e}e.Currency_Perfect=Game.Currency.SilverCoin,e.Currency_Normal=Game.Currency.CopperCoin;var d=function(){function t(e){this.id=e,this.count=0}return Object.defineProperty(t.prototype,"sortIndex",{get:function(){return table.rewardRetrieveItems[this.id].sortIndex},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"max",{get:function(){return table.rewardRetrieveItems[this.id].max},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return table.rewardRetrieveItems[this.id].name},enumerable:!0,configurable:!0}),t.prototype.cost=function(t){return t==e.Currency_Perfect?table.rewardRetrieveItems[this.id].goldcoin:table.rewardRetrieveItems[this.id].coppercoin},t.prototype.enabled=function(e,t){return r(e,this.cost(e),t)},Object.defineProperty(t.prototype,"awardId",{get:function(){return table.rewardRetrieveItems[this.id].awardId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"level",{get:function(){return table.rewardRetrieveItems[this.id].level},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxLevel",{get:function(){return table.rewardRetrieveItems[this.id].maxLevel},enumerable:!0,configurable:!0}),t}();e.Subject=d,__reflect(d.prototype,"RewardRetrieveLogic.Subject");var p=null,g=null;e.getSubjects=t,e.updateItems=i,e.awardsData=a,e.checkCurrency=r,e.requestServerInfo=o,e.requestGetAward=s,e.requestGetAllAward=l,e.showTipMoneyMsg=u,e.load=c;var m=null;e.onUiChange=h}(RewardRetrieveLogic||(RewardRetrieveLogic={}));var Rune;!function(e){function t(){Game.dispatcher.addEventListener(Game.EVENT.AddItem,f,null),Game.dispatcher.addEventListener(Game.EVENT.RemoveItem,f,null),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,f,null),e.delayLoginUpdate();for(var t=RES.getRes("public_config/runeconfig.json"),n=0;n!=t.bigKinds.length;n++){var i=t.bigKinds[n];e.bigKinds[i.id]=i;var a=parseInt(i.nameColor,16);e.bigKindNameColor[i.id]=a;var r=parseInt(i.attribColor,16);e.bigKindAttribColor[i.id]=r;for(var o=0;o!=i.subKinds.length;o++){var s=i.subKinds[o];e.smallKind2BigKind[s]=i.id}}for(var n=0;n!=t.smallKinds.length;n++){var i=t.smallKinds[n],s=i.id;e.smallKinds[s]=i,null==e.attributes[s]&&(e.attributes[s]={});for(var o=0;o!=i.attributes.length;o++){var l=i.attributes[o],u=l.level;e.attributes[s][u]=l,u>e.maxLevel&&(e.maxLevel=u)}}for(var n=0;n!=Game.RuneCount;n++)e.levels[n]=0}function n(e){var t=new net.def.Index;t.index=e,net.socket.write(2087,t.toArrayBuffer())}function i(t){e.levels=t,PlayerAttribute.UpdateFightingPower(y),Game.dispatcher.dispatchEventWith(Game.EVENT.RuneDataChange),f(),y||(y=!0)}function a(t){var n=t-1;return e.levels[n]}function r(t,n){return e.attributes[t][n]}function o(t){return e.smallKinds[t]}function s(t){return e.bigKinds[t]}function l(){for(var t=0,n=0;n!=Game.RuneCount;n++){var i=e.levels[n],a=n+1,o=r(a,i);null!=o&&(t+=o.power)}return t}function u(t){return e.smallKind2BigKind[t]}function c(t){var n=u(t),i=e.bigKindNameColor[n];return i}function h(t){var n=e.bigKindNameColor[t];return n}function d(t){var n=u(t),i=e.bigKindAttribColor[n];return i}function p(t){var n=e.bigKindAttribColor[t];return n}function g(){for(var t=0,n=0;n!=Game.RuneCount;n++)t+=e.levels[n];return t}function m(e){return PlayerAttribute.Level<Refine.openLevel?void PopUpMessage.push(lang.StringWithFormat("open on level {1}",Refine.openLevel),color.RED):(UI.RuneDetail.instance.page=e,void UIManager.pushPage(UI.RuneDetail.instance))}function f(){var t=g(),n=Refine.getLowLevel();if(t>=n)for(var i in e.bigKinds){var a=Number(i),o=e.bigKinds[a];badge.onLight(o.badge,!1)}else for(var i in e.bigKinds){for(var a=Number(i),o=e.bigKinds[a],s=-1,l=e.maxLevel,u=0;u!=o.subKinds.length;u++){var c=o.subKinds[u],h=c-1,d=e.levels[h];l>d&&(l=d,s=c)}if(-1!=s){var p=l+1,m=r(s,p);if(null!=m){var f=m.costItem[0],v=m.costItem[1],y=m.costItem[2],b=PlayerAttribute.GetItemCount(f,v)>=y;badge.onLight(o.badge,b)}else badge.onLight(o.badge,!1)}else badge.onLight(o.badge,!1)}}function v(t){var n="";for(var i in e.bigKinds){for(var a=Number(i),r=e.bigKinds[a],s=r.nameColor,l=r.name,u=-1,c=-1,h=0;h!=r.subKinds.length;h++){var d=r.subKinds[h],p=d-1,g=t[p];(0>c&&g>c||c>=0&&g>0&&g>=c)&&(c=g,u=d)}if(u>=0){s=s.replace("0x","#");var m=o(u),f=m.name;n+="        <font color="+s+(">"+l+"  "+f+" Lv."+c+"</font>\n")}}return n}e.bigKinds={},e.smallKinds={},e.attributes={},e.smallKind2BigKind={},e.maxLevel=0,e.levels=[],e.bigKindNameColor={},e.bigKindAttribColor={};var y=!1;e.delayLoginUpdate=MakeDelayExecute(function(){f()},null,3e3),e.Load=t,e.applyRune=n,e.onSyncRune=i,e.getRuneLevel=a,e.getAttributeConfig=r,e.getSmallKindConfig=o,e.getBigKindCfg=s,e.GetTotalFp=l,e.getBigKind=u,e.getSmallKindNameColor=c,e.getBigKindNameColor=h,e.getSmallKindAttribColor=d,e.getBigKindAttribColor=p,e.getTotalLevel=g,e.openDetailPanel=m,e.updateBadge=f,e.getRuneLevelDesc=v}(Rune||(Rune={}));var SeaSunVillage;!function(e){function t(){return 0}function n(){for(var t=(Player.instance,e.chapterInfo.length-1);t>=0;t--)if(PlayerAttribute.Level>=e.chapterInfo[t].level)return e.chapterInfo[t].name;return""}function i(){for(var t=0,n=e.chapterInfo.length-1;n>=0;n--)e.chapterInfo[n].level>PlayerAttribute.Level&&(0==t||e.chapterInfo[n].level<t)&&(t=e.chapterInfo[n].level);return t}function a(){for(var t=0,n=0;n!=e.chapterInfo.length;n++)e.chapterInfo[n].level>0&&(0==t||e.chapterInfo[n].level<t)&&(t=e.chapterInfo[n].level);return t}function r(t){var n=e.chapterInfo[t].level;if(PlayerAttribute.Level<n)return PopUpMessage.push(lang.StringWithFormat("open on level {1}",n),color.RED),!1;if(e.curTimes<=0)return this.buyTimes<=0?void PopUpMessage.push(lang.String("explore times used up"),color.RED):(UIManager.pushPage(new UI.BuySeaSunTimes),!1);var i=new net.def.C2SSeaSunVillage;return i.chapter=t,net.socket.write(41,i.toArrayBuffer()),!0}function o(){return PlayerAttribute.bag.capacity(Game.BagPage.Prop)<1?void PopUpMessage.push(lang.String("bag room full"),color.RED):(u(),net.socket.write(42,null),void(e.auto=!0))}function s(){e.delayquit.stop(),net.socket.write(141,null)}function l(){return null!=S&&(egret.clearTimeout(S),S=null),net.socket.write(43,null),!0}function u(){null!=UI.dice&&(UIManager.pop(UI.dice),UI.dice=null),null!=UI.roshambo&&(UIManager.pop(UI.roshambo),UI.roshambo=null)}function c(){return null==e.task?"none":e.task.id==C.TaskNone?0==e.curTimes?"complete":"none":"tasking"}function h(t){if(e.chapter=t.chapter,null==e.task?e.task={id:t.task,pos:new egret.Point(t.x,t.y),param:t.param,requireCount:t.requireCount,count:t.count,status:t.status,targetObjs:t.targetObjs}:(e.task.id=t.task,e.task.pos.setTo(t.x,t.y),e.task.param=t.param,e.task.requireCount=t.requireCount,e.task.count=t.count,e.task.status=t.status,e.task.targetObjs=t.targetObjs),e.task.id==C.TaskNone)return null==I&&(I=new UI.SeaSunHUD),I.currentState=c(),"none"==I.currentState&&e.auto&&e.curTimes>0&&o(),void(0==e.curTimes&&e.delayquit());if(null==I&&(I=new UI.SeaSunHUD),I.currentState=c(),e.task.status==T.Running){switch(e.task.id){case C.TaskRoll:null==UI.dice&&(UI.dice=new UI.SeaSunDice),UIManager.pushPage(UI.dice);break;case C.TaskRoshambo:null==UI.roshambo&&(UI.roshambo=new UI.SeaSunRoshambo),UIManager.pushPage(UI.roshambo)}e.auto||(e.auto=!0)}b=null}function d(){null==UI.taskPanel&&(UI.taskPanel=new UI.TaskPanel),e.task.id==C.TaskCollection?UI.taskPanel.desc=StringWithFormat(e.taskInfo[e.task.id-1].desc,e.chapterInfo[e.chapter].herbs,table.objs[e.task.param].name):UI.taskPanel.desc=e.taskInfo[e.task.id-1].desc,UI.taskPanel.setAward(e.chapterInfo[e.chapter].awards),UI.taskPanel.OnOk=l,UIManager.pushPage(UI.taskPanel),S=egret.setTimeout(p,null,3*Game.Second)}function p(){S=null,null!=UI.taskPanel&&(UIManager.pop(UI.taskPanel),UI.taskPanel=null),l()}function g(t){if(null==e.task||e.task.id==C.TaskNone)return null;if(null!=e.task.targetObjs){var n=e.task.pos,i=Player.instance,a=g_GetDirIndex(n,i.logicPos);g_Move(a,MAX_DIR),AI.bb;if(g_WithInRange(n,i.logicPos,66))return e.task.status==T.Begin&&(null==b||b<egret.getTimer())&&(b=egret.getTimer()+6*Game.Second,m()),e.task.status==T.Running&&null==AI.findEnemy()&&null==UI.gathering&&(null==b||b<egret.getTimer())&&(b=egret.getTimer()+2*Game.Second,m()),null;var r=g_GetDirIndex(n,i.logicPos),o=g_Move(r,MAX_DIR),s=n.add(o);return AI.MoveTo(s),s}}function m(){if(null!=e.task.targetObjs)for(var t in e.task.targetObjs){var n=e.task.targetObjs[t],i=ECS.SceneObjectComponent.objs[n];if(null!=i){i.touch();break}}}function f(){Scene.handleIdle[E]=g,null==I&&(I=new UI.SeaSunHUD),UI.battle.addChild(I)}function v(){e.delayquit.stop(),null!=UI.dice&&(UIManager.pop(UI.dice),UI.dice.freeAssets(),UI.dice=null),null!=UI.roshambo&&(UIManager.pop(UI.roshambo),UI.roshambo.freeAssets(),UI.roshambo=null),delete Scene.handleIdle[E],UI.battle.removeChild(I),I=null,e.task=null,b=null,null!=S&&(egret.clearTimeout(S),S=null),e.auto=!1}function y(){var t=RES.getRes("config/scenes/seasunvillage.json");e.chapterInfo=t.chapter,e.taskInfo=t.task,Scene.listenEnterMap(E,f),Scene.listenLeaveMap(E,v)}e.taskFinishedNum=[0,0,0],e.targetTaskNum=[10,50,10];var b,S,E="seasunvillage";e.auto=!1;var C;!function(e){e[e.TaskNone=0]="TaskNone",e[e.TaskChest=1]="TaskChest",e[e.TaskChest2=2]="TaskChest2",e[e.TaskChest3=3]="TaskChest3",e[e.TaskCollection=4]="TaskCollection",e[e.TaskMonster=5]="TaskMonster",e[e.TaskPK=6]="TaskPK",e[e.TaskRoll=7]="TaskRoll",e[e.TaskRoshambo=8]="TaskRoshambo",e[e.TaskCount=9]="TaskCount"}(C=e.Task||(e.Task={}));var T;!function(e){e[e.None=0]="None",e[e.Begin=1]="Begin",e[e.Running=2]="Running"}(T||(T={})),e.getCurChapter=t,e.getCurChapterName=n,e.getNextChapterOpenLevel=i,e.getOpenLevel=a,e.sign=r,e.applyExplore=o,e.delayquit=MakeDelayExecute(function(){net.socket.write(141,null)},null,3e3),e.quit=s,e.accept=l,e.reset=u,e.getHUDState=c,e.syncTask=h,e.showTask=d;var I;e.load=y,e.Level=20}(SeaSunVillage||(SeaSunVillage={}));var Shop;!function(e){function t(e,t,n,i){var o;switch(t.type){case"item":o=new r,o.genre=t.content.genre,o.detailType=t.content.detailType,o.count=t.content.count;break;case"equip":o=new a,o.part=Item.EquipParsePart[t.content.part],o.id=t.content.id,o.level=t.content.level,o.quality=t.content["class"],o.attributes=1;break;default:return egret.error("unkown goods type"),null}o.pos=e,o.price=t.price,o.discount=null!=t.discount?t.discount:100,o.currency=n,o.buy=i;var s=null!=t.dailyBuyLimit?t.dailyBuyLimit:-1;return o.param={curPrice:o.currentPrice,curDailyBuyLimit:s,dailyBuyLimit:s},o}e.MaxRefreshTimes=20,e.MaxLeftStack=9999;var n;!function(e){e[e.Equip=0]="Equip",e[e.Prop=1]="Prop",e[e.Book=2]="Book",e[e.Custom=3]="Custom",e[e.Coin=4]="Coin"}(n=e.GoodsType||(e.GoodsType={}));var i=function(){function e(){}return Object.defineProperty(e.prototype,"Currency",{get:function(){return this.isItemCurrency?this.currency():Game.currency2Icon[this.currency]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isItemCurrency",{get:function(){return"number"!=typeof this.currency},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentPrice",{get:function(){return int(this.price*this.discount/100)},enumerable:!0,configurable:!0}),e.prototype.copyTo=function(e){e.param=this.param,e.pos=this.pos,e.currency=this.currency,e.price=this.price,e.discount=this.discount,e.guide=this.guide,e.buy=this.buy},e}();__reflect(i.prototype,"Goods");var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t.prototype,"icon",{get:function(){var e=Game.Faction[PlayerAttribute.faction];return table.equips[this.part][this.id][e].icon},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){var e=Game.Faction[PlayerAttribute.faction],t=table.equips[this.part][this.id][e].name;return t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return n.Equip},enumerable:!0,configurable:!0}),t.prototype.clone=function(){var e=new t;return this.copyTo(e),e.part=this.part,e.id=this.id,e.level=this.level,e.quality=this.quality,e.attributes=this.attributes,e},t}(i);e.EquipGoods=a,__reflect(a.prototype,"Shop.EquipGoods",["Shop.IGoods"]);var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t.prototype,"type",{get:function(){return n.Prop},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"icon",{get:function(){return table.props[this.genre][this.detailType].source},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return table.props[this.genre][this.detailType].name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"quality",{get:function(){return table.props[this.genre][this.detailType].quality},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"desc",{get:function(){switch(this.genre){case 7:case 8:return lang.StringWithFormat("owned{1}",PlayerAttribute.bag.getCount(this.genre,this.detailType))}return null},enumerable:!0,configurable:!0}),t.prototype.clone=function(){var e=new t;return this.copyTo(e),e.genre=this.genre,e.detailType=this.detailType,e.count=this.count,e},t}(i);e.PropGoods=r,__reflect(r.prototype,"Shop.PropGoods",["Shop.IGoods"]);var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t.prototype,"type",{get:function(){return n.Book},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"icon",{get:function(){Game.Faction[PlayerAttribute.faction];return table.books[this.id].icon},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return table.books[this.id].name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"quality",{get:function(){return table.books[this.id].quality},enumerable:!0,configurable:!0}),t.prototype.clone=function(){var e=new t;return this.copyTo(e),e.id=this.id,e},t}(i);e.BookGoods=o,__reflect(o.prototype,"Shop.BookGoods",["Shop.IGoods"]);var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return lang.String(Game.currency2AwardType[this.param])},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return n.Coin},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"icon",{get:function(){return table.CurrencyAward.currency[this.awardType].icon},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"desc",{get:function(){var e=table.CurrencyAward.currency[this.awardType];return lang.StringWithFormat(e.desc,this.count)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"awardType",{get:function(){return Game.currency2AwardType[this.param]},enumerable:!0,configurable:!0}),t.prototype.clone=function(){var e=new t;return e.count=this.count,e.quality=this.quality,e.currency=this.currency,e.price=this.price,e.param=this.param,e.discount=this.discount,this.copyTo(e),e},t}(i);e.CoinGoods=s,__reflect(s.prototype,"Shop.CoinGoods",["Shop.IGoods"]),e.MakeGoods=t}(Shop||(Shop={}));var ArenaShop;!function(e){function t(e,t){var n=new net.def.GoodsPosition;return n.pos=e,n.id=t,net.socket.write(122,n.toArrayBuffer()),!1}function n(){var t=Shop.MaxRefreshTimes-e.refreshTimes;return 0>t?0:t}e.GoodsCount=6,e.goods=[],e.refreshTimes=0,e.buy=t,e.restRefreshTimes=n}(ArenaShop||(ArenaShop={}));var MysteryShop;!function(e){function t(e,t){var n=new net.def.GoodsPosition;return n.pos=e,n.id=t,net.socket.write(120,n.toArrayBuffer()),!1}function n(){var t=i()-e.refreshTimes;return 0>t?0:t}function i(){return Shop.MaxRefreshTimes+2*PlayerAttribute.vipItem.level}e.GoodsCount=6,e.goods=[],e.refreshTimes=0,e.buy=t,e.restRefreshTimes=n}(MysteryShop||(MysteryShop={}));var GoldCoinShop;!function(e){function t(){for(var t=RES.getRes("public_config/shop/goldcoinshop.json"),n=0;n<t.length;n++){var a=t[n],r=void 0;switch(a.type){case"book":r=new Shop.BookGoods,r.id=a.content.id;break;case"item":r=new Shop.PropGoods,r.genre=a.content.genre,r.detailType=a.content.detailType,r.count=a.content.count;break;default:return void egret.error("invalid type="+a.type)}r.price=a.price,r.currency=Game.Currency.SilverCoin,r.pos=n,r.discount=100,null!=a.discount&&a.discount>0&&(r.discount=a.discount);var o=0;switch((null!=a.limitCount||a.limitCount>0)&&(o=a.limitCount),r.param={leftStock:0,money:PlayerAttribute.currency[Game.Currency.SilverCoin],configLimit:o},r.buy=i,e.goods[n]=r,a.type){case"book":e.bookGoods.push(r);break;case"item":null==e.mapGoods[r.genre]&&(e.mapGoods[r.genre]={}),e.mapGoods[r.genre][r.detailType]={pos:r.pos,id:r.gid}}}}function n(t){e.buyCounts=t;for(var n=0;n<e.goods.length;n++)null!=e.buyCounts[n]&&e.goods[n].param.configLimit>0?e.goods[n].param.leftStock=e.goods[n].param.configLimit-e.buyCounts[n]:e.goods[n].param.leftStock=Shop.MaxLeftStack;Game.dispatcher.dispatchEventWith(Game.EVENT.GoldCoinShopSync)}function i(t,n){if(n){var i=new net.def.C2SBuyGoldCoinGoods;i.pos=t,i.count=n,net.socket.write(124,i.toArrayBuffer())
}else UIManager.push(new UI.ItemNum(e.goods[t]));return!0}e.goods=[],e.bookGoods=[],e.mapGoods={},e.buyCounts=[],e.load=t,e.UpdateBuyCounts=n,e.buy=i}(GoldCoinShop||(GoldCoinShop={}));var SongJin;!function(e){function t(e,t){U=new UI.SongJinResult,U.data=e,U.winner=t;var n,i=S();if(n=1==t?i.winnerAward:i.loserAward,U.awarddata.push({type:"item",content:{genre:n.genre,detailType:n.detail,count:n.count}}),G()){for(var a=i.killAwards,r=a.length-1;r>=0;r--){var o=a[r],s=o.score;if(L>=s){U.awarddata.push({type:"item",content:{genre:o.award.genre,detailType:o.award.detail,count:o.award.count}});break}}for(var l=i.killStreakAwards,r=l.length-1;r>=0;r--){var u=l[r],c=u.maxKillStreak;if(w>=c){U.awarddata.push({type:"item",content:{genre:u.award.genre,detailType:u.award.detail,count:u.award.count}});break}}for(var h=i.assistAwards,r=h.length-1;r>=0;r--){var d=h[r],p=d.score;if(R>=p){U.awarddata.push({type:"item",content:{genre:d.award.genre,detailType:d.award.detail,count:d.award.count}});break}}}if(!N){var g=i.rankAwards,m=e.length;g?m>i.rankAwards.length&&(m=i.rankAwards.length):m=0;for(var f=Player.instance.Name,r=0;m>r;r++){var v=e[r].name;if(v==f){var d=g[r];U.awarddata.push({type:"item",content:{genre:d.award.genre,detailType:d.award.detail,count:d.award.count}});break}}}UIManager.pushPage(U)}function n(t){null==e.note&&(e.note=new UI.SongJinNote),e.note.rank=t}function i(t,n){N=n,null==e.note&&(e.note=new UI.SongJinNote),e.note.restTime=t}function a(e){return N?o(e):r(e)}function r(e){for(var t=e.monster,n=e.combatzone,i=t.getObjectCount(),a=0;10>a;a++){var r=Math.floor(Math.random()*i),o=t.getObjectByIndex(r);if(null==o)return null;if(o.name.indexOf("jin")>=0&&3==Player.instance.Camp)return Scene.displayPos2LogicPos(new egret.Point(~~(o.x+o.width/2),~~(o.y+o.height/2)));if(o.name.indexOf("song")>=0&&4==Player.instance.Camp)return Scene.displayPos2LogicPos(new egret.Point(~~(o.x+o.width/2),~~(o.y+o.height/2)))}for(var a=0;a<n.numChildren;a++){var o=t.getObjectByIndex(a);if("centerjin"==o.name&&3==Player.instance.Camp)return Scene.displayPos2LogicPos(new egret.Point(~~(o.x+o.width/2),~~(o.y+o.height/2)));if("centersong"==o.name&&4==Player.instance.Camp)return Scene.displayPos2LogicPos(new egret.Point(~~(o.x+o.width/2),~~(o.y+o.height/2)))}return null}function o(e){var t=e.combatzone,n=t.getObjectCount(),i=Math.floor(Math.random()*n),a=t.getObjectByIndex(i);return null==a?null:Scene.displayPos2LogicPos(new egret.Point(~~(a.x+a.width/2),~~(a.y+a.height/2)))}function s(t){var n=t.award;e.note.nextKillScore=t.score,e.note.killChestCount=n.count,e.note.iconKillAward=c(n.level)}function l(t){var n=t.award;e.note.nextMaxKillStreak=t.maxKillStreak,e.note.killStreakChestCount=n.count,e.note.iconKillStreakAward=c(n.level)}function u(t){var n=t.award;e.note.nextAssistScore=t.score,e.note.assistChestCount=n.count,e.note.iconAssistAward=c(n.level)}function c(e){var t;switch(t="icon/item/box1_1.png",e){case 1:t="icon/item/box1_1.png";break;case 2:t="icon/item/box1_2.png";break;case 3:t="icon/item/box1_4.png"}return t}function h(t,n,i,a,r){null==e.note&&(e.note=new UI.SongJinNote);var o=r>0&&e.note.killStreak!=r,c=S();if(e.note.score=t,e.note.killScore=n,L=n,e.note.killStreak=r,o){var h=Player.instance.actor;h&&h.popTextWithImage("Number/cbDesc.png",!1,"+1","Number/strike_number.fnt",tweenSongjinKillStrike,40,0)}if(G()){var d=c.killAwards;s(d[0]);for(var p=d.length-1;p>=0;p--){var g=d[p],m=g.score;if(n>=m){var f=d[p+1];null==f?(s(g),e.note.killScore=m):s(f);break}}e.note.maxKillStreak=i,w=i;var v=c.killStreakAwards;l(v[0]);for(var p=v.length-1;p>=0;p--){var y=v[p],b=y.maxKillStreak;if(i>=b){var E=v[p+1];null==E?(l(y),e.note.maxKillStreak=b):l(E);break}}e.note.assistScore=a,R=a;var C=c.assistAwards;u(C[0]);for(var p=C.length-1;p>=0;p--){var T=C[p],I=T.score;if(a>=I){var A=C[p+1];null==A?(u(T),e.note.assistScore=I):u(A);break}}}}function d(t,n){e.note.scoreSong=t,e.note.scoreJin=n}function p(e){null==_&&(_=new UI.SongJinTime),_.restTime=e}function g(e){null==_&&(_=new UI.SongJinTime),_.enrolls=e}function m(){F=World.scene==e.combatXScene,null==e.note&&(e.note=new UI.SongJinNote),UI.battle.addChild(e.note),h(0,0,0,0,0),d(0,0),UI.setDisableAllPlayerTitles(!0),SuperWeapon.disableAllPlayersEffect(!0),RES.cacheDuration=5e3}function f(){N=!1,F=!1,null!=e.note&&(UI.battle.removeChild(e.note),e.note=null),null!=U&&(UIManager.pushPage(U),U=null),UI.setDisableAllPlayerTitles(!1),SuperWeapon.disableAllPlayersEffect(!1),RES.cacheDuration=Game.cacheDuration}function v(){N=World.scene==e.enrollSceneExp,F=World.scene==e.enrollXScene||World.scene==e.enrollXScene2,null==_&&(_=new UI.SongJinTime),UI.battle.addChild(_)}function y(){N=!1,F=!1,null!=_&&(UI.battle.removeChild(_),_=null)}function b(t){var n,i;if(e.isCombating())switch(t){case 1:n=lang.String("SongjinTitleSoldier"),i=color.WHITE;break;case 2:n=lang.String("SongjinTitleCaptain"),i=color.GREEN;break;case 3:n=lang.String("SongjinTitleMajor"),i=color.BLUE;break;case 4:n=lang.String("SongjinTitleColonel"),i=color.PURPLE;break;case 5:n=lang.String("SongjinTitleGeneral"),i=color.ORANGE;break;case 6:n=lang.String("SongjinTitleMarshal"),i=color.RED;break;default:return null}return{text:n,textColor:i}}function S(){return N?M:F?D:x}function E(){x=RES.getRes("config/songjin/award.json"),M=RES.getRes("config/songjin/award_experience.json"),D=RES.getRes("config/crossserver/songjin_award.json"),Scene.listenEnterMap(e.enrollScene,v),Scene.listenEnterMap(e.enrollScene2,v),Scene.listenEnterMap(e.combatScene,m),Scene.listenEnterMap(e.enrollXScene,v),Scene.listenEnterMap(e.enrollXScene2,v),Scene.listenEnterMap(e.combatXScene,m),Scene.listenLeaveMap(e.enrollScene,y),Scene.listenLeaveMap(e.enrollScene2,y),Scene.listenLeaveMap(e.combatScene,f),Scene.listenLeaveMap(e.enrollXScene,y),Scene.listenLeaveMap(e.enrollXScene2,y),Scene.listenLeaveMap(e.combatXScene,f),Scene.listenEnterMap(e.enrollSceneExp,v),Scene.listenLeaveMap(e.enrollSceneExp,y),Scene.handleIdle[e.combatScene]=a,Scene.handleIdle[e.combatXScene]=a,Scene.handleIdle[e.enrollScene]=function(){return null},Scene.handleIdle[e.enrollScene2]=function(){return null}}function C(){return e.data}function T(){return N}function I(){return F}function G(){return N||F?!0:e.data&&e.data.times<=e.MaxEnrollTimes}function A(){var t=table.maps[World.mapId].scene;return null==t||t!=e.combatScene&&t!=e.combatXScene?!1:!0}function k(e){B=e.times}function P(){var e=O-B;return 0>e&&(e=0),e>0}e.OpenLevel=22,e.OpenLevelForCrossServer=30,e.MaxEnrollTimes=2,e.showRanking=t,e.updateRank=n,e.updateRestTime=i,e.updateScore=h,e.updateCampScore=d,e.updateCountdown=p,e.updateEnrollCount=g,e.makeSceneTitle=b;var w,L,R,U,_;e.enrollScene="songjin/enroll",e.enrollScene2="songjin/enroll2",e.combatScene="songjin/combat",e.enrollSceneExp="songjin/enroll_experience",e.enrollXScene="songjinx/enroll",e.enrollXScene2="songjinx/enroll2",e.combatXScene="songjinx/combat";var x,M,D;e.getAwardCfg=S,e.load=E,e.getDefaultTaskData=C,e.CampSong=3,e.CampJin=4;var N=!1;e.isExperience=T;var F=!1;e.isCrossServer=I,e.hasScoreAward=G,e.isCombating=A;var O=5,B=0;e.setXSvrTaskData=k,e.hasXSvrTimes=P}(SongJin||(SongJin={}));var CumulativeLogin;!function(e){function t(){for(var t=0;t<e.data.bonus.length;t++)if(!e.data.bonus[t])return!1;return!0}function n(){var t,n=e.data.count;e.data.count>=e.data.bonus.length?(n=e.data.bonus.length,t=null):t=e.data.count;for(var i=0;n>i;i++)if(!e.data.bonus[i])return{idx:i,next:t};return{idx:null,next:t}}function i(){if(e.finish())badge.onLight(badge.action.SevenGift,!1);else{var t=e.withDay();null!=t.idx?badge.onLight(badge.action.SevenGift,!0):null!=t.next?badge.onLight(badge.action.SevenGift,!1):badge.onLight(badge.action.SevenGift,!1)}}e.finish=t,e.withDay=n,e.onLight=i}(CumulativeLogin||(CumulativeLogin={}));var SwapAttribute;!function(e){function t(e,t,n){var i=new net.def.C2SEquipSwapAttribute;i.id=e,i.srcAttrIndex=n,i.dstAttrIndex=t,net.socket.write(136,i.toArrayBuffer())}function n(e){var t=10*Math.floor(e/10),n=table.equipRinse[t];if(null==n){n=0;for(var i in table.equipRinse)table.equipRinse[i]>n&&(n=table.equipRinse[i])}return n}e.MinLevel=30,e.swapStone={0:0},e.swapEquipAttribute=t,e.calcCost=n}(SwapAttribute||(SwapAttribute={}));var Features;!function(e){var t=function(){function e(){}return Object.defineProperty(e,"instance",{get:function(){return null==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.OnEventBuffTrigger=function(e,t,n){var i=this.GetSkillCfg(e);null!=i&&(Player.instance.actor.popSkill(i.name,PopSkillType.PartnerTalentSkill),null!=i.effect&&""!=i.effect&&Player.instance.actor.addEffect(i.effect,n,ActorLayer.front,0,0))},e.prototype.GetSkillCfg=function(e){return table.talentSkillCfg[e]},e.prototype.GetSkillName=function(e){return table.talentSkillCfg[e].name},e.prototype.GetSkillDesc=function(e,t,n,i){var a=this.GetSkillCfg(e);return this.GetDesc(a,t,n,i)},e.prototype.GetDesc=function(e,t,n,i){var a=t;if(!i&&0>=a&&(a=1),null==e||1>a||a>e.attribute.length)return"";var r=e.desc,o=e.attribute[a-1],s=r.replace(/{(\d+)}/g,function(e,t){var n=o.value[t-1][1];switch(o.value[t-1][0]){case-1:n=~~(n/100);break;case 56:n=o.value[t-1][2]}return""+n});return a==t&&n?'<font color="#EDC755">'+s+"</font>":'<font color="#BCBCB8">'+s+"</font>"},e}();e.TalentSkill=t,__reflect(t.prototype,"Features.TalentSkill")}(Features||(Features={}));var TaohuaIsland;!function(e){function t(){net.socket.write(64,null)}function n(t,n,i,a,r,o,s){e.plantChances=r,e.robFreeChances=o,e.planting=t,e.leftTime=n,e.harvestCount=i,e.harvestTime=a,e.freeTimes=s,e.planting?(null==e.leftRemain&&(e.leftRemain=new RemainingTime),e.leftRemain.delta=e.leftTime):null==e.leftRemain,b(),a>0&&(null!=P&&(egret.clearTimeout(P),P=null),P=egret.setTimeout(y,!1,a*Game.Second));var l=UI.TaohuaMain.instance;null!=l.parent&&l.setBattleStatus(),Game.dispatcher.dispatchEventWith(Game.EVENT.TaohuaIslandStatus)}function i(e,t){var n=new net.def.C2STaohuaIsland;n.setAwardType(e),n.setDog(t),net.socket.write(65,n.toArrayBuffer())}function a(e){return e!=C.TaohuaIslandResult_Ok?void f(e):void t()}function r(){net.socket.write(66,null)}function o(e){return e!=C.TaohuaIslandResult_Ok?void f(e):void t()}function s(){var t=UI.TaohuaMain.instance;null!=t.parent&&t.setListRob(e.robs)}function l(e,t,n){e!=C.TaohuaIslandResult_Ok?(G=!1,f(e)):(PopUpMessage.push(lang.String("taohua rob succeess"),color.ORANGE),G=!0,A=t,k=n)}function u(){Scene.listenEnterMap(E,c),Scene.listenLeaveMap(E,p)}function c(){var e=UI.TaohuaMain.instance;UIManager.popNoTweens(e),UI.HUD.instance.showBattle(),T=new UI.ChallengeNote,T.second=90,UI.battle.addChild(T),T.currentState="taohua",T.btnExit.addEventListener(egret.TouchEvent.TOUCH_TAP,h,null),G=!1,A=0,k=0}function h(){var e=lang.String("operation confirm"),t=lang.StringWithFormat("taohuaisland confirm leave");UI.ConfirmBox.Show(UI.ConfirmBoxStyle.team,e,t,function(){return d(),!0},null,null)}function d(){net.socket.write(141,null)}function p(){null!=T&&(UI.battle.removeChild(T),T=null),null==I&&(I=new UI.TaohuaIslandResult),1==G?(I.currentState="succeed",I.awarddatas=[],k>0&&I.awarddatas.push({type:"exp",content:k}),A>0&&I.awarddatas.push({type:"item",content:{genre:4,detailType:1,count:A}})):I.currentState="fail",UIManager.pushPage(I),I=null}function g(e){return e!=C.TaohuaIslandResult_Ok?void f(e):void t()}function m(){return PlayerAttribute.Level<e.LIMITLEVEL?void PopUpMessage.push(lang.StringWithFormat("open on level {1}",e.LIMITLEVEL),color.RED):(e.getStatus(),void UIManager.pushPage(UI.TaohuaMain.instance))}function f(e){switch(e){case C.TaohuaIslandResult_Fail:return void PopUpMessage.push(lang.String("systems fail"),color.ORANGE);case C.TaohuaIslandResult_OutofChance:return void PopUpMessage.push(lang.String("times used up"),color.ORANGE);case C.TaohuaIslandResult_OutofMoney:return void PopUpMessage.push(lang.String("not enough goldcoin"),color.ORANGE);case C.TaohuaIslandResult_Robbing:return void PopUpMessage.push(lang.String("taohuaisland robbing"),color.ORANGE);case C.TaohuaIslandResult_RobBeingRobbed:return void PopUpMessage.push(lang.String("taohuaisland beingrobbed"),color.ORANGE);case C.TaohuaIslandResult_RobLose:return void PopUpMessage.push(lang.String("taohua rob fail"),color.ORANGE);case C.TaohuaIslandResult_RobNobody:return void PopUpMessage.push(lang.String("taohuaisland robnobody"),color.ORANGE);case C.TaohuaIslandResult_RobNoHarvest:return void PopUpMessage.push(lang.String("taohuaisland robnoharvest"),color.ORANGE);case C.TaohuaIslandResult_RobOutofTimes:return void PopUpMessage.push(lang.String("taohuaisland roboutoftimes"),color.ORANGE);case C.TaohuaIslandResult_BagFull:return void PopUpMessage.push(lang.String("bag room full"),color.RED)}}function v(t,n){e.plantChances=t,e.robFreeChances=n,b()}function y(){egret.clearTimeout(P),P=null,badge.onLight(badge.action.TaoHuaIsland,!0)}function b(){PlayerAttribute.Level<e.LIMITLEVEL||(e.planting&&e.harvestCount>0||!e.planting&&e.plantChances>0?badge.onLight(badge.action.TaoHuaIsland,!0):badge.onLight(badge.action.TaoHuaIsland,!1))}var S,E="taohuaIsland";!function(e){e[e.TaohuaIsland_Dog=0]="TaohuaIsland_Dog",e[e.TaohuaIsland_BattlePlantChance=1]="TaohuaIsland_BattlePlantChance",e[e.TaohuaIsland_BattleRobChance=2]="TaohuaIsland_BattleRobChance"}(S=e.TaohuaIslandCommodity||(e.TaohuaIslandCommodity={}));var C;!function(e){e[e.TaohuaIslandResult_Ok=0]="TaohuaIslandResult_Ok",e[e.TaohuaIslandResult_Fail=1]="TaohuaIslandResult_Fail",e[e.TaohuaIslandResult_OutofMoney=2]="TaohuaIslandResult_OutofMoney",e[e.TaohuaIslandResult_OutofChance=3]="TaohuaIslandResult_OutofChance",e[e.TaohuaIslandResult_PlayingFree=4]="TaohuaIslandResult_PlayingFree",e[e.TaohuaIslandResult_PlayingPaid=5]="TaohuaIslandResult_PlayingPaid",e[e.TaohuaIslandResult_PlayingBattle=6]="TaohuaIslandResult_PlayingBattle",e[e.TaohuaIslandResult_Robbing=7]="TaohuaIslandResult_Robbing",e[e.TaohuaIslandResult_RobNobody=8]="TaohuaIslandResult_RobNobody",e[e.TaohuaIslandResult_RobNoHarvest=9]="TaohuaIslandResult_RobNoHarvest",e[e.TaohuaIslandResult_RobBeingRobbed=10]="TaohuaIslandResult_RobBeingRobbed",e[e.TaohuaIslandResult_RobOutofTimes=11]="TaohuaIslandResult_RobOutofTimes",e[e.TaohuaIslandResult_RobLose=12]="TaohuaIslandResult_RobLose",e[e.TaohuaIslandResult_BagFull=13]="TaohuaIslandResult_BagFull"}(C||(C={})),e.getStatus=t,e.s2cBattleStatus=n,e.joinPlant=i,e.s2cPlant=a,e.onHarvest=r,e.s2cHarvest=o,e.s2cListRob=s,e.s2cRob=l,e.load=u,e.s2cPurchase=g,e.onOpenTaohuaIsland=m,e.setChances=v,e.robs=[];var T,I;e.LIMITLEVEL=9;var G=!1,A=0,k=0;e.plantChances=0,e.robFreeChances=0,e.COST=[0,80,80,15],e.TOTALTIME=7200;var P}(TaohuaIsland||(TaohuaIsland={}));var TriggerSkill;!function(e){function t(){for(var t=RES.getRes("public_config/triggerskill.json"),n=0;n!=t.length;n++){var i=t[n];e.ConfigTriggerSkills[i.id]=i}}function n(e,t,n){var i=this.GetSkillCfg(e);null!=i&&null!=i.effect&&""!=i.effect&&Player.instance.actor.addEffect(i.effect,n,ActorLayer.front,0,0)}function i(t){return e.ConfigTriggerSkills[t]}function a(t){return e.ConfigTriggerSkills[t].name}function r(e){var t="",n=i(e);return null!=n&&(t=n.icon),t}function o(e,t,n,i){var a=this.GetSkillCfg(e);return this.GetDesc(a,t,n,i)}function s(e,t,n,i){var a=t;if(!i&&0>=a&&(a=1),null==e||1>a||a>e.attribute.length)return"";var r=e.desc,o=e.attribute[a-1],s=r.replace(/{(\d+)}|{(\d+\/\d+)}/g,function(e,t){var n=0;if(e.indexOf("/")>0){e=e.substring(1,e.length-1);var i=e.toString(),a=i.split("/"),r=Number(a[0]),s=Number(a[1]);t=r,n=o.value[t-1][1],n/=s}else n=o.value[t-1][1];switch(o.value[t-1][0]){case 56:n=o.value[t-1][3]/100}return""+n});return a==t&&n?'<font color="#EDC755">'+s+"</font>":'<font color="#BCBCB8">'+s+"</font>"}e.ConfigTriggerSkills={},e.Load=t,e.OnEventBuffTrigger=n,e.GetSkillCfg=i,e.GetSkillName=a,e.GetSkillIcon=r,e.GetSkillDesc=o,e.GetDesc=s}(TriggerSkill||(TriggerSkill={}));var dropAnimition;!function(e){function t(e,t,i,a){for(var r=Scene.logicPos2DisplayPos(new egret.Point(e,t)),o=i.length,s=0;o>s;s++){var l=i[s],u=void 0,c=void 0,h=l.quality,d=l.genre;if(0==d){var p=l.part,g=l.id,m=Game.Faction[PlayerAttribute.faction];u=table.equips[p][g][m].icon,c=table.equips[p][g][m].name}else{var g=l.id;u=table.props[d][g].source,c=table.props[d][g].name}var f=i[s].count||1;if(null!=u)for(var v=0;f>v;v++)n(r.x,r.y,s,i.length,u,c,h)}for(var y=lang.String("copperCoin"),b=Math.min(Math.ceil(a/1e3),10),v=0;b>v;v++)n(r.x,r.y,o+v,o+b,"icon/item/coppercoin.png",y,2)}function n(t,n,r,o,s,l,u){if(0>=o||o>e.dropsource.length)return egret.error("Count <= 0 || Count > dropsource.length"),null;var c=50,h=35,d=-i[r].x*c,p=-i[r].y*h;p+=10*e.dropsource[o-1].y;var g=new a(l,u);g.init(l,u),g.ox=t,g.oy=n,g.x=t+d,g.y=n+p,g.res=s,g.play();var m=RES.getRes(s);null==m?RES.getResAsync(s,g.compFunc,g):g.compFunc(m)}var i=[{x:0,y:0},{x:-1,y:1},{x:0,y:2},{x:1,y:1},{x:-2,y:2},{x:-1,y:3},{x:0,y:4},{x:1,y:3},{x:2,y:2},{x:-3,y:3},{x:-2,y:4},{x:-1,y:5},{x:0,y:6},{x:1,y:5},{x:2,y:4},{x:3,y:3},{x:-4,y:4},{x:-3,y:5},{x:-2,y:6},{x:-1,y:7},{x:0,y:8},{x:1,y:7},{x:2,y:6},{x:3,y:5},{x:4,y:4}];e.dropsource=[{x:0,y:0},{x:0,y:0},{x:0,y:1},{x:0,y:1},{x:0,y:1},{x:0,y:1},{x:0,y:2},{x:0,y:2},{x:0,y:2},{x:0,y:2},{x:0,y:3},{x:0,y:3},{x:0,y:3},{x:0,y:3},{x:0,y:3},{x:0,y:3},{x:0,y:4},{x:0,y:4},{x:0,y:4},{x:0,y:4},{x:0,y:4},{x:0,y:4},{x:0,y:4},{x:0,y:4},{x:0,y:4}],e.DropItem=t;var a=function(){function e(e,t){this.obj=new egret.DisplayObjectContainer,this.name=new egret.TextField,this.name.size=26,this.name.stroke=1,this.name.strokeColor=0,this.name.bold=!1,this.obj.addChild(this.name),this.init(e,t)}return e.prototype.init=function(e,t){this.name.text=e,this.name.textColor=Item.QualityColor[t],this.name.anchorOffsetX=this.name.width/2},e.prototype.play=function(){this.obj.x=this.ox,this.obj.y=this.oy,this.obj.scaleX=.1,this.obj.scaleY=.1;var e=~~(100*Math.random());Scene.addChild(this.obj),egret.Tween.get(this.obj).wait(e).to({x:this.x,y:this.y,scaleX:.55,scaleY:.55},500).wait(500).call(this.step2,this),egret.Tween.get(this.obj).wait(e).to({anchorOffsetY:100},250,egret.Ease.bounceOut).to({anchorOffsetY:0},250,egret.Ease.bounceOut)},e.prototype.compFunc=function(e){null==this.icon?this.icon=new egret.Bitmap(e):this.icon.texture=e,this.icon.anchorOffsetX=this.icon.width/2,this.icon.anchorOffsetY=this.icon.height,this.obj.addChild(this.icon)},e.prototype.step2=function(){if(Game.removeFromParent.call(this.obj),null==World.tmxTileMap)return void(this.obj=null);var e=World.tmxTileMap.localToGlobal(this.obj.x,this.obj.y);this.obj.x=e.x,this.obj.y=e.y,UI.HUD.instance.addChild(this.obj);var t=Math.floor(UI.battle.width/2)+76,n=UI.battle.height-54;egret.Tween.get(this.obj).to({x:t,y:n,scaleX:.2,scaleY:.2,alpha:1},500,egret.Ease.backOut).call(Game.removeFromParent,this.obj)},e}();__reflect(a.prototype,"DropObj")}(dropAnimition||(dropAnimition={}));var WeekendRecruit;!function(e){function t(){e.activity=new Activity.MissionActivity(Activity.ActivityKind.Activity_PartnerRecruit),e.activity.eventName=Game.EVENT.WeekendRecruit;var t=RES.getRes("public_config/operation/partnerrecruit/partnerrecruit.json");e.activity.profiles=t.profile,e.activity.badgeId=badge.action.WeekendRecruit,e.activity.initSelf=function(){e.weekendRecruitAward=e.activity.settings.items,e.backgroup=e.activity.settings.backgroup}}function n(){return Activity.activites&&Activity.activites[e.activity.kindId]?FormatYYYYMMDDHHMM(Activity.activites[e.activity.kindId].startTime.getTime()/1e3)+" - "+FormatYYYYMMDDHHMM(Activity.activites[e.activity.kindId].endTime.getTime()/1e3):""}function i(t){var n=PlayerAttribute.currency[Game.Currency.GoldCoin];if(t==e.RECRUITTYPE_ONCE&&e.FreeTimes>0)e.FreeTimes=e.FreeTimes-1;else{if(t==e.RECRUITTYPE_ONCE&&n<e.COST_ONCE)return void Recharge.openRechargeUI();if(t==e.RECRUITTYPE_TEN&&n<e.COST_TEN)return void Recharge.openRechargeUI()}Partner.recruiting=!0;var i=new net.def.C2SWeekendRecruit;i.setRecruitType(t),net.socket.write(268,i.toArrayBuffer())}function a(){net.socket.write(269,null)}function r(t,n){e.RecruitTimes=t,e.FreeTimes=n,Game.dispatcher.dispatchEventWith(Game.EVENT.WeekendRecruitSyncTimes)}function o(t){UI.WeekendRecruitRankUI.instance.dataRecord.removeAll();var n=net.def.S2CWeekendRecruitRecords.decode(t),i=n.getList();i.reverse();for(var a=0;a!=i.length;a++){var r=i[a],o=r.getTime();o=Game.getServerDate().getTime()/1e3-o;var s=r.getName(),l=r.getType(),u=r.getParam1(),c=r.getParam2(),h=r.getParam3(),d=FormatYYYYMMDDHHMM(o,!0),p="",g=1;if(l==e.AWARDTYPE_PARTNER){var m=Partner.GetPartnerCfg(u);p=Partner.GetPartnerName(m),g=1}else if(l==e.AWARDTYPE_ITEM){var f=table.props[u][c];p='<font color="'+egret.toColorString(Item.QualityColor[f.quality])+'">'+f.name+"</font>",g=h}var v=lang.StringWithFormat("weekend recruit record time {1} player {2} get award {3} * {4}",d,s,p,g);UI.WeekendRecruitRankUI.instance.dataRecord.addItem(Game.HtmlTextParser.parse(v))}UIManager.pushPage(UI.WeekendRecruitRankUI.instance)}e.RECRUITTYPE_ONCE=0,e.RECRUITTYPE_TEN=1,e.AWARDTYPE_PARTNER=0,e.AWARDTYPE_ITEM=1,e.COST_ONCE=300,e.COST_TEN=2640,e.RecruitTimes=0,e.FreeTimes=0,e.backgroup="",e.load=t,e.showDateDesc=n,e.Recruit=i,e.GetRecords=a,e.onSyncRecruitTimes=r,e.onSyncRecruitRecords=o}(WeekendRecruit||(WeekendRecruit={}));var WildBoss;!function(e){function t(t,i){e.Icon||(e.Icon=new UI.WildBossIcon),e.Icon.update(t),i.addChild(e.Icon),egret.setTimeout(n,null,60*Game.Second)}function n(){e.Icon&&(e.Icon.close(),e.Icon.clearResourceReference(),e.Icon=null)}function i(){R>=0&&(egret.clearTimeout(R),R=-1)}function a(e){i(),R=egret.setTimeout(h,null,e)}function r(){return table.wildBossCfg.maxTotalTimes}function o(){return null==x&&(x=_.newInstance()),x}function s(e){var t=o();t.totalTimes=e.totalTimes;for(var n=int(Game.getServerDate().getTime()/1e3),i=0;i<e.items.length;i++)t.items[i].id=e.items[i].id,t.items[i].enterCount=e.items[i].enterCount,t.items[i].hasEntered=e.items[i].hasEntered,t.items[i].bossStatus=e.items[i].status,t.items[i].startTime=e.items[i].countdownTime+n;t.items.sort(l),u()}function l(e,t){return e.id-t.id}function u(){if(!(PlayerAttribute.Level<20)){var t=o(),n=e.getMinBossIndexByRoleLevel(),i=t.items[n].enabled,s=t.items[n+1].enabled;if(t.totalTimes>=r()&&(t.items[n].hasEntered||(i=!1),t.items[n+1].hasEntered||(s=!1)),badge.onLight(badge.action.WildBossTip1,i),badge.onLight(badge.action.WildBossTip2,s),!i&&!s&&t.totalTimes<r()){for(var l=0,u=int(Game.getServerDate().getTime()/1e3),c=n;n+1>=c;c++){var h=t.items[c];h.level<=PlayerAttribute.Level&&h.enterCount<h.maxCount&&h.startTime>u&&(0==l||h.startTime<l)&&(l=h.startTime)}l>0&&a((l-u+1)*Game.Second)}}}function c(){for(var e=PlayerAttribute.Level,t=o().items,n=t.length,i=-1,a=-1,r=0;n>r&&e>=t[r].level;r++)0>i&&(i=r),a=r;return 0>i&&(i=0),0>a&&(a=i+1),a-i>1?i=a-1:a==i&&(a=i+1),i}function h(){net.socket.write(131,null)}function d(e){if(PlayerAttribute.bag.checkAndTipRoomSpace("Túi đã đầy, hãy thu xếp trước!"))return!0;var t=m(e);if(0>t)return!1;var n=o().items[t];if(PlayerAttribute.Level<n.level)return PopUpMessage.push("Lv"+n.level+" mới có thể khiêu chiến",color.RED),!1;if(h(),!n.enabled){if(!n.hasEntered&&n.enterCount>=n.maxCount||o().totalTimes>=r())return PopUpMessage.push("Hết lượt khiêu chiến BOSS",color.RED),!1;var i="BOSS"+n.status;return PopUpMessage.push(i,color.RED),!1}var a=o().items[t].id,s=new net.def.C2SEnterWildBossMap;return s.setId(a),net.socket.write(132,s.toArrayBuffer()),!0}function p(){Scene.listenEnterMap(e.sceneName,v),Scene.listenLeaveMap(e.sceneName,y),Scene.listenBosslifeChange(e.sceneName,G)}function g(){return null==M&&(M=new UI.WildBossNoteUI(UI.WildBossNoteViewType.WildBoss)),M}function m(e){var t=o();if(null!=t)for(var n=0;n<t.items.length;n++)if(t.items[n].mapId==e)return n;return-1}function f(e){if(null!=e&&1==e.success){var t=g();t.restTime=e.countdownTime,t.updateBossStatus(e.status),UI.HUD.instance.showBattle()}}function v(){var e=g();UI.battle.addChild(e);var t=m(World.mapId);t>=0?(e.txtBossName=o().items[t].name,e.npcPic=o().items[t].pic):(e.txtBossName="",e.npcPic=""),UI.setDisableAllPlayerTitles(!0),SuperWeapon.disableAllPlayersEffect(!0),RES.cacheDuration=5e3}function y(){var e=M;null!=e&&(UI.battle.removeChild(e),e=null),UI.setDisableAllPlayerTitles(!1),SuperWeapon.disableAllPlayersEffect(!1),RES.cacheDuration=Game.cacheDuration}function b(e,t){var n=g();n.updateRankValue(e,t)}function S(e){if(null!=M&&null!=e&&e.items.length>0){var t=void 0;t=new Array;for(var n=e.items.length,i=0;n>i;i++)t[i]={rank:e.items[i].rank,name:e.items[i].name,damage:Math.floor(e.items[i].value/1e3)};M.updateRankingListData(t)}}function E(e,t){null!=M&&(M.updateBossStatus(e),M.restTime=t),1!=e&&h()}function C(e){var t=m(e);if(0>t)return"";var n=o();return n.items[t].tips}function T(e){var t=m(e);if(0>t)return!1;var n=o();return(n.items[t].hasEntered||n.totalTimes<r())&&n.items[t].enabled}function I(e){var t=new UI.WildBossEnd,n=m(World.mapId),i="";n>=0&&(i=o().items[n].pic),t.updateWildBossData(e,i),UIManager.push(t)}function G(e,t){null!=M&&M.updateBossHP(t,e)}function A(){var t=new Array(2),n=e.getMinBossIndexByRoleLevel(),i=n+1,a=e.getMissions().items;return t[0]={},t[1]={},t[0].name=a[n].name,t[1].name=a[i].name,t[0].tip="Lv"+a[n].level+" xuất hiện",t[1].tip="Lv"+a[i].level+" xuất hiện",t[0].status=a[n].tips,t[1].status=a[i].tips,t[0].icon=table.maps[a[n].mapId].icon,t[1].icon=table.maps[a[i].mapId].icon,t[0].wanderingsicon=table.maps[a[n].mapId].wanderingsicon,t[1].wanderingsicon=table.maps[a[i].mapId].wanderingsicon,t}function k(){var e=c(),t=o().items;d(t[e].mapId)}function P(){var e=c()+1,t=o().items;d(t[e].mapId)}function w(e){var t=e-1;0>t||o().items[t].hasEntered||Game.dispatcher.dispatchEventWith(Game.EVENT.WildBossInfo)}e.ShowIcon=t,e.HideIcon=n;var L;!function(e){e[e.TempCampMonster=1001]="TempCampMonster",e[e.TempCampOwner=1002]="TempCampOwner",e[e.TempCampHunter=1003]="TempCampHunter",e[e.TempCampLooter=1004]="TempCampLooter"}(L=e.TempCamp||(e.TempCamp={}));var R=-1,U=function(){function e(e){this.startTime=0,this.enterCount=0,this.hasEntered=!1,this.id=e}return Object.defineProperty(e.prototype,"name",{get:function(){return table.wildBossCfg.missions[this.id].name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"level",{get:function(){return table.wildBossCfg.missions[this.id].level},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){switch(this.bossStatus){case 0:return lang.String("not appear");case 1:return lang.String("can challenge");case 2:return lang.String("killed");case 3:return lang.String("escaped")}return""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return 1==this.bossStatus&&this.level<=PlayerAttribute.Level&&(this.hasEntered||this.enterCount<this.maxCount)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapId",{get:function(){return table.wildBossCfg.missions[this.id].mapId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeDesc",{get:function(){if(this.startTime<=0)return"";var e="",t=Game.getServerDate(),n=1e3*this.startTime,i=new Date(n);if(i.getDay()!=t.getDay())return lang.String("tommorow");var a=int((i.getTime()-t.getTime())/1e3);return a>=0&&60>a?a+" giây sau":e=NumberFormat(i.getHours(),2)+":"+NumberFormat(i.getMinutes(),2)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tips",{get:function(){return!this.hasEntered&&(o().totalTimes>=r()||this.enterCount>=this.maxCount)?"Đã hết lượt":this.enabled?lang.StringWithFormat("left count",this.maxCount-this.enterCount):lang.StringWithFormat("revive time",this.timeDesc)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pic",{get:function(){var e=table.maps[this.mapId];return null!=e?e.icon:""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxCount",{get:function(){return table.wildBossCfg.missions[this.id].maxCount},enumerable:!0,configurable:!0}),e}();e.Mission=U,__reflect(U.prototype,"WildBoss.Mission");var _=function(){function e(){}return e.newInstance=function(){var t=new e;return t.init(),t},e.prototype.init=function(){this.totalTimes=0,this.items=[];var e=this.items;Object.getOwnPropertyNames(table.wildBossCfg.missions).forEach(function(t,n,i){var a=table.wildBossCfg.missions[t].id;e.push(new U(a))}),this.show=!0;var t=Math.min(Game.countDay(),table.wildBossCfg.showPropByOpenSvrDay.length-1);100*Math.random()>table.wildBossCfg.showPropByOpenSvrDay[t]&&(this.show=!1)},e}();e.Missions=_,__reflect(_.prototype,"WildBoss.Missions"),e.sceneName="wildboss/beatboss";var x=null;e.getMissions=o,e.updateMissions=s,e.getMinBossIndexByRoleLevel=c,e.requestServerMissions=h,e.requestEnterWildBossMap=d,e.load=p;var M;e.getUiNote=g,e.getWildBossMissionIndex=m,e.onEnterWildBossMapResult=f,e.onEnterMap=v,e.onLeaveMap=y,e.updateRankValue=b,e.updateRanking=S,e.updateStatus=E,e.getTips=C,e.canEnter=T,e.onMissionEnd=I,e.updateHP=G,e.selectTwoBossesByRoleLevel=A,e.startWildBoss1=k,e.startWildBoss2=P,e.onServerNotifyStart=w}(WildBoss||(WildBoss={}));var WulinLiansai;!function(e){function t(t){if(DungeonHallMgr.IsInRoom())return!1;e.master="",D=0,N=0,F=0,UIManager.pushPage(UI.WulinLiansaiPanel.instance),UI.WulinLiansaiPanel.instance.currentState="member",e.dataMemberList.removeAll();for(var n=0;3!=n;n++)e.dataMemberList.addItem(L);return e.dataMemberList.refresh(),t&&P(151,null),badge.onLight(badge.action.WulinLiansai,!1),!0}function n(){e.master="",D=0,N=0,F=0,q=[],UIManager.pop(UI.WulinLiansaiPanel.instance),P(157,null)}function i(){P(155,null)}function a(){P(156,null)}function r(t){for(var n=0;3!=n;n++){var i=t.list[n];null!=i?(e.dataMemberList.replaceItemAt({level:i.getLevel(),fp:i.getFp(),faction:i.getFaction(),name:i.getName(),bMaster:i.getMaster(),online:!0,state:"wllsmember"},n),i.getMaster()&&(e.master=i.getName())):e.dataMemberList.replaceItemAt(L,n)}e.dataMemberList.refresh(),UI.WulinLiansaiPanel.instance.currentState=e.master==Player.instance.Name?"captain":"member"}function o(e){var t=new Date(Game.getServerDate().getTime()+e*Game.Second);return NumberFormat(t.getMonth()+1,2)+"/"+NumberFormat(t.getDate(),2)}function s(e){for(var t=0;t!=table.wllsConfigs.length;t++){var n=table.wllsConfigs[t];if(n.level==e)return n}return table.wllsConfigs[0]}function l(e){var t=s(e);return t.name}function u(e){for(var t=0;t!=table.wllsConfigs.length;t++){var n=table.wllsConfigs[t];if(e>=n.minScore&&e<=n.maxScore)return n}return table.wllsConfigs[0]}function c(t){var n=s(t.getWllsLevel());UI.WulinLiansaiPanel.instance.levelName=n.name,UI.WulinLiansaiPanel.instance.score=t.getScore(),UI.WulinLiansaiPanel.instance.needLevel=t.getNeedLevel(),UI.WulinLiansaiPanel.instance.chance=t.getChance(),UI.WulinLiansaiPanel.instance.noChanceFlag=t.getChance()<=0,UI.WulinLiansaiPanel.instance.nextAddChanceTime=t.getNextAddChanceTime(),UI.WulinLiansaiPanel.instance.nextLevelNeedScore=lang.StringWithFormat("wlls next level need score{1}",n.maxScore-t.getScore()+1),t.getWllsLevel()==e.MAXWLLSLEVEL&&(UI.WulinLiansaiPanel.instance.nextLevelNeedScore=lang.String("wlls already reach max level")),UI.WulinLiansaiPanel.instance.seasonNum=lang.StringWithFormat("wlls season num {1}",t.getSeasonNum());var i=o(t.getSeasonBegin()),a=o(t.getSeasonEnd());UI.WulinLiansaiPanel.instance.seasonBeginEndDate=lang.StringWithFormat("wlls season begintime{1} endtime{2}",i,a),D=t.getBuyChanceMaxTimes(),N=t.getBuyChanceCurTimes(),F=t.getBuyChanceCost(),""!=e.master?UI.WulinLiansaiPanel.instance.addChanceTimeGroup.visible=t.getChance()<6:PlayerAttribute.Level>=e.NEEDLEVEL&&UI.WulinLiansaiPanel.instance.chance>0&&badge.onLight(badge.action.WulinLiansai,!0)}function h(){""!=e.master&&(P(152,null),UIManager.pushPage(UI.WulinLiansaiInvite.instance))}function d(t){e.dataFriendList.removeAll();for(var n=0;n!=t.list.length;n++){var i=t.list[n],a=s(i.getWllsLevel());e.dataFriendList.addItem({name:i.getName(),faction:i.getFaction(),playerLevel:i.getPlayerLevel(),fp:i.getFp(),wllsLevel:a.name,chance:i.getChance(),state:"normal"})
}e.dataFriendList.refresh()}function p(e){var t=new net.def.Name;t.name=e,P(154,t.toArrayBuffer())}function g(e){var t=table.maps[World.mapId].scene;if(null!=t&&!Game.isCityHome())return void ChatSys.sendPrivateMsg(e,lang.String("wlls i am busy invite me later"));var n=function(){return m(e,!1),!0},i=function(){return!1},a=lang.String("wlls room invitation"),r=lang.StringWithFormat("wlls {1} invite you to join room",e);UI.ConfirmBox.Show(UI.ConfirmBoxStyle.team,a,r,function(){return m(e,!0),!0},n,i)}function m(e,n){if(n){var i=t(!1);if(!i)return}var a=new net.def.C2SWllsAnswerInvite;a.inviter=e,a.accept=n,P(153,a.toArrayBuffer())}function f(e){switch(e.getReason()){case R:n(),PopUpMessage.push(lang.String("wlls low level cannot join"),color.RED);break;case U:PopUpMessage.push(lang.String("wlls join fail no chance"),color.RED);break;case _:n(),PopUpMessage.push(lang.String("wlls join fail inviter not in room"),color.RED);break;case x:n(),PopUpMessage.push(lang.String("wlls join fail invite already room"),color.RED)}}function v(t){var n=0,i=!1,a=0;e.dataResultList.removeAll();for(var r=0;r!=t.results.length;r++){var o=t.results[r],s=u(o.getScore());e.dataResultList.addItem({wllsLevel:s.name,name:o.getName(),killNum:o.getKillNum(),deathNum:o.getDeathNum(),addScore:o.getAddScore(),win:o.getWin()}),o.name==Player.instance.Name&&(e.resultWin=o.getWin(),n=o.getScore(),i=o.getWin(),a=n-o.getAddScore())}e.dataResultList.refresh();var l=u(n);UI.WulinLiansaiResult.instance.levelName=l.name,UI.WulinLiansaiResult.instance.nextLevelNeedScore=lang.StringWithFormat("wlls {1} score",l.maxScore-n+1),l.level==e.MAXWLLSLEVEL&&(UI.WulinLiansaiResult.instance.nextLevelNeedScore=lang.String("wlls already reach max level"));var c=l.level,h=u(a).level;UI.WulinLiansaiResult.instance.levelUp=!1,UI.WulinLiansaiResult.instance.levelDown=!1,c>h&&(UI.WulinLiansaiResult.instance.levelUp=!0,UI.WulinLiansaiResult.instance.levelDown=!1),h>c&&(UI.WulinLiansaiResult.instance.levelUp=!1,UI.WulinLiansaiResult.instance.levelDown=!0),UIManager.pushPage(UI.WulinLiansaiResult.instance)}function y(e){UI.WulinLiansaiNote.instance.killNum=e.getKillNum(),UI.WulinLiansaiNote.instance.dieNum=e.getDieNum(),UI.WulinLiansaiNote.instance.SetCampLife(e.getOurCampLife(),e.getOtherCampLife()),UI.WulinLiansaiNote.instance.missileType=lang.String(H[e.getOurCampMissileType()]),M=e.getLeftTime(),b(),SecondTicker.addEventListener(b,null),Scene.handleIdle[O]=null}function b(){0>M&&(M=0);var e=Math.floor(M/60),t=Math.floor(M%60);UI.WulinLiansaiNote.instance.leftTime=NumberFormat(e,2)+":"+NumberFormat(t,2),M--}function S(e){for(var t=!1,n=0;n!=q.length;n++)if(q[n].name==e){q[n].cd=0,t=!0;break}t||q.push({name:e,cd:0}),E(e,!0),C(),V||(V=!0,SecondTicker.addEventListener(C,null))}function E(t,n){var i="normal";n&&(i="success");for(var a=0;a!=e.dataFriendList.length;a++){var r=e.dataFriendList.getItemAt(a);r.name==t&&(r.state=i,e.dataFriendList.replaceItemAt(r,a));break}e.dataFriendList.refresh()}function C(){for(var e=0;e!=q.length;e++)q[e].cd++,q[e].cd==W&&E(q[e].name,!1)}function T(){B||(e.master="",B=!0,UIManager.pop(UI.WulinLiansaiPanel.instance),UI.battle.addChild(UI.WulinLiansaiNote.instance),Scene.handleIdle[O]=function(){return null},UI.setDisableAllPlayerTitles(!0),SuperWeapon.disableAllPlayersEffect(!0))}function I(){B&&(e.master="",B=!1,UI.battle.removeChild(UI.WulinLiansaiNote.instance),Scene.handleIdle[O]=function(){return null},UI.setDisableAllPlayerTitles(!1),SuperWeapon.disableAllPlayersEffect(!1))}function G(){if(0>=D)return void PopUpMessage.push(lang.String("wlls need high vip level to buy chance"),color.RED);if(N>=D)return void PopUpMessage.push(lang.String("wlls today buy chance finish"),color.RED);var e=lang.String("wlls buy chance confirm title"),t="";if(F>PlayerAttribute.currency[Game.Currency.SilverCoin]){var n=F-PlayerAttribute.currency[Game.Currency.SilverCoin];t=lang.StringWithFormat("wlls make sure cost silvercoin {1} and goldcoin {2} buy chance",F,n)}else t=lang.StringWithFormat("wlls make sure cost silvercoin {1} buy chance",F);UI.ConfirmBox.Show(UI.ConfirmBoxStyle.team,e,t,function(){return A(),!0},null,null)}function A(){P(169,null)}function k(){Scene.listenEnterMap(O,T),Scene.listenLeaveMap(O,I)}function P(e,t){return Game.isWildMap()?void net.socket.write(e,t):void PopUpMessage.push(lang.String("wlls you should oprate in wild map"),color.RED)}function w(){return""!=e.master}e.MAXWLLSLEVEL=15,e.NEEDLEVEL=35,e.master="",e.dataMemberList=new eui.ArrayCollection;var L={level:0,fp:0,faction:1,name:"",bCaptain:!1,state:"wllsempty"};e.dataFriendList=new eui.ArrayCollection,e.dataResultList=new eui.ArrayCollection,e.resultWin=!1;var R=1,U=2,_=3,x=4,M=0,D=0,N=0,F=0,O="wulinliansai",B=!1,W=3,V=!1,q=[],H=["wlls missile type hit","wlls missile type addlife","wlls missile type dizzy","wlls missile type retard","wlls missile type none"];e.OpenPanel=t,e.ClosePanel=n,e.BeginMatch=i,e.EndMatch=a,e.onSyncMemberList=r,e.GetRankNameByLevel=l,e.onSyncMyRoleInfo=c,e.ApplyInviteFriend=h,e.OnSyncFriendList=d,e.InviteFriend=p,e.ShowInviteConfirmPanel=g,e.AcceptInvitation=m,e.JoinFail=f,e.SyncPKResult=v,e.SyncPKRoleInfo=y,e.SendInviteSuccess=S,e.EnterScene=T,e.LeaveScene=I,e.BuyChance=G,e.load=k,e.SendC2SCmd=P,e.IsInRoom=w}(WulinLiansai||(WulinLiansai={}));var Wuxingyinmanager;!function(e){function t(){Game.dispatcher.addEventListener(Game.EVENT.AddItem,H,null),Game.dispatcher.addEventListener(Game.EVENT.RemoveItem,H,null),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,H,null);for(var t={},n=RES.getRes("public_config/wuxingyin/wuxingyin_grade.json"),i=0;i!=n.length;i++){var a=n[i];e.wuxingyinGradeConfig[a.grade]=a,a.grade>e.wuxingyinGradeMaxlevel&&(e.wuxingyinGradeMaxlevel=a.grade);var r=1e4*a.cost[0]+a.cost[1];t[r]=!0}var o=RES.getRes("public_config/wuxingyin/wuxingyin_attribute.json");e.wuxingyinAttributeLevel=o;for(var i=0;i!=o.length;i++){for(var s={},l=o[i],u=0;u!=l.levels.length;u++){var c=l.levels[u];s[c.level]=c,c.level>e.wuxingyinAttributeMaxLevel&&(e.wuxingyinAttributeMaxLevel=c.level);var r=1e4*c.cost[0]+c.cost[1];t[r]=!0}e.wuxingyinAttributeLevelConfig.push(s)}var h=RES.getRes("public_config/wuxingyin/wuxingshi_suit.json");e.wuxingshiSuitNun=0,e.jingzhiwuxingshiSuitNun=0;for(var i=0;i!=h.length;i++){var a=h[i];e.wuxingshiSuitConfig[a.id]=a,1==a.type?e.wuxingshiSuitNun++:2==a.type&&e.jingzhiwuxingshiSuitNun++;for(var u=0;u!=a.stones.length;u++){var d=a.stones[u];e.wuxingshiId2SuitId[d]=a.id}}for(var p=RES.getRes("public_config/wuxingyin/wuxingshi_dungeon.json"),i=0;i!=p.dungeonName.length;i++){var a=p.dungeonName[i],g=a.dungeonId,m=a.name;e.wuxingshiDungeonName[g]=m}for(var i=0;i!=p.attributeName.length;i++){var a=p.attributeName[i],f=a.attribute,v=a.name;e.wuxingshiDungeonAttributeName[f]=v}for(var y=RES.getRes("public_config/wuxingyin/wuxingshi_attribute.json"),i=0;i!=y.length;i++){var a=y[i];e.wuxingshiAttributeConfig[a.id]=a,0==e.wuxingshiMaxLevel&&(e.wuxingshiMaxLevel=a.normalAttribute.params.length-1),e.wuxingshiDetail2Id[a.activeItem[1]]=a.id;var r=1e4*a.activeItem[0]+a.activeItem[1];t[r]=!0;var r=1e4*a.cost.genre+a.cost.detail;t[r]=!0;var r=1e4*a.split.genre+a.split.detail;t[r]=!0}var b=[];for(var S in t){var r=Number(S);b.push(r)}q(b)}function n(t){return e.wuxingshiAttributeConfig[t]}function i(t){return e.wuxingyinGradeConfig[t]}function a(t){return e.wuxingshiSuitConfig[t]}function r(t){return e.wuxingshiId2SuitId[t]}function o(t){var n=e.wuxingshiDetail2Id[t];if(null==n)return"";var i=e.wuxingshiAttributeConfig[n];return null!=i?i.source:""}function s(t){return e.wuxingshiDetail2Id[t]}function l(t){var n=0;for(var i in e.wuxingshiDetail2Id){var a=Number(i);if(e.wuxingshiDetail2Id[a]==t){n=a;break}}return n}function u(t){return e.wuxingyinAttributeLevel[t]}function c(t,n){var i=e.wuxingyinAttributeLevelConfig[t];return null==i?null:i[n]}function h(t){return e.wuxingyinData.attributeLevels[t]}function d(t){e.wuxingyinDataPlayerView=t,w(),L()}function p(t){e.wuxingyinData=t.wuxingshidata,e.jingzhiwuxingyinData=t.jingzhiwuxingshidata,k(),P();var n=e.wuxingyinData.getOpt();switch(n){case e.Opt_LoadSyncInfo:case e.Opt_WuxingshiSplit:break;case e.Opt_WuxingyinGradeLevelup:Game.dispatcher.dispatchEventWith(Game.EVENT.WuxingyinGradeLevelup);break;case e.Opt_WuxingyinAttributeLevelup:Game.dispatcher.dispatchEventWith(Game.EVENT.WuxingyinAttributeLevelup);break;case e.Opt_WuxingshiActive:Game.dispatcher.dispatchEventWith(Game.EVENT.WuxingshiActive);break;case e.Opt_WuxingshiLevelup:Game.dispatcher.dispatchEventWith(Game.EVENT.WuxingshiLevelup);break;case e.Opt_WuxingshiEnchase:Game.dispatcher.dispatchEventWith(Game.EVENT.WuxingshiEnchase);break;case e.Opt_WuxingshiEnchaseSuit:Game.dispatcher.dispatchEventWith(Game.EVENT.WuxingshiEnchaseSuit);break;case e.Opt_WuxingshiRestore:Game.dispatcher.dispatchEventWith(Game.EVENT.WuxingshiRestore)}Y();var i=n!=e.Opt_LoadSyncInfo&&n!=e.Opt_WuxingshiSplit;PlayerAttribute.UpdateFightingPower(i)}function g(t){var n=e.wuxingshiAttributeConfig[t];if(1==n.type)for(var i=e.wuxingyinData.getStones(),a=0;a!=i.length;a++){var r=i[a];if(r.getId()==t)return r}else for(var i=e.jingzhiwuxingyinData.getStones(),a=0;a!=i.length;a++){var r=i[a];if(r.getId()==t)return r}}function m(t){for(var n=e.wuxingyinDataPlayerView.getStones(),i=0;i!=n.length;i++){var a=n[i];if(a.getId()==t)return a}}function f(t,n){var i="",a=e.wuxingshiDungeonName[t],r=e.wuxingshiDungeonAttributeName[n];return null!=a&&null!=r&&(i=a+" - "+r),i}function v(t){var n=e.wuxingshiAttributeConfig[t];if(1==n.type){for(var i=0,a=0;a!=e.wuxingyinData.stones.length;a++){var r=e.wuxingyinData.stones[a];if(r.actived&&r.id==t){i=r.level;break}}return i}for(var i=0,a=0;a!=e.jingzhiwuxingyinData.stones.length;a++){var r=e.jingzhiwuxingyinData.stones[a];if(r.actived&&r.id==t){i=r.level;break}}return i}function y(t){for(var n=0,i=0;i!=e.wuxingyinDataPlayerView.stones.length;i++){var a=e.wuxingyinDataPlayerView.stones[i];if(a.actived&&a.id==t){n=a.level;break}}return n}function b(t){var n=e.wuxingshiAttributeConfig[t];if(1==n.type){for(var i=!1,a=0;a!=e.wuxingyinData.stones.length;a++)if(e.wuxingyinData.stones[a].id==t){i=e.wuxingyinData.stones[a].actived;break}return i}for(var i=!1,a=0;a!=e.jingzhiwuxingyinData.stones.length;a++)if(e.jingzhiwuxingyinData.stones[a].id==t){i=e.jingzhiwuxingyinData.stones[a].actived;break}return i}function S(t){var n=e.wuxingshiAttributeConfig[t],i=e.wuxingyinData.getSlots();2==n.type&&(i=e.jingzhiwuxingyinData.getSlots());for(var a=0;a!=i.length;a++)if(i[a]==t)return!0;return!1}function E(t){var i=[],a={};if(null!=t){var r=f(t,e.dungeonAttack),o=f(t,e.dungeonDefense);a[r]=0,a[o]=0,i.push({key:r,value:0}),i.push({key:o,value:0})}else for(var s=5;7>=s;s++){var r=f(s,e.guangmingdingAttack),o=f(s,e.guangmingdingDefense);a[r]=0,a[o]=0,i.push({key:r,value:0}),i.push({key:o,value:0})}for(var s=0;s!=e.wuxingyinSlotNum;s++){var l=e.jingzhiwuxingyinData.slots[s];if(!(0>=l)){var u=v(l),c=n(l);if(null!=c)for(var h=0;h!=c.dungeonAttribute.length;h++){var d=c.dungeonAttribute[h],p=f(d.dungeonId,d.attribute),g=d.Param[u];a[p]+=g}}}for(var s=0;s!=i.length;s++){var m=i[s].key;i[s].value=a[m]}return i}function C(t){var i=[],a={};if(null!=t){var r=f(t,e.dungeonAttack),o=f(t,e.dungeonDefense);a[r]=0,a[o]=0,i.push({key:r,value:0}),i.push({key:o,value:0})}else for(var s=1;4>=s;s++){var r=f(s,e.dungeonAttack),o=f(s,e.dungeonDefense);a[r]=0,a[o]=0,i.push({key:r,value:0}),i.push({key:o,value:0})}for(var s=0;s!=e.wuxingyinSlotNum;s++){var l=e.wuxingyinData.slots[s];if(t>=5&&(l=e.jingzhiwuxingyinData.slots[s]),!(0>=l)){var u=v(l),c=n(l);if(null!=c)for(var h=0;h!=c.dungeonAttribute.length;h++){var d=c.dungeonAttribute[h],p=f(d.dungeonId,d.attribute),g=d.Param[u];a[p]+=g}}}for(var s=0;s!=i.length;s++){var m=i[s].key;i[s].value=a[m]}return i}function T(){for(var t=[],i={},a=1;4>=a;a++){var r=f(a,e.dungeonAttack),o=f(a,e.dungeonDefense);i[r]=0,i[o]=0,t.push({key:r,value:0}),t.push({key:o,value:0})}for(var a=0;a!=e.wuxingyinSlotNum;a++){var s=e.wuxingyinDataPlayerView.slots[a];if(!(0>=s)){var l=y(s),u=n(s);if(null!=u)for(var c=0;c!=u.dungeonAttribute.length;c++){var h=u.dungeonAttribute[c],d=f(h.dungeonId,h.attribute),p=h.Param[l];i[d]+=p}}}for(var a=0;a!=t.length;a++){var g=t[a].key;t[a].value=i[g]}return t}function I(){for(var t=[],n=0;n!=e.wuxingyinAttributeNum;n++){var i=e.wuxingyinData.getAttributeLevels()[n];if(i>0){var a=c(n,i);t.push({key:Buff.GetName(a.buff[0]),value:a.buff[1]})}}return t}function G(){for(var t=[],i={},a=0;a!=e.wuxingyinSlotNum;a++){var r=e.wuxingyinData.getSlots()[a];if(!(0>=r)&&b(r)){var o=n(r),s=v(r),l=o.normalAttribute.buffId,u=o.normalAttribute.params[s],c=i[l];null==c&&(c=0),c+=u,i[l]=c}}for(var h in i){var l=Number(h),d=i[l];t.push({key:Buff.GetName(l),value:d})}return t}function A(e,t){for(var n=0,i=0;i!=e.length;i++)for(var a=0;a!=t.length;a++)e[i]==t[a]&&(n+=1);return n}function k(){e.activedSuit={};for(var t in e.wuxingshiSuitConfig){var n=Number(t),i=0,a=e.wuxingshiSuitConfig[n],r=A(a.stones,e.wuxingyinData.getSlots());2==a.type&&(r=A(a.stones,e.jingzhiwuxingyinData.getSlots()));for(var o=0;o!=a.attributes.length;o++)r>=a.attributes[o].needNum&&(i+=1);e.activedSuit[n]=i}}function P(){e.fightingPower=0;for(var t=0;t!=e.wuxingyinAttributeNum;t++){var i=e.wuxingyinData.attributeLevels[t];if(!(0>=i)){var r=e.wuxingyinAttributeLevelConfig[t];e.fightingPower+=r[i].power}}for(var t=0;t!=e.wuxingyinSlotNum;t++){var o=e.wuxingyinData.slots[t];if(!(0>=o)){var s=g(o),i=s.level,r=n(o);e.fightingPower+=r.normalAttribute.powers[i]}}for(var t=0;t!=e.wuxingyinSlotNum;t++){var o=e.jingzhiwuxingyinData.slots[t];if(!(0>=o)){var s=g(o),i=s.level,r=n(o);e.fightingPower+=r.normalAttribute.powers[i]}}for(var l in e.activedSuit){var u=Number(l),c=e.activedSuit[u];if(!(0>=c))for(var r=a(u),t=0;t!=c;t++)e.fightingPower+=r.attributes[t].power}}function w(){e.activedSuitPlayerView={};for(var t in e.wuxingshiSuitConfig){for(var n=Number(t),i=0,a=e.wuxingshiSuitConfig[n],r=A(a.stones,e.wuxingyinDataPlayerView.getSlots()),o=0;o!=a.attributes.length;o++)r>=a.attributes[o].needNum&&(i+=1);e.activedSuitPlayerView[n]=i}}function L(){e.fightingPowerPlayerView=0;for(var t=0;t!=e.wuxingyinAttributeNum;t++){var i=e.wuxingyinDataPlayerView.attributeLevels[t];if(!(0>=i)){var r=e.wuxingyinAttributeLevelConfig[t];e.fightingPowerPlayerView+=r[i].power}}for(var t=0;t!=e.wuxingyinSlotNum;t++){var o=e.wuxingyinDataPlayerView.slots[t];if(!(0>=o)){var s=m(o),i=s.level,r=n(o);e.fightingPowerPlayerView+=r.normalAttribute.powers[i]}}for(var l in e.activedSuitPlayerView){var u=Number(l),c=e.activedSuitPlayerView[u];if(!(0>=c))for(var r=a(u),t=0;t!=c;t++)e.fightingPowerPlayerView+=r.attributes[t].power}}function R(){if(e.wuxingyinData.getGrade()>=e.wuxingyinGradeMaxlevel)return void PopUpMessage.push(lang.String("wuxingyin grade reach maxlevel"),color.RED);var t=i(e.wuxingyinData.getGrade()+1),n=t.cost[0],a=t.cost[1],r=t.cost[2];return PlayerAttribute.GetItemCount(n,a)<r?(PopUpMessage.push(lang.String("wuxingyin no material"),color.RED),void UI.ResourceObtain.Open([UI.ObtResId.wuxingyinGrade])):void net.socket.write(187,null)}function U(t){var n=e.wuxingyinData.getAttributeLevels()[t];if(n>=e.wuxingyinAttributeMaxLevel)return void PopUpMessage.push(lang.String("wuxingyin attribute reach maxlevel"),color.RED);var i=c(t,n+1),a=i.cost[0],r=i.cost[1],o=i.cost[2];if(PlayerAttribute.GetItemCount(a,r)<o)return PopUpMessage.push(lang.String("wuxingyin no material"),color.RED),void UI.ResourceObtain.Open([UI.ObtResId.wuxingyinAttributeMaterial]);var s=new net.def.Index;s.index=t,net.socket.write(188,s.toArrayBuffer())}function _(e){if(!(0>=e||b(e))){var t=n(e),i=t.activeItem[0],a=t.activeItem[1],r=1;if(PlayerAttribute.GetItemCount(i,a)<r)return UI.ItemTips.instance.data={type:"item",content:{genre:i,detailType:a},obtainId:UI.ObtResId.wuxingshi},void UIManager.push(UI.ItemTips.instance);var o=new net.def.Index;o.index=e,net.socket.write(189,o.toArrayBuffer())}}function x(t){if(0>=t)return!1;if(!b(t))return!1;var i=v(t);if(i>=e.wuxingshiMaxLevel)return PopUpMessage.push(lang.String("wuxingshi reach max level"),color.RED),!1;var a=i+1,r=n(t),o=r.cost.genre,s=r.cost.detail,l=r.cost.count[a];if(PlayerAttribute.GetItemCount(o,s)<l)return PopUpMessage.push(lang.String("wuxingyin no material"),color.RED),t>120?UIManager.push(new UI.WuxingshiSplitUI(2)):UIManager.push(new UI.WuxingshiSplitUI(1)),!1;var u=new net.def.Index;return u.index=t,net.socket.write(190,u.toArrayBuffer()),!0}function M(e){if(!(0>=e)&&b(e)){var t=new net.def.Index;t.index=e,net.socket.write(191,t.toArrayBuffer())}}function D(e){if(!(0>=e)){var t=new net.def.Index;t.index=e,net.socket.write(192,t.toArrayBuffer())}}function N(t){var n=e.getSplitMaterialNum(),i=PlayerAttribute.GetItemCount(e.wuxingjinghuaGD[0],e.wuxingjinghuaGD[1]);if(2==t&&(i=PlayerAttribute.GetItemCount(e.jingzhiwuxingjinghuaGD[0],e.jingzhiwuxingjinghuaGD[1])),i+n>Game.ITEM_MAXSTACK)return void PopUpMessage.push(lang.String("wuxingyin jinghua num reach max"),color.RED);var a=new net.def.Index;a.index=t,net.socket.write(193,a.toArrayBuffer())}function F(t){if(!(0>=t)&&b(t)){var i=v(t);if(!(0>=i)){var a=n(t),r=a.split.count[i],o=PlayerAttribute.GetItemCount(e.wuxingjinghuaGD[0],e.wuxingjinghuaGD[1]);if(t>120&&(o=PlayerAttribute.GetItemCount(e.jingzhiwuxingjinghuaGD[0],e.jingzhiwuxingjinghuaGD[1])),o+r>Game.ITEM_MAXSTACK)return void PopUpMessage.push(lang.String("wuxingyin jinghua num reach max"),color.RED);var s=new net.def.Index;s.index=t,net.socket.write(194,s.toArrayBuffer())}}}function O(){var t=e.wuxingyinData.getGrade(),n=i(t);return{type:"clientitem",quality:n.quality,icon:n.source,count:"",forbidTip:!0}}function B(t,n){var i=0;for(var a in e.wuxingshiAttributeConfig){var r=Number(a),o=e.wuxingshiAttributeConfig[r];o.type==n&&o.slotIndex==t&&b(r)&&r>i&&(i=r)}return i}function W(){var t=0;for(var n in e.wuxingshiAttributeConfig){var i=Number(n);if(b(i)){var a=e.wuxingshiAttributeConfig[i],r=PlayerAttribute.GetItemCount(a.activeItem[0],a.activeItem[1]);r>0&&(t+=a.split.count[0]*r)}}return t}function V(){var t=e.wuxingyinData.getGrade(),n=i(t);return n.maxLevel}function q(t){e.allMaterials=[];for(var n=0;n!=t.length;n++){var i=t[n],a=~~(i/1e4),r=i%1e4;e.allMaterials.push({genre:a,detail:r,count:0})}}function H(){var t=egret.getTimer();nt>t||(nt=t+e.badgeRefreshInterval,egret.setTimeout(j,null,e.badgeRefreshInterval))}function j(){for(var t=!1,n=0;n!=e.allMaterials.length;n++){var i=e.allMaterials[n],a=i.count,r=PlayerAttribute.GetItemCount(i.genre,i.detail);r!=a&&(i.count=r,t=!0)}t&&Y()}function Y(){e.badgeWuxingyinUiPageBtn[1]=!1,e.badgeWuxingyinUiPageBtn[2]=!1,K(),Q(),X(),J(),z(),Z(),$(),et(),tt(),Game.dispatcher.dispatchEventWith(Game.EVENT.WuxingyinBadge)}function K(){e.badgeWuxingyinGrade=!1;var t=e.wuxingyinData.getGrade();if(!(t>=e.wuxingyinGradeMaxlevel)){var n=t+1,a=i(n),r=a.cost[0],o=a.cost[1],s=a.cost[2];e.badgeWuxingyinGrade=PlayerAttribute.GetItemCount(r,o)>=s}}function Q(){for(var t=e.wuxingyinData.getGrade(),n=i(t),a=n.maxLevel,r=0;r!=e.wuxingyinAttributeLevelConfig.length;r++){e.badgeWuxingyinAttribute[r]=!1;var o=e.wuxingyinData.getAttributeLevels()[r];if(!(o>=e.wuxingyinAttributeMaxLevel||o>=a)){var s=o+1,l=e.wuxingyinAttributeLevelConfig[r][s],u=l.cost[0],c=l.cost[1],h=l.cost[2];e.badgeWuxingyinAttribute[r]=PlayerAttribute.GetItemCount(u,c)>=h}}}function X(){if(e.badgeWuxingyinPage=!1,e.badgeWuxingyinGrade)return void(e.badgeWuxingyinPage=!0);for(var t in e.badgeWuxingyinAttribute)if(e.badgeWuxingyinAttribute[Number(t)])return void(e.badgeWuxingyinPage=!0)}function J(){for(var t in e.wuxingshiAttributeConfig){var n=Number(t),i=e.wuxingshiAttributeConfig[n],a=e.badgeJingZhiWuxingshiActive;if(1==i.type&&(a=e.badgeWuxingshiActive),a[n]=!1,!b(n)){var r=i.activeItem[0],o=i.activeItem[1],s=1;a[n]=PlayerAttribute.GetItemCount(r,o)>=s}}}function z(){for(var t in e.wuxingshiAttributeConfig){var n=Number(t),i=e.wuxingshiAttributeConfig[n],a=e.badgeJingZhiWuxingshiLevelup;if(1==i.type&&(a=e.badgeWuxingshiLevelup),a[n]=!1,b(n)){var r=v(n);if(!(r>=e.wuxingshiMaxLevel)){var o=r+1,s=i.cost.genre,l=i.cost.detail,u=i.cost.count[o];a[n]=PlayerAttribute.GetItemCount(s,l)>=u}}}}function Z(){for(var t in e.wuxingshiSuitConfig){var n=Number(t),i=e.wuxingshiSuitConfig[n];1==i.type?e.badgeWuxingshiSuitPage[n]=!1:e.badgeJingZhiWuxingshiSuitPage[n]=!1;for(var a=0;a!=i.stones.length;a++){var r=i.stones[a];if(1==i.type&&e.badgeWuxingshiActive[r]){e.badgeWuxingshiSuitPage[n]=!0;break}if(2==i.type&&e.badgeJingZhiWuxingshiActive[r]){e.badgeJingZhiWuxingshiSuitPage[n]=!0;break}}}}function $(){for(var t=0;t!=e.wuxingyinSlotNum;t++){e.badgeWuxingyinSlot[t]=!1;var n=e.wuxingyinData.getSlots()[t];if(0>=n)for(var i in e.wuxingshiAttributeConfig){var a=Number(i),r=e.wuxingshiAttributeConfig[a];if(1==r.type&&r.slotIndex==t&&b(a)){e.badgeWuxingyinSlot[t]=!0,e.badgeWuxingyinUiPageBtn[1]=!0;break}}else e.badgeWuxingyinSlot[t]=e.badgeWuxingshiLevelup[n];if(e.badgeJingZhiWuxingyinSlot[t]=!1,n=e.jingzhiwuxingyinData.getSlots()[t],0>=n)for(var i in e.wuxingshiAttributeConfig){var a=Number(i),r=e.wuxingshiAttributeConfig[a];if(2==r.type&&r.slotIndex==t&&b(a)){e.badgeJingZhiWuxingyinSlot[t]=!0,e.badgeWuxingyinUiPageBtn[2]=!0;break}}else e.badgeJingZhiWuxingyinSlot[t]=e.badgeJingZhiWuxingshiLevelup[n]}}function et(){e.badgeWuxingyinTujian=!1;for(var t in e.badgeWuxingshiSuitPage){var n=Number(t);if(e.badgeWuxingshiSuitPage[n]){e.badgeWuxingyinTujian=!0,e.badgeWuxingyinUiPageBtn[1]=!0;break}}e.badgeJingZhiWuxingyinTujian=!1;for(var t in e.badgeJingZhiWuxingshiSuitPage){var n=Number(t);if(e.badgeJingZhiWuxingshiSuitPage[n]){e.badgeJingZhiWuxingyinTujian=!0,e.badgeWuxingyinUiPageBtn[2]=!0;break}}}function tt(){if(!(PlayerAttribute.Level<e.openLevel)){var t=!1;if(e.badgeWuxingyinGrade&&(t=!0),e.badgeWuxingyinTujian&&(t=!0),e.badgeJingZhiWuxingyinTujian&&(t=!0),!t)for(var n=0;n!=e.wuxingyinSlotNum;n++)if(e.badgeWuxingyinSlot[n]){t=!0;break}badge.onLight(badge.action.Wuxingyin,t)}}e.openLevel=50,e.wuxingyinGradeConfig={},e.wuxingyinAttributeLevelConfig=[],e.wuxingyinAttributeLevel=[],e.wuxingshiSuitConfig={},e.wuxingshiId2SuitId={},e.wuxingshiDungeonName={},e.wuxingshiDungeonAttributeName={},e.wuxingshiAttributeConfig={},e.wuxingyinGradeMaxlevel=0,e.wuxingyinAttributeMaxLevel=0,e.wuxingshiMaxLevel=0,e.wuxingshiSuitNun=0,e.jingzhiwuxingshiSuitNun=0,e.wuxingshiDetail2Id={},e.wuxingyinData=null,e.wuxingyinDataPlayerView=null,e.activedSuit={},e.activedSuitPlayerView={},e.fightingPower=0,e.fightingPowerPlayerView=0,e.wuxingyinAttributeNum=8,e.wuxingyinSlotNum=5,e.dungeonAttack="dungeonAttack",e.dungeonDefense="dungeonDefense",e.guangmingdingAttack="guangMingDingAttack",e.guangmingdingDefense="guangMingDingDefense",e.wuxingjinghuaGD=[14,2027],e.jingzhiwuxingjinghuaGD=[14,2076],e.jingzhiwuxingyinData=null,e.Opt_LoadSyncInfo=0,e.Opt_WuxingyinGradeLevelup=1,e.Opt_WuxingyinAttributeLevelup=2,e.Opt_WuxingshiActive=3,e.Opt_WuxingshiLevelup=4,e.Opt_WuxingshiEnchase=5,e.Opt_WuxingshiEnchaseSuit=6,e.Opt_WuxingshiSplit=7,e.Opt_WuxingshiRestore=8,e.WuxingyinUI_DisplayMode_Self=0,e.WuxingyinUI_DisplayMode_PlayerView=1,e.Load=t,e.GetWuxingshiAttributeConfig=n,e.GetWuxingyinGradeConfig=i,e.GetWuxingshiSuitConfig=a,e.GetSuitIdByWuxingshiId=r,e.GetWuxingshiSmallIcon=o,e.GetWuxingshiIdByDetail=s,e.GetWuxingshiDetailById=l,e.GetWuxingyinAttributeConfig=u,e.GetWuxingyinAttributeLevelConfig=c,e.GetWuxingyinAttributeLevel=h,e.onSyncDataPlayerView=d,e.onSyncData=p,e.getWuxingshiInfo=g,e.getWuxingshiInfoPlayerView=m,e.getDungeonAttributeName=f,e.GetWuxingshiLevel=v,e.GetWuxingshiLevelPlayerView=y,e.IsActived=b,e.IsUsing=S,e.GetAllJingZhiDungeonAttributsDesc=E,e.GetAllDungeonAttributsDesc=C,e.GetAllDungeonAttributsDescPlayerView=T,e.GetAllWuxingyinAttributesDesc=I,e.GetAllWuxingshiAttributesDesc=G,e.updateActivedSuit=k,e.updateFightingPower=P,e.wuxingyinGradeLevelup=R,e.wuxingyinAttributeLevelup=U,e.wuxingshiActive=_,e.wuxingshiLevelup=x,e.wuxingshiEnchase=M,e.wuxingshiEnchaseSuit=D,e.wuxingshiSplit=N,e.wuxingshiRestore=F,e.getWuxingyinCellItemData=O,e.findBestWuxingshi=B,e.getSplitMaterialNum=W,e.getWuxingyinAttributeCurMaxLevel=V,e.allMaterials=[],e.badgeWuxingyinGrade=!1,e.badgeWuxingyinAttribute={},e.badgeWuxingyinPage=!1,e.badgeWuxingshiActive={},e.badgeJingZhiWuxingshiActive={},e.badgeWuxingshiLevelup={},e.badgeJingZhiWuxingshiLevelup={},e.badgeWuxingshiSuitPage={},e.badgeJingZhiWuxingshiSuitPage={},e.badgeWuxingyinSlot={},e.badgeJingZhiWuxingyinSlot={},e.badgeWuxingyinUiPageBtn={},e.badgeWuxingyinTujian=!1,e.badgeJingZhiWuxingyinTujian=!1,e.badgeRefreshInterval=1e3;var nt=0}(Wuxingyinmanager||(Wuxingyinmanager={}));var YanEmperor;!function(e){function t(){Scene.listenEnterMap(L,i),Scene.listenLeaveMap(L,a),Scene.listenEnterMap(R,r),Scene.listenLeaveMap(R,o),e.plan=[],Reminder.events[Reminder.EventName.Yanemperor].timeLine=[];for(var t=RES.getRes("config/scenes/yanemperor.json"),n=0;n<t.plan.length;n++){var s=t.plan[n][0].match(/(\d{2}):(\d{2})/),l=t.plan[n][1].match(/(\d{2}):(\d{2})/);e.plan.push([100*+s[1]+ +s[2],100*+l[1]+ +l[2]]),Reminder.events[Reminder.EventName.Yanemperor].timeLine.push({hour:+s[1],minute:+s[2]})}e.maxToast=Number(t.maxToast),e.radioToast=Number(t.radioToast),e.openLevel=Number(t.openLevel),e.maxAwarded=Number(t.maxAwarded)}function n(t){if(null==t&&(t=e.myAspect),null==t)return"";switch(t.floor){case-1:return lang.String("adytum");case 0:case 1:case 2:return lang.String(e.Aspect[t.room])+lang.StringWithFormat("{1}floor",t.floor+1)}return""}function i(){Scene.handleIdle[L]=function(){return null},null==e.noteHUD&&(e.noteHUD=new UI.YanEmperorHUD),e.noteHUD.mapName=n(),UI.battle.addChild(e.noteHUD),e.noteHUD.currentState="floor"}function a(){null!=e.noteHUD&&(UIManager.pop(e.noteHUD),e.noteHUD=null),e.otherTeams=[],e.myAspect=null,Game.dispatcher.dispatchEventWith(Game.EVENT.YanEmperorSyncTeams),delete Scene.handleIdle[L]}function r(){Scene.handleIdle[R]=function(){return null},null==e.noteHUD&&(e.noteHUD=new UI.YanEmperorHUD),e.noteHUD.second=e.adytumTime,e.noteHUD.mapName=n(),e.noteHUD.currentState="adytum",e.adytumEvent&&(e.noteHUD.eventName=e.adytumEvent.event,e.noteHUD.eventTask=e.adytumEvent.finish+"/"+e.adytumEvent.count,e.noteHUD.eventSecond=e.adytumEvent.restTime),UI.battle.addChild(e.noteHUD)}function o(){null!=e.noteHUD&&(UIManager.pop(e.noteHUD),e.noteHUD=null),e.otherTeams=[],e.myAspect=null,e.adytumTime=null,Game.dispatcher.dispatchEventWith(Game.EVENT.YanEmperorSyncTeams),delete Scene.handleIdle[R]}function s(t){var n=t.getTeams();if(e.otherTeams=[],0==n.length)return void Game.dispatcher.dispatchEventWith(Game.EVENT.YanEmperorSyncTeams);for(var i=0;i<n.length;i++){for(var a=[],r=n[i].getMembers(),o=0;o<r.length;o++)a.push({name:r[o].getName(),level:r[o].getLevel(),faction:r[o].getFaction(),fp:r[o].getFp(),floor:r[o].getFloor(),room:r[o].getRoom(),online:r[o].getOnline(),bCaptain:0==o});e.otherTeams.push({members:a,id:n[i].id,wineTime:n[i].wineTime||0,approval:n[i].getApproval(),name:n[i].getName()})}Game.dispatcher.dispatchEventWith(Game.EVENT.YanEmperorSyncTeams)}function l(t){var n=t.getMembers();if(e.myTeamId=t.getId(),0==n.length||0==e.myTeamId)return e.myTeamInfo=null,e.myCaptain=null,e.myTeamId=0,void Game.dispatcher.dispatchEventWith(Game.EVENT.YanEmperorMyTeam);e.myCaptain=!1;for(var i=[],a=0;a<n.length;a++)i.push({name:n[a].getName(),level:n[a].getLevel(),faction:n[a].getFaction(),fp:n[a].getFp(),floor:n[a].getFloor(),room:n[a].getRoom(),online:n[a].getOnline(),bCaptain:0==a}),0==a&&n[a].getName()==Player.instance.Name&&(e.myCaptain=!0);e.myCaptain?e.myTeamInfo={name:t.getName(),members:i,wineTime:t.wineTime||0,id:t.id,approval:t.getApproval(),addition:t.getAddition()}:e.myTeamInfo={name:t.getName(),members:i,wineTime:t.wineTime||0,id:t.id,approval:t.getApproval(),addition:t.getAddition()},Game.dispatcher.dispatchEventWith(Game.EVENT.YanEmperorMyTeam)}function u(){e.myTeamInfo=null,e.myCaptain=null,e.myTeamId=0,e.applicantMembers=[],Game.dispatcher.dispatchEventWith(Game.EVENT.YanEmperorMyTeam),A()}function c(t){e.myTeamId=t.getTeamId(),e.myAspect={floor:t.getFloor(),room:t.getRoom()},e.noteHUD&&(e.noteHUD.mapName=n()),0==e.myTeamId&&(e.myTeamInfo=null,e.myCaptain=null,Game.dispatcher.dispatchEventWith(Game.EVENT.YanEmperorMyTeam))}function h(e){for(var t=[],n=0;n<e.length;n++)t.push({playerCount:e[n].getPlayerCount(),teamCount:e[n].getTeamCount()});Game.dispatcher.dispatchEventWith(Game.EVENT.YanEmperorFloorInfo,!1,t)}function d(t){e.noteHUD&&e.noteHUD.addApplicant(!0);var n=Game.getServerDate();e.applicantMembers.push({date:new Date(n.getTime()+5*Game.Minute),player:t})}function p(t){e.adytumTime=t.getRestTime(),e.noteHUD&&(e.noteHUD.second=e.adytumTime)}function g(t){e.adytumEvent={event:t.getEvent(),count:t.getCount(),finish:t.getFinish(),restTime:t.getRestTime()},e.noteHUD&&(e.noteHUD.eventName=e.adytumEvent.event,e.noteHUD.eventTask=e.adytumEvent.finish+"/"+e.adytumEvent.count,e.noteHUD.eventSecond=e.adytumEvent.restTime)}function m(t,n){e.applicantMembers=[];for(var i=Game.getServerDate(),a=100*i.getHours()+i.getMinutes(),r=0;r<e.plan.length;r++)if(a>=e.plan[r][0]&&a<e.plan[r][1]){var o=new net.def.C2SYanEmperorShift;return o.floor=t,o.room=Number(n),ChatSys.pushSys(lang.String("yanemperor system message")),void net.socket.write(47,o.toArrayBuffer())}PopUpMessage.push(lang.String("not open"),color.Warning)}function f(e,t){if(null==e||null==t)return void net.socket.write(99,null);var n=new net.def.C2SYanEmperorShift;n.setFloor(e),n.setRoom(t),net.socket.write(99,n.toArrayBuffer())}function v(e){var t=new net.def.Name;t.setName(e),net.socket.write(180,t.toArrayBuffer())}function y(t,n){e.applicantMembers.splice(n,1),Game.dispatcher.dispatchEventWith(Game.EVENT.YanEmperorApplication);var i=new net.def.Name;i.setName(t),net.socket.write(181,i.toArrayBuffer())}function b(t){0>t||0!=e.applicantMembers.length&&(e.applicantMembers.splice(t,1),Game.dispatcher.dispatchEventWith(Game.EVENT.YanEmperorApplication))}function S(){for(var t=[],n=Game.getServerDate(),i=0;i<e.applicantMembers.length;i++)n<e.applicantMembers[i].date&&t.push(e.applicantMembers[i]);e.applicantMembers=t,Game.dispatcher.dispatchEventWith(Game.EVENT.YanEmperorApplication)}function E(t){var n=new net.def.Bool;n.setOk(t),e.myTeamInfo.approval=t,net.socket.write(182,n.toArrayBuffer())}function C(){net.socket.write(164,null)}function T(e){var t=new net.def.Index;t.setIndex(e),net.socket.write(116,t.toArrayBuffer())}function I(e){var t=new net.def.Name;t.setName(e),net.socket.write(100,t.toArrayBuffer())}function G(e){var t=new net.def.Name;t.setName(e),net.socket.write(186,t.toArrayBuffer())}function A(){net.socket.write(183,null)}function k(){net.socket.write(184,null)}function P(e){var t=new net.def.Index;t.setIndex(e),net.socket.write(185,t.toArrayBuffer())}function w(){e.myCaptain=null,e.myTeamId=0,e.myTeamInfo=null,net.socket.write(141,null)}var L="yanemperor/floor",R="yanemperor/adytum";e.toastItem={genre:14,detailType:2005},e.floor_npcLevel=[40,60,80],e.curAwarded=0;var U;!function(e){e[e.North=0]="North",e[e.West=1]="West",e[e.South=2]="South",e[e.East=3]="East"}(U=e.Aspect||(e.Aspect={})),e.load=t,e.getSceneName=n,e.applicantMembers=[],e.s2c_teamlist=s,e.s2c_teaminfo=l,e.s2c_kicked=u,e.s2c_YanEmperorPlayer=c,e.s2c_floorinfo=h,e.s2c_applicant=d,e.s2c_adytumtime=p,e.s2c_adytumEvent=g,e.c2s_join=m,e.c2s_shift=f,e.c2s_kick=v,e.c2s_approve=y,e.delApplication=b,e.updateApplicant=S,e.c2s_setapproval=E,e.c2s_quitteam=C,e.c2s_jointeam=T,e.c2s_creatteam=I,e.c2s_rename=G,e.c2s_getteamlist=A,e.c2s_toast=k,e.c2s_floorinfo=P,e.c2s_leave=w}(YanEmperor||(YanEmperor={}));var yesouTaskManager;!function(e){function t(){e.normalTasksConifig=RES.getRes("public_config/yesoutask/yesounormaltask.json"),e.randTasksConfig=RES.getRes("public_config/yesoutask/yesourandtask.json"),e.phaseAwardConfig=RES.getRes("config/yesoutask/yesouphaseaward.json")}function n(t){var n=this,i=e.curTaskKind,o=e.curTaskId,s=net.def.S2CYesouTaskInfo.decode(t);
e.dailyMaxTimes=s.getDailyMaxTimes(),e.sumTimes=s.getSumTimes(),e.dailyTimes=s.getDailyTimes(),e.curTaskKind=s.getCurTaskKind(),e.curTaskId=s.getCurTaskId(),e.curTaskValue=s.getCurTaskValue(),e.getAwardInfo=[];for(var l=s.getAwardInfo(),u=!1,c=0;c<e.phaseAwardConfig.length;c++){var h=l&1<<c,d=0==h?!1:!0;e.getAwardInfo.push(d),e.sumTimes>=e.phaseAwardConfig[c].taskNum&&!d&&(u=!0)}badge.onLight(badge.action.YesouTaskPhaseAward,u);var p=r();null!=p&&badge.onLight(badge.action.YesouTaskAward,e.curTaskValue>=p.target[0]),0==i&&e.curTaskKind>0&&0==o&&e.curTaskId>0&&UI.battle&&UI.battle.topGroup&&(e.YesouTaskIcon||(e.YesouTaskIcon=new UI.IconButton,e.YesouTaskIcon.img="ui/zuUi/icon_rw.png",e.YesouTaskIcon.action=badge.action.YesouTaskAward+", "+badge.action.YesouTaskPhaseAward,e.YesouTaskIcon.onTap=function(e){n.OpenYesouUI()}),e.YesouTaskIcon.parent!=UI.battle.topGroup&&UI.battle.addToTopGroup(e.YesouTaskIcon,3)),a(),Game.dispatcher.dispatchEventWith(Game.EVENT.YesouTaskChanged)}function i(){return e.curTaskKind<=0||e.curTaskId<=0?void PopUpMessage.push(lang.String("yesoutask need finish guide task"),color.RED):Game.isWildMap()?void UIManager.pushPage(UI.DailyTask.instance):void PopUpMessage.push(lang.String("operation not permitted"),color.RED)}function a(){e.curTaskKind>0&&e.curTaskId>0&&e.curTaskId!=e.FINISHTASKID&&(e.miniUI||(e.miniUI=new UI.YesouTaskMini),UI.battle&&UI.battle.guideGroup&&e.miniUI.parent!=UI.battle.guideGroup&&UI.battle.guideGroup.addChild(e.miniUI)),null!=e.miniUI&&e.miniUI.parent&&egret.callLater(e.miniUI.onSyncYesouTask,e.miniUI)}function r(){if(0==e.curTaskKind||0==e.curTaskId)return null;for(var t=null,n=e.curTaskKind==e.KIND_NORMAL?e.normalTasksConifig:e.randTasksConfig,i=0;i!=n.length;i++)if(n[i].id==e.curTaskId){t=n[i];break}return t}function o(t){var n=e.curTaskValue>t.target[0]?t.target[0]:e.curTaskValue;return StringWithFormat(t.taskDesc,t.target[0],n)}function s(){net.socket.write(2006,null)}function l(){if(e.curTaskId==e.FINISHTASKID)return void(e.miniUI&&Game.removeFromParent.apply(e.miniUI));if(e.sumTimes>=e.FINISHTASKNUM)return PopUpMessage.push(lang.String("yesoutask you should get phase award first"),color.RED),void UIManager.pushPage(UI.DailyTask.instance);var t=r();null!=t&&(e.curTaskValue>=t.target[0]?s():(t.operation>0&&Operation.open(t.operation,t.param),UIManager.pop(UI.DailyTask.instance)))}function u(){for(var t=e.getAwardInfo.length-1,n=t;n>=0&&(!e.getAwardInfo[n]&&e.phaseAwardConfig[n].taskNum>e.sumTimes);n--)t=n;return e.phaseAwardConfig[t]}e.KIND_NORMAL=1,e.KIND_RAND=2,e.QUICKFINISH_ITEM_GENRE=14,e.QUICKFINISH_ITEM_DETAIL=2001,e.FINISHTASKNUM=800,e.FINISHTASKID=9999,e.normalTasksConifig=[],e.randTasksConfig=[],e.phaseAwardConfig=[],e.curTaskKind=0,e.curTaskId=0,e.curTaskValue=0,e.dailyTimes=0,e.dailyMaxTimes=50,e.sumTimes=0,e.getAwardInfo=[],e.Load=t,e.onSyncTask=n,e.OpenYesouUI=i,e.updateUI=a,e.getCurTaskCfg=r,e.getTaskDesc=o,e.GetAward=s,e.onTouchTap=l,e.GetNextPhaseAwardInfo=u}(yesouTaskManager||(yesouTaskManager={}));var shareboss;!function(e){function t(){Scene.handleIdle[S]=o,Scene.listenEnterMap(S,s),Scene.listenLeaveMap(S,l)}function n(e){y.remainingTime.delta=e.resttime,y.friendBox=e.friendBox.toString(),y.guildBox=e.guildBox.toString(),y.score1=e.monsterRest,T=e.chapter,y.chapter=T.toString()+"/"+C.toString()}function i(e){E=e.sceneName,C=e.maxChapter,I=e.ownerName,y.dungeonName=E,y.chapter=T.toString()+"/"+C.toString(),A=Item.makeProp(e.returnTicket),b=e.returnTicket}function a(e){if(h(e.win,e.endTime),e.win){var t,n,i;if(e.ownerAward.length>0){t=[];for(var a=0;a<e.ownerAward.length;a++){var r=table.parseAward(e.ownerAward[a]),o={type:r.type,content:r.content,obtainId:r.obtainId,boxType:1};t.push(o)}}if(e.friendAward.length>0){n=[];for(var a=0;a<e.friendAward.length;a++){var r=table.parseAward(e.friendAward[a]),o={type:r.type,content:r.content,obtainId:r.obtainId,boxType:1};n.push(o)}}if(e.guildAward.length>0){i=[];for(var a=0;a<e.guildAward.length;a++){var r=table.parseAward(e.guildAward[a]),o={type:r.type,content:r.content,obtainId:r.obtainId,boxType:1};i.push(o)}}UI.ClickAwardPage.instance.ShowMultiPage("Thưởng đội trưởng",t,"Thưởng Hảo Hữu",n,"Thưởng Bang",i)}}function r(){null!=A&&UI.ConfirmBox.Show(UI.ConfirmBoxStyle["default"],"Trở về chiến trường",lang.Format("Trở về chiến trường cần tốn {1} x{2}, đồng ý?",A.Name,A.Count),function(){var e=PlayerAttribute.bag.CalcCount(b.type,b.detailType);return e<A.Count?UI.ResourceObtain.Open([UI.ObtResId.shareboss]):net.socket.write(2110,null),!0},null,null)}function o(e){return null}function s(){null==y&&(y=new UI.ChallengeNote,e.bossWarningImg=new eui.Image,y.addChild(e.bossWarningImg),e.bossWarningImg.visible=!1),G=!1,y.currentState=S,UI.battle.addChild(y),y.btnExit.addEventListener(egret.TouchEvent.TOUCH_TAP,c,null),y.teamList.dataProvider=k}function l(){null!=y&&(UI.battle.removeChild(y),y.btnExit.removeEventListener(egret.TouchEvent.TOUCH_TAP,c,null),y.removeChild(e.bossWarningImg),e.bossWarningImg=null,y=null),null!=UI.ClickAwardPage.instance&&UIManager.pop(UI.ClickAwardPage.instance),null!=UI.CommonSceneResult.instance&&UIManager.pop(UI.CommonSceneResult.instance),null!=k&&k.removeAll(),Game.dispatcher.dispatchEventWith(Game.EVENT.LeaveScene)}function u(){return net.socket.write(141,null),!0}function c(){G?u():UI.ConfirmBox.Show(UI.ConfirmBoxStyle["default"],"Rời phó bản","Nếu thoát sẽ không thể nhận thưởng Phó Bản, đồng ý?",e.tryLeaveScene,null,null)}function h(e,t){null!=y&&(y.remainingTime.delta=t),UI.CommonSceneResult.instance.sceneName=E,UI.CommonSceneResult.instance.currentState="failed",1==e&&(UI.CommonSceneResult.instance.currentState="succeed"),G=!0,UIManager.push(UI.CommonSceneResult.instance)}function d(e){if(e.name!=Player.instance.Name)switch(e.type){case 0:m(e.name,e.value[0],e.value[1],e.value[2],e.value[3],e.alive);break;case 1:case 4:p(e.name);break;case 2:g(e.name,e.value[0],e.value[1])}}function p(e){for(var t=-1,n={},i=0;i<k.length;i++)if(n=k.getItemAt(i),n.name==e){t=i;break}-1!=t&&k.replaceItemAt({name:n.name,level:n.level,maxLife:n.maxLife,life:0,faction:n.faction,online:!1,bCaptain:n.bCaptain},t)}function g(e,t,n){for(var i=0;i<k.length;i++){var a=k.getItemAt(i);if(a.name==e)return void k.replaceItemAt({name:a.name,level:a.level,maxLife:n,life:t,faction:a.faction,online:a.online,bCaptain:a.bCaptain},i)}}function m(e,t,n,i,a,r){for(var o={name:e,level:t,maxLife:i,life:n,faction:a,online:r,bCaptain:Player.instance.Name==I},s=0;s<k.length;s++){var l=k.getItemAt(s);if(l.name==e)return void k.replaceItemAt(o,s)}k.addItem(o)}function f(){if(null!=y){var t=y.width,n=y.height,i=(t-140)/2,a=n/3-73.5;null!=e.bossWarningImg&&(e.bossWarningImg.x=i-200,e.bossWarningImg.y=a,e.bossWarningImg.alpha=.01,e.bossWarningImg.visible=!0,e.bossWarningImg.source="ui/guild/arenaNum3.png"),egret.Tween.get(e.bossWarningImg).to({x:i,y:a,alpha:1},200,egret.Ease.circOut).to({alpha:.01},400,egret.Ease.sineIn).call(function(){null!=e.bossWarningImg&&(e.bossWarningImg.source="ui/guild/arenaNum2.png",e.bossWarningImg.x=i-200,e.bossWarningImg.y=a)}).to({x:i,y:a,alpha:1},200,egret.Ease.circOut).to({alpha:.01},400,egret.Ease.sineIn).call(function(){null!=e.bossWarningImg&&(e.bossWarningImg.source="ui/guild/arenaNum1.png",e.bossWarningImg.x=i-200,e.bossWarningImg.y=a)}).to({x:i,y:a,alpha:1},200,egret.Ease.circOut).to({alpha:.01},400,egret.Ease.sineIn).call(function(){null!=e.bossWarningImg&&(e.bossWarningImg.visible=!1)}).call(function(){if(null!=e.bossWarningImg){var i=(t-478)/2,a=n/3-89.5;e.bossWarningImg.source="ui/bigBg/bossLaile.png",e.bossWarningImg.x=i-200,e.bossWarningImg.y=a,e.bossWarningImg.visible=!0,egret.Tween.get(e.bossWarningImg).to({x:i,y:a,alpha:1},200,egret.Ease.circOut).to({alpha:.01},400,egret.Ease.sineIn).to({alpha:1},400,egret.Ease.sineIn).to({alpha:.01},400,egret.Ease.sineIn).to({alpha:1},400,egret.Ease.sineIn).to({alpha:.01},400,egret.Ease.sineIn).to({alpha:1},400,egret.Ease.sineIn).to({x:i+200,y:a,alpha:.01},400,egret.Ease.sineIn).call(function(){null!=e.bossWarningImg&&(e.bossWarningImg.visible=!1)})}})}}function v(e){switch(e.type){case 0:f()}}var y,b,S="shareboss",E="",C=0,T=0,I="",G=!1,A=null,k=new eui.ArrayCollection;e.load=t,e.OnSyncDynamicInfo=n,e.OnSyncBaseInfo=i,e.OnAward=a,e.Try2ReturnBattle=r,e.tryLeaveScene=u,e.OnSyncMemberInfo=d,e.BossWarning=f,e.OnCommonMsg=v}(shareboss||(shareboss={}));var Game;!function(e){e.EVENT={PlayerRevive:"PlayerRevive",PlayerDie:"PlayerDie",onPlayerInited:"onPlayerInited",LevelUp:"LevelUp",onChatReceived:"onChatReceived",onNewChatReceived:"onNewChatReceived",onNewChatClicked:"onNewChatClicked",AddItem:"AddItem",RemoveItem:"RemoveItem",DetailAttribute:"DetailAttribute",AbilityPoint:"AbilityPoint",UpdateItem:"UpdateItem",UpdateSkill:"UpdateSkill",UpdatePassiveSkill:"UpdatePassiveSkill",EnhanceSuccess:"EnhanceSuccess",EnhanceRequireChange:"EnhanceRequireChange",GuideReminder:"GuideReminder",GuideCompleted:"GuideCompleted",EquipsChange:"EquipsChange",BagEquipChanged:"BagEquipChanged",BooksChange:"BooksChange",UpdateSmeltingGoods:"UpdateSmeltingGoods",SmeltingRefreshCostChange:"SmeltingRefreshCostChange",CurrencyChange:["GoldCoinChange","SilverCoinChange","CopperCoinChange","PracticeChange","ArenaChange","ReadingChange","ZhenqiChange","ErrantryChange","PithChange","GuildContributionChange","JadeChange","BetCoinChange","BetScoreChange","FubiChange"],BagItemChange:"BagItemChange",BagFull:"BagFull",SyncSocial:"SyncSocial",SkillSlotChange:"SkillSlotChange",ActivityDegree:"ActivePoint",Login:"Login",SettingChange:"SettingChange",CumulativeLogin:"CumulativeLogin",ArenaChallenge:"ArenaChallenge",ArenaChallengeTimes:"ArenaChallengeTimes",GemChange:"GemChange",SyncGem:"SyncGem",MeridiansUpgrade:"MeridiansChange",MeridiansLevelUp:"MeridiansLevelUp",SyncMeridians:"SyncMeridians",MailNewArrival:"MailNewArrival",SeaSunData:"SeaSunData",SeasSunTask:"SeasSunTask",TaohuaIslandStatus:"TaohuaIslandStatus",UpgradeBook:"UpgradeBook",LevelUpBook:"LevelUpBook",GeneralRankChange:"GeneralRankChange",FactionTitleChange:"FactionTitleChange",CommonTitleChange:"CommonTitleChange",FactionTitleLevelUp:"FactionTitleLevelUp",PartnerDataChange:"PartnerDataChange",PartnerCountChange:"PartnerNumberChange",PartnerWorkPosChange:"PartnerWorkPosChange",PartnerRecruitCDSync:"PartnerRecruitCDSync",PartnerRecruitResult:"PartnerRecruitResult",SongjinEnrollResult:"SongjinEnrollResult",SongjinTaskData:"SongjinTaskData",FriendApply:"FriendApply",SyncFriends:"SyncFriends",SearchRoleResult:"SearchRoleResult",SelectPrivateChanel:"SelectPrivateChanel",SyncMysteryGoods:"SyncMysteryGoods",SyncMysterRefreshTimes:"SyncMysterRefreshTimes",SyncArenaRefreshTimes:"SyncArenaRefreshTimes",RemoveMysteryGoods:"RemoveMysteryGoods",SyncArenaGoods:"SyncArenaGoods",RemoveArenaGoods:"RemoveArenaGoods",GuildGarden:"GuildGarden",GuildGardenTiket:"GuildGardenTiket",GuildGardenAtlas:"GuildGardenAtlas",GuildGardenBoss:"GuildGardenBoss",SeaSunBuyTimeWithGoldConfirm:"SeaSunBuyTimeWithGoldConfirm",WildBossInfo:"WildBossInfo",EnterWildBossMap:"EnterWildBossMap",LittleBossInfo:"LittleBossInfo",SyncEncounter:"SyncEncounter",TenfoldExp:"TenfoldExp",OnlineGift:"OnlineGift",DailyMarkAward:"DailyMarkAward",DailyMarkResult:"DailyMarkResult",AccumMarkResult:"AccumMarkResult",OfflineTimeShow:"OfflineTimeShow",FeatureReminder:"FeatureReminder",UpdateVip:"UpdateVip",ChooseObtainRes:"ChooseObtainRes",SyncPartnerRecruitTimes:"SyncPartnerRecruitTimes",DungeonHallEnterRoom:"DungeonHallEnterRoom",DungeonHallQuitRoom:"DungeonHallQuitRoom",TimingCardChange:"TimingCardChange",OpeningGrouponRanklist:"OpengingGrouponRanklist",OpeningGrouponAmount:"OpengingGrouponAmount",OpeningGrouponStatus:"OpengingGrouponStatus",LoadingSuccess:"LoadingSuccess",LoadingFailed:"LoadingFailed",SyncMasterChallengeData:"SyncMasterChallengeData",RedPacketEmpty:"RedPacketEmpty",TaskRedPacketChange:"TaskRedPacketChange",HistoryRedPackets:"HistoryRedPackets",SwapSelectAlternate:"SwapSelectAlternate",SwapAttributeSuccess:"SwapAttributeSuccess",GuildWelcome:"GuildWelcome",GuildQuit:"GuildQuit",GuildPositionChange:"GuildPositionChange",SyncGuildInfo:"SyncGuildInfo",SyncGuildList:"SyncGuildList",SyncHuashanPKDegree:"SyncHuashanPKDegree",SyncPrizeWheel:"SyncPrizeWheel",NotifyPrizeWheelResult:"NotifyPrizeWheelResult",NotifyHolidayWheel:"NotifyHolidayWheel",NotifyOpeningWheel:"NotifyOpeningWheel",S2CRedPacketDetail:"S2CRedPacketDetail",HolidayWheelShopChance:"HolidayWheelShopChance",HolidayWheelShopResult:"HolidayWheelShopResult",HolidayWheelCurrencyChanged:"HolidayWheelCurrencyChanged",WeekendRecruit:"WeekendRecruit",WeekendRecruitSyncTimes:"WeekendRecruitSyncTimes",AvatarLevelChange:"AvatarLevelChange",AvatarChange:"AvatarChange",PartnerEquipSync:"PartnerEquipSync",PartnerEquipEnhanceSync:"PartnerEquipEnhanceSync",SyncGuildMemberList:"SyncGuildMemberList",RoleRenameEnableChange:"RoleRenameEnableChange",YesouTaskChanged:"YesouTaskChanged",OpeningWheelShopChance:"OpeningWheelShopChance",OpeningWheelShopResult:"OpeningWheelShopResult",OpeningWheelCurrencyChanged:"OpeningWheelCurrencyChanged",OpeningWheelOpen:"OpeningWheelOpen",GlobalExpBuffStatus:"GlobalExpBuffStatus",CrossServerBossStatusChanged:"CrossServerBossStatusChanged",SyncCrossServerBossStatus:"SyncCrossServerBossStatus",ListGoldCoinWareStatus:"ListGoldCoinWareStatus",WildBossOwnerChanged:"WildBossOwnerChanged",HolidayCommonHall:"HolidayCommonHall",RageSkillChange:"RageSkillChange",UpdateGuildSkillLevel:"UpdateGuildSkillLevel",UpdateUsingGuildSkill:"UpdateUsingGuildSkill",SelectGuildSkill:"SelectGuildSkill",GuildBusiTaskDataChange:"GuildBusiTaskDataChange",GuildShopDataChange:"GuildBusiTaskDataChange",GuildToastBegin:"GuildToastBegin",GuildToastEnd:"GuildToastEnd",GuildTrainingStateChanged:"GuildTrainingStateChanged",GuildWarInfoUpdate:"GuildWarInfoUpdate",GuildWarTokenChange:"GuildWarTokenChange",GuildWarSignInfo:"GuildWarSignInfo",ActivateGuildactivateskill:"ActivateGuildactivateskill",LeaveScene:"LevelScene",GuildWarMatchMemberCountChange:"GuildWarMatchMemberCountChange",GuildWarMatchMemberListChange:"GuildWarMatchMemberListChange",GuildWarMatchCityListChange:"GuildWarMatchCityListChange",GuildWarMatchTimeLineChange:"GuildWarMatchTimeLineChange",GuildWar2GuildListChange:"GuildWar2GuildListChange",GuildWar2GuideChange:"GuildWar2GuideChange",GuildWarTaskStart:"GuildWarTaskStart",GuildLevelUp:"GuildLevelUp",GoldCoinShopSync:"GoldCoinShopSync",QinMausoleumEntranceInfo:"QinMausoleumEntranceInfo",GuildWarTaskSceneTick:"GuildWarTaskSceneTick",GuildArmamentSyncArmsInfo:"GuildArmamentSyncArmsInfo",GuildArmamentSyncScoreInfo:"GuildArmamentSyncScoreInfo",GuildArmamentSyncRobHistory:"GuildArmamentSyncRobHistory",GuildArmamentSyncEffectiveBuffs:"GuildArmamentSyncEffectiveBuffs",GuildArmamentSyncCityState:"GuildArmamentSyncCityState",GuildArmamentSyncPlayerInfo:"GuildArmamentSyncPlayerInfo",DailyGiftInfo:"DailyGiftInfo",RankAwardDataChange:"RankAwardDataChange",AutoPlayChange:"AutoPlayChange",HeroicCardSingleUpdate:"HeroicCardSingleUpdate",HeroicCardAllUpdate:"HeroicCardAllUpdate",HeroicCardOpen:"HeroicCardOpen",FundingAward:"FundingAward",YanEmperorMyTeam:"YanEmperorMyTeam",YanEmperorSyncTeams:"YanEmperorSyncTeams",YanEmperorFloorInfo:"YanEmperorFloorInfo",YanEmperorApplication:"YanEmperorApplication",YanEmperorAwardCount:"YanEmperorAwardCount",VipPithChange:"VipPithChange",PushToBackground:"PushToBackground",BringToForeground:"BringToForeground",FirstChargeGift:"FirstChargeGift",OnRageChange:"OnRageChange",PartnerEquipSplitSelectItemChange:"PartnerEquipSplitSelectItemChange",ActivityConsumptionOpen:"ActivityConsumptionOpen",ActivityConsumptionStatus:"ActivityConsumptionStatus",ActivityTotalConsumption:"ActivityTotalConsumption",ActivityRechargeOpen:"ActivityRechargeOpen",ActivityRechargeStatus:"ActivityRechargeStatus",ActivityTotalRecharge:"ActivityTotalRecharge",BabelSyncSummaryInfo:"BabelSyncSummaryInfo",BabelSyncTeamInfo:"BabelSyncTeamInfo",CollectCardSyncCards:"CollectCardSyncCards",CollectCardSyncExp:"CollectCardSyncExp",CollectCardUpgradeStarSuccess:"CollectCardUpgradeStarSuccess",CollectCardUpgradeLevelSuccess:"CollectCardUpgradeLevelSuccess",CompositeGamesSevenDayGift:"CompositeGamesSevenDayGift",CompositeGrouponRanklist:"CompositeGrouponRanklist",CompositeGrouponAmount:"CompositeGrouponAmount",CompositeGrouponStatus:"CompositeGrouponStatus",NienBossSyncStage:"NienBossSyncStage",NienBossSyncRank:"NienBossSyncRank",NienBossSyncAward:"NienBossSyncAward",CityStatuaryInfoChange:"CityStatuaryInfoChange",WuxingyinGradeLevelup:"WuxingyinGradeLevelup",WuxingyinAttributeLevelup:"WuxingyinAttributeLevelup",WuxingshiActive:"WuxingshiActive",WuxingshiLevelup:"WuxingshiLevelup",WuxingshiEnchase:"WuxingshiEnchase",WuxingshiEnchaseSuit:"WuxingshiEnchaseSuit",WuxingshiSplit:"WuxingshiSplit",WuxingshiRestore:"WuxingshiRestore",WuxingyinBadge:"WuxingyinBadge",RefineDataChange:"RefineDataChange",RuneDataChange:"RuneDataChange",ConsignmentSyncTypeWareList:"ConsignmentSyncTypeWareList",ConsignmentSyncSpecificItemList:"ConsignmentSyncSpecificItemList",ConsignmentSyncSellerInfo:"ConsignmentSyncSellerInfo",ConsignmentSyncSellerMoney:"ConsignmentSyncSellerMoney",ConsignmentConsign:"ConsignmentConsign",ConsignmentItemChange:"ConsignmentItemChange",PartnerQingyiOptLoad:"PartnerQingyiOptLoad",PartnerQingyiOptUnlockGroup:"PartnerQingyiOptUnlockGroup",PartnerQingyiOptUpdateQingyiValue:"PartnerQingyiOptUpdateQingyiValue",PartnerQingyiOptSkillLevelup:"PartnerQingyiOptSkillLevelup",PartnerQingyiOptPartnerDataChange:"PartnerQingyiOptPartnerDataChange",MonthlyActUpdateTarget:"MonthlyActUpdateTarget",MonthlyActUpdateCounterTask:"MonthlyActUpdateCounterTask",ActivityFlashSaleOpen:"ActivityFlashSaleOpen",ActivityFlashSaleAmount:"ActivityFlashSaleAmount",ActivityFlashSaleStatus:"ActivityFlashSaleStatus",LevelUpGiftOpen:"LevelUpGiftOpen",OnSyncOpenningWheelFreeTimes:"OnSyncOpenningWheelFreeTimes",LevelUpGiftChange:"LevelUpGiftChange",CollectTreasureOpen:"CollectTreasureOpen",CollectTreasureDataChanged:"CollectTreasureAmountChanged",CollectTreasureRankList:"CollectTreasureRankList",DailyRechargeSyncState:"DailyRechargeSyncState",DailyRechargeGold:"DailyRechargeGold",Recharge7DayOpen:"Recharge7DayOpen",Recharge7DayGold:"Recharge7DayGold",Recharge7DaySyncState:"Recharge7DaySyncState",ActivityBetOpen:"ActivityBetOpen",BetDataChange:"BetDataChange",BetClientDataChange:"BetClientDataChange",BetShopDataChange:"BetShopDataChange",FlopAwardChange:"FlopAwardChange",ActivityLotteryTicket:"ActivityLotteryTicket",ActivityLotterySyncInfo:"ActivityLotterySyncInfo",ActivityLotteryClearSelected:"ActivityLotteryClearSelected",FortunePlanDataChange:"FortunePlanDataChange",FortunePlanActivityOpen:"FortunePlanActivityOpen",PersonalMatchStatus:"PersonalMatchStatus",PersonalMatchRank:"PersonalMatchRank",PersonalMatchDamageChange:"PersonalMatchDamageChange",FoursymbolsSyncTask:"FoursymbolsSyncTask",FoursymbolsSyncRecord:"FoursymbolsSyncRecord",FoursymbolsSyncFastest:"FoursymbolsSyncFastest",HalfYearDrawOpen:"HalfYearDrawOpen",HalfYearDrawSycnInfo:"HalfYearDrawOpen",OnClickAwardPageClose:"OnClickAwardPageClose",OnDungeonGroupChangeLeader:"OnDungeonGroupChangeLeader",DGroupInviteSelectAll:"DGroupInviteSelectAll",DGroupInviteUnSelectAll:"DGroupInviteUnSelectAll",HalfYearDrawChanceResult:"HalfYearDrawChanceResult",OnUpdateFp:"OnUpdateFp",JueXueChange:"JueXueChange",ItemSplitChange:"ItemSplitChange",ActivityLoginGift:"ActivityLoginGift",LoginGiftLogin:"LoginGiftLogin",ActivityGrouponBuy:"ActivityGrouponBuy",GrouponBuyRanklist:"GrouponBuyRanklist",GrouponBuyAmount:"GrouponBuyAmount",GrouponBuyStatus:"GrouponBuyStatus",RecruitResult:"RecruitResult",ActivityBuyRefund:"ActivityBuyRefund",ActivityLuckyWheel:"ActivityLuckyWheel",SyncActivityLuckyWheel:"SyncActivityLuckyWheel",ActivityLuckyWheelResult:"ActivityLuckyWheelResult",ActivityJxBook15:"ActivityJxBook15",WenShiChange:"WenShiChange",WenShiSyncUpgrade:"WenShiSyncUpgrade",WenShiSyncBreakThrough:"WenShiSyncBreakThrough",WenShiSplitSelectItemChange:"WenShiSplitSelectItemChange",ActivitySmashEggs:"ActivitySmashEggs",ActivitySmashEggsAward:"ActivitySmashEggsAward",ActivitySmashEggsRefresh:"ActivitySmashEggsRefresh",ActivityDoubleEggs:"ActivityDoubleEggs",ActivityTreasureBowl:"ActivityTreasureBowl",ActivityTreasureBowlAward:"ActivityTreasureBowlAward",ActivityTreasureBowlItem:"ActivityTreasureBowlItem",ActivityGlobalWheel:"ActivityGlobalWheel",ActivityGlobalWheelLottery:"ActivityGlobalWheelLottery",ActivityGlobalLuckWheel:"ActivityGlobalLuckWheel",ActivityGlobalLuckWheelLottery:"ActivityGlobalLuckWheelLottery"},e.dispatcher=new egret.EventDispatcher}(Game||(Game={}));var ECS;!function(e){var t=function(){function e(){}return e.prototype.destory=function(){this.gameobject=null},e}();e.Component=t,__reflect(t.prototype,"ECS.Component");var n=function(){function e(){this.recycler=new egret.Recycler}return e.prototype.generate=function(e){var t=this.recycler.pop();return t||(t=new e),t},e.prototype.recycle=function(e){this.recycler.push(e)},e}();e.Pool=n,__reflect(n.prototype,"ECS.Pool");var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.generate=function(e,n){var i=this.pool.generate(t);return i.time=e,i.gameobject=n,i},t.prototype.start=function(){this.timer=egret.setTimeout(this.onTimeout,this,this.time)},t.prototype.name=function(){return"TimeoutComponent"},t.prototype.onTimeout=function(){this.timer=null,this.onHandle&&this.onHandle()},t.prototype.destory=function(){e.prototype.destory.call(this),this.timer&&(egret.clearTimeout(this.timer),this.timer=null),this.onHandle=null,t.pool.recycle(this)},t.pool=new n,t}(t);e.TimeoutComponent=i,__reflect(i.prototype,"ECS.TimeoutComponent");var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.generate=function(e,n){var i=this.pool.generate(t);return i.time=e,i.gameobject=n,i},t.prototype.start=function(){this.timer=egret.setTimeout(this.onTime,this,this.time)},t.prototype.name=function(){return"LifeTimeComponent"},t.prototype.onTime=function(){this.timer=null;var e=this.gameobject;e.destory()},t.prototype.destory=function(){e.prototype.destory.call(this),this.timer&&(egret.clearTimeout(this.timer),this.timer=null),t.pool.recycle(this)},t.pool=new n,t}(t);e.LifeTimeComponent=a,__reflect(a.prototype,"ECS.LifeTimeComponent");var r=function(){function e(){e.lastId++,this.id=e.lastId,this.components=egret.createMap()}return e.generate=function(){var t=this.pool.generate(e);return t.id||(e.lastId++,t.id=e.lastId),t},e.prototype.start=function(){for(var e in this.components){var t=this.components[e];t.start&&t.start()}},e.prototype.addComponent=function(e){this.components[e.name()]=e,this.world&&e.start&&e.start()},e.prototype.getComponent=function(e){return this.components[e]},e.prototype.destory=function(){this.world&&this.world.remove(this.id),this.onDestory&&(this.onDestory(),this.onDestory=null),this.world=null;for(var t in this.components)this.components[t].destory();this.components=egret.createMap(),this.id=null,e.pool.recycle(this)},e.lastId=0,e.pool=new n,e}();e.GameObject=r,__reflect(r.prototype,"ECS.GameObject");var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.generate=function(e,n){var i=this.pool.generate(t);return i.gameobject=n,i.container||(i.container=new egret.DisplayObjectContainer),e?(i.onTouchTap=e,i.container.touchEnabled=!0,i.container.touchChildren=!0):(i.container.touchEnabled=!1,i.container.touchChildren=!1),i},t.prototype.name=function(){return"DisplayContainerComponent"},t.prototype.start=function(){this.onTouchTap&&this.container.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this)},t.prototype.destory=function(){e.prototype.destory.call(this),this.container.x=0,this.container.y=0,this.container.scaleX=1,this.container.scaleY=1,this.container.rotation=0,this.container.width=0,this.container.height=0,Game.removeFromParent.apply(this.container),this.container.removeChildren(),this.onTouchTap&&(this.container.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),this.onTouchTap=null)},t.prototype.addChild=function(e){this.container.addChild(e)},t.prototype.addChildAt=function(e,t){this.container.addChildAt(e,t)},t.prototype.removeChild=function(e){this.container.removeChild(e)},Object.defineProperty(t.prototype,"touchEnabled",{set:function(e){this.container.touchEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"touchChildren",{set:function(e){this.container.touchChildren=e},enumerable:!0,configurable:!0}),t.pool=new n,t}(t);e.DisplayContainerComponent=o,__reflect(o.prototype,"ECS.DisplayContainerComponent");var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.generate=function(e,n,i,a){var r=this.pool.generate(t);return r.gameobject=a,r.texts=e,r.x=n,r.y=i,r},t.prototype.name=function(){return"SpeechBubbleComponent"},t.prototype.start=function(){this.timer=egret.setTimeout(this.loop,this,2*Math.random()*Game.Second+2*Game.Second)},t.prototype.destory=function(){e.prototype.destory.call(this),this.timer&&(egret.clearTimeout(this.timer),this.timer=null),this.texts=null,this.x=0,this.y=0,this.dialogue&&Game.removeFromParent.apply(this.dialogue)},t.prototype.loop=function(){var e=Math.round(Math.random()*(this.texts.length-1)),t=this.gameobject.getComponent("DisplayContainerComponent");null==this.dialogue||null==this.dialogue.parent?(this.say(this.texts[e]),t&&t.addChildAt(this.dialogue,1)):null!=this.dialogue&&t&&t.removeChild(this.dialogue),this.timer=egret.setTimeout(this.loop,this,2*Math.random()*Game.Second+8*Game.Second)},t.prototype.say=function(e){this.dialogue||(this.dialogue=new UI.SpeechBubble,this.dialogue.x=this.x+20,this.dialogue.y=this.y-50),this.dialogue.setText(e)},t.pool=new n,t}(t);e.SpeechBubbleComponent=s,__reflect(s.prototype,"ECS.SpeechBubbleComponent");var l=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.generate=function(e,t,n){var a=this.pool.generate(i);a.gameobject=n;var r=t.name;if(a.id=e,a.info=t,r){a.head||(a.head=new UI.ActorHead),a.head.roleName=r,a.head.updateRoleNameColor(16777215),a.head.hideLifeBar();var o=table.actor[t.resource];o&&(a.head.y=-table.actor[t.resource].head)}return this.objs[e]=a,a},i.prototype.name=function(){return"SceneObjectComponent"},i.prototype.start=function(){var e=this.gameobject.getComponent("DisplayContainerComponent");e&&this.info.name&&e.addChild(this.head)},i.prototype.changeStatus=function(e){if(this.info.status){var t=this.info.status[e],n=this.gameobject.getComponent("DragonBoneRenderer");n&&n.play(t)}},i.prototype.update=function(){var e=this.gameobject.getComponent("DisplayContainerComponent");if(e){var t=e.container;AI.bb.touchObj==this.id?t.addChildAt(Actor.selected,0):t==Actor.selected.parent&&t.removeChild(Actor.selected)}},i.prototype.destory=function(){t.prototype.destory.call(this),delete i.objs[this.id],this.id=null,this.x=null,this.y=null,this.info=null,this.head&&this.head.destory(),this.statusObject&&this.statusObject.destory(),i.pool.recycle(this)},i.prototype.touch=function(){var e=this.id;if(null!=this.info.operationId)return void Operation.open(this.info.operationId);var t=new net.def.C2STouchOjb;t.id=e,net.socket.write(46,t.toArrayBuffer())},Object.defineProperty(i.prototype,"mark",{set:function(t){var n=this;if(t){if(this.statusObject)return;this.statusObject=r.generate();var i=h.generate("skill/wenhao_map/wenhao_map.json","wenhao_map",this.statusObject),a=-10;this.head.parent&&(a=this.head.y-50),i.onloaded=function(){var e=n.gameobject.getComponent("DisplayContainerComponent");e&&(i.movieClip.y=a,e.addChild(i.movieClip))},this.statusObject.addComponent(i),this.statusObject.onDestory=function(){n.statusObject=null},e.world.add(this.statusObject)}else this.statusObject&&this.statusObject.destory()},enumerable:!0,configurable:!0}),i.objs=egret.createMap(),i.pool=new n,i}(t);e.SceneObjectComponent=l,__reflect(l.prototype,"ECS.SceneObjectComponent");var u=function(e){function t(){var t=e.call(this)||this;return t.clear(),t}return __extends(t,e),t.prototype.clear=function(){this.x=0,this.y=0,this.z=0,this.scaleX=1,this.scaleY=1,this.rotation=0},t.generate=function(e){var n=this.pool.generate(t);return n.gameobject=e,n},t.prototype.name=function(){return"Transform"},t.prototype.destory=function(){e.prototype.destory.call(this),this.clear(),t.pool.recycle(this)},t.pool=new n,t}(t);e.Transform=u,__reflect(u.prototype,"ECS.Transform");var c=function(){function e(){this.gameobjects=egret.createMap()}return e.prototype.add=function(e){e.world=this,this.gameobjects[e.id]=e,e.start()},e.prototype.remove=function(e){delete this.gameobjects[e]},e.prototype.clear=function(){for(var e in this.gameobjects){var t=this.gameobjects[e];t.destory()}},e}();e.World=c,__reflect(c.prototype,"ECS.World"),e.world=new c;var h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.generate=function(e,n,i){var a=this.pool.generate(t);return a.url=e,a.gameobject=i,a.animationName=n,a},t.prototype.name=function(){return"MovieClipRenderer"},t.prototype.start=function(){var e=this;this.loader?this.loader.release():this.loader=new RES.Loader;var t=this.animationName,n=this.url;this.loader.get(n,function(i){if(e.onloaded){var a=(e.gameobject,i.generateMovieClipData(t)),r=e.movieClip;r?r.movieClipData=a:(r=new egret.MovieClip(a),e.movieClip=r),r.blendMode=table.blendMode[n],r.play(-1);var o=e.gameobject.getComponent("Transform");o&&(r.x=o.x,r.y=o.y/GameMap.ratioY,r.scaleX*=o.scaleX,r.scaleY*=o.scaleY,r.rotation+=o.rotation),e.onloaded()}})},t.prototype.destory=function(){e.prototype.destory.call(this);var n=this.movieClip;n&&(n.x=0,n.y=0,n.scaleX=1,n.scaleY=1,n.rotation=0,Game.removeFromParent.apply(n),n.movieClipData=null),this.loader&&this.loader.release(),this.url=null,this.onloaded=null,this.animationName=null,t.pool.recycle(this)},t.pool=new n,t}(t);e.MovieClipRenderer=h,__reflect(h.prototype,"ECS.MovieClipRenderer");var d=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.generate=function(e,t,n){var a=this.pool.generate(i);return a.resource=e,a.gameobject=n,a.dir=t,a},i.prototype.name=function(){return"SkillMovieClipRenderer"},i.prototype.start=function(){var t=this;this.loader?this.loader.release():this.loader=new RES.Loader;var n=this.resource,i=this.dir,a=Skill.getUrlByDir(n,i),r=egret.getTimer();this.loader.get(a.url,function(i){if(t.onloaded){var o=egret.getTimer()-r,s=t.gameobject,l=i.generateMovieClipData(n),u=s.getComponent("LifeTimeComponent");if(!u){var c=l.numFrames*Game.Second/l.frameRate;if(o>=c)return void s.destory();var h=e.LifeTimeComponent.generate(c-o,s);s.addComponent(h)}var d=t.movieClip;d?d.movieClipData=l:(d=new egret.MovieClip(l),t.movieClip=d);var p=Math.round(o*l.frameRate/Game.Second)%l.numFrames;d.gotoAndPlay(p+1,-1),d.blendMode=a.blendMode,d.scaleX=a.scaleX;var g=t.gameobject.getComponent("Transform");a.rotatable&&(d.rotation=g_LogicDir2DisplayAngle[t.dir]),g&&(d.x=g.x,d.y=g.y/GameMap.ratioY,d.scaleX*=g.scaleX,d.scaleY*=g.scaleY,d.rotation+=g.rotation),t.onloaded()}})},i.prototype.destory=function(){t.prototype.destory.call(this);var e=this.movieClip;e&&(e.x=0,e.y=0,e.scaleX=1,e.scaleY=1,e.rotation=0,Game.removeFromParent.apply(e),e.movieClipData=null),this.loader&&this.loader.release(),this.resource=null,this.onloaded=null,i.pool.recycle(this)},i.pool=new n,i}(t);e.SkillMovieClipRenderer=d,__reflect(d.prototype,"ECS.SkillMovieClipRenderer");var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.generate=function(e,n){var i=this.pool.generate(t);return i.resource=e,i.gameobject=n,i.gotoTime=0,i},t.prototype.name=function(){return"DragonBoneRenderer"},t.prototype.start=function(){var e=this;this.loader?this.loader.release():this.loader=new RES.Loader;var t=this.resource;
this.loader.get("dbbin/"+t+"/"+t+"_ske.dbbin",function(n){if(e.onloaded){e.armatureDisplay=n.buildArmatureDisplay("Armature",t);var i=e.gameobject.getComponent("Transform");i&&(e.armatureDisplay.x=i.x,e.armatureDisplay.y=i.y/GameMap.ratioY,e.armatureDisplay.scaleX=i.scaleX,e.armatureDisplay.scaleY=i.scaleY,e.armatureDisplay.rotation=i.rotation),e.onloaded(),e.gotoTime>0?e.armatureDisplay.animation.gotoAndPlayByTime(e.animationName,e.gotoTime,e.playTimes):e.armatureDisplay.animation.play(e.animationName,e.playTimes)}})},t.prototype.lastAnimationName=function(){return this.armatureDisplay?this.armatureDisplay.animation.lastAnimationName:void 0},t.prototype.play=function(e,t){this.animationName=e,t&&(this.playTimes=t),this.armatureDisplay&&this.armatureDisplay.animation.play(this.animationName,this.playTimes)},t.prototype.destory=function(){e.prototype.destory.call(this),this.armatureDisplay&&(Game.removeFromParent.apply(this.armatureDisplay),this.armatureDisplay.dispose(),this.armatureDisplay=null),this.loader&&this.loader.release(),this.resource=null,this.animationName=null,this.playTimes=null,this.onloaded=null,t.pool.recycle(this)},t.pool=new n,t}(t);e.DragonBoneRenderer=p,__reflect(p.prototype,"ECS.DragonBoneRenderer")}(ECS||(ECS={}));var Game;!function(e){function t(e){for(var t=a.length,n=0;t>n;n++){var i=a[n][0],r=a[n][1];e=e.replace(i,r)}return e}function n(e){for(var t=r.length,n=0;t>n;n++){var i=r[n][0],a=r[n][1];e=e.replace(i,a)}return e}var i;!function(e){e[e.Text=0]="Text",e[e.Image=1]="Image",e[e.Equip=2]="Equip",e[e.Item=3]="Item",e[e.Book=4]="Book",e[e.Team=5]="Team",e[e.Operation=6]="Operation",e[e.RedPacket=7]="RedPacket",e[e.Award=8]="Award",e[e.Training=9]="Training",e[e.Player=10]="Player",e[e.PartnerEquip=11]="PartnerEquip",e[e.DungeonGroup=12]="DungeonGroup",e[e.JueXue=13]="JueXue"}(i=e.TextElementKind||(e.TextElementKind={}));var a=[[new RegExp("<","g"),"&lt;"],[new RegExp(">","g"),"&gt;"],[new RegExp('"',"g"),"&quot;"],[new RegExp("'","g"),"&apos;"]],r=[[new RegExp("&lt;","g"),"<"],[new RegExp("&gt;","g"),">"],[new RegExp("&quot;","g"),'"'],[new RegExp("&apos;","g"),"'"]];e.Escape=t,e.Unescape=n;var o=14,s="Tahoma",l=function(){function t(){this.resutlArr=[]}return t.prototype.parse=function(e,t){try{this.stackArray=[],this.resutlArr=[],this.textlength=0,this.textlengthidx=0,this.attachments=t;for(var n=0,i=e.length;i>n;){var a=e.indexOf("<",n);if(0>a)this.addToResultArr(e.substring(n)),n=i;else{this.addToResultArr(e.substring(n,a));var r=e.indexOf(">",a);-1==r?(egret.$error(1038),r=a):"/"==e.charAt(a+1)?this.stackArray.pop():"/"==e.charAt(r-1)?this.ChangeToResultArr(e.substring(a+1,r-1)):this.addToArray(e.substring(a+1,r)),n=r+1}}return this.resutlArr}catch(o){return[]}},t.prototype.measureElement=function(e){var t=!1,n=o,i=!1,a=s;return e.style&&(t=e.style.bold||t,n=e.style.size||n,i=e.style.italic||i,a=e.style.fontFamily||a),egret.sys.measureText(e.text,a,n,t,i)},t.prototype.addToResultArr=function(e){""!=e&&(e=n(e),this.stackArray.length>0?this.resutlArr.push({text:e,style:this.stackArray[this.stackArray.length-1],kind:i.Text}):this.resutlArr.push({text:e,kind:i.Text}))},t.prototype.ChangeToResultArr=function(e){if(""!=e){var t,n=[];switch(e){case"brother":t=this.processBrother(e);break;default:if(n=e.match(/^(equipName|npcName|commontitleName|dungeongroup|item|equip|book|img|team|op|redpacket|prizewheel|goldCoin|silverCoin|training|player|partnerEquip|juexue|dolls)=/))switch(n[1]){case"equipName":t=this.processEquipName(e.substring(n[0].length).trim());break;case"npcName":t=this.processNpcName(e.substring(n[0].length).trim());break;case"commontitleName":t=this.processCommonTitleName(e.substring(n[0].length).trim());break;case"item":t=this.processItem(e.substring(n[0].length).trim());break;case"equip":t=this.processEquip(e.substring(n[0].length).trim());break;case"book":t=this.processBook(e.substring(n[0].length).trim());break;case"img":t=this.processImg(e.substring(n[0].length).trim());break;case"team":t=this.processTeam(e.substring(n[0].length).trim());break;case"dungeongroup":t=this.processDungeonGroup(e.substring(n[0].length).trim());break;case"op":t=this.processOp(e.substring(n[0].length).trim());break;case"redpacket":t=this.processRedpacket(e.substring(n[0].length).trim());break;case"prizewheel":t=this.processPrizewheel(e.substring(n[0].length).trim());break;case"goldCoin":t=this.processCurrency("goldCoin",e.substring(n[0].length).trim());break;case"silverCoin":t=this.processCurrency("silverCoin",e.substring(n[0].length).trim());break;case"training":t=this.processTraining(e.substring(n[0].length).trim());break;case"player":t=this.processPlayer(e.substring(n[0].length).trim());break;case"partnerEquip":t=this.processPartnerEquip(e.substring(n[0].length).trim());break;case"juexue":t=this.processJueXue(e.substring(n[0].length).trim());break;case"dolls":t=this.processDolls(e.substring(n[0].length).trim())}}null!=t&&this.resutlArr.push(t)}},t.prototype.processCurrency=function(e,t){var n=parseInt(t);if(isNaN(n))return null;var a=new table.CurrencyAward(e,n);return{text:"<"+a.name+">*"+a.content,style:{textColor:Item.QualityColor[a.quality],size:o},kind:i.Award,value:a}},t.prototype.processDolls=function(e){return{text:""+lang.String(e),style:this.stackArray[this.stackArray.length-1],kind:i.Text}},t.prototype.measure=function(){for(var e=this.resutlArr.length;this.textlengthidx<e;this.textlengthidx++)this.textlength+=this.measureElement(this.resutlArr[this.textlengthidx]);return this.textlength},t.prototype.processPrizewheel=function(e){var t=parseInt(e);if(isNaN(t))return null;var n=PrizeWheel.prizes[t];switch(n.type){case"item":var a=new Item.Prop;a.Genre=n.content.genre,a.DetailType=n.content.detailType,a.Count=n.content.count;var r=a.rawName,s=a.Quality,l=Item.QualityColor[s];return{text:"<"+r+">*"+a.Count,style:{textColor:l,size:o},kind:i.Item,value:a};case"silverCoin":case"copperCoin":var u=new table.CurrencyAward(n.type,n.content);return{text:"<"+u.name+">*"+n.content,style:{textColor:Item.QualityColor[u.quality],size:o},kind:i.Award,value:u}}},t.prototype.processRedpacket=function(e){return{text:lang.String("redpacket"),style:{textColor:16724736,size:o},kind:i.RedPacket,value:dcodeIO.ByteBuffer.fromHex(e)}},t.prototype.processBrother=function(e){return table.faction[PlayerAttribute.faction].gender?{text:lang.String("BigFactionBrother"),style:this.stackArray[this.stackArray.length-1],kind:i.Text}:{text:lang.String("BigFactionSister"),style:this.stackArray[this.stackArray.length-1],kind:i.Text}},t.prototype.processOp=function(e){var t=e.split(","),n=parseInt(t[0]),a=t[1],r=n==Operation.Type.GuildBusiTaskHelp||n==Operation.Type.YesouWorship;return{text:a,style:{textColor:color.BLUE,size:o,underline:r},kind:i.Operation,value:n,param:t[2]}},t.prototype.processTraining=function(e){var t=e.split(","),n=String(t[0]),a=String(t[1]);return{text:"<"+a+">",style:{textColor:color.ChatChannelNear,size:o},kind:i.Training,value:{inviter:n}}},t.prototype.processPlayer=function(e){return{text:e,style:{textColor:color.BLUE,size:o},kind:i.Player}},t.prototype.processDungeonGroup=function(e){var t=e.split(","),n=String(t[0]),a=Number(t[1]),r=Number(t[2]),s=Number(t[3]),l=Number(t[4]),u=lang.StringWithFormat("dgroup to {1} , click to join",DungeonGroup.dungeonInfo[r].name);return 0==s&&DungeonGroup.OnNewInvite(a,r,n,1,s,l),{text:"<"+u+">",style:{textColor:color.YELLOW,size:o},kind:i.DungeonGroup,value:{target:a,type:r}}},t.prototype.processTeam=function(e){var t=e.split(","),n=String(t[0]),a=Number(t[1]),r=Number(t[2])+egret.getTimer(),s=Number(t[3]),l=DungeonHallMgr.Targets[a],u=lang.StringWithFormat("{1} team invite",l);return{text:"<"+u+">",style:{textColor:color.ChatWarning,size:o},kind:i.Team,value:{inviter:n,endTime:r,roomId:s,target:a}}},t.prototype.processImg=function(e){var t="Input/"+e+".png",n=new eui.Image(t);return n.x=Math.ceil(this.measure()),n.y=0,n.scaleX=.5,n.scaleY=.5,{text:"      ",style:{size:14},value:n,kind:i.Image}},t.prototype.processJueXue=function(e){var t=parseInt(e),n=this.attachments;if(null!=n){var a=n.juexues;if(null!=a&&null!=a[t]){var r=new Item.JueXue;r.Init(a[t]);var s="["+r.name+"]",l=Item.QualityColor[r.Quality];return{text:s,style:{textColor:l,size:o},kind:i.JueXue,value:{item:r,juexues:PlayerAttribute.juexues}}}}},t.prototype.processPartnerEquip=function(e){var t=parseInt(e),n=this.attachments;if(null!=n){var a=n.partnerEquips;if(null!=a&&null!=a[t]){var r=new Item.PartnerEquip(a[t].id,a[t].star),s=PartnerEquipManager.GetPartnerEquipInfo(a[t].id),l="["+s.name+"]",u=Item.QualityColor[s.quality];return{text:l,style:{textColor:u,size:o},kind:i.PartnerEquip,value:r}}}},t.prototype.processBook=function(e){var t=parseInt(e),n=this.attachments;if(null!=n){var a=n.books;if(null!=a&&null!=a[t]){var r=new Item.Book(a[t]),s="["+r.name+"]",l=r.Quality,u=Item.QualityColor[l];return{text:s,style:{textColor:u,size:o},kind:i.Book,value:r}}}},t.prototype.processEquip=function(e){var t=parseInt(e),n=this.attachments;if(null!=n){var a=n.equips;if(null!=a&&null!=a[t]){var r=new Item.Equip(a[t],PlayerAttribute.faction),s=Item.QualityColor[r.Quality];return{text:"["+r.rawName+"]",style:{textColor:s,size:o},kind:i.Equip,value:r}}}},t.prototype.processItem=function(e){var t=parseInt(e),n=this.attachments;if(null!=n){var a=n.items;if(null!=a){var r=a[t];if(null!=r){var s=new Item.Prop;s.Genre=r.type,s.DetailType=r.detailType,s.ExpireTime=r.expireTime,s.Count=r.count;var l=s.rawName,u=s.Quality,c=Item.QualityColor[u];return{text:"["+l+"]*"+r.count,style:{textColor:c,size:o},kind:i.Item,value:s}}}}},t.prototype.processCommonTitleName=function(e){var t=parseInt(e);if(!isNaN(t)){var n=CommonTitle.titles[t];if(null!=n)return{text:n.info.name,kind:i.Text,style:{textColor:45136}}}},t.prototype.processNpcName=function(t){var n=parseInt(t);if(!isNaN(n)){var a=table.npcs[n];if(null!=a){var r=this.stackArray[this.stackArray.length-1];if(null==r){var o=color.WHITE;switch(a.grade){case e.NpcGrade.BLUE:o=color.EnemyBule;break;case e.NpcGrade.PURPLE:o=color.EnemyPurple;break;case e.NpcGrade.RED:o=color.EnemyRed}return{text:a.name,style:{textColor:o},kind:i.Text}}return{text:a.name,style:r,kind:i.Text}}}},t.prototype.processEquipName=function(t){var n=t.split(","),a=parseInt(n[0]),r=parseInt(n[1]),o=e.Faction[parseInt(n[2])];if(!(0>a||a>=e.EquipPart.EquipCount)){var s=table.equips[a][r];if(null!=s){var l=s[o];if(null!=l)return this.stackArray.length>0?{text:l.name,style:this.stackArray[this.stackArray.length-1],kind:i.Text}:{text:l.name,kind:i.Text}}}},t.prototype.changeStringToObject=function(e){e=e.trim();var t={},n=[];if("i"==e.charAt(0)||"b"==e.charAt(0)||"u"==e.charAt(0))this.addProperty(t,e,"true");else if(n=e.match(/^(font|a)\s/)){e=e.substring(n[0].length).trim();for(var i=0,a=void 0;a=e.match(this.getHeadReg());){var r=a[0],o="";e=e.substring(r.length).trim(),'"'==e.charAt(0)?(i=e.indexOf('"',1),o=e.substring(1,i),i+=1):"'"==e.charAt(0)?(i=e.indexOf("'",1),o=e.substring(1,i),i+=1):(o=e.match(/(\S)+/)[0],i=o.length),this.addProperty(t,r.substring(0,r.length-1).trim(),o.trim()),e=e.substring(i).trim()}}return t},t.prototype.getHeadReg=function(){return/^(color|textcolor|strokecolor|stroke|b|bold|i|italic|u|size|fontfamily|href|target)(\s)*=/},t.prototype.addProperty=function(e,t,i){switch(t.toLowerCase()){case"color":case"textcolor":i=i.replace(/#/,"0x"),e.textColor=parseInt(i);break;case"strokecolor":i=i.replace(/#/,"0x"),e.strokeColor=parseInt(i);break;case"stroke":e.stroke=parseInt(i);break;case"b":case"bold":e.bold="true"==i;break;case"u":e.underline="true"==i;break;case"i":case"italic":e.italic="true"==i;break;case"size":e.size=parseInt(i);break;case"fontfamily":e.fontFamily=i;break;case"href":e.href=n(i);break;case"target":e.target=n(i)}},t.prototype.addToArray=function(e){var t=this.changeStringToObject(e);if(0==this.stackArray.length)this.stackArray.push(t);else{var n=this.stackArray[this.stackArray.length-1];for(var i in n)null==t[i]&&(t[i]=n[i]);this.stackArray.push(t)}},t}();__reflect(l.prototype,"GameTextParser"),e.TextParser=new l}(Game||(Game={}));var turnTimer,SecondTicker=new Ticker(1e3),GameTick;!function(e){function t(){u=new egret.Timer(Game.MSPF,0),u.addEventListener(egret.TimerEvent.TIMER,l,null),turnTimer=new egret.Timer(100,0),turnTimer.addEventListener(egret.TimerEvent.TIMER,function(){if(net.socket.connected){AI.update(),PartnerNpcManager.updateAI();for(var e in ECS.SceneObjectComponent.objs){var t=ECS.SceneObjectComponent.objs[e];t.update()}net.socket.flush()}},null)}function n(){var e=egret.getTimer();c=e,u.running||u.start(),turnTimer.start(),SecondTicker.start()}function i(e,t,n,i){return u.addEventListener(egret.TimerEvent.TIMER,e,t,n,i)}function a(e,t,n){u.removeEventListener(egret.TimerEvent.TIMER,e,t,n)}function r(){SecondTicker.stop(),null!=turnTimer&&turnTimer.stop(),null!=u&&u.stop()}function o(){return u&&u.running}function s(){var e=egret.getTimer();return e-c>=60*Game.Second?(net.socket.connected&&(egret.warn("[GameTick] now - nextGameTick="+(e-c)),net.socket.recconnect()),!0):!1}function l(){var e=egret.getTimer();if(e-c>=60*Game.Second)return net.socket.connected&&(egret.warn("[GameTick] now - nextGameTick="+(e-c)),net.socket.recconnect()),void(c=e);if(!net.socket.connected)return void(c=e);if(Scene.isReady()){var t=e-c,n=~~(t/Game.MSPF);0==n&&(n=1),0>=n&&egret.error("[GameTick] [ERROR] now, before, deltaTime, deltaFrame: ",e,c,t,n);for(var i in mapCharacter)mapCharacter[i].update(t);PlayerAttribute.generateRage(n),PartnerNpcManager.update(t),Scene.focus(t),c=e}}var u;e.init=t,e.start=n,e.addEventListener=i,e.removeEventListener=a,e.stop=r;var c;e.running=o,e.checkTimeout=s}(GameTick||(GameTick={}));var KeyBoardSystem;!function(e){function t(e){o.push(e)}function n(){o.pop()}function i(){o=[],s=new KeyBoard,s.addEventListener(KeyBoard.onkeydown,r,null),Game.dispatcher.addEventListener(Game.EVENT.onPlayerInited,a,null),Game.dispatcher.addEventListener(Game.EVENT.SkillSlotChange,a,null),Game.dispatcher.addEventListener(Game.EVENT.RageSkillChange,a,null)}function a(){e.key2PlayerSkill[KeyBoard.key_1]=PlayerAttribute.skillSlots[0].id,e.key2PlayerSkill[KeyBoard.key_2]=PlayerAttribute.skillSlots[1].id,e.key2PlayerSkill[KeyBoard.key_3]=PlayerAttribute.skillSlots[2].id,e.key2PlayerSkill[KeyBoard.key_4]=PlayerAttribute.getRageSkillId(),e.key2PlayerSkill[KeyBoard.key_5]=PlayerAttribute.skills[0].Id}function r(t){var n=t.data.join("+"),i=o[o.length-1];if(i)return i.onKeyDown(n);var a=Player.instance;if(a)switch(n){case KeyBoard.left_Ctrl+"+"+KeyBoard.Z:Setting.ChangeAutoPlay(!Setting.auto);break;default:if(e.key2PlayerSkill[n])return void a.tryCastSkill(e.key2PlayerSkill[n])}}var o;e.focus=t,e.restore=n,e.key2PlayerSkill=egret.createMap();var s;e.init=i}(KeyBoardSystem||(KeyBoardSystem={}));var Game;!function(e){function t(){return e.openServerTime+14400}function n(){return~~((Date.now()/e.Second+e.deviation-t())/86400)}function i(t){var n=new Date;t&&(n=new Date(t.getYear(),t.getMonth()-1,t.getDay(),t.getHour(),t.getMinute(),t.getSecond())),e.serverTime=n.getTime()/e.Second,e.deviation=e.serverTime-Date.now()/e.Second}function a(){return Math.floor(e.eraDay%7)}function r(){var t=new Date;return t.setTime(t.getTime()+e.deviation*e.Second),t}function o(){return~~((Date.now()/e.Second+e.deviation-e.openServerTime)/86400)}function s(){return~~(Date.now()/e.Second+e.deviation-e.openServerTime)}e.eraDay=0,e.countEraDay=n,e.setServerTime=i,e.getServerWeekday=a,e.getServerDate=r,e.countDay=o,e.countOpenSeconds=s}(Game||(Game={}));var Guild;!function(e){function t(){return PlayerAttribute.Level<e.limitLevel?void o(1):void(""==Player.instance.guildName?i():n())}function n(){UIManager.pushPage(UI.GuildHome.instance),net.socket.write(83,null),net.socket.write(88,null),net.socket.write(97,null),net.socket.write(2011,null),net.socket.write(2010,null)}function i(){UIManager.pushPage(UI.GuildEnroll.instance),net.socket.write(82,null)}function a(t,i,a){return t?(PopUpMessage.push(lang.String("guild create succeed"),color.GREEN),Player.instance.SetGuildName(i),Player.instance.guildPos=e.GuildPosition.GuildPos_Leader,void n()):void PopUpMessage.push(lang.String(a),color.RED)}function r(t,n,i){return t?(PopUpMessage.push(lang.String("guild rename succeed"),color.GREEN),Player.instance.SetGuildName(n),e.guildInfo.name=n,e.canRename=!1,UI.GuildHome.instance.setGuildInfo(),void UIManager.pop(UI.ChangeName.instance)):void PopUpMessage.push(lang.String(i),color.RED)}function o(t){switch(t){case 1:PopUpMessage.push(lang.StringWithFormat("wanderings entrance guild open in level {1}",e.limitLevel),color.RED)}}function s(e){return null}function l(){Scene.handleIdle[Z]=s,Scene.listenEnterMap(Z,u),Scene.listenLeaveMap(Z,c),e.guildTaskTable=RES.getRes("public_config/guildtask.json"),SecondTicker.addEventListener(D,null)}function u(){UI.HUD.instance.showBattle(),null==e.notePanel&&(e.notePanel=new UI.GuildManor),UI.battle.addChild(e.notePanel),net.socket.write(83,null),net.socket.write(2004,null)}function c(){null!=e.notePanel&&(UI.battle.removeChild(e.notePanel),e.notePanel=null),null!=e.roshamboPanel&&(UIManager.pop(e.roshamboPanel),e.roshamboPanel.freeAssets(),e.roshamboPanel=null)}function h(t){World.scene==Z&&null==e.roshamboPanel&&(e.roshamboPanel=new UI.GuildRoshambo,e.roshamboPanel.opponentname=t,e.roshamboPanel.currentState="begin",UIManager.pushPage(e.roshamboPanel))}function d(t){return null==t&&(t=Player.instance.guildPos),t==e.GuildPosition.GuildPos_Leader||t==e.GuildPosition.GuildPos_ViceLeader?!0:!1}function p(t){return null==t&&(t=Player.instance.guildPos),t==e.GuildPosition.GuildPos_Leader?!0:!1}function g(){return null!=z?!0:!1}function m(t){var n=0;return z&&z[t]&&(n=z[t]),0==t&&(n=e.guildInfo.level),n}function f(t){for(var n=0;n<e.usingSkill.length;n++)if(e.usingSkill[n]==t)return!0;return!1}function v(e){z={};for(var t=0;t<e.id.length;t++)z[e.id[t]]=e.lv[t]}function y(e,t){console.log("got ProcessActivateGSkill msg:",e," ",t),z&&1==t&&(z[e]=1,Game.dispatcher.dispatchEventWith(Game.EVENT.UpdateGuildSkillLevel))}function b(e,t){z&&(0>=t||(z[e]=t,Game.dispatcher.dispatchEventWith(Game.EVENT.UpdateGuildSkillLevel)))}function S(t){null==e.guildInfo&&(e.guildInfo=new e.guild),e.guildInfo.level=t,PlayerAttribute.UpdateFightingPower(!0),Game.dispatcher.dispatchEventWith(Game.EVENT.GuildLevelUp)}function E(t){e.fund=t,null!=UI.GuildSkill.instance&&UI.GuildSkill.instance.UpdateFund(),null!=UI.GuildHome.instance&&UI.GuildHome.instance.UpdateGuildFund()}function C(t){for(var n=0;n<table.mapGuildSkill[0].attr.length;n++)if(table.mapGuildSkill[0].attr[n].attrId==t)return table.mapGuildSkill[0].attr[n].value[e.guildInfo.level-1]}function T(){return null==e.guildInfo||""==e.guildInfo.name?0:C(17)}function I(){return null==e.guildInfo||""==e.guildInfo.name?0:C(1)}function G(){return null==e.guildInfo||""==e.guildInfo.name?0:C(35)}function A(){return null==e.guildInfo||""==e.guildInfo.name?0:C(7)}function k(){if(null==e.guildInfo)return 0;if(0==e.guildInfo.level)return 0;var t=0;return t+=I()*FightingPower.Attack,t+=T()*FightingPower.Life,t+=G()*FightingPower.Luck,t+=A()*FightingPower.Defense}function P(){return null==e.guildInfo||0==e.guildInfo.level?void PopUpMessage.push(lang.String("no guild"),color.RED):void UIManager.pushPage(UI.PlayerGuildBuff.instance)}function w(e){return NumberFormat(~~(e/100),2)+":"+NumberFormat(~~(e%100),2)}function L(t){var n=t.getTasks();e.busiTaskData.finalAward=n[0],e.busiTaskData.helpOtherCount=n[1],e.busiTaskData.seekHelpCount=n[2],e.busiTaskData.finishCount=n[3];var i=n[4],a=5;e.busiTaskData.taskId=[];for(var r=0;r<table.guildBusiTask.taskCountPerDay;r++)e.busiTaskData.taskId.push(n[a+r]);a+=table.guildBusiTask.taskCountPerDay,e.busiTaskData.taskStatus=[];for(var r=0;r<table.guildBusiTask.taskCountPerDay;r++)e.busiTaskData.taskStatus.push(n[a+r]);a+=table.guildBusiTask.taskCountPerDay,e.busiTaskData.seekHelp=[];for(var r=0;i>r;r++)e.busiTaskData.seekHelp.push(n[a+r]);a+=i,e.busiTaskData.seekHelpStatus=[];for(var r=0;i>r;r++)e.busiTaskData.seekHelpStatus.push(n[a+r]);Game.dispatcher.dispatchEventWith(Game.EVENT.GuildBusiTaskDataChange)}function R(){var t=PlayerAttribute.vipItem.level,n=table.guildBusiTask.seekHelpTimes[t];return n-e.busiTaskData.seekHelpCount}function U(){var t=PlayerAttribute.vipItem.level,n=table.guildBusiTask.helpOthersTimes[t];return n-e.busiTaskData.helpOtherCount}function _(){for(var t=0,n=0;n<table.guildSalary.length&&!(e.weeklyReputation<table.guildSalary[n].needReputation);n++)t=n;return t}function x(){return table.guildSalary[_()].desc}function M(e){var t=new net.def.C2SGuildBeginTraining;t.inviter=e,net.socket.write(2003,t.toArrayBuffer())}function D(){1==e.inToastTime&&0==N()?(e.inToastTime=!1,Game.dispatcher.dispatchEventWith(Game.EVENT.GuildToastEnd)):0==e.inToastTime&&1==N()&&(e.inToastTime=!0,Game.dispatcher.dispatchEventWith(Game.EVENT.GuildToastBegin))}function N(){var t=Game.getServerDate(),n=t.getHours(),i=t.getMinutes(),a=100*n+i,r=e.toastTime,o=r+9;return a>=r&&o>=a?!0:!1}function F(){return null==e.guildInfo||""==e.guildInfo.name||null==e.guildWar?0:e.guildWar.token}function O(t){null!=e.guildInfo&&""!=e.guildInfo.name&&null!=e.guildWar&&(e.guildWar.token=t,Game.dispatcher.dispatchEventWith(Game.EVENT.GuildWarTokenChange))}function B(t){null!=e.guildInfo&&""!=e.guildInfo.name&&null!=e.guildWar&&(e.guildWar.taskProgress=t,Game.dispatcher.dispatchEventWith(Game.EVENT.GuildWarSignInfo))}function W(){return null==e.guildInfo||""==e.guildInfo.name||null==e.guildWar?0:e.guildWar.taskProgress}function V(){return null==e.guildInfo||""==e.guildInfo.name||""==Player.instance.guildName?!1:!0}function q(){null!=e.guildWar&&(e.guildWar.taskProgress=0,e.guildWar.token=0,Game.dispatcher.dispatchEventWith(Game.EVENT.GuildWarSignInfo))}function H(t){var n=net.def.S2CGuildTrainingInfo.decode(t);e.TrainingState=n.getState(),e.TrainingPlayer=n.getName(),null!=UI.gathering&&e.TrainingState==e.TRAININGSTATE_TRAINING&&UI.gathering.SetMsg(lang.StringWithFormat("guild training with {1}",e.TrainingPlayer)),Game.dispatcher.dispatchEventWith(Game.EVENT.GuildTrainingStateChanged)}function j(t,n){e.appliedGuild=[];for(var i=0;i<t.length;i++){var a=lang.String("online");t[i].offlineTime>0&&(a=FormatDDHH(60*t[i].offlineTime));var r={name:t[i].name,level:t[i].level,leader:t[i].leader,memberCount:t[i].memberCount,appliable:t[i].appliable,offlineTime:a,onlineCount:t[i].onlineCount,lastTopOnline:t[i].lastTopOnline};e.appliedGuild.push(r)}e.othersGuild=[];for(var i=0;i<n.length;i++){var a=lang.String("online");n[i].offlineTime>0&&(a=FormatDDHH(60*n[i].offlineTime));var o={name:n[i].name,level:n[i].level,leader:n[i].leader,memberCount:n[i].memberCount,appliable:n[i].appliable,offlineTime:a,onlineCount:n[i].onlineCount,lastTopOnline:n[i].lastTopOnline};e.othersGuild.push(o)}Game.dispatcher.dispatchEventWith(Game.EVENT.SyncGuildList)}function Y(t){for(var n=0;n<e.appliedGuild.length;n++)if(t==e.appliedGuild[n].name)return!0;return!1}e.limitLevel=20,e.costCoin=300;e.maxGuildLevel=5,e.GUILDSKILL_UPGRADE_COST=[30,60,120,240,450,750,1200,1800,3e3,6e3],e.GUILDSKILL_CHANGECOST=15,e.Drink_GoldCoin=60,e.position=0,e.reputation=0,e.inactiveness=0,e.announce="",e.needApproval=!0,e.weeklyReputation=0,e.fund=0,e.tastStatus=[],e.MAX_GUILDWAR_TOKEN=200;var K;!function(e){e[e.SignUp=0]="SignUp",e[e.CollectToken=1]="CollectToken",e[e.AttackGate=2]="AttackGate",e[e.Unstoppable=3]="Unstoppable",e[e.FuniushanFinal=4]="FuniushanFinal"}(K=e.GuildWarTask||(e.GuildWarTask={}));var Q=function(){function e(){this.taskProgress=0,this.token=0}return e}();e.GuildWar=Q,__reflect(Q.prototype,"Guild.GuildWar"),e.canRename=!1,e.guildTaskTable=[],e.MemberList=[],e.toastTime=0,e.newToastTime=0,e.equipBuildLevel=1,e.showLoginGuildAnnounce=!0,e.busiTaskData={finalAward:0,helpOtherCount:0,seekHelpCount:0,finishCount:0,taskId:[],taskStatus:[],seekHelp:[],seekHelpStatus:[]};var X;!function(e){e[e.GuildPos_None=0]="GuildPos_None",e[e.GuildPos_Leader=1]="GuildPos_Leader",e[e.GuildPos_ViceLeader=2]="GuildPos_ViceLeader",e[e.GuildPos_Member=3]="GuildPos_Member"}(X=e.GuildPosition||(e.GuildPosition={})),e.PositionName={0:"None",1:"leader",2:"viceleader",3:"member"},e.TaskAwardTable={rate:[100,110,120,130,140,150,160,170,180,190],award:{39:{exp:3e6,copper:3e4},49:{exp:4e6,copper:4e4},59:{exp:5e6,copper:5e4},69:{exp:6e6,copper:6e4},79:{exp:7e6,copper:7e4},89:{exp:8e6,copper:8e4},100:{exp:9e6,copper:9e4}}};var J=function(){function e(){}return e}();e.guild=J,__reflect(J.prototype,"Guild.guild"),e.onCity2GuildMain=t,e.openGuildHome=n,e.openGuildEnroll=i,e.s2cCreateResult=a,e.s2cRenameResult=r,e.onFailmessage=o,e.load=l,e.startRoshambo=h;var z,Z="guild";e.isGuildManager=d,e.isLeader=p,e.HasGuildSkill=g,e.GetGuildSkillLv=m,e.IsSkillUsed=f,e.ProcessS2CGuildSkillLvList=v,e.ProcessActivateGSkill=y,e.ProcessLvUpGuildSkill=b,e.ProcessS2CSyncGuildLevel=S,e.ProcessS2CSyncGuildFund=E,e.GetGuildPassiveSkillLife=T,e.GetGuildPassiveSkillAttack=I,e.GetGuildPassiveSkillLuck=G,e.GetGuildPassiveSkillDefence=A,e.GetGuildSkillFp=k,e.openGuildSkillAttr=P,e.formatToastTime=w,e.ProcS2CSyncBusiTask=L,e.GetBusiTaskSeekHelp=R,e.GetBusiTaskHelpOthers=U,e.GetCurrentSalaryLevel=_,e.GetCurrentSalaryDesc=x,e.BeginTraining=M,e.inToastTime=!1,e.CheckIsInToastTime=N,e.GuildWarGetToken=F,e.GuildWarSetToken=O,e.GuildWarTaskProgress=B,e.GuildWarGetTaskProgress=W,e.HasGuild=V,e.ClearGuildWarInfo=q,e.TrainingState=0,e.TrainingPlayer="",e.TRAININGSTATE_WAIT=0,e.TRAININGSTATE_TRAINING=1,e.TRAININGSTATE_OVER=2,e.OnSyncGuildTrainingInfo=H,e.onSyncGuildList=j,e.isAppliedGuild=Y}(Guild||(Guild={}));var Item;!function(e){e.MaxBookGradePerPlayerLevel=10;var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.Use=function(){if(this.Usable){var e=new net.def.C2SCraftBook;e.id=this.DetailType,net.socket.write(113,e.toArrayBuffer())}},Object.defineProperty(t.prototype,"Usable",{get:function(){var e=(Player.instance,this.DetailType),t=table.books[e],n=t.quality,i=table.bookCost.crafting[n],a=PlayerAttribute.books[t.category];return null!=a&&a.Id==e||PlayerAttribute.bag.hasBook(e)?!1:PlayerAttribute.bag.CalcCount(this.Genre,this.DetailType)>=i},enumerable:!0,configurable:!0}),t}(e.Prop);e.BookDebris=t,__reflect(t.prototype,"Item.BookDebris");var n=function(){function t(e){this.Id=e.id,this.attributes=[],this.grade=e.grade,this.exp=e.exp;for(var t=table.books[this.Id],n=0;n<e.attribute.length;n++)this.attributes[n]={id:e.attribute[n].id,level:e.attribute[n].level,values:[e.attribute[n].level*t.attributes[n].value]}}return Object.defineProperty(t.prototype,"maxExp",{get:function(){for(var e=0,t=0;t<this.attributes.length;t++)e+=table.books[this.Id].attributes[t].count;return e/Game.MaxBookLevel},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Icon",{get:function(){Game.Faction[PlayerAttribute.faction];return table.books[this.Id].icon},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Count",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"category",{get:function(){return table.books[this.Id].category},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Name",{get:function(){var t=table.books[this.Id],n=t.quality;return'<font color="'+egret.toColorString(e.QualityColor[n])+'">'+t.name+"</font>"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return table.books[this.Id].name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skillName",{get:function(){return table.books[this.Id].skillName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Desc",{get:function(){return table.books[this.Id].desc},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"BaseDesc",{get:function(){var e=lang.StringWithFormat("level:{1}",this.getLevel());return e+="\n"+lang.StringWithFormat("fp:{1}",this.FP)},enumerable:!0,configurable:!0}),t.prototype.getLevel=function(){return(this.grade-1)*this.maxExp+this.exp},Object.defineProperty(t.prototype,"BaseAttributesDesc",{get:function(){var e=table.books[this.Id],t=Buff.GetAttackDesc(e.attack);return t+="\n"+Buff.GetLifeDesc(e.life),t+="\n"+Buff.GetDefenseDesc(e.defense)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"AttributesDesc",{get:function(){for(var e="",t=0;t<this.attributes.length;t++)e+=Buff.GetDesc(this.attributes[t].id,this.attributes[t].values)+"\n";return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Quality",{get:function(){return table.books[this.Id].quality},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Type",{get:function(){return 6},enumerable:!0,configurable:!0}),t.GetBookFP=function(e){for(var t=table.books[e].fp,n=table.books[e].attributes,i=0;i<n.length;i++){var a=n[i];t+=Buff.GetFightingPower(a.id,[a.value])}return t},Object.defineProperty(t.prototype,"FP",{get:function(){for(var e=table.books[this.Id].fp,t=0;t<this.attributes.length;t++){var n=this.attributes[t];e+=Buff.GetFightingPower(n.id,n.values)}return e},enumerable:!0,configurable:!0}),t.prototype.upgrade=function(){this.grade++,this.exp=0},t.prototype.levelUp=function(e){this.exp++,this.attributes[e].level++,this.attributes[e].values[0]=this.attributes[e].level*table.books[this.Id].attributes[e].value},t.prototype.canUpgrade=function(){var t=this.grade;if(t>=Game.MaxBookLevel)return!1;if(t>=Math.floor(PlayerAttribute.Level/e.MaxBookGradePerPlayerLevel))return!1;var n=this.Quality;if(this.exp>=this.maxExp){var i=table.bookCost.upgrade[t-1].bookdebris[n],a=PlayerAttribute.bag.CalcCount(7,this.Id);if(a>=i)return!0}return!1},t.prototype.canLevelUp=function(){var e=this.grade,t=this.Quality;if(this.exp>=this.maxExp)return!1;var n=table.bookCost.levelUp[e-1].reading[t],i=table.bookCost.levelUp[e-1].copperCoin,a=PlayerAttribute.currency,r=a[Game.Currency.CopperCoin],o=a[Game.Currency.Reading];return r>=i&&o>=n?!0:!1},t.prototype.calcPriority=function(){var e=this.grade,t=this.Quality;if(this.exp>=this.maxExp){if(this.grade<Game.MaxBookLevel){var n=table.bookCost.upgrade[e-1].bookdebris[t],i=PlayerAttribute.bag.CalcCount(7,this.Id);return i>=n?2:0}return 0}var a=table.bookCost.levelUp[e-1].reading[t],r=table.bookCost.levelUp[e-1].copperCoin,o=PlayerAttribute.currency,s=o[Game.Currency.CopperCoin],l=o[Game.Currency.Reading];return s>=r&&l>=a?1:0},t.prototype.Use=function(){this.Usable&&PlayerAttribute.useItem(this.BagId)},Object.defineProperty(t.prototype,"Usable",{get:function(){return PlayerAttribute.Level>=table.books[this.Id].requireLevel},enumerable:!0,configurable:!0}),t.prototype.Marshal=function(){var e=new net.def.Book;e.id=this.Id,e.grade=this.grade,e.exp=this.exp,e.attribute=[];for(var t=0;t<this.attributes.length;t++){var n=new net.def.BookAttribute,i=this.attributes[t];n.id=i.id,n.level=i.level,e.attribute.push(n)}return e},t.prototype.totalLevel=function(){return(this.grade-1)*this.maxExp+this.exp},t.GetBookTalentSkillDesc=function(e,t){if(0==e)return"";var n=table.books[e].talentSkill,i=table.books[e].activateTalentSkillAt,a=(table.books[e].name,t>=i),r=t-i+1;if(a||(r=1),n>0){var o=Features.TalentSkill.instance.GetSkillCfg(n);if(null!=o){var s=lang.String("talent skill")+"<b><font color=0xff4d00>"+lang.StringWithFormat("{1}{2} level",o.name,r)+"</font></b>\n"+Features.TalentSkill.instance.GetDesc(o,r,a,!1);if(!a){var l=i-t;s=s+"<b><font color=0xFF002A>"+lang.StringWithFormat("talent skill unlock at{1}",l)+"</font></b>"}return s}}return""},t.GetBookNextTalentSkillDesc=function(e,t){if(0==e)return"";var n=table.books[e].talentSkill,i=table.books[e].activateTalentSkillAt,a=(table.books[e].name,t>=i),r=t-i+1;if(a||(r=1),n>0){var o=Features.TalentSkill.instance.GetSkillCfg(n);if(null!=o&&8>r){var s=lang.String("nextLv talent skill")+"<b><font color=0xff4d00>"+lang.StringWithFormat("{1}{2} level",o.name,r+1)+"</font></b>\n"+Features.TalentSkill.instance.GetDesc(o,r+1,a,!1);
if(!a){var l=i-t;s=s+"<b><font color=0xFF002A>"+lang.StringWithFormat("talent skill unlock at{1}",l)+"</font></b>"}return s}if(null!=o&&8==r){var s=lang.String("talent skill MaxLevel")+"<b><font color=0xff4d00>";return s}return""}return""},t.bookMounted=function(e){for(var t in PlayerAttribute.books){var n=PlayerAttribute.books[t];if(n.Id==e)return n}return null},t.GetFpDesc=function(e){var n=PlayerAttribute.bag.getBook(e);return null==n&&(n=t.bookMounted(e)),null!=n?lang.String("FightingPower")+"<font color=0xFFFFFF>"+n.FP.toString()+"</font> ":lang.String("FightingPower")+"<font color=0xFFFFFF>"+table.books[e].fp.toString()+"</font> "},t}();e.Book=n,__reflect(n.prototype,"Item.Book",["Item.IItem"])}(Item||(Item={}));var Item;!function(e){e.QualityColor={0:color.WHITE,1:color.GREEN,2:color.BLUE,3:color.PURPLE,4:color.YELLOW,5:color.ORANGE},e.EquipParsePart={weapon:Game.EquipPart.EquipWeapon,necklace:Game.EquipPart.EquipNecklace,ring:Game.EquipPart.EquipRing,pendant:Game.EquipPart.EquipPendant,helmet:Game.EquipPart.EquipHelmet,armor:Game.EquipPart.EquipArmor,cuff:Game.EquipPart.EquipCuff,boots:Game.EquipPart.EquipBoot},e.EquipFormatPart={0:"helmet",1:"armor",2:"cuff",3:"boots",4:"weapon",5:"necklace",6:"ring",7:"pendant"};var t=function(){function e(){}return Object.defineProperty(e.prototype,"Desc",{get:function(){if(0!=this.Attack)return Buff.GetDesc(1,[this.Attack],!0);if(0!=this.Life)return Buff.GetDesc(17,[this.Life],!0);if(0!=this.Defense)return Buff.GetDesc(7,[this.Defense],!0);for(var e=0;e<this.SeriesAttack.length;e++)if(0!=this.SeriesAttack[e])return Buff.GetDesc(2+e,[this.SeriesAttack[e]],!0);for(var e=0;e<this.SeriesDefense.length;e++)if(0!=this.SeriesDefense[e])return Buff.GetDesc(8+e,[this.SeriesDefense[e]],!0);return""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"AttributeId",{get:function(){if(0!=this.Attack)return{id:1,value:this.Attack};if(0!=this.Life)return{id:17,value:this.Life};if(0!=this.Defense)return{id:7,value:this.Defense};for(var e=0;e<this.SeriesAttack.length;e++)if(0!=this.SeriesAttack[e])return{id:2+e,value:this.SeriesAttack[e]};for(var e=0;e<this.SeriesDefense.length;e++)if(0!=this.SeriesDefense[e])return{id:8+e,value:this.SeriesDefense[e]}},enumerable:!0,configurable:!0}),e}();__reflect(t.prototype,"BaseAttribute");var n=function(){function n(e,n){this.faction=Game.Faction[n],this.BaseAttribute=new t,this.BaseAttribute.Life=e.getLife(),this.BaseAttribute.Attack=e.getAttack(),this.BaseAttribute.Defense=e.getDefense(),this.BaseAttribute.SeriesAttack=e.getSeriesAttack(),this.BaseAttribute.SeriesDefense=e.getSeriesDefense(),this.Part=e.getPart(),this.Id=e.getId(),this.Series=e.getSeries(),this.Level=e.getLevel(),this.Requirement=e.getRequirement(),this.LightAttributes=[];for(var i=e.attributes,a=0;a<i.length;a++)this.LightAttributes.push(i[a].toRaw());this.Klass=e.getKlass(),this.UpdateFightingPower()}return n.getBaseDesc=function(e,t,n,i){var a=color.Title1_Value,r=[];if(table.equipfp[e]&&table.equipfp[e][t]&&table.equipfp[e][t][n]){var o=table.equipfp[e][t][n];r.push(lang.String("FightingPower")+"<font color="+a+">"+o+"</font>")}else r.push(lang.String("FightingPower")+"<font color="+a+">????</font>");r.push(lang.String("Part")+"<font color="+a+">"+lang.String(Game.EquipPart[t])+"</font>"),i<=PlayerAttribute.Level?r.push(lang.String("levelTitle")+"<font color="+a+">"+i+"</font>"):r.push(lang.String("levelTitle")+"<font color="+color.Warning+">"+i+"</font>");var s,l=EquipmentSetMaker.setting[t][n];return s=l?l.product.baseAttribute:table.getEquipBaseAttr(e,i,t),s&&r.push(table.getAttrDesc(s)),r.join("\n")},n.prototype.UpdateFightingPower=function(){var e=int(this.BaseAttribute.Life*FightingPower.Life);e+=this.BaseAttribute.Attack*FightingPower.Attack,e+=this.BaseAttribute.Defense*FightingPower.Defense;for(var t in this.BaseAttribute.SeriesAttack)e+=this.BaseAttribute.SeriesAttack[t]*FightingPower.SeriesAttack;for(var t in this.BaseAttribute.SeriesDefense)e+=this.BaseAttribute.SeriesDefense[t]*FightingPower.SeriesDefense;for(var t=0;t<this.LightAttributes.length;t++){var n=this.LightAttributes[t];e+=Buff.GetFightingPower(n.id,n.values)}this.FightingPower=e,this.MaxFightingPower=e},n.prototype.load=function(e,t){},Object.defineProperty(n.prototype,"Type",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Count",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"GemAttributeId",{get:function(){return 100*this.Part*1e3+1e3*this.Id+this.Level},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"RequireDesc",{get:function(){for(var e,t=this.Requirement,n=0;n<t.length;n++)null==e||""==e?e=table.faction[t[n]].name:e+=" "+table.faction[t[n]].name;return null==e||""==e?lang.String("None"):void 0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Desc",{get:function(){var e=this.faction,t=table.equips[this.Part][this.Id][e].desc;return t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"BaseDesc",{get:function(){var e=color.Title1_Value,t=[];return t.push(lang.String("FightingPower")+"<font color="+e+">"+this.FightingPower+"</font>"),t.push(lang.String("Part")+"<font color="+e+">"+this.PartName+"</font>"),PlayerAttribute.Level<this.Level?t.push(lang.String("levelTitle")+"<font color="+color.Warning+">"+this.Level+"</font>"):t.push(lang.String("levelTitle")+"<font color="+e+">"+this.Level+"</font>"),t.join("\n")},enumerable:!0,configurable:!0}),n.prototype.Marshal=function(){var e=new net.def.Equip;e.part=this.Part,e.id=this.Id,e.series=this.Series,e.klass=this.Klass,e.level=this.Level,e.life=this.BaseAttribute.Life,e.attack=this.BaseAttribute.Attack,e.defense=this.BaseAttribute.Defense,e.seriesAttack=this.BaseAttribute.SeriesAttack,e.seriesDefense=this.BaseAttribute.SeriesDefense,e.requirement=this.Requirement,e.attributes=[];for(var t=0;t<this.LightAttributes.length;t++){var n=this.LightAttributes[t],i=new net.def.EquipAttribute;i.id=n.id,i.values=n.values,e.attributes.push(i)}return e},Object.defineProperty(n.prototype,"SeriesName",{get:function(){return lang.String(Game.Series[this.Series])},enumerable:!0,configurable:!0}),n.prototype.getBaseAttributesDesc=function(e,t){var n=this.BaseAttribute.Desc;if(e){var i=table.enhancement[this.Part][e-1].buffs[0][1];n+=" <font color="+color.Title2+">(+"+i+")</font>"}if(null!=t){var a=Refine.getConfig(this.Part,t);if(null!=a){var i=a.buffs[0][1];n+=" <font color=1540548>(+"+i+")</font>"}}return""==n||null==n?lang.String("None"):n},n.prototype.Use=function(){PlayerAttribute.checkEquipLimit(this)&&PlayerAttribute.useItem(this.BagId)},Object.defineProperty(n.prototype,"Usable",{get:function(){return PlayerAttribute.checkEquipLimit(this)},enumerable:!0,configurable:!0}),n.prototype.getRandomAttributesDesc=function(){for(var t=[],n=this.LightAttributes,i=0;i<n.length;i++)null!=n[i]&&t.push(""+Buff.GetDesc(n[i].id,n[i].values));return"<font color="+e.QualityColor[this.Quality]+">"+t.join("\n")+"</font>"},Object.defineProperty(n.prototype,"rawName",{get:function(){var e=this.faction,t=table.equips[this.Part][this.Id][e].name;return(null==t||""==t)&&egret.error("get equip name nil",this.Part,this.Id),t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Name",{get:function(){var t=this.rawName;return"<font color="+e.QualityColor[this.Quality]+">"+t+"</font>"},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Icon",{get:function(){var e=this.faction;return table.equips[this.Part][this.Id][e].icon},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Quality",{get:function(){switch(this.Klass){case Game.EquipKlass.EquipClassGreen:return 1;case Game.EquipKlass.EquipClassBlue:return 2;case Game.EquipKlass.EquipClassPurple:return 3;case Game.EquipKlass.EquipClassOrange:return 4;case Game.EquipKlass.EquipClassRed:return 5;case Game.EquipKlass.EquipClassNormal:var e=this.LightAttributes.length;switch(e){case 6:return 4;case 5:case 4:return 3;case 3:case 2:return 2;default:return 1}}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"PartName",{get:function(){return lang.String(Game.EquipPart[this.Part])},enumerable:!0,configurable:!0}),n}();e.Equip=n,__reflect(n.prototype,"Item.Equip",["Item.IItem"])}(Item||(Item={}));var Item;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t.prototype,"baseAttributeDesc",{get:function(){return PlayerGem.GetAttributeDesc(this.DetailType)},enumerable:!0,configurable:!0}),t.prototype.Use=function(){UI.Forge.instance.changePage(1),UIManager.openForge()},Object.defineProperty(t.prototype,"Usable",{get:function(){return!0},enumerable:!0,configurable:!0}),t}(e.Prop);e.Gem=t,__reflect(t.prototype,"Item.Gem")}(Item||(Item={}));var Item;!function(e){e.JueXueChip={genre:1,detail:102},e.JueXuePartsCount=6;var t,n=5,i=15,a=Math.floor(i/n);!function(e){e[e.JueXue_Xin=1]="JueXue_Xin",e[e.JueXue_Yan=2]="JueXue_Yan",e[e.JueXue_Yi=3]="JueXue_Yi",e[e.JueXue_Qi=4]="JueXue_Qi",e[e.JueXue_Gong=5]="JueXue_Gong",e[e.JueXue_Li=6]="JueXue_Li"}(t=e.JueXuePart||(e.JueXuePart={})),e.JueXueFontNote=["icon/jueyao/jx_2.png","icon/jueyao/jx_6.png","icon/jueyao/jx_5.png","icon/jueyao/jx_3.png","icon/jueyao/jx_1.png","icon/jueyao/jx_4.png"];var r=function(){function r(){}return r.GetSuit=function(e,t){return table.juexuesuits[e-1].suits[t]},r.GetSuitName=function(e){return table.juexuesuits[e-1].name},r.prototype.IsLevelUp=function(e){if(null==e)return!1;var t=this.Id==e.Id&&this.BreakCount==e.BreakCount&&this.Attributes.length==this.Attributes.length;if(!t)return!1;for(var n=0;n<this.Attributes.length;n++)if(this.Attributes[n].sid!=e.Attributes[n].sid||this.Attributes[n].id!=e.Attributes[n].id)return!1;return this.Level!=e.Level+1?!1:!0},r.prototype.IsBreakOut=function(e){return null==e?!1:this.Id==e.Id&&this.Level==e.Level&&this.BreakCount==e.BreakCount+1},r.prototype.UpdateFightingPower=function(){for(var e=0,t=0;t<this.Attributes.length;t++){var n=this.Attributes[t];e+=Buff.GetFightingPower(n.id,n.values)}this.FightingPower=e},r.prototype.GetAttrDiff=function(e){if(null==this.Attributes[e])return 0;var t=this.Attributes[e].sid,n=0==e?table.juexueattrs.mainAttrs[t-1]:table.juexueattrs.assistAttrs[t-1];if(null==n)return 0;var i=Buff.GetEffectValue(this.Attributes[e].id,this.Attributes[e].values)-Buff.GetEffectValue(n.attrId,n.attrValue);return i>=0?i==Math.floor(i)?i:parseFloat(i.toFixed(2)):0},r.prototype.getDesc=function(){var t="";t+=lang.String("FightingPower")+"<font color="+color.WHITE+">"+this.FightingPower+"</font>\n",t+=lang.String("Part")+"<font color="+color.WHITE+">"+this.PartName+"</font>\n",t+=lang.String("juexue_level")+"<font color="+color.WHITE+">"+this.Level+"</font>\n";for(var i=egret.toColorString(e.QualityColor[this.Quality]),a=0;n>a;a++){if(null!=this.Attributes[a]){t+="<font color="+i+">"+Buff.GetDesc(this.Attributes[a].id,this.Attributes[a].values)+"</font>";var r=this.GetAttrDiff(a);r>0&&(t+=" <font color="+color.NewBLUE+">("+r+")</font>")}a+1!=this.Attributes.length&&(t+="\n")}return t},r.prototype.getBaseDesc=function(){var e="";return e+=lang.String("juexue_level")+"<font color="+color.WHITE+">"+this.Level+"</font>\n",e+=lang.String("FightingPower")+"<font color="+color.WHITE+">"+this.FightingPower+"</font>\n",e+=lang.String("Part")+"<font color="+color.WHITE+">"+this.PartName+"</font>"},r.prototype.getMainAttrDesc=function(){var t=egret.toColorString(e.QualityColor[this.Quality]),n=this.Attributes[0],a=table.juexueattrs.mainAttrs[n.sid-1],r=Buff.GetEffectValue(n.id,n.values),o=Buff.GetEffectValue(a.attrId,a.attrValueMax),s=Buff.GetEffectValue(a.attrId,a.attrValue);if(i>o-s){var l=o==Math.floor(o)?o:parseFloat(o.toFixed(2));return{desc:"<font color="+t+">"+Buff.GetDesc(n.id,n.values)+"</font>",source:"ui/CollectCard/green.png",change:"<font color="+color.NewBLUE+">"+l+"</font>"}}var u=r+(o-s)/i;return u=u==Math.floor(u)?u:parseFloat(u.toFixed(2)),{desc:"<font color="+t+">"+Buff.GetDesc(n.id,n.values)+"</font>",source:"ui/CollectCard/green.png",change:"<font color="+color.NewBLUE+">"+u+"</font>"}},r.prototype.getAssistAttrDesc=function(){for(var t=[],i=egret.toColorString(e.QualityColor[this.Quality]),a=1;a<this.Attributes.length;a++){var r=this.Attributes[a];t.push({desc:"<font color="+i+">"+Buff.GetDesc(r.id,r.values)+"</font>",source:"ui/CollectCard/green.png",change:"<font color="+color.NewBLUE+">????</font>"})}return this.Attributes.length<1+n&&t.push({desc:"<font color="+color.NewBLUE+">????????</font>",arrow:"",change:""}),t},r.prototype.getSuitDesc=function(t){for(var n=PlayerAttribute.GetJueXueSuit(t),i={},a=0;a<n.Attr.length;a++)n.Attr[a].suitid==this.SuitId&&n.Attr[a].quality==this.Quality&&(i[n.Attr[a].limit]=n.Attr[a].count);for(var r=egret.toColorString(e.QualityColor[this.Quality]),o=this.SuitName+"\n",s=this.Suit,a=0;a<s.attrs.length;a++){var l=null!=i[s.activate[a]]?r:color.GRAY,u=null!=i[s.activate[a]]?i[s.activate[a]]:0;o+=lang.Format("<font color="+l+">({1}/{2}): {3}</font>",u,s.activate[a],Buff.GetDesc(s.attrs[a].attrId,s.attrs[a].attrValue))+"\n"}return o},r.prototype.Init=function(e){this.Id=e.getId(),this.Level=e.getLevel(),this.BreakCount=e.getBreakCount(),this.Attributes=[];for(var t=e.getAttribute(),n=0;n<t.length;n++){var i=t[n],a=new net.def.JueXueAttribute;a.sid=i.sid,a.id=i.id,a.values=i.values,this.Attributes.push(a)}this.UpdateFightingPower()},r.prototype.Copy=function(e){this.Id=e.Id,this.Level=e.Level,this.BreakCount=e.BreakCount,this.Attributes=[];for(var t=e.Attributes,n=0;n<t.length;n++){var i=t[n],a=new net.def.JueXueAttribute;a.sid=i.sid,a.id=i.id,a.values=i.values,this.Attributes.push(a)}this.FightingPower=e.FightingPower},Object.defineProperty(r.prototype,"Type",{get:function(){return 11},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"Count",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"Desc",{get:function(){return table.juexues[this.Id-1].desc},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"Part",{get:function(){return(this.Id-1)%e.JueXuePartsCount+1},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"SuitId",{get:function(){return table.juexues[this.Id-1].suitid},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"Suit",{get:function(){return table.juexuesuits[this.SuitId-1].suits[this.Quality]},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"SuitName",{get:function(){return table.juexuesuits[this.SuitId-1].name},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"PartName",{get:function(){return lang.String(t[this.Part])},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"FontNoteIcon",{get:function(){return e.JueXueFontNote[this.Part-1]},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"Name",{get:function(){return"<font color="+egret.toColorString(e.QualityColor[this.Quality])+">"+this.name+"</font>"},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"name",{get:function(){var e=table.juexues[this.Id-1];return e.name},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"Icon",{get:function(){return table.juexues[this.Id-1].icon},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"Quality",{get:function(){return table.juexues[this.Id-1].quality-1},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"NeedBreak",{get:function(){return this.Level%a==0&&this.BreakCount<Math.floor(this.Level/a)},enumerable:!0,configurable:!0}),r.prototype.Marshal=function(){var e=new net.def.JueXue;e.id=this.Id,e.level=this.Level,e.breakCount=this.BreakCount,e.attribute=[];for(var t=0;t<this.Attributes.length;t++){var n=this.Attributes[t],i=new net.def.JueXueAttribute;i.sid=n.sid,i.id=n.id,i.values=n.values,e.attribute.push(i)}return e},r.prototype.Use=function(){},Object.defineProperty(r.prototype,"Usable",{get:function(){return!1},enumerable:!0,configurable:!0}),r}();e.JueXue=r,__reflect(r.prototype,"Item.JueXue",["Item.IItem"])}(Item||(Item={}));var Item;!function(e){var t=function(){function e(e,t){this.id=e,this.star=t}return Object.defineProperty(e.prototype,"Icon",{get:function(){return table.partnerEquips[this.id].source},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Count",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Name",{get:function(){return PartnerEquipManager.GetPartnerEquipName(this.id)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Desc",{get:function(){return table.partnerEquips[this.id].desc},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Quality",{get:function(){return table.partnerEquips[this.id].quality},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Type",{get:function(){return 16},enumerable:!0,configurable:!0}),e.prototype.Use=function(){this.Usable&&PlayerAttribute.useItem(this.BagId)},Object.defineProperty(e.prototype,"Usable",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.Marshal=function(){var e=new net.def.S2CPartnerEquipInfo;return e.id=this.id,e.star=this.star,e},e}();e.PartnerEquip=t,__reflect(t.prototype,"Item.PartnerEquip",["Item.IItem"])}(Item||(Item={}));var EffectSprite=function(e){function t(t,n){var i=e.call(this,n)||this;return i.url=t,i.touchEnabled=!1,i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i.addEventListener(egret.Event.REMOVED_FROM_STAGE,i.onRemoveFromStage,i),i}return __extends(t,e),t.generate=function(e,n){var i=this.objectPool.pop();return null==i?i=new t(e,n):(i.url=e,i.rotation=0,i.movieClipData=n,i.x=0,i.y=0,i.scaleX=1,i.scaleY=1),i},t.prototype.hasTimer=function(){return null!=this.timerId},t.prototype.onAddToStage=function(){RES.addRel(this.url)},t.prototype.__recycle=function(){this.url=null,this.movieClipData=null},t.prototype.onRemoveFromStage=function(){null!=this.timerId&&(egret.clearTimeout(this.timerId),this.timerId=null),RES.delRel(this.url),t.objectPool.push(this)},t.prototype.setLifeTime=function(e){e>0&&(this.timerId=egret.setTimeout(this.onTime,this,e))},t.prototype.onTime=function(){this.timerId=null,null!=this.parent&&this.parent.removeChild(this)},t.prototype.playDeltaTime=function(e,t){void 0===t&&(t=-1);var n=Math.round(e*this.movieClipData.frameRate/Game.Second)%this.movieClipData.numFrames;this.gotoAndPlay(n+1,t)},t.objectPool=new egret.Recycler,t}(egret.MovieClip);__reflect(EffectSprite.prototype,"EffectSprite");var MovableEffectSprite=function(e){function t(){var t=e.call(this)||this;return t.timeOnEnterFrame=0,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.generate=function(){var e=this.objectPool.pop();return null==e&&(e=new t),e},t.prototype.__recycle=function(){},t.prototype.onAddToStage=function(){this.timeOnEnterFrame=egret.getTimer(),this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this)},t.prototype.onRemoveFromStage=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),this.release()},t.prototype.release=function(){null!=this.timerId&&(egret.clearTimeout(this.timerId),this.timerId=null),null!=this.loader&&(null!=this.loader.url&&RES.delRel(this.loader.url),this.loader.release()),null!=this.sprite&&(this.removeChild(this.sprite),this.sprite=null),this.timeOnEnterFrame=0,t.objectPool.push(this)},t.prototype.load=function(e){var t=this;if(null==this.loader&&(this.loader=new MovieClipDataLoader),null==this.loader.dispatcher){RES.addRel(e.url);var n=(RES.getRes(e.url),egret.getTimer());this.loader.get(e.url,function(i){if(e.url!=t.loader.url)return void egret.error("[ERROR]MovableEffectSprite load",e.url,t.loader.url);var a=i.generateMovieClipData(e.movieClipName),r=new egret.MovieClip(a);r.blendMode=e.blendMode;var o=egret.getTimer()-n,s=Math.round(o*r.movieClipData.frameRate/Game.Second)%r.movieClipData.numFrames;e.rotatable&&(r.rotation=g_LogicDir2DisplayAngle[t.dir]),r.scaleX=e.scaleX,r.gotoAndPlay(s+1,-1),t.sprite=r,t.addChild(t.sprite)})}},t.prototype.setLifeTime=function(e){e>0&&(e>5e3&&egret.error("skill time too long"),this.endTime=egret.getTimer()+e,this.timerId=egret.setTimeout(this.onTime,this,e))},t.prototype.onTime=function(){this.timerId=null,null!=this.parent&&this.parent.removeChild(this)},t.prototype.onEnterFrame=function(){var e=egret.getTimer(),t=this.timeOnEnterFrame,n=e-t;this.timeOnEnterFrame=e,egret.$TempPoint.x=this.speed*n*this.xFactor,egret.$TempPoint.y=this.speed*n*this.yFactor,this.x+=egret.$TempPoint.x,this.y+=egret.$TempPoint.y/GameMap.ratioY},t.objectPool=new egret.Recycler,t}(egret.DisplayObjectContainer);__reflect(MovableEffectSprite.prototype,"MovableEffectSprite");var Item;!function(e){var t;!function(e){e[e.EquipHelmet=0]="EquipHelmet",e[e.EquipArmor=1]="EquipArmor",e[e.EquipCuff=2]="EquipCuff",e[e.EquipBoot=3]="EquipBoot",e[e.EquipWeapon=4]="EquipWeapon",e[e.EquipNecklace=5]="EquipNecklace",e[e.EquipRing=6]="EquipRing",e[e.EquipPendant=7]="EquipPendant"}(t=e.WenShiPart||(e.WenShiPart={})),e.WenShiCostItemId=2062,e.WenShiBaseAttribCount=3,e.WenShiQualityLevel=[5,10,15,20,25,30],e.WenShiMaxLevel=30,e.WenShiSplitMaterial=[14,2062],e.WenShiMaxPosCount=8,e.WenShiMaxQuality=5,e.WenShiMaxPhase=2;var n=function(){function n(){}return n.prototype.Init=function(e){this.id=e.id,this.quality=e.quality,this.pos=table.wenshis[this.id].pos,this.phase=table.wenshis[this.id].phase,this.qualityfp=table.wenshis[this.id].fightfp[this.quality],this.requireLevel=table.wenshis[this.id].requireLevel,this.splitvalue=table.wenshis[this.id].splitvalue,this.baseattributes=[];for(var t=e.getBaseattribute(),n=0;n<t.length;n++){var i=t[n];new net.def.WenShiBaseAttribute;this.baseattributes[n]={id:i.Id,level:i.Level,values:[i.Value],progress:i.Progress}}this.qualityattributes=[];for(var a=table.wenshis[this.id].qualityattributes,n=0;n<a.length;n++){var i=a[n];this.qualityattributes[n]={id:i.id,level:1,values:[i.value]}}},n.prototype.InitAwardView=function(e,t,n,i,a,r,o){this.id=e,this.quality=0,this.pos=table.wenshis[this.id].pos,this.qualityfp=table.wenshis[this.id].fightfp[this.quality],this.requireLevel=table.wenshis[this.id].requireLevel,this.splitvalue=table.wenshis[this.id].splitvalue,this.qualityattributes=[];for(var s=table.wenshis[this.id].qualityattributes,l=0;l<s.length;l++){var u=s[l];this.qualityattributes[l]={id:u.id,level:1,values:[u.value]}}this.baseattributes=[],this.baseattributes[0]={id:t,level:1,values:[n],progress:0},this.baseattributes[1]={id:i,level:1,values:[a],progress:0},this.baseattributes[2]={id:t,level:1,values:[o],progress:0}},n.prototype.getDesc=function(){var e="\n\n";e+=lang.String("FightingPower")+"<font color="+color.WHITE+">"+this.FightPower+"</font>\n",e+=lang.String("Part")+"<font color="+color.WHITE+">"+this.PartName+"</font>\n",e+=lang.String("levelTitle")+"<font color="+color.WHITE+">"+this.Quality+"</font>\n\n";for(var t=0;t<this.baseattributes.length;t++)if(null!=this.baseattributes[t]){var n=egret.toColorString(color.GREEN);e+="<font color="+n+">"+Buff.GetDesc(this.baseattributes[t].id,this.baseattributes[t].values)+"</font>\n"}e+="\n"+lang.String("WenShi pinjie")+"\n";for(var t=0;t<this.qualityattributes.length;t++)if(null!=this.qualityattributes[t]){var i=this.Quality<t+1?color.GRAY:color.GREEN,a=egret.toColorString(i);e+=lang.StringWithFormat("WenShi {1}pin",t+1),e+="<font color="+a+">"+Buff.GetDesc(this.qualityattributes[t].id,this.qualityattributes[t].values)+"</font>\n"}return e},n.prototype.GetSplitMaterial=function(){for(var t=0,n=1;n<=this.phase;n++)if(n<this.phase){for(var i=0,a=1;a<=e.WenShiMaxLevel;a++)a>e.WenShiQualityLevel[i]&&(i+=1),t+=table.wenshis[this.id-8*(e.WenShiMaxPhase-n)].levelupmaxprogress[i]*table.wenshis[this.id-8*(e.WenShiMaxPhase-n)].leveluppercost[i];t*=e.WenShiBaseAttribCount;for(var r=0;r<e.WenShiMaxQuality;r++)t+=table.wenshis[this.id-8*(e.WenShiMaxPhase-n)].breakthroughitem[r]}else{for(var o=0;o<this.baseattributes.length;o++)for(var i=0,s=1;s<=this.baseattributes[o].level;s++)s>e.WenShiQualityLevel[i]&&(i+=1),t+=s!=this.baseattributes[o].level?this.getLevelUpMaxProgress(i)*this.getLevelUpCost(i):this.baseattributes[o].progress*this.getLevelUpCost(i);for(var r=0;r<this.quality;r++)t+=table.wenshis[this.id].breakthroughitem[r]}return Math.floor(t/2)+this.splitvalue},n.prototype.getLevelUpMaxProgress=function(e){return table.wenshis[this.id].levelupmaxprogress[e]},n.prototype.getLevelUpCost=function(e){return table.wenshis[this.id].leveluppercost[e]},n.prototype.getBreakThroughCost=function(e){return table.wenshis[this.id].breakthroughitem[e]},n.prototype.getPhaseUpCost=function(){return table.wenshis[this.id].phaseupitem},Object.defineProperty(n.prototype,"PartName",{get:function(){return lang.String(t[this.pos])},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"FightPower",{get:function(){for(var e=this.qualityfp,t=0;t<this.baseattributes.length;t++)if(null!=this.baseattributes[t]){var n=this.baseattributes[t];e+=Buff.GetFightingPower(n.id,n.values)}for(var t=0;t<this.qualityattributes.length;t++)if(null!=this.qualityattributes[t]){var n=this.qualityattributes[t];e+=Buff.GetFightingPower(n.id,n.values)}return e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Icon",{get:function(){return table.wenshis[this.id].icon},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Name",{get:function(){return table.wenshis[this.id].name},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Desc",{get:function(){return table.wenshis[this.id].desc},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Quality",{get:function(){return this.quality},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Type",{get:function(){return 21},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Count",{get:function(){return 1},enumerable:!0,configurable:!0}),n.prototype.Use=function(){this.Usable&&PlayerAttribute.useItem(this.BagId)},Object.defineProperty(n.prototype,"Usable",{get:function(){return!0},enumerable:!0,configurable:!0}),n}();e.WenShi=n,__reflect(n.prototype,"Item.WenShi",["Item.IItem"])}(Item||(Item={}));var net;!function(e){function t(){e.def=dcodeIO.ProtoBuf.loadJson(RES.getRes("protocol.json")).build("protocol")}function n(){null==e.socket&&(e.socket=new i),e.reload?window.location.reload():e.socket.connect()}e.init=t,e.reload=!1,e.connect=n,e.kicked=!1;var i=function(){function t(){this.connecting=!1,this.retry=0,this.closeNotice=null,this.needReloadWeb=!1,this.cache=new egret.ByteArray,this.cache.endian=egret.Endian.LITTLE_ENDIAN,this.cache2=new egret.ByteArray,this.cache2.endian=egret.Endian.LITTLE_ENDIAN}return Object.defineProperty(t.prototype,"hashCode",{get:function(){return null!=this.webSocket?this.webSocket.hashCode:null},enumerable:!0,configurable:!0}),t.prototype.onLoginResult=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,i;return __generator(this,function(a){switch(a.label){case 0:return t=e.result,1!=t?[3,5]:(Game.dispatcher.dispatchEventWith(Game.EVENT.LoadingSuccess),ServerSession.setToken(e.token),n=e.name,null!=n&&""!=n?[3,2]:[4,UI.CreateRole.open()]);case 1:return a.sent(),[3,4];case 2:return[4,Game.start()];case 3:a.sent(),a.label=4;case 4:return[2];case 5:switch(Game.dispatcher.dispatchEventWith(Game.EVENT.LoadingFailed),i=e.getReason(),t){case 9:this.closeNotice=lang.String("LoginResult VersionNotMatch"),this.needReloadWeb=!0;break;case 5:this.closeNotice=lang.String("LoginResult AccountForbidden");break;case 2:this.closeNotice=lang.String("LoginResult AlreadyLogin");break;case 4:this.closeNotice=lang.String("LoginResult UnderMaintenance");break;case 8:this.closeNotice=lang.String("LoginResult RenameForbidden");break;case 6:return ImmigrateServer.running?(ImmigrateServer.running=!1,this.recconnect()):(ServerSession.setToken(null),this.recconnect()),[2];case 7:return ImmigrateServer.running=!0,ServerSession.setToken(e.token),ImmigrateServer.url=e.tranUrl,this.recconnect(),[2];case 3:default:this.closeNotice=lang.String("LoginResult LoginFailed")}return[2]}})})},t.prototype.connect=function(){return this.connected?void egret.log("[WARING] connected"):this.connecting?void egret.log("[WARING] connecting"):(this.webSocket=new egret.WebSocket,this.webSocket.type=egret.WebSocket.TYPE_BINARY,this.webSocket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this.webSocket.addEventListener(egret.Event.CONNECT,this.onSocketConnected,this),this.webSocket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketClose,this),this.webSocket.addEventListener(egret.Event.CLOSE,this.onSocketClose,this),ImmigrateServer.running?(egret.log("[INFO] connect to "+ImmigrateServer.url),this.webSocket.connectByUrl(ImmigrateServer.url)):(egret.log("[INFO] connect to "+e.server.url),this.webSocket.connectByUrl(e.server.url)),this.connecting=!0,void(e.kicked=!1))},t.prototype.recconnect=function(){return null==this.webSocket||this.webSocket.connected?(this.webSocket.removeEventListener(egret.Event.CONNECT,this.onSocketConnected,this),this.webSocket.removeEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this.webSocket.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketClose,this),this.webSocket.removeEventListener(egret.Event.CLOSE,this.onSocketClose,this),Scene.clear(),this.webSocket.close(),this.webSocket=null,GameTick.stop(),this.connecting=!1,void this.connect()):void this.connect()},t.prototype.close=function(){(null==this.webSocket||this.webSocket.connected)&&(this.webSocket.removeEventListener(egret.Event.CONNECT,this.onSocketConnected,this),this.webSocket.removeEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this.webSocket.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketClose,this),this.webSocket.removeEventListener(egret.Event.CLOSE,this.onSocketClose,this),this.webSocket.close(),this.webSocket=null,GameTick.stop(),Scene.clear(),loadingLayer.removeChildren(),this.connecting=!1)},Object.defineProperty(t.prototype,"connected",{get:function(){return null!=this.webSocket&&this.webSocket.connected},enumerable:!0,configurable:!0}),t.prototype.flush=function(){this.connected&&this.webSocket.flush()},t.prototype.onSocketConnected=function(){this.connecting=!1,this.retry=0,this.closeNotice=null,this.needReloadWeb=!1,this.login()},t.prototype.login=function(){var t=new e.def.C2SLogin;Account.guid?(t.uid=Account.guid,egret.log("login guid="+Account.guid)):(t.channel=Account.channel,t.uid=Account.uid,t.sign=Account.sign,t.timestamp=Account.timestamp,egret.log("login channel="+t.channel+" uid="+t.uid));var n=ServerSession.getToken();t.server=e.server.id,null!=n&&(t.token=n),t.gameVer=table.gameVersion.ver,t.osName=egret.Capabilities.os,this.write(1,t.toArrayBuffer())},t.prototype.onSocketClose=function(){var t=this;ImmigrateServer.running?this.retry>3?ImmigrateServer.running=!1:this.retry++:this.retry>3?window.location.reload():this.retry++,this.webSocket.removeEventListener(egret.Event.CONNECT,this.onSocketConnected,this),this.webSocket.removeEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this.webSocket.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketClose,this),this.webSocket.removeEventListener(egret.Event.CLOSE,this.onSocketClose,this),this.webSocket.close(),ImmigrateServer.running?egret.log("[INFO] disconnet from "+ImmigrateServer.url):egret.log("[INFO] disconnet from "+e.server.url),GameTick.stop(),Scene.clear(),this.connecting=!1,Game.dispatcher.dispatchEventWith(Game.EVENT.LoadingFailed);var n=function(){return t.needReloadWeb?window.location.reload():t.recconnect(),!0},i=function(){return UIManager.set(new UI.ServerListUI),!0
},a=function(){return!1};UI.ConfirmBox.Show(UI.ConfirmBoxStyle.reconnect,lang.String("prompt title"),this.closeNotice||lang.String("socket disconnet"),n,i,a)},t.prototype.write=function(e,t){var n,i=0;null!=t&&(i=t.byteLength,n=this.cache2,n.buffer=t,n.position=i);var a=this.cache;a.clear(),a.writeUnsignedShort(i+2),a.writeUnsignedShort(e),i>0&&a.writeBytes(n,0,i),this.connected&&this.webSocket.writeBytes(a,0,a.length)},t.prototype.onReceiveMessage=function(t){if(t.target!=this.webSocket)return void egret.warn("e.target("+t.target.hashCode+") != this.webSocket("+this.webSocket.hashCode+")");null==this.buf&&(this.buf=new egret.ByteArray,this.buf.endian=egret.Endian.LITTLE_ENDIAN);var n=this.cache2;for(n.clear(),this.webSocket.readBytes(n),n.position=0,this.buf.writeBytes(n),this.buf.position=0;this.buf.readAvailable>2;){var i=this.buf.readUnsignedShort();if(this.buf.readAvailable<i){this.buf.position-=2;break}var a=this.buf.readUnsignedShort(),r=this.cache2;r.clear(),i-2>0&&this.buf.readBytes(r,0,i-2);var o=e.procfuns[a];null!=o&&o(r.buffer)}if(this.buf.readAvailable>0){var s=this.cache2;s.clear(),s.writeBytes(this.buf,this.buf.position),s.position=0,this.buf.clear(),this.buf.writeBytes(s)}else this.buf.clear()},t}();e.Socket=i,__reflect(i.prototype,"net.Socket")}(net||(net={}));var net;!function(e){function t(t){var n=e.def.S2CCharCreated.decode(t),i=Character.generate();i.Id=n.id,i.load(n.kind,n.isMirror,n.templateId,n.faction,n.avatar),i.SetGuildName(n.guildName),i.SetCamp(n.camp),i.SetMaxLife(n.maxLife),i.SetLife(n.life),i.SetName(n.name),i.SetSeries(n.series),i.addSceneTitle(n.titleType,n.titleId),i.AttackSpeed=n.attackSpeed,i.SetMoveSpeed(n.speed);var a=n.getDir();egret.$TempPoint.setTo(n.posX,n.posY),i.locate(a,egret.$TempPoint),0==n.superWeaponEffect||!i.isMirror&&1!=i.kind||i.actor.updateSuperWeaponEffect(n.superWeaponEffect),i.updateCommonTitle(n.commonTitle),i.updateFactionTitle(n.factionTitle),mapCharacter[i.Id]=i,Scene.addChild(i.actor);var r=table.npc_dialogues[n.templateId];r&&(mapSpeech[i.Id]=new Speech(i.Id,r))}function n(t){var n=e.def.S2CObjCreated.decode(t),i=n.templateId,a=n.id,r=egret.Point.create(n.posX,n.posY),o=ECS.GameObject.generate(),s=table.objs[i],l=ECS.SceneObjectComponent.generate(a,s,o);l.x=r.x,l.y=r.y,null!=l.head&&(""!=n.name&&(l.head.roleName=n.name),null!=s.title&&""!=s.title?(l.head.updateGuildName(s.title),null!=s.titleColor&&""!=s.titleColor&&l.head.updateGuildNameColor(parseInt(s.titleColor,16))):l.head.updateGuildName(""));var u=null;0!=s.touchEnabled&&(u=function(e){AI.stopMove(),AI.TouchObj(a)});var c=ECS.DisplayContainerComponent.generate(u,o);if(o.addComponent(c),o.addComponent(l),s.dialogue){var h=table.actor[s.resource],d=0;h&&(d=-h.head);var p=ECS.SpeechBubbleComponent.generate(s.dialogue,0,d,o);o.addComponent(p)}switch(s.type){case"mc":var g=ECS.MovieClipRenderer.generate("actor/"+s.resource+"/st_1.json","st_1",o);g.onloaded=function(){c.container.addChildAt(g.movieClip,0)},o.addComponent(g);break;case"db":var m=ECS.DragonBoneRenderer.generate(s.resource,o);m.playTimes=0,s.status&&(m.animationName=s.status[n.status]),m.onloaded=function(){var e=m.armatureDisplay;e.touchEnabled=!1,c.container.addChildAt(e,0)},o.addComponent(m)}switch(ECS.world.add(o),l.mark=n.mark,c.container.x=r.x,c.container.y=r.y/GameMap.ratioY,s.layer){case"role":Scene.addChild(c.container);break;case"ground":Scene.addChildToGround(c.container)}}function i(t){var n=e.def.S2CObjGone.decode(t),i=ECS.SceneObjectComponent.objs[n.id];i.gameobject.destory()}function a(t){var n=e.def.S2CCharGone.decode(t),i=mapCharacter[n.id];if(null==i)return void egret.error("[S2CCharGone] id="+n.id+" not found");var a=mapSpeech[i.Id];null!=a&&(a.release(),delete mapSpeech[i.Id]),i.doGone()}function r(t){var n=e.def.S2CPlayer.decode(t),i=n.mapId;World.pkAllowed=n.pkAllowed;var a=Player.instance;a.Id=n.id,a.load(1,!1,n.templateId,n.faction,n.avatar);var r=table.faction[n.faction];a.Series=r.series,PlayerAttribute.faction=n.faction,a.SetGuildName(n.getGuildName()),a.guildPos=n.getGuildPos(),Meridian.load(n.meridians),a.SetCamp(n.camp),a.SetMaxLife(n.maxLife),a.SetLife(n.life),a.SetName(n.name),a.SetSeries(a.Series),a.SetMoveSpeed(n.speed),PlayerAttribute.Level=n.level,a.AttackSpeed=n.attackSpeed,a.gender=n.gender,PlayerAttribute.MaxExp=table.level[PlayerAttribute.Level].exp,PlayerAttribute.Exp=parseInt(n.exp,10),PlayerAttribute.SetRage(n.rage),PlayerAttribute.SetRageRecoverySpeed(n.rageRecoverySpeed),PlayerAttribute.strength=n.strength,PlayerAttribute.agility=n.agility,PlayerAttribute.outerPower=n.outerPower,PlayerAttribute.innerPower=n.innerPower,PlayerAttribute.abilitypoint=n.abilityPoint,a.addSceneTitle(n.titleType,n.titleId),egret.$TempPoint.setTo(n.posX,n.posY),a.locate(n.dir,egret.$TempPoint),n.login&&PlayerAttribute.loadFactionSkill(),PlayerAttribute.ClearCoolDown();for(var o=n.getSkill(),s=0;s<o.length;s++){var l=o[s],u=l.id;PlayerAttribute.updateCoolDown(u,l.cooldown),PlayerAttribute.SetSkilllevel(u,l.lv),PlayerAttribute.SetSkillExtendLevel(u,l.extlv)}Game.dispatcher.dispatchEventWith(Game.EVENT.UpdateSkill);for(var s=0;s<n.skillSlots.length;s++){var u=n.skillSlots[s],l=Skill.mapSkill[u];PlayerAttribute.skillSlots[s]={id:u,name:l.name,icon:l.icon}}if(PlayerAttribute.UpdateRageSkill(!0),PlayerAttribute.skillpoint=n.skillpoint,n.login)PlayerAttribute.bag.Clean(),PlayerAttribute.Equips={},PlayerAttribute.books={},PlayerAttribute.enhancement=[0,0,0,0,0,0,0,0],Game.isCrossServer()||(TaohuaIsland.getStatus(),UI.battle.onLightLoginButton()),Game.dispatcher.dispatchEventWith(Game.EVENT.Login);else{UI.battle.onLittleBossInfo();var c=PlayerAttribute.superWeapons.wearId;a.actor.updateSuperWeaponEffect(c)}a.init(),PlayerAttribute.UpdateFightingPower(!1),BlackList.Init(),RecentContact.Init(),a.updateCommonTitle(n.commonTitle),a.updateFactionTitle(n.factionTitle),badge.playerBadge(),AI.load(),Game.isWildMap()?UI.battle.onEnterWild():UI.battle.onLeaveWild(),UI.HUD.instance.SetSkillBar("normal"),Reminder.checkReminder(),mapCharacter[a.Id]=a,Scene.addChild(a.actor),Scene.focus(-1),GameTick.start(),PlayerAttribute.Level>=TenfoldAward.LIMIT_LEVEL&&UI.battle.addDExpBtn();var h=table.maps[i].scene;null!=h&&(h!=CityHome.scene&&UIManager.restart(),Scene.onEnterMap(h)),Game.removeFromParent.apply(Scene.loadingView),PlayerAttribute.UpdateFightingPower(!1),PartnerNpcManager.delayFighting(),UI.closeGathering()}function o(t){var n=e.def.S2CPosition.decode(t),i=n.getId(),a=mapCharacter[i];if(null==a)return void egret.error("[S2CPosition] id="+i+" not found");var r=new egret.Point(n.posX,n.posY),o=egret.Point.distance(a.logicPos,r);a.clearCommand(),0!=o&&(a.revisePos=null,a.locate(a.dir64,r))}function s(t){var n=e.def.S2CRunRevise.decode(t),i=Player.instance,a=new egret.Point(n.posX,n.posY),r=new egret.Point(n.desX,n.desY);if(!a.equals(i.logicPos))if(a.equals(r))i.revisePos=a,i.navClear(),i.moveTo(r,!0);else if(!Scene.reachable(a,r,i.MoveSpeed/Game.ServerFPS))return i.revisePos=a,i.navClear(),void i.moveTo(a,!0)}function l(t){var n=e.def.S2CRun.decode(t),i=n.id,a=mapCharacter[i];if(null==a)return void egret.error("[S2CRun] id="+i+" not found");var r=Player.instance,o=new egret.Point(n.posX,n.posY),s=new egret.Point(n.desX,n.desY);return a.frozenTime=0,a.stunTime=0,0!=a.actor.frozen&&(a.actor.frozen=!1),o.equals(a.logicPos)||Scene.reachable(o,s,a.MoveSpeed/Game.ServerFPS)?void a.moveTo(s,!1):(a.revisePos=o,r.Id==a.Id&&r.navClear(),void a.moveTo(o,!0))}function u(t){var n=e.def.S2CStand.decode(t),i=n.getId(),a=mapCharacter[i];if(null==a)return void egret.error("[S2CStand] id="+i+" not found");a.clearCommand(),i==Player.instance.Id&&PlayerAttribute.ClearCoolDown();var r=a.logicPos;if(r.x!=n.posX||r.y!=n.posY){var o=n.dir;a.locate(o,new egret.Point(n.posX,n.posY))}}function c(t){var n=e.def.S2CCharSkill.decode(t),i=n.getCaster(),a=mapCharacter[i];if(null==a)return void egret.error("[S2CCharSkill] id="+i+" not found");var r=egret.Point.create(n.casterPosX,n.casterPosY);a.logicPos.equals(r)||(a.revisePos=r,a.moveTo(a.revisePos,!0));var o=n.getSkillId();a.CastCharSkill(o,n.level,n.getTarget())}function h(t){var n=e.def.S2CAoeSkill.decode(t),i=n.getCaster(),a=mapCharacter[i];if(null==a)return void egret.error("[S2CAoeSkill] id="+i+" not found");var r=n.getSkillId(),o=egret.Point.create(n.casterPosX,n.casterPosY);a.logicPos.equals(o)||(a.revisePos=o,a.moveTo(a.revisePos,!0)),egret.$TempPoint.setTo(n.posX,n.posY),a.CastAoeSkill(r,n.level,egret.$TempPoint)}function d(t){var n=e.def.S2CDirSkill.decode(t),i=n.getCaster(),a=n.getSkillId(),r=n.getDir(),o=mapCharacter[i];if(null==o)return void egret.error("[S2CDirSkill] id="+i+" not found");var s=egret.Point.create(n.casterPosX,n.casterPosY);o.logicPos.equals(s)||(o.revisePos=s,o.moveTo(o.revisePos,!0)),o.CastDirSkill(a,n.level,r)}function p(t){var n=e.def.S2CLife.decode(t),i=n.getId();if(null==mapCharacter[i])return void egret.error("procS2CLife",i);var a=n.getLife(),r=a-mapCharacter[i].Life;mapCharacter[i].SetLife(a),0>=a&&mapCharacter[i].doDie(),Player.instance.Id==i&&(Player.instance.onLifeChange(r),0>=a&&UI.openGathering(5e3,3))}function g(t){var n=e.def.S2CRevive.decode(t),i=n.getId();if(null==mapCharacter[i])return void egret.error("[S2CRevive] id="+i+" not found");var a=Player.instance;i==a.Id;var r=n.getDir();mapCharacter[i].locate(r,new egret.Point(n.getPosX(),n.getPosY())),mapCharacter[i].doRevive(n.getLife()),UI.closeGathering()}function m(t){var n,i=e.def.S2CMarqueeAnnounce.decode(t),a=i.params;a.length>0?n=lang.StringWithFormat.apply(lang,[i.message].concat(a)):(n=lang.String(i.message),null==n&&(n=i.message)),i.up?announce.AB.push(i.priority,n,null):announce.C.push(i.priority,n,null)}function f(t){var n=e.def.S2CLoginResult.decode(t),i=Game.serverMode;Game.serverMode=n.serverMode,Game.mergeServer=n.mergeServer,Game.isCrossServer()||(Game.eraDay=n.eraDay||Game.eraDay,Game.openServerTime=n.eraTime),Game.setServerTime(n.getServerTime()),i!=Game.serverMode&&ChatSys.clearAllChannel(),e.socket.onLoginResult(n),Guild.showLoginGuildAnnounce=!0,badge.login(),collectCardManager.onLogin()}function v(t){var n=e.def.S2CCreateRoleResult.decode(t);UI.CreateRole.onCreateRoleResult(n)}function y(t){var n=e.def.S2CExpChange.decode(t),i=n.change;if(PlayerAttribute.AddExp(parseInt(i,10)),n.show)PopUpMessage.push(lang.StringWithFormat("exp:{1}",i),color.GREEN);else{var a=Player.instance.actor;null!=a&&a.popExp(parseInt(i,10))}}function b(t){var n=e.def.S2CExpChange.decode(t),i=n.change;parseInt(i,10)>0&&PopUpMessage.push(lang.StringWithFormat("collect card get {1} exp",i),color.GREEN)}function S(t){var n=e.def.S2CLevelChange.decode(t),i=n.maxLife,a=Player.instance;a.SetMaxLife(i),a.SetLife(i),PlayerAttribute.doLevelUp(n.level,parseInt(n.exp,10))}function E(t){var n=e.def.S2CRegisterCustomChannel.decode(t);ChatSys.registerCustomChannel(n.getChannelId())}function C(t){var n=e.def.S2CUnRegisterCustomChannel.decode(t);ChatSys.unRegisterCustomChannel(n.getChannelId())}function T(t){var n=e.def.S2CChat.decode(t);ChatSys.push2(n.sender,n.getSenderIdentity(),n.message,n.attachments,n.channel,n.senderFaction,0,"",!1)}function I(t){var n,i=e.def.S2CChatSys.decode(t);return n=i.params.length>0?lang.StringWithFormat.apply(lang,[i.message].concat(i.params)):lang.String(i.message),null==n?void egret.error("[S2CChatSystem] "+i.message+" lang not found"):void ChatSys.push2("",ChatSys.Identity.Sender_Identity_None,n,i.attachments,i.channel,0,0,"",!0)}function G(t){var n=e.def.S2CChatPrivate.decode(t);ChatSys.push2(n.sender,ChatSys.Identity.Sender_Identity_None,n.message,n.attachments,ChatSys.channel_private,n.senderFaction,n.receiverFaction,n.receiver,!1)}function A(t){var n,i=e.def.S2CChatSystemPrivate.decode(t);return n=i.params.length>0?lang.StringWithFormat.apply(lang,[i.message].concat(i.params)):lang.String(i.message),null==n?void egret.error("[S2CChatSystemPrivate] "+i.message+" lang not found"):void ChatSys.push2(i.sender,ChatSys.Identity.Sender_Identity_None,n,null,ChatSys.channel_private,i.senderFaction,i.receiverFaction,i.receiver,!0)}function k(t){var n=e.def.S2CRush.decode(t),i=n.id,a=mapCharacter[i];if(null==a)return void egret.error("[S2CRush] id="+i+" not found");var r=n.posX,o=n.posY,s=n.desX,l=n.desY,u=n.speed;a.logicPos=new egret.Point(r,o),a.rushTo(new egret.Point(s,l),u)}function P(t){var n=e.def.S2CMoveSpeedChange.decode(t),i=n.getId(),a=n.getSpeed(),r=mapCharacter[i];return null==r?void egret.error("[S2CSpeedChange] id="+i+" not found"):void r.changeSpeed(a)}function w(t){var n=e.def.S2CAttackSpeedChange.decode(t),i=n.getId(),a=n.getSpeed(),r=mapCharacter[i];return null==r?void egret.error("[S2CAttackSpeedChange] "+i):void(r.AttackSpeed=a)}function L(t){var n=e.def.S2CSkillDamage.decode(t),i=n.getStrike()||!1,a=n.getSkillId(),r=n.getDamage();Player.instance.onSkillHurt(a,r,i)}function R(t){var n=e.def.S2CSkillHit.decode(t),i=n.skillId,a=n.target,r=n.damage,o=n.strike,s=mapCharacter[a];return null==s?void egret.error("[S2CSkillHit] id="+a+" skillId="+i):void s.onSkillHurt(i,r,o)}function U(e){Player.instance.actor.popImageDodge(!0)}function _(t){for(var n=e.def.S2CSkillMiss.decode(t),i=n.getTarget(),a=0;a<i.length;a++){var r=i[a].getId(),o=mapCharacter[r];if(null==o)return void egret.error("[S2CSkillMiss] id="+r+" not found");o.actor.popImageDodge(!1)}}function x(t){var n=e.def.S2CItem.decode(t),i=n.getId(),a=Item.makeProp(n);PlayerAttribute.AddItem({Id:i,Item:a})}function M(t){var n=e.def.S2CItemUpdateInfo.decode(t);PlayerAttribute.UpdateItemInfo(n.id,n.count,n.expired)}function D(t){var n=e.def.S2CItemRemoveInfo.decode(t),i=PlayerAttribute.RemoveItem(n.id);Game.dispatcher.dispatchEventWith(Game.EVENT.RemoveItem,!1,i,!1)}function N(t){for(var n=e.def.S2CRemoveItems.decode(t),i=0;i<n.ids.length;i++){var a=PlayerAttribute.RemoveItem(n.ids[i]);Game.dispatcher.dispatchEventWith(Game.EVENT.RemoveItem,!1,a,!1)}}function F(t){var n=e.def.S2CResetSkillLv.decode(t);if(null!=n.skillPoint){PlayerAttribute.skillpoint=n.getSkillPoint();var i=PlayerAttribute.skills;for(var a in PlayerAttribute.passiveSkill)PlayerAttribute.passiveSkill[a].level=1;for(var r=0;r<i.length;r++)PlayerAttribute.SetSkilllevel(i[r].Id,1);PlayerAttribute.UpdateFightingPower(!0),Game.dispatcher.dispatchEventWith(Game.EVENT.UpdateSkill)}}function O(t){var n=e.def.S2CSkillLeveup.decode(t);n.skillLevel>1&&PlayerAttribute.skillpoint--,PlayerAttribute.SetSkilllevel(n.getSkillId(),n.getSkillLevel()),Game.dispatcher.dispatchEventWith(Game.EVENT.UpdateSkill)}function B(t){var n=e.def.Value.decode(t);PlayerAttribute.strength=n.getValue(),Game.dispatcher.dispatchEventWith(Game.EVENT.AbilityPoint)}function W(t){var n=e.def.Value.decode(t);PlayerAttribute.agility=n.getValue(),Game.dispatcher.dispatchEventWith(Game.EVENT.AbilityPoint)}function V(t){var n=e.def.Value.decode(t);PlayerAttribute.innerPower=n.getValue(),Game.dispatcher.dispatchEventWith(Game.EVENT.AbilityPoint)}function q(t){var n=e.def.Value.decode(t);PlayerAttribute.outerPower=n.getValue(),Game.dispatcher.dispatchEventWith(Game.EVENT.AbilityPoint)}function H(t){var n=e.def.S2CStatusEffect.decode(t),i=n.target,a=n.effect,r=n.time,o=mapCharacter[i];return null==o?void egret.error("[S2CSkillEffect] id="+i):(egret.$TempPoint.setTo(n.posX,n.posY),void o.onStatusEffect(egret.$TempPoint,a,r))}function j(t){var n=e.def.S2CSkillEffect.decode(t),i=n.target,a=n.skillId,r=n.skillLevel,o=mapCharacter[i];return null==o?void egret.error("[S2CSkillEffect] id="+i):void o.onSkillEffect(a,r)}function Y(t){var n=e.def.S2CAbilityPointChange.decode(t);PlayerAttribute.abilitypoint=n.getAbilityPoint(),Game.dispatcher.dispatchEventWith(Game.EVENT.AbilityPoint)}function K(t){var n=e.def.S2CMaxLifeChange.decode(t),i=n.getId(),a=n.getMaxLife(),r=mapCharacter[i];return null==r?void egret.error("[S2CMaxLifeChange] id="+i+" not found"):void r.SetMaxLife(a)}function Q(t){var n=e.def.S2CDetailAttribute.decode(t);null!=Player.instance&&Player.instance.SetMaxLife(n.getMaxlife());var i=PlayerAttribute.fa;i.Attack=n.getAttack(),i.Defense=n.getDefense(),i.Defense<0&&!test.debugAttribute&&(i.Defense=0),i.Hit=n.getHit(),i.Dodge=n.getDodge(),i.Strike=n.getStrike(),i.AntiStrike=n.getAntiStrike(),i.SeriesAggravation=n.getSeriesAggravation(),i.SeriesMitigation=n.getSeriesMitigation(),i.SeriesAttack=n.getSeriesAttack(),i.SeriesDefense=n.getSeriesDefense();for(var a=0;a<i.SeriesDefense.length;a++)i.SeriesDefense[a]<0&&!test.debugAttribute&&(i.SeriesDefense[a]=0);i.Luck=n.getLuck(),i.LifeSteal=n.getLifeSteal(),i.NeglectDefense=n.getNeglectDefense(),i.SeriesNeglectDefense=n.getSeriesNeglectDefense(),i.RecoverLife=n.getRecoverLife(),i.DamageBounce=n.getDamageBounce(),i.ReduceImmobilizedTime=n.getReduceImmobilizedTime(),i.ReduceRetardTime=n.getReduceRetardTime(),i.ReduceDizzyTime=n.getReduceDizzyTime(),i.ReduceWeakenTime=n.getReduceWeakenTime(),i.ReduceToxicTime=n.getReduceToxicTime(),i.EnhanceImmobilizedTime=n.getEnhanceImmobilizedTime(),i.EnhanceRetardTime=n.getEnhanceRetardTime(),i.EnhanceWeakenTime=n.getEnhanceWeakenTime(),i.DizzyAddition=n.getDizzyAddition(),i.EnhanceToxicTime=n.getEnhanceToxicTime(),i.StrikeDamageAggravation=n.strikeDamageAggravation,i.StrikeDamageMitigation=n.strikeDamageMitigation,i.JueXueAttack=n.jueXueAttack,i.JueXueDefence=n.jueXueDefence,i.JueXueStrike=n.jueXueStrike,i.JueXueAntiStrike=n.jueXueAntiStrike,i.JueXueAttackAggravation=n.jueXueAttackAggravation,i.JueXueAttackMitigation=n.jueXueAttackMitigation,UIManager.pushPage(UI.AttributeInstrUI.instance)}function X(t){var n=e.def.S2CDrop.decode(t);dropAnimition.DropItem(n.x,n.y,n.list,n.copperCoin)}function J(t){var n=e.def.S2CEquipList.decode(t),i=n.getEquips();if(null!=i){for(var a={},r=0;r<i.length;r++){var o=i[r];a[o.getPart()]=new Item.Equip(o,PlayerAttribute.faction)}PlayerAttribute.mountEquips(a)}}function z(t){var n=e.def.S2CEquipChange.decode(t),i=new Item.Equip(n.getEquip(),PlayerAttribute.faction);PlayerAttribute.mountEquip(i)}function Z(t){var n=e.def.S2CAddEquip.decode(t),i=n.getId()||-1,a=(n.getEquip(),new Item.Equip(n.getEquip(),PlayerAttribute.faction));if(PlayerAttribute.AddItem({Id:i,Item:a}),Setting.AutoSellEquip()&&PlayerAttribute.Level>=20&&Setting.Smelt(a.Quality)){var r=new e.def.C2SSingleSmelting;r.setId(i),r.setForceDelete(!1),e.socket.write(40,r.toArrayBuffer())}}function $(t){var n=e.def.S2CBagPartnerEquip.decode(t),i=n.getEquipInfo(),a=new Item.PartnerEquip(i.getId(),i.getStar());a.BagId=n.getId(),PlayerAttribute.AddItem({Id:n.getId(),Item:a})}function et(t){for(var n=e.def.S2CBagPartnerEquipList.decode(t),i=n.getParterEquipList(),a=0;a!=i.length;a++){var r=i[a].getEquipInfo(),o=new Item.PartnerEquip(r.getId(),r.getStar());o.BagId=i[a].getId(),PlayerAttribute.bag.AddItem({Id:i[a].getId(),Item:o})}}function tt(t){var n=e.def.S2CSyncEnhancement.decode(t),i=n.getLevel();if(null!=i){for(var a=0;a<i.length;a++)PlayerAttribute.enhancement[a]=i[a];EnhancementRequire.onResetRequire(),PlayerAttribute.UpdateFightingPower(!1)}}function nt(t){for(var n=e.def.S2CBagItemList.decode(t),i=n.items,a=0;a<i.length;a++){var r=i[a],o=r.getId(),s=Item.makeProp(r);PlayerAttribute.bag.AddItem({Id:o,Item:s})}null==UI.TreasureUse.instance.parent&&UI.TreasureUse.instance.Check(),Game.dispatcher.dispatchEventWith(Game.EVENT.BagItemChange)}function it(t){for(var n=e.def.S2CBagEquipList.decode(t),i=n.getEquips(),a=0;a<i.length;a++){var r=i[a],o=r.getId(),s=new Item.Equip(r.getEquip(),PlayerAttribute.faction);PlayerAttribute.bag.AddItem({Id:o,Item:s})}Game.dispatcher.dispatchEventWith(Game.EVENT.BagItemChange)}function at(t){var n=e.def.S2CSyncCurrency.decode(t);PlayerAttribute.SyncCurreny(n.currency);for(var i=Game.Currency.GoldCoin;i<Game.Currency.Count;i++)Game.dispatcher.dispatchEventWith(Game.EVENT.CurrencyChange[i],!1,n.currency[i])}function rt(t){var n=e.def.S2CCurrencyChange.decode(t);PlayerAttribute.ChangeCurreny(n.kind,n.delta),Game.dispatcher.dispatchEventWith(Game.EVENT.CurrencyChange[n.kind],!1,n.delta)}function ot(t){var n=e.def.S2CCampChange.decode(t),i=n.id,a=mapCharacter[i];return null==a?void egret.error("[S2CCampChange] id="+i):void a.SetCamp(n.camp)}function st(t){var n=e.def.S2CEnhancementChange.decode(t),i=n.part,a=n.level;PlayerAttribute.enhancement[i]=a,PlayerAttribute.UpdateFightingPower(!0),EnhancementRequire.resetRequire(),Game.dispatcher.dispatchEventWith(Game.EVENT.EnhanceSuccess,!1,i)}function lt(t){var n=e.def.S2CHalo.decode(t),i=n.id,a=mapCharacter[i];return null==a?void egret.error("[S2CHalo]"+i+" not found"):void(1==n.active?a.actor.addHalo(n.halo):a.actor.removeHalo(n.halo))}function ut(t){var n=e.def.S2CTitleChange.decode(t),i=(Player.instance,n.id),a=mapCharacter[i];return null==a?void egret.error("[S2CTitleChange] id="+i+" not found"):void a.addSceneTitle(n.titleType,n.titleId)}function ct(t){var n=e.def.S2CSongjinRankingList.decode(t);SongJin.showRanking(n.list,n.winner)}function ht(t){var n=e.def.S2CChallengeState.decode(t);MasterChallenge.MaxChapter=n.getMaxPassStage(),MasterChallenge.challengeLeft=n.getChallengeLeft(),MasterChallenge.ibLeft=n.getIbLeft(),MasterChallenge.makeBadge(PlayerAttribute.Level),Game.dispatcher.dispatchEventWith(Game.EVENT.SyncMasterChallengeData)}function dt(t){var n=e.def.S2CMasterChallengeInfo.decode(t),i=MasterChallenge.notePanel;null!=i&&(i.gate=n.chapter+1,i.second=n.time)}function pt(t){var n=e.def.S2CWinMasterChallenge.decode(t),i=n.chapter,a=n.time,r=n.awards;MasterChallenge.onVectory(i,a,r)}function gt(t){var n=e.def.S2CLoseMasterChallenge.decode(t),i=n.chapter,a=n.reason;MasterChallenge.onFail(i,a)}function mt(t){var n=e.def.S2CSongjinRank.decode(t);SongJin.updateRank(n.rank)}function ft(t){var n=e.def.S2CSongjinRestTime.decode(t);SongJin.updateRestTime(n.restTime,n.isExperience)}function vt(t){var n=e.def.S2CSongjinCampScore.decode(t);SongJin.updateCampScore(n.songScore,n.jinScore)}function yt(t){var n=e.def.S2CSongjinScore.decode(t);SongJin.updateScore(n.score,n.killScore,n.maxKillStreak,n.assistScore,n.killStreak)}function bt(t){var n=e.def.S2CSongjinCountdown.decode(t);SongJin.updateCountdown(n.time)}function St(t){var n=e.def.S2CSongjinEnrollCount.decode(t);SongJin.updateEnrollCount(n.count)}function Et(t){var n=e.def.S2CSyncOfflineTime.decode(t);0!=n.offlineDuration&&PlayerAttribute.Level<table.maxLevel&&(OfflineTime.syncOfflineTime(n),badge.onLight(badge.action.OfflineAward,!0),UI.openOfflineHandle())}function Ct(t){var n=e.def.S2CBeingReflectedDamage.decode(t),i=mapCharacter[n.id];return null==i?void egret.error("[S2CBeingReflectedDamage] id="+n.id+" not found"):void i.beingReflectedDamage(n.damage)}function Tt(t){e.socket.write(32,t)}function It(t){var n=e.def.S2CSyncCumulativeLogin.decode(t);CumulativeLogin.data=n.toRaw(),CumulativeLogin.onLight(),Game.dispatcher.dispatchEventWith(Game.EVENT.CumulativeLogin)}function Gt(t){var n=e.def.S2CSyncCumulativeLogin.decode(t);CompositeGamesSevenDayGift.data=n.toRaw(),CompositeGamesSevenDayGift.onLight(),Game.dispatcher.dispatchEventWith(Game.EVENT.CompositeGamesSevenDayGift)}function At(t){var n=e.def.S2CTaohuaIslandChances.decode(t);TaohuaIsland.setChances(n.plantChances,n.robChances)}function kt(t){var n=e.def.S2CSyncArenaChances.decode(t);ArenaChallenge.setChances(n.freeChances,n.paidChances,n.boughtTimes)}function Pt(t){var n=e.def.S2CArenaInfo.decode(t);ArenaChallenge.rank=n.getSelfRank(),ArenaChallenge.setChances(n.getFreeChances(),n.getPaidChances(),n.getBoughtTimes()),ArenaChallenge.highestRank=n.getHighestRank(),ArenaChallenge.buyTimes=n.getBoughtTimes(),ArenaChallenge.onS2CArenaInfo(n.getToplist(),n.getRivals(),n.getEnemies())}function wt(t){var n=e.def.S2CArenaBuyChancesRep.decode(t);n.ok?(ArenaChallenge.setChances(null,n.getPaidChances(),n.getBoughtTimes()),Game.dispatcher.dispatchEventWith(Game.EVENT.ArenaChallengeTimes)):PopUpMessage.push(lang.String(n.error),color.RED)}function Lt(t){var n=e.def.S2CArenaDeny.decode(t);PopUpMessage.push(lang.String(n.getReason()),color.GREEN)}function Rt(t){var n=e.def.S2CHuashanPKInfo.decode(t);HuashanPK.syncInfo(n)}function Ut(t){var n=e.def.S2CArenaResult.decode(t);ArenaChallenge.onS2CArenaResult(n)}function _t(t){var n=e.def.S2CSyncHuashanPKDegree.decode(t);HuashanPK.maxRound=n.round,Game.dispatcher.dispatchEventWith(Game.EVENT.SyncHuashanPKDegree)}function xt(t){var n=e.def.S2CSyncHuashanPKResult.decode(t);HuashanPK.onSyncResult(n.getRound(),n.getBWin())}function Mt(t){var n=e.def.S2CHuashanPKRecords.decode(t);HuashanPK.onSyncRecords(n)}function Dt(t){var n=e.def.S2CHuashanPKPlayerInfo.decode(t);HuashanPK.onSyncAchievementAward(n)}function Nt(t){var n=e.def.S2CSyncPlayerGem.decode(t);PlayerGem.ChangeGem(n.Part,n.Socket,n.GemId),Game.dispatcher.dispatchEventWith(Game.EVENT.GemChange,null,n),PlayerAttribute.UpdateFightingPower(!0)}function Ft(e){Meridian.levelUp(),PlayerAttribute.UpdateFightingPower(!0)}function Ot(t){var n=e.def.Times.decode(t);Meridian.useHuiXianDan=n.times}function Bt(t){for(var n=e.def.S2CSyncPlayerGemAll.decode(t),i=0;i<n.parts.length;i++)for(var a=n.parts[i],r=0;r<a.sockets.length;r++)PlayerGem.ChangeGem(i,r,a.sockets[r]);Game.dispatcher.dispatchEventWith(Game.EVENT.SyncGem),PlayerAttribute.UpdateFightingPower(!1)}function Wt(t){var n=e.def.S2CSyncProgressBar.decode(t),i=n.millisecond;0>=i?UI.closeGathering():UI.openGathering(i,n.style)}function Vt(t){var n=e.def.S2CRollDiceResult.decode(t),i=n.point;null!=UI.dice&&UI.dice.setResult(i[0],i[1])}function qt(t){var n=e.def.S2CSeaSunRoshambo.decode(t);null!=UI.roshambo&&UI.roshambo.setResult(n.opponent)}function Ht(e){Mail.onS2CNewmail()}function jt(t){var n=e.def.S2CMailList.decode(t),i=n.getList();Mail.mailTable=[],Mail.mailMapTable={};for(var a=0;a<i.length;a++)Mail.mailTable.push({id:i[a].id,sender:lang.Parse(i[a].sender),title:lang.Parse(i[a].title),sentTime:i[a].sentTime,read:i[a].read,attached:i[a].attached}),Mail.mailMapTable[i[a].id]=a;Mail.onS2CMailTitle()}function Yt(t){for(var n=e.def.S2CMailDetail.decode(t),i=[],a=n.getCurrencies(),r=0;r<a.length;r++)i.push({type:Game.currency2AwardType[a[r].type],content:a[r].amount});for(var o=n.getItems(),r=0;r<o.length;r++)i.push({type:"item",content:{genre:o[r].type,detailType:o[r].detailType,count:o[r].count}});for(var s=n.getEquips(),r=0;r<s.length;r++){var l=new Item.Equip(s[r],PlayerAttribute.faction);i.push({type:"equipInstance",content:l})}var u=n.getExp();u>0&&i.push({type:"exp",content:n.exp});for(var c=n.getPartnerEquips(),r=0;r<c.length;r++)i.push({type:"partnerEquip",content:{id:c[r].getId(),star:c[r].getStar()}});for(var h=n.getJuexues(),r=0;r<h.length;r++){var d=new Item.JueXue;d.Init(h[r]),i.push({type:"juexueInstance",content:{item:d,juexues:PlayerAttribute.juexues}})}for(var p=n.getWenshis(),r=0;r<p.length;r++){var g=new Item.WenShi;g.Init(p[r]),i.push({type:"wenshiInstance",content:g})}Mail.onS2CMailDetail(n.id,lang.Parse(n.content),i)}function Kt(t){var n=e.def.S2CMailWithdrawResult.decode(t);n.getOk()?Mail.onC2SAskmailtitle():(PopUpMessage.push(lang.String("bag room full"),color.RED),Mail.onC2SMaildetail(n.getId()))}function Qt(t){var n=e.def.S2CSyncSeaSunVillageTask.decode(t);SeaSunVillage.syncTask(n)}function Xt(t){var n=e.def.S2CSeaSunData.decode(t);SeaSunVillage.curTimes=n.curTimes,SeaSunVillage.buyTimes=n.buyTimes,Game.dispatcher.dispatchEventWith(Game.EVENT.SeaSunData)}function Jt(t){var n=e.def.S2CTaohuaIslandBattleStatus.decode(t),i=n.getStatus();1==n.planting?TaohuaIsland.s2cBattleStatus(n.planting,i.leftTime,i.harvestCount,i.harvestTime,n.availableTime,n.robChances,n.usedFreeDoubleAwardTimes):TaohuaIsland.s2cBattleStatus(n.planting,0,0,0,n.availableTime,n.robChances,n.usedFreeDoubleAwardTimes)}function zt(t){var n=e.def.S2CTaohuaIslandPlant.decode(t);TaohuaIsland.s2cPlant(n.result)}function Zt(t){var n=e.def.S2CTaohuaIslandHarvest.decode(t);TaohuaIsland.s2cHarvest(n.result)}function $t(t){var n=e.def.S2CTaohuaIslandListRob.decode(t);TaohuaIsland.robs=[];for(var i=n.getTargets(),a=0;a<i.length;a++)TaohuaIsland.robs.push({id:a+1,name:i[a].name,faction:i[a].faction,fp:i[a].fp});TaohuaIsland.s2cListRob()}function en(t){var n=e.def.S2CTaohuaIslandRob.decode(t);TaohuaIsland.s2cRob(n.result,n.count,n.exp)}function tn(t){var n=e.def.S2CTaohuaIslandPurchase.decode(t);TaohuaIsland.s2cPurchase(n.result)}function nn(t){var n=e.def.S2CObjMarkChange.decode(t),i=ECS.SceneObjectComponent.objs[n.id];return null==i?void egret.error("[S2CObjMarkChange] id="+n.id+" not found "):void(i.mark=n.mark)}function an(t){var n=e.def.S2CObjStatusChange.decode(t),i=ECS.SceneObjectComponent.objs[n.id];return null==i?void egret.error("[S2CObjMarkChange] id="+n.id+" not found "):void i.changeStatus(n.status)}function rn(t){return __awaiter(this,void 0,void 0,function(){var n,i;return __generator(this,function(a){return n=e.def.S2CSeaSunTaskResult.decode(t),n.done&&(i=new UI.MovieClipComponent,i.Load("skill/effect_task_complete/effect_task_complete.json","effect_task_complete"),UIManager.pushPage(i),i.horizontalCenter=0,i.verticalCenter=0,i.play(0),egret.setTimeout(function(){i.free(),UIManager.pop(i)},this,1e3)),[2]})})}function on(e){SeaSunVillage.showTask()}function sn(t){return __awaiter(this,void 0,void 0,function(){var n,i,a,r,o,s,l;return __generator(this,function(u){switch(u.label){case 0:return n=e.socket.hashCode,null==Scene.loadingView&&(Scene.loadingView=new LoadingUI),loadingLayer.addChildAt(Scene.loadingView,0),[4,LoadManager.loaded.config];case 1:return u.sent(),[4,LoadManager.load("scene",Scene.loadingView)];case 2:return u.sent(),Actor.init(),i=e.def.S2CLoadMap.decode(t),a=i.mapId,PlayerAttribute.StopUpdateFightingPower(),r=table.maps[a],null==r.preload?[3,4]:(o="map_"+a,RES.isGroupLoaded(o)?[3,4]:(s=r.preload.length,[4,RES.loadGroup(o,0,Scene.loadingView)]));case 3:u.sent(),u.label=4;case 4:return Scene.loadingView.onProgress(0,2),TmpCamp.clear(),Scene.load(a,n),UI.battle.mapName=r.name,l=r.sound,null!=l&&SoundUtil.playBGM(l,!0),[2]}})})}function ln(t){var n=e.def.S2CFenglingdu.decode(t);switch(n.msgid){case 0:PopUpMessage.push(lang.StringWithFormat("fenglingdu condition limit{1}",n.param),color.RED);break;case 1:PopUpMessage.push(lang.StringWithFormat("fenglingdu level limit",n.param),color.RED);break;case 2:PopUpMessage.push(lang.String("fenglingdu join team"),color.GREEN);break;case 3:PopUpMessage.push(lang.StringWithFormat("fenglingdu round count",n.param),color.RED),FenglingBoat.s2cBoatgate(n.param);break;case 4:FenglingBoat.s2cJoincount(n.param);break;case 5:FenglingBoat.s2cSail(n.param);break;case 6:PopUpMessage.push(lang.String("fenglingdu game over"),color.GREEN)}}function un(t){var n=e.def.S2CFenglingduGetStatus.decode(t);FenglingBoat.s2cJointimes(n.getTimes())}function cn(t){var n=e.def.S2CFenglingduResult.decode(t);FenglingBoat.s2cResult(n.getCoopercoin(),n.getExp())}function hn(t){var n=e.def.S2CDamageAbsorb.decode(t),i=mapCharacter[n.id];return null==i?void egret.error("[S2CDamageAbsorb] id="+n.id+" not found"):void i.actor.popImageAbsorb(n.id==Player.instance.Id)}function dn(t){var n=e.def.S2CBleed.decode(t),i=n.id,a=mapCharacter[i];if(null==a)return void egret.error("[S2CBleed] id="+i+" not found");Player.instance;a.bleed(n.damage)}function pn(t){var n=e.def.BagBook.decode(t),i=n.id,a=new Item.Book(n.book);PlayerAttribute.AddItem({Id:i,Item:a})}function gn(t){for(var n=e.def.S2CBagBookList.decode(t),i=n.books,a=0;a<i.length;a++){var r=i[a],o=r.getId(),s=new Item.Book(r.book);PlayerAttribute.bag.AddItem({Id:o,Item:s})}Game.dispatcher.dispatchEventWith(Game.EVENT.BagItemChange)}function mn(t){var n=e.def.S2CBookList.decode(t),i=n.books;if(null!=i){for(var a={},r=0;r<i.length;r++){var o=i[r],s=table.books[o.id].category;a[s]=new Item.Book(o)}PlayerAttribute.mountBooks(a)}}function fn(t){var n=e.def.S2CBookChange.decode(t),i=new Item.Book(n.book);null!=i&&PlayerAttribute.mountBook(i)}function vn(t){var n=e.def.S2CLevelUpBook.decode(t);Player.instance;PlayerAttribute.books[n.category].levelUp(n.index),PlayerAttribute.UpdateFightingPower(!0),Game.dispatcher.dispatchEventWith(Game.EVENT.LevelUpBook,!1,{category:n.category,index:n.index},!1)
}function yn(t){var n=e.def.BookCategory.decode(t);Player.instance;PlayerAttribute.books[n.category].upgrade(),Game.dispatcher.dispatchEventWith(Game.EVENT.UpgradeBook,!1,n.category,!1)}function bn(t){var n=e.def.S2CGuildCreateResult.decode(t);Guild.s2cCreateResult(n.getOk(),n.getGuildName(),n.getError())}function Sn(t){var n=e.def.S2CGuildList.decode(t),i=n.getApplied(),a=n.getOthers();Guild.onSyncGuildList(i,a)}function En(t){var n=e.def.S2CGuildInfo.decode(t);null==Guild.guildInfo&&(Guild.guildInfo=new Guild.guild);var i=n.getInfo(),a=lang.String("online");i.offlineTime>0&&(a=FormatDDHH(60*i.offlineTime)),Guild.guildInfo={name:i.name,level:i.level,leader:i.leader,memberCount:i.memberCount,appliable:i.appliable,offlineTime:a,onlineCount:i.onlineCount,lastTopOnline:i.lastTopOnline},Guild.announce=n.getAnnounce(),Guild.inactiveness=n.getInactiveness(),Guild.needApproval=n.getNeedApproval(),Guild.reputation=n.getReputation(),Guild.weeklyReputation=n.getWeeklyReputation(),Guild.toastTime=n.getToastTime(),Guild.newToastTime=n.getNewToastTime(),Guild.equipBuildLevel=n.getEquipBuildHouseLevel(),Guild.ProcessS2CSyncGuildFund(n.getFund()),Game.dispatcher.dispatchEventWith(Game.EVENT.SyncGuildInfo),PlayerAttribute.UpdateFightingPower(!0),Reminder.onSyncGuildToastTime(n.getToastTime());var r=egret.localStorage.getItem("guildAnnounce");r!=Guild.announce&&""!=Guild.announce&&(egret.localStorage.setItem("guildAnnounce",Guild.announce),egret.localStorage.setItem("needShowGuildAnnounce","1")),Guild.showLoginGuildAnnounce&&""!=Guild.announce&&(Guild.showLoginGuildAnnounce=!1,ChatSys.sendSystemMsg(Guild.announce,ChatSys.channel_guild,""))}function Cn(t){var n=e.def.S2CGuildApplicantList.decode(t),i=n.getApplicants();UI.GuildApplicant.instance.applicants=[];for(var a=0;a<i.length;a++)UI.GuildApplicant.instance.applicants.push(i[a]);UI.GuildApplicant.instance.showApplicants()}function Tn(t){var n=e.def.S2CGuildWelcome.decode(t);Player.instance.SetGuildName(n.guildName),Player.instance.guildPos!=Guild.GuildPosition.GuildPos_Leader?(Player.instance.guildPos=Guild.GuildPosition.GuildPos_Member,Game.removeFromParent.apply(UI.GuildEnroll.instance)):Guild.openGuildHome(),PopUpMessage.push(lang.StringWithFormat("guild welcome {1}",n.guildName),color.RED),Game.dispatcher.dispatchEventWith(Game.EVENT.GuildWelcome)}function In(t){var n=e.def.S2CGuildMemberList.decode(t),i=n.getMembers();Guild.MemberList=[];for(var a=0;a<i.length;a++)Guild.MemberList[a]={name:i[a].getName(),level:i[a].getLevel(),position:i[a].getPosition(),weekContribution:i[a].getWeekContribution(),offlineTime:i[a].getOfflineTime(),faction:i[a].getFaction(),vipLevel:i[a].getVipLevel(),seekhelp:i[a].getSeekHelp(),seekHelpStatus:i[a].getSeekHelpStatus()};Game.dispatcher.dispatchEventWith(Game.EVENT.SyncGuildMemberList)}function Gn(t){var n=e.def.S2CResult.decode(t);n.ok?(Player.instance.SetGuildName(""),Player.instance.guildPos=Guild.GuildPosition.GuildPos_None,Game.dispatcher.dispatchEventWith(Game.EVENT.GuildQuit),Guild.guildInfo&&(Guild.guildInfo.level=0),Guild.ClearGuildWarInfo(),PlayerAttribute.UpdateFightingPower(!0)):PopUpMessage.push(lang.String(n.error),color.RED)}function An(t){var n=e.def.S2CGuildPosition.decode(t);Player.instance.guildPos=n.getPos(),Game.dispatcher.dispatchEventWith(Game.EVENT.GuildPositionChange)}function kn(t){var n=e.def.S2CIsGuildRenameEnable.decode(t);Guild.canRename=n.enabled}function Pn(t){var n=e.def.S2CGuildRenameResult.decode(t);Guild.s2cRenameResult(n.ok,n.name,n.error)}function wn(t){var n=e.def.S2CGuildNameChange.decode(t),i=n.id,a=mapCharacter[i];return null==a?void egret.error("[S2CGuildNameChange] id="+i+" not found"):(a.SetGuildName(n.name),void a.updateIFFS())}function Ln(t){var n=e.def.S2CGuildStartRoshambo.decode(t);Guild.startRoshambo(n.getOpponent())}function Rn(t){var n=e.def.S2CGuildRoshamboResult.decode(t);null!=Guild.roshamboPanel&&Guild.roshamboPanel.setResult(n.choice,n.result)}function Un(t){var n=e.def.S2CGuildManorInfo.decode(t);null!=Guild.notePanel&&Guild.notePanel.setInfo(n.count,n.restTime,n.expRate,n.getWins(),n.getDrinkTimes(),n.getRefreshBoxRestTime(),n.getToastRedPacketRestTime())}function _n(t){var n=e.def.S2CGuildTaskStatus.decode(t),i=n.finish,a=n.tasks;if(Guild.tastStatus=[],a.length>0)for(var r=0;r<a.length;r++)Guild.tastStatus.push({Id:a[r].id,done:a[r].done,task:Guild.guildTaskTable[a[r].id]});UI.GuildHome.instance.guildTask.finishMem=i,UI.GuildHome.instance.guildTask.restSeconds=n.restSeconds,UI.GuildHome.instance.guildTask.onRefresh()}function xn(){badge.onLight(badge.action.GuildNewApplication,!0)}function Mn(t){var n=e.def.S2CGuildError.decode(t);PopUpMessage.push(lang.String(n.error),color.RED)}function Dn(t){var n=e.def.S2CApprovalError.decode(t);PopUpMessage.push(lang.String(n.error),color.RED)}function Nn(t){var n=e.def.S2CResponseGeneralRank.decode(t);Player.instance;Rank.UpdateRankData(n)}function Fn(e){}function On(e){}function Bn(e){}function Wn(e){}function Vn(t){var n=e.def.S2CSyncPartner.decode(t);Partner.onSyncPartnerWithMessage(n,!1)}function qn(t){var n=e.def.S2CSyncPartner.decode(t);Partner.onSyncPartnerWithMessage(n,!0)}function Hn(t){var n=e.def.S2CSyncWorkPartnerList.decode(t);Partner.workList=n.list;for(var i=0;i<Partner.list.length;i++)Partner.list[i].workPos=0;for(var i=0;i<n.list.length;i++){var a=n.list[i];if(a>0){var r=Partner.idMap[a];Partner.list[r].workPos=i+1}0==i&&PlayerAttribute.UpdateRageSkill(!1)}Partner.SortPartnerList(),PlayerAttribute.UpdateFightingPower(!Partner.firstSync),PartnerEquipManager.delayUpdatePartnerEquipBadge(),Partner.firstSync=!1,Game.dispatcher.dispatchEventWith(Game.EVENT.PartnerWorkPosChange)}function jn(t){var n=e.def.RoleBrief.decode(t);friend.friendApplyData.unshift(new friend.RoleBrief(n)),PopUpMessage.push(lang.String("friend new request"),color.RED),friend.onPushRequest()}function Yn(t){var n=e.def.RoleBriefList.decode(t);friend.friendData=[];for(var i=0;i<n.roles.length;i++)friend.friendData.push(new friend.RoleBrief(n.roles[i]));friend.friendData.sort(friend.SortCompare),Game.dispatcher.dispatchEventWith(Game.EVENT.SyncFriends)}function Kn(t){var n=e.def.RoleBriefList.decode(t);friend.friendApplyData=[];for(var i=0;i<n.roles.length;i++)friend.friendApplyData.push(new friend.RoleBrief(n.roles[i]));friend.friendApplyData.length>0&&friend.onPushRequest()}function Qn(t){var n=e.def.RoleBrief.decode(t);friend.friendData.unshift(new friend.RoleBrief(n)),null!=UI.FriendsUI.instance.parent&&UI.FriendsUI.instance.refresh()}function Xn(t){for(var n=e.def.RoleBriefList.decode(t),i=[],a=0;a<n.roles.length;a++)i.push(new friend.RoleBrief(n.roles[a]));return i.sort(friend.SortCompare),Game.dispatcher.dispatchEventWith(Game.EVENT.SearchRoleResult,!1,i),null!=UI.FriendsSearch.instance.parent?void UI.FriendsSearch.instance.setFriendList(i):void 0}function Jn(t){for(var n=e.def.UUID.decode(t),i=0;i<friend.friendData.length;i++)if(friend.friendData[i].uuid.toHex()==n.uuid.toHex()){friend.friendData.splice(i,1);break}UI.FriendsUI.instance.refresh()}function zn(t){var n=e.def.S2CSongjinEnrollResult.decode(t);Game.dispatcher.dispatchEventWith(Game.EVENT.SongjinEnrollResult,!1,n,!1)}function Zn(t){var n=e.def.S2CSongjinTaskData.decode(t);SongJin.data=n,Game.dispatcher.dispatchEventWith(Game.EVENT.SongjinTaskData,!1,n,!1)}function $n(t){for(var n=e.def.S2CSyncPartnerRecruitCD.decode(t),i=0;i<n.cds.length;i++)Partner.recruitCDs[i].delta=n.cds[i];Partner.freeTime=n.freeTimes,Partner.enlistNotice(),Game.dispatcher.dispatchEventWith(Game.EVENT.PartnerRecruitCDSync)}function ei(t){var n=e.def.S2CSyncPartnerRecruitResult.decode(t);if(Partner.lastRecruitResult=n,n.recruit){Partner.recruiting=!1;var i=UI.PetEnlistResult.instance;i.updateAwards(n.awards),1==n.getAwards().length?i.currentState="one":i.currentState="ten",UIManager.push(i)}else UIManager.push(UI.PetEnlistShow.instance.show(0));Game.dispatcher.dispatchEventWith(Game.EVENT.PartnerRecruitResult)}function ti(t){var n=e.def.S2CSyncArenaGoods.decode(t);ArenaShop.nextTime=n.nextTime,ArenaShop.goods=[];for(var i in n.propGoods){var a=n.propGoods[i],r=new Shop.PropGoods;r.param=a.gid,r.pos=a.pos,r.currency=a.currency,r.price=a.price,r.discount=a.discount,r.genre=a.genre,r.detailType=a.detailType,r.count=a.count,r.buy=ArenaShop.buy,ArenaShop.goods[r.pos]=r}for(var o=ArenaShop.goods.length;o<ArenaShop.GoodsCount;o++)ArenaShop.goods[o]=null;Game.dispatcher.dispatchEventWith(Game.EVENT.SyncArenaGoods)}function ni(t){var n=e.def.GoodsPosition.decode(t),i=ArenaShop.goods[n.pos];null!=i&&i.param==n.id&&(ArenaShop.goods[n.pos]=null,Game.dispatcher.dispatchEventWith(Game.EVENT.RemoveArenaGoods))}function ii(t){var n=e.def.S2CSyncMysteryGoods.decode(t);MysteryShop.nextTime=n.nextTime,MysteryShop.goods=[];for(var i in n.equipGoods){var a=n.equipGoods[i],r=new Shop.EquipGoods;r.param=a.gid,r.pos=a.pos,r.currency=a.currency,r.price=a.price,r.discount=a.discount,r.part=a.part,r.id=a.id,r.level=a.level,r.quality=a.quality,r.buy=MysteryShop.buy,r.attributes=a.attributes,MysteryShop.goods[r.pos]=r}for(var i in n.propGoods){var o=n.propGoods[i],r=new Shop.PropGoods;r.param=o.gid,r.pos=o.pos,r.currency=o.currency,r.price=o.price,r.discount=o.discount,r.genre=o.genre,r.detailType=o.detailType,r.count=o.count,r.buy=MysteryShop.buy,MysteryShop.goods[r.pos]=r}for(var s=MysteryShop.goods.length;s<MysteryShop.GoodsCount;s++)MysteryShop.goods[s]=null;Game.dispatcher.dispatchEventWith(Game.EVENT.SyncMysteryGoods)}function ai(t){var n=e.def.GoodsPosition.decode(t),i=MysteryShop.goods[n.pos];null!=i&&i.param==n.id&&(MysteryShop.goods[n.pos]=null,Game.dispatcher.dispatchEventWith(Game.EVENT.RemoveMysteryGoods))}function ri(t){var n=e.def.Times.decode(t);MysteryShop.refreshTimes=n.times,Game.dispatcher.dispatchEventWith(Game.EVENT.SyncMysterRefreshTimes)}function oi(t){var n=e.def.Times.decode(t);ArenaShop.refreshTimes=n.times,Game.dispatcher.dispatchEventWith(Game.EVENT.SyncArenaRefreshTimes)}function si(t){var n,i=e.def.S2CPopUpMessage.decode(t),a=i.params;n=a.length>0?lang.StringWithFormat.apply(lang,[i.message].concat(a)):lang.String(i.message),PopUpMessage.push(n,color.GREEN)}function li(t){var n,i=e.def.S2CPopUpMessage.decode(t),a=i.params;n=a.length>0?lang.StringWithFormat.apply(lang,[i.message].concat(a)):lang.String(i.message),PopUpMessage.push(n,color.RED)}function ui(t){var n=e.def.S2CEventBuffTrigger.decode(t);switch(n.type){case Game.BuffTriggerType.BuffTriggerType_Talent:Features.TalentSkill.instance.OnEventBuffTrigger(n.id,n.level,n.duration);break;case Game.BuffTriggerType.BuffTriggerType_CatchThiefSkill:CatchThief.OnEventBuffTrigger(n.id,n.level,n.duration);break;case Game.BuffTriggerType.BuffTriggerType_TriggerSkill:TriggerSkill.OnEventBuffTrigger(n.id,n.level,n.duration)}}function ci(t){var n=e.def.S2CWildBossInfoList.decode(t);WildBoss.updateMissions(n),Game.dispatcher.dispatchEventWith(Game.EVENT.WildBossInfo)}function hi(t){var n=e.def.S2CEnterWildBossMapResult.decode(t),i={success:n.success,countdownTime:n.info.countdownTime,status:n.info.status};Game.dispatcher.dispatchEventWith(Game.EVENT.EnterWildBossMap,!1,i),WildBoss.onEnterWildBossMapResult(i)}function di(t){var n=e.def.S2CWildBossHurtValue.decode(t);WildBoss.updateRankValue(n.rank,n.value)}function pi(t){var n=e.def.S2CWildBossHurtRanking.decode(t);WildBoss.updateRanking(n)}function gi(t){var n=e.def.S2CWildBossStatus.decode(t);WildBoss.updateStatus(n.status,n.countdownTime)}function mi(t){var n=e.def.S2CLittleBossInfos.decode(t);LittleBoss.updateMissions(n),Game.dispatcher.dispatchEventWith(Game.EVENT.LittleBossInfo)}function fi(t){var n=e.def.S2CWildBossStatus.decode(t);LittleBoss.updateStatus(n.status,n.countdownTime)}function vi(t){var n=e.def.S2CWildBossFinish.decode(t);WildBoss.onMissionEnd(n)}function yi(t){var n=e.def.S2CLittleBossFinish.decode(t);LittleBoss.onMissionEnd(n)}function bi(t){var n=e.def.S2CShieldAdded.decode(t),i=n.id,a=mapCharacter[i];return null==a?void egret.error("[S2CShieldAdded] id="+i+" not found"):void a.actor.addShieldEffect(n.index)}function Si(t){var n=e.def.S2CShieldRemoved.decode(t),i=n.id,a=mapCharacter[i];if(null==a)return void egret.error("[S2CShieldAdded] id="+i+" not found");for(var r=n.index.length,o=0;r>o;o++)a.actor.removeShieldEffect(n.index[o])}function Ei(t){var n=e.def.S2CTenfoldExpTime.decode(t);TenfoldAward.setBuffTime(n.BufTime),TenfoldAward.expTime=n.ExpTime,TenfoldAward.buyTimes=n.BuyCount,n.ExpTime>=10&&0==n.BufTime?badge.onLight(badge.action.TenFoldExpTime,!0):badge.onLight(badge.action.TenFoldExpTime,!1),Game.dispatcher.dispatchEventWith(Game.EVENT.TenfoldExp)}function Ci(t){var n=e.def.S2CCatchThiefSyncHP.decode(t);CatchThief.onSyncHP(n.getHP())}function Ti(t){var n=e.def.S2CDailyMarkInfo.decode(t);DailyMarkInfo.setInfo(n.index,n.signed,n.awards),Game.dispatcher.dispatchEventWith(Game.EVENT.DailyMarkAward,!1,{index:n.index,signed:n.signed,awards:n.awards})}function Ii(t){var n=e.def.S2CIndexResult.decode(t);n.ok?(DailyMarkInfo.signToday(),badge.onLight(badge.action.DailyMarkAward,!1),Game.dispatcher.dispatchEventWith(Game.EVENT.DailyMarkResult,!1,n.index)):PopUpMessage.push(n.error,color.RED)}function Gi(t){var n=e.def.S2CAccumMarkResult.decode(t);n.ok?Game.dispatcher.dispatchEventWith(Game.EVENT.AccumMarkResult,!1,n.index):PopUpMessage.push(n.error,color.RED)}function Ai(t){var n=e.def.S2CCatchThiefResult.decode(t);CatchThief.onSyncResult(n.getHP(),n.getAward())}function ki(e){CatchThief.showSkillBtn()}function Pi(e){CatchThief.hideSkillBtn()}function wi(t){var n=e.def.S2CCatchThiefStart.decode(t);CatchThief.StartGame(n.getTotalTime(),n.getPrepareTime())}function Li(t){var n=e.def.S2CRewardRetrieveTask.decode(t);RewardRetrieveLogic.updateItems(n)}function Ri(t){var n=e.def.SceneBossLife.decode(t),i=table.maps[n.mapId].scene;null!=i&&Scene.onBosslifeChange(i,n.life,n.maxLife)}function Ui(t){var n=e.def.S2CDungeonStateChange.decode(t);DungeonHallMgr.OnStateChange(n.getState())}function _i(t){var n=e.def.S2CSyncDungeonRoomMemberInfo.decode(t);DungeonHallMgr.onSyncMemberList(n)}function xi(t){var n=e.def.S2CDungeonInvite.decode(t);DungeonHallMgr.ShowInviteConfirmPanel(n.getInviter(),n.getTarget(),n.getRoomId())}function Mi(e){UI.openDungeonHall()}function Di(t){var n=e.def.S2CSyncDungeonConds.decode(t);DungeonHallMgr.onSyncConds(n)}function Ni(e){DungeonHallMgr.ClearRoomMemberData()}function Fi(t){var n=e.def.S2CDungeonSyncRoomInfo.decode(t);DungeonHallMgr.onSyncRoomInfo(n.getTarget())}function Oi(e){UI.closeDungeonHall(),UI.HUD.instance.showBattle()}function Bi(t){var n=e.def.S2CDungeonSyncAssist.decode(t);DungeonHallMgr.onSyncAssist(n.getAssists())}function Wi(t){var n=e.def.S2CVipInfo.decode(t);Vip.updateVipItem(n)}function Vi(t){var n=e.def.S2CSuperWeaponLevelUpResult.decode(t);n.succcess&&null!=n.item&&(PlayerAttribute.superWeapons.items[n.item.id].level=n.item.level),SuperWeapon.levelUpResult(n.succcess)}function qi(t){var n=e.def.S2CSuperWeaponsInfo.decode(t);SuperWeapon.updateSuperWeaponItems(n)}function Hi(t){var n=e.def.S2CSuperWeaponOutlook.decode(t);SuperWeapon.updateOutlook(n.charId,n.wearId)}function ji(t){var n=e.def.S2CEquipMakeResult.decode(t);EquipMake.onMakeResult(n)}function Yi(t){var n=e.def.S2CEquipmentSetMakeResult.decode(t);if(n.result){var i=new Item.Equip(n.equip,PlayerAttribute.faction),a=new UI.EquipMakingResult(!0);a.desc=i.Name,a.data=i,UIManager.pushPage(a)}}function Ki(t){var n=e.def.S2CSyncPartnerRecruitTimes.decode(t);Partner.times1=n.times1,Partner.times2=n.times2,Game.dispatcher.dispatchEventWith(Game.EVENT.SyncPartnerRecruitTimes)}function Qi(t){var n=e.def.PlayerInfo.decode(t);UI.PlayerInfoView.open(n)}function Xi(t){e.kicked=!0,e.socket.close(),UI.ConfirmBox.Show(UI.ConfirmBoxStyle.reconnect,lang.String("prompt title"),lang.String("socket kicked"),function(){return e.connect(),!0},null,function(){return!1})}function Ji(t){var n=e.def.S2CTimingCards.decode(t);Recharge.timingcards=n.cards,1==Recharge.timingcards[Recharge.WeeklyCard_Type].status?badge.onLight(badge.action.WeeklyCard,!0):badge.onLight(badge.action.WeeklyCard,!1),1==Recharge.timingcards[Recharge.MonthlyCard_Type].status?badge.onLight(badge.action.MonthlyCard,!0):badge.onLight(badge.action.MonthlyCard,!1),Game.dispatcher.dispatchEventWith(Game.EVENT.TimingCardChange)}function zi(t){var n=e.def.S2CMoneyTreeInfo.decode(t);MoneyTreeManager.OnGetMoneyTreeInfo(n)}function Zi(t){var n=e.def.S2CQinMausoleumStatus.decode(t);QinMausoleum.s2cStatus(n)}function $i(t){var n=e.def.S2CQinMausoleumRanklist.decode(t);QinMausoleum.showResultRanklist(n)}function ea(t){var n=e.def.S2CQinMausoleumError.decode(t);PopUpMessage.push(lang.String(n.error),color.RED)}function ta(){QinMausoleum.B2Lose()}function na(t){var n=e.def.S2CPay.decode(t);try{XGSDK.pay({txId:n.txId,wareId:n.wareId,serverId:e.server.id.toString(),uid:Account.uid,userdata:n.userData,roleId:n.guid,wareName:n.name,amount:n.price})}catch(i){}}function ia(t){var n=e.def.S2CSyncRageRecoverySpeed.decode(t);PlayerAttribute.SetRageRecoverySpeed(n.speed),PlayerAttribute.SetRage(n.rage)}function aa(t){var n=e.def.S2CSyncRage.decode(t);PlayerAttribute.SetRage(n.rage)}function ra(t){var n=e.def.S2CAuctionList.decode(t);Auction.cacheAuctionList(n)}function oa(t){var n=e.def.S2CAuctionBuyResult.decode(t);Auction.onBuyResult(n)}function sa(t){var n=e.def.S2CPlayerAuctionItems.decode(t);Auction.cacheSelfAuctionList(n)}function la(t){var n=e.def.S2CPlayerAuctionStatus.decode(t);Auction.updatePlayerAuctionStatus(n)}function ua(t){var n=e.def.S2CAuctionCompeteStart.decode(t);Auction.onAuctionCompeteStartNotify(n)}function ca(t){var n=e.def.RoleSetting.decode(t);Setting.Unmarshal(n.setting)}function ha(t){var n,i=e.def.S2CAwardAnnounce.decode(t),a=i.params.length;if(a>0){for(var r=[],o=0;a>o;o++){var s=i.params[o],l=lang.Parse(s);l?r.push(l):r.push(s)}n=lang.StringWithFormat.apply(lang,[i.message].concat(r))}else n=lang.String(i.message),null==n&&(n=i.message);announce.AB.push(1,n,i.attachments),ChatSys.push2("",ChatSys.Identity.Sender_Identity_None,n,i.attachments,ChatSys.channel_world,0,0,"",!0)}function da(t){var n=e.def.S2CWllsMemberList.decode(t);WulinLiansai.onSyncMemberList(n)}function pa(t){var n=e.def.S2CWllsMyRoleInfo.decode(t);WulinLiansai.onSyncMyRoleInfo(n)}function ga(t){var n=e.def.S2CWllsFriendList.decode(t);WulinLiansai.OnSyncFriendList(n)}function ma(t){var n=e.def.Name.decode(t);WulinLiansai.ShowInviteConfirmPanel(n.getName())}function fa(t){var n=e.def.Name.decode(t);WulinLiansai.SendInviteSuccess(n.getName())}function va(t){var n=e.def.S2CWllsSyncPKInfo.decode(t);WulinLiansai.SyncPKRoleInfo(n)}function ya(t){var n=e.def.S2CWllsPKResults.decode(t);WulinLiansai.SyncPKResult(n)}function ba(t){var n=e.def.S2CWllsJoinFail.decode(t);WulinLiansai.JoinFail(n)}function Sa(t){var n=e.def.S2CWildBossMissionStart.decode(t);WildBoss.onServerNotifyStart(n.missionId)}function Ea(t){var n=e.def.RedPacketDetail.decode(t);Game.dispatcher.dispatchEventWith(Game.EVENT.S2CRedPacketDetail,!1,n)}function Ca(t){var n=e.def.S2CSyncTaskRedPackets.decode(t);RedPacket.taskRedPackets={};for(var i=0,a=n.list;i<a.length;i++){var r=a[i],o=r.id;RedPacket.taskRedPackets[o]=new RedPacket.TaskRedPacket(o,r.count)}for(var s=0,l=n.status;s<l.length;s++){var r=l[s];RedPacket.status[r]=!0}Game.dispatcher.dispatchEventWith(Game.EVENT.TaskRedPacketChange)}function Ta(t){var n=e.def.TaskRedPacket.decode(t),i=n.id;0==n.count?delete RedPacket.taskRedPackets[i]:RedPacket.taskRedPackets[i]=new RedPacket.TaskRedPacket(i,n.count),RedPacket.status[i]=n.status,Game.dispatcher.dispatchEventWith(Game.EVENT.TaskRedPacketChange)}function Ia(t){RedPacket.guildRedPackets={};for(var n=e.def.RedPacketList.decode(t),i=0,a=n.list;i<a.length;i++){var r=a[i];RedPacket.guildRedPackets[r.id.toHex()]=r}UI.RedPacketIcon.onSyncRedPacket()}function Ga(t){var n=e.def.RedPacketList.decode(t);Game.dispatcher.dispatchEventWith(Game.EVENT.HistoryRedPackets,!1,n.list,!1)}function Aa(t){for(var n=e.def.RedPacketList.decode(t),i=UI.RedPacketIcon.open(),a=0,r=n.list;a<r.length;a++){var o=r[a];RedPacket.guildRedPackets[o.id.toHex()]=o}i.onNewRedPackets(n.list)}function ka(t){var n=e.def.UUID.decode(t),i=n.uuid.toHex();delete RedPacket.guildRedPackets[i],UI.RedPacketIcon.onRedPacketEmpty(i),Game.dispatcher.dispatchEventWith(Game.EVENT.RedPacketEmpty,!1,i,!1)}function Pa(t){var n=e.def.S2CAddEquip.decode(t),i=n.getId(),a=new Item.Equip(n.equip,PlayerAttribute.faction);a.BagId=i,PlayerAttribute.bag.items[i]={Id:i,Item:a},Game.dispatcher.dispatchEventWith(Game.EVENT.BagEquipChanged,!1,{Id:i,Item:a},!1)}function wa(t){var n=e.def.S2CResult.decode(t);n.ok?Game.dispatcher.dispatchEventWith(Game.EVENT.SwapAttributeSuccess):PopUpMessage.push(lang.String(n.error)+", "+lang.String("swapattribute no swap"),color.RED)}function La(t){var n=e.def.Times.decode(t);RedPacket.times=n.times}function Ra(t){var n=e.def.S2CSyncTaskXSCFinishedNum.decode(t);SeaSunVillage.taskFinishedNum[0]=n.chestNum,SeaSunVillage.taskFinishedNum[1]=n.pkNum,SeaSunVillage.taskFinishedNum[2]=n.roshamboNum}function Ua(t){var n=e.def.S2CSyncPrizeWheel.decode(t);PrizeWheel.UsedCount=n.used,PrizeWheel.cell=n.prize,Game.dispatcher.dispatchEventWith(Game.EVENT.SyncPrizeWheel)}function _a(t){var n=e.def.S2CNotifyPrizeWheelResult.decode(t);PrizeWheel.UsedCount=n.used,badge.onLightGuildGarden(),n.running?Game.dispatcher.dispatchEventWith(Game.EVENT.NotifyPrizeWheelResult,!1,n.prize):PrizeWheel.openResultUI(n.prize)}function xa(e){}function Ma(e){}function Da(t){var n=e.def.S2CSyncAvatar.decode(t);Avatar.list={};for(var i=0,a=n.list;i<a.length;i++){var r=a[i];Avatar.list[r.id]={id:r.id,level:r.level}}PlayerAttribute.UpdateFightingPower(!1),badge.onLight(badge.action.AvatarLevelUp,Avatar.canShowReddot())}function Na(t){var n=e.def.S2CAvatarChange.decode(t),i=mapCharacter[n.id];return null==i?void egret.error("[S2CAvatarLevelChange] id="+n.id+" not found"):(i.setAvatar(n.avatar),void Game.dispatcher.dispatchEventWith(Game.EVENT.AvatarChange,!1,n.avatar))}function Fa(t){var n=e.def.Avatar.decode(t);Avatar.list[n.id]={id:n.id,level:n.level},Game.dispatcher.dispatchEventWith(Game.EVENT.AvatarLevelChange,!1,Avatar.list[n.id]),PlayerAttribute.UpdateFightingPower(!0)}function Oa(t){var n=e.def.S2CImmigrateResult.decode(t);n.error?UI.ConfirmBox.Show(UI.ConfirmBoxStyle.reconnect,lang.String("prompt title"),lang.String(n.error),null,null,null):(ImmigrateServer.running=!0,ImmigrateServer.url=n.url,ServerSession.setToken(n.token),e.socket.recconnect())}function Ba(t){ImmigrateServer.running=!1,e.socket.recconnect()}function Wa(t){var n=e.def.S2CPartnerEquipList.decode(t);PartnerEquipManager.onSyncPartnerEquips(n.getEquips(),n.getNotify())}function Va(t){var n=e.def.S2CRoleRenameResult.decode(t);n.success?(PlayerAttribute.canRename=!1,Game.dispatcher.dispatchEventWith(Game.EVENT.RoleRenameEnableChange,!1,!1),PopUpMessage.push(lang.String("role rename success"),color.GREEN)):PopUpMessage.push(lang.String(n.errMsg),color.RED)}function qa(t){var n=e.def.S2CIsRoleRenameEnable.decode(t);PlayerAttribute.canRename=n.enabled,Game.dispatcher.dispatchEventWith(Game.EVENT.RoleRenameEnableChange,!1,n.enabled)}function Ha(t){var n=e.def.S2CBuyTenFoldExpTimesResult.decode(t);n.success?PopUpMessage.push(lang.String("buy success"),color.GREEN):PopUpMessage.push(lang.String(n.errMsg),color.RED)}function ja(t){var n=e.def.S2CGlobalExpBuffStatus.decode(t),i={enabled:n.enabled,percent:n.percent};Game.dispatcher.dispatchEventWith(Game.EVENT.GlobalExpBuffStatus,!1,i)}function Ya(t){var n=e.def.Status.decode(t),i=n.status;Game.dispatcher.dispatchEventWith(Game.EVENT.ListGoldCoinWareStatus,!1,i)}function Ka(t){var n=Player.instance;TmpCamp.update(e.def.S2CCampList.decode(t),n.Camp)&&n.updateIFFS()}function Qa(t){var n=e.def.S2CSyncWildBossOwner.decode(t);Game.dispatcher.dispatchEventWith(Game.EVENT.WildBossOwnerChanged,!1,n.name)}function Xa(t){var n=e.def.Status.decode(t);if(0!=n.status.length)for(var i=0;i<n.status.length;i++)CrossServer.bossConfig[i].status=n.status[i]||0;else for(var i=0;i<CrossServer.bossConfig.length;i++)CrossServer.bossConfig[i].status=0;Game.dispatcher.dispatchEventWith(Game.EVENT.SyncCrossServerBossStatus)}function Ja(t){e.def.S2CSyncEquipMakeTimes.decode(t)}function za(t){var n=e.def.S2CWeekendRecruitTimes.decode(t);WeekendRecruit.onSyncRecruitTimes(n.getTimes(),n.getFreeTimes())}function Za(e){WeekendRecruit.onSyncRecruitRecords(e)}function $a(t){var n=e.def.S2CGuildUsingSkill.decode(t);Guild.usingSkill=[];for(var i=0;i<n.using.length;i++)Guild.usingSkill[i]=n.using[i];UI.GuildSkill.instance&&UI.GuildSkill.instance.loaded&&UI.GuildSkill.instance.UpdateUsingSkill(),Game.dispatcher.dispatchEventWith(Game.EVENT.UpdateUsingGuildSkill)}function er(t){var n=e.def.S2CGuildSkillLvList.decode(t);Guild.ProcessS2CGuildSkillLvList(n)}function tr(t){var n=e.def.S2CActivateGSkill.decode(t);Guild.ProcessActivateGSkill(n.id,n.res)}function nr(t){var n=e.def.S2CLvUpGuildSkill.decode(t);Guild.ProcessLvUpGuildSkill(n.id,n.lv)}function ir(t){var n=e.def.S2CSyncGuildLevel.decode(t);Guild.ProcessS2CSyncGuildLevel(n.lv)}function ar(t){var n=e.def.S2CSyncGuildFund.decode(t);Guild.ProcessS2CSyncGuildFund(n.fund)}function rr(t){var n=e.def.S2CSyncGuildBusiTask.decode(t);Guild.ProcS2CSyncBusiTask(n)}function or(t){var n=e.def.S2CSyncGuildShop.decode(t);GuildShopCore.ProcS2CSyncGuildShop(n)}function sr(t){var n=e.def.S2CSyncSkillExtLevel.decode(t);PlayerAttribute.SetSkillExtendLevel(n.id,n.extLv),Game.dispatcher.dispatchEventWith(Game.EVENT.UpdateSkill)}function lr(t){for(var n=e.def.S2CSyncAllSkillExtLevel.decode(t),i=0;i<n.skills.length;i++)PlayerAttribute.SetSkillExtendLevel(n.skills[i].id,n.skills[i].extLv);for(var i=0;i<n.passiveSkills.length;i++)PlayerAttribute.SetPassiveSkillExtendLevel(n.passiveSkills[i].id,n.passiveSkills[i].extLv);Game.dispatcher.dispatchEventWith(Game.EVENT.UpdateSkill)}function ur(t){var n=e.def.S2CSyncSkillPoint.decode(t);n.point>PlayerAttribute.skillpoint&&PopUpMessage.push(lang.StringWithFormat("gain skillpoint {1}",n.point-PlayerAttribute.skillpoint),color.GREEN),PlayerAttribute.skillpoint=n.point,Game.dispatcher.dispatchEventWith(Game.EVENT.UpdateSkill)}function cr(e){PopUpMessage.push(lang.String("skillbook use limited"),color.RED)}function hr(t){var n=e.def.S2CSyncGuildWarToken.decode(t);Guild.GuildWarSetToken(n.getNumber())}function dr(t){null==Guild.guildWar&&(Guild.guildWar=new Guild.GuildWar);var n=e.def.S2CSyncGuildWarInfo.decode(t);Guild.GuildWarSetToken(n.getToken()),Guild.GuildWarTaskProgress(n.getTaskProgress()),Game.dispatcher.dispatchEventWith(Game.EVENT.GuildWarInfoUpdate)}function pr(t){var n=e.def.S2CSyncGuildDonate.decode(t);GuildDonateMgr.UpdateDonatedCount(n.getGoldDonatedCount(),n.getSilverDonatedCount())}function gr(t){var n=e.def.S2CGuildWarTaskMsg.decode(t);GuildWarTaskScene.processGuildWarTaskMsg(n.getMsgid(),n.getParam())}function mr(t){var n=e.def.S2CSyncGuildWarTaskSceneDamage.decode(t);GuildWarTaskScene.processSyncGuildWarTaskSceneDamage(n)}function fr(t){var n=e.def.S2CJoinGuildWarTaskSceneRet.decode(t);GuildWarTaskScene.processJoinGuildWarTaskSceneRet(n.ret)}function vr(t){var n=e.def.S2CSyncGuildWarTaskSceneChapter.decode(t);GuildWarTaskScene.processSyncGuildWarTaskSceneChapter(n.chapter,n.time)}function yr(e){PopUpMessage.push(lang.String("guildwartoken use limited"),color.RED)}function br(e){PopUpMessage.push(lang.String("guildwartoken out of date"),color.RED)}function Sr(e){PopUpMessage.push(lang.String("guildwartoken need guild"),color.RED)}function Er(e){PopUpMessage.push(lang.String("activate guildactivateskill"),color.ORANGE),Game.dispatcher.dispatchEventWith(Game.EVENT.ActivateGuildactivateskill)}function Cr(e){Guild.OnSyncGuildTrainingInfo(e)}function Tr(t){var n=e.def.S2CGuildWarMatchTime.decode(t);GuildWarMatchScene.procSyncGuildWarMatchTime(n)}function Ir(t){var n=e.def.S2CGuildWarMatchTime.decode(t);GuildWar2Scene.procSyncGuildWarMatchTime(n)}function Gr(t){var n=e.def.S2CGuildWarMatchScore.decode(t);GuildWarMatchScene.procSyncGuildWarMatchScore(n)}function Ar(t){var n=e.def.S2CGuildWarMatchMemberCount.decode(t);GuildWarMatchScene.procSyncGuildWarMatchMemberCount(n)}function kr(t){var n=e.def.S2CGuildWarMatchMemberList.decode(t);GuildWarMatchScene.procSyncGuildWarMatchMemberList(n)}function Pr(t){var n=e.def.S2CGuildWarMatchTimeLine.decode(t);GuildWarMatchScene.porcSyncGuildWarMatchTimeLine(n)}function wr(t){var n=e.def.S2CSyncGuildWar2Score.decode(t);GuildWar2Scene.procSyncGuildWar2Score(n)}function Lr(t){var n=e.def.S2CSyncGuildWar2GuildList.decode(t);GuildWar2Scene.procSyncGuildWar2GuildList(n)}function Rr(t){var n=e.def.S2CGuildWarMatchCityInfo.decode(t);GuildWarMatchScene.porcSyncGuildWarMatchCityList(n)}function Ur(e){}function _r(t){var n=e.def.S2CGuildWarTaskFinished.decode(t);GuildWarTaskScene.porcGuildWarTaskFinished(n)}function xr(e){yesouTaskManager.onSyncTask(e)}function Mr(t){var n=e.def.S2CGoldCoinShopInfo.decode(t);GoldCoinShop.UpdateBuyCounts(n.getBuyCounts())}function Dr(t){var n=e.def.S2CSyncPlayerGuildWarInfo.decode(t);GuildWarTaskScene.tokenUsed=n.tokenUsed}function Nr(t){var n=e.def.S2CSongjinXTaskData.decode(t);SongJin.setXSvrTaskData(n)}function Fr(t){var n=e.def.S2CSyncQinMausoleumEntranceInfo.decode(t);Game.dispatcher.dispatchEventWith(Game.EVENT.QinMausoleumEntranceInfo,!1,n)}function Or(t){var n=e.def.S2CSyncGuildWarTaskSceneInfo.decode(t);GuildWarTaskScene.OnUpdateSceneInfo(n.taskId,n.JointimeRemaining,n.SceneRemaining)}function Br(t){var n=e.def.S2CGuildArmamentArmsInfo.decode(t);GuildArmament.onSyncArmsInfo(n)}function Wr(t){var n=e.def.S2CGuildArmamentPlayerInfo.decode(t);GuildArmament.onSyncScoreInfo(n.getMyScores(),n.getGuildScores()),GuildArmament.onSyncPlayerInfo(n)}function Vr(t){var n=e.def.S2CGuildArmamentRobHistory.decode(t);GuildArmament.onSyncRobHistory(n.getRecordes())}function qr(t){var n=e.def.Index.decode(t);GuildArmament.onSyncScenePlayerScore(n.getIndex())}function Hr(t){var n=e.def.Index.decode(t);GuildArmament.onSyncSceneGuildScore(n.getIndex())}function jr(t){var n=e.def.S2CGuildArmamentEffectiveBuffInfos.decode(t);GuildArmament.onSyncEffecttiveBuffs(n.getBuffList())}function Yr(t){var n=e.def.S2CGuildArmamentCityState.decode(t);GuildArmament.onSyncCityState(n)}function Kr(t){var n=e.def.S2CGuildArmamentConvoySceneInfo.decode(t);GuildArmament.onSyncConvoySceneInfo(n)}function Qr(t){var n=e.def.S2CGuildArmamentConvoyResult.decode(t);GuildArmament.onSyncConvoyResult(n)}function Xr(t){var n=e.def.S2CHeroicCardSyncTaskStatus.decode(t);HeroicCard.OnSyncTaskStatus(n)}function Jr(t){var n=e.def.S2CHeroicCardSyncOneTask.decode(t);HeroicCard.OnSyncOneTaskStatus(n)}function zr(t){var n=e.def.S2CRankAwardRank.decode(t);RankAward.procSyncRankData(n)}function Zr(t){var n=e.def.S2CYanEmperorTeamList.decode(t);YanEmperor.s2c_teamlist(n)}function $r(t){var n=e.def.YanEmperorTeam.decode(t);YanEmperor.s2c_teaminfo(n)}function eo(){YanEmperor.s2c_kicked()}function to(t){var n=e.def.YanEmperorPlayer.decode(t);YanEmperor.s2c_applicant(n)}function no(t){var n=e.def.S2CYanEmperorFloorInfo.decode(t);YanEmperor.s2c_floorinfo(n.getRooms())}function io(t){var n=e.def.YanEmperorPlayer.decode(t);YanEmperor.s2c_YanEmperorPlayer(n)}function ao(t){var n=e.def.RestTime.decode(t);YanEmperor.s2c_adytumtime(n)}function ro(t){var n=e.def.AwardResultList.decode(t);egret.setTimeout(function(){var e=new UI.EncountersResult;e.currentState="succeed",e.awards=table.parseAwards(n.getAwards()),UIManager.pushPage(e)},null,100)}function oo(e){var t=new UI.Rule;t.skinName="EndTempSkinSkin",UIManager.pushPage(t)}function so(t){var n=e.def.S2CYanEmperorEvent.decode(t);YanEmperor.s2c_adytumEvent(n)}function lo(t){var n=e.def.Count.decode(t);YanEmperor.curAwarded=n.getCount(),Game.dispatcher.dispatchEventWith(Game.EVENT.YanEmperorAwardCount)}function uo(t){var n=e.def.S2CGuildInfo.decode(t);UI.GuildTip.instance.data=n,UIManager.push(UI.GuildTip.instance)}function co(t){var n=e.def.S2CShowGmInfo.decode(t);egret.log(n.desc)}function ho(t){var n=e.def.S2CBabelPKInfo.decode(t);
Babel.onSyncPKInfo(n)}function po(t){var n=e.def.S2CBabelSummaryPKInfo.decode(t);Babel.onSyncSummaryPKInfo(n)}function go(t){var n=e.def.S2CBabelTeamInfo.decode(t);Babel.onSyncTeamInfo(n)}function mo(t){var n=e.def.S2CBabelFriendList.decode(t);Babel.onSyncFriendList(n)}function fo(t){var n=e.def.Name.decode(t);Babel.OnGetInvite(n.getName())}function vo(t){var n=e.def.S2CBabelPrepareSceneInfo.decode(t);Babel.onSyncPrepareSceneInfo(n)}function yo(t){var n=e.def.S2CAwardResults.decode(t);Babel.onSyncFinalAwards(n.getItems())}function bo(t){NienBoss.bossInfoStage=e.def.S2CNienBossStage.decode(t),Game.dispatcher.dispatchEventWith(Game.EVENT.NienBossSyncStage)}function So(t){NienBoss.bossInfoRank=e.def.S2CNienBossRankInfo.decode(t),Game.dispatcher.dispatchEventWith(Game.EVENT.NienBossSyncRank)}function Eo(t){NienBoss.bossInfoAward=e.def.S2CNienBossAwardInfo.decode(t),Game.dispatcher.dispatchEventWith(Game.EVENT.NienBossSyncAward)}function Co(t){var n=e.def.S2CNienBossOpenState.decode(t);NienBoss.onSyncOpenState(n)}function To(t){var n=e.def.IndexList.decode(t);Refine.onSyncRefine(n.indexs)}function Io(t){var n=e.def.IndexList.decode(t);Rune.onSyncRune(n.indexs)}function Go(t){var n=e.def.S2CConsignmentTypeWareList.decode(t);Consignment.OnSyncTypeWareList(n)}function Ao(t){var n=e.def.S2CConsignmentSpecificItemList.decode(t);Consignment.OnSyncSpecificItemList(n)}function ko(t){var n=e.def.S2CConsignmentMineItemInfo.decode(t);Consignment.OnSyncSellerInfo(n)}function Po(t){var n=e.def.Index.decode(t);Consignment.OnSyncSellerMoney(n.getIndex())}function wo(t){var n=e.def.S2CPartnerQingyiPartnerList.decode(t);PartnerQingyi.onSyncPartners(n)}function Lo(t){var n=e.def.S2CPartnerQingyiGroupList.decode(t);PartnerQingyi.onSyncGroups(n)}function Ro(t){var n=e.def.NotifyItem.decode(t);Game.ShowGetItemNotify(n.getGenre(),n.getDetailType(),n.getCount())}function Uo(t){var n=e.def.NotifyMsg.decode(t),i=n.getParams(),a="";a=i.length>0?lang.StringWithFormat.apply(lang,[n.getMessage()].concat(i)):lang.String(n.getMessage()),n.getIsError()?Game.ShowNotifyErrorMsg(a):Game.ShowNotifyMsg(a)}function _o(t){var n=e.def.S2CAwardResults.decode(t);null!=CrossServer.resultUI&&CrossServer.resultUI.ShowFinalAward(n.getItems())}function xo(t){var n=e.def.ColelctCardCardList.decode(t);collectCardManager.onSyncActivatedCards(n.getCards())}function Mo(t){var n=e.def.CollectCardExp.decode(t);collectCardManager.onSyncExp(n.getExp())}function Do(e){Game.dispatcher.dispatchEventWith(Game.EVENT.CollectCardUpgradeStarSuccess)}function No(e){Game.dispatcher.dispatchEventWith(Game.EVENT.CollectCardUpgradeLevelSuccess)}function Fo(t){var n=e.def.S2CMonthlyActRep.decode(t);monthlyactivity.onSyncActRep(n)}function Oo(t){var n=e.def.S2CMonthlyActSyncTaskObject.decode(t);monthlyactivity.onSyncTaskObject(n)}function Bo(t){var n=e.def.S2CMonthlyActSyncTarget.decode(t);monthlyactivity.onSyncTarget(n)}function Wo(t){var n=e.def.S2CMonthlyActSyncCounterTask.decode(t);monthlyactivity.onSyncCounterTask(n)}function Vo(t){var n=e.def.S2CMonthlyActAward.decode(t);monthlyactivity.onMonthlyActAward(n)}function qo(t){var n=e.def.S2CMonthlyActSyncSingleTask.decode(t);monthlyactivity.onMonthlyActSyncSingleTask(n)}function Ho(t){var n=e.def.S2CMonthlySyncCounter.decode(t);monthlyactivity.onMonthlySyncCounter(n)}function jo(t){var n=e.def.UInt32.decode(t);UIManager.push(new UI.SwitchFaction(n.getValue()))}function Yo(t){e.reload=!0}function Ko(t){for(var n=e.def.S2CLevelupGiftInfo.decode(t),i=n.getGiftLevelsNormal(),a=0;a<i.length;a++){var r=i[a];table.levelUpGift[r]&&!table.levelUpGift[r].status&&(table.levelUpGift[r].status=!0)}for(var o=n.getGiftLevelsVIP(),a=0;a<o.length;a++){var r=o[a];table.levelUpGiftVIP[r]&&!table.levelUpGiftVIP[r].status&&(table.levelUpGiftVIP[r].status=!0)}var s=!1,l=!1;for(var r in table.levelUpGift)table.levelUpGift[r].status||(s=!0,PlayerAttribute.Level>=Number(r)&&(l=!0));var u=Recharge.isTimingCard(Recharge.MonthlyCard_Type);for(var r in table.levelUpGiftVIP)table.levelUpGiftVIP[r].status||(s=!0,PlayerAttribute.Level>=Number(r)&&u&&(l=!0));s?(Game.dispatcher.dispatchEventWith(Game.EVENT.LevelUpGiftChange),badge.onLight(badge.action.LevelUpGift,l)):badge.onLight(badge.action.LevelUpGift,!1),Game.dispatcher.dispatchEventWith(Game.EVENT.LevelUpGiftOpen,!1,s)}function Qo(t){var n=e.def.S2CKillMsg.decode(t);UI.KillMsgUI.show(n.getTargetName(),n.getWin())}function Xo(t){var n=e.def.S2CSyncGuildWar2Guide.decode(t);GuildWar2Scene.procSyncGuildWar2Guide(n)}function Jo(t){var n=e.def.S2COpenningWheelFreeTimes.decode(t);OpeningWheel.OnSyncOpenningWheelFreeTimes(n.getFreeTimes())}function zo(t){var n=e.def.S2CCollectTreasureData.decode(t);activityCollectTreasure.onSyncCardData(n)}function Zo(t){var n=e.def.S2CCollectTreasureRankData.decode(t);activityCollectTreasure.onSyncRankList(n)}function $o(t){var n=e.def.S2CCollectTreasureCard.decode(t);activityCollectTreasure.onSyncEmptyCardData(n)}function es(t){var n=e.def.S2CSyncBetData.decode(t);Bet.onSyncBetData(n)}function ts(t){var n=e.def.S2CSyncBetShopData.decode(t);Bet.onSyncBetShopData(n)}function ns(t){var n=e.def.S2CReqGuildDungeonInfo.decode(t);GuildDungeon.UpdateSceneInfo(n)}function is(t){var n=e.def.S2CGuildDungeonRunningInfo.decode(t);GuildDungeon.UpdateRunningInfo(n)}function as(t){var n=e.def.S2CSyncGuildDungeonResult.decode(t);GuildDungeon.OnSyncGuildDungeonResult(n.result)}function rs(t){var n=e.def.S2CSyncNpcPopupSkill.decode(t),i=mapCharacter[n.npcID];null!=i&&i.actor.popSkill(lang.String(n.skillName),PopSkillType.NpcSkill)}function os(t){var n=e.def.S2CSyncGuildDungeonNormalAward.decode(t);GuildDungeon.OnSyncGuildDungeonNormalAward(n)}function ss(t){var n=e.def.S2CPersonalMatchSyncTime.decode(t);PersonalMatchScene.procSyncPersonalMatchTime(n)}function ls(t){var n=e.def.S2CPersonalMatchRankData.decode(t);PersonalMatchScene.procSyncPersonalMatchRankData(n)}function us(t){var n=e.def.S2CPersonalMatchSyncDamage.decode(t);PersonalMatchScene.procSyncPersonalMatchDamage(n)}function cs(t){var n=e.def.S2CCityStatuaryInfo.decode(t);CityHome.onSyncStatuaryInfo(n)}function hs(t){var n=e.def.S2CWuxingyinInfos.decode(t);Wuxingyinmanager.onSyncData(n)}function ds(t){var n=e.def.S2CHalfyearDrawBoxResult.decode(t);Partner.recruiting=!1;var i=UI.PetEnlistResult.instance;i.updateAwards(n.awards),1==n.getAwards().length?i.currentState="one":i.currentState="ten",UIManager.push(i)}function ps(t){var n=e.def.S2CPartnerEquipEnhanceInfo.decode(t);PartnerEquipEnhance.onSyncEnhanceInfo(n.getLevels(),n.getNotify())}function gs(t){var n=e.def.S2CBravePalaceSyncBaseInfo.decode(t);BravePalace.OnBaseInfoSync(n)}function ms(t){var n=e.def.S2CBravePalaceSimpleMsg.decode(t);BravePalace.OnSimpleMsg(n)}function fs(t){var n=e.def.S2CBravePalaceSceneInfo.decode(t);BravePalace.OnChangeSceneInfo(n.sceneLevel,n.remainingTime,n.playerNumber,-1)}function vs(t){var n=e.def.S2CBravePalaceScenePlayerNumber.decode(t);BravePalace.OnChangeSceneInfo(-1,-1,n.playerNumber,-1)}function ys(t){var n=e.def.S2CBravePalaceSceneDamageDealed.decode(t);BravePalace.OnChangeSceneInfo(-1,-1,-1,n.damage)}function bs(t){var n=e.def.S2CBravePalaceSceneResult.decode(t);BravePalace.OnSyncGuildDungeonResult(n)}function Ss(t){var n=e.def.S2CBravePalaceSceneScore.decode(t);BravePalace.OnChangeScore(n.score)}function Es(t){for(var n=e.def.S2CClickAwardInfo.decode(t),i=(n.awards,[]),a=0;a<n.awards.length;a++){var r=table.parseAward(n.awards[a]),o={type:r.type,content:r.content,obtainId:r.obtainId,boxType:n.boxType[a]};i.push(o)}UI.ClickAwardPage.instance.ShowPage(i)}function Cs(t){var n=e.def.S2CBravePalaceSyncStoneMsec.decode(t);BravePalace.OnStoneChange(n.timeRest)}function Ts(t){var n=e.def.S2CMapEffectSyncOne.decode(t);MapEffect.OnSyncOneMapEffect(n)}function Is(t){var n=e.def.S2CMapEffectSyncAll.decode(t);MapEffect.OnSyncAllMapEffect(n)}function Gs(t){var n=e.def.S2CMapEffectRemoveOne.decode(t);MapEffect.RemoveEffect(n.id)}function As(e){MapEffect.RemoveAll()}function ks(t){var n=e.def.S2CSyncOnePassiveSkills.decode(t);PassiveSkillManager.UpdateSkill(n),PlayerAttribute.UpdateFightingPower(!0)}function Ps(t){var n=e.def.S2CSyncAllPassiveSkills.decode(t);PassiveSkillManager.OnSyncAllPassiveSkill(n),PlayerAttribute.UpdateFightingPower(!1)}function ws(t){var n=e.def.S2CDGroupSyncGroup.decode(t);DungeonGroup.OnSyncGroupInfo(n)}function Ls(t){var n=e.def.S2CDGroupSyncOneMember.decode(t);DungeonGroup.OnSyncOneMember(n)}function Rs(t){var n=e.def.S2CDGroupSyncMemberLeave.decode(t);DungeonGroup.OnSyncMemberLeave(n)}function Us(t){var n=e.def.S2CDGroupChangeLeader.decode(t);DungeonGroup.OnChangeLeader(n)}function _s(t){var n=e.def.S2CDGroupSyncInviteList.decode(t);DungeonGroup.OnSyncInviteList(n)}function xs(t){var n=e.def.S2CDGroupCommonMsg.decode(t);DungeonGroup.OnCommonMsg(n)}function Ms(t){var n=e.def.S2CDgroupSingleInvite.decode(t);DungeonGroup.OnSingleInvite(n)}function Ds(t){var n=e.def.S2CSyncShareBossSceneDynamic.decode(t);shareboss.OnSyncDynamicInfo(n)}function Ns(t){var n=e.def.S2CSyncShareBossSceneBase.decode(t);shareboss.OnSyncBaseInfo(n)}function Fs(t){var n=e.def.S2CShareBossAward.decode(t);shareboss.OnAward(n)}function Os(t){var n=e.def.S2CShareBossSyncMemberInfo.decode(t);shareboss.OnSyncMemberInfo(n)}function Bs(t){var n=e.def.S2CShareBossCommonMsg.decode(t);shareboss.OnCommonMsg(n)}function Ws(e){DungeonGroup.Dismiss()}function Vs(t){var n=e.def.BagJueXue.decode(t),i=n.getId(),a=new Item.JueXue;a.Init(n.juexue),PlayerAttribute.AddItem({Id:i,Item:a})}function qs(t){for(var n=e.def.S2CBagJueXueList.decode(t),i=n.juexues,a=0;a<i.length;a++){var r=i[a],o=r.getId(),s=new Item.JueXue;s.Init(r.juexue),PlayerAttribute.bag.AddItem({Id:o,Item:s})}Game.dispatcher.dispatchEventWith(Game.EVENT.BagItemChange)}function Hs(t){var n=e.def.S2CJueXueChange.decode(t),i=n.juexue,a=new Item.JueXue;a.Init(i);var r=PlayerAttribute.juexues[a.Part],o=a.IsLevelUp(r),s=a.IsBreakOut(r);PlayerAttribute.juexues[a.Part]=a,PlayerAttribute.UpdateFightingPower(!0),Game.dispatcher.dispatchEventWith(Game.EVENT.JueXueChange,!1,{bLevelUp:o,bBreakout:s})}function js(t){for(var n=e.def.S2CJueXueList.decode(t),i=0;i<n.juexues.length;i++){var a=n.juexues[i],r=new Item.JueXue;r.Init(a),PlayerAttribute.juexues[r.Part]=r}PlayerAttribute.UpdateFightingPower(!1),Game.dispatcher.dispatchEventWith(Game.EVENT.JueXueChange),Game.dispatcher.dispatchEventWith(Game.EVENT.BagItemChange)}function Ys(t){var n=e.def.UInt32.decode(t);UI.RecruitSysUI.open(n.value)}function Ks(t){var n=e.def.S2CReqClientItemRes.decode(t),i=table.parseAward(n.award);if(null!=i){var a=new e.def.C2SRespClientItemRes;a.uuid=n.uuid,a.key=n.key,a.name=table.getAwardName(i);var r=(table.getAwardIcon(i),RES.getResourceInfo(table.getAwardIcon(i)));a.relPath=r.url,a.qulityColor=Item.QualityColor[table.getAwardQuality(i)],e.socket.write(143,a.toArrayBuffer())}}function Qs(t){var n=e.def.BagWenShi.decode(t),i=n.getId(),a=new Item.WenShi;a.Init(n.wenshi),PlayerAttribute.AddItem({Id:i,Item:a})}function Xs(t){var n=e.def.S2CWenShiChange.decode(t),i=n.wenshi,a=new Item.WenShi;a.Init(i),PlayerAttribute.mountWenShi(a)}function Js(t){var n=e.def.S2CWenShiChange.decode(t),i=n.wenshi,a=PlayerAttribute.wenshis[table.wenshis[i.id].pos];a.Init(i),Game.dispatcher.dispatchEventWith(Game.EVENT.WenShiSyncUpgrade),PlayerAttribute.UpdateFightingPower(!0)}function zs(t){var n=e.def.S2CWenShiChange.decode(t),i=n.wenshi,a=PlayerAttribute.wenshis[table.wenshis[i.id].pos];a.Init(i),Game.dispatcher.dispatchEventWith(Game.EVENT.WenShiSyncBreakThrough),PlayerAttribute.UpdateFightingPower(!0)}function Zs(t){for(var n=e.def.BagWenShiList.decode(t),i=n.wenshi,a=0;a<i.length;a++){var r=i[a].getWenshi(),o=i[a].getId(),s=new Item.WenShi;s.Init(r),PlayerAttribute.bag.AddItem({Id:o,Item:s})}Game.dispatcher.dispatchEventWith(Game.EVENT.BagItemChange)}function $s(t){for(var n=e.def.BagWenShiList.decode(t),i=n.getWenshi(),a=0;a<i.length;a++){var r=i[a].getWenshi(),o=(i[a].getId(),new Item.WenShi);o.Init(r),PlayerAttribute.wenshis[o.pos]=o}PlayerAttribute.UpdateFightingPower(!1),Game.dispatcher.dispatchEventWith(Game.EVENT.WenShiChange),Game.dispatcher.dispatchEventWith(Game.EVENT.BagItemChange)}function el(t,n){return null!=e.procfuns[t]?void egret.error("cmd="+t+" already registe"):void(e.procfuns[t]=n)}e.procfuns={},e.Register=el,e.procfuns[3]=t,e.procfuns[4]=a,e.procfuns[2]=r,e.procfuns[5]=o,e.procfuns[6]=l,e.procfuns[7]=u,e.procfuns[10]=c,e.procfuns[11]=h,e.procfuns[29]=d,e.procfuns[12]=p,e.procfuns[13]=g,e.procfuns[15]=m,e.procfuns[76]=si,e.procfuns[224]=li,e.procfuns[1]=f,e.procfuns[16]=v,e.procfuns[19]=y,e.procfuns[20]=S,e.procfuns[17]=T,e.procfuns[252]=I,e.procfuns[254]=G,e.procfuns[253]=A,e.procfuns[23]=k,e.procfuns[26]=P,e.procfuns[27]=w,e.procfuns[33]=L,e.procfuns[32]=R,e.procfuns[106]=j,e.procfuns[31]=U,e.procfuns[30]=_,e.procfuns[79]=Ct,e.procfuns[43]=H,e.procfuns[34]=x,e.procfuns[35]=M,e.procfuns[36]=D,e.procfuns[38]=F,e.procfuns[37]=O,e.procfuns[39]=B,e.procfuns[42]=W,e.procfuns[40]=V,e.procfuns[41]=q,e.procfuns[44]=Y,e.procfuns[28]=K,e.procfuns[45]=Q,e.procfuns[46]=X,e.procfuns[47]=J,e.procfuns[49]=z,e.procfuns[50]=Z,e.procfuns[51]=nt,e.procfuns[52]=it,e.procfuns[48]=tt,e.procfuns[55]=N,e.procfuns[54]=at,e.procfuns[59]=rt,e.procfuns[58]=ot,e.procfuns[60]=st,e.procfuns[62]=lt,e.procfuns[63]=ut,e.procfuns[68]=ct,e.procfuns[67]=ht,e.procfuns[66]=dt,e.procfuns[64]=pt,e.procfuns[65]=gt,e.procfuns[72]=mt,e.procfuns[69]=ft,e.procfuns[70]=vt,e.procfuns[71]=yt,e.procfuns[74]=bt,e.procfuns[73]=St,e.procfuns[75]=Et,e.procfuns[81]=Tt,e.procfuns[84]=It,e.procfuns[85]=Pt,e.procfuns[87]=Lt,e.procfuns[86]=Ut,e.procfuns[251]=wt,e.procfuns[88]=Rt,e.procfuns[89]=Qt,e.procfuns[90]=n,e.procfuns[91]=i,e.procfuns[94]=_t,e.procfuns[95]=xt,e.procfuns[115]=Mt,e.procfuns[118]=Dt,e.procfuns[93]=Nt,e.procfuns[92]=Bt,e.procfuns[116]=Ft,e.procfuns[96]=Wt,e.procfuns[97]=Vt,e.procfuns[98]=qt,e.procfuns[99]=Ht,e.procfuns[100]=jt,e.procfuns[101]=Yt,e.procfuns[103]=Kt,e.procfuns[80]=Xt,e.procfuns[119]=rn,e.procfuns[121]=on,e.procfuns[109]=Jt,e.procfuns[110]=zt,e.procfuns[111]=Zt,e.procfuns[112]=$t,e.procfuns[113]=en,e.procfuns[114]=tn,e.procfuns[120]=nn,e.procfuns[218]=an,e.procfuns[22]=sn,e.procfuns[117]=ln,e.procfuns[123]=un,e.procfuns[124]=cn,e.procfuns[122]=hn,e.procfuns[77]=dn,e.procfuns[104]=pn,e.procfuns[105]=gn,e.procfuns[126]=fn,e.procfuns[125]=mn,e.procfuns[127]=vn,e.procfuns[151]=yn,e.procfuns[128]=bn,e.procfuns[129]=Sn,e.procfuns[130]=En,e.procfuns[132]=Cn,e.procfuns[133]=Tn,e.procfuns[131]=In,e.procfuns[134]=Gn,e.procfuns[135]=An,e.procfuns[208]=kn,e.procfuns[136]=Pn,e.procfuns[138]=Ln,e.procfuns[139]=Rn,e.procfuns[137]=Un,e.procfuns[140]=wn,e.procfuns[141]=_n,e.procfuns[204]=xn,e.procfuns[206]=Mn,e.procfuns[207]=Dn,e.procfuns[150]=Nn,e.procfuns[154]=Fn,e.procfuns[153]=On,e.procfuns[152]=Bn,e.procfuns[155]=Wn,e.procfuns[156]=Vn,e.procfuns[199]=qn,e.procfuns[157]=Hn,e.procfuns[159]=$n,e.procfuns[158]=ei,e.procfuns[245]=jn,e.procfuns[246]=Yn,e.procfuns[247]=Kn,e.procfuns[248]=Xn,e.procfuns[249]=Qn,e.procfuns[250]=Jn,e.procfuns[160]=zn,e.procfuns[161]=Zn,e.procfuns[162]=ii,e.procfuns[163]=ai,e.procfuns[164]=ri,e.procfuns[167]=oi,e.procfuns[165]=ti,e.procfuns[166]=ni,e.procfuns[168]=ui,e.procfuns[178]=ci,e.procfuns[179]=hi,e.procfuns[181]=di,e.procfuns[180]=pi,e.procfuns[182]=gi,e.procfuns[276]=Sa,e.procfuns[184]=mi,e.procfuns[185]=fi,e.procfuns[194]=vi,e.procfuns[195]=yi,e.procfuns[192]=bi,e.procfuns[193]=Si,e.procfuns[255]=Ei,e.procfuns[264]=Ci,e.procfuns[196]=Ti,e.procfuns[197]=Ii,e.procfuns[198]=Gi,e.procfuns[267]=Ai,e.procfuns[265]=ki,e.procfuns[266]=Pi,e.procfuns[268]=wi,e.procfuns[256]=Li,e.procfuns[200]=Ri,e.procfuns[213]=Ui,e.procfuns[211]=Fi,e.procfuns[210]=_i,e.procfuns[212]=Ni,e.procfuns[214]=Oi,e.procfuns[215]=Bi,e.procfuns[231]=xi,e.procfuns[232]=Mi,e.procfuns[239]=Di,e.procfuns[202]=Wi,e.procfuns[274]=Vi,e.procfuns[272]=qi,e.procfuns[275]=Hi,e.procfuns[189]=kt,e.procfuns[107]=At,e.procfuns[223]=ji,e.procfuns[209]=Yi,e.procfuns[229]=Ki,e.procfuns[230]=Qi,e.procfuns[233]=Xi,e.procfuns[102]=Ji,e.procfuns[271]=zi,e.procfuns[225]=Ot,e.procfuns[226]=Zi,e.procfuns[227]=$i,e.procfuns[228]=ea,e.procfuns[234]=ta,e.procfuns[169]=na,e.procfuns[177]=aa,e.procfuns[280]=ra,e.procfuns[281]=oa,e.procfuns[282]=sa,e.procfuns[283]=la,e.procfuns[284]=ua,e.procfuns[61]=ca,e.procfuns[83]=ha,e.procfuns[263]=da,e.procfuns[262]=pa,e.procfuns[260]=ga,e.procfuns[261]=ma,e.procfuns[259]=va,e.procfuns[290]=ya,e.procfuns[298]=ba,e.procfuns[258]=fa,e.procfuns[277]=Ea,e.procfuns[287]=Ca,e.procfuns[288]=Ta,e.procfuns[291]=Ia,e.procfuns[292]=Ga,e.procfuns[278]=Aa,e.procfuns[289]=ka,e.procfuns[285]=Pa,e.procfuns[279]=wa,e.procfuns[286]=La,e.procfuns[295]=Ra,e.procfuns[142]=Ua,e.procfuns[143]=_a,e.procfuns[144]=xa,e.procfuns[145]=Ma,e.procfuns[257]=Da,e.procfuns[294]=Na,e.procfuns[293]=Fa,e.procfuns[149]=Oa,e.procfuns[219]=Ba,e.procfuns[311]=Wa,e.procfuns[317]=Va,e.procfuns[318]=qa,e.procfuns[320]=E,e.procfuns[321]=C,e.procfuns[322]=Ha,e.procfuns[326]=ja,e.procfuns[328]=Ya,e.procfuns[329]=Ka,e.procfuns[330]=Qa,e.procfuns[331]=Xa,e.procfuns[332]=Ja,e.procfuns[334]=za,e.procfuns[335]=Za,e.procfuns[2001]=$a,e.procfuns[2002]=er,e.procfuns[2003]=tr,e.procfuns[2004]=nr,e.procfuns[2005]=ir,e.procfuns[2006]=ar,e.procfuns[2007]=rr,e.procfuns[2008]=or,e.procfuns[2010]=sr,e.procfuns[2011]=lr,e.procfuns[2012]=ur,e.procfuns[2013]=cr,e.procfuns[2015]=dr,e.procfuns[2014]=hr,e.procfuns[2009]=pr,e.procfuns[2017]=gr,e.procfuns[2018]=mr,e.procfuns[2016]=fr,e.procfuns[2019]=vr,e.procfuns[2020]=yr,e.procfuns[2021]=br,e.procfuns[2022]=Sr,e.procfuns[2023]=Er,e.procfuns[2024]=Cr,e.procfuns[2025]=Tr,e.procfuns[2026]=Gr,e.procfuns[2027]=Ar,e.procfuns[2028]=kr,e.procfuns[2032]=Rr,e.procfuns[2033]=Pr,e.procfuns[2076]=wr,e.procfuns[2077]=Lr,e.procfuns[2078]=Ir,e.procfuns[2084]=Xo,e.procfuns[2030]=Ur,e.procfuns[2031]=_r,e.procfuns[2034]=xr,e.procfuns[2035]=Mr,e.procfuns[21]=s,e.procfuns[2036]=Dr,e.procfuns[2037]=Nr,e.procfuns[2038]=Fr,e.procfuns[2039]=Or,e.procfuns[2041]=Br,e.procfuns[2042]=Wr,e.procfuns[2043]=Vr,e.procfuns[2045]=qr,e.procfuns[2044]=Hr,e.procfuns[2049]=jr,e.procfuns[2051]=Yr,e.procfuns[2054]=Kr,e.procfuns[2055]=Qr,e.procfuns[2046]=Xr,e.procfuns[2047]=Jr,e.procfuns[2048]=zr,e.procfuns[170]=Zr,e.procfuns[171]=$r,e.procfuns[172]=eo,e.procfuns[173]=to,e.procfuns[342]=no,e.procfuns[201]=io,e.procfuns[343]=ao,e.procfuns[344]=ro,e.procfuns[345]=oo,e.procfuns[183]=so,e.procfuns[147]=lo,e.procfuns[2056]=uo,e.procfuns[2058]=co,e.procfuns[2059]=$,e.procfuns[2060]=et,e.procfuns[2065]=ho,e.procfuns[2066]=po,e.procfuns[2062]=go,e.procfuns[2063]=mo,e.procfuns[2067]=fo,e.procfuns[2064]=vo,e.procfuns[351]=xo,e.procfuns[352]=Mo,e.procfuns[361]=Do,e.procfuns[362]=No,e.procfuns[353]=b,e.procfuns[2089]=Gt,e.procfuns[2103]=bo,e.procfuns[2104]=So,e.procfuns[2105]=Eo,e.procfuns[2106]=Co,e.procfuns[2108]=To,e.procfuns[2109]=Io,e.procfuns[2128]=Go,e.procfuns[2131]=Ao,e.procfuns[2130]=ko,e.procfuns[2129]=Po,e.procfuns[2138]=wo,e.procfuns[2139]=Lo,e.procfuns[2136]=Ro,e.procfuns[2137]=Uo,e.procfuns[2070]=Fo,e.procfuns[2071]=Oo,e.procfuns[2072]=Bo,e.procfuns[2073]=Wo,e.procfuns[2074]=Vo,e.procfuns[2075]=qo,e.procfuns[148]=jo,e.procfuns[203]=Yo,e.procfuns[2082]=Ko,e.procfuns[2069]=Ho,e.procfuns[2083]=Qo,e.procfuns[2085]=Jo,e.procfuns[2086]=zo,e.procfuns[2087]=Zo,e.procfuns[2088]=$o,e.procfuns[270]=ia,e.procfuns[2090]=es,e.procfuns[2091]=ts,e.procfuns[2096]=ns,e.procfuns[2097]=is,e.procfuns[2098]=yo,e.procfuns[2099]=_o,e.procfuns[2100]=as,e.procfuns[2101]=rs,e.procfuns[2102]=os,e.procfuns[2110]=ss,e.procfuns[2111]=ls,e.procfuns[2112]=us,e.procfuns[2113]=cs,e.procfuns[354]=hs,e.procfuns[2115]=ds,e.procfuns[2117]=ps,e.procfuns[2118]=gs,e.procfuns[2119]=ms,e.procfuns[2120]=fs,e.procfuns[2121]=vs,e.procfuns[2123]=ys,e.procfuns[2124]=bs,e.procfuns[2125]=Ss,e.procfuns[2126]=Es,e.procfuns[2127]=Cs,e.procfuns[2132]=Ts,e.procfuns[2133]=Is,e.procfuns[2134]=Gs,e.procfuns[2135]=As,e.procfuns[2141]=ks,e.procfuns[2140]=Ps,e.procfuns[2145]=ws,e.procfuns[2142]=Ls,e.procfuns[2146]=Rs,e.procfuns[2144]=Us,e.procfuns[2147]=_s,e.procfuns[2148]=xs,e.procfuns[2149]=Ms,e.procfuns[2150]=Ns,e.procfuns[2151]=Ds,e.procfuns[2153]=Fs,e.procfuns[2154]=Os,e.procfuns[2152]=Bs,e.procfuns[2143]=Ws,e.procfuns[2159]=Vs,e.procfuns[2160]=qs,e.procfuns[2161]=Hs,e.procfuns[2162]=js,e.procfuns[296]=Ys,e.procfuns[304]=Ks,e.procfuns[2164]=Qs,e.procfuns[2165]=Xs,e.procfuns[2166]=Js,e.procfuns[2167]=zs,e.procfuns[2168]=Zs,e.procfuns[2169]=$s}(net||(net={}));var Rank;!function(e){function t(e){var t=a(e),n=r[t];return null==n&&(n=new l(t),r[t]=n),n}function n(e){var t=r[e.rankType];null==t&&(t=new l(e.rankType),r[e.rankType]=t),t.update(e);var n=i(e.rankType);Game.dispatcher.dispatchEventWith(Game.EVENT.GeneralRankChange,!1,n,!1)}function i(e){switch(e){case 1:return UI.RankKind.LevelRank;case 2:return UI.RankKind.FPRank;case 5:return UI.RankKind.KillBossRank;case 6:return UI.RankKind.HuashanPkRank;case 7:return UI.RankKind.EquipRank;case 8:return UI.RankKind.PartnerRank;case 9:return UI.RankKind.SuperWeaponRank;case 10:return UI.RankKind.WllsRank;case 11:return UI.RankKind.GuildWarRank;case 12:return UI.RankKind.ArenaRank;case 13:return UI.RankKind.CrossSongjinRank;case 14:return UI.RankKind.CollectCardRank;default:return null}}function a(e){switch(e){case UI.RankKind.LevelRank:return 1;case UI.RankKind.FPRank:return 2;case UI.RankKind.KillBossRank:return 5;case UI.RankKind.HuashanPkRank:return 6;case UI.RankKind.EquipRank:return 7;case UI.RankKind.PartnerRank:return 8;case UI.RankKind.SuperWeaponRank:return 9;case UI.RankKind.WllsRank:return 10;case UI.RankKind.GuildWarRank:return 11;case UI.RankKind.ArenaRank:return 12;case UI.RankKind.CrossSongjinRank:return 13;case UI.RankKind.CollectCardRank:return 14;default:return null}}var r=new Array,o=function(){function e(){}return Object.defineProperty(e.prototype,"txtRank",{get:function(){switch(this.protocolType){case 1:return lang.String("levelTitle");case 2:return lang.String("powerTitle");case 13:return lang.String("scoreTitle");case 5:return lang.String("killBossRank");case 6:return lang.String("huashanPKRank");case 10:return lang.String("wllsRank");case 7:return lang.String("equipRank");case 8:return lang.String("partnerRank");case 9:return lang.String("superWeaponRank");case 11:return lang.String("guildwarRank");case 12:return lang.String("powerTitle");case 14:return lang.String("collectCardFp")}},enumerable:!0,configurable:!0}),e.prototype.viewPlayerDetail=function(e){if(e!=Player.instance.Name){switch(this.protocolType){case 11:return;case 12:if(e==lang.String("arena reserved name"))return void PopUpMessage.push(lang.String("arena cannot view"),color.RED)}var t=new UI.ChatPlayerDsc;UIManager.pushNoTween(t),friend.search(e)}},e}();__reflect(o.prototype,"RankItem",["Leaderboard.Item"]);var s=50,l=function(){function e(e){this.hasData=!1,this.protocolType=e}return e.prototype.requestServerData=function(){var e=Game.getServerDate().getTime();null==this.lastUpdateTime&&(this.lastUpdateTime=0);var t=e-this.lastUpdateTime;if(!(t<=Leaderboard.CACHE_TIME)){var n=new net.def.C2SRequestGeneralRank;n.setRankType(this.protocolType),net.socket.write(110,n.toArrayBuffer()),this.lastUpdateTime=e}},e.prototype.update=function(e){switch(this.hasData=!0,this.selfRank=e.selfRank,this.selfValue=e.selfValue,e.rankType){case 1:this.selfValue=PlayerAttribute.Level;break;case 2:this.selfValue=PlayerAttribute.fp}var t=e.values.length;t>s&&(t=s),this.firstRankItem=null,this.items=new Array;for(var n=0;t>n;n++){var i=new o;i.protocolType=e.rankType,i.name=e.values[n].name,i.faction=e.values[n].faction,i.rank=n+1,i.value=e.values[n].value,i.vipLv=e.values[n].vipLevel,0!=n?this.items.push(i):this.firstRankItem=i}this.lastUpdateTime=Game.getServerDate().getTime()},e}();e.GeneralRankCacheItem=l,__reflect(l.prototype,"Rank.GeneralRankCacheItem",["Leaderboard.Data"]),e.GetRankData=t,e.UpdateRankData=n}(Rank||(Rank={}));var table;!function(e){function t(){var t,n="public_config/passiveskills.json";t=RES.getRes(n),null==t&&egret.error("cannot load config:",n);for(var i in t){var a=t[i],r={id:a.id,name:a.name,desc:a.desc,level:1,icon:a.icon,type:a.type,buff:[]};for(var o in a.buffs){for(var s=a.buffs[o],l=[],u=0;u<s.value.length;u++)l.push([]),l[u]=e.ParseSegmentVarInt(s.value[u]);for(var c=[],h=0;h<=l[0].length;h++)c.push([]);for(var h=1;h<=l[0].length;h++)for(var d=0;d<s.value.length;d++)c[h].push(l[d][h-1]);r.buff.push({buffid:s.buffid,value:c})}PassiveSkillManager.passiveSkillMap[a.id]=r}}e.LoadPassiveSkill=t}(table||(table={}));var PassiveSkillManager;!function(e){function t(t,n){if(null==e.passiveSkillMap[t])return"";if("faction"==e.passiveSkillMap[t].type&&PlayerAttribute.Level<e.MIN_LEVEL)return"<font color=0xFF002A>Đạt Lv70 sẽ mở kỹ năng bị động</font>";var i=e.passiveSkillMap[t].buff,a=e.passiveSkillMap[t].desc.replace(/{(\d+)}/g,function(e){for(var t=[],a=1;a<arguments.length;a++)t[a-1]=arguments[a];return i[t[0]-1].value[n][0].toString()});return a=a.replace(/{(\d+-\d+)}/g,function(e){for(var t=[],a=1;a<arguments.length;a++)t[a-1]=arguments[a];var r=t[0].split("-");return i[r[0]-1].value[n][r[1]-1].toString()}),a=a.replace(/{(\d+-\d+\/\d+)}/g,function(e){for(var t=[],a=1;a<arguments.length;a++)t[a-1]=arguments[a];var r=t[0].split("-"),o=t[0].split("/");return(i[r[0]-1].value[n][r[1]-1]/o[1]).toString()}),a=a.replace(/{(\d+\/\d+)}/g,function(e){for(var t=[],a=1;a<arguments.length;a++)t[a-1]=arguments[a];var r=t[0].split("/");return(i[r[0]-1].value[n][0]/r[1]).toString()})}function n(e){if(e.level>PlayerAttribute.passiveSkill[e.id].level){var t=e.level-PlayerAttribute.passiveSkill[e.id].level;PlayerAttribute.skillpoint=PlayerAttribute.skillpoint-t,PlayerAttribute.passiveSkill[e.id].level=e.level,Game.dispatcher.dispatchEventWith(Game.EVENT.UpdateSkill)}}function i(t){null==PlayerAttribute.passiveSkill&&(PlayerAttribute.passiveSkill={});for(var n=PlayerAttribute.faction,i=table.faction[n].passiveSkills,a=0;a<i.length;a++){var r=i[a];PlayerAttribute.passiveSkill[r.id]={level:r.level,extendLevel:0}}for(var a=0;a<t.list.length;a++){var r=t.list[a];PlayerAttribute.passiveSkill[r.id]={level:r.level,extendLevel:r.extendLevel}}Game.dispatcher.dispatchEventWith(Game.EVENT.UpdatePassiveSkill),e.NeedUpdate=!0}function a(){var t=0;if(PlayerAttribute.Level<e.MIN_LEVEL)return t;for(var n in PlayerAttribute.passiveSkill)for(var i=PlayerAttribute.passiveSkill[n].extendLevel+PlayerAttribute.passiveSkill[n].level,a=e.passiveSkillMap[n],r=0;r<a.buff.length;r++){var o=a.buff[r];switch(o.buffid){case 1:t+=o.value[i][0]*FightingPower.Attack;break;case 7:t+=o.value[i][0]*FightingPower.Defense;break;case 17:t+=o.value[i][0]*FightingPower.Life;break;case 35:t+=o.value[i][0]*FightingPower.Luck}}return t}function r(t){return e.passiveSkillMap[t]}e.MIN_LEVEL=70;var o=function(){function e(){}return e}();e.PassiveSkill=o,__reflect(o.prototype,"PassiveSkillManager.PassiveSkill"),e.passiveSkillMap={},e.NeedUpdate=!1,e.GetAttributeDesc=t,e.UpdateSkill=n,e.OnSyncAllPassiveSkill=i,e.GetPassiveSkillFp=a,e.GetSkillConfig=r}(PassiveSkillManager||(PassiveSkillManager={}));var Skill;!function(e){function t(e){var t;switch(e.formula){case"a+b*lv":t=function(t){return e.args[0]+e.args[1]*t};break;case"a+b*lv*lv":t=function(t){return e.args[0]+e.args[1]*t*t};break;default:egret.error("[Create Formula] fail formul is "+e.formula)}switch(e.format){case"n%":return function(e){return Math.round(100*t(e)*1e3)/1e3};case"100+n%":return function(e){return Math.round(1e3*(100+100*t(e)))/1e3};default:return function(e){return Math.round(1e3*t(e))/1e3}}}function n(t){switch(t.type){case"channeling":var n=t.value,i=Math.floor(n*Game.Second);return function(t,n){return new e.SkillStateChanneling(t,i)};default:egret.error("invalid skilldirstate "+t.type)}}function i(t){switch(t.type){case"dash":var n=t.value,i=Math.floor(n.length*Game.PIXELSBYMETER),a=n.time;return function(t,n){var r=new e.SkillStateDash(t,n,i,a);return r};default:egret.error("invalid skilldirstate "+t.type)}}function a(e,t){var n,i,a=table.effects[e],r=1,o=!1;switch(a){case 5:i=g_Dir64To8(t)+1,i>8&&(i-=8),i>5&&(i=10-i,r=-1),n="skill/"+e+"/"+e+"_"+i+".json";break;case 16:i=~~(t/(MAX_DIR/a));var s=~~(t%(MAX_DIR/a));s>=HALF_DIR/a&&i++,i>=a&&(i=0),i+=1,i>a&&(i-=a),n="skill/"+e+"/"+e+"_"+i+".json";break;case-1:o=!0;default:n="skill/"+e+"/"+e+".json"}return{url:n,scaleX:r,blendMode:table.blendMode[n],movieClipName:e,rotatable:o}}function r(e,t,n,i,r,o,s){var l=r.effect,u=(table.effects[l],a(l,i)),c=u.url,h=u.scaleX,d=u.blendMode,p=e.generateMovieClipData(l),g=EffectSprite.generate(c,p);g.blendMode=d,g.scaleX=h;var m=egret.getTimer()-t,f=r.time;if("string"==typeof f)for(var v=0;v<o.length;v++)f=="{"+(v+1)+"}"&&(f=o[v](s));var y;return y=null!=f?f*Game.Second:g.movieClipData.numFrames*Game.Second/g.movieClipData.frameRate,m>=y?null:(g.setLifeTime(y-m),g.playDeltaTime(m),g)}function o(e,t){return function(n,i,o,s,l){if(!n.liteModeLimit()){var u=n.actor;if("target"==e.value&&null!=i&&(u=i.actor),null!=u){var c=egret.getTimer(),h=e.effect,d=a(h,o);u.addCommonEffect(d.url,function(n){if(null!=u["char"]){var i=r(n,c,u,o,e,t,l);if(null!=i){var a=table.actor[u.res].effectScale;i.scaleX*=a,i.scaleY*=a,i.hasTimer()&&null!=u&&u.frontEffects.addChild(i)}}})}}}}function s(e,t){return function(n,i,o,s,l){if(!n.liteModeLimit()){var u=n.actor;if("target"==e.value&&null!=i&&(u=i.actor),null!=u){var c=egret.getTimer(),h=e.effect,d=a(h,o);u.addCommonEffect(d.url,function(n){if(null!=u["char"]){var i=r(n,c,u,o,e,t,l);if(null!=i){var a=table.actor[u.res].effectScale;i.scaleX*=a,i.scaleY*=a,i.hasTimer()&&null!=u&&u.backEffects.addChild(i)}}})}}}}function l(e,t){return function(t,n,i,a,r){if(!t.liteModeLimit()){var o=t.logicPos,s=e.effect;null==a&&(a=o);var l=new ECS.GameObject,u=ECS.Transform.generate(l);u.x=a.x,u.y=a.y;var c=ECS.DragonBoneRenderer.generate(s,l);c.playTimes=0,c.onloaded=function(){var e=c.armatureDisplay;e.touchEnabled=!1,Scene.addChildToGround(e)};var h=e.time*Game.Second||Game.Second,d=ECS.LifeTimeComponent.generate(h,l);l.addComponent(u),l.addComponent(c),l.addComponent(d),ECS.world.add(l),e.shake&&null!=t.onSkillQuake&&t.onSkillQuake()}}}function u(e,t){return function(t,n,i,a,r){if(!t.liteModeLimit()){var o=t.actor;if(null!=o){var s=World.mapId,l=e.effect,u=new ECS.GameObject,c=ECS.Transform.generate(u);null==a&&(a=t.logicPos);var h=function(){if(c.x=a.x,c.y=a.y,e.value&&e.value.offsetDir&&e.value.offsetR){var t=(i+e.value.offsetDir)%64;c.x=c.x+(g_DirCos(t,64)*e.value.offsetR*Game.PIXELSBYMETER>>10),c.y=c.y+(g_DirSin(t,64)*e.value.offsetR*Game.PIXELSBYMETER>>10)}u.addComponent(c);var n;if(null!=e.time){n=e.time*Game.Second;var r=ECS.LifeTimeComponent.generate(n,u);u.addComponent(r)}var h=ECS.SkillMovieClipRenderer.generate(l,i,u);h.onloaded=function(){return null==o["char"]||s!=World.mapId?void u.destory():(h.movieClip.touchEnabled=!1,void Scene.addChild(h.movieClip))},u.addComponent(h)};if(e.value&&e.value.delay){var d=e.value.delay*Game.Second,p=ECS.TimeoutComponent.generate(d,u);p.onHandle=function(){h()},u.addComponent(p)}else h(),e.shake&&null!=t.onSkillQuake&&t.onSkillQuake();ECS.world.add(u)}}}}function c(e){var t=e.value,n=t.width*Game.PIXELSBYMETER,i=t.length*Game.PIXELSBYMETER,a=t.height*Game.PIXELSBYMETER/GameMap.ratioY,r=e.time*Game.Second,o=t.offset?t.offset*Game.PIXELSBYMETER:0;return function(s,l,u,c,h){if(!s.liteModeLimit()){var d=new x(e.effect,t.count,n,i,a,o,r);d.Cast(u,s.logicPos.x,s.logicPos.y)}}}function h(e){var t=e.value,n=t.width*Game.PIXELSBYMETER,i=t.length*Game.PIXELSBYMETER,a=t.height*Game.PIXELSBYMETER/GameMap.ratioY,r=e.time*Game.Second,o=t.offset?t.offset*Game.PIXELSBYMETER:0;return function(s,l,u,c,h){if(!s.liteModeLimit()){var d=new M(e.effect,t.count,n,i,a,o,r);d.Cast(c.clone())}}}function d(e){var t=e.value,n=t.length*Game.PIXELSBYMETER,i=t.height*Game.PIXELSBYMETER/GameMap.ratioY,a=e.time*Game.Second;return function(r,o,s,l,u){if(!r.liteModeLimit()){var c=new _;c.angle=t.angle,c.speed=n/a,c.time=a,c.gap=t.gap,c.missileRes=e.effect,c.missileCount=t.count,c.height=i,c.length=n,c.Cast(s,r.logicPos.x,r.logicPos.y)
}}}function p(e,t){return function(n,i,o,s,l){if(!n.liteModeLimit()){var u=n.actor;if("target"==e.value&&null!=i&&(u=i.actor),null!=u){var c=egret.getTimer(),h=e.effect,d=(table.effects[h],a(h,o));u.addCommonEffect(d.url,function(n){if(null!=u["char"]){var i=r(n,c,u,o,e,t,l);null!=i&&i.hasTimer()&&null!=u&&(i.x+=u.head.x,i.y+=u.head.y+10+u.feet,u.frontEffects.addChild(i))}})}}}}function g(e,t){for(var n=e.value,i=[],a=0,r=n.batch;a<r.length;a++){var o=r[a];i.push({count:o.count,radius:o.radius*Game.PIXELSBYMETER})}var s=n.interval;return function(t,n,a,r,o){if(!t.liteModeLimit()){var l=new R(e.effect,i,s);l.Cast(t,t.logicPos.clone())}}}function m(e,t){var n=e.value,i=n.length*Game.PIXELSBYMETER,a=e.time*Game.Second,r=n.offset*Game.PIXELSBYMETER,o=n.interval*Game.Second;return function(t,s,l,u,c){if(!t.liteModeLimit()){var h=new U(e.effect,a,o,n.count,r,i,e.shake),d=t.logicPos;h.Cast(t,l,d.x,d.y)}}}function f(e,t){"ground"==t.type?e.resources.push({name:t.effect,kind:k.DragonBone}):e.resources.push({name:t.effect,kind:k.MovieClip});var n=e.formulas;switch(t.type){case"front":return o(t,n);case"back":return s(t,n);case"scene":return u(t,n);case"ground":return l(t,n);case"line":return c(t);case"head":return p(t,n);case"circleArea":return g(t,n);case"sector":return d(t);case"linedrop":return m(t,n);case"circleMissile":return h(t);default:egret.error("invalid animition type="+t.type)}}function v(e,n){e.lockType=n.lockType,e.castTarget=0!=n.castTarget,e.id=n.id,e.name=n.name,e.type=n.type,e.action=n.action;var i=table.ParseSegmentVar(n.cd);e.descCdList=[];for(var a=0;a<i.length;a++)e.descCdList.push(Math.ceil(i[a])),i[a]=i[a]*Game.Second;if(e.cd=i,n.descTargetCnt&&(e.descTagetCnt=table.ParseSegmentVar(n.descTargetCnt)),e.actionTime=n.time*Game.Second,e.distance=n.distance*Game.PIXELSBYMETER,e.icon=n.icon,e.rage=n.rage*Game.RageRatio,e.hitanimition=n.hitanimition,e.desc=n.desc,e.needLevel=n.needLevel,e.formulas=[],null!=n.formulas)for(var a=0;a<n.formulas.length;a++)e.formulas.push(t(n.formulas[a]));if(e.resources=[],null!=e.hitanimition&&e.resources.push({name:e.hitanimition,kind:k.MovieClip}),null!=n.effectAnimition&&(e.effectAnimition=f(e,n.effectAnimition)),e.timeline=[],n.timeline)for(var r=0,o=n.timeline;r<o.length;r++){var s=o[r];e.timeline.push(A.parse(s,e))}}function y(e){var t=new P;return v(t,e),t}function b(e){var t=new w;return v(t,e),null!=e.state&&(t.stateCreater=i(e.state)),t}function S(e){var t=new L;return v(t,e),null!=e.state&&(t.stateCreater=n(e.state)),t}function E(){e.mapSkillKind=RES.getRes("public_config/skill_kind.json");for(var t=RES.getRes("public_config/skills.json"),n=0;n<t.length;n++){var i=t[n];switch(i.type){case"dir":e.mapSkill[i.id]=b(i);break;case"aoe":e.mapSkill[i.id]=S(i);break;default:e.mapSkill[i.id]=y(i)}}}function C(t){var n=PlayerAttribute.GetSkillFinalLevel(t);return e.mapSkill[t].cd[n-1]}function T(e,t){return~~(300*e/(300+t))}function I(e,t){if(e=~~(e*Game.ServerFPS/Game.Second),0==e)return{lifeTime:0,actionTime:0};e=T(e,t),1>e&&(e=1);var n=~~(e*D/100)-1;0>n&&(n=0);var i=Game.Second/Game.ServerFPS;return{lifeTime:~~(e*i),actionTime:~~(n*i)}}e.MAX_UPGRADE_LEVEL=30,e.MAX_EXTEND_LEVEL=10,e.MAX_LEVEL=e.MAX_EXTEND_LEVEL+e.MAX_UPGRADE_LEVEL;var G;!function(e){e[e.CharSkill=0]="CharSkill",e[e.DirSkill=1]="DirSkill",e[e.AoeSkill=2]="AoeSkill"}(G||(G={}));var A=function(){function e(){}return e.parse=function(t,n){var i=new e;switch(i.kind=t.type,"castTime"==t.delay?i.time=n.actionTime*D/100:i.time=t.delay*Game.Second,t.type){case"sound":i.play=function(e){1!=e.delegateKind||UI.HUD.instance.btnGuild.selected||SoundUtil.playSoundEffect(t.value)};break;default:n.formulas;i.play=f(n,t)}return i},e}();e.SkillAction=A,__reflect(A.prototype,"Skill.SkillAction");var k;!function(e){e[e.MovieClip=0]="MovieClip",e[e.DragonBone=1]="DragonBone"}(k=e.AnimationKind||(e.AnimationKind={}));var P=function(){function e(){}return e.prototype.GetDesc=function(e,t){var n=this;if(null==this.desc)return"";if(t>=this.needLevel){var i=this.desc.replace(/{(\d+)}/g,function(t){for(var i=[],a=1;a<arguments.length;a++)i[a-1]=arguments[a];return n.formulas[i[0]-1](e).toString()});return i=i.replace("{cd}",this.descCdList[e-1].toString()),null!=this.descTagetCnt&&(i=i.replace("{target}",Math.floor(this.descTagetCnt[e-1]).toString())),i}return lang.StringWithFormat("on {1} level to unlock this skill",this.needLevel)},e}();__reflect(P.prototype,"Skill");var w=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(P);e.DirSkill=w,__reflect(w.prototype,"Skill.DirSkill");var L=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(P);e.AoeSkill=L,__reflect(L.prototype,"Skill.AoeSkill"),e.getUrlByDir=a,e.mapSkill={},e.mapSkillKind={},e.loadskills=E;var R=function(){function e(e,t,n){this.batch=t,this.resource=e,this.interval=n,this.wave=0,this.maxWave=t.length}return e.prototype.clear=function(){null!=this.timer&&(egret.clearInterval(this.timer),delete e.objs[this.timer],this.timer=null),this["char"]=null},e.prototype.Cast=function(t,n){return this["char"]=t,this.center=n,null!=this.timer?void egret.error("Cast Skill animition type=circleArea timer != null"):(this.timer=egret.setInterval(this.onTimer,this,this.interval*Game.Second),void(e.objs[this.timer]=this))},e.prototype.onTimer=function(){for(var e=this.batch[this.wave].count,t=this.batch[this.wave].radius,n=function(n){var r=MAX_DIR/e*n%MAX_DIR,o=g_Move(r,t),s=egret.getTimer(),l=i.resource,u=a(l,r),c=u.url,h=Scene.logicPos2DisplayPos(o.add(i.center));World.addEffect(c,function(e){var t=egret.getTimer()-s,n=e.generateMovieClipData(l),i=EffectSprite.generate(c,n);i.blendMode=table.blendMode[c];var a=i.movieClipData.numFrames*Game.Second/i.movieClipData.frameRate;t>=a||(i.x=h.x,i.y=h.y,i.playDeltaTime(t),i.setLifeTime(a-t),Scene.addChild(i))})},i=this,r=0;e>r;r++)n(r);null!=this["char"].onSkillQuake&&this["char"].onSkillQuake(),this.wave++,this.wave>=this.maxWave&&this.clear()},e.objs={},e}();e.CircleArea=R,__reflect(R.prototype,"Skill.CircleArea");var U=function(){function e(e,t,n,i,a,r,o){this.maxCount=i,this.resource=e,this.interval=n,this.space=~~(r/i),this.wave=0,this.offset=a,this.shake=o,this.time=t}return e.prototype.clear=function(){null!=this.timer&&(egret.clearInterval(this.timer),delete e.objs[this.timer],this.timer=null),this["char"]=null},e.prototype.Cast=function(t,n,i,a){return null!=this.timer?void egret.error("Cast Skill animition type=circleArea timer != null"):(this["char"]=t,this.dir=n,this.center=egret.Point.create(i,a),this.xFactor=g_DirCos(n%64,64)/1024,this.yFactor=g_DirSin(n%64,64)/1024,this.center.offset(this.offset*this.xFactor,this.offset*this.yFactor),this.timer=egret.setInterval(this.onTimer,this,this.interval),void(e.objs[this.timer]=this))},e.prototype.onTimer=function(){var e=this;this.wave>0&&this.center.offset(this.space*this.xFactor,this.space*this.yFactor);var t=egret.getTimer(),n=this.resource,i="skill/"+n+"/"+n+".json",a=Scene.logicPos2DisplayPos(this.center);World.addEffect(i,function(r){var o=egret.getTimer()-t,s=r.generateMovieClipData(n),l=EffectSprite.generate(i,s);l.blendMode=table.blendMode[i];var u;u=e.time?e.time:l.movieClipData.numFrames*Game.Second/l.movieClipData.frameRate,o>=u||(l.x=a.x,l.y=a.y,l.playDeltaTime(o),l.setLifeTime(u-o),Scene.addChild(l))}),this.shake&&null!=this["char"].onSkillQuake&&this["char"].onSkillQuake(),this.wave++,this.wave>=this.maxCount&&this.clear()},e.objs={},e}();e.DropBombs=U,__reflect(U.prototype,"Skill.DropBombs");var _=function(){function e(){}return e.prototype.Cast=function(e,t,n){for(var i=this.angle,r=0;r<this.missileCount;r++){var o=~~((r-(this.missileCount-1)/2)*i+e);0>o&&(o+=64),o%=64;var s=g_DirCos(o,64),l=g_DirSin(o,64),u=t+this.gap*s/1024,c=n+this.gap*l/1024;if(!(0>u||0>c)){var h=MovableEffectSprite.generate(),d=a(this.missileRes,o);h.dir=o,h.xFactor=s/1024,h.yFactor=l/1024,h.load(d);var p=Scene.logicPos2DisplayPos(new egret.Point(u,c));h.x=p.x,h.y=p.y,egret.Point.release(p),h.speed=this.speed,Scene.addChild(h),h.anchorOffsetY=this.height,h.setLifeTime(this.time)}}},e}();e.MissileSector=_,__reflect(_.prototype,"Skill.MissileSector"),e.getSkillCD=C;var x=function(){function e(e,t,n,i,a,r,o){this.missileCount=t,this.width=n,this.length=i,this.height=a,this.missileRes=e,this.time=o,this.speed=i/o,this.offset=r}return e.prototype.Cast=function(e,t,n){for(var i=(this.missileCount-1)*this.width/2,r=g_DirCos((e+16)%64,64),o=g_DirSin((e+16)%64,64),s=0;s<this.missileCount;s++){var l=t+((s*this.width-i)*r>>10),u=n+((s*this.width-i)*o>>10);if(!(0>l||0>u)){var c=MovableEffectSprite.generate(),h=a(this.missileRes,e);c.dir=e,c.load(h);var d=g_Move(RotateClockwise(e,32),this.offset);d.offset(l,u);var p=Scene.logicPos2DisplayPos(d);c.x=p.x,c.y=p.y,egret.Point.release(p),c.speed=this.speed,Scene.addChild(c),c.xFactor=g_DirCos(e,64)/1024,c.yFactor=g_DirSin(e,64)/1024,c.anchorOffsetY=this.height,c.setLifeTime(this.time)}}},e}();e.MissileLine=x,__reflect(x.prototype,"Skill.MissileLine");var M=function(){function e(e,t,n,i,a,r,o){this.missileCount=t,this.width=n,this.length=i,this.height=a,this.missileRes=e,this.time=o,this.speed=i/o,this.offset=r,this.missileCount<=0&&(this.missileCount=1)}return e.prototype.Cast=function(e){this.center=e;for(var t=0;t!=this.missileCount;t++){var n=MAX_DIR/this.missileCount*t%MAX_DIR,i=g_DirCos((n+16)%64,64),r=g_DirSin((n+16)%64,64),o=this.center.x+((t*this.width-this.center.x)*i>>10),s=this.center.y+((t*this.width-this.center.y)*r>>10),l=g_Move(n,this.length);l.offset(o,s);var u=Scene.logicPos2DisplayPos(this.center),c=a(this.missileRes,n),h=MovableEffectSprite.generate();h.dir=n,h.load(c),h.x=u.x,h.y=u.y,egret.Point.release(u),h.speed=this.speed,Scene.addChild(h),h.xFactor=g_DirCos(n,64)/1024,h.yFactor=g_DirSin(n,64)/1024,h.anchorOffsetY=this.height,h.setLifeTime(this.time)}},e}();e.CircleMissile=M,__reflect(M.prototype,"Skill.CircleMissile");var D=60;e.CalcTime=T,e.GetSkillTime=I}(Skill||(Skill={}));var Skill;!function(e){var t=function(){function e(e,t){this["char"]=e,this.time=t}return e.prototype.execute=function(e){var t=this["char"].actor.body;return null==t||null==t.parent||t.isPlaying||t.play(-1),this.time-=e,this.time>0},e.prototype.release=function(){this["char"]=null,this.animition=null,this.time=null},e}();e.SkillStateChanneling=t,__reflect(t.prototype,"Skill.SkillStateChanneling",["Skill.SkillState"])}(Skill||(Skill={}));var Skill;!function(e){var t=function(){function e(e,t,n,i){this["char"]=e;var a=g_Move(t,n),r=this["char"].logicPos;if(this.length=n,this.speed=n/i,null!=e.revisePos?(this.desPoint=egret.Point.create(e.revisePos.x+a.x,e.revisePos.y+a.y),e.revisePos=null):this.desPoint=egret.Point.create(e.logicPos.x+a.x,e.logicPos.y+a.y),this.dt=0,this.vector={x:r.x<<10,y:r.y<<10},!r.equals(this.desPoint)){var o=g_GetDirIndex2(r,this.desPoint),s=o.dir,l=o.sin,u=o.cos;this.dir=s,this.sin=l,this.cos=u}}return e.prototype.execute=function(e){return this.dt+=e,this.run(this.speed*e/Game.Second)},e.prototype.run=function(e){var t=this["char"],n=this.desPoint,i=t.logicPos,a=!1,r=~~(this.dt/Game.ServerMSPF);r>=1?this.dt-=Game.ServerMSPF*r:a=!0;var o=n.x-i.x,s=n.y-i.y;if(0==o&&0==s)return!1;var l=this.dir;return g_WithInRange(i,n,e)?(this.runStep(l,n),!1):(o=~~(this.cos*e),s=~~(this.sin*e),this.vector.x+=o,this.vector.y+=s,this.runStep(l,egret.Point.create(this.vector.x>>10,this.vector.y>>10))?!t.logicPos.equals(n):a)},e.prototype.runStep=function(e,t){var n=this["char"],i=n.logicPos;return Scene.HitObstacle(i.x,i.y,t.x,t.y)?!1:(n.locate(e,t),!0)},e.prototype.release=function(){this["char"]=null,this.desPoint=null,this.vector=null},e}();e.SkillStateDash=t,__reflect(t.prototype,"Skill.SkillStateDash",["Skill.SkillState"])}(Skill||(Skill={}));var CommonTitle;!function(e){function t(){for(var t=RES.getRes("public_config/title/commontitle.json"),n=0;n<t.length;n++){var i=t[n];if(i.visible){i.fp=0;for(var a=0,c=i.buff;a<c.length;a++){var h=c[a],d=TitleManager.getAttribute(h,0);i.fp+=Buff.GetFightingPower(d.id,d.values)}e.titles[i.id]=new u(i)}}net.Register(235,r),net.Register(236,o),net.Register(237,s),net.Register(238,l)}function n(e){var t=new net.def.TitleId;t.id=e,net.socket.write(125,t.toArrayBuffer())}function i(t){var n=e.titles[t];return null==n?null:n.resource}function a(){var t=0;for(var n in e.activated){var i=e.activated[n];i&&e.titles[i.id]&&(t+=e.titles[i.id].FP)}return t}function r(t){var n=net.def.S2CSyncCommonTitles.decode(t),i=n.titles.length;e.activated={};for(var a=0;i>a;a++){var r=n.titles[a];e.activated[r.id]={id:r.id},0!=r.duration&&(e.activated[r.id].expiryTime=new Date(r.duration*Game.Second+Game.getServerDate().getTime()))}}function o(e){var t=net.def.BroadCastTitle.decode(e),n=mapCharacter[t.id];return null==n?void egret.error("[S2CBroadCastCommonTittle] id="+t.id+" not found"):(n.updateCommonTitle(t.title),void Game.dispatcher.dispatchEventWith(Game.EVENT.CommonTitleChange))}function s(t){var n=net.def.TitleId.decode(t);delete e.activated[n.id],Game.dispatcher.dispatchEventWith(Game.EVENT.CommonTitleChange),PlayerAttribute.UpdateFightingPower(!0)}function l(t){var n=net.def.CommonTitle.decode(t),i=n.id;e.activated[i]={id:i},0!=n.duration&&(e.activated[i].expiryTime=new Date(n.duration*Game.Second+Game.getServerDate().getTime())),Game.dispatcher.dispatchEventWith(Game.EVENT.CommonTitleChange),PlayerAttribute.UpdateFightingPower(!0)}var u=function(){function t(e){this.info=e}return Object.defineProperty(t.prototype,"name",{get:function(){return this.info.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"desc",{get:function(){return this.info.desc},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"weight",{get:function(){return this.info.id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){var t=this.info;return Player.instance.commonTitle==t.id?"using":null!=e.activated[t.id]?"activated":"inactivated"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resource",{get:function(){return this.info.resource},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"expiryTime",{get:function(){var t=this.info;return null!=e.activated[t.id]?e.activated[t.id].expiryTime:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"attributes",{get:function(){for(var e=this.info,t=e.buff.length,n=[],i=0;t>i;i++){var a=TitleManager.getAttribute(e.buff[i],0);n.push(Buff.GetDesc(a.id,a.values,!0))}return n},enumerable:!0,configurable:!0}),t.prototype.handle=function(){var t=this.info.id;if(null!=e.activated[t]&&Player.instance.commonTitle!=t){var n=new net.def.TitleId;n.id=t,net.socket.write(125,n.toArrayBuffer())}},Object.defineProperty(t.prototype,"FP",{get:function(){return this.info.fp},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible",{get:function(){return this.info.visible},enumerable:!0,configurable:!0}),t}();__reflect(u.prototype,"TitleInfo",["TitleManager.Title"]),e.titles={},e.activated={},e.load=t,e.Use=n,e.getResource=i,e.getFP=a}(CommonTitle||(CommonTitle={}));var FactionTitle;!function(e){function t(){return w()?n():i()}function n(){var t=e.activateCfgs[e.id];return t?t.fp>PlayerAttribute.fp?!1:a(t):!1}function i(){if(null==e.id||e.id<=0)return!1;var t=e.level+1;if(t>=e.MaxLevel)return!1;var n=P(t);return n?a(n):!1}function a(e){var t=PlayerAttribute.currency;return e.material&&e.material.count>PlayerAttribute.bag.CalcCount(e.material.genre,e.material.detailType)?!1:e.copperCoin&&e.copperCoin>t[Game.Currency.CopperCoin]?!1:!0}function r(){var t=RES.getRes("public_config/title/factiontitle.json");L=t.buffs,e.activateCfgs=t.activate,e.levelupCfgs=t.levelup;for(var n=0;n<t.titles.length;n++){var i=t.titles[n];e.titles[i.id]=i}for(var a=0,r=t.fightingPower;a<r.length;a++)for(var o=r[a],s=o.levelFrom;s<=o.levelTo;s++)e.fightingPowerCfgs[s]=o.coef;net.Register(176,d),net.Register(174,p),net.Register(175,g),net.Register(186,m)}function o(){PlayerAttribute.faction;return 0==e.id?e.titles[1].name:e.titles[e.id].name}function s(t){var n=e.titles[t];return null==n?null:n.desc}function l(t){var n=e.titles[t];return null==n?null:n.resource}function u(t){for(var n=0,i=t;i>=0;i--)n+=e.fightingPowerCfgs[i];return 100*n}function c(){return e.id>0?u(e.level):0}function h(){return e.id>0?u(e.level-1):0}function d(e){var t=net.def.BroadCastTitle.decode(e),n=mapCharacter[t.id];return null==n?void egret.error("[S2CBroadCastFactionTitle] id="+t.id+" not found"):void n.updateFactionTitle(t.title)}function p(e){e&&m(e),PlayerAttribute.UpdateFightingPower(!0),Game.dispatcher.dispatchEventWith(Game.EVENT.FactionTitleLevelUp),badge.onLight(badge.action.LevelUpFactionTitle,t())}function g(e){e&&m(e),PlayerAttribute.UpdateFightingPower(!0),Game.dispatcher.dispatchEventWith(Game.EVENT.FactionTitleLevelUp)}function m(t){var n=net.def.S2CSyncFactionTitle.decode(t);e.id=n.id,e.level=n.level}function f(){w()?v():y()}function v(){var t=e.activateCfgs[e.id];return t.fp>PlayerAttribute.fp?void PopUpMessage.push(lang.StringWithFormat("fp is less than {1}",t.fp),color.RED):void((0==e.id||b(t))&&net.socket.write(119,null))}function y(){if(null==e.id||e.id<=0)return void PopUpMessage.push(lang.String("faction title need active first"),color.RED);var t=e.level+1;if(!(t>=e.MaxLevel)){var n=P(t);n&&b(n)&&net.socket.write(119,null)}}function b(e){var t=PlayerAttribute.currency;return e.material.count>PlayerAttribute.bag.CalcCount(e.material.genre,e.material.detailType)?(2==e.material.genre&&1==e.material.detailType?UI.ResourceObtain.Open([UI.ObtResId.lunjianling]):2==e.material.genre&&e.material.detailType>1&&UI.ResourceObtain.Open([UI.ObtResId.titleActivate]),!1):e.copperCoin>t[Game.Currency.CopperCoin]?(UI.ResourceObtain.Open([UI.ObtResId.CopperCoin]),!1):!0}function S(e){for(var t=L[table.faction[PlayerAttribute.faction].series],n=t.length,i=[],a=0;n>a;a++){var r=TitleManager.getAttribute(t[a],e);i.push(Buff.GetDesc(r.id,r.values))}return i}function E(){return e.level>0?S(e.level-1):[]}function C(){return e.level<e.MaxLevel?S(e.level):[]}function T(){return e.level+1}function I(){return w()?A():G()}function G(){var t=e.level+1;if(t>=e.MaxLevel)return null;var n=P(t);return n?k(n):null}function A(){var t=e.activateCfgs[e.id];return t?k(t):null}function k(e){var t=PlayerAttribute.currency,n=[],i=0;return e.material&&(i=PlayerAttribute.bag.CalcCount(e.material.genre,e.material.detailType),n.push({name:table.props[e.material.genre][e.material.detailType].name,require:e.material.count,count:i,countTxt:i})),e.copperCoin&&(i=t[Game.Currency.CopperCoin],n.push({name:lang.String("copperCoin"),require:e.copperCoin,count:i,countTxt:PlayerAttribute.currencyTxt[Game.Currency.CopperCoin]})),n}function P(t){for(var n=null,i=e.levelupCfgs.length,a=0;i>a;a++){var r=e.levelupCfgs[a];if(t>=r.levelFrom&&t<=r.levelTo){n=r;break}}return n}function w(){return e.level<e.MaxLevel&&(0==e.id||e.titles[e.id].maxLevel+1==e.level)}e.MaxLevel=380;var L;e.titles={},e.fightingPowerCfgs={},e.level=0,e.id=0,e.LevelUpReddot=t,e.load=r,e.getName=o,e.getDesc=s,e.getResource=l,e.getFP=c,e.getCurFP=h,e.LevelUp=f,e.getAttributes=E,e.getNextAttributes=C,e.getLevel=T,e.getCostDesc=I,e.isNeedActivate=w}(FactionTitle||(FactionTitle={}));var TitleManager;!function(e){function t(t,n){var i=e.AttributesConfig[t];if(null==i)return egret.error("title attribute "+t+" not found"),null;var a={id:i.attrId,values:[]};switch(i.attrType){case"single":a.values.push(i.varList[0]);break;case"liner":var r=i.varList[0],o=i.varList[1];a.values.push(r+n*o);break;case"bylevel":a.values.push(i.varList[n])}return a}function n(){for(var t=RES.getRes("public_config/title/titleattributes.json"),n=0;n<t.length;n++){var i=t[n];e.AttributesConfig[i.id]=i}FactionTitle.load(),CommonTitle.load()}e.AttributesConfig={},e.getAttribute=t,e.load=n}(TitleManager||(TitleManager={}));var UI;!function(e){function t(e){if(a!=e){a=e;for(var t in mapCharacter){var n=mapCharacter[t];null!=n&&null!=n.actor&&null!=n.actor.head&&(e?(n.actor.head.updateTitle2(""),n.actor.head.updateTitle("")):(n.actor.head.updateTitle2(CommonTitle.getResource(n.commonTitle)),n.actor.head.updateTitle(FactionTitle.getResource(n.factionTitle))))}}}function n(e){if(r!=e){r=e;for(var t in mapCharacter){var n=mapCharacter[t];null!=n&&1==n.kind&&null!=n.actor&&null!=n.actor.head&&(e?n.actor.head.hideRoleName(!0):n.actor.head.hideRoleName(!1))}}}function i(e){if(o!=e){o=e;for(var t in mapCharacter){var n=mapCharacter[t];null!=n&&1==n.kind&&null!=n.actor&&null!=n.actor.head&&(e?n.actor.head.hideRoleLifeBar(!0):n.actor.head.hideRoleLifeBar(!1))}}}var a=!1;e.setDisableAllPlayerTitles=t;var r=!1;e.setDisableAllPlayerName=n;var o=!1;e.setDisableAllPlayerLifeBar=i;var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.measure=function(){if(this.$target){for(var e=this.$target,t=e.numElements,n=0,i=0,a=egret.$TempRectangle,r=0;t>r;r++){var o=e.getElementAt(r);egret.is(o,"eui.UIComponent")&&o.$includeInLayout&&(this.centerTarget.getPreferredBounds(a),n+=a.width,this.centerTarget==o&&(i=a.height))}e.setMeasuredSize(n,i)}},t.prototype.updateDisplayList=function(e,t){if(this.$target){var n=this.$target,i=n.numElements,a=new egret.Rectangle,r=egret.$TempRectangle,o=n.getChildIndex(this.centerTarget);this.centerTarget.getPreferredBounds(a),this.centerTarget.setLayoutBoundsPosition(e/2-a.width/2,0);for(var s=e/2+a.width/2,l=o+1;i>l;l++){var u=n.getElementAt(l);egret.is(u,"eui.UIComponent")&&u.$includeInLayout&&(u.getPreferredBounds(r),u.setLayoutBoundsPosition(s,u.anchorOffsetY),s+=r.width)}for(var c=e/2-a.width/2,l=o-1;l>=0;l--){var u=n.getElementAt(l);egret.is(u,"eui.UIComponent")&&u.$includeInLayout&&(u.getPreferredBounds(r),c-=r.width,u.setLayoutBoundsPosition(c,u.anchorOffsetY))}}},t}(eui.LayoutBase);__reflect(s.prototype,"CenterLayout"),e.guildTagImage={Friend:"ui/common1/guildFriend.png",Enemy:"ui/common1/guildEnemy.png"};var l=function(t){function n(){var e=t.call(this)||this;e.horizontalCenter=0,e.bottom=0,e.touchEnabled=!1,e.group2=new eui.Group;var n=new eui.VerticalLayout;n.horizontalAlign=egret.HorizontalAlign.CENTER,n.verticalAlign=egret.VerticalAlign.BOTTOM,n.gap=6,e.group2.layout=n,e.roleNameLabel=new eui.Label,e.roleNameLabel.size=14,e.roleNameLabel.fontFamily=egret.TextField.default_fontFamily,e.roleNameLabel.bold=!1,e.roleNameLabel.strokeColor=0,e.roleNameLabel.stroke=1,e.group1=new eui.Group;var n=new s;n.centerTarget=e.roleNameLabel,e.group1.layout=n,e.lifeBar=new eui.ProgressBar,e.lifeBar.skinName="SelfLifeBarSkin",e.group3=new eui.Group;var n=new s;n.centerTarget=e.lifeBar,e.group3.layout=n,e.series=new eui.Image,e.group1.addChild(e.roleNameLabel),e.group3.addChild(e.lifeBar),e.group3.addChild(e.series),e.addChild(e.group2),e.addChild(e.group1),e.addChild(e.group3),e.touchEnabled=!1,e.addEventListener(egret.Event.RESIZE,e.onReSize,e);var n=new eui.VerticalLayout;return n.horizontalAlign=egret.HorizontalAlign.CENTER,n.verticalAlign=egret.VerticalAlign.BOTTOM,n.gap=2,e.layout=n,e.init(),e}return __extends(n,t),n.prototype.init=function(){this.roleNameLabel.textColor=16777215,this.lifeBar.visible=!0,this.onReSize()},n.prototype.destory=function(){this.title&&(this.title.free(),Game.removeFromParent.apply(this.title)),this.title2&&(this.title2.free(),Game.removeFromParent.apply(this.title2)),this.init(),this.series.clearResourceReference(),this.lifeBar.clearResourceReference(),this.x=0,this.y=0,this.roleNameLabel.size=14},n.prototype.onReSize=function(){this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height},n.prototype.updateLife=function(e){this.lifeBar.value=e},n.prototype.updateMaxLife=function(e){this.lifeBar.maximum=e},n.prototype.updateRoleNameColor=function(e){this.roleNameLabel.textColor=e},n.prototype.updateGuildColor=function(t){t?(this.updateGuildNameColor(color.FriendGuild),this.updateGuildImage(e.guildTagImage.Friend)):(this.updateGuildNameColor(color.EnemyGuild),this.updateGuildImage(e.guildTagImage.Enemy))},n.prototype.updateGuildNameColor=function(e){this.roleGuildName.textColor=e},n.prototype.updateGuildImage=function(e){this.roleGuildTag.source=e},n.prototype.updateRoleNameSize=function(e){this.roleNameLabel.size=e},Object.defineProperty(n.prototype,"roleName",{get:function(){return this.name},set:function(e){this.name=e,this.roleNameLabel.textFlow=Game.HtmlTextParser.parse(this.roleName)},enumerable:!0,configurable:!0}),n.prototype.hideLifeBar=function(){this.lifeBar.visible=!1},n.prototype.hideRoleName=function(e){null==e&&(e=r),e?(this.group1.visible=!1,this.group4&&(this.group4.visible=!1),this.title2&&(this.title2.visible=!1)):(this.group1.visible=!0,this.group4&&(this.group4.visible=!0),this.title2&&(this.title2.visible=!0))},n.prototype.hideRoleLifeBar=function(e){null==e&&(e=o),e?this.group3.visible=!1:this.group3.visible=!0},n.prototype.updateGuildName=function(e){if(e){if(null==this.roleGuildName&&(this.roleGuildName=new eui.Label,this.roleGuildName.size=12,this.roleGuildName.fontFamily=egret.TextField.default_fontFamily,this.roleGuildName.bold=!1,this.roleGuildName.stroke=1),null==this.roleGuildTag&&(this.roleGuildTag=new eui.Image,this.roleGuildTag.width=18,this.roleGuildTag.height=18,this.roleGuildTag.anchorOffsetY=-5),null==this.group4){this.group4=new eui.Group;var t=new s;t.centerTarget=this.roleGuildName,this.group4.layout=t}this.roleGuildName.text=e,this.group2.addChildAt(this.group4,1),this.group4.addChildAt(this.roleGuildTag,0),this.group4.addChildAt(this.roleGuildName,1),this.group4.visible=!r}else this.group4&&Game.removeFromParent.apply(this.group4)},n.prototype.updateRoleName=function(){null!=this.roleNameLabel&&(this.roleNameLabel.textFlow=Game.HtmlTextParser.parse(this.roleName))},n.prototype.updateSceneTitleLabel=function(){var e=this.campName?this.campName:"",t=this.sceneTitle?e+this.sceneTitle.text:e;if(t){this.sceneTitleLabel||(this.sceneTitleLabel=new eui.Label,this.sceneTitleLabel.size=16,this.sceneTitleLabel.fontFamily=egret.TextField.default_fontFamily,this.sceneTitleLabel.bold=!1,this.sceneTitleLabel.stroke=1);var n=this.sceneTitle?this.sceneTitle.textColor:color.WHITE;this.sceneTitleLabel.textColor=n,this.sceneTitleLabel.text=t,this.group2.addChildAt(this.sceneTitleLabel,0)}else this.sceneTitleLabel&&Game.removeFromParent.apply(this.sceneTitleLabel)},n.prototype.updateCampName=function(e){this.campName=e,this.updateSceneTitleLabel()},n.prototype.updateSceneTitle=function(e){this.sceneTitle=e,this.updateSceneTitleLabel()},n.prototype.updateTitle=function(t){t&&!a?(this.title||(this.title=new e.MovieClipComponent,this.title.justify=!1,this.title.contentJustify=!1,this.title.position="center",this.title.width=48,this.title.height=16,this.title.auto=!0),this.title.Load("title/"+t+"/"+t+".json",t),this.group1.addChildAt(this.title,0)):this.title&&Game.removeFromParent.apply(this.title)},n.prototype.updateSeries=function(e){switch(e){case Game.Series.SeriesEarth:this.series.source="icon/seriesIcon/portrait_npc_earth_1_0.png";break;case Game.Series.SeriesFire:this.series.source="icon/seriesIcon/portrait_npc_fire_1_0.png";break;case Game.Series.SeriesWater:this.series.source="icon/seriesIcon/portrait_npc_water_1_0.png";break;case Game.Series.SeriesMetal:this.series.source="icon/seriesIcon/portrait_npc_gold_1_0.png";break;case Game.Series.SeriesWood:this.series.source="icon/seriesIcon/portrait_npc_wood_1_0.png";break;default:this.series.source=null}},n.prototype.updateTitle2=function(t){t&&!a?(this.title2||(this.title2=new e.MovieClipComponent,this.title2.position="bottom",this.title2.auto=!0,this.title2.height=2,this.title2.width=2,this.title2.justify=!1),this.title2.Load("title/"+t+"/"+t+".json",t),this.title2.offsetY=8,this.title2.updatePosition(),this.addChildAt(this.title2,0),this.title2.visible=!r):this.title2&&Game.removeFromParent.apply(this.title2)},n.prototype.changeLifeBarState=function(e){this.lifeBar.currentState=e},n.prototype.changeLifeBarSkin=function(e){this.lifeBar.skinName=e,this.lifeBar.invalidateState()},n}(eui.Group);e.ActorHead=l,__reflect(l.prototype,"UI.ActorHead")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;n.wearId=0,n.skinName="ActorStatueSkin";var i=new e.MovieClipComponent;return i.position="bottom",i.horizontalCenter=0,i.verticalCenter=0,n.mc=i,n.icon.addChild(n.mc),n}return __extends(n,t),n.prototype.setStatue=function(e,t,n){this.setResource(table.faction[e].resource,t,n)},n.prototype.setResource=function(e,t,n){this.clear(),this.factionId=null,this.actName=t,null==this.actName&&(this.actName="st"),this.faceDir=n,null==this.faceDir&&(this.faceDir="1"),this.updateActor(e,this.actName,this.faceDir)},n.prototype.clear=function(){this.faceDir=null,this.factionId=null,this.actName=null,this.mc.free(),null!=this.effect&&this.effect.free()},n.prototype.updateActor=function(e,t,n){var i=t+"_"+n,a="actor/"+e+"/"+i+".json",r=this.mc;r.Load(a,i),r.play(-1)},n.prototype.updateSuperWeaponEffect=function(t){if(null!=this.effects&&null!=this.effects.stage)if(this.wearId=t,0>=t)this.effect&&Game.removeFromParent.apply(this.effect);else{var n=table.superWeaponCfg[t].effect,i="skill/"+n+"/"+n+".json",a=this.effect;null==a&&(a=new e.MovieClipComponent,a.position="bottom",a.horizontalCenter=0,a.verticalCenter=0,a.auto=!0,this.effect=a),null==a.parent&&this.effects.addChild(a),a.Load(i,n)}},n}(eui.Component);e.ActorStatue=t,__reflect(t.prototype,"UI.ActorStatue",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="AnnounceUISkin",t.touchEnabled=!1,t.UpdateMask(),t}return __extends(t,e),t.prototype.UpdateMask=function(){null!=this.msgGroup&&(null==this.msgGroup.mask?this.msgGroup.mask=new egret.Rectangle(0,0,this.width-20,this.height):(this.msgGroup.mask.width=this.width-20,this.msgGroup.mask.height=this.height))},t}(eui.Component);e.AnnounceUI=t,__reflect(t.prototype,"UI.AnnounceUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="MagicUISkin",t.d=Player.instance,t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.DetailAttribute,this.onDataChange,this),this.onDataChange()},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.DetailAttribute,this.onDataChange,this),this.d=null,this.fa=null},t.prototype.onDataChange=function(){this.d=Player.instance,this.fa=PlayerAttribute.fa,this.SeriesAttack0=this.fa.SeriesAttack[0],this.SeriesAttack1=this.fa.SeriesAttack[1],this.SeriesAttack2=this.fa.SeriesAttack[2],this.SeriesAttack3=this.fa.SeriesAttack[3],this.SeriesAttack4=this.fa.SeriesAttack[4],this.SeriesDefense0=this.fa.SeriesDefense[0],this.SeriesDefense1=this.fa.SeriesDefense[1],this.SeriesDefense2=this.fa.SeriesDefense[2],this.SeriesDefense3=this.fa.SeriesDefense[3],this.SeriesDefense4=this.fa.SeriesDefense[4],this.SeriesNeglectDefense0=this.fa.SeriesNeglectDefense[0],this.SeriesNeglectDefense1=this.fa.SeriesNeglectDefense[1],this.SeriesNeglectDefense2=this.fa.SeriesNeglectDefense[2],this.SeriesNeglectDefense3=this.fa.SeriesNeglectDefense[3],this.SeriesNeglectDefense4=this.fa.SeriesNeglectDefense[4],this.fa.RageRecoverySpeed=PlayerAttribute.RageRecoverySpeed/Game.RageRatio},t.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},t.prototype.close=function(){UIManager.pop(this)},t}(e.FitComponent);e.AttributeInstrUI=t,__reflect(t.prototype,"UI.AttributeInstrUI",["eui.UIComponent","egret.DisplayObject"])
}(UI||(UI={}));var friend;!function(e){function t(){badge.onLight(badge.action.FriendApply,!0),Game.dispatcher.dispatchEventWith(Game.EVENT.FriendApply),UI.battle&&UI.battle.leftGroup&&(e.RequestIcon||(e.RequestIcon=new UI.IconButton,e.RequestIcon.img="ui/common1/question.png",e.RequestIcon.width=70,e.RequestIcon.height=70,e.RequestIcon.onTap=function(t){UIManager.pushPage(UI.FriendsApply.instance),badge.onLight(badge.action.FriendApply,!1),e.RequestIcon.freeMovie(),Game.removeFromParent.apply(e.RequestIcon)}),e.RequestIcon.parent!=UI.battle.leftGroup&&(UI.battle.addToLeftGroup(e.RequestIcon,0),e.RequestIcon.playMovie(-1)))}function n(t){for(var n in e.friendData)if(e.friendData[n].name==t)return;var i=new net.def.C2SFriendRequest;i.name=t,net.socket.write(207,i.toArrayBuffer())}function i(t){for(var n in e.friendData)if(e.friendData[n].uuid.toHex()==t.toHex()){var i=new net.def.UUID;return i.uuid=t,void net.socket.write(210,i.toArrayBuffer())}}function a(){(null==h||h<egret.getTimer())&&(net.socket.write(27,null),h=egret.getTimer()+60*Game.Second)}function r(t){for(var n=0;n<e.friendApplyData.length;n++)if(e.friendApplyData[n].uuid.toHex()==t.toHex()){e.friendApplyData.splice(n,1);var i=new net.def.UUID;return i.uuid=t,void net.socket.write(211,i.toArrayBuffer())}}function o(t){for(var n in e.friendData)if(e.friendData[n].uuid.toHex()==t.toHex())return!0;return!1}function s(t){for(var n in e.friendData)if(e.friendData[n].name==t)return!0;return!1}function l(t){for(var n=0;n<e.friendApplyData.length;n++)if(e.friendApplyData[n].uuid.toHex()==t.toHex()){e.friendApplyData.splice(n,1);var i=new net.def.UUID;return i.uuid=t,void net.socket.write(208,i.toArrayBuffer())}}function u(e){var t=new net.def.C2SSearchRole;t.name=e,net.socket.write(209,t.toArrayBuffer())}function c(e,t){return e.offlineTime!=t.offlineTime?e.offlineTime-t.offlineTime:e.fp!=t.fp?t.fp-e.fp:e.level!=e.level?t.level-e.level:e.name.localeCompare(t.name)}e.friendData=[],e.friendApplyData=[];var h;e.onPushRequest=t,e.sendRequest=n,e.removeFriend=i,e.refreshFriends=a,e.removeRequest=r,e.check=o,e.checkByName=s,e.accept=l,e.search=u,e.SortCompare=c;var d=function(){function e(e){this.name="",this.level=0,this.fp=0,this.faction=0,this.guildName="",this.txtCustom="",this.nType=Game.FriendPageType.Friend,this.name=e.name,this.level=e.level,this.fp=e.fp,this.faction=e.faction,this.uuid=e.uuid,this.offlineTime=e.offlineTime,this.guildName=e.guildName,this.txtCustom=lang.String("last online")}return Object.defineProperty(e.prototype,"icon",{get:function(){return 0==this.faction?"":this.offlineTime>0?table.faction[this.faction].offlinePortrait:table.faction[this.faction].portrait},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"txtFaction",{get:function(){return 0==this.faction?"":table.faction[this.faction].name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"txtOffline",{get:function(){return this.offlineTime>0?FormatDDHH(60*this.offlineTime):"Online"},enumerable:!0,configurable:!0}),e}();e.RoleBriefUI=d,__reflect(d.prototype,"friend.RoleBriefUI");var p=function(){function e(e){this.name="",this.level=0,this.fp=0,this.faction=0,this.guildName="",this.txtCustom="",this.nType=Game.FriendPageType.Friend,this.name=e.name,this.level=e.level,this.fp=e.fp,this.faction=e.faction,this.uuid=e.uuid,this.offlineTime=e.offlineTime,this.guildName=e.guildName,this.txtCustom=lang.String("last online")}return Object.defineProperty(e.prototype,"icon",{get:function(){return 0==this.faction?"":this.offlineTime>0?table.faction[this.faction].offlinePortrait:table.faction[this.faction].portrait},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"txtFaction",{get:function(){return 0==this.faction?"":table.faction[this.faction].name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"txtOffline",{get:function(){return this.offlineTime>0?FormatDDHH(60*this.offlineTime):"Online"},enumerable:!0,configurable:!0}),e}();e.RoleBrief=p,__reflect(p.prototype,"friend.RoleBrief")}(friend||(friend={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="AwardResultSkin",t.awards=new eui.ArrayCollection,t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(){},t.prototype.onRemoveFromStage=function(){null!=this.callback&&this.callback()},t.prototype.setAwards=function(e){this.awards.replaceAll(e)},t.prototype.setCallBack=function(e){this.callback=e},t.prototype.onTouchTap=function(e){UIManager.pop(this)},t}(e.FitComponent);e.AwardResult=t,__reflect(t.prototype,"UI.AwardResult",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="AwardsRuleItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){null!=this.data&&(this.list.dataProvider=new eui.ArrayCollection(this.data.awards))},t}(eui.ItemRenderer);e.AwardsRuleItem=t,__reflect(t.prototype,"UI.AwardsRuleItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(t,n){var i=e.call(this)||this;return i.skinName="AwardsRulePanelSkin",i.headLine=t,i.awardsRule=n,i.addEventListener(egret.TouchEvent.TOUCH_TAP,i.onTouchTap,i),i.list.dataProvider=new eui.ArrayCollection(i.awardsRule),i}return __extends(t,e),t.prototype.close=function(){UIManager.pop(this)},t.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},t}(e.FitComponent);e.AwardsRulePanel=t,__reflect(t.prototype,"UI.AwardsRulePanel",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var lang;!function(e){function t(){o=RES.getRes("config/lang.json")}function n(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i=o[e];return null==i?(egret.error("lang: %s not found, params: %s",e,t.join(",")),e.replace(/{(\d+)}/g,function(e,n){return t[n-1]})):i.replace(/{(\d+)}/g,function(e,n){return t[n-1]})}function i(e){return o[e]}function a(e){var t=[],a=e.replace(/\$(\d+){(.+?)}/g,function(e,n,i){return t[n-1]=i,"{"+n+"}"});return null==o[a]?e:t.length>0?n.apply(void 0,[a].concat(t)):i(a)}function r(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return e.replace(/{(\d+)}/g,function(e,n){return t[n-1]})}var o;e.load=t,e.StringWithFormat=n,e.String=i,e.Parse=a,e.Format=r}(lang||(lang={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="BagDetailSkin",n.onDataChanged=MakeDelayExecute(n.dataChanged,n,300),n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.equipList.itemRenderer=e.BagCell,n.propList.itemRenderer=e.BagCell,n.materialList.itemRenderer=e.BagCell,n.propList.addEventListener(eui.ItemTapEvent.ITEM_TAP,n.onClickItem,n),n.equipList.addEventListener(eui.ItemTapEvent.ITEM_TAP,n.onClickItem,n),n.materialList.addEventListener(eui.ItemTapEvent.ITEM_TAP,n.onClickItem,n),n.tab.addEventListener(eui.ItemTapEvent.ITEM_TAP,n.onTabTap,n),n.selectBule.addEventListener(eui.UIEvent.CHANGE,n.onSelectBox,n),n.selectPurple.addEventListener(eui.UIEvent.CHANGE,n.onSelectBox,n),n.selectOrange.addEventListener(eui.UIEvent.CHANGE,n.onSelectBox,n),n.autoSellEquip.addEventListener(eui.UIEvent.CHANGE,n.OnSelectAuto,n),n}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.Close=function(){null!=this._instance&&UIManager.pop(this._instance)},n.prototype.onSelectBox=function(e){switch(e.target.name){case"SmeltBlue":Setting.ChangeSmelt(2,e.target.selected);break;case"SmeltPurple":Setting.ChangeSmelt(3,e.target.selected);break;case"SmeltOrange":Setting.ChangeSmelt(4,e.target.selected)}},n.prototype.OnSelectAuto=function(){Setting.ChangeAutoSellEquip(this.autoSellEquip.selected)},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnSmelt:this.onClickForge()}e.stopPropagation()},n.prototype.onTabTap=function(e){this.setPage(e.itemIndex)},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.AddItem,this.onDataChanged,this),Game.dispatcher.addEventListener(Game.EVENT.RemoveItem,this.onDataChanged,this),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,this.onDataChanged,this),Game.dispatcher.addEventListener(Game.EVENT.BagItemChange,this.onDataChanged,this),guide.addEventListener(guide.GuideOperation.GuideSell,this.onGuideReminder,this),this.refresh(),null==this.page?this.equipList.dataProvider.length>0?this.setPage(0):this.propList.dataProvider.length>0?this.setPage(1):this.materialList.dataProvider.length>0?this.setPage(2):this.setPage(0):this.setPage(this.page),this.selectBule.selected=Setting.Smelt(2),this.selectPurple.selected=Setting.Smelt(3),this.selectOrange.selected=Setting.Smelt(4),this.autoSellEquip.selected=Setting.AutoSellEquip(),this.autoSellEquip.visible=PlayerAttribute.Level>=20,guide.completed()||this.playGuideMovie(guide.info.operation)},n.prototype.onGuideReminder=function(){var e=this;0==this.page&&guide.pushMovie({weight:1,handle:function(){e.playGuideMovie(guide.info.operation)}})},n.prototype.playGuideMovie=function(e){switch(e){case guide.GuideOperation.GuideSell:guide.AddMovieClip(this.btnSmelt);break;default:return}},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.AddItem,this.onDataChanged,this),Game.dispatcher.removeEventListener(Game.EVENT.RemoveItem,this.onDataChanged,this),Game.dispatcher.removeEventListener(Game.EVENT.UpdateItem,this.onDataChanged,this),Game.dispatcher.removeEventListener(Game.EVENT.BagItemChange,this.onDataChanged,this),guide.removeEventListener(guide.GuideOperation.GuideSell,this.onGuideReminder,this),this.onDataChanged.stop()},n.prototype.dataChanged=function(){switch(this.refresh(),this.page){case 0:this.bagCapacity=this.equipCapacity;break;case 1:this.bagCapacity=this.propsCapacity;break;case 2:this.bagCapacity=this.materialCapacity}},n.prototype.refresh=function(){var e=PlayerAttribute.bag.GetSortedEquips();this.equipList.dataProvider=new eui.ArrayCollection(e),this.propList.dataProvider=new eui.ArrayCollection(PlayerAttribute.bag.GetPropItem()),this.materialList.dataProvider=new eui.ArrayCollection(PlayerAttribute.bag.GetMaterialItem()),this.equipCapacity=PlayerAttribute.bag.equipsSize,this.propsCapacity=PlayerAttribute.bag.propsSize,this.materialCapacity=PlayerAttribute.bag.otherSize},n.prototype.onClickItem=function(e){var t=e.itemRenderer,n=t.data;this.setSelectInfo(n,!1)},n.prototype.setSelectInfo=function(t,n){return null!=t?t.Item instanceof Item.JueXue?void e.UseItemJueXue.instance.onOpenUI(t):void(n||e.UseItemStack.instance.onOpenUI(t)):void 0},n.prototype.close=function(){UIManager.closeBag()},n.prototype.onClickForge=function(){var e=[];1==this.selectBule.selected&&e.push(2),1==this.selectOrange.selected&&e.push(4),1==this.selectPurple.selected&&e.push(3);var t=new net.def.C2SSmelting;t.setList(e),net.socket.write(25,t.toArrayBuffer())},n.prototype.setPage=function(e){switch(this.page!=e&&(this.page=e),this.page){case 0:this.equipList.dataProvider.length>0&&-1==this.equipList.selectedIndex&&(this.equipList.selectedIndex=0),this.bagCapacity=this.equipCapacity,this.maxCapacity=Bag.MaxSize,this.capacityGroup.visible=!0;break;case 1:this.propList.dataProvider.length>0&&-1==this.propList.selectedIndex&&(this.propList.selectedIndex=0),this.bagCapacity=this.propsCapacity,this.maxCapacity=Bag.propMaxSize,this.capacityGroup.visible=!0;break;case 2:this.materialList.dataProvider.length>0&&-1==this.materialList.selectedIndex&&(this.materialList.selectedIndex=0),this.bagCapacity=this.materialCapacity,this.maxCapacity=Bag.otherMaxSize,this.capacityGroup.visible=!1}},n}(e.FitComponent);e.BagView=t,__reflect(t.prototype,"UI.BagView",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var Leaderboard;!function(e){e.CACHE_TIME=6e4}(Leaderboard||(Leaderboard={}));var Line=function(){function e(){}return e.getTemp=function(e,t,n,i){return this.temp.init(e,t,n,i),this.temp},e.prototype.init=function(e,t,n,i){this.x=e,this.y=t,this.dx=n,this.dy=i},e.prototype.sort=function(e,t){return e-t},e.prototype.cutX=function(e){var t=[this.x,this.x+this.dx].sort(this.sort);if(e<t[0]||e>t[1])return{y:0,ok:!1};var n=this.y-int((this.x-e)*this.dy/this.dx);return{y:n,ok:!0}},e.prototype.cutY=function(e){var t=[this.y,this.y+this.dy].sort(this.sort);if(e<t[0]||e>t[1])return{x:0,ok:!1};var n=this.x-int((this.y-e)*this.dx/this.dy);return{x:n,ok:!0}},e.temp=new e,e}();__reflect(Line.prototype,"Line");var LiteMode;!function(e){function t(){return s}function n(){s||(u=egret.getTimer(),egret.startTick(o,null),s=!0)}function i(){this.force=!0,egret.localStorage.setItem("litemode","on")}function a(){this.force=!1,egret.localStorage.setItem("litemode","off")}function r(){return!e.force&&egret.getTimer()>=l&&e.fps>e.minFPS?!1:!0}function o(t){return h+=t-u,u=t,c++,h>=1e3&&(e.fps=Math.ceil(1e3*c/h),c=0,h%=1e3,e.fps<=e.minFPS&&(l=egret.getTimer()+1e3)),!1}var s=!1;e.force=!1,e.running=t;var l=0;e.minFPS=15,e.auto=n,e.on=i,e.off=a,e.limit=r;var u=0,c=0,h=0;e.fps=30}(LiteMode||(LiteMode={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.txtTenfoldBuff="00:00",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.topposition=[1,2,3,4,5],e}return __extends(n,t),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),Game.removeFromParent.apply(this.btnDExpGroup),Game.removeFromParent.apply(this.btnOfflineGroup),Game.removeFromParent.apply(this.btnFirstRecharge),Game.removeFromParent.apply(this.btnLevelUpGift),Game.removeFromParent.apply(this.btnCompositeGames),Game.removeFromParent.apply(this.wildGroup),Game.removeFromParent.apply(this.btnLotteryTicket),this.btnGuildWar.playMovie(-1),egret.Capabilities.isMobile||(this.adult18.top=0),guide.updateUI(),yesouTaskManager.updateUI()},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.OfflineTimeShow,this.onShowOfflineBtn,this),Game.dispatcher.addEventListener(Game.EVENT.SyncEncounter,this.onShowOfflineBtn,this),Game.dispatcher.addEventListener(Game.EVENT.LittleBossInfo,this.onLittleBossInfo,this),Game.dispatcher.addEventListener(Game.EVENT.WildBossInfo,this.onWildBossInfo,this),Game.dispatcher.addEventListener(Game.EVENT.GuildWarTaskStart,this.onGuildWarSceneInfo,this),Game.dispatcher.addEventListener(Game.EVENT.LevelUp,this.onLevelUpEvent,this),Game.dispatcher.addEventListener(Game.EVENT.TenfoldExp,this.refreshTenfoldGain,this),Game.dispatcher.addEventListener(Game.EVENT.SyncCrossServerBossStatus,this.onCheckCSBossReminder,this),Game.dispatcher.addEventListener(Game.EVENT.FirstChargeGift,this.onLightFirstRecharge,this),Game.dispatcher.addEventListener(Game.EVENT.LevelUpGiftOpen,this.onShowLevelUpGift,this),Game.dispatcher.addEventListener(Game.EVENT.CompositeGamesSevenDayGift,this.onShowComposite,this),Game.dispatcher.addEventListener(Game.EVENT.ActivityLotteryTicket,this.onLotteryTicket,this),SecondTicker.addEventListener(this.onEnterFrame,this)},n.prototype.onRemoveFromStage=function(){SecondTicker.removeEventListener(this.onEnterFrame,this),Game.dispatcher.removeEventListener(Game.EVENT.OfflineTimeShow,this.onShowOfflineBtn,this),Game.dispatcher.removeEventListener(Game.EVENT.SyncEncounter,this.onShowOfflineBtn,this),Game.dispatcher.removeEventListener(Game.EVENT.LittleBossInfo,this.onLittleBossInfo,this),Game.dispatcher.removeEventListener(Game.EVENT.WildBossInfo,this.onWildBossInfo,this),Game.dispatcher.removeEventListener(Game.EVENT.SyncCrossServerBossStatus,this.onCheckCSBossReminder,this),Game.dispatcher.removeEventListener(Game.EVENT.GuildWarTaskStart,this.onGuildWarSceneInfo,this),Game.dispatcher.removeEventListener(Game.EVENT.FirstChargeGift,this.onLightFirstRecharge,this),Game.dispatcher.removeEventListener(Game.EVENT.LevelUpGiftOpen,this.onShowLevelUpGift,this),Game.dispatcher.removeEventListener(Game.EVENT.CompositeGamesSevenDayGift,this.onShowComposite,this),Game.dispatcher.removeEventListener(Game.EVENT.ActivityLotteryTicket,this.onLotteryTicket,this),this.onReminderOut(),Game.dispatcher.removeEventListener(Game.EVENT.LevelUp,this.onLevelUpEvent,this),Game.dispatcher.removeEventListener(Game.EVENT.TenfoldExp,this.refreshTenfoldGain,this)},n.prototype.onWildBossInfo=function(){WildBoss.HideIcon();var e=WildBoss.getMinBossIndexByRoleLevel(),t=WildBoss.getMissions();if(t.show)for(var n=e;e+1>=n;n++){var i=t.items[n].mapId;if(WildBoss.canEnter(i)){WildBoss.ShowIcon(n,this.activityBtnGroup);break}}},n.prototype.onGuildWarSceneInfo=function(){this.removeBtnGuildWarScene(),World.wild&&PlayerAttribute.Level>=30&&GuildWarTaskScene.JointimeRemaining>0&&e.battle.addBtnGuildWarScene()},n.prototype.addBtnGuildWarScene=function(){this.btnGuildWarScene||(this.btnGuildWarScene=new e.BaseReminderIcon,this.btnGuildWarScene.reminderIcon="ui/map/bpls.png",this.btnGuildWarScene.reminderName="Đệ Nhất Bang",this.btnGuildWarScene.reminderAction="Tham gia phó bản",this.btnGuildWarScene.onTap=function(){var e=new net.def.C2SJoinGuildWarTaskScene;e.taskId=GuildWarTaskScene.CurrentSceneID,net.socket.write(2021,e.toArrayBuffer())}),this.activityBtnGroup.addChild(this.btnGuildWarScene),egret.setTimeout(this.onGuildWarTaskSceneTimeout,this,GuildWarTaskScene.JointimeRemaining*Game.Second)},n.prototype.onGuildWarTaskSceneTimeout=function(){this.removeBtnGuildWarScene()},n.prototype.removeBtnGuildWarScene=function(){null!=this.btnGuildWarScene&&(Game.removeFromParent.apply(this.btnGuildWarScene),this.btnGuildWarScene.clearResourceReference(),this.btnGuildWarScene=null)},n.prototype.onLittleBossInfo=function(){var t=LittleBoss.getNextMapId();null!=t&&PlayerAttribute.Level>=LittleBoss.getNextLevel()?e.LittleBossIcon.show(t,this.activityBtnGroup):e.LittleBossIcon.hide()},n.prototype.onFeatureReminder=function(t,n,i){if(null!=this.reminderTimeId){if(this.reminder&&this.reminder.reminderEventType!=t&&""==i)return!1;egret.clearTimeout(this.reminderTimeId),this.reminderTimeId=null}return this.reminderTimeId=egret.setTimeout(this.onReminderOut,this,n),this.reminder||(this.reminder=new e.ReminderIcon),this.reminder.update(t,i),this.activityBtnGroup.addChild(this.reminder),!0},n.prototype.PopReminder=function(e){this.onReminderOut()},n.prototype.onReminderOut=function(){null!=this.reminderTimeId&&(egret.clearTimeout(this.reminderTimeId),this.reminderTimeId=null,this.reminder&&(this.reminder.update(null,null),Game.removeFromParent.apply(this.reminder),this.reminder.clearResourceReference(),this.reminder=null))},n.prototype.onCheckCSBossReminder=function(){this.reminder&&this.reminder.reminderEventType==Reminder.EventName.CrossServerBoss&&0==CrossServer.checkCrossBossAllStatus()&&this.onReminderOut()},n.prototype.onShowOfflineBtn=function(){OfflineTime.show||null!=Encounter.events&&Encounter.events.length?null==this.btnOfflineGroup.parent&&this.rightGroup.addChildAt(this.btnOfflineGroup,0):Game.removeFromParent.apply(this.btnOfflineGroup)},n.prototype.addDExpBtn=function(){this.rightGroup.addChildAt(this.btnDExpGroup,0)},n.prototype.onEnterWild=function(){null==this.wildGroup.parent&&this.addChildAt(this.wildGroup,1)},n.prototype.onLeaveWild=function(){Game.removeFromParent.apply(this.wildGroup)},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnDExp:this.openTenfoldGain();break;case this.btnWelfareHall:this.btnWelfareHall.freeMovie(),e.WelfareHall.open();break;case this.btnMaps:if(!Game.isWildMap())return void PopUpMessage.push(lang.String("can not escape"),color.RED);UIManager.pushPage(e.MapCabinet.instance);break;case this.btnOffline:e.openOfflineHandle();break;case this.btnWanderings:if(!guide.completed())switch(guide.info.operation){case guide.GuideOperation.GuideCatchThief:case guide.GuideOperation.GuideFengLingDu:return void e.openWanderingsUI(2)}e.openWanderingsUI();break;case this.btnFirstRecharge:this.openFirstCharge();break;case this.btnLevelUpGift:UIManager.pushPage(e.LevelUpGiftUI.instance);break;case this.btnCompositeGames:e.CompositeGamesHall.open();break;case this.btnMail:Mail.onC2SAskmailtitle();break;case this.btnGuildWar:this.btnGuildWar.stopMovie(),1==Guild.HasGuild()?UIManager.pushPage(e.GuildWarHome.instance):PopUpMessage.push(lang.String("[qinMausoleum]not in guild"),color.RED);break;case this.topFoldToggle:this.onFoldTopGroup();break;case this.btnAuction:Auction.showUi();break;case this.btnConsignment:Consignment.Open(Consignment.PAGE_BUY);break;case this.btnToprank:if(Game.isCrossServer())return void PopUpMessage.push(lang.String("operation not permitted"),color.RED);e.RankingUI.open(e.RankKind.LevelRank);break;case this.btnActivity:this.btnActivity.freeMovie(),e.RechargeActivityHall.open();break;case this.btnMonthly:this.btnMonthly.freeMovie(),Recharge.openRechargeUI();break;case this.btnPetEnlist:e.PetEnlist.open();break;case this.btnLotteryTicket:this.btnLotteryTicket.freeMovie(),e.LotteryTicketUI.open()}t.stopPropagation()},n.prototype.openFirstCharge=function(){this.btnFirstRecharge.freeMovie(),e.FirstBox.open()},n.prototype.onLightFirstRecharge=function(){4==Recharge.FirstChargeGift?Game.removeFromParent.apply(this.btnFirstRecharge):(this.btnFirstRecharge.parent!=this.leftGroup&&this.leftGroup.addChildAt(this.btnFirstRecharge,0),this.btnFirstRecharge.playMovie(-1),0==Recharge.FirstBoxTodayDrawn&&(Recharge.FirstChargeGift>=1||Recharge.FirstChargeGift>=0)?badge.onLight(badge.action.FirstChargeGift,!0):badge.onLight(badge.action.FirstChargeGift,!1))},n.prototype.onShowLevelUpGift=function(e){null!=e&&(1==e.data?this.btnLevelUpGift.parent!=this.leftGroup&&this.leftGroup.addChildAt(this.btnLevelUpGift,0):Game.removeFromParent.apply(this.btnLevelUpGift))},n.prototype.onShowComposite=function(e){CompositeGamesSevenDayGift.finish()&&null==CompositeGamesGroupon.rankList?Game.removeFromParent.apply(this.btnCompositeGames):this.btnCompositeGames.parent!=this.leftGroup&&this.leftGroup.addChildAt(this.btnCompositeGames,0)},n.prototype.onLotteryTicket=function(e){null!=e&&(1==e.data?this.btnLotteryTicket.parent!=this.leftGroup&&ActivityLotteryTicket.activity.inTime()&&(this.leftGroup.addChildAt(this.btnLotteryTicket,0),this.btnLotteryTicket.playMovie(-1)):this.btnLotteryTicket.parent==this.leftGroup&&Game.removeFromParent.apply(this.btnLotteryTicket))},n.prototype.openTenfoldGain=function(){UIManager.pushPage(new e.TenfoldGain)},n.prototype.playGuideMovie=function(e){switch(e){case guide.GuideOperation.GuideFengLingDu:case guide.GuideOperation.GuideCatchThief:guide.AddMovieClip(this.btnWanderings);break;case guide.GuideOperation.TenfoldGain:guide.AddMovieClip(this.btnDExpGroup);break;case guide.GuideOperation.GuideRecruitPartner:guide.AddMovieClip(this.btnPetEnlist);break;default:return}},n.prototype.onLightLoginButton=function(){this.btnWelfareHall.playMovie(-1),this.btnActivity.playMovie(-1),this.btnMonthly.playMovie(-1)},n.prototype.onLevelUpEvent=function(){var e=PlayerAttribute.Level;e%20==0&&WildBoss.requestServerMissions()},n.prototype.onEnterFrame=function(){this.refreshTenfoldGain()},n.prototype.refreshTenfoldGain=function(){var e=TenfoldAward.getBuffTime();e.delta<=0?null!=this.tenfoldGainGroup.parent&&Game.removeFromParent.apply(this.tenfoldGainGroup):(this.txtTenfoldBuff=e.getHourMinuteSecond(),null==this.tenfoldGainGroup.parent&&this.btnDExpGroup.addChildAt(this.tenfoldGainGroup,1))},n.prototype.onFoldTopGroup=function(){this.topFoldToggle.selected?(Game.removeFromParent.apply(this.topGroup),Game.removeFromParent.apply(this.topGroup0),Game.removeFromParent.apply(this.rightGroup)):(this.topGroup0.parent!=this.wildGroup&&this.wildGroup.addChildAt(this.topGroup0,0),this.topGroup.parent!=this.wildGroup&&this.wildGroup.addChildAt(this.topGroup,1),this.rightGroup.parent!=this.wildGroup&&this.wildGroup.addChildAt(this.rightGroup,2))},n.prototype.addToTopGroup=function(e,t){if(this.topGroup&&e.parent!=this.topGroup){for(var n=this.topposition.length,i=0;n>i;i++)if(this.topposition[i]>=t)return this.topposition.splice(i,0,t),void this.topGroup.addChildAt(e,i);this.topGroup.addChild(e)}},n.prototype.addToLeftGroup=function(e,t){this.leftGroup&&e.parent!=this.leftGroup&&(null!=t?this.leftGroup.addChildAt(e,t):this.leftGroup.addChild(e))},n.prototype.addToRightBottomGroup=function(e,t){this.rightBottomGroup&&e.parent!=this.rightBottomGroup&&(null!=t?this.rightBottomGroup.addChildAt(e,t):this.rightBottomGroup.addChild(e))},n}(eui.Component);e.Battle=t,__reflect(t.prototype,"UI.Battle",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.usedatas=[],e.skinName="BattleSettingSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.uid="SERVER:"+net.server.name+" ID:"+Account.uid,e.radioGroup=e.btnRadio1.group,e.autoCheck1.addEventListener(eui.UIEvent.CHANGE,e.onChange,e),e.autoCheck2.addEventListener(eui.UIEvent.CHANGE,e.onChange,e),e.autoCheck3.addEventListener(eui.UIEvent.CHANGE,e.onChange,e),e.skillPop.setVisible(!1),e.radioGroup.addEventListener(eui.UIEvent.CHANGE,e.radioChangeHandler,e),e.skillPop.addEventListener(egret.TouchEvent.TOUCH_TAP,e.PopTouchTap,e),e.pk.addEventListener(eui.UIEvent.CHANGE,e.onChangePK,e),e.sound.addEventListener(eui.UIEvent.CHANGE,e.onSwitchBGM,e),e.litemode.addEventListener(eui.UIEvent.CHANGE,e.onSwitchLiteMode,e),e.hideName.addEventListener(eui.UIEvent.CHANGE,e.onSwitchName,e),e.hideLife.addEventListener(eui.UIEvent.CHANGE,e.onSwitchLife,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.close=function(){null!=this._instance&&UIManager.pop(this._instance)},n.prototype.onAddToStage=function(){var t=PlayerAttribute.skillSlots;this.slot1=t[0],this.slot2=t[1],this.slot3=t[2],this.usedatas=[],this.onSettingChange(),Player.instance.Camp==Game.Camp.CampPlayer||Player.instance.Camp==Game.Camp.CampNeutral?e.BattleSetting.instance.pk.selected=!0:e.BattleSetting.instance.pk.selected=!1,e.BattleSetting.instance.pk.enabled=World.pkAllowed,Game.dispatcher.addEventListener(Game.EVENT.SettingChange,this.onSettingChange,this)},n.prototype.radioChangeHandler=function(){var e=parseInt(this.radioGroup.selectedValue);isNaN(e)||Setting.ChangeTargetPriority(e)},n.prototype.onRemoveFromStage=function(){this.slot1=null,this.slot2=null,this.slot3=null,this.skillPop.setVisible(!1),this.useskillidx=null,Game.dispatcher.removeEventListener(Game.EVENT.SettingChange,this.onSettingChange,this)},n.prototype.onSettingChange=function(){switch(this.autoCheck1.selected=Setting.AutoSkill(PlayerAttribute.mapSkills[this.slot1.id].Idx),this.autoCheck2.selected=Setting.AutoSkill(PlayerAttribute.mapSkills[this.slot2.id].Idx),this.autoCheck3.selected=Setting.AutoSkill(PlayerAttribute.mapSkills[this.slot3.id].Idx),this.litemode.selected=Setting.litemode,this.sound.selected=!Setting.Sound(),Setting.TargetPriority()){case AI.TargetProiority.none:this.btnRadio1.selected=!0;break;case AI.TargetProiority.monster:this.btnRadio2.selected=!0;break;case AI.TargetProiority.player:this.btnRadio3.selected=!0}},Object.defineProperty(n.prototype,"targetPriority",{get:function(){if(null==this.radioGroup)return Setting.TargetPriority();var e=parseInt(this.radioGroup.selectedValue);return isNaN(e)?Setting.TargetPriority():e},enumerable:!0,configurable:!0}),n.prototype.onChange=function(e){PlayerAttribute.skillSlots;switch(e.target){case this.autoCheck1:Setting.ChangeAutoSkill(PlayerAttribute.mapSkills[this.slot1.id].Idx,this.autoCheck1.selected);break;case this.autoCheck2:Setting.ChangeAutoSkill(PlayerAttribute.mapSkills[this.slot2.id].Idx,this.autoCheck2.selected);break;case this.autoCheck3:Setting.ChangeAutoSkill(PlayerAttribute.mapSkills[this.slot3.id].Idx,this.autoCheck3.selected)}},n.prototype.close=function(){UIManager.closeBattleSetting()},n.prototype.PopTouchTap=function(e){if(null==e.target.data)return void this.skillPop.setVisible(!1);var t=e.target.data.skillid;if(null!=t){var n=Skill.mapSkill[t];if(PlayerAttribute.Level<n.needLevel)return void PopUpMessage.push(lang.StringWithFormat("unlock:level{1}",n.needLevel),color.GREEN);if(t==PlayerAttribute.skills[0].Id)return void PopUpMessage.push(lang.String("SkillUI_BaseSkill_Not_Used"),color.GREEN);PlayerAttribute.SetSkillSlot(this.useskillidx,t);var i=PlayerAttribute.skillSlots;Skill.mapSkill[i[0].id].icon!=this.slot1.icon&&(this.slot1=i[0]),Skill.mapSkill[i[1].id].icon!=this.slot2.icon&&(this.slot2=i[1]),Skill.mapSkill[i[2].id].icon!=this.slot3.icon&&(this.slot3=i[2]),this.skillPop.setVisible(!1),Game.dispatcher.dispatchEventWith(Game.EVENT.SkillSlotChange),PlayerAttribute.ApplyChangeSkillSelected()}},n.prototype.onTouchTap=function(e){if(1==this.skillPop.visible)return void this.skillPop.setVisible(!1);switch(e.target){case this.slotIcon1:this.useskillidx=0,this.skillPop.setState(this.useskillidx),this.skillPop.setVisible(!0);break;case this.slotIcon2:this.useskillidx=1,this.skillPop.setState(this.useskillidx),this.skillPop.setVisible(!0);break;case this.slotIcon3:this.useskillidx=2,this.skillPop.setState(this.useskillidx),this.skillPop.setVisible(!0);break;case this.slotIcon1:case this.slotIcon2:case this.slotIcon3:this.onTouchTap(e);break;case this.btnChangeAccount:try{XGSDK.logout()}catch(e){}}},n.prototype.onChangePK=function(){if(World.pkAllowed){var e=new net.def.C2SChangePK;this.pk.selected?e.kind=0:e.kind=1,net.socket.write(30,e.toArrayBuffer())}},n.prototype.onSwitchBGM=function(){Setting.ChangeSound(!this.sound.selected),this.sound.selected?SoundUtil.pauseBGM():SoundUtil.resumeBGM()},n.prototype.onSwitchLiteMode=function(){Setting.ChangeLiteMode(this.litemode.selected),this.litemode.selected?(LiteMode.on(),PartnerNpcManager.clear()):(LiteMode.off(),PartnerNpcManager.delayFighting()),e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],lang.String("prompt title"),lang.String("need reload"),function(){return window.location.reload(),!0},null,null)},n.prototype.onSwitchName=function(){e.setDisableAllPlayerName(this.hideName.selected)},n.prototype.onSwitchLife=function(){e.setDisableAllPlayerLifeBar(this.hideLife.selected)},n}(e.FitComponent);e.BattleSetting=t,__reflect(t.prototype,"UI.BattleSetting",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.bookData=[],n.skinName="BookComposeSkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.list.itemRenderer=e.BookComposeItem,n}return __extends(n,t),n.get=function(){return null!=this.timer&&(egret.clearTimeout(this.timer),this.timer=null),null==this._instance&&(this._instance=new n),this._instance},n.open=function(e){var t=this.get();t.setCategory(e),UIManager.pushPage(this._instance)},n.close=function(){var e=this;null!=this._instance&&(Game.removeFromParent.apply(this._instance),null!=this.timer&&egret.clearTimeout(this.timer),this.timer=egret.setTimeout(function(){e._instance=null},this,1e4))},n.prototype.onAddToStage=function(){this.bookGoods=GoldCoinShop.bookGoods[this.category],guide.addEventListener(guide.GuideOperation.CraftBook,this.onGuideReminder,this),this.list.dataProvider=new eui.ArrayCollection(this.bookData)
},n.prototype.onRemoveFromStage=function(){guide.removeEventListener(guide.GuideOperation.CraftBook,this.onGuideReminder,this)},n.prototype.setCategory=function(e){this.category=e,this.bookData=[];for(var t in table.books){var n=table.books[t],i=1e3-n.id;null!=PlayerAttribute.books[e]&&PlayerAttribute.books[e].Id==n.id&&(i+=1e3),n.category==e&&this.bookData.push({Id:n.id,color:Item.QualityColor[n.quality],sortPower:i})}this.bookData=this.bookData.sort(function(e,t){return e.sortPower<t.sortPower?1:t.sortPower<e.sortPower?-1:0})},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:n.close();break;case this.btnBuy:this.onBuyOneBook()}},n.prototype.onBuyOneBook=function(){GoldCoinShop.buy(this.bookGoods.pos,this.bookGoods.param)},n.prototype.onGuideReminder=function(){var e=this;this.visible&&guide.pushMovie({weight:2,handle:function(){var t=e.list.dataProvider;t.refresh()}})},n}(e.FitComponent);e.BookCompose=t,__reflect(t.prototype,"UI.BookCompose",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="BookComposeItemSkin",n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.mc=new e.MovieClipComponent,n.mc.verticalCenter=0,n.mc.horizontalCenter=0,n.mc.height=90,n.btnCompose.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onCompose,n),n.btnSplit.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onSplit,n),n}return __extends(n,t),n.prototype.dataChanged=function(){if(null!=this.data){2!=this.data.Id||guide.completed()||guide.info.operation!=guide.GuideOperation.CraftBook?guide.removeMovieClip(this.btnCompose):guide.AddMovieClip(this.btnCompose),this.book=table.books[this.data.Id],this.needCount=table.bookCost.crafting[this.book.quality],this.bookName=this.book.name,this.cell.icon=this.book.icon,this.cell.quality=this.book.quality;var e=PlayerAttribute.bag.getBook(this.data.Id);null==e&&(e=Item.Book.bookMounted(this.data.Id)),null!=e?(this.labelFpDesc.textFlow=Game.HtmlTextParser.parse(Item.Book.GetFpDesc(e.Id)),this.labelBaseDesc.textFlow=Game.HtmlTextParser.parse(Item.Book.GetBookTalentSkillDesc(e.Id,e.grade))):(this.labelFpDesc.textFlow=Game.HtmlTextParser.parse(Item.Book.GetFpDesc(this.data.Id)),this.labelBaseDesc.textFlow=Game.HtmlTextParser.parse(Item.Book.GetBookTalentSkillDesc(this.data.Id,1))),this.onRefresh()}},n.prototype.onRefresh=function(){this.curCount=PlayerAttribute.bag.CalcCount(7,this.data.Id);var e=PlayerAttribute.bag.hasBook(this.data.Id);null!=PlayerAttribute.books[this.book.category]&&this.data.Id==PlayerAttribute.books[this.book.category].Id?(this.currentState="using",this.txtCount.textColor=16250837):e?(this.currentState="idle",this.txtCount.textColor=16250837,this.btnCompose.enabled=!0):(this.currentState="piece",this.needCount>this.curCount?(this.btnCompose.enabled=!1,this.txtCount.textColor=16711722):(this.btnCompose.enabled=!0,this.txtCount.textColor=647448)),this.curCount>0||e?this.btnSplit.visible=!0:this.btnSplit.visible=!1},n.prototype.onCompose=function(){if(PlayerAttribute.bag.hasBook(this.data.Id))badge.onLight(badge.BookChange[this.book.category],!1),PlayerAttribute.useItemByGD(6,Number(this.data.Id),1);else{var e=PlayerAttribute.books[this.book.category];if(null!=e&&e.Id==this.data.Id||PlayerAttribute.bag.hasBook(this.data.Id))return void PopUpMessage.push(lang.String("can not craft book"),color.RED);this.mc.Load("skill/Ui_tianfu/Ui_tianfu.json","Ui_tianfu"),this.mc.gotoAndPlay(0,1),this.addChild(this.mc);var t=new net.def.C2SCraftBook;t.setId(Number(this.data.Id)),net.socket.write(113,t.toArrayBuffer())}},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.BooksChange,this.onRefresh,this),Game.dispatcher.addEventListener(Game.EVENT.AddItem,this.onRefresh,this),Game.dispatcher.addEventListener(Game.EVENT.RemoveItem,this.onRefresh,this),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,this.onRefresh,this),null!=this.data&&this.onRefresh()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.BooksChange,this.onRefresh,this),Game.dispatcher.removeEventListener(Game.EVENT.AddItem,this.onRefresh,this),Game.dispatcher.removeEventListener(Game.EVENT.RemoveItem,this.onRefresh,this),Game.dispatcher.removeEventListener(Game.EVENT.UpdateItem,this.onRefresh,this),null!=this.mc.parent&&this.removeChild(this.mc),this.mc.free()},n.prototype.onSplit=function(){null!=this.book&&(PlayerAttribute.bag.hasBook(this.data.Id)?this.onSplitBook(!1):this.curCount>0&&this.onRemoveBookDebris(!1))},n.prototype.onSplitBook=function(t){var n=this;if(t){var i=PlayerAttribute.bag.findBagItem(6,this.book.id);if(null==i)return;var a=new net.def.BagItemId;a.id=i.Id,net.socket.write(114,a.toArrayBuffer())}else{var r=lang.String("operation confirm"),o=lang.String("are you sure to split book?");e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],r,o,function(){return n.onSplitBook(!0),!0},null,null)}},n.prototype.onRemoveBookDebris=function(t){var n=this;if(t){var i=PlayerAttribute.bag.findBagItem(7,this.book.id),a=new net.def.C2SRemoveItem;a.id=i.Id,a.count=i.Item.Count,net.socket.write(246,a.toArrayBuffer())}else{var r=lang.String("operation confirm"),o=lang.String("are you sure to remove bookdebris?");e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],r,o,function(){return n.onRemoveBookDebris(!0),!0},null,null)}},n}(eui.ItemRenderer);e.BookComposeItem=t,__reflect(t.prototype,"UI.BookComposeItem")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var i=t.call(this)||this;i.skinName="UniqueSkillSkin",i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i.addEventListener(egret.Event.REMOVED_FROM_STAGE,i.onRemoveFromStage,i),i.addEventListener(egret.TouchEvent.TOUCH_TAP,i.onTouchTap,i),i.array=[],i.selectAttrib=[];for(var a=0;a<Game.BookCategory;a++)i.array.push({category:a,icon:n.icon[a],quality:null,reddot:""+badge.BookChange[a]});return i.mc=new e.MovieClipComponent,i.mc.removeWhenComplete=!1,i.mc.position="TL",i.mc.x=37,i.mc.y=37,i.mc.visible=!1,i.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,i.onTapList,i),i.showCase.addChild(i.mc),i}return __extends(n,t),n.prototype.autoselect=function(){for(var e=[],t=0;t<Game.BookCategory;t++){var n=PlayerAttribute.books[t];null!=n&&e.push({priority:n.calcPriority(),category:t})}e.sort(function(e,t){return t.priority-e.priority}),e.length<=0?this.selectCategory=0:this.selectCategory=e[0].category},n.prototype.onAddToStage=function(){var e=this.list.dataProvider;null==e?this.list.dataProvider=new eui.ArrayCollection(this.array):e.replaceAll(this.array),this.autoselect(),guide.completed()||this.playGuideMovie(guide.info.operation),this.list.selectedIndex=this.selectCategory,Game.dispatcher.addEventListener(Game.EVENT.BooksChange,this.onBookChange,this),Game.dispatcher.addEventListener(Game.EVENT.LevelUpBook,this.onLevelUpBook,this),Game.dispatcher.addEventListener(Game.EVENT.UpgradeBook,this.onUpgradeBook,this),Game.dispatcher.addEventListener(Game.EVENT.CurrencyChange[Game.Currency.Reading],this.onReadingChange,this),Game.dispatcher.addEventListener(Game.EVENT.CurrencyChange[Game.Currency.CopperCoin],this.onCopperCoinChange,this),Game.dispatcher.addEventListener(Game.EVENT.AddItem,this.onItemChange,this),Game.dispatcher.addEventListener(Game.EVENT.RemoveItem,this.onItemChange,this),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,this.onItemChange,this),this.onBookChange(),guide.addEventListener(guide.GuideOperation.CraftBook,this.onGuideReminder,this),guide.addEventListener(guide.GuideOperation.GuideLevelUpBook,this.onGuideReminder,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.BooksChange,this.onBookChange,this),Game.dispatcher.removeEventListener(Game.EVENT.LevelUpBook,this.onLevelUpBook,this),Game.dispatcher.removeEventListener(Game.EVENT.UpgradeBook,this.onUpgradeBook,this),Game.dispatcher.removeEventListener(Game.EVENT.CurrencyChange[Game.Currency.Reading],this.onReadingChange,this),Game.dispatcher.removeEventListener(Game.EVENT.CurrencyChange[Game.Currency.CopperCoin],this.onCopperCoinChange,this),Game.dispatcher.removeEventListener(Game.EVENT.AddItem,this.onItemChange,this),Game.dispatcher.removeEventListener(Game.EVENT.RemoveItem,this.onItemChange,this),Game.dispatcher.removeEventListener(Game.EVENT.UpdateItem,this.onItemChange,this),this.stopAutoLevelUp(),guide.removeEventListener(guide.GuideOperation.CraftBook,this.onGuideReminder,this),guide.removeEventListener(guide.GuideOperation.GuideLevelUpBook,this.onGuideReminder,this)},n.prototype.onTouchTap=function(e){switch(e.target){case this.btn:this.onTap();break;case this.btnChange:this.onChange();break;case this.btnDesc:this.onRules();break;case this.btnGainRes:this.onGainRes();break;case this.btnGainBookSKill:this.onGainBookSKill()}},n.prototype.stopAutoLevelUp=function(){this.leveluping=!1,null!=this.timer&&(egret.clearTimeout(this.timer),this.timer=null),this.mc.visible=!1,this.mc.free()},n.prototype.onItemChange=function(e){var t=e.data;7==t.Item.Type&&this.onDebrisChange()},n.prototype.onTapList=function(){if(null!=this.list&&null!=this.list.selectedIndex&&-1!=this.list.selectedIndex){this.selectCategory=this.list.selectedIndex;var e=this.onSelected(this.selectCategory);if(null==e)return void this.onChange();this.onCopperCoinChange(),this.onReadingChange(),this.onDebrisChange()}},n.prototype.onSelected=function(e){this.reddotChange.action=badge.BookChange[e].toString(),this.reddotLevelUp.action=badge.BookLevelUp[e].toString();var t=PlayerAttribute.books[e];if(null==t)return this.bookName=null,this.level=null,this.desc=null,this.maxExp=null,this.exp=null,this.info2.visible=!1,this.info3.visible=!1,this.btn.enabled=!1,this.showCase.clearBagcell(),null;this.info2.visible=!0,this.info3.visible=!0,this.btn.enabled=!0,this.showCase.setItem(6,t.Icon,0,t.Quality),t.exp>=t.maxExp?t.grade<Game.MaxBookLevel?this.currentState="Upgrade":this.currentState="Max":this.currentState="LevelUp",this.bookName=t.name,this.desc=t.Desc,this.maxExp=t.maxExp*t.grade,this.exp=t.exp,this.level=(t.grade-1)*t.maxExp+this.exp,this.updateRequireMaterial(t.grade-1,t.Quality);for(var n=0;n<t.attributes.length;n++){var i=t.attributes[n],a=table.books[t.Id].attributes[n];this.selectAttrib[n]={name:Buff.GetName(i.id),value:"+"+i.level*a.value,maximum:a.count,labelFunction:function(){return""},level:i.level}}var r=this.dataGroup.dataProvider;return null==r?this.dataGroup.dataProvider=new eui.ArrayCollection(this.selectAttrib):r.refresh(),this.UpdateDesc(),t},n.prototype.playEffect=function(){this.mc.visible=!0,this.mc.Load("skill/Ui_book/Ui_book.json","Ui_book"),this.mc.gotoAndPlay(0,1)},n.prototype.onTap=function(){switch(this.currentState){case"LevelUp":var t=PlayerAttribute.currency,n=t[Game.Currency.CopperCoin],i=t[Game.Currency.Reading];if(i<this.needReading){var a=lang.String("readingCoin");return PopUpMessage.push(lang.StringWithFormat("item {1} not enough",a),color.RED),void this.onGainRes()}if(n<this.needCopperCoin)return void e.ResourceObtain.Open([e.ObtResId.CopperCoin]);this.leveluping=!0,null!=this.timer&&(egret.clearTimeout(this.timer),this.timer=null),this.autoLevelUp();break;case"Upgrade":this.selectCategory=this.list.selectedIndex;var r=this.onSelected(this.selectCategory),o=r.grade,s=r.Quality,l=table.bookCost.upgrade[o-1].bookdebris[s],u=PlayerAttribute.bag.CalcCount(7,r.Id);if(l>u)return void e.ResourceObtain.Open([e.ObtResId.bookSkill]);this.onTapUpgrade();break;default:egret.error("invalid currentState="+this.currentState)}},n.prototype.autoLevelUp=function(){this.onTapLevelUp(),this.timer=null},n.prototype.onTapLevelUp=function(){var t=PlayerAttribute.currency,n=t[Game.Currency.Reading];if(n<this.needReading)return void e.ResourceObtain.Open([e.ObtResId.readingCoinItem]);var i=t[Game.Currency.CopperCoin];if(!(i<this.needCopperCoin)){var a=new net.def.BookCategory;a.category=this.selectCategory,net.socket.write(111,a.toArrayBuffer())}},n.prototype.onTapUpgrade=function(){var e=new net.def.BookCategory;e.category=this.selectCategory,net.socket.write(112,e.toArrayBuffer())},n.prototype.onReadingChange=function(){var e=PlayerAttribute.books[this.selectCategory];if(null!=e){var t=PlayerAttribute.currency,n=t[Game.Currency.Reading];null!=this.reading&&(n>=this.needReading?this.reading.textFlow=Game.HtmlTextParser.parse('<font color="#23F40B">'+n+"</font>"):this.reading.textFlow=Game.HtmlTextParser.parse('<font color="#FF0000">'+n+"</font>"))}},n.prototype.onDebrisChange=function(){var e=(Player.instance,PlayerAttribute.books[this.selectCategory]);if(null!=e){var t=0;this.needDebris>0&&(t=PlayerAttribute.bag.CalcCount(7,e.Id),null!=this.debris&&(t>=this.needDebris?this.debris.textFlow=Game.HtmlTextParser.parse('<font color="#23F40B">'+t+"</font>"):this.debris.textFlow=Game.HtmlTextParser.parse('<font color="#FF0000">'+t+"</font>")))}},n.prototype.onCopperCoinChange=function(){var e=PlayerAttribute.books[this.selectCategory];if(null!=e){var t=PlayerAttribute.currency,n=t[Game.Currency.CopperCoin],i=PlayerAttribute.currencyTxt[Game.Currency.CopperCoin];null!=this.copperCoin&&(n>=this.needCopperCoin?this.copperCoin.textFlow=Game.HtmlTextParser.parse('<font color="#23F40B">'+i+"</font>"):this.copperCoin.textFlow=Game.HtmlTextParser.parse('<font color="#FF0000">'+i+"</font>"))}},n.prototype.onBookChange=function(){for(var e=(Player.instance,PlayerAttribute.books),t=0;t<Game.BookCategory;t++)null!=e[t]?(this.array[t].icon=e[t].Icon,this.array[t].quality=e[t].Quality):(this.array[t].icon=n.icon[t],this.array[t].quality=null);var i=this.list.dataProvider;if(null!=i){var a=this.list.selectedIndex;i.refresh(),this.list.selectedIndex=a}this.onSelected(this.selectCategory),this.onCopperCoinChange(),this.onReadingChange(),this.onDebrisChange(),this.updateTotalFP()},n.prototype.onUpgradeBook=function(e){var t=e.data,n=PlayerAttribute.books[t];this.maxExp=n.maxExp*n.grade,this.exp=n.exp,this.level=(n.grade-1)*n.maxExp+this.exp,this.updateRequireMaterial(n.grade-1,n.Quality),this.currentState="LevelUp",this.onCopperCoinChange(),this.onReadingChange(),this.playEffect(),this.UpdateDesc(),badge.onLight(badge.BookLevelUp[n.category],n.canLevelUp())},n.prototype.updateTotalFP=function(){var e=0,t=PlayerAttribute.books;for(var n in t)null!=t[n]&&(e+=t[n].FP);this.totalFP=e},n.prototype.updateRequireMaterial=function(e,t){this.needReading=table.bookCost.levelUp[e].reading[t],this.needCopperCoin=table.bookCost.levelUp[e].copperCoin,e+1<Game.MaxBookLevel&&(this.needDebris=table.bookCost.upgrade[e].bookdebris[t],"Upgrade"==this.currentState&&this.needDebris>0?this.info4.visible=!0:this.info4.visible=!1)},n.prototype.onLevelUpBook=function(e){var t=e.data.category,n=e.data.index,i=PlayerAttribute.books[t];if(i.exp>=i.maxExp&&(i.grade<Game.MaxBookLevel?this.currentState="Upgrade":this.currentState="Max"),this.maxExp=i.maxExp*i.grade,this.exp=i.exp,this.level=(i.grade-1)*i.maxExp+this.exp,this.updateRequireMaterial(i.grade-1,i.Quality),this.selectCategory==t){var a=i.attributes[n],r=table.books[i.Id].attributes[n];this.selectAttrib[n].value="+"+a.level*r.value,this.selectAttrib[n].level=a.level}this.onDebrisChange(),this.updateTotalFP(),this.playEffect(),i.exp>=i.maxExp&&i.grade<Game.MaxBookLevel&&badge.onLight(badge.BookLevelUp[i.category],i.canUpgrade()),this.leveluping&&i.exp<i.maxExp&&null==this.timer&&(this.timer=egret.setTimeout(this.autoLevelUp,this,500))},n.prototype.onChange=function(){badge.onLight(badge.BookChange[this.selectCategory],!1),e.BookCompose.open(this.selectCategory)},n.prototype.onRules=function(){var t=new e.Rule;t.skinName="BookSkillRulesSkin",UIManager.pushPage(t)},n.prototype.onGainRes=function(){e.ResourceObtain.Open([e.ObtResId.readingCoinItem])},n.prototype.onGainBookSKill=function(){e.ResourceObtain.Open([e.ObtResId.bookSkill])},n.prototype.onGuideReminder=function(){var e=this;this.visible&&guide.pushMovie({weight:1,handle:function(){e.playGuideMovie(guide.info.operation)}})},n.prototype.playGuideMovie=function(e){switch(e){case guide.GuideOperation.CraftBook:this.selectCategory=0,guide.AddMovieClip(this.btnChange);break;case guide.GuideOperation.GuideLevelUpBook:guide.AddMovieClip(this.btn)}},n.prototype.UpdateDesc=function(){var e=PlayerAttribute.books[this.selectCategory];this.talentSkillDesc.textFlow=Game.HtmlTextParser.parse(Item.Book.GetBookTalentSkillDesc(e.Id,e.grade)),this.nextLvtalentSkillDesc.textFlow=Game.HtmlTextParser.parse(Item.Book.GetBookNextTalentSkillDesc(e.Id,e.grade))},n.icon=["ui/forge/add_bg1.png","ui/forge/add_bg1.png","ui/forge/add_bg1.png","ui/forge/add_bg1.png"],n}(eui.Component);e.BookSkill=t,__reflect(t.prototype,"UI.BookSkill",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.remainingTime=new RemainingTime,t.skinName="BossHUDSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.onAddToStage=function(){SecondTicker.addEventListener(this.updateRestTime,this)},t.prototype.onRemoveFromStage=function(){SecondTicker.removeEventListener(this.updateRestTime,this)},t.prototype.updateRestTime=function(){this.time=this.remainingTime.getMinuteSecond()},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnExit:null!=this.onExit&&this.onExit()}},t}(e.FitComponent);e.BossHUD=t,__reflect(t.prototype,"UI.BossHUD",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.action="",t.onTouchBegin,t}return __extends(t,e),t.prototype.onTouchBegin=function(t){e.prototype.onTouchBegin.call(this,t),SoundUtil.playSoundEffect("sound/click.mp3")},t}(eui.Button);e.Button=t,__reflect(t.prototype,"UI.Button")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="BuyRefundSkin",n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.list.itemRenderer=e.BuyRefundItem,n}return __extends(n,t),n.prototype.onAddToStage=function(){this.onUpdate(),Game.dispatcher.addEventListener(Game.EVENT.ActivityBuyRefund,this.onUpdate,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.ActivityBuyRefund,this.onUpdate,this)},n.prototype.onUpdate=function(){if(null!=ActivityBuyRefund._data&&null!=ActivityBuyRefund.cfg){for(var e=[],t=0;t<ActivityBuyRefund.cfg.length;t++)e.push(ActivityBuyRefund.cfg[t]);for(var t=0;t<e.length;t++)e[t].index=t,e[t].buyed=ActivityBuyRefund._data.buyed.values[t]>0,e[t].marks=ActivityBuyRefund.GetRefundIndex(ActivityBuyRefund._data.mark[t].values),e[t].refunded=ActivityBuyRefund.GetRefundedNum(ActivityBuyRefund._data.mark[t].values);var n=this.list.dataProvider;null==n?this.list.dataProvider=new eui.ArrayCollection(e):n.replaceAll(e)}},n}(eui.Component);e.BuyRefund=t,__reflect(t.prototype,"UI.BuyRefund",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="BuyRefundItemSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.imgGroup.addEventListener(egret.Event.COMPLETE,t.onTweenGroupComplete,t),t.imgGroup.play(0),t}return __extends(t,e),t.prototype.onAddToStage=function(){this.mc.visible=!0,this.mc.Load("skill/vip_bg2/vip_bg2.json","vip_bg2"),this.mc.gotoAndPlay(0,-1)},t.prototype.onRemoveFromStage=function(){this.mc.visible=!1,this.mc.stop(),this.mc.free()},t.prototype.onTweenGroupComplete=function(){this.imgGroup.play(0)},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnBuyRefund:var t=new net.def.UInt32;t.value=this.data.index,net.socket.write(137,t.toArrayBuffer())}},t.prototype.dataChanged=function(){if(null!=this.data){this.pic=this.data.pic,this.itemname=this.data.name,this.days=lang.StringWithFormat("buy refund days {1}/{2}",this.data.refunded,this.data.Price/this.data.Refund),this.desc=this.data.desc;var e=lang.String(Game.currency2AwardType[this.data.CurrencyType]);this.refundtip=lang.StringWithFormat("buy refund {1} per day {2}",this.data.Refund,e);var t=Game.currency2Icon[this.data.CurrencyType];this.currencyIcon=t,this.cell.data=this.data.Award.content[0],this.cell.onRefresh();var n=ActivityBuyRefund.GetRefundDay();this.data.buyed?(""!=t?this.money=""+this.data.Refund:this.money=lang.StringWithFormat("{1}: {2}",e,this.data.Refund),0>n?(this.btnBuyRefund.label="Đã mua",this.btnBuyRefund.enabled=!1,this.btnBuyRefund.action=""):this.data.marks<0||this.data.marks>n?(this.btnBuyRefund.label="Đã hoàn trả",this.btnBuyRefund.enabled=!1,this.btnBuyRefund.action=""):(this.btnBuyRefund.label="Nhận",this.btnBuyRefund.enabled=!0,this.btnBuyRefund.action="102")):(""!=t?this.money=""+this.data.Price:this.money=lang.StringWithFormat("{1}: {2}",e,this.data.Price),0>n?(this.btnBuyRefund.label="Mua",this.btnBuyRefund.enabled=!0,this.btnBuyRefund.action="102"):(this.btnBuyRefund.label="Chưa mua",this.btnBuyRefund.enabled=!1,this.btnBuyRefund.action=""))}},t}(eui.ItemRenderer);e.BuyRefundItem=t,__reflect(t.prototype,"UI.BuyRefundItem")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="ChangeNameSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToState,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.Open=function(e){return Game.isCrossServer()?void PopUpMessage.push(lang.String("operation not permitted"),color.RED):(t.instance.state=e,void UIManager.pushPage(t.instance))},t.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close();break;case this.btnChange:if(""==this.textInput.text)return;switch(this.state){case"mine":this.onChangeMine();break;case"guild":this.onChangeGuildName();break;default:return}}},t.prototype.close=function(){UIManager.pop(t.instance)},t.prototype.onAddToState=function(){},t.prototype.onRemoveFromStage=function(){this.textInput.text=null},t.prototype.onChangeMine=function(){if(!World.wild)return PopUpMessage.push("Ở đây không thể đổi tên nhân vật.",color.RED),void UIManager.pop(this);if(this.textInput.text==Player.instance.Name)return void PopUpMessage.push("Nhập tên nhân vật mới",color.RED);if(PlayerAttribute.canRename){var e=new net.def.C2SRoleRename;e.setName(this.textInput.text),net.socket.write(264,e.toArrayBuffer()),UIManager.pop(this)}},t.prototype.onChangeGuildName=function(){if(Player.instance.guildPos!=Guild.GuildPosition.GuildPos_Leader&&Player.instance.guildPos!=Guild.GuildPosition.GuildPos_ViceLeader)return void UIManager.pop(this);if(this.textInput.text==Player.instance.guildName)return void PopUpMessage.push("Nhập tên bang mới",color.RED);if(Guild.canRename){var e=new net.def.Name;e.setName(this.textInput.text),net.socket.write(84,e.toArrayBuffer())}},t}(e.FitComponent);e.ChangeName=t,__reflect(t.prototype,"UI.ChangeName",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.channelNeedCheck=new Array(2,4,5),n.onChange=MakeDelayExecute(n.toBottom,n,10*Game.MSPF),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.skinName="ChatBoxSkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onClick,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onChange,n),n.messages.dataProvider=ChatSys.messages,n.messages.itemRenderer=e.ChatBoxMessage,Game.dispatcher.addEventListener(Game.EVENT.onChatReceived,n.onChange,n),n.onChange(),n}return __extends(n,t),n.prototype.toBottom=function(){var e=this.scroller,t=e.viewport.contentHeight-e.height;0>t&&(t=0),e.viewport.scrollV=t},n.prototype.onClick=function(t){UIManager.push(e.ChatDetail.instance),e.ChatDetail.instance.SetOpenPage(ChatSys.latestChannel,ChatSys.latestParam)},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.onNewChatReceived,this.updateNewMsgFlag,this),Game.dispatcher.addEventListener(Game.EVENT.onNewChatClicked,this.updateNewMsgFlag,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.onNewChatReceived,this.updateNewMsgFlag,this),Game.dispatcher.removeEventListener(Game.EVENT.onNewChatClicked,this.updateNewMsgFlag,this),this.onChange.stop()},n.prototype.updateNewMsgFlag=function(e){for(var t=0;t<this.channelNeedCheck.length;t++){var n=this.channelNeedCheck[t];if(this["new"].visible=ChatSys.checkNewMsg(Number(n)))return void(this["new"].visible=!0)}this["new"].visible=!1},n}(eui.Component);e.ChatBox=t,__reflect(t.prototype,"UI.ChatBox",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.bgs=new Array("ui/talk/lt_3.png","ui/talk/lt_5.png","ui/talk/lt_4.png","ui/talk/lt_3.png","ui/talk/lt_2.png","ui/talk/lt_1.png","ui/talk/lt_4.png"),t.skinName="ChatBoxMessageSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){this.messageGroup.removeChildren(),this.chanel.text=lang.String(ChatSys.chanelname[this.data.chanel]),this.chanel.textColor=ChatSys.chanelcolor[this.data.chanel],this.channelbg.source=this.bgs[this.data.chanel];var e=this.data.textElements,t=[];t.push({kind:Game.TextElementKind.Text,text:"          "}),t.push.apply(t,this.data.name);for(var n=0,i=0;i<t.length;i++)n+=Game.TextParser.measureElement(t[i]);for(var i=0;i<e.length;i++)e[i].kind==Game.TextElementKind.Image&&(e[i].value.x=Math.ceil(n)),n+=Game.TextParser.measureElement(e[i]);this.message.textFlow=t.concat(e);for(var a=Math.ceil(this.message.textWidth),i=0;i<e.length;i++)if(e[i].kind==Game.TextElementKind.Image){var r=e[i].value.x;r>a&&(e[i].value.x=r%a,e[i].value.y=Math.floor(r/a)*(this.message.size+this.message.lineSpacing)),this.messageGroup.addChild(e[i].value)}},t}(eui.ItemRenderer);e.ChatBoxMessage=t,__reflect(t.prototype,"UI.ChatBoxMessage")}(UI||(UI={}));var UI;!function(e){var t=new Array(1,2,3,4,5),n=function(n){function i(){var t=n.call(this)||this;return t.skinName="ChatDetailSkin",t.attachments=[],t.onChange=MakeDelayExecute(t.toBottom,t,10*Game.MSPF),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onClick,t),t.privateChatTgtFaction=0,t.channelName1=lang.String("chanel name system"),t.channelName2=lang.String("chanel name guild"),t.channelName3=lang.String("chanel name world"),t.channelName4=lang.String("chanel name map"),t.channelName5=lang.String("chanel name private"),ChatSys.customChannelSubId>0&&(t.channelName2=lang.String("chanel name custom")),t.arrRecentSendMsg=[],t.currentMsgIndex=0,t.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,t.onTabTap,t),t.tabbar.itemRenderer=e.TalkTabSkin,t.messages.dataProvider=ChatSys.messages_World,t.messages.itemRenderer=e.ChatMessage,t.miliaoplayer.dataProvider=ChatSys.messages_Private,t.miliaoplayer.itemRenderer=e.ChatPlayer,Game.dispatcher.addEventListener(Game.EVENT.onChatReceived,t.showImageBottom,t),t.newMessageTip.visible=!1,t}return __extends(i,n),Object.defineProperty(i,"instance",{get:function(){return null==this._instance&&(this._instance=new i),this._instance},enumerable:!0,configurable:!0}),i.prototype.onAddToStage=function(){this.input.maxChars=80;var e=this.getchannelbyindex(this.tabbar.selectedIndex);this.changeChannel(e),Game.dispatcher.addEventListener(Game.EVENT.SelectPrivateChanel,this.onSelectPrivateChanel,this),egret.Capabilities.isMobile||KeyBoardSystem.focus(this)},i.prototype.onRemoveFromStage=function(){this.curchannel=0,Game.dispatcher.removeEventListener(Game.EVENT.SelectPrivateChanel,this.onSelectPrivateChanel,this),this.onChange.stop(),egret.Capabilities.isMobile||KeyBoardSystem.restore()},i.prototype.showImageBottom=function(){var e=this.scroller;return e.height>=e.viewport.contentHeight?void(this.newMessageTip.visible=!1):void(e.height+e.viewport.scrollV+10>e.viewport.contentHeight?(this.onChange(),this.newMessageTip.visible=!1):this.newMessageTip.visible=!0)},i.prototype.toBottom=function(){var e=this.scroller,t=e.viewport.contentHeight-e.height;0>t&&(t=0),e.viewport.scrollV=t},i.prototype.onClick=function(t){switch(t.target){case this.btnOpenBag:UIManager.pop(this),e.HUD.instance.openBag();break;case this.btnClose:UIManager.pop(this);break;case this.btnSend:this.sendChat();break;case this.btnBiaoqing:this.biaoqinggroup.visible=!this.biaoqinggroup.visible;break;case this.btnClosebq:case this.imgClosebq:this.biaoqinggroup.visible=!1;break;case this.newMessageTip:this.newMessageTip.visible=!1,this.onChange();break;default:if(null!=t.target&&"emoji"==t.target.name&&this.clickEmoji(t.target.source))break}},i.prototype.scrollInput=function(e){var t=this.arrRecentSendMsg.length;0!=t&&(this.currentMsgIndex=(this.currentMsgIndex+e+t)%t,this.input.text=this.arrRecentSendMsg[this.currentMsgIndex])},i.prototype.onKeyDown=function(e){switch(e){case KeyBoard.CnterEnter:this.sendChat(),this.currentMsgIndex=0;break;case KeyBoard.UpArrow:this.scrollInput(-1);break;case KeyBoard.DownArrow:this.scrollInput(1)}},i.prototype.sendChat=function(){if(""!=this.input.text){if(this.curchannel==ChatSys.channel_private&&!this.bEnterChannel){var e=lang.String("send private msg no target");return ChatSys.sendSystemMsg(e,ChatSys.channel_system,""),this.tabbar.selectedIndex=0,this.changeChannel(ChatSys.channel_system),void ChatSys.setChannelName(ChatSys.channel_private,"")}if(this.curchannel==ChatSys.channel_private&&RecentContact.addrecentContact(this.channelName.text,this.privateChatTgtFaction),this.curchannel==ChatSys.channel_world){if(this.sendCD){var t=Game.getServerDate();if(this.sendCD>=t.getTime())return void PopUpMessage.push("Tốc độ nói chuyện quá nhanh, mời bạn chờ chút thử lại",color.RED)}this.sendCD=Game.getServerDate().getTime()+5*Game.Second}var n=Game.Escape(this.input.text),i=new net.def.C2SChat;i.attachments=new net.def.ChatAttachments;for(var a=0;a<this.attachments.length;a++){var r=this.attachments[a];switch(r.kind){case Game.TextElementKind.Text:n=n.replace(r.text,r.data);break;case Game.TextElementKind.Image:n=n.replace(r.text,r.data);break;case Game.TextElementKind.Equip:null==i.attachments.equips&&(i.attachments.equips=[]);var o=r.data;i.attachments.equips.push(o.Marshal()),n=n.replace(r.text,"<equip="+(i.attachments.equips.length-1)+"/>");break;case Game.TextElementKind.Item:null==i.attachments.items&&(i.attachments.items=[]);var s=r.data;i.attachments.items.push(s.Marshal()),n=n.replace(r.text,"<item="+(i.attachments.items.length-1)+"/>");break;case Game.TextElementKind.Book:null==i.attachments.books&&(i.attachments.books=[]);var l=r.data;i.attachments.books.push(l.Marshal()),n=n.replace(r.text,"<book="+(i.attachments.books.length-1)+"/>");break;case Game.TextElementKind.PartnerEquip:null==i.attachments.partnerEquips&&(i.attachments.partnerEquips=[]);var u=r.data;i.attachments.partnerEquips.push(u.Marshal()),n=n.replace(r.text,"<partnerEquip="+(i.attachments.partnerEquips.length-1)+"/>");break;case Game.TextElementKind.JueXue:null==i.attachments.juexues&&(i.attachments.juexues=[]);var c=r.data;i.attachments.juexues.push(c.Marshal()),n=n.replace(r.text,"<juexue="+(i.attachments.juexues.length-1)+"/>")
}}i.setChannelId(this.curchannel),i.setMessage(n),i.setParam(ChatSys.getChannelName()),this.getchannelbyindex(this.tabbar.selectedIndex)==ChatSys.channel_custom&&(i.setChannelId(ChatSys.channel_custom),i.setParam(ChatSys.customChannelSubId.toString())),net.socket.write(11,i.toArrayBuffer()),this.toBottom(),this.cacheRecentMsg(this.input.text),this.input.text="",this.attachments=[]}},i.prototype.clickEmoji=function(e){for(var t=0,n=1;100>=n;n++){var i="Input/"+n+".png";if(e==i){t=n;break}}return 0==t?!1:(ChatMsg.makeChatMsg_Img(t),this.biaoqinggroup.visible=!1,!0)},i.prototype.onTabTap=function(e){var t=this.getchannelbyindex(e.itemIndex);this.changeChannel(t,!0)},i.prototype.changeChannel=function(e,t){if(e!=this.curchannel||e==ChatSys.channel_private){switch(ChatSys.setChannelName(e,""),this.channelName.text=ChatSys.getChannelName(),this.curchannel=e,this.bEnterChannel=!0,t?this.onChange():this.showImageBottom(),e){case ChatSys.channel_system:this.messages.dataProvider=ChatSys.messages_System;break;case ChatSys.channel_guild:this.messages.dataProvider=ChatSys.messages_Guild;break;case ChatSys.channel_world:this.messages.dataProvider=ChatSys.messages_World;break;case ChatSys.channel_map:this.messages.dataProvider=ChatSys.messages_Map;break;case ChatSys.channel_custom:this.messages.dataProvider=ChatSys.messages_Custom;break;case ChatSys.channel_private:this.bEnterChannel=!1,this.messages.dataProvider=null}this.updateInputDisplay(),this.updateMiliaoDisplay(),ChatSys.updateNewMsg(e),e!=ChatSys.channel_private&&Game.dispatcher.dispatchEventWith(Game.EVENT.onNewChatClicked,!1,e)}},i.prototype.updateInputDisplay=function(){return this.curchannel==ChatSys.channel_system?(this.noinput.visible=!0,void(this.inputlabel.visible=!1)):(this.noinput.visible=!1,void(this.inputlabel.visible=!0))},i.prototype.updateMiliaoDisplay=function(){this.curchannel==ChatSys.channel_private?this.miliao.visible=!0:this.miliao.visible=!1},i.prototype.getchannelbyindex=function(e){var n=ChatSys.channel_system;return t[e]&&(n=t[e]),n==ChatSys.channel_guild&&ChatSys.customChannelSubId>0&&(n=ChatSys.channel_custom),n},i.prototype.onSelectPrivateChanel=function(e){this.tabbar.selectedIndex=4,this.changeChannel(ChatSys.channel_private);var t=e.data;ChatSys.setChannelName(ChatSys.channel_private,t),this.channelName.text=ChatSys.getChannelName(),this.miliao.visible=!1,this.messages.dataProvider=ChatSys.getPrivateChanelMessages(t),this.bEnterChannel=!0},i.prototype.addMsgElement=function(e,t,n){this.input.currentState="normal",this.input.text=this.input.text+e,this.attachments.push({text:e,kind:t,data:n})},i.prototype.registerCustomChannel=function(){this.channelName2=lang.String("chanel name custom")},i.prototype.unRegisterCustomChannel=function(){this.channelName2=lang.String("chanel name guild")},i.prototype.cacheRecentMsg=function(e){this.arrRecentSendMsg.push(e),this.arrRecentSendMsg.length>i.RECENT_COUNT&&this.arrRecentSendMsg.shift()},i.prototype.SetOpenPage=function(e,t){var n=[];if(n[ChatSys.channel_system]=0,n[ChatSys.channel_guild]=1,n[ChatSys.channel_world]=2,n[ChatSys.channel_map]=3,n[ChatSys.channel_private]=4,n[ChatSys.channel_custom]=1,this.tabbar.selectedIndex=n[e],e!=ChatSys.channel_private)this.changeChannel(e);else{this.changeChannel(ChatSys.channel_private),ChatSys.setChannelName(ChatSys.channel_private,t),this.channelName.text=ChatSys.getChannelName(),this.miliao.visible=!1,this.messages.dataProvider=ChatSys.getPrivateChanelMessages(t),this.bEnterChannel=!0;for(var i=0;i<ChatSys.messages_Private.length;i++)if(ChatSys.messages_Private.getItemAt(i).privatename==t){ChatSys.messages_Private.getItemAt(i).newMsg=!1;break}}},i.RECENT_COUNT=5,i}(e.FitComponent);e.ChatDetail=n,__reflect(n.prototype,"UI.ChatDetail",["eui.UIComponent","egret.DisplayObject","KeyBoradComponent"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="ChatMessageSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.message.addEventListener(egret.TextEvent.LINK,e.clickElement,e),e}return __extends(n,t),n.prototype.dataChanged=function(){this.messageGroup.removeChildren();var e=this.data.textElements;this.currentState=this.data.state,this.data.bSysMsg?(this.bSystemMsg=!0,this.headgroup.visible=!0,this.strHead=ChatSys.sysheadpic,this.sendername.textFlow=Game.HtmlTextParser.parse(lang.String("chanel name system"))):table.faction[this.data.faction]?(this.bSystemMsg=!1,this.headgroup.visible=!0,this.strHead=table.faction[this.data.faction].portrait,this.sendername.textFlow=this.data.name,this.sendername.text=this.sendername.text.substring(0,this.sendername.text.length-1)):(this.bSystemMsg=!0,this.headgroup.visible=!0,this.strHead=ChatSys.sysheadpic,this.sendername.textFlow=Game.HtmlTextParser.parse(lang.String("chanel name system"))),this.timeStamp.text=this.data.timeStamp,this.message.textFlow=e;for(var t=Math.ceil(this.message.textWidth),n=0;n<e.length;n++){var i=e[n];switch(i.kind){case Game.TextElementKind.Image:var a=i.value.x;a>t&&(i.value.x=a%t,i.value.y=Math.floor(a/t)*(this.message.size+this.message.lineSpacing)),this.messageGroup.addChild(i.value);break;case Game.TextElementKind.Book:case Game.TextElementKind.Equip:case Game.TextElementKind.Item:case Game.TextElementKind.Team:case Game.TextElementKind.DungeonGroup:case Game.TextElementKind.Operation:case Game.TextElementKind.RedPacket:case Game.TextElementKind.Award:case Game.TextElementKind.Training:case Game.TextElementKind.Player:case Game.TextElementKind.PartnerEquip:case Game.TextElementKind.JueXue:var r=i.style;(r||r)&&(r.href="event:"+n)}}},n.prototype.clickElement=function(e){var t=parseInt(e.text);ChatMsg.touchLink(this.data.textElements[t])},n.prototype.onTouchTap=function(t){switch(t.target){case this.headgroup:"other"!=this.currentState||this.bSystemMsg||Game.isCrossServer()||(UIManager.push(new e.ChatPlayerDsc),friend.search(this.data.realname))}},n}(eui.ItemRenderer);e.ChatMessage=t,__reflect(t.prototype,"UI.ChatMessage")}(UI||(UI={}));var ChatMsg;!function(e){function t(e){if(null!=e){var t;switch(e.kind){case Game.TextElementKind.Equip:t={type:"equipInstance",content:e.value};break;case Game.TextElementKind.Book:t={type:"bookInstance",content:e.value};break;case Game.TextElementKind.Item:var n=e.value;t={type:"item",content:{genre:n.Genre,detailType:n.DetailType,count:n.Count}};break;case Game.TextElementKind.Team:var i=e.value.inviter,a=e.value.endTime,r=e.value.roomId;return void DungeonHallMgr.ApplyJoinRoom(i,a,r);case Game.TextElementKind.DungeonGroup:var o=e.value.target,s=e.value.type;return void DungeonGroup.JoinGroup(o,s);case Game.TextElementKind.Operation:return void Operation.open(e.value,e.param);case Game.TextElementKind.RedPacket:return void RedPacket.receive(e.value);case Game.TextElementKind.Award:t=e.value;break;case Game.TextElementKind.Training:Guild.BeginTraining(e.value.inviter);break;case Game.TextElementKind.Player:UIManager.push(new UI.ChatPlayerDsc),friend.search(e.text);break;case Game.TextElementKind.PartnerEquip:t={type:"partnerEquip",content:e.value};break;case Game.TextElementKind.JueXue:t={type:"juexueInstance",content:e.value}}if(null!=t){var l=UI.ItemTips.instance;l.data=t,UIManager.push(UI.ItemTips.instance)}}}function n(e){UIManager.push(UI.ChatDetail.instance);var t="["+table.props[e.Genre][e.DetailType].name+"]";UI.ChatDetail.instance.addMsgElement(t,Game.TextElementKind.Item,e)}function i(e){UIManager.push(UI.ChatDetail.instance);var t=Game.Faction[PlayerAttribute.faction],n="["+table.equips[e.Part][e.Id][t].name+"]";UI.ChatDetail.instance.addMsgElement(n,Game.TextElementKind.Equip,e)}function a(e){UIManager.push(UI.ChatDetail.instance);var t=PartnerEquipManager.GetPartnerEquipInfo(e.id),n="["+t.name+"]";UI.ChatDetail.instance.addMsgElement(n,Game.TextElementKind.PartnerEquip,e)}function r(e){UIManager.push(UI.ChatDetail.instance);var t="["+e.name+"]";UI.ChatDetail.instance.addMsgElement(t,Game.TextElementKind.Book,e)}function o(e){UIManager.push(UI.ChatDetail.instance);var t="["+e.name+"]";UI.ChatDetail.instance.addMsgElement(t,Game.TextElementKind.JueXue,e)}function s(e){var t="\\"+e;UI.ChatDetail.instance.addMsgElement(t,Game.TextElementKind.Image,"<img="+e+"/>")}function l(e,t,n,i){var a=DungeonHallMgr.Targets[t];UIManager.push(UI.ChatDetail.instance);var r="<team="+e+","+t+","+n+","+i+"/>",o="["+lang.StringWithFormat("{1} team invite",a)+"]";UI.ChatDetail.instance.addMsgElement(o,Game.TextElementKind.Text,r)}function u(e,t){var n="<ui="+t+","+e+"/>";UI.ChatDetail.instance.addMsgElement(e,Game.TextElementKind.Text,n)}e.touchLink=t,e.makeChatMsg_Item=n,e.makeChatMsg_Equip=i,e.makeChatMsg_PartnerEquip=a,e.makeChatMsg_Book=r,e.makeChatMsg_JueXue=o,e.makeChatMsg_Img=s,e.makeChatMsg_Team=l,e.makeChatMsg_Op=u}(ChatMsg||(ChatMsg={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="ChatPlayerSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.dataChanged=function(){this["new"].visible=this.data.newMsg,this.privateName.text=this.data.privatename,this.currentState=this.data.state,table.faction[this.data.faction]?(this.headgroup.visible=!0,this.strHead=table.faction[this.data.faction].portrait):this.headgroup.visible=!1},t.prototype.onTouchTap=function(e){Game.dispatcher.dispatchEventWith(Game.EVENT.SelectPrivateChanel,!1,this.data.privatename),this.data.newMsg=!1,this["new"].visible=this.data.newMsg,Game.dispatcher.dispatchEventWith(Game.EVENT.onNewChatClicked,!1,ChatSys.channel_private)},t}(eui.ItemRenderer);e.ChatPlayer=t,__reflect(t.prototype,"UI.ChatPlayer")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="ChatPlayerDscSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.prototype.onTouchTap=function(e){switch(e.target){case this.btnAddFriend:if(null==this.roleBrief||""==this.roleBrief.name||this.roleBrief.name==Player.instance.Name)return;friend.sendRequest(this.roleBrief.name),this.btnAddFriend.enabled=!1;break;case this.btnMiliao:if(null==this.roleBrief||""==this.roleBrief.name||this.roleBrief.name==Player.instance.Name)return;this.close(),ChatSys.createNewPrivateChannel(this.roleBrief.name,this.roleBrief.faction);break;case this.imgClose:this.close();break;case this.btnAddBlackList:this.close(),BlackList.addBlackList(this.roleBrief.name,this.roleBrief.faction);break;case this.btnQuery:var t=new net.def.Name;t.name=this.roleBrief.name,net.socket.write(146,t.toArrayBuffer())}},t.prototype.close=function(){UIManager.pop(this)},t.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.SearchRoleResult,this.onRoleBrief,this)},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.SearchRoleResult,this.onRoleBrief,this)},t.prototype.onRoleBrief=function(e){var t=e.data;t.length<1||(this.roleBrief=t[0],friend.check(this.roleBrief.uuid)?this.btnAddFriend.enabled=!1:this.btnAddFriend.enabled=!0)},t}(e.FitComponent);e.ChatPlayerDsc=t,__reflect(t.prototype,"UI.ChatPlayerDsc",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){e.QualityParseCircleImg={0:null,1:"ui/quality/y1.png",2:"ui/quality/y2.png",3:"ui/quality/y3.png",4:"ui/quality/y4.png",5:"ui/quality/y5.png"};var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="CircleCellSkin",e}return __extends(n,t),n.prototype.makeQualityImage=function(t){this.qualityImg=e.QualityParseCircleImg[t],5==t?this.makeQualityMovie(t):Game.removeFromParent.apply(this.qualityMovie)},n.prototype.makeQualityMovie=function(e){if(this.qualityMovieEnabled)switch(e){case 5:this.addChildAt(this.qualityMovie,3),this.qualityMovie.Load("mc/Ui_y5/Ui_y5.json","Ui_y5")}},n}(e.AwardCell);e.CircleCell=t,__reflect(t.prototype,"UI.CircleCell")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="CircleCellSkin",e}return __extends(n,t),n.prototype.makeQualityImage=function(t){this.qualityImg=e.QualityParseCircleImg[t],5==t?this.makeQualityMovie(t):Game.removeFromParent.apply(this.qualityMovie)},n.prototype.makeQualityMovie=function(e){if(this.qualityMovieEnabled)switch(e){case 5:this.addChildAt(this.qualityMovie,3),this.qualityMovie.Load("mc/Ui_y5/Ui_y5.json","Ui_y5")}},n}(e.EquipCell);e.CircleEquipCell=t,__reflect(t.prototype,"UI.CircleEquipCell")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="CircleIconSkin",t}return __extends(t,e),t}(eui.ItemRenderer);e.CircleIcon=t,__reflect(t.prototype,"UI.CircleIcon")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="CircularIconSkin",t.imgHead="",t.touchChildren=!1,t}return __extends(t,e),t}(eui.Component);e.CircularIcon=t,__reflect(t.prototype,"UI.CircularIcon",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.skinName="CitySkin",e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.close=function(){null!=this._instance&&UIManager.pop(this._instance)},n.prototype.onAddToStage=function(){WorldLine.IsOpen("GuildDungeon")||(Game.removeFromParent.apply(this.btnGuildGarden),Game.removeFromParent.apply(this.qianbaoku)),Game.dispatcher.addEventListener(Game.EVENT.GuildQuit,this.close,this);var t=egret.localStorage.getItem("needShowGuildAnnounce");"1"==t&&(egret.localStorage.setItem("needShowGuildAnnounce","0"),UIManager.pushPage(new e.GuildInfoChange("display")))},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.GuildQuit,this.close,this)},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnGuildWar:UIManager.pushPage(e.GuildWarHome.instance);break;case this.btnGuildGarden:GuildDungeon.Hotkey2Open(!0);break;case this.btnGuild:Guild.onCity2GuildMain();break;case this.btnActShop:UIManager.pushPage(e.GuildShop.instance);break;case this.btnActBusiTask:e.GuildBusiTask.open();break;case this.btnActEquipBuild:e.EquipMaking.open();break;case this.btnGuildDonate:UIManager.pushPage(e.GuildDonate.instance)}},n.prototype.close=function(){UIManager.closeGuild()},n.prototype.onGuideReminder=function(){var e=this;if(this.visible){var t=guide.info.operation;switch(t){case guide.GuideOperation.GuideTaohuaIslandPlant:case guide.GuideOperation.GuideSeasunVillage:case guide.GuideOperation.GuideGuild:case guide.GuideOperation.GuideArena:case guide.GuideOperation.GuideRecruitPartner:case guide.GuideOperation.GuideHuashanPK:break;default:return}guide.pushMovie({weight:1,handle:function(){e.playGuideMovie(t)}})}},n.prototype.playGuideMovie=function(e){var t;switch(e){case guide.GuideOperation.GuideTaohuaIslandPlant:case guide.GuideOperation.GuideTaohuaIslandRob:t=this.btnActEquipBuild;break;case guide.GuideOperation.GuideGuild:t=this.btnGuild;break;case guide.GuideOperation.GuideArena:t=this.btnGuildWar;break;case guide.GuideOperation.GuideHuashanPK:t=this.btnGuildGarden;break;default:return}guide.AddMovieClip(t)},n}(e.FitComponent);e.City=t,__reflect(t.prototype,"UI.City",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="CityHomeHUDSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.onAddToStage=function(){SecondTicker.addEventListener(this.onTimer,this)},t.prototype.onRemoveFromStage=function(){SecondTicker.removeEventListener(this.onTimer,this)},t.prototype.onTimer=function(){},t.prototype.onTouchTap=function(e){switch(e.target){case this.iconCity:CityHome.c2s_leave()}},t}(e.FitComponent);e.CityHomeHUD=t,__reflect(t.prototype,"UI.CityHomeHUD",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="CityStatuaryInfoSkin",n.dataList=new eui.ArrayCollection,n.dataListRandAward=new eui.ArrayCollection,n.list.itemRenderer=e.AwardCell,n.list.dataProvider=n.dataList,n.listRandAward.itemRenderer=e.AwardCell,n.listRandAward.dataProvider=n.dataListRandAward,n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n}return __extends(n,t),n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.onAddToStage=function(){this.updateInfo(),Game.dispatcher.addEventListener(Game.EVENT.CityStatuaryInfoChange,this.updateInfo,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.CityStatuaryInfoChange,this.updateInfo,this)},n.prototype.updateInfo=function(){if(null!=CityHome.statuaryInfo){var e=CityHome.statuaryInfo;this.leaderFp=e.getLeaderFp(),this.totalTimes=e.getTotalTimes().toString();var t=e.getLeaderFaction(),n=table.faction[t];if(this.leaderName=e.getLeaderName(),""==this.leaderName)this.actorImg.visible=!0,this.actorIcon.visible=!1,this.actorImg.source="ui/city/noPlayer.png",this.actorIcon.clear(),this.groupHead.visible=!1,this.fpGroup.visible=!1,this.vipIcon.source="",this.factionIcon.source="",this.leaderLevel.text="",this.btnQuery.visible=!1;else{this.actorImg.visible=!1,this.actorIcon.visible=!0,this.actorImg.source="",this.groupHead.visible=!0,this.fpGroup.visible=!0,this.btnQuery.visible=!0,this.head.roleName=this.leaderName,this.head.updateRoleNameColor(3407616),this.head.hideLifeBar(),this.head.updateTitle2(CommonTitle.getResource(e.getLeaderCommonTitle())),this.head.updateTitle(FactionTitle.getResource(e.getLeaderFactionTitle())),this.head.updateGuildName(e.getGuildName()),this.head.updateGuildColor(!0);var i=n.resource,a=e.getLeaderAvatar();null!=table.avatars[a]&&(i=table.avatars[a].resource),this.actorIcon.setResource(i,null,null),this.vipIcon.source=Vip.getVipIcon(e.getLeaderVIPLevel()),this.factionIcon.source=table.faction[e.getLeaderFaction()].logo,this.leaderLevel.textFlow=Game.TextParser.parse("<font color='#939393'>Lv.</font> "+e.getLeaderLevel())}e.getBelongGuild()?this.dataList.replaceAll(CityHome.statuaryConfig.worshipAwardOwnerGuild):this.dataList.replaceAll(CityHome.statuaryConfig.worshipAwardOtherGuild),this.dataListRandAward.replaceAll(CityHome.statuaryConfig.worshipRandAwards)}},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnWorship:CityHome.Worship();break;case this.btnQuery:if(null!=this.leaderName&&""!=this.leaderName){var t=new net.def.Name;t.name=this.leaderName,net.socket.write(146,t.toArrayBuffer())}break;default:return}},n}(e.FitComponent);e.CityStatuaryInfo=t,__reflect(t.prototype,"UI.CityStatuaryInfo",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=["icon/item/box1_1.png","icon/item/box1_2.png","icon/item/box1_3.png","icon/item/box1_4.png","icon/item/box1_5.png"],n=function(n){function i(){var t=n.call(this)||this;return t.skinName="CellSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.mc=new e.MovieClipComponent,t.mc.removeWhenComplete=!1,t.mc.visible=!1,t}return __extends(i,n),i.prototype.onAddToStage=function(){this.coverPage=new eui.Image("ui/public/public_bg4.jpg"),this.coverPage.name="testImage",this.coverPage.$setX(5),this.coverPage.$setY(5),this.coverPage.$setWidth(this.$getWidth()-10),this.coverPage.$setHeight(this.$getHeight()-10),this.coverPage.touchEnabled=!0,this.addChild(this.coverPage),this.mc.Load("skill/Ui_qianghua01/Ui_qianghua01.json","Ui_qianghua01"),Game.dispatcher.addEventListener(Game.EVENT.OnClickAwardPageClose,this.ShowItem,this)},i.prototype.onRemoveFromStage=function(){this.clearcell(),Game.dispatcher.removeEventListener(Game.EVENT.OnClickAwardPageClose,this.ShowItem,this),this.mc.stop(),this.mc.visible=!1,this.mc.free()},i.prototype.ShowItem=function(){null!=this.coverPage&&(this.mc.gotoAndPlay(0,1),this.addChild(this.mc),this.mc.offsetX=-6,this.mc.offsetY=-6,this.removeChild(this.coverPage),this.coverPage=null)},i.prototype.onTouchTap=function(t){if(t.target==this.coverPage)return void this.ShowItem();var n=e.ItemTips.instance;if(null!=this.data&&(null==this.data.forbidTip||!this.data.forbidTip)){var i=this.extractByLevel(this.data);null==i&&(i=this.data),n.desc=i.desc,n.data=i,UIManager.push(e.ItemTips.instance)}},i.prototype.onRefresh=function(){this.dataChanged()},Object.defineProperty(i.prototype,"AwardDesc",{get:function(){return this.dataChanged(),this.awardDesc},enumerable:!0,configurable:!0}),i.prototype.dataChanged=function(){this.coverPage.source=t[this.data.boxType],e.AwardCell.OnDataChanged(this)},i.prototype.clearcell=function(){this.icon="",this.quality=null,this.rbcorner="",this.plugin="",this.smallIcon="",this.jxFontNote="",Game.removeFromParent.apply(this.qualityMovie)},i.prototype.extractByLevel=function(e){switch(e.type){case"levelaward":var t=PlayerAttribute.Level;if(null==e.content[t]&&(t-=t%10),null!=e.content[t])return e.content[t]}return null},i}(e.Cell);e.ClickAwardCell=n,__reflect(n.prototype,"UI.ClickAwardCell");var i=function(e){function t(){var t=e.call(this)||this;return t.title1="Thưởng",t.title2="Thưởng",t.title3="Thưởng",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.loaded=!1,t.tryCloth=0,t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.loaded=!0,this.awardList1.itemRenderer=n,this.awardList2.itemRenderer=n,this.awardList3.itemRenderer=n},t.prototype.onAddToStage=function(){Game.removeFromParent.apply(this.group1),Game.removeFromParent.apply(this.group2),Game.removeFromParent.apply(this.group3),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.OnTouchTap,this),null!=this.awardData1&&(this.groupFrame.addChild(this.group1),this.awardList1.dataProvider=new eui.ArrayCollection(this.awardData1)),null!=this.awardData2&&(this.groupFrame.addChild(this.group2),this.awardList2.dataProvider=new eui.ArrayCollection(this.awardData2)),null!=this.awardData3&&(this.groupFrame.addChild(this.group3),this.awardList3.dataProvider=new eui.ArrayCollection(this.awardData3)),this.tryCloth=0},t.prototype.onRemoveFromStage=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.OnTouchTap,this)},t.prototype.ShowPage=function(e){this.awardData1=e,UIManager.push(this)},t.prototype.ShowMultiPage=function(e,t,n,i,a,r){this.awardData1=t,this.awardData2=i,this.awardData3=r,this.title1=e,this.title2=n,this.title3=a,UIManager.push(this)},t.prototype.OnTouchTap=function(e){var t=this;switch(e.target){case this.imgClose:0==this.tryCloth?(this.tryCloth=1,Game.dispatcher.dispatchEventWith(Game.EVENT.OnClickAwardPageClose),MakeDelayExecute(function(){UIManager.pop(t)},null,2*Game.Second)()):UIManager.pop(this)}},t}(e.FitComponent);e.ClickAwardPage=i,__reflect(i.prototype,"UI.ClickAwardPage",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="CommonGetItemPanelSkin",t.timer=null,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.onAddToStage=function(){null==this.timer&&(this.timer=egret.setTimeout(this.Close,this,3e3)),this.cell.data={type:"item",content:{genre:this.genre,detailType:this.detailType}};var e=table.props[this.genre][this.detailType];this.labelItemName.text=e.name,this.labelItemName.textColor=Item.QualityColor[e.quality]},t.prototype.onRemoveFromStage=function(){},t.prototype.Close=function(){null!=this.timer&&(egret.clearTimeout(this.timer),this.timer=null),UIManager.pop(this)},t.prototype.SetItem=function(e,t,n){this.genre=e,this.detailType=t,this.itemNum=n},t.prototype.Open=function(){UIManager.pushPage(this),null!=this.timer&&(egret.clearTimeout(this.timer),this.timer=null),this.timer=egret.setTimeout(this.Close,this,3e3)},t}(e.FitComponent);e.CommonGetItemPanel=t,__reflect(t.prototype,"UI.CommonGetItemPanel",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="CommonNotifyPanelSkin",t.inited=!1,t.timer=null,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.SetMsg=function(e){this.msg=e,this.color=color.NewGREEN,this.inited&&(this.labelMsg.text=this.msg,this.labelMsg.textColor=this.color)},t.prototype.SetErrorMsg=function(e){this.msg=e,this.color=color.RED,this.inited&&(this.labelMsg.text=this.msg,this.labelMsg.textColor=this.color)},t.prototype.Open=function(){UIManager.pushPage(this),null!=this.timer&&(egret.clearTimeout(this.timer),this.timer=null),this.timer=egret.setTimeout(this.Close,this,3e3)},t.prototype.onAddToStage=function(){this.labelMsg.text=this.msg,this.labelMsg.textColor=this.color,this.inited=!0},t.prototype.onRemoveFromStage=function(){},t.prototype.Close=function(){null!=this.timer&&(egret.clearTimeout(this.timer),this.timer=null),UIManager.pop(this)},t}(e.FitComponent);e.CommonNotifyPanel=t,__reflect(t.prototype,"UI.CommonNotifyPanel",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.OnAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.OnRemoveFromStage,t),t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.OnAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.OnClickAwardPageClose,this.Close,this)},t.prototype.OnRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.OnClickAwardPageClose,this.Close,this)},t.prototype.Close=function(){UIManager.pop(this)},t}(e.FitComponent);e.CommonSceneResult=t,__reflect(t.prototype,"UI.CommonSceneResult",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.skinName="LoadingSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n),this.imgBg==n&&(this.imgBg.source=egret.Capabilities.isMobile?"public_bg4.jpg":"public_bg5.jpg")},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.refresh&&(this.refresh.textFlow=[{text:this.refresh.text,style:{underline:!0}}])},t.prototype.onTouchTap=function(e){e.target==this.refresh&&window.location.reload()},t.prototype.onProgress=function(e,t){this.maximum=t,this.value=e,this.percent=this.progressGroup.width*this.value/this.maximum},t}(UI.FitComponent);__reflect(LoadingUI.prototype,"LoadingUI");var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.title="",t}return __extends(t,e),t}(eui.Component);e.ComponentBG=t,__reflect(t.prototype,"UI.ComponentBG")}(UI||(UI={}));var UI;!function(e){function t(t,a){void 0===a&&(a=null);var r=function(t){if(t!=Game.BagPage.Equip)return e.BagView.instance.page=t,void UIManager.openBag();var n=[];Setting.Smelt(2)&&n.push(2),Setting.Smelt(3)&&n.push(3),Setting.Smelt(4)&&n.push(4);var i=new net.def.C2SSmelting;return i.setList(n),net.socket.write(25,i.toArrayBuffer()),!0},o=function(t){return e.BagView.instance.page=t,UIManager.openBag(),!0},s=lang.String("prompt title"),l=lang.StringWithFormat("clear bag confirm{1}",Bag.MinRoom4Tip);null!=a&&""!=a&&(l=a),t==Game.BagPage.Equip?i.Show(n.clearbag,s,l,function(){return r(t)},function(){return o(t)},null):i.Show(n.clearpropbag,s,l,function(){return r(t)},function(){return o(t)},null)}e.NotEnoughBagSpace=t;var n;!function(e){e[e["default"]=0]="default",e[e.team=1]="team",e[e.clearbag=2]="clearbag",e[e.reconnect=3]="reconnect",e[e.clearpropbag=4]="clearpropbag",e[e.bufftips=5]="bufftips"}(n=e.ConfirmBoxStyle||(e.ConfirmBoxStyle={})),e.ConfirmBoxLabel=["default","team","clearequipbag","reconnect","clearpropbag","bufftips"];var i=function(t){function n(){var e=t.call(this)||this;return e.skinName="ConfirmBoxSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onAddToStage=function(){""!=this.orgContentMsg&&(this.content.textFlow=Game.TextParser.parse(this.orgContentMsg)),null==this.onOk&&null==this.onCancel?null!=this.btnCancel.parent&&this.btnCancel.parent.removeChild(this.btnCancel):null==this.btnCancel.parent&&this.btnOK.parent.addChildAt(this.btnCancel,0)},n.prototype.onRemoveFromStage=function(){},n.prototype.close=function(){UIManager.pop(this)},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:if(null!=this.closehandle&&!this.closehandle())return;this.close();break;case this.btnClose:if(null!=this.closehandle&&!this.closehandle())return;this.close();break;case this.btnCancel:if(null!=this.onCancel&&!this.onCancel())return;this.close();break;case this.btnOK:if(null!=this.onOk&&!this.onOk())return;this.close()}},n.Show=function(t,n,i,a,r,o){var s=this.instance;s.currentState=e.ConfirmBoxLabel[t],s.title=n,s.orgContentMsg=i,s.onOk=a,s.onCancel=r,s.closehandle=o,UIManager.push(s)},n}(e.FitComponent);e.ConfirmBox=i,__reflect(i.prototype,"UI.ConfirmBox",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.onTouchTap=function(){var t=e.ItemTips.instance;if(null==this.data.forbidTip||!this.data.forbidTip){var n=this.data;t.desc=n.desc,"monthlyTask"==this.data.type?t.data=monthlyactivity.GetTransData(this.data.content.id):t.data=n,t.data.hideAmount=!0,UIManager.push(e.ItemTips.instance)
}},n.prototype.onRefresh=function(){this.dataChanged()},n.getCurrentNumber=function(e){var t=0;switch(e.type){case"item":t=PlayerAttribute.bag.CalcCount(e.content.genre,e.content.detailType);break;case"monthlyTask":t=monthlyactivity.GetTransData(e.content.id).count;break;default:for(var n=0;n<Game.currency2AwardType.length;n++)if(e.type==Game.currency2AwardType[n]){t=PlayerAttribute.currency[n];break}}return t},n.prototype.dataChanged=function(){if(null!=this.data){this.clearcell();var e=this.data,t=0;switch(e.type){case"item":var i=table.props[e.content.genre][e.content.detailType];this.icon=i.source;n.getCurrentNumber(this.data);this.UpdatePiecesIcon(e.content.genre),this.quality=i.quality;var a=table.props[e.content.genre][e.content.detailType].expireTime;null!=a&&(this.timelimit="ui/bag/limit.png"),null!=e.content.rbcolor&&(this.rbcolor=e.content.rbcolor),t=e.content.count;break;case"monthlyTask":var r=monthlyactivity.GetTransData(e.content.id);if(null==r)break;this.icon=r.icon,this.quality=r.quality,t=e.content.count;break;case Game.currency2AwardType[Game.Currency.GoldCoin]:this.icon="icon/item/gold1.png",this.quality=4,t=e.content;break;case Game.currency2AwardType[Game.Currency.SilverCoin]:this.icon="icon/item/gold.png",null!=e.content&&e.content>=1e3?this.quality=4:this.quality=3,t=e.content;break;case Game.currency2AwardType[Game.Currency.CopperCoin]:this.icon="icon/item/coppercoin.png",this.quality=2,t=e.content;break;case Game.currency2AwardType[Game.Currency.Practice]:this.icon="icon/item/lld1.png",this.quality=2,t=e.content;break;case Game.currency2AwardType[Game.Currency.Arena]:this.icon="icon/item/lld2.png",this.quality=4,t=e.content;break;case Game.currency2AwardType[Game.Currency.Reading]:this.icon="icon/item/item_yulidan.png",this.quality=3,t=e.content;break;case Game.currency2AwardType[Game.Currency.Pith]:this.icon="icon/item/ylz.png",this.quality=4,t=e.content;break;case Game.currency2AwardType[Game.Currency.GuildContribution]:this.icon="ui/guild/guild_gongxian.png",this.quality=2,t=e.content;break;case Game.currency2AwardType[Game.Currency.Jade]:this.icon=monthlyactivity.Jade.icon,this.quality=monthlyactivity.Jade.quality,t=e.content}var o=n.getCurrentNumber(this.data);t>o?this.rbcolor=color.ORANGE:(this.rbcolor=color.WHITE,o>999&&(o=999)),this.rbcorner=String(o)+"/"+String(t)}},n.prototype.onRemoveFromStage=function(){this.clearcell()},n.prototype.clearcell=function(){this.icon="",this.quality=null,this.rbcorner="",this.plugin=""},n}(e.Cell);e.CostElementCell=t,__reflect(t.prototype,"UI.CostElementCell")}(UI||(UI={}));var UI;!function(e){var t=(i={},i[Game.Faction.none]=["none","none"],i[Game.Faction.tianwang]=["tw","tianwang"],i[Game.Faction.emei]=["em","emei"],i[Game.Faction.gaibang]=["gb","gaibang"],i[Game.Faction.wudu]=["wu","wudu"],i[Game.Faction.wudang]=["wd","wudang"],i[Game.Faction.shaolin]=["sl","shaolin"],i[Game.Faction.tianren]=["tr","tianren"],i[Game.Faction.tangmen]=["tm","tangmen"],i[Game.Faction.cuiyan]=["cy","cuiyan"],i[Game.Faction.kunlun]=["kl","kunlun"],i[Game.Faction.wuhuntang]=["wht","wuhuntang"],i),n=function(n){function i(){var e=n.call(this)||this;return e.key2button={},e.count=0,e.nameIdx=0,e.step=2,e.second10Tiker=new Ticker(1e3),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.select,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.skinName="CreateRoleSkin",e}return __extends(i,n),i.open=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return t=new e.LoadingIconAnimation,loadingLayer.addChild(t),[4,LoadManager.load("createRole")];case 1:return n.sent(),loadingLayer.removeChild(t),AutoNamed.init(),null==this._instance&&(this._instance=new i),UIManager.set(this._instance),[2]}})})},i.onCreateRoleResult=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(a){switch(a.label){case 0:switch(null==this._instance&&(this._instance=new i),null==this._instance.parent&&UIManager.set(this._instance),t=e.getReason(),n=e.getResult()){case 1:return[3,1]}return[3,3];case 1:return[4,Game.start()];case 2:return a.sent(),UIManager.pop(this._instance),this._instance=null,[3,4];case 3:return this._instance.errorMessage=lang.String(t),[3,4];case 4:return[2]}})})},i.prototype.partAdded=function(e,t){n.prototype.partAdded.call(this,e,t),this.imgBg==t&&(this.imgBg.source=egret.Capabilities.isMobile?"public_bg4.jpg":"public_bg5.jpg")},i.prototype.storyComplete=function(){var e=int(Math.random()*this.count)+1;this.setState(e),this.random()},i.prototype.onClick=function(){if(SoundUtil.initplay(),""!=this.textInput.text){var e=new net.def.C2SCreateRole;e.setName(this.textInput.text);var t=Game.Faction[this.currentState];t||(t=2),e.faction=t,net.socket.write(10,e.toArrayBuffer())}},i.prototype.random=function(){switch(this.currentState){case"tianwang":case"gaibang":case"wudang":case"shaolin":case"tangmen":case"kunlun":case"wuhuntang":this.textInput.text=AutoNamed.randomMale();break;case"emei":case"wudu":case"tianren":case"cuiyan":default:this.textInput.text=AutoNamed.randomFemale()}},i.prototype.setState=function(e){this.currentState!=t[e][1]&&(this.key2button[e].selected=!0,this.currentState=t[e][1],this.animation.load(t[e][0],"st"),this.aniIn.play(0))},i.prototype.select=function(e){var t=e.target;switch(t){case this.enterGame:this.onClick();break;case this.randomName:this.random();break;default:if(!t||!t.value)break;var n=Number(t.value);n&&n>=Game.Faction.tianwang&&n<Game.Faction.count&&this.setState(n)}},i.prototype.onAddToStage=function(){this.key2button[Game.Faction.tianwang]=this.btnTw,this.key2button[Game.Faction.emei]=this.btnEm,this.key2button[Game.Faction.gaibang]=this.btnGb,this.key2button[Game.Faction.wudu]=this.btnWu,this.key2button[Game.Faction.wudang]=this.btnWd,this.key2button[Game.Faction.shaolin]=this.btnSl,this.key2button[Game.Faction.tianren]=this.btnTr,this.key2button[Game.Faction.tangmen]=this.btnTm,this.key2button[Game.Faction.cuiyan]=this.btnCy,this.key2button[Game.Faction.kunlun]=this.btnKl,this.key2button[Game.Faction.wuhuntang]=this.btnWht;for(var e=Game.Faction.start;e<Game.Faction.count;e++)WorldLine.IsFacionOpen(e)?this.count++:Game.removeFromParent.apply(this.key2button[e]);this.scrollName(),this.second10Tiker.addEventListener(this.scrollName,this),this.storyComplete()},i.prototype.onRemoveFromStage=function(){this.second10Tiker.removeEventListener(this.scrollName,this)},i.prototype.scrollName=function(){if(null!=AutoNamed.femaleName){var e=AutoNamed.femaleName.length;this.nameIdx+this.step>=e&&(this.nameIdx=0),0==this.nameIdx?(this.roleName0=AutoNamed.randomScrollName(0),this.roleName1=AutoNamed.randomScrollName(1),this.roleName2=AutoNamed.randomScrollName(2)):(this.roleName0=this.roleName1,this.roleName1=this.roleName2,this.roleName2=AutoNamed.randomScrollName(this.nameIdx+this.step)),this.nameIdx++}},i}(e.FitComponent);e.CreateRole=n,__reflect(n.prototype,"UI.CreateRole",["eui.UIComponent","egret.DisplayObject"]);var i}(UI||(UI={}));var DailyMarkInfo;!function(e){function t(t,n,i){e.index=t,e.signed=n,e.awards=i}function n(){e.index+=1;for(var t=0;t<table.dailyMark.accumulated.length;t++)e.index==table.dailyMark.accumulated[t].days&&null==e.awards[t]&&e.awards.push(!0)}e.awards=[],e.setInfo=t,e.signToday=n}(DailyMarkInfo||(DailyMarkInfo={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;n.markAwards=[],n.skinName="DailyMarkSkin",n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.list.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchList,n);for(var i=0;i<table.dailyMark.accumulated.length;i++){var a=void 0,r=void 0;"item"==table.dailyMark.accumulated[i].type?(r="item",a={genre:table.dailyMark.accumulated[i].content.genre,detailType:table.dailyMark.accumulated[i].content.detailType,count:table.dailyMark.accumulated[i].count}):"currency"==table.dailyMark.accumulated[i].type&&(r=table.dailyMark.accumulated[i].content,a=table.dailyMark.accumulated[i].count),n["accumulated"+i].data={Id:null,award:{type:r,content:a},vip:null},n["day"+i]=table.dailyMark.accumulated[i].days}n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.list.itemRenderer=e.DailyMarkItem,n.accumulativeDays=DailyMarkInfo.index,n.accumulativeDays>=15&&(n.scroller.viewport.scrollV=305);for(var i=0;i<table.dailyMark.daily.length;i++){var a=void 0,r=void 0;"item"==table.dailyMark.daily[i].type?(r="item",a={genre:table.dailyMark.daily[i].content.genre,detailType:table.dailyMark.daily[i].content.detailType,count:table.dailyMark.daily[i].count}):"currency"==table.dailyMark.daily[i].type&&(r=table.dailyMark.daily[i].content,a=table.dailyMark.daily[i].count);var o="next",s=!1;i<DailyMarkInfo.index?s=!0:i==DailyMarkInfo.index&&(DailyMarkInfo.signed?(s=!0,n.accumulativeDays=DailyMarkInfo.index+1):o="now"),n.markAwards.push({Id:i,award:{type:r,content:a},vip:table.dailyMark.daily[i].vip,signed:s,currentState:o})}return n.list.dataProvider=new eui.ArrayCollection(n.markAwards),n.onRefresh(),n}return __extends(n,t),n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.DailyMarkAward,this.onTaskChanged,this),Game.dispatcher.addEventListener(Game.EVENT.DailyMarkResult,this.onRefreshDaily,this),Game.dispatcher.addEventListener(Game.EVENT.AccumMarkResult,this.onRefreshAccum,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.DailyMarkAward,this.onTaskChanged,this),Game.dispatcher.removeEventListener(Game.EVENT.DailyMarkResult,this.onRefreshDaily,this),Game.dispatcher.removeEventListener(Game.EVENT.AccumMarkResult,this.onRefreshAccum,this)},n.calcProgress=function(e){var t=table.dailyMark.accumulated.length;if(e>=table.dailyMark.accumulated[t-1].days)return 4e4;for(var n=0,i=0,a=0;t>a;a++){var r=table.dailyMark.accumulated[a].days-n;if(r>=e){i+=e/r;break}i+=1,n+=r,e-=r}return~~(1e4*i)},n.prototype.onTaskChanged=function(){this.accumulativeDays=DailyMarkInfo.index,this.accumulativeDays>=15&&(this.scroller.viewport.scrollV=305);for(var e=this.markAwards.length,t=0;e>t;t++){var n=this.markAwards[t];n.signed=!1,n.currentState="next",t<DailyMarkInfo.index?n.signed=!0:t==DailyMarkInfo.index&&(DailyMarkInfo.signed?(n.signed=!0,this.accumulativeDays=DailyMarkInfo.index+1):n.currentState="now")}var i=this.list.dataProvider;i.refresh(),this.onRefresh()},n.prototype.onRefresh=function(){this.accumulated0.currentState="next",this.accumulated1.currentState="next",this.accumulated2.currentState="next",this.accumulated3.currentState="next";for(var e=0;e<DailyMarkInfo.awards.length;e++){var t=this["accumulated"+e];DailyMarkInfo.awards[e]?(t.currentState="now",t.signed=!1):t.signed=!0}this.point=n.calcProgress(this.accumulativeDays)},n.prototype.onTouchList=function(){DailyMarkInfo.signed||this.list.selectedItem.Id==DailyMarkInfo.index&&(PlayerAttribute.bag.capacity(Game.BagPage.Prop)>1&&PlayerAttribute.bag.capacity(Game.BagPage.Material)>1?net.socket.write(144,null):PopUpMessage.push(lang.String("bag room full"),color.RED))},n.prototype.onTouchTap=function(e){switch(e.target){case this.accumulated0:this.onAccumMark(0);break;case this.accumulated1:this.onAccumMark(1);break;case this.accumulated2:this.onAccumMark(2);break;case this.accumulated3:this.onAccumMark(3)}},n.prototype.onAccumMark=function(e){if("now"==this["accumulated"+e].currentState)if(PlayerAttribute.bag.capacity(Game.BagPage.Prop)>1&&PlayerAttribute.bag.capacity(Game.BagPage.Material)>1){var t=new net.def.C2SAccumMarkRequest;t.setIndex(e),net.socket.write(145,t.toArrayBuffer())}else PopUpMessage.push(lang.String("bag room full"),color.RED)},n.prototype.onRefreshDaily=function(e){var t=this.markAwards[e.data];if(null!=t){t.currentState="next",t.signed=!0,DailyMarkInfo.signed=!0;var i=this.list.dataProvider;i.refresh()}this.accumulativeDays=DailyMarkInfo.index,this.point=n.calcProgress(this.accumulativeDays);for(var a=0;a<DailyMarkInfo.awards.length;a++)DailyMarkInfo.awards[a]?this["accumulated"+a].currentState="now":this["accumulated"+a].signed=!0},n.prototype.onRefreshAccum=function(e){var t=parseInt(e.data),n=this["accumulated"+t];null!=n&&(n.currentState="next",n.signed=!0,DailyMarkInfo.awards[t]=!1)},n}(eui.Component);e.DailyMark=t,__reflect(t.prototype,"UI.DailyMark",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="DailyMarkItemSkin",t.signed=!1,t.currentState="next",t}return __extends(t,e),t.prototype.dataChanged=function(){null!=this.data&&(this.signed=this.data.signed,this.currentState=this.data.currentState,null!=this.cell&&(this.cell.data=this.data.award,this.cell.onRefresh()),null==table.dailyMark.vipadd||null==this.data.vip||this.data.vip>Vip.VipMaxLevel?(this.bDouble=!1,this.doubleName=null,this.vipIcon=""):(this.bDouble=!0,this.doubleName="x"+table.dailyMark.vipadd,this.vipIcon=Vip.getVipIcon(this.data.vip+1)))},t}(eui.ItemRenderer);e.DailyMarkItem=t,__reflect(t.prototype,"UI.DailyMarkItem")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="DailyTaskSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},t.prototype.close=function(){UIManager.pop(this)},t}(e.FitComponent);e.DailyTask=t,__reflect(t.prototype,"UI.DailyTask",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="DailyTipsItemSkin",t}return __extends(t,e),t.prototype.onAddToStage=function(){},t.prototype.onRemoveFromStage=function(){},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.btnGo.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchEnter,this)},t.prototype.onTouchEnter=function(){this.Enter()},t.prototype.Enter=function(){this.data.operation?Operation.open(this.data.operation):PopUpMessage.push(lang.String("not open yet!"),color.RED)},t}(eui.ItemRenderer);e.DailyTipsItem=t,__reflect(t.prototype,"UI.DailyTipsItem")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="DoubleEggsSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),n.prototype.onAddToStage=function(){this.onUpdate(),this.tab.selectedIndex=0,Game.dispatcher.addEventListener(Game.EVENT.ActivityDoubleEggs,this.onUpdate,this),Game.dispatcher.addEventListener(Game.EVENT.BagItemChange,this.onUpdate,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.ActivityDoubleEggs,this.onUpdate,this),Game.dispatcher.removeEventListener(Game.EVENT.BagItemChange,this.onUpdate,this)},n.prototype.onTouchTap=function(e){e.target},n.prototype.onUpdate=function(){var t=ActivityDoubleEggs._cfg,n=ActivityDoubleEggs._data;if(null!=t&&null!=n){var i=t.challengeToken.award.content,a=t.rewardToken.award.content,r=t.zhanhuoInfo.award.content;this.actDuration=lang.Format("Hoạt động còn: {1}",ActivityDoubleEggs.activity.reaminingTime),this.Item0.data={item:t.challengeToken.award,txt:""+PlayerAttribute.GetItemCount(i.genre,i.detailType)},this.Item1.data={item:t.rewardToken.award,txt:""+PlayerAttribute.GetItemCount(a.genre,a.detailType)},this.Item2.data={item:t.zhanhuoInfo.award,txt:""+PlayerAttribute.GetItemCount(r.genre,r.detailType)},this.buyItem.data={item:t.challengeToken.award,txt:lang.Format("{1}/{2}",n.dailyBuyChanllengeTokenCount,t.challengeToken.dailyMax),OnClick:function(){UIManager.push(e.DoubleEggsBuy.instance)}}}},n}(eui.Component);e.DoubleEggs=t,__reflect(t.prototype,"UI.DoubleEggs",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="DoubleEggsBuySkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.close=function(){null!=this._instance&&UIManager.pop(this._instance)},n.prototype.close=function(){UIManager.pop(this)},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.ActivityDoubleEggs,this.onRefreshUI,this),this.onRefreshUI()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.ActivityDoubleEggs,this.onRefreshUI,this)},n.prototype.onRefreshUI=function(){var e=ActivityDoubleEggs._cfg,t=ActivityDoubleEggs._data;if(null!=e&&null!=t){var n=e.challengeToken.award.content,i=table.props[n.genre][n.detailType];this.itemname.text=i.name,this.itemname.textColor=Item.QualityColor[i.quality],this.itemDesc.textFlow=Game.HtmlTextParser.parse(i.desc),this.price=e.challengeToken.costSilverCoin,this.showcase.icon=i.source,this.showcase.quality=i.quality,this.showcase.rbcorner="1",this.maxCanBuy=e.challengeToken.dailyMax-t.dailyBuyChanllengeTokenCount,this.boxNumer=1,this.currencyIcon=Game.currency2Icon[Game.Currency.SilverCoin],this.canBuyTotalTip="Còn được mua: "+this.maxCanBuy}},n.prototype.onTouchTap=function(t){var n=this;switch(t.target){case this.btnBuy:if(this.boxNumer<=0)return;var i=this.price*this.boxNumer;if(PlayerAttribute.currency[Game.Currency.SilverCoin]<i){var a=new e.SliverCoinPrompt;a.title=lang.String("operation confirm"),a.content=lang.StringWithFormat("if replace {1} silver with gold",i-PlayerAttribute.currency[Game.Currency.SilverCoin]),a.cb=function(e){if(PlayerAttribute.currency[Game.Currency.SilverCoin]+PlayerAttribute.currency[Game.Currency.GoldCoin]<i)return Recharge.openRechargeUI(),void UIManager.pop(a);var t=new net.def.UInt32;t.value=n.boxNumer,net.socket.write(204,t.toArrayBuffer()),UIManager.pop(a)},UIManager.push(a)}else{var r=new net.def.UInt32;r.value=this.boxNumer,net.socket.write(204,r.toArrayBuffer())}break;case this.imgClose:this.close();break;case this.btnMinus:this.boxNumer>0&&(this.boxNumer-=1);break;case this.btnPlus:this.boxNumer<this.maxCanBuy&&(this.boxNumer+=1)}},n}(e.FitComponent);e.DoubleEggsBuy=t,__reflect(t.prototype,"UI.DoubleEggsBuy",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="DoubleEggsGiftItemSkin",n.awards.itemRenderer=e.AwardCell,n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n}return __extends(n,t),n.prototype.dataChanged=function(){null!=this.data.wareId?(this.award.visible=!1,this.ware.visible=!0,this.btnBuy.visible=this.data.canBuy):(this.award.visible=!0,this.ware.visible=!1,this.btnAward.visible=this.data.canBuy);var e=this.awards.dataProvider;null==e?this.awards.dataProvider=new eui.ArrayCollection(this.data.awards):e.replaceAll(this.data.awards),this.imgClose.visible=!this.data.canBuy},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnBuy:null!=this.data.wareId&&Payment.buy(this.data.wareId);break;case this.btnAward:null!=!this.data.wareId&&net.socket.write(202,null)}},n}(eui.ItemRenderer);e.DoubleEggsGiftItem=t,__reflect(t.prototype,"UI.DoubleEggsGiftItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="DoubleEggsGiftViewSkin",n.list.itemRenderer=e.DoubleEggsGiftItem,n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n}return __extends(n,t),n.prototype.onAddToStage=function(){this.onUpdate(),this.scoller.viewport.scrollV=0,Game.dispatcher.addEventListener(Game.EVENT.ActivityDoubleEggs,this.onUpdate,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.ActivityDoubleEggs,this.onUpdate,this)},n.prototype.getConfig=function(e){return Account.isApp?e[1]:e[0]},n.prototype.onUpdate=function(){var e=ActivityDoubleEggs._cfg,t=ActivityDoubleEggs._data,n=ActivityDoubleEggs._buyRecord;if(null!=e&&null!=t&&null!=n){var i=0==t.buyedChallengeCard,a=0==t.dailyGetedChallengeCardAward;badge.onLight(badge.action.DoubleEggsCardAwad,a);var r=[],o=this.getConfig(e.challengeCard.ware);for(var s in o){var l=o[s];r.push({wareId:i?s:null,name:l.name,canBuy:i||a,vnd:i?l.vnd+" VND":"",awards:i?l.awards:e.challengeCard.awards,backdrop:l.backdrop})}o=this.getConfig(e.giftPakage);for(var s in o){var l=o[s];r.push({wareId:s,name:l.name,canBuy:!n[s],vnd:l.vnd+" VND",awards:l.awards,backdrop:l.backdrop})}var u=this.list.dataProvider;null==u?this.list.dataProvider=new eui.ArrayCollection(r):u.replaceAll(r)}},n}(eui.Component);e.DoubleEggsGiftView=t,__reflect(t.prototype,"UI.DoubleEggsGiftView",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="DoubleEggsSceneItemSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.OnAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.OnRemoveFromStage,t),t}return __extends(t,e),t.prototype.OnAddToStage=function(){this.dataChanged(),this.btnGo.addEventListener(egret.TouchEvent.TOUCH_TAP,this.Go,this),Game.dispatcher.addEventListener(Game.EVENT.OnUpdateFp,this.dataChanged,this),Game.dispatcher.addEventListener(Game.EVENT.LevelUp,this.dataChanged,this)},t.prototype.OnRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.OnUpdateFp,this.dataChanged,this),Game.dispatcher.removeEventListener(Game.EVENT.LevelUp,this.dataChanged,this)},t.prototype.dataChanged=function(){if(null!=this.data){var e=ActivityDoubleEggs._cfg,t=ActivityDoubleEggs._data;null!=e&&null!=t&&(0==t.curGroupDungeonGroupType?this.btnGo.enabled=this.data.groupType==e.groupDungeonGroupTypeStart:this.btnGo.enabled=this.data.groupType<=t.curGroupDungeonGroupType+1,this.lableNeedFp.text=this.data.needFp.toString(),this.labelNeedLv.text=this.data.needLv.toString(),this.lableNeedFp.textColor=PlayerAttribute.fp>=this.data.needFp?color.GREEN:color.RED,this.labelNeedLv.textColor=PlayerAttribute.Level>=this.data.needLv?color.GREEN:color.RED,this.awardList.dataProvider=new eui.ArrayCollection(this.data.awardView),this.needList.dataProvider=new eui.ArrayCollection(this.data.needItemOwner))}},t.prototype.Go=function(){DungeonGroup.Try2CreateGroup(this.data.groupType)},t}(eui.ItemRenderer);e.DoubleEggsSceneItem=t,__reflect(t.prototype,"UI.DoubleEggsSceneItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="DoubleEggsSceneViewSkin",n.list.itemRenderer=e.DoubleEggsSceneItem,n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n}return __extends(n,t),n.prototype.onAddToStage=function(){this.onUpdate(),Game.dispatcher.addEventListener(Game.EVENT.ActivityDoubleEggs,this.onUpdate,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.ActivityDoubleEggs,this.onUpdate,this)},n.prototype.onUpdate=function(){if(null!=ActivityDoubleEggs._cfg){this.scoller.viewport.scrollV=0;var e=DungeonGroup.GetDungeonGroupInfo(ActivityDoubleEggs._cfg.groupDungeonLevel),t=this.list.dataProvider;null==t?this.list.dataProvider=new eui.ArrayCollection(e):t.replaceAll(e)}},n}(eui.Component);e.DoubleEggsSceneView=t,__reflect(t.prototype,"UI.DoubleEggsSceneView",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="DoubleEggsShopViewSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.prototype.makeGoods=function(){if(null!=ActivityDoubleEggs._goods){var e=this.list.dataProvider;null==e?this.list.dataProvider=new eui.ArrayCollection(ActivityDoubleEggs._goods):e.replaceAll(ActivityDoubleEggs._goods)}},t.prototype.onAddToStage=function(){this.makeGoods(),Game.dispatcher.addEventListener(Game.EVENT.ActivityDoubleEggs,this.makeGoods,this)},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.ActivityDoubleEggs,this.makeGoods,this)},t}(eui.Component);e.DoubleEggsShopView=t,__reflect(t.prototype,"UI.DoubleEggsShopView",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.armatureName="",t.speed=1,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(){this.loader&&this.loader.url||this.armatureName&&this.reload()},t.prototype.onRemoveFromStage=function(){this.unload()},Object.defineProperty(t.prototype,"scaleX",{get:function(){return this.$getScaleX()},set:function(e){this.armatureDisplay&&(this.armatureDisplay.scaleX=e),this.$setScaleX(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleY",{get:function(){return this.$getScaleY()},set:function(e){this.armatureDisplay&&(this.armatureDisplay.scaleY=e),this.$setScaleY(e)},enumerable:!0,configurable:!0}),t.prototype.onResize=function(){null!=this.armatureDisplay&&this.updatePosition()},t.prototype.updateSize=function(){this.armatureDisplay.scaleX=this.scaleX,this.armatureDisplay.scaleY=this.scaleY},t.prototype.updateSpeed=function(e){this.speed=e},t.prototype.updatePosition=function(){this.armatureDisplay&&this.updateSize()},t.prototype.unload=function(){this.armatureDisplay&&(this.removeChild(this.armatureDisplay),this.armatureDisplay.dispose(),this.armatureDisplay=null),this.loader&&this.loader.release()},t.prototype.reload=function(){var e=this,t=this.armatureName;this.loader||(this.loader=new RES.Loader),this.loader.get("dbbin/"+t+"/"+t+"_ske.dbbin",function(n){e.armatureDisplay=n.buildArmatureDisplay("Armature",t),e.updatePosition(),e.addChild(e.armatureDisplay),e.armatureDisplay.animation.timeScale=e.speed,e.armatureDisplay.animation.play(e.animationName,0)},1)},t.prototype.load=function(e,t){if(e){if(this.armatureName==e)return void(this.animationName!=t&&(this.animationName=t,this.armatureDisplay&&(this.armatureDisplay.animation.timeScale=this.speed,this.armatureDisplay.animation.play(this.animationName,0))));this.unload(),this.armatureName=e,this.animationName=t,this.reload()}},t}(eui.Component);e.DragonBoneComponent=t,__reflect(t.prototype,"UI.DragonBoneComponent",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var EnhancementRequire;!function(e){function t(){null==e.require&&(e.require={});for(var t=WorldLine.GetMaxStrengthLevel(),n=!1,i=0;i<Game.EquipPart.EquipCount;i++){var a=PlayerAttribute.enhancement[i];if(!(a>=t&&1!=a||a>=PlayerAttribute.Level+e.enhanceLevelAdd)){var r=table.enhanceCost[a],s=r.crystal,l=e.crystal[s]||0,u=o(i),c=u*r.count||0,h=u*r.coppercoin||0;e.require[i]={crystal:c,copperCoin:h,enoughCrystal:l>=c,enoughCopperCoin:PlayerAttribute.currency[Game.Currency.CopperCoin]>=h},e.require[i].enoughCrystal&&e.require[i].enoughCopperCoin&&(n=!0)}}badge.onLight(badge.action.Enhance,n),Game.dispatcher.dispatchEventWith(Game.EVENT.EnhanceRequireChange)}function n(){null!=e.require&&t()}function i(){for(var n=1;9>=n;n++){var i=table.enhanceconvert[n],a=PlayerAttribute.bag.getCount(4,n);e.crystal[n]=a+~~(e.crystal[n-1]/i)}t()}function a(){Game.dispatcher.addEventListener(Game.EVENT.AddItem,r,this,!1,255),Game.dispatcher.addEventListener(Game.EVENT.RemoveItem,r,this,!1,255),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,r,this,!1,255),Game.dispatcher.addEventListener(Game.EVENT.BagItemChange,i,this,!1,255),Game.dispatcher.addEventListener(Game.EVENT.CurrencyChange[Game.Currency.CopperCoin],n,this,!1,255)}function r(e){var t=e.data;4==t.Item.Type&&i()}function o(e){return e==Game.EquipPart.EquipArmor||e==Game.EquipPart.EquipWeapon?2:1}e.enhanceLevelAdd=10,e.crystal={0:0},e.onResetRequire=MakeDelayExecute(t,null,100),e.resetRequire=t,e.updateCurrency=n,e.updateCrystalCount=i,e.load=a,e.getMultiple=o}(EnhancementRequire||(EnhancementRequire={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;n.skinName="EnhancementSkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.mc=[];for(var i=0;i<Game.EquipPart.EquipCount;i++){var a=new e.MovieClipComponent;a.removeWhenComplete=!1,a.position="TL",a.x=47+420*(i%2),a.y=173+92*~~(i/2),n.mc.push(a),a.visible=!1}return n}return __extends(n,t),n.prototype.onItemChange=function(e){var t=e.data;4==t.Item.Type&&this.onCrystalChange()},n.prototype.onCrystalChange=function(){var e=this.selectedPart,t=PlayerAttribute.enhancement[e];t<table.enhanceCost.length&&(PlayerAttribute.Level+EnhancementRequire.enhanceLevelAdd<=t?this.HaveLevel.text=lang.String("enhancement player level fail"):EnhancementRequire.require[e].enoughCrystal?EnhancementRequire.require[e].enoughCopperCoin?this.HaveLevel.text="":this.HaveLevel.text=lang.String("not enough copperCoin"):this.HaveLevel.text=lang.String("Crystal not enough"),this.updateCrystal(e,t))},n.prototype.onAddToStage=function(){this.AutoSelectEquip(),this.onDataChange(),Game.dispatcher.addEventListener(Game.EVENT.EnhanceSuccess,this.onSuccess,this),Game.dispatcher.addEventListener(Game.EVENT.EnhanceRequireChange,this.onCurrencyChanged,this),Game.dispatcher.addEventListener(Game.EVENT.EnhanceRequireChange,this.onCrystalChange,this),guide.addEventListener(guide.GuideOperation.GuideEnhancement,this.onGuideReminder,this),guide.completed()||this.playGuideMovie(guide.info.operation)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.EnhanceSuccess,this.onSuccess,this),Game.dispatcher.removeEventListener(Game.EVENT.EnhanceRequireChange,this.onCurrencyChanged,this),Game.dispatcher.removeEventListener(Game.EVENT.EnhanceRequireChange,this.onCrystalChange,this),guide.removeEventListener(guide.GuideOperation.GuideEnhancement,this.onGuideReminder,this),this.stopAutoEnhance(),this.selectedPart=null},n.prototype.stopAutoEnhance=function(){this.enhancing=!1,null!=this.timer&&(egret.clearTimeout(this.timer),this.timer=null);for(var e=0;e<Game.EquipPart.EquipCount;e++){var t=this.mc[e];t.visible=!1,t.free()}},n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);for(var e=0;e<Game.EquipPart.EquipCount;e++)this.addChild(this.mc[e])},n.prototype.onSuccess=function(e){this.enhancing&&null==this.timer&&(this.timer=egret.setTimeout(this.autoEnhance,this,300));var t=e.data,n=this.mc[t];n.Load("skill/Ui_qianghua01/Ui_qianghua01.json","Ui_qianghua01"),n.gotoAndPlay(0,1),n.visible=!0,this.selectedPart=null,this.AutoSelectEquip(),t!=this.selectedPart&&this.onDataChange()},n.compare=function(e,t){return e.weight!=t.weight?t.weight-e.weight:e.enhancement==t.enhancement?e.part-t.part:e.enhancement-t.enhancement},n.prototype.AutoSelectEquip=function(){if(null==this.selectedPart){for(var e=[],t=0;t<Game.EquipPart.EquipCount;t++)if(null!=PlayerAttribute.Equips[t]&&PlayerAttribute.enhancement[t]<PlayerAttribute.Level+EnhancementRequire.enhanceLevelAdd){var i=EnhancementRequire.require[t],a=i.enoughCopperCoin&&i.enoughCrystal?1:0;
e.push({enhancement:PlayerAttribute.enhancement[t],part:t,weight:a})}e.sort(n.compare),e.length<=0?this.selectedPart=Game.EquipPart.EquipWeapon:this.selectedPart=e[0].part}PlayerAttribute.Equips[this.selectedPart]},n.prototype.updateAttributeName=function(e,t){0==t&&(t=1);var n=table.enhancement[e][t-1].buffs[0][0];return Buff.GetName(n)},n.prototype.onCurrencyChanged=function(){var e=this.selectedPart,t=PlayerAttribute.enhancement[e];t<table.enhanceCost.length&&(PlayerAttribute.Level<=t+EnhancementRequire.enhanceLevelAdd?this.HaveLevel.text=lang.String("enhancement player level fail"):EnhancementRequire.require[e].enoughCrystal?EnhancementRequire.require[e].enoughCopperCoin?this.HaveLevel.text="":this.HaveLevel.text=lang.String("not enough copperCoin"):this.HaveLevel.text=lang.String("Crystal not enough"),this.updateCurrency(e))},n.prototype.updateCurrency=function(e){var t=EnhancementRequire.require[e].copperCoin;this.MeltingInfo=lang.StringWithFormat("cost copperCoin");var n=PlayerAttribute.currency[Game.Currency.CopperCoin];n>=t?this.HaveMelting.textFlow=Game.HtmlTextParser.parse('<font color="#09e118">'+PlayerAttribute.currencyTxt[Game.Currency.CopperCoin]+"</font>"):this.HaveMelting.textFlow=Game.HtmlTextParser.parse('<font color="#f01616">'+PlayerAttribute.currencyTxt[Game.Currency.CopperCoin]+"</font>"),this.NeedMelting="/ "+t+" "},n.prototype.updateCrystal=function(e,t){var n=table.enhanceCost[t].crystal,i=EnhancementRequire.require[e].crystal,a=EnhancementRequire.crystal[n]||0,r=table.props[4][n];this.crystalCell.icon=r.source,this.crystalCell.quality=r.quality,this.GemLevel=lang.StringWithFormat("Crystal Level{1}",n),this.NeedGemCount="/ "+i,a>=i?this.HaveGemCount.textFlow=Game.HtmlTextParser.parse('<font color="#09e118">'+a+"</font>"):this.HaveGemCount.textFlow=Game.HtmlTextParser.parse('<font color="#f01616">'+a+"</font>")},n.prototype.onDataChange=function(){var e=this.selectedPart,t=PlayerAttribute.enhancement[e];this.HaveLevel.text="",this.AttributeName=this.updateAttributeName(e,t),0>=t?this.CurValue="+0":this.CurValue="+"+table.enhancement[e][t-1].buffs[0][1],t<table.enhancement[e].length?this.NextValue="+"+table.enhancement[e][t].buffs[0][1]:this.NextValue=lang.String("Max Level");EnhancementRequire.getMultiple(e);t<table.enhanceCost.length?(PlayerAttribute.Level+EnhancementRequire.enhanceLevelAdd<=t?this.HaveLevel.text=lang.String("enhancement player level fail"):EnhancementRequire.require[e].enoughCrystal?EnhancementRequire.require[e].enoughCopperCoin?this.HaveLevel.text="":this.HaveLevel.text=lang.String("not enough copperCoin"):this.HaveLevel.text=lang.String("Crystal not enough"),this.updateCrystal(e,t),this.updateCurrency(e)):(this.GemLevel="",this.NeedGemCount="",this.HaveGemCount.text="",this.MeltingInfo="",this.NeedMelting="",this.HaveMelting.text="",this.HaveLevel.text=""),this.totalPower=PlayerAttribute.getEnhancementFP();for(var n=0,i=WorldLine.GetMaxStrengthLevel(),a=0;a<Game.EquipPart.EquipCount;a++){var r=PlayerAttribute.enhancement[a];r&&r>=i&&n++}this.btnEnhance.enabled=n!=Game.EquipPart.EquipCount,this.enhancing&&(this.enhancing=this.btnEnhance.enabled)},n.prototype.getEnhancePower=function(){for(var e=0,t=0;t<PlayerAttribute.enhancement.length;t++){var n=PlayerAttribute.enhancement[t];n>0&&(e+=table.enhancement[t][n-1].power)}return e},n.prototype.onTouchTap=function(t){if(t.target instanceof e.EquipCell){this.selectedPart=t.target.data.part;PlayerAttribute.Equips[this.selectedPart];return void this.onDataChange()}switch(t.target){case this.btnEnhance:if(this.enhancing=!0,null!=this.timer&&(egret.clearTimeout(this.timer),this.timer=null),!EnhancementRequire.require[this.selectedPart].enoughCrystal)return e.ResourceObtain.Open([e.ObtResId.crystal]),void badge.onLight(badge.action.Enhance,!1);if(!EnhancementRequire.require[this.selectedPart].enoughCopperCoin)return e.ResourceObtain.Open([e.ObtResId.CopperCoin]),void badge.onLight(badge.action.Enhance,!1);this.autoEnhance();break;case this.btnGainRes:e.ResourceObtain.Open([e.ObtResId.crystal]);break;case this.btnEnhanceInfo:var n=new e.EnhancementInfo;UIManager.pushPage(n)}},n.prototype.onAutoChange=function(){this.enhancing=!1},n.prototype.autoEnhance=function(){var e=this.selectedPart;this.selectedPart=null,this.AutoSelectEquip(),e!=this.selectedPart&&this.onDataChange(),this.enhance(),this.timer=null},n.prototype.enhance=function(){var e=this.selectedPart;if(null==PlayerAttribute.Equips[e])return void badge.onLight(badge.action.Enhance,!1);if(PlayerAttribute.enhancement[e]>=PlayerAttribute.Level+EnhancementRequire.enhanceLevelAdd)return void badge.onLight(badge.action.Enhance,!1);if(!EnhancementRequire.require[e].enoughCrystal)return void badge.onLight(badge.action.Enhance,!1);if(!EnhancementRequire.require[e].enoughCopperCoin)return void badge.onLight(badge.action.Enhance,!1);var t=new net.def.C2SEnhance;t.setPart(this.selectedPart),net.socket.write(22,t.toArrayBuffer())},n.prototype.onGuideReminder=function(){var e=this;if(this.visible){var t=guide.info.operation;t==guide.GuideOperation.GuideEnhancement&&guide.pushMovie({weight:1,handle:function(){guide.AddMovieClip(e.btnEnhance)}})}},n.prototype.playGuideMovie=function(e){e==guide.GuideOperation.GuideEnhancement&&guide.AddMovieClip(this.btnEnhance)},n.priority={4:0,5:1,6:2,7:3,0:4,1:5,2:6,3:7},n}(eui.Component);e.Enhancement=t,__reflect(t.prototype,"UI.Enhancement",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="EnhancementInfoSkin",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this);for(var t=PlayerAttribute.getEnhanceExtraLevel(),n=table.enhancement[Game.EquipPart.EquipCount],i=0,a=n.length-1;a>=0;a--)if(t>=n[a].level){i=n[a].power,this.updateExtra(a);break}},t.prototype.close=function(){UIManager.pop(this)},t.prototype.updateExtra=function(e){var t=table.enhancement[Game.EquipPart.EquipCount];0==e?(this.txtExtraAttribTitle1=lang.String("Enhance_Extra_Title_NoActive"),this.txtExtraAttribTitle2=lang.StringWithFormat("minimal enhance level{1} effect",t[e+1].level)):e==t.length-1?(this.txtExtraAttribTitle1=lang.StringWithFormat("minimal enhance level{1} effect",t[e].level),this.txtExtraAttribTitle2=lang.String("Enhance_Extra_Title_Max")):(this.txtExtraAttribTitle1=lang.StringWithFormat("minimal enhance level{1} effect",t[e].level),this.txtExtraAttribTitle2=lang.StringWithFormat("minimal enhance level{1} effect",t[e+1].level));for(var n=t[e].buffs,i=0;i<n.length;i++){var a=n[i][0],r=n[i][1];switch(a){case 1:this.Attack="+"+r;break;case 17:this.Life="+"+r;break;case 7:this.Defense="+"+r}}if(e+1<t.length)for(var o=t[e+1].buffs,i=0;i<o.length;i++){var a=o[i][0],r=o[i][1];switch(a){case 1:this.NextAttack="+"+r;break;case 17:this.NextLife="+"+r;break;case 7:this.NextDefense="+"+r}}else this.NextAttack=lang.String("Max Level"),this.NextLife=lang.String("Max Level"),this.NextDefense=lang.String("Max Level")},t}(e.FitComponent);e.EnhancementInfo=t,__reflect(t.prototype,"UI.EnhancementInfo",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var LoadManager;!function(e){function t(){return __awaiter(this,void 0,void 0,function(){var t,n,i,a,r,o,s,l,u,c;return __generator(this,function(h){switch(h.label){case 0:return[4,RES.getRes("preload.json")];case 1:t=h.sent(),n=[];for(i in t)n.push(i);a=0,h.label=2;case 2:if(!(a<n.length))return[3,7];if(r=n[a],o=t[r],null==o.files&&(o.files=[]),s=void 0,null!=o.option)for(l=o.option.length,u=0;l>u;u++)s=o.option[u],RES.hasRes(s)&&o.files.push(s);return s=o.replaceable,null==o.replaceable?[3,5]:RES.hasRes(s)?(o.files.push(s),[3,5]):[3,3];case 3:return[4,RES.getResAsync("replace.json")];case 4:c=h.sent(),o.files=o.files.concat(c[s]),h.label=5;case 5:e.groups[r]=RES.createGroup(r,o.files),h.label=6;case 6:return a++,[3,2];case 7:return[2]}})})}function n(t,n){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(a){switch(a.label){case 0:return e.groups[t]?RES.isGroupLoaded(t)?[2]:(i=RES.loadGroup(t,0,n),"config"==t&&(e.loaded[t]=i),[4,i]):[2];case 1:return a.sent(),[2]}})})}e.loaded=egret.createMap(),e.groups=egret.createMap(),e.init=t,e.load=n}(LoadManager||(LoadManager={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="EquipCompareSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.open=function(e){null==this._instance&&(this._instance=new n),this._instance.otherEquip=e;var t=e.Part,i=PlayerAttribute.Equips[t];this._instance.body.update({type:"equipInstance",content:i},{enhancement:PlayerAttribute.enhancement[t],gems:PlayerGem.gems[t],refineLevel:Refine.levels[t]}),this._instance.other.update({type:"equipInstance",content:e});var a=!1;return i.Level>=SwapAttribute.MinLevel&&e.Level>=SwapAttribute.MinLevel&&i.Quality>=e.Quality&&(a=!0),this._instance.btnSwap.enabled=a,UIManager.pushPage(this._instance),this._instance},n.prototype.onUse=function(){this.otherEquip.Usable&&(this.otherEquip.Use(),UIManager.pop(this))},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close();break;case this.btnUse:this.onUse();break;case this.btnSwap:this.openSwapAttribute()}},n.prototype.close=function(){UIManager.pop(this)},n.prototype.openSwapAttribute=function(){e.Forge.instance.changePage(2);var t=this.otherEquip;e.Forge.instance.setSwapEquips(t.Part,{Id:t.BagId,Item:t}),UIManager.openForge(),UIManager.pop(this)},n}(e.FitComponent);e.EquipCompare=t,__reflect(t.prototype,"UI.EquipCompare",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="EquipTipsSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),n.open=function(e,t,i,a,r,o){return null==this._instance&&(this._instance=new n),this._instance.equip=t,this._instance.currentState=e,this._instance.info.update({type:"equipInstance",content:t},{enhancement:i,gems:a,equips:r,refineLevel:o}),UIManager.push(this._instance),this._instance},n.close=function(){null!=this._instance&&UIManager.pop(this._instance)},n.prototype.onRemoveFromStage=function(){this.equip=null},n.prototype.onSendChat=function(){var e=this.equip;null!=e&&ChatMsg.makeChatMsg_Equip(e)},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnSendChat:this.onSendChat();break;case this.btnGoEnhance:e.Forge.instance.selectpart=this.equip.Part,e.Forge.instance.changePage(0),UIManager.pop(this),UIManager.openForge();break;case this.btnGem:e.Forge.instance.selectpart=this.equip.Part,e.Forge.instance.changePage(1),UIManager.pop(this),UIManager.openForge();break;case this.imgClose:n.close()}},n}(e.FitComponent);e.EquipTips=t,__reflect(t.prototype,"UI.EquipTips",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="EquipUseSkin",e.timer=new egret.Timer(6e3,1),e.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,e.timerComFunc,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},n.prototype.onAddToStage=function(){this.timer.start(),this.refresh()},n.prototype.onRemoveFromStage=function(){this.timer.reset(),this.imgCell.clearBagcell(),this.goodsName.text="",this.itemUse=null},n.prototype.onTouchTap=function(e){this.onClickUse()},n.prototype.onClickUse=function(){null!=this.itemUse&&PlayerAttribute.AutoEquip(),badge.onLight(badge.action.AutoEquip,!1),this.closehandle()},n.prototype.onAddItem=function(t){var n=t.data;if(0==n.Item.Type){if(null==this.parent&&1==this.equipPush(n))return void UIManager.pushPage(e.EquipUse.instance);this.refresh()}},n.prototype.refresh=function(){return null==this.itemUse?void this.closehandle():0==PlayerAttribute.bag.findItembyId(this.itemUse.Id)?void this.closehandle():(this.goodsName.textFlow=Game.HtmlTextParser.parse(this.itemUse.Item.Name),void this.imgCell.setItem(0,this.itemUse.Item.Icon,1,this.itemUse.Item.Quality))},n.prototype.timerComFunc=function(){this.closehandle()},n.prototype.closehandle=function(){this.parent.removeChild(this)},n.prototype.equipPush=function(e){if(1==World.mapId)return!1;var t=e.Item;return 0==PlayerAttribute.checkEquipLimit(t)?!1:Setting.AutoSellEquip()&&Setting.Smelt(t.Quality)?!1:1==this.compareEquippower(t)?(badge.onLight(badge.action.AutoEquip,!0),this.itemUse=e,!0):!1},n.prototype.compareEquippower=function(e){var t=(Player.instance,e.Part),n=PlayerAttribute.Equips[t];return null==n||PlayerAttribute.CompareBetterEquip(n,e)>0?!0:!1},n}(e.FitComponent);e.EquipUse=t,__reflect(t.prototype,"UI.EquipUse",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),eui.Binding.bindProperty(t,["d","Exp"],t,"value"),eui.Binding.bindProperty(t,["d","MaxExp"],t,"maximum"),eui.Binding.bindHandler(t,["d","Exp"],t.onExpChanged,t),eui.Binding.bindHandler(t,["d","MaxExp"],t.onExpChanged,t),t.skinName="ExpBarSkin",t}return __extends(t,e),t.prototype.onAddToStage=function(){this.d=PlayerAttribute,this.maximum=this.d.MaxExp,this.value=this.d.Exp},t.prototype.onRemoveFromStage=function(){this.d=null},t.prototype.valueToLabel=function(e,t){return PlayerAttribute.Level>=WorldLine.GetMaxRoleLevel()?"0/0":e+" / "+t},t.prototype.onExpChanged=function(){var e=this.d;return null==e?void(this.expPercent="0%"):void(this.expPercent=Math.floor(1e4*e.Exp/e.MaxExp)/100+"%")},t}(eui.ProgressBar);e.ExpBar=t,__reflect(t.prototype,"UI.ExpBar")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.FightingPower="",t}return __extends(t,e),t}(eui.Component);e.FightingPowerTemp=t,__reflect(t.prototype,"UI.FightingPowerTemp",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="FirstPassLittleBossSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.open=function(e){var n=new t;n.setNewMap(e),UIManager.push(n)},t.prototype.onAddToStage=function(){this.sl.play(0),this.sl.addEventListener(egret.Event.COMPLETE,this.onTweenGroupComplete,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTweenGroupComplete,this)},t.prototype.onTweenGroupComplete=function(){this.sl.stop(),UIManager.pop(this)},t.prototype.setNewMap=function(e){var t=table.maps[e].level;this.currentState="level"+t},t}(e.FitComponent);e.FirstPassLittleBoss=t,__reflect(t.prototype,"UI.FirstPassLittleBoss",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.ain.addEventListener("itemComplete",this.onTweenGroupItemComplete,this)},t.prototype.onTweenGroupItemComplete=function(e){var t=e.data;switch(t.target){case this.group:this.DataRefresh();break;case this.group0:this.touchChildren=!0}},t.prototype.onAddToStage=function(){this.touchChildren=!0,this.currentState="question"},t.prototype.onRemoveFromStage=function(){},t.prototype.OnRefresh=function(){this.touchChildren=!1,this.ain.play(0)},t.prototype.CanAward=function(){return null==this.data?!0:!1},t.prototype.CostRefresh=function(){this.costImage.source="",this.costImage.scaleX=this.costImage.scaleY=0;var e=this.cost;if(null==e)return void(this.costTip.text="Miễn phí");switch(e.type){case 3:var t=e.params[0],n=Game.currency2Icon[t];n&&""!=n?(this.costImage.source=n,this.costImage.scaleX=this.costImage.scaleY=.6,this.costTip.textFlow=Game.TextParser.parse("<font color='"+color.GoldCoin+"'>"+e.params[1]+"</font>")):this.costTip.textFlow=Game.TextParser.parse("<font color='"+color.GoldCoin+"'>"+Game.currency2AwardType[e.params[0]]+"x"+e.params[1]+"</font>");break;case 1:var i=table.props[e.params[0]][e.params[1]],a=egret.toColorString(Item.QualityColor[i.quality]);this.costTip.textFlow=Game.TextParser.parse("<font color='"+a+"'>"+i.name+"x"+e.params[2]+"</font>");break;default:egret.error("flopaward unkown cost type: "+e.type)}},t.prototype.DataRefresh=function(){return null==this.data?void(this.currentState="question"):(this.currentState="award",this.cell.data=this.data,void(this.itemname.textFlow=Game.TextParser.parse(this.cell.AwardDesc)))},t}(eui.ItemRenderer);e.FlopAwardCell=t,__reflect(t.prototype,"UI.FlopAwardCell")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(e){var n=t.call(this)||this;return n.name=e,n.skinName="FlopAwardSkin",n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n}return __extends(n,t),n.prototype.close=function(){UIManager.pop(this),flopaward.OnPageClose(this.name)},n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.tweenCells.addEventListener("complete",this.onTweenGroupComplete,this)},n.prototype.onTweenGroupComplete=function(){this.refreshCostTip(-1),this.group.touchChildren=!0},n.prototype.onAddToStage=function(){this.curIdx=0,this.remain=flopaward.flopData[this.name].CountDown,this.tip.visible=!1,this.btnOK.enabled=!1,this.group.touchChildren=!1,Game.dispatcher.addEventListener(Game.EVENT.FlopAwardChange,this.OnAwardChange,this),SecondTicker.addEventListener(this.onTimer,this),this.tweenCells.play(0)},n.prototype.onRemoveFromStage=function(){SecondTicker.removeEventListener(this.onTimer,this),Game.dispatcher.removeEventListener(Game.EVENT.FlopAwardChange,this.OnAwardChange,this)},n.prototype.onTimer=function(){this.remain>0&&(this.remain<=flopaward.flopData[this.name].CloseEnable&&(this.btnOK.enabled=!0),this.remain--,this.lastTime=lang.Format("{1}s",this.remain))},n.prototype.OnAwardChange=function(e){var t=e.data.name;this.name==t&&(this.curIdx++,this.refreshCostTip(e.data.index),this.showCell(e.data.index),this.group.touchChildren=!0)},n.prototype.showCell=function(e){var t=this.group.getChildAt(e);t.data=table.parseAward(flopaward.flopData[this.name].Awards[e][0]),t.OnRefresh()},n.prototype.getCost=function(){if(this.curIdx>=this.group.numChildren)return null;var e=this.group.numChildren,t=flopaward.flopData[this.name].Costs.length;if(t>e)return egret.error("flopaward cost items > cells"),null;if(t==e)return flopaward.flopData[this.name].Costs[this.curIdx];var n=e-t;return this.curIdx<n?null:flopaward.flopData[this.name].Costs[this.curIdx-n]},n.prototype.refreshCostTip=function(e){var t=this.getCost();this.tip.visible=null!=t&&null!=t.params&&t.params.length>0&&null!=t.type&&3==t.type&&t.params[0]==Game.Currency.SilverCoin;for(var n=0;n<this.group.numChildren;n++)if(null==e||e!=n){var i=this.group.getChildAt(n);i.cost=t,i.CostRefresh()}},n.prototype.checkCost=function(){var e=this.getCost();if(null==e)return!0;switch(e.type){case 3:var t=e.params[0];switch(t){case Game.Currency.SilverCoin:if(PlayerAttribute.currency[Game.Currency.GoldCoin]+PlayerAttribute.currency[Game.Currency.SilverCoin]<e.params[1])return Recharge.openRechargeUI(),PopUpMessage.push(lang.String("not enough silvercoin"),color.RED),!1;break;case Game.Currency.GoldCoin:if(PlayerAttribute.currency[Game.Currency.GoldCoin]<e.params[1])return Recharge.openRechargeUI(),PopUpMessage.push(lang.String("not enough goldcoin"),color.RED),!1;break;default:if(PlayerAttribute.currency[t]<e.params[1])return PopUpMessage.push(lang.StringWithFormat("not enough {1}",lang.String(Game.currency2AwardType[t])),color.RED),!1}return!0;case 1:var n=e.params;if(PlayerAttribute.bag.CalcCount(n[0],n[1])<n[2]){var i=table.props[n[0]][n[1]];return PopUpMessage.push(lang.StringWithFormat("item {1} not enough",i.name),color.RED),!1}return!0;default:return egret.error("flopaward unkown cost type: "+e.type),!1}},n.prototype.onTouchTap=function(t){if(null!=t.target.parent&&t.target.parent.parent instanceof e.FlopAwardCell){var n=t.target.parent.parent;if(this.remain<=0)return void PopUpMessage.push(lang.String("flopaward countdown over"),color.RED);var i=n;if(!i.CanAward())return;if(!this.checkCost())return;var a=this.group.getChildIndex(n),r=new net.def.FlopAward;return r.setValue(a),r.setName(this.name),net.socket.write(107,r.toArrayBuffer()),this.group.touchChildren=!1,void(this.btnOK.enabled=!0)}switch(t.target){case this.btnOK:this.close()}},n}(e.FitComponent);e.FlopAwardUI=t,__reflect(t.prototype,"UI.FlopAwardUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="ForgeSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.Close=function(){null!=this._instance&&UIManager.pop(this._instance)},n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.tab.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this)},n.prototype.onAddToStage=function(){switch(null==this.page&&this.changePage(0),this.page){case 0:null!=this.selectpart&&(this.Enhancement.selectedPart=this.selectpart);break;case 1:null!=this.selectpart&&this.GemMount.setSelectedPart(this.selectpart);break;case 2:null!=this.selectpart&&(this.SwapAttribute.selectedPart=this.selectpart,this.SwapAttribute.alternateItem=this.alternateItem)}},n.prototype.setPage=function(t){switch(this.page=t,t){case 0:this.viewPage=0;break;case 1:this.viewPage=1;break;case 2:PlayerAttribute.Level<SwapAttribute.MinLevel?(PopUpMessage.push(lang.StringWithFormat("unlock:level{1}",SwapAttribute.MinLevel),color.RED),this.page=this.viewPage):this.viewPage=2;break;case 3:PlayerAttribute.Level<Refine.openLevel?PopUpMessage.push(lang.StringWithFormat("unlock:level{1}",Refine.openLevel),color.RED):(UIManager.pushPage(e.JingCuiPanel.instance),this.close()),this.page=this.viewPage}},n.prototype.changePage=function(e){this.setPage(e)},n.prototype.setGuidePage=function(e){this.guidePage=e,this.setPage(e)},n.prototype.onItemTap=function(){var e=this.tab.selectedIndex;switch(this.page!=e&&this.setPage(e),e){case 2:badge.onLight(badge.action.ActivedSwapAttribute,!1)}this.Enhancement.stopAutoEnhance()},n.prototype.onRemoveFromStage=function(){this.selectpart=null,this.alternateItem=null},n.prototype.close=function(){UIManager.closeForge()},n.prototype.setSwapEquips=function(e,t){this.selectpart=e,this.alternateItem=t},n}(e.FitComponent);e.Forge=t,__reflect(t.prototype,"UI.Forge",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t._fp=0,t.targetFP=0,t.skinName="FPPromoteSkin",t}return __extends(t,e),t.show=function(e){null==this._instance&&(this._instance=new t);var n=~~(messageLayer.width/2-150),i=~~(.24*messageLayer.height);this._instance.x=n,this._instance.y=i,messageLayer.addChild(this._instance),this._instance.targetFP+=e,egret.Tween.removeTweens(this._instance),egret.Tween.get(this._instance).set({alpha:1}).to({fp:this._instance.targetFP},1e3).to({alpha:0},200).set({fp:0,targetFP:0,alpha:1}).call(Game.removeFromParent,this._instance)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.touchEnabled=!1,this.touchChildren=!1},Object.defineProperty(t.prototype,"fp",{get:function(){return this._fp},set:function(e){e=Math.round(e),this._fp=e,this.displayFP=e>=0?"+"+e:""+e},enumerable:!0,configurable:!0}),t}(eui.Component);e.FPPromote=t,__reflect(t.prototype,"UI.FPPromote",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="FunctionItemSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.dataChanged=function(){this.recomandIcon.visible=!1,1==this.data.Recommended&&(this.recomandIcon.visible=!0),this.lbDesc.textFlow=Game.TextParser.parse(this.data.Desc),"GoldCoinShop"==this.data.Page?this.currentState="item":this.currentState="normal"},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnGo:case this.btnGo1:this.OpenPage(this.data.Page)}},n.prototype.OpenPage=function(t){switch(t){case"MysteryShop":return void UIManager.openMysteryShop();case"ArenaShop":return void UIManager.openArenaShop();case"GoldCoinShop":if(null!=this.data.genre&&null!=GoldCoinShop.mapGoods[this.data.genre]){var n=GoldCoinShop.mapGoods[this.data.genre][this.data.detailType];null!=n?GoldCoinShop.buy(n.pos,n.id):UIManager.openGoldCoinShop()}else UIManager.openGoldCoinShop();return;case"buyJade":var i={param:{goldCoin:Game.JadeCostGold,silverCoin:Game.JadeCostGold},desc:lang.String(monthlyactivity.Jade.desc),icon:monthlyactivity.Jade.icon,currency:Game.Currency.GoldCoin,Currency:"gold",discount:100,pos:1,type:Shop.GoodsType.Custom,name:lang.String(monthlyactivity.Jade.name),quality:monthlyactivity.Jade.quality,price:Game.JadeCostGold,currentPrice:Game.JadeCostGold,buy:function(e,t){var n=new net.def.C2SBuyJade;return n.number=t,net.socket.write(2062,n.toArrayBuffer()),!0},clone:function(){return null}};return void UIManager.pushPage(new e.JadePurchase(i))}if(!Game.isWildMap())return void PopUpMessage.push(lang.String("operation not permitted"),color.RED);switch(t){case"Arena":ArenaChallenge.onOpenArena();break;case"TaohuaIsland":TaohuaIsland.onOpenTaohuaIsland();break;case"MasterChallenge":UIManager.pushPage(e.ChallengeCopyUI.instance);break;case"Guild":Guild.onCity2GuildMain();break;case"KillMonster":UIManager.pushPage(e.MapCabinet.instance);break;case"DailyTask":UIManager.pushPage(e.DailyTask.instance);break;case"SongJin":UIManager.pushPage(new e.CrossServerSongJinWar);break;case"Encounters":e.openOfflineHandle();break;case"GuildTask":Guild.onCity2GuildMain(),""!=Player.instance.guildName&&e.GuildHome.instance.changePage(e.GuildHome.PageTask);break;case"SeasunVillage":UIManager.pushPage(new e.SeaSunEntrance);break;case"HuashanPK":HuashanPK.OpenHuashanPK();break;case"SignIn":UIManager.pushPage(e.DailyTask.instance);break;case"MoneyTree":e.WelfareHall.open(),e.WelfareHall.instance.ShowMoneyTree();break;case"CatchThief":DungeonHallMgr.OpenDungeonWithTarget(DungeonHallMgr.DungeonTarget_CatchThief);break;case"Bag":UIManager.openEquipBag();break;case"WanderingPage1":e.openWanderingsUI(0);break;case"WanderingPage2":e.openWanderingsUI(1);break;case"WanderingPage3":e.openWanderingsUI(2);break;case"QinMausoleum":e.openWanderingsUI(3);break;case"GuildRoast":e.openWanderingsUI(3);break;case"WulinLiansai":WulinLiansai.OpenPanel(!0);break;case"PartnerEnlist":UIManager.openPetEnlist();break;case"CrosvrBoss":e.openWanderingsUI(3);break;case"CrossServerFarm":e.openWanderingsUI(1);break;case"CrossServerSongjin":UIManager.pushPage(new e.CrossServerSongJinWar);break;case"CrossServerPersonalMatch":UIManager.pushPage(new e.PersonalMatchUI);break;case"ChamberTask":e.GuildBusiTask.open();break;case"GuildDonate":""!=Player.instance.guildName?UIManager.pushPage(e.GuildDonate.instance):PopUpMessage.push(lang.String("no guild"),color.RED);break;case"GuildShop1":""!=Player.instance.guildName?(UIManager.pushPage(e.GuildShop.instance),e.GuildShop.instance.SetPage(0)):PopUpMessage.push(lang.String("no guild"),color.RED);break;case"GuildShop2":""!=Player.instance.guildName?(UIManager.pushPage(e.GuildShop.instance),e.GuildShop.instance.SetPage(1)):PopUpMessage.push(lang.String("no guild"),color.RED);break;case"PrizeWheel":""!=Player.instance.guildName?UIManager.pushPage(e.GuildGarden.instance):PopUpMessage.push(lang.String("no guild"),color.RED);break;case"EquipMaking":""!=Player.instance.guildName?e.EquipMaking.open():PopUpMessage.push(lang.String("no guild"),color.RED);break;case"GuildWar":null==Player.instance.guildName||""==Player.instance.guildName?PopUpMessage.push(lang.String("no guild"),color.RED):Guild.GuildWarGetTaskProgress()<1?PopUpMessage.push(lang.String("guild war not open"),color.RED):e.GuildWarHome.instance.OpenPage(2);break;case"Yesou":Operation.open(Operation.Type.YesouTask);break;case"DailyGift":e.RechargeActivityHall.open();break;case"GuildDungeon":GuildDungeon.Hotkey2Open(!0);break;case"Babel":Operation.open(Operation.Type.Babel);break;case"PartnerEquipSplit":UIManager.push(new e.PartnerEquipSplitUI);break;case"worship":CityHome.GotoWorship();break;case"foursymbols":e.FourSymbolsEntrance.open();break;case"guangmingding":e.GuangMingDingEntrance.open();break;default:egret.error(t+" not found")}},n}(eui.ItemRenderer);e.FunctionItem=t,__reflect(t.prototype,"UI.FunctionItem")}(UI||(UI={}));var UI;!function(e){function t(t,n){null==e.gathering&&(e.gathering=new e.GatheringTime),e.gathering.millisecond=t,e.gathering.style=n,UIManager.push(e.gathering),AI.stopMove(),AI.SelectTarget(null)}function n(){null!=e.gathering&&(UIManager.pop(e.gathering),e.gathering=null)}e.openGathering=t,e.closeGathering=n;var i=function(e){function t(){var t=e.call(this)||this;return t.remainingTime=new RemainingTime,t.skinName="GatheringSkin",t.addEventListener(eui.UIEvent.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(eui.UIEvent.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(){GameTick.addEventListener(this.onEnterFrame,this)},t.prototype.onRemoveFromStage=function(){GameTick.removeEventListener(this.onEnterFrame,this),this.msg.visible=!1},Object.defineProperty(t.prototype,"millisecond",{set:function(e){this.remainingTime.deltaMillisecond=e,this.maximum=e,this.value=0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"style",{set:function(e){switch(e){case 0:this.currentState="openBox";break;case 1:this.currentState="gather";break;case 2:this.currentState="training";break;case 3:this.currentState="revive"}},enumerable:!0,configurable:!0}),t.prototype.onEnterFrame=function(){this.value=this.maximum-this.remainingTime.deltaMillisecond},t.prototype.SetMsg=function(e){this.msg.text=e,this.msg.visible=!0},t}(e.FitComponent);e.GatheringTime=i,__reflect(i.prototype,"UI.GatheringTime")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.QualityPic=["ui/quality/q1.png","ui/quality/q2.png","ui/quality/q3.png","ui/quality/q4.png","ui/quality/q5.png"],n.skinName="GemChangeSkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.mc=new e.MovieClipComponent,n.mc.removeWhenComplete=!1,n.mc.horizontalCenter=0,n.mc.verticalCenter=0,n.mc.visible=!1,n.labelAttrs=[],n.labelAttrs.push(n.labelAttr1),n.labelAttrs.push(n.labelAttr2),n.labelAttrs.push(n.labelAttr3),n.labelAttrs.push(n.labelAttr4),n.labelAttrs.push(n.labelAttr5),n.addChild(n.mc),n}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance
},enumerable:!0,configurable:!0}),n.prototype.onAddToStage=function(){this.onDataChange(),this.btnPickup.enabled=0!=this.gemId,Game.dispatcher.addEventListener(Game.EVENT.GemChange,this.onSuccess,this),Game.dispatcher.addEventListener(Game.EVENT.SyncGem,this.onDataChange,this),this.gemId=PlayerGem.gems[this.part][this.socket];var e=this.gemId%1e3;this.isMaxLevel=e<WorldLine.GetMaxGemLevel()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.GemChange,this.onSuccess,this),Game.dispatcher.removeEventListener(Game.EVENT.SyncGem,this.onDataChange,this),this.mc.visible=!1,this.mc.free()},n.prototype.onDataChange=function(){this.gemId=PlayerGem.gems[this.part][this.socket];var e=this.gemId%1e3;this.isMaxLevel=e<WorldLine.GetMaxGemLevel(),null!=this.btnUpgrade&&(this.btnPickup.enabled=0!=this.gemId,this._update(this.gemId))},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnChange:PlayerAttribute.bag.GetGemItem().length<=0?e.ResourceObtain.Open([e.ObtResId.gem]):(UIManager.pushPage(e.GemList.instance.Open(this.part,this.socket)),UIManager.pop(this));break;case this.btnPickup:PlayerGem.ApplyPickupGem(this.part,this.socket)&&UIManager.pop(this);break;case this.btnUpgrade:var n=PlayerGem.GetUpgradeCost(this.gemId,!0);if(0!=n.result)return void(2==n.result?e.ResourceObtain.Open([e.ObtResId.CopperCoin]):e.ResourceObtain.Open([e.ObtResId.gem]));PlayerGem.ApplyUpgradeGem(this.part,this.socket);break;case this.btnClose:case this.imgClose:UIManager.pop(this)}},n.prototype.onSuccess=function(){this.mc.visible=!0,this.mc.Load("skill/Ui_petup/Ui_petup.json","Ui_petup"),this.mc.gotoAndPlay(0,1),this.onDataChange()},n.prototype._update=function(e){if(this.gemId=e,null!=this.imgGem){this.imgGem.source="",this.imgGemQuality.source="",this.labelGemName.text="",this.labelCoinCost.text="";for(var t=0;t<this.labelAttrs.length;t++)this.labelAttrs[t].text="";var n=table.props[5][e];if(null!=n){var i=PlayerGem.GetUpgradeCostDesc(this.part,this.socket);this.labelCoinCost.textFlow=Game.HtmlTextParser.parse(i),this.labelGemCost.textFlow=Game.HtmlTextParser.parse(PlayerGem.GetUpgradeGemDesc(this.part,this.socket)),this.imgGem.source=n.source,this.imgGemQuality.source=this.QualityPic[n.quality-1],this.labelGemName.text=n.name;var a=Math.floor(this.gemId/1e3),r=this.gemId%1e3,o=PlayerGem.GetGemAttribute(a,this.part,r);if(null!=o)for(var t=0;t<o.buffs.length;t++)t<this.labelAttrs.length&&(this.labelAttrs[t].text=Buff.GetDesc(o.buffs[t][0],[o.buffs[t][1]]))}}},n.prototype.Open=function(e,t){return this.part=e,this.socket=t,this},n}(e.FitComponent);e.GemChange=t,__reflect(t.prototype,"UI.GemChange",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.labelAttr0="",e.labelAttr1="",e.labelAttr2="",e.labelAttr3="",e.labelAttr4="",e.gemId=0,e.skinName="GemListSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.onDataChanged=MakeDelayExecute(e.refresh,e,100),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.AddItem,this.onDataChanged,this),Game.dispatcher.addEventListener(Game.EVENT.RemoveItem,this.onDataChanged,this),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,this.onDataChanged,this),Game.dispatcher.addEventListener(Game.EVENT.BagItemChange,this.onDataChanged,this),this.refresh()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.AddItem,this.onDataChanged,this),Game.dispatcher.removeEventListener(Game.EVENT.RemoveItem,this.onDataChanged,this),Game.dispatcher.removeEventListener(Game.EVENT.UpdateItem,this.onDataChanged,this),Game.dispatcher.removeEventListener(Game.EVENT.BagItemChange,this.onDataChanged,this)},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnChange:0!=this.gemId&&PlayerGem.ApplyChangeGem(this.part,this.socket,this.gemId)&&UIManager.pop(this)}},n.prototype.close=function(){UIManager.pop(this)},n.prototype.refresh=function(){var e=(Player.instance,PlayerAttribute.bag.GetGemItem());this.gemList.dataProvider=new eui.ArrayCollection(e),this.gemList.dataProvider.length>0&&(this.gemList.selectedIndex=this.getSelectIndex(e),this._update(this.gemList.selectedItem))},n.prototype.getSelectIndex=function(e){if(0==this.gemId)return 0;for(var t=0;t<e.length;t++){var n=e[t].Item.DetailType;if(n==this.gemId)return t}return 0},n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.gemList.itemRenderer=e.BagCell,this.gemList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickItem,this)},n.prototype.onClickItem=function(e){var t=e.itemRenderer,n=t.data;this._update(n)},n.prototype._update=function(e){if(null!=this.imgGem){this.gemId=0,this.imgGem.source="",this.labelGemName.text="";for(var t=0;5>t;t++)this["labelAttr"+t]=""}if(null!=e){this.gemId=e.Item.DetailType,this.imgGem.source=e.Item.Icon,this.labelGemName.textFlow=Game.HtmlTextParser.parse(e.Item.Name);var n=Math.floor(this.gemId/1e3),i=this.gemId%1e3,a=PlayerGem.GetGemAttribute(n,this.part,i);if(null!=a)for(var t=0;t<a.buffs.length;t++)5>t&&(this["labelAttr"+t]=Buff.GetDesc(a.buffs[t][0],[a.buffs[t][1]]))}},n.prototype.Open=function(e,t){return this.part=e,this.socket=t,this._update(null),this},n}(e.FitComponent);e.GemList=t,__reflect(t.prototype,"UI.GemList",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t;!function(e){e[e.Mount=1]="Mount",e[e.Upgrade=2]="Upgrade",e[e.Takeoff=3]="Takeoff"}(t||(t={}));var n;!function(e){e[e.MinLevel=1]="MinLevel"}(n||(n={}));var i=function(n){function i(){var t=n.call(this)||this;return t.attrValue=["attrDesc1","attrDesc2","attrDesc3","attrDesc4"],t.attrNextValue=["attrNextDesc1","attrNextDesc2","attrNextDesc3","attrNextDesc4"],t.gemLevel=["gemLevel0","gemLevel1","gemLevel2","gemLevel3","gemLevel4","gemLevel5"],t.labelAttr=["labelAttr0","labelAttr1","labelAttr2","labelAttr3","labelAttr4","labelAttr5"],t.imgSockets=[],t.Socketqualitys=[],t.skinName="GemMountSkin",t.imgSockets.push(t.imgSocket1),t.imgSockets.push(t.imgSocket2),t.imgSockets.push(t.imgSocket3),t.imgSockets.push(t.imgSocket4),t.imgSockets.push(t.imgSocket5),t.imgSockets.push(t.imgSocket6),t.Socketqualitys.push(t.Socketquality1),t.Socketqualitys.push(t.Socketquality2),t.Socketqualitys.push(t.Socketquality3),t.Socketqualitys.push(t.Socketquality4),t.Socketqualitys.push(t.Socketquality5),t.Socketqualitys.push(t.Socketquality6),t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.mc=new e.MovieClipComponent,t.mc.removeWhenComplete=!1,t.mc.horizontalCenter=-150,t.mc.verticalCenter=-252,PlayerGem.LoadLocalStorage(),t.stopAutoOperation(),eui.Binding.bindHandler(t,["visible"],t.onVisibleChanged,t),t.groupGem.addChild(t.mc),t.selectedPart=0,t.btnpart0.selected=!0,t.btnparts=[],t.btnparts.push(t.btnpart0),t.btnparts.push(t.btnpart1),t.btnparts.push(t.btnpart2),t.btnparts.push(t.btnpart3),t.btnparts.push(t.btnpart4),t.btnparts.push(t.btnpart5),t.btnparts.push(t.btnpart6),t.btnparts.push(t.btnpart7),t.Socketquality1.source="",t.Socketquality2.source="",t.Socketquality3.source="",t.Socketquality4.source="",t.Socketquality5.source="",t.Socketquality5.source="",t}return __extends(i,n),i.prototype.onVisibleChanged=function(){this.visible||this.stopAutoOperation()},i.prototype.getPlans=function(){for(var e=[],t=0;100>t;t++){var n=table.GetGemAutoMountPlanConfig(t);if(null==n)break;e.push(n.name)}return e},i.prototype.ChangeAutoMountPlan=function(e,t){this.autoMountPlanCfg=table.GetGemAutoMountPlanConfig(e),e>0&&null==this.autoMountPlanCfg&&this.ChangeAutoMountPlan(0,t),null!=this.autoMountPlanCfg&&(PlayerGem.SetUpgradeUsePlan(e,!0),this.planName=this.autoMountPlanCfg.name)},i.prototype.onSuccess=function(e){var t=e.data;t.GemId>0&&(this.mc.visible=!0,this.mc.Load("skill/Ui_book/Ui_book.json","Ui_book"),this.mc.gotoAndPlay(0,1)),t.Part==this.selectedPart&&this.onDataChange(),this.autoOperation_>0&&null==this.timer&&(this.timer=egret.setTimeout(this.onTimerOut,this,500))},i.prototype.onTimerOut=function(){null!=this.timer&&(egret.clearTimeout(this.timer),this.timer=null),this.autoOperation(null,!1)},i.prototype.setAutoOperation=function(e){this.autoOperation_=e},i.prototype.stopAutoOperation=function(){this.setAutoOperation(0),this.autoOperationCurrentIdx_=-1,this.autoUpgradePart_=-1,this.autoUpgradeType_=-1,this.autoUpgradeLevel_=-1,null!=this.timer&&(egret.clearTimeout(this.timer),this.timer=null)},i.prototype.autoOperation=function(e,n){switch(null==e?e=this.autoOperation_:(this.stopAutoOperation(),this.setAutoOperation(e),this.autoUpgradeLevel_=-1),this.autoOperationCurrentIdx_<0&&(this.autoOperationCurrentIdx_=0),e){case t.Mount:this.autoMount(n);break;case t.Upgrade:this.autoUpgrade(n);break;case t.Takeoff:this.autoTakeoff()}},i.prototype.autoMount=function(t){if(null!=this.autoMountPlanCfg)for(;this.autoOperationCurrentIdx_>=0&&this.autoOperationCurrentIdx_<this.autoMountPlanCfg.plan.length;this.autoOperationCurrentIdx_++){var n=this.autoMountPlanCfg.plan[this.autoOperationCurrentIdx_],i=PlayerGem.GetFirstEmptySocketFromParts(n.part);if(null!=i&&!(n.count>0&&PlayerGem.CountEquipedGemByTypes(n.part,n.type)>=n.count)){var a=PlayerGem.CountOwnedGemMaxLevelByTypes(n.type);if(null!=a)return this.setSelectedPart(i.part),this.onSelectedPart(),void PlayerGem.ApplyChangeGem(i.part,i.socket,a.gemId)}}null!=PlayerGem.getFirstEmptySocket(-1)&&t&&e.ResourceObtain.Open([e.ObtResId.gem]),this.stopAutoOperation()},i.prototype.autoUpgrade=function(t){var n=PlayerGem.GetEquipedGemByPriority();if(null==n)return void(t&&PopUpMessage.push(lang.String("do not have mount gem"),color.RED));for(var i=0;i<n.length;i++){var a=n[i],r=Math.floor(a.gemId/1e3),o=PlayerGem.countOwnedGemMaxLevelByType(r);if(null!=o&&o.level>a.level)return PlayerGem.ApplyChangeGem(a.part,a.socket,o.gemId),this.setSelectedPart(a.part),void this.onSelectedPart()}for(var s=0,i=0;i<n.length;i++){var a=n[i],l=PlayerGem.GetUpgradeCost(a.gemId,PlayerGem.GetUpgradeUseAdvanceLevelGem());switch(l.result){case PlayerGem.Result.Ok:if(PlayerGem.ApplyUpgradeGem(a.part,a.socket))return this.setSelectedPart(a.part),void this.onSelectedPart();case PlayerGem.Result.CopperCoinNotEnough:t&&e.ResourceObtain.Open([e.ObtResId.CopperCoin]),this.stopAutoOperation();break;case PlayerGem.Result.NoGem:case PlayerGem.Result.MaxLevel:break;case PlayerGem.Result.GemNotEnough:s++}}(s>0||null!=PlayerGem.getFirstEmptySocket(-1))&&t&&e.ResourceObtain.Open([e.ObtResId.gem]),this.stopAutoOperation()},i.prototype.autoTakeoff=function(){for(;this.autoOperationCurrentIdx_>=0&&this.autoOperationCurrentIdx_<Game.EquipPart.EquipCount;this.autoOperationCurrentIdx_++)if(PlayerGem.countEquipedGemByType(this.autoOperationCurrentIdx_,-1)>0)return this.setSelectedPart(this.autoOperationCurrentIdx_),this.onSelectedPart(),void PlayerGem.ApplyPickupAllGem(this.autoOperationCurrentIdx_);this.stopAutoOperation()},i.prototype.onAddToStage=function(){this.AutoSelectEquip(),Game.dispatcher.addEventListener(Game.EVENT.SyncGem,this.onSyncGem,this),Game.dispatcher.addEventListener(Game.EVENT.GemChange,this.onSuccess,this),Game.dispatcher.addEventListener(Game.EVENT.AddItem,this.onItemChanged,this),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,this.onItemChanged,this),this.useAdvanceGem.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCheckAdVanceLevel,this),guide.addEventListener(guide.GuideOperation.AutoGemUpgrade,this.onGuideReminder,this),guide.addEventListener(guide.GuideOperation.AutoGemMount,this.onGuideReminder,this),guide.completed()||this.playGuideMovie(),this.ChangeAutoMountPlan(PlayerGem.GetUpgradeUsePlan(),!1),this.useAdvanceGem.selected=PlayerGem.GetUpgradeUseAdvanceLevelGem()},i.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.SyncGem,this.onSyncGem,this),Game.dispatcher.removeEventListener(Game.EVENT.GemChange,this.onSuccess,this),Game.dispatcher.removeEventListener(Game.EVENT.AddItem,this.onItemChanged,this),Game.dispatcher.removeEventListener(Game.EVENT.UpdateItem,this.onItemChanged,this),guide.removeEventListener(guide.GuideOperation.AutoGemUpgrade,this.onGuideReminder,this),guide.removeEventListener(guide.GuideOperation.AutoGemMount,this.onGuideReminder,this),this.useAdvanceGem.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCheckAdVanceLevel,this),this.stopAutoOperation(),this.mc.visible=!1,this.mc.free()},i.prototype.onCheckAdVanceLevel=function(){PlayerGem.SetUpgradeUseAdvanceLevelGem(this.useAdvanceGem.selected,!0)},i.prototype.onSyncGem=function(){this.onDataChange()},i.compare=function(e,t){return e.gemlevel==t.gemlevel?i.priority[e.part]-i.priority[t.part]:e.gemlevel-t.gemlevel},i.prototype.AutoSelectEquip=function(){if(null==this.selectedPart){for(var e=[],t=0;t<Game.EquipPart.EquipCount;t++)null!=PlayerAttribute.Equips[t]&&e.push({gemlevel:PlayerGem.GetEquipGemTotalLevel(t),part:t});e.sort(i.compare),e.length<=0?this.selectedPart=Game.EquipPart.EquipWeapon:this.selectedPart=e[0].part}this.onDataChange()},i.prototype.onItemChanged=function(e){var t=e.data;5==t.Item.Type&&PlayerGem.CheckGemBadge()},i.prototype.onBtnChoosePlan=function(t){var n=function(e,t){e.ChangeAutoMountPlan(t,!0)};e.PopupMenu.instance.Open(this.getPlans(),n,this,t.stageX,t.stageY)},i.prototype.onTouchTap=function(n){switch(this.stopAutoOperation(),n.target){case this.btnGemdesc:var i=new e.Rule;i.skinName="GemDescSkin",UIManager.pushPage(i);break;case this.btnGainRes:e.ResourceObtain.Open([e.ObtResId.gem]);break;case this.btnAutoUpgrade:this.autoOperation(t.Upgrade,!0);break;case this.btnChoosePlan:this.onBtnChoosePlan(n);break;case this.btnAutoMount:this.autoOperation(t.Mount,!0);break;case this.btnPickupAll:this.autoOperation(t.Takeoff,!0);break;case this.btnpart0:this.setSelectedPart(0),this.onSelectedPart();break;case this.btnpart1:this.setSelectedPart(1),this.onSelectedPart();break;case this.btnpart2:this.setSelectedPart(2),this.onSelectedPart();break;case this.btnpart3:this.setSelectedPart(3),this.onSelectedPart();break;case this.btnpart4:this.setSelectedPart(4),this.onSelectedPart();break;case this.btnpart5:this.setSelectedPart(5),this.onSelectedPart();break;case this.btnpart6:this.setSelectedPart(6),this.onSelectedPart();break;case this.btnpart7:this.setSelectedPart(7),this.onSelectedPart();break;case this.btnGemInfo:var a=new e.GemMountInfo;a.labelTotalLevel=this.labelTotalLevel,a.labelTotalLevelNext=this.labelTotalLevelNext,a.attrDesc1=this.attrDesc1,a.attrDesc2=this.attrDesc2,a.attrDesc3=this.attrDesc3,a.attrDesc4=this.attrDesc4,a.attrNextDesc1=this.attrNextDesc1,a.attrNextDesc2=this.attrNextDesc2,a.attrNextDesc3=this.attrNextDesc3,a.attrNextDesc4=this.attrNextDesc4,UIManager.pushPage(a);break;default:if(n.target instanceof e.EquipCell)return this.selectedPart=n.target.data.part,this.onSelectedPart(),void this.onDataChange();for(var r=0;r<this.imgSockets.length;r++)if(n.target==this.imgSockets[r]){var o=PlayerGem.gems[this.selectedPart][r];if(0!=o)UIManager.pushPage(e.GemChange.instance.Open(this.selectedPart,r));else{var s=PlayerGem.GetSocketLimit(this.selectedPart);s>r?PlayerAttribute.bag.GetGemItem().length<=0?e.ResourceObtain.Open([e.ObtResId.gem]):UIManager.pushPage(e.GemList.instance.Open(this.selectedPart,r)):PopUpMessage.push(lang.StringWithFormat("gemSocket unlocked when equip Lv{1}",PlayerGem.socketLevel[r]),color.RED)}break}}},i.prototype.setSelectedPart=function(e){this.selectedPart=e,this.btnparts[e].selected=!0},i.prototype.onSelectedPart=function(){this.partGemLevel=0;var e=this.selectedPart;this.selectEquip.data={part:e,icon:null,quality:null,enhancement:null,level:null};var t=PlayerAttribute.Equips[e];null==t?(this.selectEquip.icon=null,this.selectEquip.quality=null,this.equiplevel=lang.String("None"),this.partname=lang.String(Game.EquipPart[e])):(this.selectEquip.icon=t.Icon,this.selectEquip.quality=t.Quality,this.equiplevel=String(t.Level),this.partname=t.PartName);for(var n=0;n<this.imgSockets.length;n++)this[this.gemLevel[n]]=String("Lv."+PlayerGem.GetGemLevel(e,n)),"Lv.0"==this[this.gemLevel[n]]&&(this[this.gemLevel[n]]="");for(var n=0;n<this.imgSockets.length;n++){var i=PlayerGem.GetGemLevel(e,n);this.partGemLevel+=i}for(var n=0;n<this.imgSockets.length;n++){var a=PlayerGem.GetPartGem(e,n);if(0!=a){var r=table.props[5][a],o=r.quality,s=(Item.QualityColor[o],Math.floor(a/1e3)),i=a%1e3;this[this.labelAttr[n]]=PlayerGem.GetGemAttributeDesc(s,e,i,"\n")}else this[this.labelAttr[n]]=null}for(var n=(PlayerGem.GetSocketLimit(e),0);n<this.imgSockets.length;n++)this.imgSockets[n].source=PlayerGem.GetIcon(e,n);for(var n=0;n<this.imgSockets.length;n++){var l=PlayerGem.GetQuality(e,n);"1"!=PlayerGem.GetGemQuality(e,n,l)?"2"!=PlayerGem.GetGemQuality(e,n,l)?"3"!=PlayerGem.GetGemQuality(e,n,l)?"4"!=PlayerGem.GetGemQuality(e,n,l)?"5"!=PlayerGem.GetGemQuality(e,n,l)?this.Socketqualitys[n].source="":this.Socketqualitys[n].source="ui/quality/y5.png":this.Socketqualitys[n].source="ui/quality/y4.png":this.Socketqualitys[n].source="ui/quality/y3.png":this.Socketqualitys[n].source="ui/quality/y2.png":this.Socketqualitys[n].source="ui/quality/y1.png"}},i.prototype.sortGemByClass=function(e,t){var n=Math.floor(e.id%1e3),a=Math.floor(t.id%1e3);return n==a?i.priority[e.part]==i.priority[t.part]?e.socket-t.socket:i.priority[e.part]-i.priority[t.part]:n-a},i.prototype.onDataChange=function(){var e=PlayerGem.GetTotalPower();this.totalPower=""+e,this.onSelectedPart();var t=PlayerGem.GetTotalLevel(),n=PlayerGem.GetGemExtAttribute(t),i=PlayerGem.GetNextGemExtAttribute(t);if(this.labelTotalLevelCurrent=String(t),null!=n){var a=n;this.labelTotalLevel=lang.StringWithFormat("gem total level effect{1}",a.level);for(var r=0;r<a.buffs.length;r++)r<this.attrValue.length&&(this[this.attrValue[r]]="+"+a.buffs[r][1])}if(null!=i){var a=i;this.labelTotalLevelNext=lang.StringWithFormat("gem total level effect{1}",a.level);for(var r=0;r<a.buffs.length;r++)r<this.attrNextValue.length&&(this[this.attrNextValue[r]]="+"+a.buffs[r][1])}else this.labelTotalLevelNext=lang.String("gem total level max")},i.prototype.onGuideReminder=function(){var e=this;if(this.visible){var t=guide.info.operation;t==guide.GuideOperation.AutoGemUpgrade&&guide.pushMovie({weight:1,handle:function(){guide.AddMovieClip(e.btnAutoUpgrade)}}),t==guide.GuideOperation.AutoGemMount&&guide.pushMovie({weight:1,handle:function(){guide.AddMovieClip(e.btnAutoMount)}})}},i.prototype.playGuideMovie=function(){guide.info.operation==guide.GuideOperation.AutoGemUpgrade&&guide.AddMovieClip(this.btnAutoUpgrade)},i.priority={4:0,5:1,6:2,7:3,0:4,1:5,2:6,3:7},i}(eui.Component);e.GemMount=i,__reflect(i.prototype,"UI.GemMount",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="GemMountInfoSkin",t.imgClose.addEventListener(egret.TouchEvent.TOUCH_TAP,t.close,t),t}return __extends(t,e),t.prototype.close=function(){UIManager.pop(this)},t}(e.FitComponent);e.GemMountInfo=t,__reflect(t.prototype,"UI.GemMountInfo",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="GemViewSkin",e.onDataChanged=MakeDelayExecute(e.refresh,e,100),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.onTouchTap=function(t){switch(t.target){case this.imgGem:e.Forge.instance.changePage(1),e.EquipTips.close(),UIManager.openForge()}},n.prototype.onAddToStage=function(){this.onDataChanged(),Game.dispatcher.addEventListener(Game.EVENT.GemChange,this.onDataChange,this),Game.dispatcher.addEventListener(Game.EVENT.SyncGem,this.onDataChange,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.GemChange,this.onDataChange,this),Game.dispatcher.removeEventListener(Game.EVENT.SyncGem,this.onDataChange,this)},n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},n.prototype.onDataChange=function(){this.refresh()},n.prototype.refresh=function(){if(null!=this.imgGem){this.labelAttr.text="",this.imgGem.source="";var e=(Player.instance,this.data.part),t=this.data.id;if(0!=t){var n=table.props[5][t];this.imgGem.source=n.source;var i=n.quality,a=Item.QualityColor[i],r=Math.floor(t/1e3),o=t%1e3;this.labelAttr.textFlow=Game.HtmlTextParser.parse('<font color="'+egret.toColorString(a)+'">'+PlayerGem.GetGemAttributeDesc(r,e,o,"\n")+"</font>")}else this.imgGem.source="ui/common1/bagcell.png",this.labelAttr.textFlow=Game.HtmlTextParser.parse('<font color="#BECECB">'+lang.String("gem not insert")+"</font>")}},n}(eui.ItemRenderer);e.GemView=t,__reflect(t.prototype,"UI.GemView")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.skinName="GiftCodeSkin",t}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnOk:var t=this.input.text;if(!t)return;var n=new net.def.C2SGiftCode;n.code=t,net.socket.write(117,n.toArrayBuffer())}},t.prototype.onRemoveFromStage=function(){this.input.text=null},t}(eui.Component);e.GiftCode=t,__reflect(t.prototype,"UI.GiftCode",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.inited=!1,e.skinName="GlobalWheelSkin",e.currentState="globalLuckWheel",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.timer1=new egret.Timer(10,-1),e.timer1.addEventListener(egret.TimerEvent.TIMER,e.onTimer1,e),e.timer2=new egret.Timer(10,-1),e.timer2.addEventListener(egret.TimerEvent.TIMER,e.onTimer2,e),e}return __extends(n,t),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.globalLuck.text="0"},n.prototype.onAddToStage=function(){this.btnLottery1.enabled=!0,this.btnLottery10.enabled=!0,this.onUpdate(),Game.dispatcher.addEventListener(Game.EVENT.ActivityGlobalLuckWheel,this.onUpdate,this),ActivityGlobalLuckWheel.subscribe(1)},n.prototype.onRemoveFromStage=function(){ActivityGlobalLuckWheel.subscribe(0),this.timer1.stop(),this.timer2.stop(),Game.dispatcher.removeEventListener(Game.EVENT.ActivityGlobalLuckWheel,this.onUpdate,this)},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnLottery1:if(this.costGold1<=0)return;if(PlayerAttribute.currency[Game.Currency.GoldCoin]<this.costGold1)return Recharge.openRechargeUI(),void PopUpMessage.push(lang.StringWithFormat("not enough {1}",lang.String(Game.currency2AwardType[Game.Currency.GoldCoin])),color.RED);this.timer1.running||this.timer2.running||(this.btnLottery1.enabled=!1,this.btnLottery10.enabled=!1,this.select=1,this.curstep=0,this.curlight=0,this.timer1.reset(),this.timer1.start());break;case this.btnLottery10:if(this.costGold10<=0)return;if(PlayerAttribute.currency[Game.Currency.GoldCoin]<this.costGold10)return Recharge.openRechargeUI(),void PopUpMessage.push(lang.StringWithFormat("not enough {1}",lang.String(Game.currency2AwardType[Game.Currency.GoldCoin])),color.RED);this.timer1.running||this.timer2.running||(this.btnLottery1.enabled=!1,this.btnLottery10.enabled=!1,this.select=10,this.curstep=0,this.curlight=0,this.temprets=[],this.timer2.reset(),this.timer2.start());break;case this.btnShop:e.GlobalLuckWheelShop.open()}},n.prototype.onTimer1=function(){var e=100;if(this.curstep=this.curstep+1,this.curstep==e)ActivityGlobalLuckWheel.Lottery(this.select);else{if(this.curstep>e&&this.curstep<=2*e&&this.curstep%10!=0)return;if(this.curstep>2*e&&this.curstep%30!=0)return}var t=ActivityGlobalLuckWheel._lotteryret;if(null!=t&&t.values[0]==this.curlight)return this.timer1.stop(),this.onResult(),ActivityGlobalLuckWheel._lotteryret=null,this.btnLottery1.enabled=!0,void(this.btnLottery10.enabled=!0);this.curlight=(this.curlight+1)%this.tag.numChildren;var n=this.tag.getChildAt(0==this.curlight?this.tag.numChildren-1:this.curlight-1);n.data.light="",n.onRefresh();var i=this.tag.getChildAt(this.curlight);i.data.light="ui/city1/b_banghui1.png",i.onRefresh()},n.prototype.onTimer2=function(){var e=100;if(this.curstep=this.curstep+1,this.curstep==e)ActivityGlobalLuckWheel.Lottery(this.select);else{if(this.curstep>e&&this.curstep<=2*e&&this.curstep%10!=0)return;if(this.curstep>2*e&&this.curstep%30!=0)return}var t=ActivityGlobalLuckWheel._lotteryret;null!=t&&this.temprets.length<t.values.length&&this.temprets.push(t.values[this.temprets.length]),this.curlight=(this.curlight+1)%this.tag.numChildren;for(var n=0;10>=n;n++){var i=this.curlight-n;i=0>i?this.tag.numChildren+i:i;var a=this.tag.getChildAt(i);a.data.light=n<10-this.temprets.length?"ui/city1/b_banghui1.png":"",a.onRefresh()}for(var r=0;r<this.temprets.length;r++){var o=this.temprets[r],a=this.tag.getChildAt(o);a.data.light="ui/city1/b_banghui1.png",a.onRefresh()}return null!=t&&this.temprets.length==t.values.length?(this.timer2.stop(),this.onResult(),ActivityGlobalLuckWheel._lotteryret=null,this.btnLottery1.enabled=!0,void(this.btnLottery10.enabled=!0)):void 0},n.prototype.onUpdate=function(){var e=ActivityGlobalLuckWheel._cfg,t=ActivityGlobalLuckWheel._globaldata;if(null!=e&&null!=t){if(!this.inited){this.inited=!0,this.costGold1=e.costGold,this.costGold10=e.costGold10;for(var n=0;n<this.tag.numChildren;n++){var i=this.tag.getChildAt(n);i.data=JSON.parse(JSON.stringify(e.lottreyAward[n]))}}this.actDuration=lang.Format("Hoạt động còn: {1}",ActivityGlobalLuckWheel.activity.reaminingTime),this.globalLuck.text=t.value+"%";for(var a=[],r=0;r<t.lucker.length;r++)if(0==t.luckertime[r].high){var o=FormatYYYYMMDDHHMM(t.luckertime[r].low),s=t.luckergold[r],l=table.getAwardName(e.lottreyAward[s]),u=e.lottreyAward[s].content.count;u=null==u?1:u;var c=Game.TextParser.parse("<font color='#B75C54'><font color='#FFD900'>"+t.lucker[r]+"</font> "+o+" đã nhận <font color='#FFD900'>"+l+" x"+u+"</font></font>");a.push(c)}else egret.error("to do fix");var h=this.listLucker.dataProvider;null==h?this.listLucker.dataProvider=new eui.ArrayCollection(a):h.replaceAll(a)}},n.prototype.onResult=function(){var t=ActivityGlobalLuckWheel._cfg,n=ActivityGlobalLuckWheel._lotteryret;if(null!=t&&null!=n){for(var i=new e.AwardResult,a=[],r=0,o=n.values;r<o.length;r++){var s=o[r];a.push(JSON.parse(JSON.stringify(t.lottreyAward[s])))}i.setAwards(a),i.setCallBack(ActivityGlobalLuckWheel.DoLottery),UIManager.push(i)}},n}(eui.Component);e.GlobalLuckWheel=t,__reflect(t.prototype,"UI.GlobalLuckWheel",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="CommonShopSkin",e.title="Tiệm May Mắn",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new e.GlobalLuckWheelShop),this._instance},enumerable:!0,configurable:!0}),n.open=function(){var e=this.instance;return UIManager.pushPage(e),e},n.close=function(){null!=this._instance&&UIManager.pop(this._instance)},n.prototype.makeGoods=function(){var e=ActivityGlobalLuckWheel._goods;if(null!=e){var t=this.list.dataProvider;null==t?this.list.dataProvider=new eui.ArrayCollection(e):t.replaceAll(e);var n=ActivityGlobalLuckWheel.currency();this.currenyName=table.getAwardName(n)+":";var i=n.content;this.haveCount=PlayerAttribute.GetItemCount(i.genre,i.detailType),this.cellCost.data=n,this.cellCost.visible=!0,this.imgCurrency.visible=!1}},n.prototype.onAddToStage=function(){this.makeGoods(),Game.dispatcher.addEventListener(Game.EVENT.ActivityGlobalLuckWheel,this.makeGoods,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.ActivityGlobalLuckWheel,this.makeGoods,this)},n.prototype.close=function(){UIManager.pop(this)},n}(e.FitComponent);e.GlobalLuckWheelShop=t,__reflect(t.prototype,"UI.GlobalLuckWheelShop",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.inited=!1,e.skinName="GlobalWheelSkin",e.currentState="globalWheel",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.timer1=new egret.Timer(10,-1),e.timer1.addEventListener(egret.TimerEvent.TIMER,e.onTimer1,e),e.timer2=new egret.Timer(10,-1),e.timer2.addEventListener(egret.TimerEvent.TIMER,e.onTimer2,e),e}return __extends(n,t),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},n.prototype.onAddToStage=function(){this.btnLottery1.enabled=!0,this.btnLottery10.enabled=!0,this.onUpdate(),Game.dispatcher.addEventListener(Game.EVENT.ActivityGlobalWheel,this.onUpdate,this),ActivityGlobalWheel.subscribe(1)},n.prototype.onRemoveFromStage=function(){ActivityGlobalWheel.subscribe(0),this.timer1.stop(),this.timer2.stop(),Game.dispatcher.removeEventListener(Game.EVENT.ActivityGlobalWheel,this.onUpdate,this)},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnLottery1:if(this.costGold1<=0)return;if(PlayerAttribute.currency[Game.Currency.GoldCoin]<this.costGold1)return Recharge.openRechargeUI(),void PopUpMessage.push(lang.StringWithFormat("not enough {1}",lang.String(Game.currency2AwardType[Game.Currency.GoldCoin])),color.RED);this.timer1.running||this.timer2.running||(this.btnLottery1.enabled=!1,this.btnLottery10.enabled=!1,this.select=1,this.curstep=0,this.curlight=0,this.timer1.reset(),this.timer1.start());break;case this.btnLottery10:if(this.costGold10<=0)return;if(PlayerAttribute.currency[Game.Currency.GoldCoin]<this.costGold10)return Recharge.openRechargeUI(),void PopUpMessage.push(lang.StringWithFormat("not enough {1}",lang.String(Game.currency2AwardType[Game.Currency.GoldCoin])),color.RED);this.timer1.running||this.timer2.running||(this.btnLottery1.enabled=!1,this.btnLottery10.enabled=!1,this.select=10,this.curstep=0,this.curlight=0,this.temprets=[],this.timer2.reset(),this.timer2.start())}},n.prototype.onTimer1=function(){var e=100;if(this.curstep=this.curstep+1,this.curstep==e)ActivityGlobalWheel.Lottery(this.select);else{if(this.curstep>e&&this.curstep<=2*e&&this.curstep%10!=0)return;if(this.curstep>2*e&&this.curstep%30!=0)return}var t=ActivityGlobalWheel._lotteryret;if(null!=t&&t.values[0]==this.curlight)return this.timer1.stop(),this.onResult(),ActivityGlobalWheel._lotteryret=null,this.btnLottery1.enabled=!0,void(this.btnLottery10.enabled=!0);this.curlight=(this.curlight+1)%this.tag.numChildren;var n=this.tag.getChildAt(0==this.curlight?this.tag.numChildren-1:this.curlight-1);n.data.light="",n.onRefresh();var i=this.tag.getChildAt(this.curlight);i.data.light="ui/city1/b_banghui1.png",i.onRefresh()},n.prototype.onTimer2=function(){var e=100;if(this.curstep=this.curstep+1,this.curstep==e)ActivityGlobalWheel.Lottery(this.select);else{if(this.curstep>e&&this.curstep<=2*e&&this.curstep%10!=0)return;if(this.curstep>2*e&&this.curstep%30!=0)return}var t=ActivityGlobalWheel._lotteryret;
null!=t&&this.temprets.length<t.values.length&&this.temprets.push(t.values[this.temprets.length]),this.curlight=(this.curlight+1)%this.tag.numChildren;for(var n=0;10>=n;n++){var i=this.curlight-n;i=0>i?this.tag.numChildren+i:i;var a=this.tag.getChildAt(i);a.data.light=n<10-this.temprets.length?"ui/city1/b_banghui1.png":"",a.onRefresh()}for(var r=0;r<this.temprets.length;r++){var o=this.temprets[r],a=this.tag.getChildAt(o);a.data.light="ui/city1/b_banghui1.png",a.onRefresh()}return null!=t&&this.temprets.length==t.values.length?(this.timer2.stop(),this.onResult(),ActivityGlobalWheel._lotteryret=null,this.btnLottery1.enabled=!0,void(this.btnLottery10.enabled=!0)):void 0},n.prototype.onUpdate=function(){var e=ActivityGlobalWheel._cfg,t=ActivityGlobalWheel._globaldata;if(null!=e&&null!=t){if(!this.inited){this.inited=!0,this.costGold1=e.costGold,this.costGold10=e.costGold10;for(var n=0;n<this.tag.numChildren;n++){var i=this.tag.getChildAt(n);i.data=JSON.parse(JSON.stringify(e.lottreyAward[n]))}}this.actDuration=lang.Format("Hoạt động còn: {1}",ActivityGlobalWheel.activity.reaminingTime),this.globalTip="Tích lũy tổng số tham gia rút thưởng "+lang.String(Game.currency2AwardType[e.globalCurrencyType]),this.globalCurr=t.value,this.imgCurr.source=Game.currency2Icon[e.globalCurrencyType];for(var a=[],r=0;r<t.lucker.length;r++)if(0==t.luckertime[r].high){var o=FormatYYYYMMDDHHMM(t.luckertime[r].low),s=Game.TextParser.parse("<font color='#B75C54'><font color='#FFD900'>"+t.lucker[r]+"</font> "+o+"  nhận được <font color='#FFD900'>"+t.luckergold[r]+"</font>"+lang.String(Game.currency2AwardType[e.globalCurrencyType])+"</font>");a.push(s)}else egret.error("to do fix");var l=this.listLucker.dataProvider;null==l?this.listLucker.dataProvider=new eui.ArrayCollection(a):l.replaceAll(a)}},n.prototype.onResult=function(){var t=ActivityGlobalWheel._cfg,n=ActivityGlobalWheel._lotteryret;if(null!=t&&null!=n){for(var i=new e.AwardResult,a=[],r=0,o=n.values;r<o.length;r++){var s=o[r];a.push(JSON.parse(JSON.stringify(t.lottreyAward[s])))}i.setAwards(a),i.setCallBack(ActivityGlobalWheel.DoLottery),UIManager.push(i)}},n}(eui.Component);e.GlobalWheel=t,__reflect(t.prototype,"UI.GlobalWheel",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.dataChanged=function(){var e=this.awardList.dataProvider;null==e?this.awardList.dataProvider=new eui.ArrayCollection(ActivityGrouponBuy.info_GrouponRankAwards[this.data.idx]):e.replaceAll(ActivityGrouponBuy.info_GrouponRankAwards[this.data.idx])},t}(eui.ItemRenderer);e.GrouponBuyAwardsItem=t,__reflect(t.prototype,"UI.GrouponBuyAwardsItem");var n=function(t){function n(){return t.call(this)||this}return __extends(n,t),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btnDraw.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onDraw,this)},n.prototype.dataChanged=function(){switch(this.awardList.dataProvider=new eui.ArrayCollection(ActivityGrouponBuy.info_GrouponAwards[this.data.idx].awards),this.count=ActivityGrouponBuy.info_GrouponAwards[this.data.idx].count,this.btnDraw.visible=!0,this.data.status){case 1:this.btnDraw.label=lang.String("receive"),this.btnDraw.enabled=!0;break;case 2:this.btnDraw.visible=!1;break;default:this.btnDraw.label=lang.String("receive"),this.btnDraw.enabled=!1}},n.prototype.onDraw=function(){if(ActivityGrouponBuy.charged){var t=new net.def.C2SOpeningGrouponAward;t.setIndex(this.data.idx),net.socket.write(135,t.toArrayBuffer())}else{var n=lang.String("recharge drawn"),i=lang.String("GrouponBuy charged user could drawwith");e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],n,i,function(){return Recharge.openRechargeUI(),!0},null,null)}},n}(eui.ItemRenderer);e.GrouponBuyChargesItem=n,__reflect(n.prototype,"UI.GrouponBuyChargesItem");var i=function(e){function t(){var t=e.call(this)||this;return t.totalCount=0,t.maxCount=3e5,t.myCount=0,t.skinName="GrouponBuyUISkin",t.touchEnabled=!1,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.onAddToStage=function(){this.notice=lang.StringWithFormat("GrouponBuy minCharge value",ActivityGrouponBuy.minRankAmount);var e=Game.getServerDate(),t=ActivityGrouponBuy.activity.taskActivity.startTime,n=ActivityGrouponBuy.activity.taskActivity.endTime,i=new Date(n.getFullYear(),n.getMonth(),n.getDate()-1,20,0,0,0);ActivityGrouponBuy.activity.inTime()&&e>=t&&i>e?this.openDate.textFlow=Game.HtmlTextParser.parse(lang.StringWithFormat("GrouponBuy left time",this.getReaminingTime(e,t,i))):this.openDate.text=lang.String("already finish"),this.onRefreshCount(),this.onRefreshGrouponStatus(),this.onRefreshRanklist(),Game.dispatcher.addEventListener(Game.EVENT.GrouponBuyRanklist,this.onRefreshRanklist,this),Game.dispatcher.addEventListener(Game.EVENT.GrouponBuyAmount,this.onRefreshCount,this),Game.dispatcher.addEventListener(Game.EVENT.GrouponBuyStatus,this.onRefreshGrouponStatus,this)},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.GrouponBuyRanklist,this.onRefreshRanklist,this),Game.dispatcher.removeEventListener(Game.EVENT.GrouponBuyAmount,this.onRefreshCount,this),Game.dispatcher.removeEventListener(Game.EVENT.GrouponBuyStatus,this.onRefreshGrouponStatus,this),this.tab.selectedIndex=0},t.prototype.onRefreshCount=function(){this.myCount=ActivityGrouponBuy.personAmount,ActivityGrouponBuy.serverAmount>=this.maxCount?this.totalCount=this.maxCount:this.totalCount=ActivityGrouponBuy.serverAmount},t.prototype.onRefreshGrouponStatus=function(){for(var e=this.chargesDataGroup.dataProvider,t=[],n=0;n<ActivityGrouponBuy.info_GrouponAwards.length;n++)null!=ActivityGrouponBuy.grouponStatus&&null!=ActivityGrouponBuy.grouponStatus[n]?t.push({idx:n,status:ActivityGrouponBuy.grouponStatus[n]||0}):t.push({idx:n,status:0});t.sort(ActivityGrouponBuy.sortStatus),null==e?this.chargesDataGroup.dataProvider=new eui.ArrayCollection(t):e.replaceAll(t)},t.prototype.onRefreshRanklist=function(){var e=this.rankList.dataProvider,t=ActivityGrouponBuy.rankList;if(t.length<=0)for(var n=0;10>n;n++)t.push({round:n+1,name:lang.String("leave the seat of honour open"),time:0});null==e?this.rankList.dataProvider=new eui.ArrayCollection(t):(e.replaceAll(t),this.rankScroller.viewport.scrollV=0)},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnCharge:Recharge.openRechargeUI()}},t.prototype.getReaminingTime=function(e,t,n){var i=n.getTime()-e.getTime();if(i>24*Game.Hour){var a=~~(i/Game.Hour/24),r=~~(i%(24*Game.Hour)/Game.Hour);return lang.StringWithFormat("{1}day{2}hours",a,r)}return i>Game.Hour?lang.StringWithFormat("{1}hours",~~(i/Game.Hour)):"Ít hơn 1 giờ"},t}(eui.ItemRenderer);e.GrouponBuyUI=i,__reflect(i.prototype,"UI.GrouponBuyUI")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="GuideTaskSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTap,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.GuideReminder,this.onGuideReminder,this),Game.dispatcher.addEventListener(Game.EVENT.GuideCompleted,this.onGuideReminder,this),null!=guide.task&&guide.completed()&&guide.AddMovieClip(this.movieGroup)},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.GuideReminder,this.onGuideReminder,this),Game.dispatcher.removeEventListener(Game.EVENT.GuideCompleted,this.onGuideReminder,this)},t.prototype.onSyncGuideTask=function(){this.desc=guide.desc(),this.awardDesc=guide.info.awardDesc,this.icon=guide.info.icon,this.invalidateState()},t.prototype.onGuideReminder=function(){var e=this;guide.pushMovie({weight:0,handle:function(){e.showMovie()}})},t.prototype.onTap=function(){!guide.onTouchTap()},t.prototype.showMovie=function(){guide.AddMovieClip(this.movieGroup)},t.prototype.getCurrentState=function(){return guide.completed()?"completed":"task"},t}(eui.Component);e.GuideTask=t,__reflect(t.prototype,"UI.GuideTask",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="GuideRageSkillSkin",t.playing=!1,t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.RESIZE,t.Resize,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(){this.btn.x=~~(this.width/2-38),this.btn.y=~~(this.height/2-38),guide.AddMovieClip(this.btn)},t.prototype.Resize=function(){this.playing||null!=this.btn&&(this.btn.x=~~(this.width/2-38),this.btn.y=~~(this.height/2-38))},t.prototype.close=function(){this.btn.scaleX=1,this.btn.scaleY=1,UIManager.popNoTweens(this),this.playing=!1},t.prototype.onTouchTap=function(e){switch(e.target){case this.btn:var t=this.width-6,n=this.height-146;egret.Tween.removeTweens(this.btn),this.playing=!0,egret.Tween.get(this.btn).to({x:t,y:n,scaleX:.1,scaleY:.1},250).call(this.close,this)}},t}(e.FitComponent);e.GuideRageSkill=t,__reflect(t.prototype,"UI.GuideRageSkill",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="HoldingAreaSkin",t.remainingTime=new RemainingTime,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.onAddToStage=function(){SecondTicker.addEventListener(this.updateRestTime,this)},t.prototype.onRemoveFromStage=function(){SecondTicker.removeEventListener(this.updateRestTime,this)},Object.defineProperty(t.prototype,"restTime",{set:function(e){this.remainingTime.delta=e},enumerable:!0,configurable:!0}),t.prototype.updateRestTime=function(){this.time=this.remainingTime.getMinuteSecond()},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnRules:this.onClickRules&&this.onClickRules();break;case this.btnExit:this.onExit&&this.onExit()}},t}(e.FitComponent);e.HoldingArea=t,__reflect(t.prototype,"UI.HoldingArea",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.onDataChange=MakeDelayExecute(e.dataChanged,e,100),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.skinName="HUDSkin",e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onAddToStage=function(){this.d=Player.instance,this.updateToggleAutoPlayState(Setting.auto),Game.dispatcher.addEventListener(Game.EVENT.CurrencyChange[Game.Currency.GoldCoin],this.onDataChange,this),Game.dispatcher.addEventListener(Game.EVENT.CurrencyChange[Game.Currency.SilverCoin],this.onDataChange,this),Game.dispatcher.addEventListener(Game.EVENT.CurrencyChange[Game.Currency.CopperCoin],this.onDataChange,this),Game.dispatcher.addEventListener(Game.EVENT.GuideCompleted,this.onGuideCompleted,this),Game.dispatcher.addEventListener(Game.EVENT.AutoPlayChange,this.onAutoPlayChange,this),Game.dispatcher.addEventListener(Game.EVENT.UpdateVip,this.vipChanged,this),this.dataChanged(),this.vipChanged()},n.prototype.dataChanged=function(){this.GoldCoin=PlayerAttribute.currency[Game.Currency.GoldCoin],this.SilverCoin=PlayerAttribute.currency[Game.Currency.SilverCoin],this.CopperCoin=PlayerAttribute.currencyTxt[Game.Currency.CopperCoin]},n.prototype.onRemoveFromStage=function(){this.d=null,this.updateToggleAutoPlayState(!1),Game.dispatcher.removeEventListener(Game.EVENT.CurrencyChange[Game.Currency.GoldCoin],this.onDataChange,this),Game.dispatcher.removeEventListener(Game.EVENT.CurrencyChange[Game.Currency.SilverCoin],this.onDataChange,this),Game.dispatcher.removeEventListener(Game.EVENT.CurrencyChange[Game.Currency.CopperCoin],this.onDataChange,this),Game.dispatcher.removeEventListener(Game.EVENT.GuideCompleted,this.onGuideCompleted,this),Game.dispatcher.removeEventListener(Game.EVENT.AutoPlayChange,this.onAutoPlayChange,this),Game.dispatcher.removeEventListener(Game.EVENT.UpdateVip,this.vipChanged,this)},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnGoldCoin:if(this.isCrossServer())return;Recharge.openRechargeUI();break;case this.toggleAutoPlay:Setting.ChangeAutoPlay(this.toggleAutoPlay.selected);break;case this.btnVIP:Vip.showVipUi()}e.stopPropagation()},n.prototype.vipChanged=function(){var e=PlayerAttribute.vipItem.level;this.vipIcon=Vip.getVipIcon(e)},n.prototype.showBattle=function(){var e=table.maps[World.mapId].sound;null!=e&&SoundUtil.playBGM(e,!0),this.btnGuild.selected=!1,guide.removeMovieClip(this.btnGuild),null==guide.task||guide.completed()||this.battle.playGuideMovie(guide.info.operation)},n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),e.battle=this.battle,this.btnForge.addEventListener(eui.PropertyEvent.PROPERTY_CHANGE,this.onClickForge,this),this.btnRole.addEventListener(eui.PropertyEvent.PROPERTY_CHANGE,this.onClickRole,this),this.btnBag.addEventListener(eui.PropertyEvent.PROPERTY_CHANGE,this.onClickBag,this),this.btnSkill.addEventListener(eui.PropertyEvent.PROPERTY_CHANGE,this.onClickSkill,this),this.btnMall.addEventListener(eui.PropertyEvent.PROPERTY_CHANGE,this.onClickMall,this),this.btnGuild.addEventListener(eui.PropertyEvent.PROPERTY_CHANGE,this.onClickGuild,this),this.btnSetting.addEventListener(eui.PropertyEvent.PROPERTY_CHANGE,this.onClickSetting,this),egret.Capabilities.isMobile?this.chatBox.height=68:(this.chatBox.bottom=6,this.chatBox.height=160)},n.prototype.onClickMall=function(t){if(!this.isCrossServer()){if(t.target.selected){var n=this.select;this.select=t.target,null!=n&&(n.selected=!1)}else t.target==this.select&&(this.select=null);t.target.selected?this.pushPage(e.Mall.get()):e.Mall.close()}},n.prototype.onClickForge=function(t){if(!this.isCrossServer()){if(t.target.selected){var n=this.select;this.select=t.target,null!=n&&(n.selected=!1)}else t.target==this.select&&(this.select=null);t.target.selected?this.pushPage(e.Forge.instance):e.Forge.Close()}},n.prototype.openBag=function(){this.btnBag.selected=!0},n.prototype.onClickBag=function(t){if(!this.isCrossServer()){if(t.target.selected){var n=this.select;this.select=t.target,null!=n&&(n.selected=!1)}else t.target==this.select&&(this.select=null);t.target.selected?this.pushPage(e.BagView.instance):e.BagView.Close()}},n.prototype.onClickSkill=function(t){if(!this.isCrossServer()){if(t.target.selected){var n=this.select;this.select=t.target,null!=n&&(n.selected=!1)}else t.target==this.select&&(this.select=null);t.target.selected?this.pushPage(e.SkillCabinet.instance):e.SkillCabinet.Close()}},n.prototype.onClickRole=function(t){if(!this.isCrossServer()){if(t.target.selected){var n=this.select;this.select=t.target,null!=n&&(n.selected=!1)}else t.target==this.select&&(this.select=null);t.target.selected?this.pushPage(e.PlayerCabinet.instance):(e.PlayerCabinet.Close(),e.AvatarUI.Close(),e.FriendsUI.Close(),SuperWeapon.hideUi())}},n.prototype.pushPage=function(e){return egret.Tween.removeTweens(e),e.parent==this.page?(e.scaleX=.9,e.scaleY=.9,e.alpha=0,egret.Tween.get(e).to({scaleX:1,scaleY:1,alpha:1},100),void this.page.addChild(e)):(e.scaleX=.9,e.scaleY=.9,e.alpha=0,egret.Tween.get(e).to({scaleX:1,scaleY:1,alpha:1},100),void this.page.addChild(e))},n.prototype.onClickGuild=function(t){if(!this.isCrossServer())if(t.target.selected){var n=this.select;if(this.select=t.target,null!=n&&(n.selected=!1),!Game.isWildMap())return PopUpMessage.push(lang.String("can not open guild"),color.RED),void(this.btnGuild.selected=!1);if(PlayerAttribute.Level<Guild.limitLevel)return Guild.onFailmessage(1),void(this.btnGuild.selected=!1);if(""==Player.instance.guildName)return Guild.openGuildEnroll(),void(this.btnGuild.selected=!1);this.pushPage(e.City.instance)}else t.target==this.select&&(this.select=null),e.City.close()},n.prototype.onClickSetting=function(t){if(t.target.selected){var n=this.select;this.select=t.target,null!=n&&(n.selected=!1),this.pushPage(e.BattleSetting.instance)}else t.target==this.select&&(this.select=null),e.BattleSetting.close()},n.prototype.onGuideCompleted=function(){var e=this;this.btnGuild.selected&&guide.pushMovie({weight:1,handle:function(){guide.AddMovieClip(e.btnGuild)}})},n.prototype.closePages=function(){this.btnForge.selected=!1,this.btnRole.selected=!1,this.btnSkill.selected=!1,this.btnBag.selected=!1,this.btnMall.selected=!1,this.btnSetting.selected=!1,this.btnGuild.selected=!1,this.page.removeChildren(),this.showBattle()},n.prototype.isCrossServer=function(){return Game.isCrossServer()?(PopUpMessage.push(lang.String("operation not permitted"),color.RED),!0):!1},n.prototype.getTopUI=function(){var e=this.page.numChildren;return 0!=e?this.page.getChildAt(e-1):this},n.prototype.onAutoPlayChange=function(e){this.updateToggleAutoPlayState(Setting.auto)},n.prototype.updateToggleAutoPlayState=function(e){this.toggleAutoPlay.selected=e},n.prototype.updateToggleAutoVisible=function(e){this.toggleAutoPlay.visible=e},n.prototype.SetSkillBar=function(e){this.skillBar.currentState=e},n}(e.FitComponent);e.HUD=t,__reflect(t.prototype,"UI.HUD",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="IconButtonSkins",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.freeMovie,e),e.img="",e.action="",e.mcSource="skill/Ui_quan02/Ui_quan02.json",e.mcName="Ui_quan02",e}return __extends(n,t),n.prototype.onTouchTap=function(e){this.onTap&&this.onTap(e)},n.prototype.freeMovie=function(){null!=this.movieClip&&(this.movieClip.stop(),Game.removeFromParent.apply(this.movieClip),this.movieClip.free())},n.prototype.playMovie=function(t){if(null==this.movieClip){var n=new e.MovieClipComponent;n.contentJustify=!1,n.justify=!1,n.position="TL",n.width=2,n.height=2,n.removeWhenComplete=!1,n.horizontalCenter=0,n.verticalCenter=0,n.scaleX=.9,n.scaleY=.9,this.movieClip=n}this.movieClip.Load(this.mcSource,this.mcName),this.addChild(this.movieClip),this.movieClip.play(t)},n.prototype.stopMovie=function(){null!=this.movieClip&&(this.movieClip.stop(),Game.removeFromParent.apply(this.movieClip))},n}(eui.Button);e.IconButton=t,__reflect(t.prototype,"UI.IconButton")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.icon="",t.rbcorner="",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.onTouchTap=function(){},t.prototype.onRefresh=function(){this.dataChanged()},t.prototype.dataChanged=function(){null!=this.data&&(this.icon=this.data.icon,this.rbcorner=this.data.rbcorner)},t.prototype.onRemoveFromStage=function(){this.clearcell()},t.prototype.clearcell=function(){this.icon=""},t}(eui.ItemRenderer);e.IconCell=t,__reflect(t.prototype,"UI.IconCell")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="ItemGroupSkin",t.dataChanged(),t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.dataChanged=function(){null!=this.data&&(null==this.data.OnClick&&Game.removeFromParent.apply(this.btnAdd),this.cell.data=this.data.item,this.txt=this.data.txt)},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnAdd:this.data.OnClick&&this.data.OnClick()}},t}(eui.ItemRenderer);e.ItemGroup=t,__reflect(t.prototype,"UI.ItemGroup")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="ItemSetInfoTemp2Skin",t}return __extends(t,e),t.prototype.update=function(e){for(var t=Wuxingyinmanager.GetWuxingshiSuitConfig(e),n=0,i=t.stones.length,a=0;i>a;a++){var r=Wuxingyinmanager.IsUsing(t.stones[a]);r&&n++}for(var o=Wuxingyinmanager.activedSuit[e],s=[],a=0;a<t.attributes.length;a++){var l=t.attributes[a],u=Buff.GetDesc(l.buff[0],l.buff.slice(1));o>a?s.push("<font color='"+Item.QualityColor[t.quality]+"'>"+StringWithFormat("[{1}]{2}",l.needNum,u)+"</font>"):s.push(StringWithFormat("[{1}]{2}",l.needNum,u))}this.attributes.textFlow=Game.HtmlTextParser.parser(s.join("\n")),this.info.text=t.name+"("+n+"/"+i+")"},t}(eui.Component);e.WuxingshiSuitInfo=t,__reflect(t.prototype,"UI.WuxingshiSuitInfo",["eui.UIComponent","egret.DisplayObject"]);var n=function(e){function t(){var t=e.call(this)||this;return t.skinName="ItemSetInfoTemp1Skin",t.parts=new eui.ArrayCollection,t}return __extends(t,e),t.prototype.update=function(e,t){for(var n=EquipmentSet.infos[e],i=[],a=n.equips.length,r=0,o=0;a>o;o++){var s=n.equips[o].part,l=t[s];l&&EquipmentSet.equips[s][l.Id]==e?(i.push("icon/equip_tips/tips_"+s+".png"),r++):i.push("icon/equip_tips/tips_"+s+"_1.png")}this.parts.replaceAll(i);for(var u=[],c=egret.toColorString(Item.QualityColor[n.quality]),h=0,d=n.attributes;h<d.length;h++){var p=d[h];p.set<=r?u.push("<font color='"+c+"'>"+StringWithFormat("[{1}]{2}",p.set,p.buffs.join("\n"))+"</font>"):u.push(StringWithFormat("[{1}]{2}",p.set,p.buffs.join("\n")))}this.attributes.textFlow=Game.HtmlTextParser.parser(u.join("\n")),this.info.text=n.name+"("+r+"/"+a+")"},t.img0="icon/equip_tips/tips_{}.png",t}(eui.Component);e.EquipmentSetInfo=n,__reflect(n.prototype,"UI.EquipmentSetInfo",["eui.UIComponent","egret.DisplayObject"]);var i=function(t){function n(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.onAddToStage=function(){},n.prototype.onRemoveFromStage=function(){this.refineGroup.visible=!1},n.prototype.adjustPosition=function(e,t){this.group.getChildIndex(e)!=t&&this.group.addChildAt(e,t)},n.prototype.updateGems=function(e,t,n,i){if(null==n)return Game.removeFromParent.apply(this.gemList),i;var a=PlayerGem.GetMaxSocket(t);if(0>=a)return Game.removeFromParent.apply(this.gemList),i;for(var r=!1,o=0;o<n.length;o++){var s=n[o];if(s>0){r=!0;break}}if(!r)return Game.removeFromParent.apply(this.gemList),i;i++,this.adjustPosition(this.gemList,i);for(var l=[],u=0;a>u;u++){var c=n?n[u]:0;if(c&&c>0){var h=table.props[5][c],d=h.quality,p=Item.QualityColor[d],g=Math.floor(c/1e3),m=c%1e3;l.push({icon:h.source,desc:Game.HtmlTextParser.parse('<font color="'+egret.toColorString(p)+'">'+PlayerGem.GetGemAttributeDesc(g,e,m,"\n")+"</font>")})}else l.push({icon:"",desc:Game.HtmlTextParser.parse("<font color=0x979572>"+lang.String("gem not insert")+"</font>")})}return this.gemList.dataProvider=new eui.ArrayCollection(l),this.gemList.parent!=this.group&&this.group.addChild(this.gemList),i},n.prototype.updateEquipmentSet=function(e,t,n,i){var a=EquipmentSet.equips[e][t];return a?(n++,this.adjustPosition(this.setInfo,n),this.setInfo.update(a,i),this.setInfo.parent!=this.group&&this.group.addChild(this.setInfo)):Game.removeFromParent.apply(this.setInfo),n},n.prototype.updateEquip=function(e,t,n,i){var a=Item.EquipParsePart[e.part],r=e.id,o=Game.Faction[PlayerAttribute.faction],s=table.equips[a][r];this.cell.icon=s[o].icon,this.cell.rbcorner=null;var l=e.quality||4;this.cell.quality=l;var u=Item.QualityColor[l];this.itemName.textFlow=Game.HtmlTextParser.parse("<font color="+u+">"+s[o].name+"</font>");var c=~~((s.level-1)/10);this.baseAttributeLabel.textFlow=Game.HtmlTextParser.parse(Item.Equip.getBaseDesc(l,a,c,s.level));var h=2;if(this.adjustPosition(this.randomAttributeLabel,h),e.attributes){for(var d=[],p=0;p<e.attributes;p++)d.push("?????");this.randomAttributeLabel.textFlow=Game.HtmlTextParser.parse("<font color="+u+">"+d.join("\n")+"</font>")}else this.randomAttributeLabel.text="";h=this.updateGems(a,s.level,n,h),h=this.updateEquipmentSet(a,r,h,i),Game.removeFromParent.apply(this.wuxingshiSuit),this.descLabel.textFlow=Game.HtmlTextParser.parse(s[o].desc)},n.prototype.updateEquipInstance=function(e,t,n,i,a){var r=e,o=r.Part;this.cell.icon=r.Icon,this.cell.rbcorner=null,this.cell.quality=r.Quality;var s=r.Name;t&&(s=r.Name+"  <font color="+color.Title2+">+"+t+"</color>"),null!=a&&(this.refineGroup.visible=!0,this.refineLevel.text=""+a),this.itemName.textFlow=Game.HtmlTextParser.parse(s),this.baseAttributeLabel.textFlow=Game.HtmlTextParser.parse(r.BaseDesc+"\n"+r.getBaseAttributesDesc(t,a));var l=1;r.LightAttributes.length>0?(l++,this.adjustPosition(this.randomAttributeLabel,l),this.randomAttributeLabel.textFlow=Game.HtmlTextParser.parse(r.getRandomAttributesDesc())):Game.removeFromParent.apply(this.randomAttributeLabel),l=this.updateGems(o,r.Level,n,l),l=this.updateEquipmentSet(o,r.Id,l,i),Game.removeFromParent.apply(this.wuxingshiSuit),this.descLabel.textFlow=Game.HtmlTextParser.parse(r.Desc)},n.prototype.updateBook=function(e,t){this.cell.icon=e.Icon,this.cell.quality=e.Quality,null!=t&&(this.cell.rbcorner=t.toString()),this.itemName.textFlow=Game.HtmlTextParser.parse(e.Name);var n=[];n.push(lang.String("FightingPower")+("<font color='"+egret.toColorString(color.Title1_Value)+"'>"+e.FP+"</font>")),n.push(lang.String("levelTitle")+"<font color='"+egret.toColorString(color.Title1_Value)+"'>"+e.getLevel()+"</font>");var i=table.books[e.Id],a=egret.createMap();a[1]=i.attack,a[17]=i.life,a[7]=i.defense;for(var r=0,o=e.attributes;r<o.length;r++){var s=o[r];a[s.id]?n.push(Buff.GetDesc(s.id,[s.values[0]+a[s.id]],!0)):n.push(Buff.GetDesc(s.id,s.values,!0))}this.baseAttributeLabel.textFlow=Game.HtmlTextParser.parse(n.join("\n")),this.adjustPosition(this.randomAttributeLabel,2),this.randomAttributeLabel.textFlow=Game.HtmlTextParser.parse(Item.Book.GetBookTalentSkillDesc(e.Id,e.grade)),this.baseMode2(),this.descLabel.textFlow=Game.HtmlTextParser.parse(e.Desc)},n.prototype.updateItem=function(e){var t=e.genre,n=e.detailType,i=table.props[t][n];switch(this.cell.icon=i.source,null!=e.count&&(this.cell.rbcorner=e.count.toString()),this.cell.quality=i.quality,this.cell.UpdatePiecesIcon(t),this.itemName.text=i.name,this.itemName.textColor=Item.QualityColor[this.cell.quality],t){case 5:this.adjustPosition(this.randomAttributeLabel,2),this.randomAttributeLabel.textFlow=Game.HtmlTextParser.parse(PlayerGem.GetAttributeDesc(n)),this.baseMode2();break;case 8:var a=Partner.GetPartnerCfg(n);this.baseAttributeLabel.textFlow=Game.HtmlTextParser.parse(""+Partner.GetPartnerBaseDesc(a)),this.adjustPosition(this.randomAttributeLabel,2),this.randomAttributeLabel.textFlow=Game.HtmlTextParser.parse(Partner.GetPartnerSkillDesc(a)),this.baseMode2();break;case 7:var r=[],o=table.books[n];r.push(lang.String("FightingPower")+"<font color="+color.Title1_Value+">"+o.fp+"</font>"),r.push(Buff.GetDesc(1,[o.attack],!0)),r.push(Buff.GetDesc(17,[o.life],!0)),r.push(Buff.GetDesc(7,[o.defense],!0)),this.baseAttributeLabel.textFlow=Game.HtmlTextParser.parse(r.join("\n")),this.adjustPosition(this.randomAttributeLabel,2),this.randomAttributeLabel.textFlow=Game.HtmlTextParser.parse(Item.Book.GetBookTalentSkillDesc(n,1)),this.baseMode2();break;case 1:if(null!=e.bagId){var s=PlayerAttribute.bag.items[e.bagId].Item,l=s.baseAttributeDesc;null!=l&&(this.baseAttributeLabel.textFlow=Game.HtmlTextParser.parse(l))}this.baseMode();break;case 20:this.cell.smallIcon=Wuxingyinmanager.GetWuxingshiSmallIcon(n);var u=Wuxingyinmanager.GetWuxingshiIdByDetail(n),c=Wuxingyinmanager.GetWuxingshiAttributeConfig(u),h=0,d=[];d.push(Buff.GetDesc(c.normalAttribute.buffId,[c.normalAttribute.params[h]],!0));for(var p=0;p<c.dungeonAttribute.length;p++){var g=c.dungeonAttribute[p];d.push(Wuxingyinmanager.getDungeonAttributeName(g.dungeonId,g.attribute)+":<font color="+color.Title1_Value+">"+g.Param[h]+"</font>")}this.baseAttributeLabel.textFlow=Game.HtmlTextParser.parse(d.join("\n")),Game.removeFromParent.apply(this.randomAttributeLabel),Game.removeFromParent.apply(this.gemList),Game.removeFromParent.apply(this.setInfo),this.adjustPosition(this.wuxingshiSuit,2),this.wuxingshiSuit.update(Wuxingyinmanager.GetSuitIdByWuxingshiId(u)),this.wuxingshiSuit.parent!=this.group&&this.group.addChild(this.wuxingshiSuit);break;default:this.baseMode()}if(null!=e.bagId){var s=PlayerAttribute.bag.items[e.bagId].Item;this.descLabel.textFlow=Game.HtmlTextParser.parse(s.Desc)}else this.descLabel.textFlow=Game.HtmlTextParser.parse(i.desc)},n.prototype.updatePartnerEquip=function(e){var t=table.partnerEquips[e.id];this.cell.icon=t.source,this.cell.quality=t.quality,this.itemName.textFlow=Game.HtmlTextParser.parse(PartnerEquipManager.GetPartnerEquipName(e.id)),this.baseAttributeLabel.textFlow=Game.HtmlTextParser.parse(PartnerEquipManager.GetEquipBaseDesc(e.id,e.star)),this.adjustPosition(this.randomAttributeLabel,2),this.randomAttributeLabel.textFlow=Game.HtmlTextParser.parse(PartnerEquipManager.GetEquipAttributeDesc(e.id,e.star)),this.baseMode2(),this.descLabel.textFlow=Game.HtmlTextParser.parse(t.desc)},n.prototype.updateCurrencyAward=function(e,t){this.baseMode(),this.cell.icon=e.icon,null!=e.content&&(this.cell.rbcorner=e.content.toString()),this.descLabel.textFlow=Game.HtmlTextParser.parse(e.getDesc(t));var n=e.quality;this.cell.quality=n,this.itemName.text=e.name,this.itemName.textColor=Item.QualityColor[n]},n.prototype.updateClientItem=function(e){this.baseMode(),this.cell.icon=e.icon,this.cell.rbcorner=e.count,this.descLabel.textFlow=Game.HtmlTextParser.parse(e.desc),this.cell.quality=e.quality,this.itemName.text=e.name,this.itemName.textColor=Item.QualityColor[this.cell.quality],this.cell.plugin=e.plugin||""},n.prototype.updateSuperWeapon=function(e){this.baseMode();var t=table.superWeaponCfg[e.id];this.cell.icon=t.icon;var n=e.level;null!=n&&(this.cell.rbcorner=n>0?lang.StringWithFormat("{1}level",n):lang.String("inactivate"));var i=t.costs.cost.genre,a=t.costs.cost.detailType,r=table.props[i][a];this.cell.quality=r.quality,this.itemName.text=t.name,this.itemName.textColor=Item.QualityColor[r.quality],this.descLabel.textFlow=Game.HtmlTextParser.parse(t.desc);var o=t.props[n],s=Buff.getBaseAttributeDesc(o);this.baseAttributeLabel.textFlow=Game.HtmlTextParser.parse(s)},n.prototype.updatePartner=function(e){var t=e,n=Partner.GetPartnerCfg(t);this.cell.icon=n.icon,this.cell.quality=n.quality,this.itemName.textFlow=Game.HtmlTextParser.parse(Partner.GetPartnerName(n)),this.baseAttributeLabel.textFlow=Game.HtmlTextParser.parse(Partner.GetPartnerBaseDesc(n)+"\n"+Partner.GetPartnerSkillDesc(n)),this.descLabel.text=n.desc},n.prototype.updateAvatar=function(e){this.baseMode();var t=table.avatars[e.id],n=table.props[t.item.genre][t.item.detailType];this.cell.icon=n.source,null!=e.level&&(this.cell.rbcorner=e.level>0?lang.StringWithFormat("{1}level",e.level):lang.String("inactivate")),this.itemName.text=n.name,this.itemName.textColor=Item.QualityColor[n.quality],this.descLabel.textFlow=Game.HtmlTextParser.parse(n.desc);var i=e.level||1,a=Buff.getBaseAttributeDesc(t.attributes[i-1]);this.baseAttributeLabel.textFlow=Game.HtmlTextParser.parse(a)},n.prototype.updateJueXue=function(e){this.baseMode2();var t=e.item;this.cell.icon=t.Icon,this.cell.quality=t.Quality,this.cell.lbcorner=t.Level>0?"+"+t.Level:"",this.cell.jxFontNote=t.FontNoteIcon,this.itemName.textFlow=Game.HtmlTextParser.parse(t.Name),this.baseAttributeLabel.textFlow=Game.HtmlTextParser.parse(t.getDesc()),this.adjustPosition(this.randomAttributeLabel,2),this.randomAttributeLabel.textFlow=Game.HtmlTextParser.parse(t.getSuitDesc(e.juexues)),this.descLabel.textFlow=Game.HtmlTextParser.parse(t.Desc)
},n.prototype.updateWenShi=function(e){this.baseMode(),this.cell.icon=e.Icon,this.cell.quality=e.Quality,this.itemName.text=e.Name,this.descLabel.text=e.Desc,this.baseAttributeLabel.textFlow=Game.HtmlTextParser.parse(e.getDesc()),this.showStar(e.phase)},n.prototype.hideAllStar=function(){this.stars=[],this.stars[0]=this.star0,this.stars[1]=this.star1,this.stars[2]=this.star2,this.stars[3]=this.star3,this.stars[4]=this.star4;for(var e=0;e<this.stars.length;e++)this.stars[e].visible=!1},n.prototype.showStar=function(e){if(!(e>this.stars.length))for(var t=0;e>t;t++)this.stars[t].visible=!0},n.prototype.update=function(e,t){if(null!=e){var n=t?t.enhancement:null,i=t?t.gems:null,a=t?t.desc:null,r=t?t.equips:null;null==r&&(r=PlayerAttribute.Equips);var o=t?t.refineLevel:null;this.clear(),null!=e.obtainId?(this.btnObtain.parent!=this.group&&this.group.addChild(this.btnObtain),this.obtainId=e.obtainId):Game.removeFromParent.apply(this.btnObtain);var s=e.content;switch(this.hideAllStar(),e.type){case"equipInstance":this.updateEquipInstance(s,n,i,r,o);break;case"equip":this.updateEquip(s,n,i,r);break;case"bookInstance":this.updateBook(s,null);break;case"book":this.updateBook(new Item.Book({id:s.id,grade:0,exp:0,attribute:[]}),s.count);break;case"item":this.updateItem(s);break;case"partnerEquip":this.updatePartnerEquip(s);break;case"clientitem":this.updateClientItem(e);break;case"superWeapon":this.updateSuperWeapon(s);break;case"partner":this.updatePartner(s);break;case"exp":case"goldCoin":case"silverCoin":case"copperCoin":case"practiceCoin":case"arenaCoin":case"readingCoin":case"pith":case"guildContribution":case"jade":case"betCoin":case"collectCardExp":case"fubi":this.updateCurrencyAward(new table.CurrencyAward(e.type,e.content),a);break;case"collecttreasurecard":this.updateCurrencyAward(new table.CollectTreasureCardAward(e.type,e.content),a);break;case"avatar":this.updateAvatar(s);break;case"juexueInstance":this.updateJueXue(s);break;case"jxBook15Turntable":this.updateCurrencyAward(new table.JxBook15Turntable(e.type,e.content),a);break;case"wenshiInstance":this.updateWenShi(s);break;case"globalwheelCurrency":this.baseMode(),this.cell.icon=Game.currency2Icon[e.content.type],this.cell.quality=5,this.cell.rbcorner=e.content.percentage+"%",this.descLabel.textFlow=Game.HtmlTextParser.parse("Trong kho thưởng toàn server "+lang.String(Game.currency2AwardType[e.content.type])+"-"+this.cell.rbcorner),this.itemName.text=lang.String(Game.currency2AwardType[e.content.type]),this.itemName.textColor=Item.QualityColor[5]}}},n.prototype.clear=function(){this.itemName.text=lang.String("None"),this.baseAttributeLabel.text="",this.descLabel.text="",this.cell.plugin=null,this.cell.rbcorner=null,this.cell.smallIcon=null,this.cell.jxFontNote=null,this.obtainId=null,this.descLabel.maxWidth=this.width-32},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnObtain:null!=this.obtainId&&e.ResourceObtain.Open([this.obtainId])}},n.prototype.baseMode=function(){Game.removeFromParent.apply(this.randomAttributeLabel),Game.removeFromParent.apply(this.gemList),Game.removeFromParent.apply(this.setInfo),Game.removeFromParent.apply(this.wuxingshiSuit),this.descLabel.maxWidth=this.width-82},n.prototype.baseMode2=function(){Game.removeFromParent.apply(this.gemList),Game.removeFromParent.apply(this.setInfo),Game.removeFromParent.apply(this.wuxingshiSuit)},n}(e.FitComponent);e.ItemInfo=i,__reflect(i.prototype,"UI.ItemInfo",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.bagId=-1,t.skinName="ItemJueXueSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.onAddToStage=function(){},t.prototype.onRemoveFromStage=function(){},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnDismantling:if(this.bagId<0)return;var t=new net.def.UInt32Silce;t.values.push(this.bagId),net.socket.write(2113,t.toArrayBuffer());break;case this.btnMount:if(this.bagId<0)return;var n=new net.def.UInt32;n.value=this.bagId,net.socket.write(2114,n.toArrayBuffer())}},t.prototype.update=function(e,t){if(null!=e&&e.Item instanceof Item.JueXue){this.bagId=e.Id;var n=e.Item;this.cell.icon=n.Icon,this.cell.quality=n.Quality,this.cell.lbcorner=n.Level>0?"+"+n.Level:"",this.cell.jxFontNote=n.FontNoteIcon,this.itemName.textFlow=Game.HtmlTextParser.parse(n.Name),this.baseAttributeLabel.textFlow=Game.HtmlTextParser.parse(n.getDesc()),this.randomAttributeLabel.textFlow=Game.HtmlTextParser.parse(n.getSuitDesc(t));var i=e.Id<0||null==PlayerAttribute.bag.GetBagItem(e.Id)?!0:!1;this.imgMount.source=i?"ui/common1/ycd_0.png":"",this.btnGroup.visible=!i}},t.prototype.clear=function(){this.bagId=-1,this.itemName.text=lang.String("None"),this.baseAttributeLabel.text="",this.randomAttributeLabel.text="",this.imgMount.source="",this.btnGroup.visible=!1,this.cell.icon=null,this.cell.quality=null,this.cell.lbcorner=null,this.cell.jxFontNote=null,this.cell.plugin=null,this.cell.rbcorner=null,this.cell.smallIcon=null},t}(e.FitComponent);e.ItemJueXue=t,__reflect(t.prototype,"UI.ItemJueXue",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.data=null,e.selectImg="ui/common1/btn_check2_1d1.png",e.noSelectImg="ui/common1/btn_check2_0u.png",e.skinName="ItemSplitItemSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.dataChanged=function(){null!=this.data&&(this.cell.data=this.data.item,this.imgSelect.source=this.data.selecte?this.selectImg:this.noSelectImg)},n.prototype.onTouchTap=function(e){switch(e.target){case this.cell:this.displayTips();break;default:this.selectItem()}},n.prototype.displayTips=function(){if(null!=this.data){var t=null;if(this.data.item.Item instanceof Item.JueXue){var n=this.data.item.Item;t={type:"juexueInstance",content:{item:n,juexues:PlayerAttribute.juexues}}}null!=t&&(e.ItemTips.instance.data=t,UIManager.push(e.ItemTips.instance))}},n.prototype.selectItem=function(){this.data.selecte=!this.data.selecte,this.imgSelect.source=this.data.selecte?this.selectImg:this.noSelectImg,Game.dispatcher.dispatchEventWith(Game.EVENT.ItemSplitChange)},n}(eui.ItemRenderer);e.ItemSplitItem=t,__reflect(t.prototype,"UI.ItemSplitItem")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="ItemSplitMaterialItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){var e=table.props[this.data.genre][this.data.detail];this.materialName.textFlow=Game.HtmlTextParser.parse(e.name),this.num=this.data.num,this.cell.data={type:"item",content:{genre:this.data.genre,detailType:this.data.detail}}},t}(eui.ItemRenderer);e.ItemSplitMaterialItem=t,__reflect(t.prototype,"UI.ItemSplitMaterialItem")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.array=[],n.arrCheckBos=[],n.skinName="ItemSplitUISkin",n.list.itemRenderer=e.ItemSplitItem,n.listMaterial.itemRenderer=e.ItemSplitMaterialItem,n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.arrCheckBos.push(n.selectWhite),n.arrCheckBos.push(n.selectGreen),n.arrCheckBos.push(n.selectBlue),n.arrCheckBos.push(n.selectPurple),n.arrCheckBos.push(n.selectOrange),n.arrCheckBos.push(n.selectRed),n}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onOpenUI=function(e,t,i,a,r,o){this.array=[],this.panel.title=e;for(var s=0;s<i.length;s++)this.array.push({item:i[s],selecte:!1});switch(this.funcCost=a,this.funcSplit=r,t){case 1:Game.removeFromParent.apply(this.selectWhite)}null==o&&(o=!1),o?UIManager.push(n.instance):UIManager.pushPage(n.instance)},n.prototype.onAddToStage=function(){this.refreshItems(),this.refreshCosts(),Game.dispatcher.addEventListener(Game.EVENT.ItemSplitChange,this.selectItemChange,this),Game.dispatcher.addEventListener(Game.EVENT.AddItem,this.refresh,this),Game.dispatcher.addEventListener(Game.EVENT.RemoveItem,this.refresh,this),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,this.refresh,this),Game.dispatcher.addEventListener(Game.EVENT.BagItemChange,this.refresh,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.ItemSplitChange,this.selectItemChange,this),Game.dispatcher.removeEventListener(Game.EVENT.AddItem,this.refresh,this),Game.dispatcher.removeEventListener(Game.EVENT.RemoveItem,this.refresh,this),Game.dispatcher.removeEventListener(Game.EVENT.UpdateItem,this.refresh,this),Game.dispatcher.removeEventListener(Game.EVENT.BagItemChange,this.refresh,this),this.list.dataProvider=null,this.listMaterial.dataProvider=null,this.resetCheckBox()},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close();break;case this.btnSplit:this.split();break;case this.selectWhite:case this.selectGreen:case this.selectBlue:case this.selectPurple:case this.selectOrange:case this.selectRed:this.selectQuality()}},n.prototype.close=function(){UIManager.pop(this)},n.prototype.resetCheckBox=function(){for(var e=0;e<this.arrCheckBos.length;e++)this.arrCheckBos[e].selected=!1},n.prototype.selectItemChange=function(){this.resetCheckBox(),this.refreshCosts()},n.prototype.refreshItems=function(){var e=this.list.dataProvider;null==e?this.list.dataProvider=new eui.ArrayCollection(this.array):e.replaceAll(this.array)},n.prototype.getSelectedItems=function(){for(var e=[],t=0;t<this.array.length;t++)this.array[t].selecte&&e.push(this.array[t].item);return e},n.prototype.refreshCosts=function(){var e=this.getSelectedItems(),t=this.funcCost(e),n=this.listMaterial.dataProvider;null==n?this.listMaterial.dataProvider=new eui.ArrayCollection(t):n.replaceAll(t)},n.prototype.selectQuality=function(){for(var e={},t=0;t<this.arrCheckBos.length;t++)this.arrCheckBos[t].selected&&(e[t]=1);for(var t=0;t<this.array.length;t++)null!=e[this.array[t].item.Item.Quality]?this.array[t].selecte=!0:this.array[t].selecte=!1;this.refreshItems(),this.refreshCosts()},n.prototype.refresh=function(){for(var e=[],t=0;t<this.array.length;t++){var n=this.array[t];null!=PlayerAttribute.bag.GetBagItem(n.item.Id)&&e.push({item:n.item,selecte:!1})}this.array=e,this.selectQuality()},n.prototype.split=function(){var e=this.getSelectedItems();this.funcSplit(e)},n}(e.FitComponent);e.ItemSplitUI=t,__reflect(t.prototype,"UI.ItemSplitUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="ItemTipsSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.onTouchTap=function(){this.close()},t.prototype.close=function(){UIManager.pop(this)},t.prototype.onAddToStage=function(){this.itemTip.update(this.data,{desc:this.desc})},t.prototype.onRemoveFromStage=function(){this.data=null,this.desc=null},t}(e.FitComponent);e.ItemTips=t,__reflect(t.prototype,"UI.ItemTips",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="JingCuiPanelSkin",t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.Close=function(){null!=this._instance&&UIManager.pop(this._instance)},t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoveFromStage,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.tab.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this)},t.prototype.onAddToStage=function(){switch(null==this.page&&this.changePage(0),this.page){case 0:null!=this.selectpart&&(this.RefineUI.selectIndex=this.selectpart)}},t.prototype.onRemoveFromStage=function(){this.selectpart=null},t.prototype.setPage=function(e){switch(this.page=e,e){case 0:this.viewPage=0;break;case 1:this.viewPage=1}},t.prototype.changePage=function(e){this.setPage(e)},t.prototype.onItemTap=function(){var e=this.tab.selectedIndex;this.page!=e&&this.setPage(e),this.RefineUI.stopAutoRefining()},t.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:UIManager.pop(this)}},t}(e.FitComponent);e.JingCuiPanel=t,__reflect(t.prototype,"UI.JingCuiPanel",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.circleRadius=0,t.ballRadius=0,t.centerX=0,t.centerY=0,t.p1=new egret.Point,t.p2=new egret.Point,t.skinName="JoystickSkin",t.circleRadius=t.circle.height/2,t.ballRadius=t.ball.height/2,console.log(t.circleRadius,t.ballRadius),t.centerX=t.circleRadius,t.centerY=t.circleRadius,t.anchorOffsetX=t.circleRadius,t.anchorOffsetY=t.circleRadius,t.ball.x=t.centerX,t.ball.y=t.centerY,t.ball.anchorOffsetX=t.ballRadius,t.ball.anchorOffsetY=t.ballRadius,t}return __extends(t,e),t.prototype.start=function(){var e=egret.MainContext.instance.stage;e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),e.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),e.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this)},t.prototype.stop=function(){var e=egret.MainContext.instance.stage;e.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),e.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),e.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.hide(),AI.bb.joystick=!1,AI.bb.dir=null},t.prototype.onTouchBegin=function(e){if(!this.parent){var t=egret.MainContext.instance.stage;e.stageX<=65||e.stageX>300||e.stageY<t.stageHeight-300||(this.touchID=e.touchPointID,this.x=e.stageX,this.y=e.stageY,this.ball.x=this.centerX,this.ball.y=this.centerY,t.addChild(this),AI.bb.joystick=!0,AI.bb.dir=null,AI.SelectTarget(null),AI.TouchObj(null),AI.stopMove())}},t.prototype.onTouchEnd=function(e){this.touchID==e.touchPointID&&(this.touchID=null,this.hide(),AI.bb.joystick=!1,AI.bb.dir=null)},t.prototype.onTouchMove=function(e){if(this.touchID==e.touchPointID){this.p1.x=this.x,this.p1.y=this.y,this.p2.x=e.stageX,this.p2.y=e.stageY;var t=egret.Point.distance(this.p1,this.p2);if(0!=t){var n=g_GetDirIndex2(this.p1,this.p2),i=n.dir,a=n.sin,r=n.cos;t<=this.circleRadius-this.ballRadius?(this.ball.x=this.centerX+(e.stageX-this.x),this.ball.y=this.centerY+(e.stageY-this.y)):(this.ball.x=r/1024*(this.circleRadius-this.ballRadius)+this.centerX,this.ball.y=a/1024*(this.circleRadius-this.ballRadius)+this.centerY),Player.instance.revisePos=null,AI.bb.dir!=i&&(AI.bb.skill=null,AI.bb.dir=i)}}},t.prototype.hide=function(){this.parent&&this.parent.removeChild(this)},t}(eui.Component);e.Joystick=t,__reflect(t.prototype,"UI.Joystick")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="JueXueAttrLabelSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(){},t.prototype.onRemoveFromStage=function(){this.desc.text="",this.arrow.source="",this.change.text=""},t.prototype.dataChanged=function(){null!=this.data&&(this.desc.textFlow=Game.TextParser.parse(this.data.desc),this.arrow.source=this.data.source,this.change.textFlow=Game.TextParser.parse(this.data.change))},t.prototype.refresh=function(){this.dataChanged()},t}(eui.ItemRenderer);e.JueXueAttrLabel=t,__reflect(t.prototype,"UI.JueXueAttrLabel")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="JueXueSuitLabelSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(){},t.prototype.onRemoveFromStage=function(){this.desc1.text="",this.desc2.text=""},t.prototype.dataChanged=function(){null!=this.data&&(this.desc1.textFlow=Game.TextParser.parse(this.data.desc1),this.desc2.textFlow=Game.TextParser.parse(this.data.desc2))},t}(eui.ItemRenderer);e.JueXueSuitLabel=t,__reflect(t.prototype,"UI.JueXueSuitLabel")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.curPart=-1,e.skinName="JueXueUISkin",e.autoLevelUp=MakeDelayExecute(function(t){e.levelUp()},e,800),e.mc.removeWhenComplete=!1,e.mc.visible=!1,e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,e.onTapList,e),e}return __extends(n,t),n.prototype.onAddToStage=function(){this.refresh(),this.mc.Load("skill/Ui_qianghua01/Ui_qianghua01.json","Ui_qianghua01"),Game.dispatcher.addEventListener(Game.EVENT.AddItem,this.refresh,this),Game.dispatcher.addEventListener(Game.EVENT.JueXueChange,this.refresh,this),this.mainAttributes.addEventListener(egret.Event.COMPLETE,this.refreshMainAttrDesc,this),this.randomAttribute.addEventListener(egret.Event.COMPLETE,this.refreshAssistAttrDesc,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.AddItem,this.refresh,this),Game.dispatcher.removeEventListener(Game.EVENT.JueXueChange,this.refresh,this),this.mainAttributes.removeEventListener(egret.Event.COMPLETE,this.refreshMainAttrDesc,this),this.randomAttribute.removeEventListener(egret.Event.COMPLETE,this.refreshAssistAttrDesc,this),this.autoLevelUp.stop(),this.mainAttributes.stop(),this.randomAttribute.stop(),this.mc.stop(),this.mc.visible=!1,this.mc.free()},n.prototype.showEffect=function(e,t){this.mc.x=e-6,this.mc.y=t+10,this.mc.gotoAndPlay(0,1)},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnLevelUp:this.levelUp();break;case this.btnBreakout:this.breakOut();break;case this.btnChange:this.change();break;case this.imageChip:var n=e.ItemTips.instance;n.data={type:"item",content:{genre:Item.JueXueChip.genre,detailType:Item.JueXueChip.detail,count:1}},UIManager.push(e.ItemTips.instance)}},n.prototype.onTapList=function(e){(this.curPart!=e.itemIndex||null==PlayerAttribute.juexues[e.itemIndex+1])&&(this.curPart=e.itemIndex,this.refreshCell(),this.refreshBaseDesc(),this.refreshMainAttrDesc(),this.refreshAssistAttrDesc(),this.refreshSuitDesc(),this.refreshActivateSuitDesc(),this.refreshCost(),null==PlayerAttribute.juexues[this.curPart+1]&&this.change())},n.prototype.refresh=function(e){this.fp=PlayerAttribute.GetJueXueFightPower(PlayerAttribute.juexues);for(var t=[],n=0;n<Item.JueXuePartsCount;n++){var i=PlayerAttribute.juexues[n+1];null!=i?(this.curPart<0&&(this.curPart=n),t.push({icon:i.Icon,quality:i.Quality,lbcorner:i.Level>0?"+"+i.Level:"",jxFontNote:i.FontNoteIcon,addImg:"",action:""+badge.JueXueCell[n]})):t.push({icon:"",quality:0,lbcorner:"",jxFontNote:"",addImg:"ui/forge/add_bg.png",action:""+badge.JueXueCell[n]})}var a=this.list.dataProvider;null==a?this.list.dataProvider=new eui.ArrayCollection(t):a.replaceAll(t),this.refreshCell(),this.refreshBaseDesc(),null!=e&&null!=e.data&&null!=e.data.bLevelUp&&e.data.bLevelUp?(this.mainAttributes.play(0),this.autoLevelUp(),this.showEffect(this.curCell.x,this.curCell.y)):null!=e&&null!=e.data&&null!=e.data.bBreakout&&e.data.bBreakout?(this.randomAttribute.play(0),this.showEffect(this.curCell.x,this.curCell.y)):(this.refreshMainAttrDesc(),this.refreshAssistAttrDesc()),this.refreshSuitDesc(),this.refreshActivateSuitDesc(),this.refreshCost()},n.prototype.refreshCell=function(){var e=PlayerAttribute.juexues[this.curPart+1];null!=e?(this.curCell.icon=e.Icon,this.curCell.quality=e.Quality,this.curCell.lbcorner=e.Level>0?"+"+e.Level:"",this.curCell.jxFontNote=e.FontNoteIcon):(this.curCell.icon="",this.curCell.quality=0,this.curCell.lbcorner="",this.curCell.jxFontNote="")},n.prototype.refreshCost=function(){var e=PlayerAttribute.juexues[this.curPart+1];if(null!=e&&e.NeedBreak)return this.btnLevelUp.visible=!1,this.btnBreakout.visible=!0,void(this.groupCost.visible=!1);this.btnLevelUp.visible=!0,this.btnBreakout.visible=!1,this.groupCost.visible=!0;var t=null!=e?table.juexuelevelup.growthCost[e.Quality][e.Level]:0;t=null!=t?t:0;var n=PlayerAttribute.bag.getCount(Item.JueXueChip.genre,Item.JueXueChip.detail),i=0!=t&&n>=t,a=i?color.GREEN:color.RED;this.btnLevelUp.enabled=i,this.costTip.textFlow=Game.TextParser.parse("<font color="+a+">"+n+"</font>/"+t)},n.prototype.refreshBaseDesc=function(){var e=PlayerAttribute.juexues[this.curPart+1],t=null!=e;this.curName.textFlow=Game.TextParser.parse(t?e.Name:""),this.baseDesc.textFlow=Game.TextParser.parse(t?e.getBaseDesc():"")},n.prototype.refreshMainAttrDesc=function(){var e=PlayerAttribute.juexues[this.curPart+1],t=null!=e;this.mainAttr.data=t?e.getMainAttrDesc():{desc:"",source:"",change:""},this.mainAttr.refresh()},n.prototype.refreshAssistAttrDesc=function(){var e=PlayerAttribute.juexues[this.curPart+1],t=null!=e,n=t?e.getAssistAttrDesc():[],i=this.listAttr.dataProvider;null==i?this.listAttr.dataProvider=new eui.ArrayCollection(n):i.replaceAll(n)},n.prototype.refreshSuitDesc=function(){var e=PlayerAttribute.juexues[this.curPart+1],t=null!=e;this.suitDesc.textFlow=Game.TextParser.parse(t?e.getSuitDesc(PlayerAttribute.juexues):"")},n.prototype.refreshActivateSuitDesc=function(){for(var e=[],t=PlayerAttribute.GetJueXueSuit(PlayerAttribute.juexues),n=0;n<t.Attr.length;n++){var i=t.Attr[n].name,a=t.Attr[n].quality,r=t.Attr[n].attr,o=t.Attr[n].count,s=t.Attr[n].limit,l=Item.QualityColor[a],u="<font color="+l+">"+i+"</font>",c="<font color="+l+">("+o+"/"+s+") "+Buff.GetDesc(r.attrId,r.attrValue)+"</font>";e.push({desc1:u,desc2:c})}var h=this.listSuit.dataProvider;null==h?this.listSuit.dataProvider=new eui.ArrayCollection(e):h.replaceAll(e)},n.prototype.levelUp=function(){var e=PlayerAttribute.juexues[this.curPart+1];if(null!=e&&!e.NeedBreak){var t=new net.def.UInt32;t.value=this.curPart+1,net.socket.write(2115,t.toArrayBuffer())}},n.prototype.change=function(){this.curPart>=0&&this.curPart<Item.JueXuePartsCount&&(e.UseItemJueXue.instance.onOpenUI2(this.curPart+1),badge.onLight(badge.JueXueCell[this.curPart],!1))},n.prototype.breakOut=function(){var e=PlayerAttribute.juexues[this.curPart+1];if(null!=e&&e.NeedBreak){var t=new net.def.UInt32;t.value=this.curPart+1,net.socket.write(2116,t.toArrayBuffer())}},n}(eui.Component);e.JueXueUI=t,__reflect(t.prototype,"UI.JueXueUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="JxBook15Skin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.list.itemRenderer=e.JxBook15Item,n}return __extends(n,t),n.prototype.onAddToStage=function(){this.onUpdate(),Game.dispatcher.addEventListener(Game.EVENT.ActivityJxBook15,this.onUpdate,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.ActivityJxBook15,this.onUpdate,this)},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnRules:e.GameTip.instance.open("jxbook15")}},n.prototype.onUpdate=function(){if(null!=ActivityJxBook15._data&&null!=ActivityJxBook15.cfg){for(var e=ActivityJxBook15.cfg.bookexp.length,t=0,n=0,i=0,a=0;a<ActivityJxBook15.cfg.bookexp.length;a++){var r=ActivityJxBook15.cfg.bookexp[a];if(n+=r,ActivityJxBook15._data.bookExp<n){i=a,t=r-(n-ActivityJxBook15._data.bookExp),n=r;break}}this.level.textFlow=Game.TextParser.parse("Cấp hiện tại: <font color='"+color.GREEN+"'>"+i+"/"+e+"</font>"),this.lefttime.textFlow=Game.TextParser.parse("Hoạt động còn: <font color='"+color.GREEN+"'>"+ActivityJxBook15.activity.reaminingTime+"</font>"),this.charge.text=lang.Format("Nạp đủ {1} KNB mới có thể nhận thưởng, Đại Hiệp đã nạp {2} KNB",200,ActivityJxBook15._data.charge),this.bar.maximum=n,this.bar.value=t;for(var o=[],s=!1,l=!1,u=ActivityJxBook15._data.charge>=200,a=ActivityJxBook15._data.awardIndex+1;a<=ActivityJxBook15.cfg.bookexp.length;a++){var r=ActivityJxBook15.cfg.awards[a];null!=r&&(s=!l&&i>=a,s&&(l=!0),o.push({config:r,level:a,award:s?1:0,action:s?""+badge.action.JxBook15:"",charged:u}))}for(var a=1;a<ActivityJxBook15._data.awardIndex+1;a++){var r=ActivityJxBook15.cfg.awards[a];null!=r&&o.push({config:r,level:a,award:2,action:"",charged:!1})}var c=this.list.dataProvider;null==c?this.list.dataProvider=new eui.ArrayCollection(o):c.replaceAll(o),badge.onLight(badge.action.JxBook15,l)}},n}(eui.Component);e.JxBook15=t,__reflect(t.prototype,"UI.JxBook15",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="JxBook15ItemSkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.list.itemRenderer=e.AwardCell,n}return __extends(n,t),n.prototype.onAddToStage=function(){this.dataChanged()},n.prototype.onRemoveFromStage=function(){},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnAward:if(!this.data.charged)return Recharge.openRechargeUI(),void PopUpMessage.push(lang.Format("Đại Hiệp nạp chưa đủ {1} KNB, không thể nhận thưởng!",200),color.RED);net.socket.write(140,null)}},n.prototype.dataChanged=function(){if(null!=this.data){this.level="Mật Đồ Thần Bí LV"+this.data.level,this.btnAward.enabled=1==this.data.award,this.btnAward.label=2==this.data.award?"Đã nhận thưởng":"Nhận thưởng",this.btnAward.action=this.data.action;this.list.dataProvider;this.list.dataProvider=new eui.ArrayCollection(this.data.config.award.content)}},n}(eui.ItemRenderer);e.JxBook15Item=t,__reflect(t.prototype,"UI.JxBook15Item")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="KillMsgUISkin",t}return __extends(t,e),t.show=function(e,n){var i=new t,a=~~(messageLayer.width/2-150),r=~~(.24*messageLayer.height);i.targetName=e,n?(i.currentState="kill",a+=randMaxAbs(50),r+=randMaxAbs(50)):i.currentState="killed",i.x=a,i.y=r,messageLayer.addChild(i),egret.Tween.get(i).set({alpha:1}).wait(2e3).to({y:i.y-80,alpha:.1},200,egret.Ease.sineOut).set({currentState:"kill",targetName:"",alpha:1}).call(Game.removeFromParent,i)},t}(eui.Component);e.KillMsgUI=t,__reflect(t.prototype,"UI.KillMsgUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(t,n){var i=e.call(this)||this;i.skinName="LevelUpNoticeUISkin",i.oldLevel=t,i.newLevel=n,i.addEventListener(egret.TouchEvent.TOUCH_TAP,i.onTouchTap,i);var a=0;180>=t&&180>=n?a=n-t:180>=t&&n>180&&(a=180-t);var r=i.newLevel-i.oldLevel,o=table.level[i.oldLevel],s=table.level[i.newLevel];i.lblFP.textFlow=Game.HtmlTextParser.parse("+"+(s.fightingPower-o.fightingPower)),i.lblAP.textFlow=Game.HtmlTextParser.parse("+"+5*r),i.lblSP.textFlow=Game.HtmlTextParser.parse("+"+a);var l=i.getFeatures(table.level_features[i.newLevel]);return l?i.list.dataProvider=new eui.ArrayCollection(l):i.list.dataProvider=new eui.ArrayCollection([]),i.g1.play(0),egret.setTimeout(i.close,i,5*Game.Second),i}return __extends(t,e),t.prototype.close=function(){this.g1.stop(),UIManager.pop(this)},t.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:case this.btnClose:this.close()}},t.prototype.getFeatures=function(e){if(!e)return null;if(e.param)switch(e.param.type){case"skill":var t=PlayerAttribute.skillSlots,n=e.param.id-1;return[{img:t[n].icon,name:t[n].name}];default:return null}return e.features},t}(e.FitComponent);e.LevelUpNoticeUI=t,__reflect(t.prototype,"UI.LevelUpNoticeUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.skinName="LittleBossInfoSkin",e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.open=function(e){var t=this.instance;return t.bossIdx=e,UIManager.push(t),t},n.close=function(){null!=this._instance&&Game.removeFromParent.apply(this._instance)},n.prototype.onAddToStage=function(){var e=LittleBoss.getMissions().items[this.bossIdx];this.itemName.text=e.name,this.descLabel.textFlow=Game.HtmlTextParser.parse(e.desc),this.list.dataProvider=new eui.ArrayCollection(e.awardsList),this.bossIcon.setResource(e.resource,null,null),this.btnRaid.enabled=!e.first;var t,n=e.maxCount-e.enterCount;n>0?t=color.GREEN:(t=color.RED,n=0),this.tipsLabel.textFlow=Game.HtmlTextParser.parse(lang.StringWithFormat("left count","<font color="+t+">"+n+"</font>"))},n.prototype.onRemoveFromStage=function(){this.bossIcon.clear()},n.prototype.onTouchTap=function(t){var n=!1;switch(t.target){case this.btnEntry:n=LittleBoss.sureEnterLittleBossMap(this.bossIdx,!1),n&&e.MapCabinet.close();break;case this.btnRaid:if(!Recharge.isTimingCard(Recharge.MonthlyCard_Type)||PlayerAttribute.Level<40)return void PopUpMessage.push(StringWithFormat("Người chơi Thẻ Tháng đạt Lv{1} có thể càn quét trực tiếp!",40),color.Warning);n=LittleBoss.sureEnterLittleBossMap(this.bossIdx,!0),n&&this.close();break;case this.imgClose:return void this.close();default:return}},n}(e.FitComponent);e.LittleBossInfo=t,__reflect(t.prototype,"UI.LittleBossInfo",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.remainingTime=new RemainingTime,t.skinName="LittleBossNoteSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.onAddToStage=function(){SecondTicker.addEventListener(this.updateRestTime,this)},t.prototype.onRemoveFromStage=function(){SecondTicker.removeEventListener(this.updateRestTime,this)},t.prototype.updateRestTime=function(){this.txtTime=this.remainingTime.getMinuteSecond()},t.prototype.updateBossHP=function(e,t){null!=this.bossBar&&(this.bossBar.maximum=e,this.bossBar.value=t)},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnExit:net.socket.write(141,null)}},t}(e.FitComponent);e.LittleBossNote=t,__reflect(t.prototype,"UI.LittleBossNote",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="LoadingIconAnimationSkin",e.listener=!1,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.loadanimation.addEventListener(egret.Event.COMPLETE,e.playLoadingAnimation,e),e.playLoadingAnimation(),e
}return __extends(n,t),n.open=function(){return null==this._instance&&(this._instance=new n,this._instance.listener=!0),loadingLayer.addChild(this._instance),this._instance},n.close=function(){null!=this._instance&&(null!=this._instance.parent&&this._instance.parent.removeChild(this._instance),this._instance=null)},n.prototype.onAddToStage=function(){this.listener&&(Game.dispatcher.addEventListener(Game.EVENT.LoadingSuccess,this.onEvent,this),Game.dispatcher.addEventListener(Game.EVENT.LoadingFailed,this.onEvent,this))},n.prototype.onRemoveFromStage=function(){this.listener&&(Game.dispatcher.removeEventListener(Game.EVENT.LoadingSuccess,this.onEvent,this),Game.dispatcher.removeEventListener(Game.EVENT.LoadingFailed,this.onEvent,this))},n.prototype.close2=function(){Game.removeFromParent.apply(this)},n.prototype.onEvent=function(){e.LoadingIconAnimation.close()},n.prototype.playLoadingAnimation=function(){this.loadanimation.play(0)},n}(e.FitComponent);e.LoadingIconAnimation=t,__reflect(t.prototype,"UI.LoadingIconAnimation",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.skinName="LoginGiftSkin",t.tab.addEventListener(eui.UIEvent.CHANGE,t.onDaySelected,t),t.btnGetAward.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onWithDraw,t),t.imgGroup.addEventListener(egret.Event.COMPLETE,t.onTweenGroupComplete,t),t.imgGroup.play(0),t}return __extends(t,e),t.prototype.close=function(){UIManager.pop(this)},t.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:case this.btnBack:case this.btnClose:this.close()}},t.prototype.onAddToStage=function(){this.mc.visible=!0,this.mc.Load("skill/vip_bg2/vip_bg2.json","vip_bg2"),this.mc.gotoAndPlay(0,-1);var e=ActivityLoginGift.withDay();null!=e.idx?this.tab.selectedIndex=e.idx:this.tab.selectedIndex=0,this.onUpdate(),Game.dispatcher.addEventListener(Game.EVENT.LoginGiftLogin,this.onUpdate,this)},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.LoginGiftLogin,this.onUpdate,this),this.mc.visible=!1,this.mc.stop(),this.mc.free()},t.prototype.changePage=function(e){this.tab.selectedIndex=e,this.onUpdate()},t.prototype.onDaySelected=function(e){var t=this.tab.selectedIndex;null==ActivityLoginGift._data||0>t||(this.cell.data=ActivityLoginGift.cfg[t].content[0],this.cell.onRefresh(),this.giftIcon0=ActivityLoginGift.cfg[this.tab.selectedIndex].icons[0],this.giftIcon1=ActivityLoginGift.cfg[this.tab.selectedIndex].icons[1],this.showBtnAwardStatus(t))},t.prototype.onWithDraw=function(){if("up"==this.btnGetAward.currentState){var e=new net.def.C2SGetCumulativeLoginBonus;e.index=this.tab.selectedIndex,net.socket.write(106,e.toArrayBuffer())}},t.prototype.onUpdate=function(){if(null!=ActivityLoginGift._data){this.cell.data=ActivityLoginGift.cfg[this.tab.selectedIndex].content[0],this.cell.onRefresh(),this.giftIcon0=ActivityLoginGift.cfg[this.tab.selectedIndex].icons[0],this.giftIcon1=ActivityLoginGift.cfg[this.tab.selectedIndex].icons[1],this.showBtnAwardStatus(this.tab.selectedIndex);for(var e=0;e<ActivityLoginGift._data.bonus.length;e++)this["day"+(e+1)+"Notice"]=!ActivityLoginGift._data.bonus[e]&&e<ActivityLoginGift._data.count}},t.prototype.showBtnAwardStatus=function(e){if(null!=ActivityLoginGift._data){var t=!ActivityLoginGift._data.bonus[e]&&e<ActivityLoginGift._data.count;ActivityLoginGift._data.bonus[e]?this.btnGetAward.currentState="down":t?this.btnGetAward.currentState="up":this.btnGetAward.currentState="disabled"}},t.prototype.onTweenGroupComplete=function(){this.imgGroup.play(0)},t}(eui.Component);e.LoginGift=t,__reflect(t.prototype,"UI.LoginGift",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="MaillistSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.prototype.dataChanged=function(){this.data.read?(this.state.text=lang.String("read"),this.state.textColor=color.GRAY,this.attachment.visible=!1,this.imgBadge.visible=!1):(this.state.text=lang.String("unread"),this.state.textColor=color.GREEN,this.imgBadge.visible=!0,0==this.data.attached?this.attachment.visible=!1:this.attachment.visible=!0),this.time=FormatYYYYMMDDHHMM(this.data.sentTime),this.titleInfo.textFlow=Game.HtmlTextParser.parse(this.data.title)},t.prototype.onTouchTap=function(){Mail.onC2SMaildetail(this.data.id),0==this.data.attached&&(this.data.read=!0,this.dataChanged())},t.prototype.onRemoveFromStage=function(){this.state.text=""},t}(eui.ItemRenderer);e.Maillist=t,__reflect(t.prototype,"UI.Maillist")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="MailTextSkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.list.itemRenderer=e.AwardCell,n}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close();break;case this.btnReceive:if(this.award.length>0){var t=new net.def.C2SMail;t.setId(this.Id),net.socket.write(55,t.toArrayBuffer())}this.close()}},n.prototype.close=function(){UIManager.pop(this)},n.prototype.setMailtext=function(e,t,n,i,a,r){this.Id=e,this.title=n,this.sender=t,this.content=a,this.time=FormatYYYYMMDDHHMM(i),this.award=r},n.prototype.onRemoveFromStage=function(){this.Id=null,this.title="",this.sender="",this.time="",this.content="",this.textinfo.text="",this.titleInfo.text="",this.award=[]},n.prototype.onRefresh=function(){this.list.dataProvider=new eui.ArrayCollection(this.award),this.titleInfo.textFlow=Game.HtmlTextParser.parse(this.title),this.textinfo.textFlow=Game.HtmlTextParser.parse(this.content),this.award.length>0?this.btnReceive.label=lang.String("receive"):this.btnReceive.label=lang.String("btnClose")},n}(e.FitComponent);e.MailText=t,__reflect(t.prototype,"UI.MailText",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.maildata=[],n.skinName="MailSkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.list.itemRenderer=e.Maillist,n}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close();break;case this.btnDeletion:net.socket.write(56,null),Mail.onC2SAskmailtitle();break;case this.btnWithdraw:var t=new net.def.C2SMail;t.setId(0),net.socket.write(55,t.toArrayBuffer()),Mail.onC2SAskmailtitle()}},n.prototype.onRefresh=function(){var e=this.list.dataProvider;null==e?this.list.dataProvider=new eui.ArrayCollection(this.maildata):e.replaceAll(this.maildata),this.size=this.maildata.length,this.size>=50?PopUpMessage.push(lang.String("mailbox full"),color.RED):this.size>=30&&PopUpMessage.push(lang.String("mailbox almost full"),color.RED)},n.prototype.close=function(){UIManager.pop(this),this.maildata=[]},n}(e.FitComponent);e.MailUI=t,__reflect(t.prototype,"UI.MailUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UIManager;!function(e){function t(e){var t;return uiLayer.numChildren-1>=0&&(t=uiLayer.removeChildAt(uiLayer.numChildren-1)),uiLayer.addChild(e),t}function n(e){uiLayer.removeChildren(),uiLayer.addChild(e)}function i(){e.set(UI.HUD.instance)}function a(){UI.HUD.instance.closePages(),e.set(UI.HUD.instance)}function r(e){egret.Tween.removeTweens(e),e.scaleX=1,e.scaleY=1,e.parent!=uiLayer&&uiLayer.addChild(e)}function o(e){return egret.Tween.removeTweens(e),e.parent==uiLayer?(e.scaleX=.9,e.scaleY=.9,e.alpha=0,uiLayer.addChild(e),void egret.Tween.get(e).to({scaleX:1,scaleY:1,alpha:1},100)):(e.scaleX=.9,e.scaleY=.9,e.alpha=0,uiLayer.addChild(e),void egret.Tween.get(e).to({scaleX:1,scaleY:1,alpha:1},100))}function s(e){UI.HUD.instance.pushPage(e)}function l(e){null!=e.parent&&(egret.Tween.removeTweens(e),Game.removeFromParent.apply(e))}function u(e){null!=e.parent&&(egret.Tween.removeTweens(e),egret.Tween.get(e).set({scaleX:1,scaleY:1}).to({scaleX:.9,scaleY:.9,alpha:0},100).call(Game.removeFromParent,e).set({scaleX:1,scaleY:1,alpha:1}))}function c(){UI.Mall.get(0),UI.HUD.instance.btnMall.selected=!0}function h(){UI.Mall.get(1),UI.HUD.instance.btnMall.selected=!0}function d(){UI.Mall.get(2),UI.HUD.instance.btnMall.selected=!0}function p(){UI.PetEnlist.open()}function g(){UI.PetEnlist.open(1)}function m(){UI.PlayerCabinet.instance.changePage(0),A()}function f(){UI.PlayerCabinet.instance.changePage(1),A()}function v(){UI.PlayerCabinet.instance.changePage(2),A()}function y(){UI.BagView.instance.page=0,P()}function b(){UI.Forge.instance.changePage(0),G()}function S(){UI.Forge.instance.changePage(1),G()}function E(){UI.Forge.instance.changePage(2),G()}function C(){UI.SkillCabinet.instance.changePage(0),k()}function T(){UI.SkillCabinet.instance.changePage(1),k()}function I(){UI.SkillCabinet.instance.changePage(2),k()}function G(){UI.HUD.instance.btnForge.selected=!0}function A(){UI.HUD.instance.btnRole.selected=!0}function k(){UI.HUD.instance.btnSkill.selected=!0}function P(){UI.HUD.instance.btnBag.selected=!0}function w(){UI.HUD.instance.btnGuild.selected=!0}function L(){UI.HUD.instance.btnGuild.selected=!1}function R(){s(new UI.SongJinWar)}function U(){UI.HUD.instance.btnForge.selected=!1}function _(){UI.HUD.instance.btnRole.selected=!1}function x(){UI.HUD.instance.btnSkill.selected=!1}function M(){UI.HUD.instance.btnBag.selected=!1}function D(){UI.HUD.instance.btnMall.selected=!1}function N(){UI.HUD.instance.btnGuild.selected=!1}function F(){UI.HUD.instance.btnSetting.selected=!1}e.replace=t,e.set=n,e.start=i,e.restart=a,e.pushNoTween=r,e.push=o,e.pushPage=s,e.popNoTweens=l,e.pop=u,e.openMysteryShop=c,e.openArenaShop=h,e.openGoldCoinShop=d,e.openPetEnlist=p,e.openGoldPetEnlist=g,e.openPlayerUI=m,e.openPartnerUI=f,e.openTitleUI=v,e.openEquipBag=y,e.openEnhancement=b,e.openGem=S,e.openSwapEquip=E,e.openSkillUI=C,e.openMeridian=T,e.openBookUI=I,e.openForge=G,e.openRole=A,e.openSkill=k,e.openBag=P,e.openGuild=w,e.openBattle=L,e.openSongJin=R,e.closeForge=U,e.closeRole=_,e.closeSkill=x,e.closeBag=M,e.closeMall=D,e.closeGuild=N,e.closeBattleSetting=F}(UIManager||(UIManager={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="MapCabinetSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.timerId=egret.setTimeout(function(){e.setGateViewHeight(),e.timerId=null},e,100),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null!=this.timer&&(egret.clearTimeout(this.timer),this.timer=null),null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.close=function(){var t=this;null!=this._instance&&(Game.removeFromParent.apply(this._instance),e.LittleBossInfo.close(),null!=this.timer&&egret.clearTimeout(this.timer),this.timer=egret.setTimeout(function(){t._instance=null},this,1e4))},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:n.close()}},n.prototype.setGateViewHeight=function(){this.scroller.viewport.scrollV=1003-this.scroller.height},n.prototype.onAddToStage=function(){LittleBoss.requestServerMissions()},n.prototype.refresh=function(){this.btnFinishAll&&(this.btnFinishAll.enabled=LittleBoss.canQuickFinishAll())},n}(e.FitComponent);e.MapCabinet=t,__reflect(t.prototype,"UI.MapCabinet",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.mapId=0,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.skinName="MapCellSkin",e.btnEnter.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onEnter,e),e}return __extends(n,t),n.prototype.onEnter=function(){if(World.mapId!=this.mapId){var t=!0;if(this.wild){var n=new net.def.C2SApplyEnterMap;n.setMapId(this.mapId),net.socket.write(23,n.toArrayBuffer())}else if("city"==this.scene)CityHome.c2s_home();else{var i=this.scene;LittleBoss.sceneName==i&&(t=LittleBoss.requestEnterLittleBossMap(this.mapId))}t&&e.MapCabinet.close()}},n.prototype.onAddToStage=function(){if(this.visible=!1,null!=this.mapId&&0!=this.mapId){var t=table.maps[this.mapId];t.badgeaction||0;this.visible=!0,this.scene=t.scene,this.icon=t.icon,this.wild=1==t.wild,this.level=t.level,this.refresh(),Game.dispatcher.addEventListener(Game.EVENT.LevelUp,this.refresh,this);var i=this.scene;if(LittleBoss.sceneName==i){Game.dispatcher.addEventListener(Game.EVENT.LittleBossInfo,this.refresh,this),SecondTicker.addEventListener(this.updateTips,this),this.currentState="boss";var a=LittleBoss.getLittleBossMissionByMapId(this.mapId);this.name=lang.Format("{1} Lv{2}",a.name,t.level)}else this.currentState="none",this.name=lang.Format("{1} Lv{2}",t.name,t.level);World.wild&&World.mapId==this.mapId?(null==n.autofight&&(n.autofight=new e.MovieClipComponent,n.autofight.auto=!0,n.autofight.scaleX=.5,n.autofight.scaleY=.5,n.autofight.top=-20,n.autofight.horizontalCenter=0),n.autofight.Load("skill/autofight/autofight.json","autofight"),n.autofight.parent!=this&&this.addChild(n.autofight),this.currentState="here"):null!=n.autofight&&n.autofight.parent==this&&this.removeChild(n.autofight)}},n.prototype.onRemoveFromStage=function(){if(null!=this.mapId&&0!=this.mapId){Game.dispatcher.removeEventListener(Game.EVENT.LevelUp,this.refresh,this);var e=this.scene;LittleBoss.sceneName==e&&(Game.dispatcher.removeEventListener(Game.EVENT.LittleBossInfo,this.refresh,this),SecondTicker.removeEventListener(this.updateTips,this)),null!=n.autofight&&n.autofight.free()}},n.prototype.updateTips=function(){var e=this.scene;LittleBoss.sceneName==e&&(this.tips=LittleBoss.getTips(this.mapId)),this.checkShowEffect()},n.prototype.refresh=function(){var e=!1,t=this.scene;if(PlayerAttribute.Level>=this.level)switch(t){case LittleBoss.sceneName:this.level<=LittleBoss.getNextLevel()&&(e=!0);break;default:this.level<=LittleBoss.getCurrentLevel()&&(e=!0)}this.visible=e,this.updateTips()},n.prototype.checkShowEffect=function(){var e=!1,t=this.scene;LittleBoss.sceneName==t&&(e=LittleBoss.canEnter(this.mapId)),e?this.addChild(this.badge):Game.removeFromParent.apply(this.badge)},n}(eui.Component);e.MapCell=t,__reflect(t.prototype,"UI.MapCell",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="MessageSkin",t.left=0,t.right=0,t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.label.textFlow=Game.TextParser.parse(this.message),this.label.textColor=this.color,this.anchorOffsetY=this.height},t}(eui.Component);e.Message=t,__reflect(t.prototype,"UI.Message",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(e){var n=t.call(this)||this;return n.skinName="MissionSloganSkin",n.currentState=e,n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.closehandle,n),n}return __extends(n,t),n.prototype.closehandle=function(t){switch(t.target){case this.btnClose:(this.currentState="end")&&UIManager.pushPage(e.DailyTask.instance),UIManager.pop(this)}},n}(e.FitComponent);e.MissionSlogan=t,__reflect(t.prototype,"UI.MissionSlogan",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.source="",t.name="",t.position="center",t.touchEnabled=!1,t.touchChildren=!1,t.contentJustify=!1,t.justify=!0,t.auto=!1,t.removeWhenComplete=!0,t.offsetX=0,t.offsetY=0,t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.load(this.source,this.name),this.addEventListener(egret.Event.RESIZE,this.onResize,this)},t.prototype.updatePosition=function(){if(this.mc)switch(this.position){case"center":this.mc.x=this.width/2+this.offsetX,this.mc.y=this.height/2+this.offsetY;break;case"TL":this.mc.x=this.offsetX,this.mc.y=this.offsetY;break;case"top":this.mc.x=this.width/2+this.offsetX,this.mc.y=this.offsetY;break;case"bottom":this.mc.x=this.width/2+this.offsetX,this.mc.y=this.height+this.offsetY;break;default:egret.error(this.source+" invalid position "+this.position)}},t.prototype.onResize=function(){null!=this.mc&&(this.justify&&(this.mc.scaleX=this.width/this.mc.width,this.mc.scaleY=this.height/this.mc.height),this.updatePosition())},t.prototype.removeFromParent=function(){Game.removeFromParent.apply(this),this.free()},t.prototype.free=function(){null!=this.mc&&(this.mc.scaleX=1,this.mc.scaleY=1,this.mc.stop(),Game.removeFromParent.apply(this.mc),this.mc.visible=!1),null!=this.loader&&(null!=this.loader.url&&RES.delRel(this.loader.url),this.loader.release()),this.offsetX=0,this.offsetY=0,this.source=null,this.name=null},t.prototype.Load=function(e,t){(this.source!=e||this.name!=t)&&(this.free(),this.source=e,this.name=t,this.load(e,t))},t.prototype.onLoaded=function(e){this.source,this.name},t.prototype.load=function(e,t){var n=this;null!=e&&""!=e&&null!=t&&(null==this.loader&&(this.loader=new MovieClipDataLoader),null==this.loader.dispatcher&&(RES.addRel(e),this.loader.get(e,function(i){var a=i.generateMovieClipData(t);null==n.mc?(n.mc=new egret.MovieClip(a),n.mc.addEventListener(egret.MovieClipEvent.COMPLETE,n.onMovieClipComplete,n),n.addChild(n.mc)):(n.mc.movieClipData=a,n.mc.visible=!0,n.invalidateSize(),null==n.mc.parent&&n.addChild(n.mc)),n.mc.blendMode=table.blendMode[e],n.contentJustify?(n.width=n.mc.width,n.height=n.mc.height,eui.PropertyEvent.dispatchPropertyEvent(n,eui.PropertyEvent.PROPERTY_CHANGE,"contentWidth"),eui.PropertyEvent.dispatchPropertyEvent(n,eui.PropertyEvent.PROPERTY_CHANGE,"contentHeight")):n.justify&&(n.mc.scaleX=n.width/n.mc.width,n.mc.scaleY=n.height/n.mc.height),n.updatePosition(),null!=n.playTimes||null!=n.frame?null!=n.frame?n.mc.gotoAndPlay(n.frame,n.playTimes):n.mc.play(n.playTimes):n.auto&&n.mc.play(-1)})))},t.prototype.gotoAndStop=function(e){null!=this.mc&&this.mc.gotoAndStop(e)},t.prototype.onMovieClipComplete=function(){this.removeWhenComplete?Game.removeFromParent.apply(this):this.visible=!1},t.prototype.play=function(e){this.playTimes=e,null!=this.mc&&(this.visible=!0,this.mc.play(e))},t.prototype.gotoAndPlay=function(e,t){this.frame=e,this.playTimes=t,null!=this.mc&&(this.visible=!0,this.mc.gotoAndPlay(e,t))},t.prototype.stop=function(){this.playTimes=null,this.frame=null,null!=this.mc&&this.mc.stop()},t.prototype.measure=function(){null!=this.mc?this.setMeasuredSize(this.mc.width,this.mc.height):e.prototype.measure.call(this)},t}(eui.Component);e.MovieClipComponent=t,__reflect(t.prototype,"UI.MovieClipComponent",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.onTouchTap=function(t){switch(t.target){case this.btnGo:if(this.data.operation){var n=Number(this.data.operation);n&&(Operation.open(n),e.NPC_TieJiangEntrance.close())}}},n}(eui.ItemRenderer);e.NPC_TieJiangOptItem=t,__reflect(t.prototype,"UI.NPC_TieJiangOptItem");var n=function(t){function n(){var e=t.call(this)||this;return e.skinName="NPC_TieJiangEntranceSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new e.NPC_TieJiangEntrance),this._instance},enumerable:!0,configurable:!0}),n.open=function(){var e=this.instance;return UIManager.pushPage(e),e},n.close=function(){null!=this._instance&&UIManager.pop(this._instance)},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},n}(e.FitComponent);e.NPC_TieJiangEntrance=n,__reflect(n.prototype,"UI.NPC_TieJiangEntrance",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="OfflineExpAwardUISkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.loadOfflineAwardData(),e}return __extends(n,t),n.prototype.close=function(){UIManager.pop(this)},n.prototype.loadOfflineAwardData=function(){this.offlineHour=Math.floor(OfflineTime.offlineDuration/60),this.offlineMinute=OfflineTime.offlineDuration%60,this.offlineTime=OfflineTime.offlineDuration,this.goldCost=table.offlineAward.cost.goldCoin*OfflineTime.offlineDuration,this.silverCost=table.offlineAward.cost.silverCoin*OfflineTime.offlineDuration;var e=PlayerAttribute.Level>table.offlineAward.exp.base.length?table.offlineAward.exp.base.length:PlayerAttribute.Level,t=this.offlineTime*table.offlineAward.exp.base[e-1].exp*table.offlineAward.exp.ratio[0],n=table.getHuashanPKAwardByRound(HuashanPK.maxRound),i=n?n.offlineExpPercent:0;i+=PlayerAttribute.vipItem.getBounus(),i/=100,this.txtExp=[t+" + "+Math.floor(t*i),"(",lang.String("offline exp addition"),")"].join(""),this.btnGetOfflineAward0.enabled=OfflineTime.offlineDuration>0,this.btnGetOfflineAward1.enabled=OfflineTime.offlineDuration>0,this.btnGetOfflineAward2.enabled=OfflineTime.offlineDuration>0},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close();break;case this.btnGetOfflineAward0:this.onGetOfflineAward(0);break;case this.btnGetOfflineAward1:this.onGetOfflineAward(1);break;case this.btnGetOfflineAward2:this.onGetOfflineAwardConfirm()}},n.prototype.onGetOfflineAwardConfirm=function(){var t=this;if(this.goldCost>0){var n=lang.String("operation confirm"),i=lang.StringWithFormat("offlineaward make sure use gold coin {1}",this.goldCost);e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],n,i,function(){return t.onGetOfflineAward(2),!0},null,null)}else this.onGetOfflineAward(2)},n.prototype.onGetOfflineAward=function(e){var t=new net.def.C2SGetOfflineAward;switch(t.grade=e,t.grade){case 0:break;case 1:if(PlayerAttribute.currency[Game.Currency.SilverCoin]<this.silverCost)return void PopUpMessage.push(lang.String("not enough silvercoin"),color.RED);break;case 2:if(PlayerAttribute.currency[Game.Currency.GoldCoin]<this.goldCost)return PopUpMessage.push(lang.String("not enough goldcoin"),color.RED),void Recharge.openRechargeUI()}net.socket.write(21,t.toArrayBuffer()),OfflineTime.offlineDuration=0,OfflineTime.show=!1,this.loadOfflineAwardData(),Game.dispatcher.dispatchEventWith(Game.EVENT.OfflineTimeShow)},n}(e.FitComponent);e.OfflineExpAwardUI=t,__reflect(t.prototype,"UI.OfflineExpAwardUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var OfflineTime;!function(e){function t(t){e.offlineDuration=t.getOfflineDuration(),e.show=!0,Game.dispatcher.dispatchEventWith(Game.EVENT.OfflineTimeShow)}e.offlineDuration=0,e.show=!1,e.syncOfflineTime=t}(OfflineTime||(OfflineTime={}));var UI;!function(e){function t(){return Game.isWildMap()?(null==e.offlineHandle&&(e.offlineHandle=new i),UIManager.pushPage(e.offlineHandle),e.offlineHandle):void 0}function n(){null!=e.offlineHandle&&UIManager.pop(e.offlineHandle)}e.openOfflineHandle=t,e.closeOfflineHandle=n;var i=function(t){function n(){var n=t.call(this)||this;return n.skinName="OfflineHandleSkin",n.dailyTipsData=table.getValidDailyTips(),n.dailyTipsList.itemRenderer=e.DailyTipsItem,n.dailyTipsList.dataProvider=new eui.ArrayCollection(n.dailyTipsData),n.list.itemRenderer=e.EncounterItem,n.list.dataProvider=new eui.ArrayCollection(n.events),n.list.selectedIndex=0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n}return __extends(n,t),n.prototype.onAddToStage=function(){this.onUpdateOfflineExp(),this.onSyncEncounter(),Game.dispatcher.addEventListener(Game.EVENT.SyncEncounter,this.onSyncEncounter,this),Game.dispatcher.addEventListener(Game.EVENT.OfflineTimeShow,this.onUpdateOfflineExp,this),SecondTicker.addEventListener(this.updateRemainingTime,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.SyncEncounter,this.onSyncEncounter,this),Game.dispatcher.removeEventListener(Game.EVENT.OfflineTimeShow,this.onUpdateOfflineExp,this),SecondTicker.removeEventListener(this.updateRemainingTime,this)},n.prototype.updateRemainingTime=function(){if(null!=this.events){var e=this.events.length;if(0!=e)for(var t=0;e>t;t++){var n=this.events[t];n.remainingTime.delta>0&&(n.minuteSecond=n.remainingTime.getMinuteSecond())}}},n.prototype.onSyncEncounter=function(){null!=Encounter.events&&Encounter.events.length?(this.count=Encounter.events.length,this.events=Encounter.events):(this.count=0,this.events=null),this.updateList()},n.prototype.updateList=function(){if(null!=this.list){var e=this.list.dataProvider;null!=this.events?null==e?(this.list.dataProvider=new eui.ArrayCollection(this.events),this.list.selectedIndex=0):e.replaceAll(this.events):null!=e&&(e.removeAll(),e.refresh())}},n.prototype.close=function(){UIManager.pop(this)},n.prototype.onTouchTap=function(t){switch(t.target){case this.imgClose:this.close();break;case this.btnRules:var n=new e.Rule;n.skinName="EncountersInfoSkin",UIManager.pushPage(n)}},n.prototype.onUpdateOfflineExp=function(){var e=this.dailyTipsData.length,t=Math.floor(OfflineTime.offlineDuration/60),n=OfflineTime.offlineDuration%60;if(this.dialogue.textFlow=Game.HtmlTextParser.parse(lang.StringWithFormat("offline dialogue{1}",lang.StringWithFormat("{1}hours",t)+" "+lang.StringWithFormat("{1}minut",n))),OfflineTime.show){if(0==e||this.dailyTipsData[0].operation!=Operation.Type.OfflineExp){var i={title:"EXP Offline",desc:"Khi đại hiệp rời khỏi.\nTa đã giúp ngài kiếm nhiều EXP",icon:"icon/client_item/exp.png",operation:Operation.Type.OfflineExp};this.dailyTipsData.unshift(i)}}else if(0!=e&&this.dailyTipsData[0].operation==Operation.Type.OfflineExp){this.dailyTipsData.shift();var a=this.dailyTipsList.dataProvider;a.refresh()}},n}(e.FitComponent);e.OfflineHandle=i,__reflect(i.prototype,"UI.OfflineHandle",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.btnClose=null,t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.onTouchTap=function(e){switch(e.target){case this.btnBack:case this.btnClose:this.onCloseButtonClick(e)}},t.prototype.onCloseButtonClick=function(e){this.parent&&this.parent!=uiLayer?eui.UIEvent.dispatchUIEvent(this.parent,eui.UIEvent.CLOSING,!1,!0)&&this.close():eui.UIEvent.dispatchUIEvent(this,eui.UIEvent.CLOSING,!1,!0)&&this.close()},t.prototype.close=function(){UIManager.pop(this)},t}(eui.Panel);e.Panel=t,__reflect(t.prototype,"UI.Panel")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(n,i,a){var r=t.call(this)||this;r.petPower=0,r.equips=[],r.skinName="PetTipsSkin",r.dataEquipList=new eui.ArrayCollection,r.partner={id:n.id,level:n.level,exp:n.exp,attr:n.attrValues,breakthrough:n.breakthroughValues,index:0,workPos:0,lock:!1},r.partnerEquips=i,r.enhanceLevels=a;for(var o=0;o!=r.partnerEquips.length;o++){var s=r.partnerEquips[o];(null==s||s.getId()<=0)&&(r.enhanceLevels[o]=0)}r.showEquips(),r.addEventListener(egret.Event.REMOVED_FROM_STAGE,r.onRemoveFromStage,r),r.equipList.itemRenderer=e.PartnerEquipCell;var l=Partner.GetPartnerCfg(r.partner.id);r.petName=l.name,r.petQuality=Partner.getQualityStr(l.quality),r.petIcon.setResource(l.resource,null,null),r.imgPetSkill=Partner.getSkillIcon(l),r.petSkillName=Partner.getSkillName(l);var u=Partner.getTalentSkillLevel(r.partner);r.petSkillLevel=lang.StringWithFormat("{1}level",u),r.petSkillDesc=Game.HtmlTextParser.parse(Partner.getSkillDesc(l,u,!0,!1)),r.attrVal1=""+(~~(r.partner.attr[0]*r.partner.level/10)+l.baseAttr[0][2]+Partner.getBreakthroughAttr(r.partner.id,r.partner.breakthrough[0],0)),r.attrVal2=""+(~~(r.partner.attr[1]*r.partner.level/10)+l.baseAttr[1][2]+Partner.getBreakthroughAttr(r.partner.id,r.partner.breakthrough[1],1)),r.attrVal3=""+(~~(r.partner.attr[2]*r.partner.level/10)+l.baseAttr[2][2]+Partner.getBreakthroughAttr(r.partner.id,r.partner.breakthrough[2],2)),r.attrVal4=""+(~~(r.partner.attr[3]*r.partner.level/10)+l.baseAttr[3][2]+Partner.getBreakthroughAttr(r.partner.id,r.partner.breakthrough[3],3)),r.attrName1=Buff.GetName(l.baseAttr[0][0])+":",r.attrName2=Buff.GetName(l.baseAttr[1][0])+":",r.attrName3=Buff.GetName(l.baseAttr[2][0])+":",r.attrName4=Buff.GetName(l.baseAttr[3][0])+":",r.petPower=Partner.GetPartnerPower(r.partner,null);for(var o=0;o!=r.partnerEquips.length;o++){var s=r.partnerEquips[o];s.getId()>0&&(r.petPower+=PartnerEquipManager.GetFP(s.getId(),s.getStar()))}r.petPower+=PartnerEquipEnhance.GetFightingPower1(r.enhanceLevels);var c=PartnerEquipEnhance.getPartnerEnhanceAttribute1(r.enhanceLevels),h=c[l.baseAttr[0][0]];null!=h&&h>0?r.attrEnhanceVal1="+"+h:r.attrEnhanceVal1=null;var d=c[l.baseAttr[1][0]];null!=d&&d>0?r.attrEnhanceVal2="+"+d:r.attrEnhanceVal2=null;var p=c[l.baseAttr[2][0]];null!=p&&p>0?r.attrEnhanceVal3="+"+p:r.attrEnhanceVal3=null;var g=c[l.baseAttr[3][0]];return null!=g&&g>0?r.attrEnhanceVal4="+"+g:r.attrEnhanceVal4=null,r.imgClose.addEventListener(egret.TouchEvent.TOUCH_TAP,r.closehandle,r),r}return __extends(n,t),n.prototype.onRemoveFromStage=function(){this.petIcon.clear()},n.prototype.closehandle=function(){UIManager.pop(this)},n.prototype.showEquips=function(){this.equips=[];for(var e=0;e!=this.partnerEquips.length;e++){var t=this.partnerEquips[e],n=this.enhanceLevels[e];t.getId()>0&&this.equips.push({id:t.getId(),star:t.getStar(),bagId:0,defaultIcon:"",enhanceLevel:n})}this.dataEquipList.replaceAll(this.equips)},n}(e.FitComponent);e.PetTips=t,__reflect(t.prototype,"UI.PetTips",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;n.otherJueXues={},n.skinName="PlayerInfoViewSkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.equipsList.itemRenderer=e.EquipCell,n.booksList.itemRenderer=e.Cell,n.superWeaponList.itemRenderer=e.Cell,n.petList.itemRenderer=e.Cell,n.avatarList.itemRenderer=e.Cell,n.cardList.itemRenderer=e.CollectCardItem,n.titlesList.itemRenderer=e.TitleSimpleItem,n.equipsList.addEventListener(eui.ItemTapEvent.ITEM_TAP,n.onEquipsTap,n),n.booksList.addEventListener(eui.ItemTapEvent.ITEM_TAP,n.onBooksTap,n),n.petList.addEventListener(eui.ItemTapEvent.ITEM_TAP,n.onPetTap,n),n.superWeaponList.addEventListener(eui.ItemTapEvent.ITEM_TAP,n.onClickSuperWeaponItem,n),n.avatarList.addEventListener(eui.ItemTapEvent.ITEM_TAP,n.onClickAvatarItem,n),n.cardList.addEventListener(eui.ItemTapEvent.ITEM_TAP,n.onClickCarditem,n),n.juexueList.addEventListener(eui.ItemTapEvent.ITEM_TAP,n.onClickJueXue,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,n.onTabTap,n);for(var i=[{name:"Trang Bị",key:""},{name:"Năng Lực",key:""},{name:"Thần Binh",key:""},{name:"Danh Lục",key:"CollectCard"}],a=[],r=0;r<i.length;r++)WorldLine.IsOpen(i[r].key)&&a.push(i[r]);return n.tabbar.dataProvider=new eui.ArrayCollection(a),n}return __extends(n,t),n.open=function(e){return null==this._instance&&(this._instance=new n),this._instance.info=e,UIManager.push(this._instance),this._instance
},n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),""==this.info.guild?this.gangName=lang.String("None"):this.gangName=this.info.guild,this.txtLevel=lang.StringWithFormat("{1}level",this.info.level);var n=this.info.faction,i=table.faction[n];this.factionIcon=table.faction[n].logoD,this.rolebg.source=table.faction[n].bg,this.animation.load(table.faction[n].animation,"st");var a=FactionTitle.getResource(this.info.factionTitle.id);null!=a&&(this.titleView1.Load("title/"+a+"/"+a+".json",a),this.titleView1.play(-1),this.titleView1.visible=!0);for(var r=egret.createMap(),o=[],s=this.info.equips.length,l=0;s>l;l++){var u=new Item.Equip(this.info.equips[l],n);r[this.info.equips[l].part]=u}for(var l=0;l<Game.EquipPart.EquipCount;l++)null!=r[l]?o.push({part:l,icon:r[l].Icon,quality:r[l].Quality,enhancement:this.info.enhancement[l]}):o.push({part:l,icon:e.RoleEquipped.icon[l],quality:null,enhancement:this.info.enhancement[l]});this.equips=r,this.equipsList.dataProvider=new eui.ArrayCollection(o);for(var c=[],l=0;l<i.skills.length;l++){var h=i.skills[l],d=this.info.skills[l],p=Skill.mapSkill[h.id];c.push({type:Game.SkillType.ActiveSkill,icon:p.icon,name:p.name,level:lang.Format("Lv{1}",d)})}for(var l=0;l<i.passiveSkills.length;l++){for(var h=i.passiveSkills[l],g=PassiveSkillManager.passiveSkillMap[h.id],m=1,f=0;f<this.info.passiveskillID.length;f++)g.id==this.info.passiveskillID[f]&&(m=Math.max(m,this.info.passiveskillLV[f]));c.push({type:Game.SkillType.PassiveSkill,icon:g.icon,name:g.name,level:lang.Format("Lv{1}",m)})}this.skills.dataProvider=new eui.ArrayCollection(c),s=this.info.books.length;for(var v=[],y=[],l=0;s>l;l++){var b=new Item.Book(this.info.books[l]);v[b.category]=b}for(var l=0;l<Game.BookCategory;l++)null!=v[l]?y.push({category:v[l].category,icon:v[l].Icon,quality:v[l].Quality}):y.push({category:null,icon:"ui/forge/add_bg2.png",quality:null});this.books=v,this.booksList.dataProvider=new eui.ArrayCollection(y);var S=this.info.meridians,E=S%(Meridian.MaxAcupoints*Meridian.MaxMeridians),C=~~(S/(Meridian.MaxAcupoints*Meridian.MaxMeridians)),T=~~(E/Meridian.MaxAcupoints);this.acupoint=E%Meridian.MaxAcupoints;var I=lang.String("Mai"+(T+1));C>0&&(I+=lang.String("grade"+C)),this.merdianName=I;for(var G=[],l=0;l<Partner.maxWorkPartnerCnt;l++)if(null!=this.info.partners[l]){var A=Partner.GetPartnerCfg(this.info.partners[l].id);G.push({petObj:this.info.partners[l],icon:A.icon,quality:A.quality})}else G.push({petObj:null,icon:"icon/chatHead/bg.png",quality:null});this.petList.dataProvider=new eui.ArrayCollection(G),PartnerQingyi.otherDataPartnerList=this.info.qingyiPartners,PartnerQingyi.otherDataGroupList=this.info.qingyiGroups,this.qingyifp=PartnerQingyi.GetFightingPowerOther();var k=new Array;s=this.info.superWeapons.length;for(var l=0;s>l;l++){var P=this.info.superWeapons[l],w=table.superWeaponCfg[P.id],L=w.costs.cost.genre,R=w.costs.cost.detailType,U=table.props[L][R];k.push({weaponId:P.id,level:P.level,icon:w.icon,quality:U.quality,rbcorner:P.level>0?lang.StringWithFormat("{1}level",P.level):lang.String("inactivate"),plugin:""})}var _=function(e,t){return e.weaponId-t.weaponId};k.sort(_);var x=5,M=x-k.length;if(M>0)for(var l=0;M>l;l++)k.push({weaponId:null,icon:"icon/chatHead/bg.png",quality:null});this.superWeaponList.dataProvider=new eui.ArrayCollection(k);var D=new Array;s=this.info.avatar.list.length;for(var l=0;s>l;l++){var P=this.info.avatar.list[l],L=table.avatars[P.id].item.genre,N=table.avatars[P.id].item.detailType,U=table.props[L][N];D.push({avatarId:P.id,level:P.level,icon:U.source,quality:U.quality,rbcorner:P.level>0?lang.StringWithFormat("{1}level",P.level):lang.String("inactivate"),plugin:""})}if(M=x-D.length,M>0)for(var l=0;M>l;l++)D.push({avatarId:null,icon:"icon/chatHead/bg.png",quality:null});this.avatarList.dataProvider=new eui.ArrayCollection(D);var F=new Array;s=this.info.collectCardList.cards.length;for(var l=0;s>l;l++){var O=collectCardManager.GetCardConfig(this.info.collectCardList.cards[l].id),B=this.info.collectCardList.cards[l],W=collectCardManager.cardFpConfigs[O.quality],V=~~((W.baseFp+W.levelFp[B.level])*(100+W.starFp[B.star])/100);F.push({id:this.info.collectCardList.cards[l].id,checkEnable:!1,checkBadge:!1,cardInstance:{id:B.id,star:B.star,level:B.level,fp:V},quality:O.quality})}F.sort(function(e,t){return t.quality-e.quality}),this.cardList.dataProvider=new eui.ArrayCollection(F);var q=new Array;s=this.info.commonTitles.titles.length;for(var l=0;s>l;l++){var H=this.info.commonTitles.titles[l],j=CommonTitle.titles[H.id];null!=j&&q.push(j)}this.titlesList.dataProvider=new eui.ArrayCollection(q),this.runeDesc.text="",this.runeDesc.textFlow=Game.HtmlTextParser.parse(Rune.getRuneLevelDesc(this.info.getRune())),this.info.level<Wuxingyinmanager.openLevel?this.wuxingyinCell.visible=!1:(this.wuxingyinCell.visible=!0,this.wuxingyinCell.data=this.getWuxingyinCellItemData()),Wuxingyinmanager.onSyncDataPlayerView(this.info.getWuxingyinData()),this.otherJueXues={};for(var l=0;l<this.info.juexues.length;l++){var B=new Item.JueXue;B.Init(this.info.juexues[l]),this.otherJueXues[B.Part]=B}this.juexueFp=PlayerAttribute.GetJueXueFightPower(this.otherJueXues);for(var Y=[],l=0;l<Item.JueXuePartsCount;l++){var K=this.otherJueXues[l+1];null!=K?Y.push({icon:K.Icon,quality:K.Quality,lbcorner:K.Level>0?"+"+K.Level:"",jxFontNote:K.FontNoteIcon}):Y.push({icon:"",quality:0,lbcorner:"",jxFontNote:""})}this.juexueList.dataProvider=new eui.ArrayCollection(Y),this.otherWenShis=[];for(var l=0;l<Item.WenShiMaxPosCount;l++)if(l<this.info.wenshis.length){var B=new Item.WenShi;B.Init(this.info.wenshis[l]),this.otherWenShis[B.pos]=B,this.wenshiList.SetWenShi(B.pos,B)}},n.prototype.onAddToStage=function(){WorldLine.IsOpen("WenShi")||Game.removeFromParent.apply(this.wenshiList),WorldLine.IsOpen("JueXue")||Game.removeFromParent.apply(this.juexueGroup),WorldLine.IsOpen("WuXingYin")||Game.removeFromParent.apply(this.greoupWuXingYing)},n.prototype.onTabTap=function(){},n.prototype.onEquipsTap=function(t){var n=this.equipsList.selectedItem.part;null!=this.equips[n]&&e.EquipTips.open("other",this.equips[n],this.info.enhancement[n],this.info.gems[n].sockets,this.equips,this.info.refine[n])},n.prototype.onTouchTap=function(t){switch(t.target){case this.imgClose:this.close();break;case this.wuxingyinCell:e.WuxingyinUI.open(Wuxingyinmanager.WuxingyinUI_DisplayMode_PlayerView);break;case this.imgQingyi:e.PartnerQingyiInfoView.open()}},n.prototype.close=function(){UIManager.pop(this),n._instance=null},n.prototype.onBooksTap=function(){var t=this.booksList.selectedItem.category;if(null!=t){var n=e.ItemTips.instance;n.data={type:"bookInstance",content:this.books[t]},UIManager.push(e.ItemTips.instance)}},n.prototype.onPetTap=function(){var t=this.petList.selectedItem.petObj;if(null!=t){var n=PartnerEquipManager.getEquipPos(this.petList.selectedIndex),i=this.info.getPartnerEquips().slice(n[0],n[1]),a=this.info.getPartnerEquipEnhance().slice(n[0],n[1]);UIManager.push(new e.PetTips(t,i,a))}},n.prototype.onClickSuperWeaponItem=function(){var t=this.superWeaponList.selectedItem.weaponId;if(null!=t){var n=this.superWeaponList.selectedItem.level,i=e.ItemTips.instance;i.data={type:"superWeapon",content:{id:t,level:n}},UIManager.push(e.ItemTips.instance)}},n.prototype.onClickAvatarItem=function(){var t=this.avatarList.selectedItem.avatarId;if(null!=t){var n=this.avatarList.selectedItem.level,i=e.ItemTips.instance;i.data={type:"avatar",content:{id:t,level:n}},UIManager.push(i)}},n.prototype.onClickCarditem=function(){var t=this.cardList.selectedItem.cardInstance;e.CollectCardCardInfo.instance.setCardId(t),UIManager.push(e.CollectCardCardInfo.instance)},n.prototype.onRemoveFromStage=function(){this.titleView1.free()},n.prototype.getWuxingyinCellItemData=function(){var e=this.info.wuxingyinData.getGrade(),t=Wuxingyinmanager.GetWuxingyinGradeConfig(e);return{type:"clientitem",quality:t.quality,icon:t.source,count:"",forbidTip:!0}},n.prototype.onClickJueXue=function(t){var n=this.otherJueXues[t.itemIndex+1];if(null!=n){var i=e.ItemTips.instance;i.data={type:"juexueInstance",content:{item:n,juexues:this.otherJueXues}},UIManager.push(i)}},n}(e.FitComponent);e.PlayerInfoView=t,__reflect(t.prototype,"UI.PlayerInfoView",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.fireBuffer=[],e}return __extends(n,t),Object.defineProperty(n.prototype,"skillId",{get:function(){return PlayerAttribute.getRageSkillId()},enumerable:!0,configurable:!0}),n.prototype.UpdateFireObj=function(){if(null!=Skill.mapSkill[this.skillId]){this.currentRageId=this.skillId,this.clearAllFire();var e=Skill.mapSkill[this.skillId].rage,t=Game.MaxRage,i=Math.floor(t/e),a=Math.floor(PlayerAttribute.GetRage()/e);this.currentFire=a;var r=n.firePos[i-1];if(null!=r)for(var o=0;o<r.length;o++)this.addFireObj(o,r[o].x,r[o].y,a>=o+1)}},n.prototype.UpdateRage=function(){if(this.currentRageId!=this.skillId)return void this.UpdateFireObj();var e=Skill.mapSkill[this.skillId].rage,t=Math.floor(PlayerAttribute.GetRage()/e);if(t!=this.currentFire){this.currentFire=t;for(var n=0;n<this.fireBuffer.length;n++)t>=n+1?this.fireBuffer[n].source="ui/zuUi/skill_h1.png":this.fireBuffer[n].source="ui/zuUi/skill_h2.png"}},n.prototype.RageSkillChange=function(){this.updateSkillId(),this.UpdateFireObj()},n.prototype.onAddToStage=function(){t.prototype.onAddToStage.call(this),this.UpdateFireObj(),Game.dispatcher.addEventListener(Game.EVENT.OnRageChange,this.UpdateRage,this),Game.dispatcher.addEventListener(Game.EVENT.RageSkillChange,this.RageSkillChange,this)},n.prototype.onRemoveFromStage=function(){t.prototype.onRemoveFromStage.call(this),Game.dispatcher.removeEventListener(Game.EVENT.OnRageChange,this.UpdateRage,this),Game.dispatcher.removeEventListener(Game.EVENT.RageSkillChange,this.RageSkillChange,this),this.clearAllFire(),null!=this.mc&&this.mc.free()},n.prototype.clearAllFire=function(){for(var e=0,t=this.fireBuffer;e<t.length;e++){var n=t[e];Game.removeFromParent.call(n),n.clearResourceReference()}},n.prototype.addFireObj=function(e,t,n,i){null==this.fireBuffer&&(this.fireBuffer=[]);var a="ui/zuUi/skill_h2.png";i&&(a="ui/zuUi/skill_h1.png");var r=this.fireBuffer[e];r?r.source=a:(r=new eui.Image(a),this.fireBuffer[e]=r),r.setLayoutBoundsPosition(t,n),this.addChild(r)},n.prototype.animationUpdateHandler=function(){if(t.prototype.animationUpdateHandler.call(this),-1!=this.skillId){if(!PlayerAttribute.canCastRageSkill(this.skillId,!1))return this.forbit||(this.forbit=new eui.Image,this.forbit.source="icon/item/jz.png",this.forbit.verticalCenter=3,this.forbit.horizontalCenter=0,this.forbit.width=54,this.forbit.height=54),void(this.forbit.parent!=this&&this.addChild(this.forbit));this.forbit&&Game.removeFromParent.apply(this.forbit),PlayerAttribute.canCastSkill(this.skillId)?(null==this.mc&&(this.mc=new e.MovieClipComponent,this.mc.top=-10,this.mc.verticalCenter=-20,this.mc.scaleX=.6,this.mc.scaleY=.6,this.mc.alpha=.8,this.mc.auto=!0),this.mc.Load("skill/anger/anger.json","anger"),null==this.mc.parent&&this.addChildAt(this.mc,1)):null!=this.mc&&null!=this.mc.parent&&this.removeChild(this.mc)}},n.firePos=[[{x:30,y:0}],[{x:20,y:0},{x:40,y:0}],[{x:10,y:5},{x:30,y:0},{x:50,y:5}],[{x:7,y:7},{x:22,y:0},{x:38,y:0},{x:53,y:7}],[{x:2,y:10},{x:15,y:3},{x:30,y:0},{x:45,y:3},{x:58,y:10}]],n}(e.BaseSkillButton);e.RageSkillButton=t,__reflect(t.prototype,"UI.RageSkillButton")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="RankingListSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.prototype.dataChanged=function(){if(null!=this.data&&""!=this.data.name){switch(this.data.rank){case 1:this.rankIcon="ui/ranking/first_icon.png";break;case 2:this.rankIcon="ui/ranking/second_icon.png";break;case 3:this.rankIcon="ui/ranking/third_icon.png";break;default:this.rankIcon=""}this.txtRoleName=this.data.name,this.txtRankType=this.data.txtRank,this.txtRankIndex=this.data.rank,this.txtRankValue=this.data.value,this.data.vipLv>0?this.vipImg=Vip.getVipIcon(this.data.vipLv):this.vipImg="",this.imgHead=table.faction[this.data.faction].logo}},t.prototype.onAddToStage=function(){this.btnHead.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickHead,this)},t.prototype.onRemoveFromStage=function(){this.imgHead="",this.rankIcon=null,this.btnHead.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickHead,this)},t.prototype.onClickHead=function(){this.data.viewPlayerDetail(this.txtRoleName)},t}(eui.ItemRenderer);e.RankingList=t,__reflect(t.prototype,"UI.RankingList")}(UI||(UI={}));var UI;!function(e){var t;!function(e){e[e.LevelRank=0]="LevelRank",e[e.FPRank=1]="FPRank",e[e.KillBossRank=2]="KillBossRank",e[e.HuashanPkRank=3]="HuashanPkRank",e[e.EquipRank=4]="EquipRank",e[e.PartnerRank=5]="PartnerRank",e[e.SuperWeaponRank=6]="SuperWeaponRank",e[e.WllsRank=7]="WllsRank",e[e.GuildWarRank=8]="GuildWarRank",e[e.ArenaRank=9]="ArenaRank",e[e.CrossSongjinRank=10]="CrossSongjinRank",e[e.CollectCardRank=11]="CollectCardRank",e[e.FoursymbolsRank=12]="FoursymbolsRank",e[e.GuangMingDingRank=13]="GuangMingDingRank"}(t=e.RankKind||(e.RankKind={}));var n=function(n){function i(){var e=n.call(this)||this;e.hasFirstRank=!1,e.showFullItems=!1,e.skinName="RankingUISkin",e.radios=[],e.radioGroup=new eui.RadioButtonGroup;var i=function(t,n){var i=new eui.RadioButton;i.skinName="RadioTemp2Skin",i.group=e.radioGroup,i.label=n,i.value=t,e.buttonGroup.addChild(i),e.radios.push(i)};return i(t.LevelRank,"Cấp Độ"),i(t.FPRank,"Lực Chiến"),i(t.KillBossRank,"BOSS Tuần"),i(t.HuashanPkRank,"Luận Kiếm"),i(t.EquipRank,"LC Trang Bị"),i(t.PartnerRank,"LC Môn Khách"),i(t.SuperWeaponRank,"LC Thần Binh"),i(t.WllsRank,"Liên Đấu"),i(t.GuildWarRank,"Đệ Nhất Bang"),i(t.ArenaRank,"Lôi Đài"),i(t.CrossSongjinRank,"Tống Kim"),i(t.CollectCardRank,"LC Danh Lục"),WorldLine.IsOpen("FoursymbolsScene")&&i(t.FoursymbolsRank,"Tứ Tượng Địa Cung"),WorldLine.IsOpen("FoursymbolsScene")&&i(t.GuangMingDingRank,"Quang Minh Đỉnh"),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.radioGroup.addEventListener(eui.UIEvent.CHANGE,e.radioChangeHandler,e),e.imgHead=table.faction[PlayerAttribute.faction].portrait,e}return __extends(i,n),i.open=function(e){if(PlayerAttribute.Level<i.openLevel)return void PopUpMessage.push(lang.StringWithFormat("open on level {1}",i.openLevel),color.Warning);var t=new i;t.selectRank=e,t.requestRankData(e),UIManager.pushPage(t)},i.prototype.radioChangeHandler=function(){this.requestRankData(this.radioGroup.selectedValue)},i.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close();break;case this.firstGroup:i.viewPlayerDetail(this.selectRank,this.firstRankRoleName)}},i.viewPlayerDetail=function(n,i){if(i!=Player.instance.Name){switch(n){case t.GuildWarRank:return;case t.ArenaRank:if(i==lang.String("arena reserved name"))return void PopUpMessage.push(lang.String("arena cannot view"),color.RED)}var a=new e.ChatPlayerDsc;UIManager.pushNoTween(a),friend.search(i)}},i.prototype.close=function(){UIManager.pop(this)},i.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.GeneralRankChange,this.onDataChange,this),this.radioGroup.selectedValue=this.selectRank,this.scroller.addEventListener(egret.Event.CHANGE,this.onScrolled,this),this.radioScroller.viewport.scrollV=0},i.prototype.onRemoveFromStage=function(){this.rankIcon=null,Game.dispatcher.removeEventListener(Game.EVENT.GeneralRankChange,this.onDataChange,this),this.scroller.removeEventListener(egret.Event.CHANGE,this.onScrolled,this)},i.prototype.requestRankData=function(e){switch(this.showFullItems=!1,this.selectRank=e,e){case t.FoursymbolsRank:this.leaderboard=Foursymbols.RankCache;break;case t.GuangMingDingRank:this.leaderboard=Foursymbols.GMDRankCache;break;default:this.leaderboard=Rank.GetRankData(e)}this.leaderboard.requestServerData(),this.updateUi(e)},i.prototype.updateUi=function(n){switch(n){case t.FoursymbolsRank:this.leaderboard=Foursymbols.RankCache;break;case t.GuangMingDingRank:this.leaderboard=Foursymbols.GMDRankCache;break;default:this.leaderboard=Rank.GetRankData(n)}var i=this.leaderboard;if(null!=i&&i.hasData){switch(this.myLevel=i.selfValue,null!=i.firstRankItem&&(this.txtRankType=i.firstRankItem.txtRank),this.myRank="",i.selfRank){case 1:this.rankIcon="ui/ranking/first_icon.png";break;case 2:this.rankIcon="ui/ranking/second_icon.png";break;case 3:this.rankIcon="ui/ranking/third_icon.png";break;default:this.rankIcon="",0==i.selfRank||i.selfRank>200?this.myRank=lang.String("haveNoRank"):this.myRank=i.selfRank.toString()}if(this.hasFirstRank=null!=i.firstRankItem,this.hasFirstRank){var a=i.firstRankItem;this.animation.visible=!0,this.animation.load(table.faction[a.faction].animation,"st"),this.firstRankRoleName=a.name,this.firstRankRoleValue=a.value,a.vipLv>0?this.firstRankVipImg=Vip.getVipIcon(a.vipLv):this.firstRankVipImg="",this.firstRankLogo=table.faction[a.faction].logo,this.rolebg=table.faction[a.faction].bg}else this.animation.visible=!1,this.firstRankRoleName="",this.firstRankRoleValue=0,this.firstRankVipImg="",this.firstRankLogo="",this.rolebg="ui/bigBg/menpaibg_tr.png";var r;if(this.showFullItems)r=i.items;else{var o=i.items.length;o>10&&(o=10),r=new Array(o);for(var s=0;o>s;s++)r[s]=i.items[s]}var l=new eui.ArrayCollection(r);this.ranklist.itemRenderer=e.RankingList,this.ranklist.dataProvider=l,null!=this.scroller&&(this.scroller.viewport.scrollV=0)}},i.prototype.onDataChange=function(e){var t=e.data;this.updateUi(t)},i.prototype.onScrolled=function(){this.showFullItems||(this.showFullItems=!0,this.updateUi(this.selectRank))},i.openLevel=30,i}(e.FitComponent);e.RankingUI=n,__reflect(n.prototype,"UI.RankingUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="RecruitSysUISkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.listAward.itemRenderer=e.AwardCell,n}return __extends(n,t),n.open=function(e){return null==this._instance&&(this._instance=new n),null!=e?this._instance.ItemIndex=e:this._instance.ItemIndex=0,UIManager.pushPage(this._instance),this._instance},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.RecruitResult,this.onRecruitResult,this),this.updateInfo(),this.refresh()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.RecruitResult,this.onRecruitResult,this),Partner.recruiting=!1},n.prototype.onRecruitResult=function(){this.refresh()},n.prototype.onTouchTap=function(t){switch(t.target){case this.imgDesc:var n=new e.Rule;n.skinName="PetEnlistRulesSkin",UIManager.pushPage(n);break;case this.btnRecruit1:this.onClickRecruit(this.ItemIndex,0);break;case this.btnRecruit10:this.onClickRecruit(this.ItemIndex,1);break;case this.imgClose:this.close()}},n.prototype.close=function(){UIManager.pop(this)},n.prototype.onClickRecruit=function(e,t){RecruitOpt.Recruit(e,t)},n.prototype.refresh=function(){this.btnRecruit1.enabled=RecruitOpt.checkRecruitCost(this.ItemIndex,0),this.btnRecruit10.enabled=RecruitOpt.checkRecruitCost(this.ItemIndex,1);var e=RecruitOpt.getRecruitCount(this.ItemIndex,0),t=RecruitOpt.getRecruitCount(this.ItemIndex,1);this.times1="("+e.count+"/"+e.haveCount+")",this.times2="("+t.count+"/"+t.haveCount+")"},n.prototype.updateInfo=function(){var e=RecruitOpt.getRecruit(this.ItemIndex);if(null!=e){this.listAward.dataProvider=new eui.ArrayCollection(e.awards),this.Title=""+e.name,this.backgroup=e.bgImage;var t=e.openCost[0],n=table.props[t.content.genre][t.content.detailType];this.icon1=n.source;var i=e.openCost[1];table.props[i.content.genre][i.content.detailType];this.icon2=n.source}},n}(e.FitComponent);e.RecruitSysUI=t,__reflect(t.prototype,"UI.RecruitSysUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var i=t.call(this)||this;i.skinName="RefineUISkin",i.array=new Array(Game.EquipPart.EquipCount);for(var a=0;a<Game.EquipPart.EquipCount;a++)i.array[a]={part:a,icon:n.icons[a],quality:null,enhancement:null,level:null,qualityMovieEnabled:!1};i.selectIndex=-1,i.mc=[];for(var a=0;a<Game.EquipPart.EquipCount;a++){var r=new e.MovieClipComponent;r.removeWhenComplete=!1,r.position="TL";var o=n.mcPos[a];r.x=o[0],r.y=o[1],r.scaleX=1.2,r.scaleY=1.2,i.mc.push(r),r.visible=!1}return i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i.addEventListener(egret.Event.REMOVED_FROM_STAGE,i.onRemoveFromStage,i),i.addEventListener(egret.TouchEvent.TOUCH_TAP,i.onTouchTap,i),i}return __extends(n,t),n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.EnhanceSuccess,this.onDataChange,this),Game.dispatcher.addEventListener(Game.EVENT.EquipsChange,this.onDataChange,this),Game.dispatcher.addEventListener(Game.EVENT.RefineDataChange,this.onSuccess,this);for(var e=0;e<Game.EquipPart.EquipCount;e++)this.equipGroup.addChild(this.mc[e]);this.onDataChange(),this.selectPart(this.autoSelectPart())},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.EnhanceSuccess,this.onDataChange,this),Game.dispatcher.removeEventListener(Game.EVENT.EquipsChange,this.onDataChange,this),Game.dispatcher.removeEventListener(Game.EVENT.RefineDataChange,this.onSuccess,this),this.stopAutoRefining()},n.prototype.stopAutoRefining=function(){this.refining=!1,null!=this.timer&&(egret.clearTimeout(this.timer),this.timer=null);for(var e=0;e<Game.EquipPart.EquipCount;e++){var t=this.mc[e];t.visible=!1,t.free()}},n.prototype.onSuccess=function(){this.refining&&null==this.timer&&(this.timer=egret.setTimeout(this.autoRefine,this,300));var e=this.mc[this.selectIndex];null!=e&&(e.Load("skill/Ui_quan04/Ui_quan04.json","Ui_quan04"),e.gotoAndPlay(0,1),e.visible=!0,this.onDataChange())},n.prototype.onDataChange=function(){this.totalPower=Refine.GetTotalFp(),this.lowLevel=Refine.getLowLevel();for(var e=PlayerAttribute.Equips,t=0;t!=Game.EquipPart.EquipCount;t++){null!=e[t]&&(this.array[t].icon=e[t].Icon,this.array[t].quality=e[t].Quality,this.array[t].qualityMovieEnabled=!0,this.array[t].level=Refine.levels[t]);var n=this.equipGroup.getChildAt(t);n.data=this.array[t]}},n.prototype.onTouchTap=function(e){switch(e.target){case this.equip0:this.selectPart(0);break;case this.equip1:this.selectPart(1);break;case this.equip2:this.selectPart(2);break;case this.equip3:this.selectPart(3);break;case this.equip4:this.selectPart(4);break;case this.equip5:this.selectPart(5);break;case this.equip6:this.selectPart(6);break;case this.equip7:this.selectPart(7);break;case this.btnRefine:null!=this.timer&&(egret.clearTimeout(this.timer),this.timer=null),this.refining=!0,this.autoRefine();break;default:return}},n.prototype.autoRefine=function(){if(this.timer=null,PlayerAttribute.Level<Refine.openLevel)return this.refining=!1,void PopUpMessage.push(lang.StringWithFormat("refine cannot refine need reach level {1}",Refine.openLevel),color.RED);var t=this.autoSelectPart();this.selectPart(t);var n=Refine.getRefineLevel(t);if(n>=Refine.maxLevel)return this.refining=!1,void PopUpMessage.push(lang.String("refine cannot refine reach max level"),color.RED);var i=Refine.getConfig(t,n+1);if(null==i)return void(this.refining=!1);var a=i.costItem[0],r=i.costItem[1],o=i.costItem[2];return PlayerAttribute.GetItemCount(a,r)<o?(e.ResourceObtain.Open([i.obtainId]),this.refining=!1,void PopUpMessage.push(lang.String("refine cannot refine not enough material"),color.RED)):void Refine.applyRefine(t)},n.prototype.autoSelectPart=function(){for(var e=0,t=PlayerAttribute.Equips,n=99999,i=0;i!=Game.EquipPart.EquipCount;i++){var a=Refine.getRefineLevel(i);null!=t[i]&&a<Refine.maxLevel&&n>a&&(n=a,e=i)}return e},n.prototype.selectPart=function(e){this.selectIndex=e;for(var t=0;t!=Game.EquipPart.EquipCount;t++){var n=this.equipGroup.getChildAt(t);n.currentState=t==e?"upAndSelected":"up"}var i=PlayerAttribute.Equips;if(null==i[e])this.selectEquip.data={icon:null,enhancement:null,quality:null,part:null,qualityMovieEnabled:!1,level:null},this.costCell.data=null,this.equipName.text="",this.groupSelectEquipAttribute.visible=!1,this.groupSelectEquipLevel.visible=!1,this.costNum.text="";else{this.selectEquip.data={icon:i[e].Icon,enhancement:null,quality:i[e].Quality,part:i[e].Part,qualityMovieEnabled:!0,level:null},this.equipName.textFlow=Game.TextParser.parse(i[e].Name);var a=Refine.getRefineLevel(e);if(a>=Refine.maxLevel){this.groupSelectEquipAttribute.visible=!1,this.groupSelectEquipLevel.visible=!1;var r=Refine.getConfig(e,Refine.maxLevel),o=r.costItem[0],s=r.costItem[1],l=r.costItem[2];this.costCell.data={type:"item",content:{genre:o,detailType:s}}}else{this.groupSelectEquipAttribute.visible=!0,this.groupSelectEquipLevel.visible=!0,this.oldLevel.text=a.toString(),this.newLevel.text=(a+1).toString();var u=Refine.getConfig(e,a),c=Refine.getConfig(e,a+1);this.attributeDesc.text=Buff.GetName(c.buffs[0][0])+":",this.oldValue.text=0==a?"0":u.buffs[0][1].toString(),this.newValue.text=c.buffs[0][1].toString();var o=c.costItem[0],s=c.costItem[1],l=c.costItem[2];this.costCell.data={type:"item",content:{genre:o,detailType:s}};var h=PlayerAttribute.GetItemCount(o,s),d=h>=l?color.GREEN:color.RED;this.costNum.textFlow=Game.HtmlTextParser.parse("<font color = "+d+">"+h+"</font>/"+l)}}},n.icons=["icon/equip/helmet.png","icon/equip/armor.png","icon/equip/cuff.png","icon/equip/boots.png","icon/equip/weapon.png","icon/equip/necklace.png","icon/equip/ring.png","icon/equip/pendant.png"],n.mcPos=[[83,71],[414,71],[44,158],[454,158],[44,245],[454,245],[83,332],[414,332]],n}(eui.Component);e.RefineUI=t,__reflect(t.prototype,"UI.RefineUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t;!function(e){e[e.equip=0]="equip",e[e.crystal=1]="crystal",e[e.collectTreasure=2]="collectTreasure",e[e.gem=3]="gem",e[e.partnerExpItem=4]="partnerExpItem",e[e.goldkey=5]="goldkey",e[e.washBoneItem=6]="washBoneItem",e[e.breakThroughItem=7]="breakThroughItem",e[e.errantryBook=8]="errantryBook",e[e.bigErrantryBook=9]="bigErrantryBook",e[e.lunjianling=10]="lunjianling",e[e.titleActivate=11]="titleActivate",e[e.zhenqiItem=12]="zhenqiItem",e[e.readingCoinItem=13]="readingCoinItem",e[e.bookSkill=14]="bookSkill",e[e.guilddungeonTicket=15]="guilddungeonTicket",e[e.CopperCoin=16]="CopperCoin",e[e.ironStone=17]="ironStone",e[e.weaponPieces=18]="weaponPieces",e[e.foursymbolsKey=19]="foursymbolsKey",e[e.guildcurrency=20]="guildcurrency",e[e.boxkey=21]="boxkey",e[e.activitystamps=22]="activitystamps",e[e.gongxuntie=23]="gongxuntie",e[e.zhangmenyinxin=24]="zhangmenyinxin",e[e.guildcontribute=25]="guildcontribute",e[e.equipMaking=26]="equipMaking",e[e.equipMakingmap=27]="equipMakingmap",e[e.busitask=28]="busitask",e[e.jade=29]="jade",e[e.monthlyactmaterial1=30]="monthlyactmaterial1",e[e.monthlyactmaterial2=31]="monthlyactmaterial2",e[e.monthlyactmaterial3=32]="monthlyactmaterial3",e[e.refineMaterial=33]="refineMaterial",e[e.runeMaterial=34]="runeMaterial",e[e.wuxingyinGrade=35]="wuxingyinGrade",e[e.wuxingyinAttributeMaterial=36]="wuxingyinAttributeMaterial",e[e.wuxingshi=37]="wuxingshi",e[e.shareboss=38]="shareboss",e[e.sharebossCreate1=39]="sharebossCreate1",e[e.sharebossCreate2=40]="sharebossCreate2",e[e.jingzhiwuxingshi=42]="jingzhiwuxingshi",e[e.guangmingdingKey=43]="guangmingdingKey",e[e.count=42]="count"}(t=e.ObtResId||(e.ObtResId={}));var n=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.onTouchTap=function(e){Game.dispatcher.dispatchEventWith(Game.EVENT.ChooseObtainRes,!1,this.data.resId)},t}(e.Cell);__reflect(n.prototype,"ResCell");var i=function(t){function i(){var i=t.call(this)||this;return i.skinName="ResourceObtainSkin",i.addEventListener(egret.TouchEvent.TOUCH_TAP,i.onTouchTap,i),i.addEventListener(egret.Event.REMOVED_FROM_STAGE,i.onRemoveFromStage,i),i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i.resoucesType=[],i.useable=!0,i.chooseId=0,i.numColor=647448,i.resoucesList.itemRenderer=n,i.obtainWayList.itemRenderer=e.FunctionItem,i.bCreatedCompleted=!0,i}return __extends(i,t),i.GetInstance=function(){return null==this.instance?(this.instance=new i,this.instance):this.instance},i.Open=function(e){var t=i.GetInstance();t.SetResourceObtain(e),UIManager.pushPage(t),null!=t.parent&&t.onReFresh()},i.Close=function(){UIManager.pop(i.GetInstance())},i.prototype.SetResourceObtain=function(e){this.useable=table.resObtainCfg[e[0]].usable;for(var t=1;t<e.length;t++)if(this.useable!=table.resObtainCfg[e[t]].usable)return void egret.error("resoucesType elements must have same [useable] property!");this.chooseId=e[0],this.resoucesType=e,this.name=table.resObtainCfg[e[0]].name,this.num=0,this.UpdateChoose(this.chooseId)},i.prototype.onAddToStage=function(){null!=this.bCreatedCompleted&&(Game.dispatcher.addEventListener(Game.EVENT.RemoveItem,this.onItemChange,this),Game.dispatcher.addEventListener(Game.EVENT.AddItem,this.onItemChange,this),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,this.onItemChange,this),Game.dispatcher.addEventListener(Game.EVENT.ChooseObtainRes,this.onChooseObtainRes,this),this.onReFresh())},i.prototype.onReFresh=function(){1==this.useable?(this.currentState="Useable",this.showIconPage()):this.currentState="Useless",this.showObtainWay()},i.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.RemoveItem,this.onItemChange,this),Game.dispatcher.removeEventListener(Game.EVENT.AddItem,this.onItemChange,this),Game.dispatcher.removeEventListener(Game.EVENT.UpdateItem,this.onItemChange,this),Game.dispatcher.removeEventListener(Game.EVENT.ChooseObtainRes,this.onChooseObtainRes,this)},i.prototype.onItemChange=function(e){if("Useless"!=this.currentState){var t=table.resObtainCfg[this.chooseId],n=e.data;PlayerAttribute.bag.findItem(t.item[0],t.item[1]);t.item[0]==n.Item.Type&&this.UpdateChoose(this.chooseId)}},i.prototype.onChooseObtainRes=function(e){this.chooseId=e.data,this.UpdateChoose(this.chooseId),this.showObtainWay()},i.prototype.UpdateChoose=function(e){this.numColor=647448,this.name=table.resObtainCfg[e].name,this.itemDesc=table.resObtainCfg[e].desc,this.num=this.GetResNumber(e),this.num<=0&&(this.numColor=16711722),null!=this.btnUseItem&&(this.btnUseItem.enabled=!0,this.num<=0&&(this.btnUseItem.enabled=!1))},i.prototype.showIconPage=function(){this.btnUseItem.enabled=!0,this.num<=0&&(this.btnUseItem.enabled=!1);for(var e=[],t=0;t<this.resoucesType.length;t++){var n=table.resObtainCfg[this.resoucesType[t]],i=n.item[0],a=n.item[1];e.push({icon:table.props[i][a].source,quality:table.props[i][a].quality,resId:this.resoucesType[t]})}var r=this.resoucesList.dataProvider;null==r?this.resoucesList.dataProvider=new eui.ArrayCollection(e):r.replaceAll(e)},i.prototype.showObtainWay=function(){for(var e=[],t=table.resObtainCfg[this.chooseId],n=this.obtainWayList.dataProvider,i=0;i<t.obtainWay.length;i++){var a=t.obtainWay[i];e.push({Desc:a.desc,Page:a.page,Recommended:a.recommended,genre:a.genre,detailType:a.detailType})}null==n?this.obtainWayList.dataProvider=new eui.ArrayCollection(e):(n.replaceAll(e),null!=this.scroller&&(this.scroller.viewport.scrollV=0))},i.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close();break;case this.btnUseItem:var t=table.resObtainCfg[this.chooseId].item;PlayerAttribute.useItemByGD(t[0],t[1],1)
}},i.prototype.close=function(){UIManager.pop(this)},i.prototype.GetResNumber=function(e){var t=0;if(1==this.useable){var n=table.resObtainCfg[e].item;t=PlayerAttribute.bag.CalcCount(n[0],n[1])}return t},i}(e.FitComponent);e.ResourceObtain=i,__reflect(i.prototype,"UI.ResourceObtain",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;n.skinName="EquipGroupSkin",n.part=Game.EquipPart.EquipWeapon,n.array=new Array(Game.EquipPart.EquipCount);for(var i=0;i<Game.EquipPart.EquipCount;i++)n.array[i]={part:i,icon:null,quality:null,enhancement:null,level:null};return n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.list.itemRenderer=e.EquipCell,n}return __extends(n,t),n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.EnhanceSuccess,this.onDataChange,this),Game.dispatcher.addEventListener(Game.EVENT.EquipsChange,this.onDataChange,this),this.onDataChange()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.EnhanceSuccess,this.onDataChange,this),Game.dispatcher.removeEventListener(Game.EVENT.EquipsChange,this.onDataChange,this)},n.prototype.onDataChange=function(){for(var e=PlayerAttribute.Equips,t=0;t<Game.EquipPart.EquipCount;t++){var i=this.array[t];null!=e[t]?(i.icon=e[t].Icon,i.quality=e[t].Quality,i.level=e[t].Level):(i.icon=n.icon[t],i.quality=null,i.level=null),i.enhancement=PlayerAttribute.enhancement[t]}var a=this.list.dataProvider;null==a?this.list.dataProvider=new eui.ArrayCollection(this.array):(a.refresh(),this.list.selectedIndex=this.part)},n.icon=["ui/playerui/equip_0.png","ui/playerui/equip_1.png","ui/playerui/equip_2.png","ui/playerui/equip_3.png","ui/playerui/equip_4.png","ui/playerui/equip_5.png","ui/playerui/equip_6.png","ui/playerui/equip_7.png"],n}(eui.Component);e.RoleEquipped=t,__reflect(t.prototype,"UI.RoleEquipped",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.hasExpBuff=!1,e.expTimes=0,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.onAddToStage=function(){this.d=Player.instance,Game.dispatcher.addEventListener(Game.EVENT.onPlayerInited,this.onPlayerInit,this),Game.dispatcher.addEventListener(Game.EVENT.LevelUp,this.onPlayerLevelUp,this),Game.dispatcher.addEventListener(Game.EVENT.RoleRenameEnableChange,this.onRoleRenameEnableChange,this),Game.dispatcher.addEventListener(Game.EVENT.GlobalExpBuffStatus,this.onGlobalExpBuffStatus,this),Game.dispatcher.addEventListener(Game.EVENT.ActivateGuildactivateskill,this.AddGuildBuffIcon,this),Game.dispatcher.addEventListener(Game.EVENT.LeaveScene,this.RemoveGuildBuffIcon,this),this.onPlayerInit(),this.btnRename.visible=PlayerAttribute.canRename},n.prototype.onPlayerInit=function(){null!=PlayerAttribute.faction&&(this.portrait=table.faction[PlayerAttribute.faction].portrait),this.onPlayerLevelUp()},n.prototype.onPlayerLevelUp=function(){this.Level=PlayerAttribute.Level},n.prototype.onRemoveFromStage=function(){this.d=null,Game.dispatcher.removeEventListener(Game.EVENT.onPlayerInited,this.onPlayerInit,this),Game.dispatcher.removeEventListener(Game.EVENT.LevelUp,this.onPlayerLevelUp,this),Game.dispatcher.removeEventListener(Game.EVENT.GlobalExpBuffStatus,this.onGlobalExpBuffStatus,this),Game.dispatcher.removeEventListener(Game.EVENT.ActivateGuildactivateskill,this.AddGuildBuffIcon,this),Game.dispatcher.removeEventListener(Game.EVENT.LeaveScene,this.RemoveGuildBuffIcon,this)},n.prototype.onTouchTap=function(t){switch(t.target){case this.head_btn:UIManager.pushPage(new e.PlayerWu);break;case this.btnRename:e.ChangeName.Open("mine");break;case this.imgExpBuff:if(0==this.expTimes)return;var n=e.ItemTips.instance;n.desc=lang.StringWithFormat("exp addition tips",this.expTimes),n.data={type:"exp"},UIManager.pushPage(n)}},n.prototype.onRoleRenameEnableChange=function(e){this.btnRename.visible=PlayerAttribute.canRename},n.prototype.onGlobalExpBuffStatus=function(e){this.hasExpBuff=e.data.enabled===!0,this.expTimes=int(e.data.percent/100)},n.prototype.AddGuildBuffIcon=function(){if(this.RemoveGuildBuffIcon(),null!=this.groupGuildSkillBuff)for(var t=function(t){if(Guild.usingSkill[t]>0){var i=table.mapGuildSkill[Guild.usingSkill[t]],a=new eui.Image(i.icon);a.width=a.height=39,a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.GuildSkillDescPad.instance.Show(i.id)},a),n.groupGuildSkillBuff.addChild(a)}},n=this,i=0;i<Guild.usingSkill[i];i++)t(i)},n.prototype.RemoveGuildBuffIcon=function(){if(null!=this.groupGuildSkillBuff){for(var e=0;e<this.groupGuildSkillBuff.numChildren;e++){var t=this.groupGuildSkillBuff.getChildAt(e);t.clearResourceReference()}this.groupGuildSkillBuff.removeChildren()}},n}(eui.Component);e.RoleInfo=t,__reflect(t.prototype,"UI.RoleInfo",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={})),RES.processor.map("zip",{onLoadStart:function(e,t){return e.load(t,RES.processor.BinaryProcessor).then(function(e){var t=new JSZip(e);return t})},onRemoveStart:function(){return Promise.resolve()},getData:function(e,t,n,i){var a=e.get(t),r=a.file(i).asText();return i.indexOf(".json")>=0?JSON.parse(r):i.indexOf(".tmx")>=0?egret.XML.parse(r):r}}),RES.processor.map("dbbin",{onLoadStart:function(e,t){return __awaiter(this,void 0,void 0,function(){var n,i,a,r,o,s,l,u,c,h;return __generator(this,function(d){switch(d.label){case 0:return a=t.name,[4,e.load(t,RES.processor.BinaryProcessor)];case 1:return r=d.sent(),o=a.substring(0,a.lastIndexOf("_ske.dbbin"))+"_tex.json",n=e.resourceConfig.getResource(o),[4,e.load(n,RES.processor.JsonProcessor)];case 2:return s=d.sent(),e.state[n.name]=0,l=n.name,u=l.substring(0,l.lastIndexOf("."))+".png",i=e.resourceConfig.getResource(u),e.state[n.name]=0,[4,e.load(i,RES.processor.ImageProcessor)];case 3:return c=d.sent(),e.save(i,c),h=dragonBones.EgretFactory.factory,h.parseDragonBonesData(r),h.parseTextureAtlasData(s,c),[2,h]}})})},onRemoveStart:function(e,t){var n=e.get(t),i=t.name,a=i.substring(i.lastIndexOf("/")+1,i.lastIndexOf("_ske.dbbin"));n.removeDragonBonesData(a),n.removeTextureAtlasData(a);var r=i.substring(0,i.lastIndexOf("_ske.dbbin"))+"_tex.png",o=e.resourceConfig.getResource(r),s=e.get(o);return s.dispose(),e.remove(o),Promise.resolve()}});var Main=function(e){function t(){var t=e.call(this)||this;if(!egret.Capabilities.isMobile){var n=egret.MainContext.instance.stage;n.frameRate=60,Game.ChangeFPS(60)}Account.load(),eui.TileLayout.prototype.updateDisplayList=updateDisplayList,t.once(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),mapLayer=new egret.DisplayObjectContainer,mapMessageLayer=new egret.DisplayObjectContainer,messageLayer=new eui.UILayer,uiLayer=new eui.UILayer,loadingLayer=new eui.UILayer,announceLayer=new eui.UILayer,uiLayer.touchEnabled=!1,messageLayer.touchEnabled=!1,messageLayer.touchChildren=!1,messageLayer.left=0,messageLayer.right=0,messageLayer.top=0,messageLayer.bottom=0,loadingLayer.touchEnabled=!1,announceLayer.touchEnabled=!1,announceLayer.touchChildren=!1,announceLayer.left=0,announceLayer.right=0,announceLayer.top=0,announceLayer.bottom=0,t.addChild(mapLayer),t.addChild(mapMessageLayer),t.addChild(uiLayer),t.addChild(messageLayer),t.addChild(loadingLayer),t.addChild(announceLayer);var i=egret.MainContext.instance.stage;return visibleRegion=new egret.Rectangle(-20,-20,i.stageWidth+20,i.stageHeight+20),egret.Capabilities.isMobile||(mapLayer.mask=visibleRegion,i.addEventListener(egret.Event.RESIZE,t.onResize,t)),t}return __extends(t,e),t.prototype.onResize=function(){var e=egret.MainContext.instance.stage;visibleRegion.width=e.stageWidth+20,visibleRegion.height=e.stageHeight+20,mapLayer.mask=visibleRegion},t.prototype.onAddToStage=function(e){return __awaiter(this,void 0,void 0,function(){var e,t,n,i,a,r;return __generator(this,function(o){switch(o.label){case 0:return[4,RES.loadConfig()];case 1:return o.sent(),RES.setMaxLoadingThread(2),RES.cacheDuration=Game.cacheDuration,RES.startRecycleTimer(5e3),e=new AssetAdapter,egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),t=["load.png","loading.png","logo.png","logo1.png","pro_up1.png","preload.json"],egret.Capabilities.isMobile?t.push("public_bg4.jpg"):t.push("public_bg5.jpg"),n="channel/default/notice.json",t.push(n),i=table,[4,this.loadJson("./serverlist.json?v="+Date.now())];case 2:return i.serverlist=o.sent(),table.notices=RES.getRes(n),a="public_config/version.json",t.push(a),RES.createGroup("loading",t),[4,RES.loadGroup("loading",0)];case 3:return o.sent(),[4,LoadManager.init()];case 4:return o.sent(),[4,LoadManager.load("init")];case 5:return o.sent(),[4,this.loadTheme()];case 6:return o.sent(),announce.AB=new announce.Marquee(announceLayer,128,Game.Second),announce.C=new announce.Marquee(messageLayer,148,Game.Second),table.gameVersion=RES.getRes(a),egret.log("version: "+table.gameVersion.ver),this.loadingView=new LoadingUI,this.loadingView.once(egret.Event.ADDED_TO_STAGE,function(){var e=document.getElementById("launchDiv");null!=e&&e.parentNode.removeChild(e)},null),loadingLayer.addChild(this.loadingView),r=this.loadingView,[4,LoadManager.load("sound",r)];case 7:return o.sent(),egret.getOption("ksServerList")?[4,LoadManager.load("serverlist",r)]:[3,9];case 8:return o.sent(),[3,11];case 9:return[4,LoadManager.load("createRole",r)];case 10:o.sent(),o.label=11;case 11:return this.onLoadComplete(),LoadManager.load("config"),[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,n){var i=new eui.Theme("resource/default.thm.json",e.stage);i.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.onLoadComplete=function(){lang.load();var e=RES.getRes("config/blend.json");for(var t in e)table.blendMode[e[t]]=egret.BlendMode.ADD;net.init(),this.createGameScene()},t.prototype.loadJson=function(e){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(i){return t=new egret.HttpRequest,t.responseType=egret.HttpResponseType.TEXT,t.open(e,"get"),t.send(),[2,new Promise(function(e,i){var a=function(){t.removeEventListener(egret.IOErrorEvent.IO_ERROR,r,n),e(JSON.parse(t.response))},r=function(){t.removeEventListener(egret.Event.COMPLETE,a,n),i()};t.once(egret.Event.COMPLETE,a,n),t.once(egret.IOErrorEvent.IO_ERROR,r,n)})]})})},t.prototype.createGameScene=function(){Player.init(),egret.TextField.default_fontFamily="Tahoma",egret.lifecycle.addLifecycleListener(function(e){Game.dispatcher.addEventListener(Game.EVENT.PushToBackground,e.pause,e),Game.dispatcher.addEventListener(Game.EVENT.BringToForeground,e.resume,e)}),egret.lifecycle.onPause=function(){Game.running=!1,SoundUtil.pauseBGM()},egret.lifecycle.onResume=function(){Game.running=!0,Setting.Sound()&&SoundUtil.resumeBGM()},loadingLayer.removeChild(this.loadingView),this.loadingView=null,UIManager.set(new UI.ServerListUI)},t}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var UI;!function(e){var t=function(t){function n(){var i=t.call(this)||this;i.skinName="RuneDetailSkin",i.page=0,i.curSelect=0,i.subKindNum=7,i.mc=[];for(var a=0;a<i.subKindNum;a++){var r=new e.MovieClipComponent;r.removeWhenComplete=!1,r.position="TL";var o=n.mcPos[a];r.x=o[0],r.y=o[1],i.mc.push(r),r.visible=!1}return i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i.addEventListener(egret.Event.REMOVED_FROM_STAGE,i.onRemoveFromStage,i),i.addEventListener(egret.TouchEvent.TOUCH_TAP,i.onTouchTap,i),i}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.Close=function(){null!=this._instance&&UIManager.pop(this._instance)},n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.tab.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this)},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.RuneDataChange,this.onSuccess,this);for(var e=0;e<this.subKindNum;e++)this.mcGroup.addChild(this.mc[e]);this.changePage()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.RuneDataChange,this.onSuccess,this),this.stopAutoRune()},n.prototype.onItemTap=function(){var e=this.tab.selectedIndex;this.page!=e&&(this.page=e,this.changePage(),this.stopAutoRune())},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:UIManager.pop(this);break;case this.btnRune:this.runing=!0,null!=this.timer&&(egret.clearTimeout(this.timer),this.timer=null),this.autoRune();break;default:return}},n.prototype.autoRune=function(){this.timer=null;var t=this.page+1,n=Rune.getBigKindCfg(t),i=n.subKinds[this.curSelect];if(null==i)return void(this.runing=!1);var a=Rune.getRuneLevel(i);if(a>=Rune.maxLevel)return this.runing=!1,void PopUpMessage.push(lang.String("rune cannot rune reach max level"),color.RED);var r=a+1,o=Rune.getAttributeConfig(i,r),s=o.costItem[0],l=o.costItem[1],u=o.costItem[2];if(PlayerAttribute.GetItemCount(s,l)<u)return e.ResourceObtain.Open([o.obtainId]),this.runing=!1,void PopUpMessage.push(lang.String("rune cannot rune not enough material"),color.RED);var c=Refine.getLowLevel(),h=Rune.getTotalLevel();return h>=c?(this.runing=!1,void PopUpMessage.push(lang.String("rune cannot rune need refine first"),color.RED)):void Rune.applyRune(i)},n.prototype.stopAutoRune=function(){this.runing=!1,null!=this.timer&&(egret.clearTimeout(this.timer),this.timer=null);for(var e=0;e<this.subKindNum;e++){var t=this.mc[e];t.visible=!1,t.free()}},n.prototype.onSuccess=function(){this.runing&&null==this.timer&&(this.timer=egret.setTimeout(this.autoRune,this,300));var e=this.mc[this.curSelect];null!=e&&(e.Load("skill/Ui_quan03/Ui_quan03.json","Ui_quan03"),e.gotoAndPlay(0,1),e.visible=!0,this.changePage())},n.prototype.changePage=function(){this.autoSelect();var e=this.page+1,t=Rune.getBigKindCfg(e);this.bgPanel.title=t.name,this.bgImg.source=t.bgImg;for(var n=0;n!=t.subKinds.length;n++){var i=t.subKinds[n],a=Rune.getRuneLevel(i),r=this.kindGroup.getChildAt(n);r.data={smallKind:i,level:a,selected:n==this.curSelect}}},n.prototype.autoSelect=function(){this.badgeLight=!1;for(var e=9999,t=this.page+1,n=Rune.getBigKindCfg(t),i=n.subKinds[0],a=0;a!=n.subKinds.length;a++){var r=n.subKinds[a],o=Rune.getRuneLevel(r);e>o&&o<Rune.maxLevel&&(e=o,this.curSelect=a,i=r)}var s=Rune.getSmallKindConfig(i);if(null!=s){var l=Rune.getRuneLevel(i)+1;l>Rune.maxLevel&&(l=Rune.maxLevel);var u=Rune.getAttributeConfig(i,l);if(null!=u){var c=u.costItem,h=c[0],d=c[1];this.costCell.data={type:"item",content:{genre:h,detailType:d}};var p=PlayerAttribute.GetItemCount(h,d),g=p>=c[2]?color.GREEN:color.RED;this.costNum.textFlow=Game.HtmlTextParser.parse("<font color = "+g+">"+p+"</font>/"+c[2]);var m=Refine.getLowLevel(),f=Rune.getTotalLevel();this.leftTimes.text=f+"/"+m,this.badgeLight=p>=c[2]&&m>f&&l<Rune.maxLevel}}},n.mcPos=[[148,76],[97,136],[145,196],[192,260],[146,319],[98,379],[148,436]],n}(e.FitComponent);e.RuneDetail=t,__reflect(t.prototype,"UI.RuneDetail",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="RuneSmallKindItemSkin",t}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.dataChanged=function(){var e=Rune.getSmallKindNameColor(this.data.smallKind),t=Rune.getSmallKindAttribColor(this.data.smallKind),n=Rune.getSmallKindConfig(this.data.smallKind);this.kindName.text=n.name,this.kindName.textColor=e,this.kindLevel.text="Lv."+this.data.level;var i=this.data.level,a=i+1,r=Rune.getAttributeConfig(this.data.smallKind,i),o=Rune.getAttributeConfig(this.data.smallKind,a);0==i?(this.attribName.text=Buff.GetName(o.buffs[0][0])+":",this.attribName.textColor=t,this.oldValue.text="0",this.newValue.text=o.buffs[0][1].toString(),this.arrow.visible=!0):i==Rune.maxLevel?(this.attribName.text=Buff.GetName(r.buffs[0][0])+":",this.attribName.textColor=t,this.oldValue.text=r.buffs[0][1].toString(),this.newValue.text="",this.arrow.visible=!1):(this.attribName.text=Buff.GetName(r.buffs[0][0])+":",this.attribName.textColor=t,this.oldValue.text=r.buffs[0][1].toString(),this.newValue.text=o.buffs[0][1].toString(),this.arrow.visible=!0),this.data.selected||(this.newValue.text="",this.arrow.visible=!1)},t}(eui.ItemRenderer);e.RuneSmallKindItem=t,__reflect(t.prototype,"UI.RuneSmallKindItem")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="RuneUISkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.RuneDataChange,this.updateData,this),this.updateData()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.RuneDataChange,this.updateData,this)},n.prototype.updateData=function(){for(var e=0;e!=Game.RuneCount;e++){var t=e+1,n=this.levelGroup.getChildAt(e);n.text=Rune.levels[e].toString(),n.textColor=Rune.getSmallKindAttribColor(t)}this.totalPower=Rune.GetTotalFp(),this.totalLevel=Rune.getTotalLevel()},n.prototype.onTouchTap=function(t){switch(t.target){case this.imgBigType1:e.RuneDetail.instance.page=0,UIManager.pushPage(e.RuneDetail.instance);break;case this.imgBigType2:e.RuneDetail.instance.page=1,UIManager.pushPage(e.RuneDetail.instance);break;case this.imgBigType3:e.RuneDetail.instance.page=2,UIManager.pushPage(e.RuneDetail.instance);break;case this.imgBigType4:e.RuneDetail.instance.page=3,UIManager.pushPage(e.RuneDetail.instance);break;default:return}},n}(eui.Component);e.RuneUI=t,__reflect(t.prototype,"UI.RuneUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="ServerItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){null!=this.data&&this.data.status?this.icon="ui/serverlist/icon"+this.data.status+".png":this.icon=null},t}(eui.ItemRenderer);e.ServerItem=t,__reflect(t.prototype,"UI.ServerItem")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="ServerListUISkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n),this.imgBg==n&&(this.imgBg.source=egret.Capabilities.isMobile?"public_bg4.jpg":"public_bg5.jpg")},n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);try{XGSDK.inputAccount(this.selectGroup.parent)}catch(e){}var n,i=[],a=lang.String("recentzone"),r={},o=function(e){for(var t=e.length,i=0;t>i;i++){var a=e[i];(null==n||a["default"]&&(!n["default"]||n.id<a.id))&&(n=a),r[a.id]=a}};for(var s in table.serverlist)if(s!=a){i.push(s);var l=table.serverlist[s];o(l)}table.serverlist[a]=[];var u=Account.ksServerList;if(u){var c=JSON.parse(u);if(c.length&&c.length>0){for(var h=0;h<c.length;h++){var d=r[c[h]];null!=d&&table.serverlist[a].push(d)}this.servers.dataProvider=new eui.ArrayCollection(table.serverlist[a]);var p=table.serverlist[a][0];null!=p&&(n=p)}else this.servers.dataProvider=new eui.ArrayCollection(table.serverlist[i[0]])}else this.servers.dataProvider=new eui.ArrayCollection(table.serverlist[i[0]]);net.server=n,this.server=n.name,n.status?this.icon="ui/serverlist/icon"+n.status+".png":this.icon=null,i.unshift(a),this.zones.dataProvider=new eui.ArrayCollection(i),this.zones.selectedIndex=0,this.zones.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTapZone,this),this.servers.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTapServer,this),this.listGroup.visible=!1},n.prototype.onItemTapZone=function(e){var t=this.zones.selectedItem;this.servers.dataProvider=new eui.ArrayCollection(table.serverlist[t])},n.prototype.onItemTapServer=function(e){var t=this.servers.selectedItem;net.server={name:t.name,url:t.url,status:t.status,id:t.id},this.server=t.name,t.status?this.icon="ui/serverlist/icon"+t.status+".png":this.icon=null,this.listGroup.visible=!1},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnEnter:if(SoundUtil.initplay(),null==net.server)return;if(null!=net.socket&&(net.socket.connecting||net.socket.connected))return;try{if(XGSDK.checkAccount(this.selectGroup.parent))return}catch(t){}e.LoadingIconAnimation.open(),net.connect();break;case this.selectGroup:this.listGroup.visible=!0;break;case this.btnClose:case this.btnClose1:this.listGroup.visible=!1;break;case this.btnChangeAccount:try{XGSDK.logout()}catch(t){}}},n}(e.FitComponent);e.ServerListUI=t,__reflect(t.prototype,"UI.ServerListUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(){0==egret.Capabilities.isMobile},t.prototype.onRemoveFromStage=function(){0==egret.Capabilities.isMobile},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.qSkill.visible=!egret.Capabilities.isMobile},t}(eui.Component);e.SkillBar=t,__reflect(t.prototype,"UI.SkillBar",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skillId=-1,t.slotId=-1,t}return __extends(t,e),t.prototype.onAddToStage=function(){e.prototype.onAddToStage.call(this),-1!=this.slotId&&Game.dispatcher.addEventListener(Game.EVENT.SkillSlotChange,this.updateSkillId,this)},t.prototype.onRemoveFromStage=function(){e.prototype.onRemoveFromStage.call(this),-1!=this.slotId&&Game.dispatcher.removeEventListener(Game.EVENT.SkillSlotChange,this.updateSkillId,this)},t.prototype.updateSkillId=function(){if(-1!=this.slotId){var t=PlayerAttribute.skillSlots[this.slotId],n=t.id;this.skillId=n,e.prototype.updateSkillId.call(this)}},t.prototype.animationUpdateHandler=function(){return e.prototype.animationUpdateHandler.call(this),-1!=this.slotId?1!=World.mapId||Prologue.canSkill(this.slotId)?void(this.forbit&&(Game.removeFromParent.apply(this.forbit),this.touchChildren=!0,this.touchEnabled=!0)):(this.forbit||(this.forbit=new eui.Image,this.forbit.source="icon/item/jz.png",this.forbit.verticalCenter=0,this.forbit.horizontalCenter=0,this.forbit.width=52,this.forbit.height=52),this.forbit.parent!=this&&this.addChild(this.forbit),this.touchChildren=!1,void(this.touchEnabled=!1)):void 0},t}(e.BaseSkillButton);e.SkillButton=t,__reflect(t.prototype,"UI.SkillButton")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;t.skinName="SkillCabinetSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,t.onItemTap,t);for(var n=[{name:"Kỹ Năng",key:"",action:"1"},{name:"Kinh Mạch",key:"",action:"23"},{name:"Mật Tịch",key:"",action:"27,28,29,30,46,47,48,49"},{name:"Tuyệt Học",key:"JueXue",action:"32"}],i=[],a=0;a<n.length;a++)WorldLine.IsOpen(n[a].key)&&i.push(n[a]);return t.tabbar.dataProvider=new eui.ArrayCollection(i),t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.Close=function(){null!=this._instance&&UIManager.pop(this._instance)},t.prototype.onAddToStage=function(){null==this.page&&this.changePage(0)},t.prototype.onItemTap=function(){var e=this.tabbar.selectedIndex;switch(this.page!=e&&(this.page=e),this.bookUI.stopAutoLevelUp(),this.meridianUI.autoTrain.stop(),this.juexueUI.autoLevelUp.stop(),this.page){case 2:badge.onLight(badge.action.BookSkillSelf,!1);break;case 3:badge.onLight(badge.action.JueXue,!1)}},t.prototype.close=function(){UIManager.closeSkill()},t.prototype.changePage=function(e){this.page=e},t}(e.FitComponent);e.SkillCabinet=t,__reflect(t.prototype,"UI.SkillCabinet",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.mc=new e.MovieClipComponent,n.mc.removeWhenComplete=!1,n.mc.position="center",n.mc.verticalCenter=0,n.mc.horizontalCenter=-2,n.mc.visible=!1,n.mc.scaleY=1,n.addChild(n.mc),n}return __extends(n,t),n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.LevelUp,this.onRefreshLevel,this),Game.dispatcher.addEventListener(Game.EVENT.UpdateSkill,this.onSkillLevel,this),this.dataChanged()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.LevelUp,this.onRefreshLevel,this),Game.dispatcher.removeEventListener(Game.EVENT.UpdateSkill,this.onSkillLevel,this),this.mc.visible=!1,this.mc.free()},n.prototype.dataChanged=function(){null!=this.data&&null!=this.badge&&this.onRefreshLevel()},n.prototype.onActiveSkillUpgrade=function(){null!=PlayerAttribute.findSkill(this.data.skillid)&&this.level<PlayerAttribute.skills[this.data.idx].Level&&(this.mc.Load("skill/Ui_quan03/Ui_quan03.json","Ui_quan03"),this.mc.visible=!0,this.mc.gotoAndPlay(0,1))},n.prototype.onPassiveSkillUpgrade=function(){null!=PlayerAttribute.passiveSkill[this.data.skillid]&&this.level<PlayerAttribute.passiveSkill[this.data.skillid].level&&(this.mc.Load("skill/Ui_quan03/Ui_quan03.json","Ui_quan03"),this.mc.visible=!0,this.mc.gotoAndPlay(0,1))},n.prototype.onSkillLevel=function(){switch(this.data.type){case Game.SkillType.ActiveSkill:this.onActiveSkillUpgrade();break;case Game.SkillType.PassiveSkill:this.onPassiveSkillUpgrade()}this.onRefreshLevel()},n.prototype.onRefreshActivateLevel=function(){if(null!=PlayerAttribute.findSkill(this.data.skillid)){this.level=PlayerAttribute.skills[this.data.idx].Level;var e=PlayerAttribute.skills[this.data.idx].ExtendLevel;e>0?this.levelLabel.textFlow=Game.HtmlTextParser.parse('<font color="0xd9bd80">Lv</font> <font color="0xf5f5f5">'+this.level+'</font> <font color="0x6cef5b">(+'+e+")</font>"):this.levelLabel.textFlow=Game.HtmlTextParser.parse('<font color="0xd9bd80">Lv</font> <font color="0xf5f5f5">'+this.level+"</font>")}},n.prototype.onRefreshPassiveLevel=function(){if(null!=PlayerAttribute.passiveSkill[this.data.skillid]){this.level=PlayerAttribute.passiveSkill[this.data.skillid].level;var e=PlayerAttribute.passiveSkill[this.data.skillid].extendLevel;e>0?this.levelLabel.textFlow=Game.HtmlTextParser.parse('<font color="0xd9bd80">Lv</font> <font color="0xf5f5f5">'+this.level+'</font> <font color="0x6cef5b">(+'+e+")</font>"):this.levelLabel.textFlow=Game.HtmlTextParser.parse('<font color="0xd9bd80">Lv</font> <font color="0xf5f5f5">'+this.level+"</font>")}},n.prototype.onRefreshLevel=function(){switch(this.data.type){case Game.SkillType.ActiveSkill:this.onRefreshActivateLevel();break;case Game.SkillType.PassiveSkill:this.onRefreshPassiveLevel()}this.badge.visible=this.check()},n.prototype.checkActiveSkill=function(){var e=Skill.mapSkill[this.data.skillid];return this.level>=Skill.MAX_UPGRADE_LEVEL?!1:PlayerAttribute.Level<e.needLevel?!1:PlayerAttribute.skillpoint<=0?!1:this.level>=PlayerAttribute.Level-e.needLevel+1?!1:!0},n.prototype.checkPassiveSkill=function(){Skill.mapSkill[this.data.skillid];return this.level>=Skill.MAX_UPGRADE_LEVEL?!1:PlayerAttribute.Level<PassiveSkillManager.MIN_LEVEL?!1:PlayerAttribute.skillpoint<=0?!1:!0},n.prototype.check=function(){switch(this.data.type){case Game.SkillType.ActiveSkill:return this.checkActiveSkill();case Game.SkillType.PassiveSkill:return this.checkPassiveSkill()}return!1},n}(eui.ItemRenderer);e.SkillInfo=t,__reflect(t.prototype,"UI.SkillInfo")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.popstate={0:"1st",1:"2nd",2:"3rd"},t.skinName="SkillPopSkin",t}return __extends(t,e),t.prototype.setState=function(e){null!=this.popstate[e]&&(this.currentState=this.popstate[e])},t.prototype.refresh=function(){for(var e=this.list.dataProvider,t=[],n=1;n<PlayerAttribute.skills.length;n++)t.push({skillid:PlayerAttribute.skills[n].Id,icon:Skill.mapSkill[PlayerAttribute.skills[n].Id].icon});e?e.replaceAll(t):this.list.dataProvider=new eui.ArrayCollection(t)},t.prototype.setVisible=function(e){this.visible=e,e&&this.refresh()},t}(eui.Component);e.SkillPop=t,__reflect(t.prototype,"UI.SkillPop",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skills=[],t.usedatas=[],t.autoUpSkillTemp=[],t.skinName="SkillUISkin",t.onResetSkills=MakeDelayExecute(function(){net.socket.write(15,null)},t,150),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.autoUpSkillTemp=[{skillid:0,level:0,type:Game.SkillType.ActiveSkill},{skillid:0,level:0,type:Game.SkillType.ActiveSkill},{skillid:0,level:0,type:Game.SkillType.ActiveSkill},{skillid:0,level:0,type:Game.SkillType.ActiveSkill},{skillid:0,level:0,type:Game.SkillType.ActiveSkill},{skillid:0,level:0,type:Game.SkillType.ActiveSkill},{skillid:0,level:0,type:Game.SkillType.PassiveSkill},{skillid:0,level:0,type:Game.SkillType.PassiveSkill}],t.dataProvider=new eui.ArrayCollection(t.skills),t.usedataProvider=new eui.ArrayCollection(t.usedatas),t.groupUseskill.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap2,t),t.btnResetskill.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onResetSkills,t),t.btnAutoUpSkill.addEventListener(egret.TouchEvent.TOUCH_TAP,t.autoUpSkill,t),t.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,t.onTapList,t),t.skillPop.addEventListener(egret.TouchEvent.TOUCH_TAP,t.PopTouchTop,t),t.btnAdd.addEventListener(egret.TouchEvent.TOUCH_BEGIN,t.onBtnAddTouchBegin,t),t.list.dataProvider=t.dataProvider,t.skillPop.setVisible(!1),t.list.selectedIndex=0,t}return __extends(t,e),t.prototype.checkSkill=function(e){var t=this.autoUpSkillTemp[e];if(t.type==Game.SkillType.ActiveSkill){var n=Skill.mapSkill[t.skillid];Skill.mapSkill[t.skillid].name;if(PlayerAttribute.Level<n.needLevel)return 0;var i=PlayerAttribute.Level-n.needLevel+1;if(t.level>=i)return 0}return PlayerAttribute.skillpoint<=0?0:t.level>=Skill.MAX_UPGRADE_LEVEL?0:t.skillid},t.prototype.getAutoUpSkillIdx=function(){if(PlayerAttribute.skillpoint<=0)return PopUpMessage.push(lang.String("SkillInfo_SkillPoint_Not_Enough"),color.RED),-1;if(this.checkSkill(0)>0)return 0;for(var e=99,t=-1,n=1;3>=n;n++){var i=this.autoUpSkillTemp[n];this.checkSkill(n)>0&&i.level<e&&(e=i.level,t=n)}if(t>0)return t;if(PlayerAttribute.Level>=70)for(var n=6;7>=n;n++)if(this.checkSkill(n)>0)return n;for(var n=4;5>=n;n++)if(this.checkSkill(n)>0)return n;return-1},t.prototype.autoUpSkill=function(){if(this.skills.length<this.autoUpSkillTemp.length)return 0;if(PlayerAttribute.skillpoint<=0)return PopUpMessage.push(lang.String("SkillInfo_SkillPoint_Not_Enough"),color.GREEN),-1;for(var e=0;e<this.autoUpSkillTemp.length;e++)this.autoUpSkillTemp[e].skillid=this.skills[e].skillid,this.autoUpSkillTemp[e].type==Game.SkillType.ActiveSkill?this.autoUpSkillTemp[e].level=PlayerAttribute.skills[e].Level:this.autoUpSkillTemp[e].level=PlayerAttribute.passiveSkill[this.skills[e].skillid].level;for(var e=0;e<PlayerAttribute.skillpoint;e++){var t=this.getAutoUpSkillIdx();
if(t>=0)if(this.autoUpSkillTemp[t].level++,this.autoUpSkillTemp[t].type==Game.SkillType.ActiveSkill){var n=new net.def.C2SDoSkillLvUp;n.setSkillid(this.autoUpSkillTemp[t].skillid),net.socket.write(14,n.toArrayBuffer())}else{var i=new net.def.C2SPassiveSkillLevelup;i.setId(this.autoUpSkillTemp[t].skillid),net.socket.write(2103,i.toArrayBuffer())}}},t.prototype.UpdateAllPanel=function(){this.skills.length=0,this.faction=PlayerAttribute.faction;for(var e=0;e<PlayerAttribute.skills.length;e++){var t=PlayerAttribute.skills[e].Id,n=Skill.mapSkill[t];this.skills.push({type:Game.SkillType.ActiveSkill,skillid:n.id,name:n.name,icon:n.icon,addenabled:!1,idx:e})}var i=0;for(var a in PlayerAttribute.passiveSkill){var n=PassiveSkillManager.passiveSkillMap[a];"faction"==n.type&&(this.skills.push({type:Game.SkillType.PassiveSkill,skillid:n.id,name:n.name,icon:n.icon,addenabled:!1,idx:i+PlayerAttribute.skills.length}),i+=1)}this.dataProvider.refresh(),PassiveSkillManager.NeedUpdate=!1},t.prototype.onAddToStage=function(){if(Game.dispatcher.addEventListener(Game.EVENT.LevelUp,this.onDataChange,this),Game.dispatcher.addEventListener(Game.EVENT.UpdateSkill,this.onDataChange,this),Game.dispatcher.addEventListener(Game.EVENT.UpdatePassiveSkill,this.UpdateAllPanel,this),guide.addEventListener(guide.GuideOperation.GuideSkill,this.onGuideReminder,this),(this.skills.length<1||this.faction!=PlayerAttribute.faction||PassiveSkillManager.NeedUpdate)&&this.UpdateAllPanel(),this.usedatas.length<1){for(var e=1;e<this.skills.length;e++)this.usedatas.push({skillid:this.skills[e].skillid,name:this.skills[e].name,icon:this.skills[e].icon,addenabled:!1});this.usedataProvider.refresh()}this.refresh(),guide.completed()||this.playGuideMovie(guide.info.operation)},t.prototype.onRemoveFromStage=function(){this.skillPop.setVisible(!1),Game.dispatcher.removeEventListener(Game.EVENT.UpdatePassiveSkill,this.UpdateAllPanel,this),Game.dispatcher.removeEventListener(Game.EVENT.LevelUp,this.onDataChange,this),Game.dispatcher.removeEventListener(Game.EVENT.UpdateSkill,this.onDataChange,this),guide.removeEventListener(guide.GuideOperation.GuideSkill,this.onGuideReminder,this),this.onResetSkills.stop()},t.prototype.onDataChange=function(){this.skillpoint=PlayerAttribute.skillpoint,this.onTapList()},t.prototype.refresh=function(){this.onDataChange(),this.refresh2()},t.prototype.refresh2=function(){var e=Skill.mapSkill[PlayerAttribute.skills[0].Id];if(null!=this.imgBaseskill&&(this.imgBaseskill.source=e.icon,this.imgBaseskill.name=e.id.toString(),null!=this.groupUseskill))for(var t=PlayerAttribute.skillSlots,n=0;3>n;n++){var i=this.groupUseskill.getChildAt(n);i.source=t[n].icon}},t.prototype.PopTouchTop=function(e){if(this.skillpoint=PlayerAttribute.skillpoint,null==e.target.data)return void this.skillPop.setVisible(!1);var t=e.target.data.skillid;if(null!=t){var n=Skill.mapSkill[t];if(PlayerAttribute.Level<n.needLevel)return void PopUpMessage.push(lang.StringWithFormat("unlock:level{1}",n.needLevel),color.GREEN);if(t==PlayerAttribute.skills[0].Id)return void PopUpMessage.push(lang.String("SkillUI_BaseSkill_Not_Used"),color.GREEN);PlayerAttribute.SetSkillSlot(this.useskillidx,t);for(var i=PlayerAttribute.skillSlots,a=0;3>a;a++){var r=this.groupUseskill.getChildAt(a),o=Skill.mapSkill[i[a].id].icon;r.source!=o&&(r.source=o)}this.skillPop.setVisible(!1),Game.dispatcher.dispatchEventWith(Game.EVENT.SkillSlotChange),PlayerAttribute.ApplyChangeSkillSelected()}},t.prototype.onTouchTap2=function(e){if(1==this.skillPop.visible)return void this.skillPop.setVisible(!1);for(var t=0;t<this.groupUseskill.numChildren;t++)if(this.groupUseskill.getChildAt(t)==e.target){this.skillPop.setVisible(!0),this.skillPop.setState(t),this.useskillidx=t;break}},t.prototype.onBtnAddTouchBegin=function(e){var t=this;this.onTap();var n=function(){t.onTap(),t.timerId=egret.setTimeout(n,t,200)};this.timerId=egret.setTimeout(n,this,1e3),this.stage.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onBtnAddTouchEnd,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onBtnAddTouchEnd,this),this.stage.addEventListener(egret.TouchEvent.DEACTIVATE,this.onBtnAddTouchEnd,this)},t.prototype.onBtnAddTouchEnd=function(e){var t=e.$currentTarget;t.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onBtnAddTouchEnd,this),t.removeEventListener(egret.TouchEvent.TOUCH_END,this.onBtnAddTouchEnd,this),t.removeEventListener(egret.TouchEvent.DEACTIVATE,this.onBtnAddTouchEnd,this),null!=this.timerId&&(egret.clearTimeout(this.timerId),this.timerId=null)},t.prototype.AddActivateSkill=function(){if(null!=PlayerAttribute.findSkill(this.skills[this.list.selectedIndex].skillid)){var e=this.check();if(null!=e)return void PopUpMessage.push(e,color.GREEN);var t=new net.def.C2SDoSkillLvUp;t.setSkillid(this.skills[this.list.selectedIndex].skillid),net.socket.write(14,t.toArrayBuffer())}},t.prototype.AddPassiveSkill=function(){var e=PassiveSkillManager.passiveSkillMap[this.skills[this.list.selectedIndex].skillid];if(null!=e){if(PlayerAttribute.skillpoint<=0)return void PopUpMessage.push(lang.String("SkillInfo_SkillPoint_Not_Enough"),color.GREEN);if(PlayerAttribute.passiveSkill[e.id].level>=Skill.MAX_UPGRADE_LEVEL)return void PopUpMessage.push(lang.String("SkillInfo_SkillLevel_Max"),color.GREEN);var t=new net.def.C2SPassiveSkillLevelup;t.setId(e.id),net.socket.write(2103,t.toArrayBuffer())}},t.prototype.onTap=function(){switch(this.list.selectedItem.type){case Game.SkillType.ActiveSkill:this.AddActivateSkill();break;case Game.SkillType.PassiveSkill:this.AddPassiveSkill()}},t.prototype.check=function(){var e=Skill.mapSkill[this.skills[this.list.selectedIndex].skillid];if(PlayerAttribute.Level<e.needLevel)return lang.StringWithFormat("unlock:level{1}",e.needLevel);if(PlayerAttribute.skillpoint<=0)return lang.String("SkillInfo_SkillPoint_Not_Enough");if(PlayerAttribute.skills[this.list.selectedIndex].Level>=Skill.MAX_UPGRADE_LEVEL)return lang.String("SkillInfo_SkillLevel_Max");var t=PlayerAttribute.Level-e.needLevel+1;return PlayerAttribute.skills[this.list.selectedIndex].Level>=t?lang.String("SkillInfo_Need_RoleLevelUp"):null},t.prototype.showActiveSkill=function(){var e=Skill.mapSkill[this.list.selectedItem.skillid];this.skillName=Skill.mapSkill[this.list.selectedItem.skillid].name,this.skillIcon=Skill.mapSkill[this.list.selectedItem.skillid].icon;var t=PlayerAttribute.GetSkillFinalLevel(this.list.selectedItem.skillid);this.slevel=lang.Format("Lv{1}",t),this.sNextLevel=lang.Format("Lv{1}",t+1),this.desc=Game.HtmlTextParser.parse(e.GetDesc(PlayerAttribute.GetSkillFinalLevel(PlayerAttribute.skills[this.list.selectedIndex].Id),PlayerAttribute.Level)),PlayerAttribute.Level<e.needLevel||PlayerAttribute.skills[this.list.selectedIndex].Level>=Skill.MAX_UPGRADE_LEVEL||t>=Skill.MAX_LEVEL?(this.nextGroup.visible=!1,this.desc1=Game.HtmlTextParser.parse("")):(this.nextGroup.visible=!0,this.desc1=Game.HtmlTextParser.parse(e.GetDesc(PlayerAttribute.GetSkillFinalLevel(PlayerAttribute.skills[this.list.selectedIndex].Id)+1,PlayerAttribute.Level)))},t.prototype.showPassiveSkill=function(){PlayerAttribute.Level<PassiveSkillManager.MIN_LEVEL&&(this.btnAdd.enabled=!1);var e=PassiveSkillManager.passiveSkillMap[this.list.selectedItem.skillid];this.skillName=PassiveSkillManager.passiveSkillMap[this.list.selectedItem.skillid].name,this.skillIcon=PassiveSkillManager.passiveSkillMap[this.list.selectedItem.skillid].icon;var t=PlayerAttribute.passiveSkill[this.list.selectedItem.skillid],n=t.level+t.extendLevel;this.slevel=lang.Format("Lv{1}",n),this.sNextLevel=lang.Format("Lv{1}",n+1),this.desc=Game.HtmlTextParser.parse(PassiveSkillManager.GetAttributeDesc(e.id,n)),PlayerAttribute.Level<PassiveSkillManager.MIN_LEVEL||t.level>=Skill.MAX_UPGRADE_LEVEL||n>=Skill.MAX_LEVEL?(this.nextGroup.visible=!1,this.desc1=Game.HtmlTextParser.parse("")):(this.nextGroup.visible=!0,this.desc1=Game.HtmlTextParser.parse(PassiveSkillManager.GetAttributeDesc(e.id,n+1)))},t.prototype.onTapList=function(){if(!(this.list.selectedIndex<0))switch(this.btnAdd.enabled=!0,this.list.selectedItem.type){case Game.SkillType.ActiveSkill:this.showActiveSkill();break;case Game.SkillType.PassiveSkill:this.showPassiveSkill()}},t.prototype.onGuideReminder=function(){var e=this;this.visible&&guide.pushMovie({weight:1,handle:function(){e.playGuideMovie(guide.info.operation)}})},t.prototype.playGuideMovie=function(e){switch(e){case guide.GuideOperation.GuideSkill:guide.AddMovieClip(this.btnAutoUpSkill);break;default:return}},t}(eui.Component);e.SkillUI=t,__reflect(t.prototype,"UI.SkillUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.RESIZE,t.Resize,t),t.skinName="SpeechBubbleSkin",t}return __extends(t,e),t.prototype.setText=function(e){this.text.textFlow=Game.HtmlTextParser.parse(e)},t.prototype.Resize=function(){this.anchorOffsetY=this.height},t}(eui.Component);e.SpeechBubble=t,__reflect(t.prototype,"UI.SpeechBubble",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="StrengthenShortItemSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.dataChanged=function(){var e="star";switch(this.data.star){case"5":e+="5";break;case"4":e+="4"}this.currentState=e},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnGo:if(this.data.operation){var t=Number(this.data.operation);Operation.open(t)}}},t}(eui.ItemRenderer);e.StrengthenShortItem=t,__reflect(t.prototype,"UI.StrengthenShortItem")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(e){var n=t.call(this)||this;if(n.tips="Đã chọn: <font color='0xF7B847'>{1}</font>",n.skinName="SwitchFactionSkin",!e)return n;n.itemId=e,n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.key2button={},n.key2button[Game.Faction.tianwang]=n.btnTw,n.key2button[Game.Faction.emei]=n.btnEm,n.key2button[Game.Faction.gaibang]=n.btnGb,n.key2button[Game.Faction.wudu]=n.btnWu,n.key2button[Game.Faction.wudang]=n.btnWd,n.key2button[Game.Faction.shaolin]=n.btnSl,n.key2button[Game.Faction.tianren]=n.btnTr,n.key2button[Game.Faction.tangmen]=n.btnTm,n.key2button[Game.Faction.cuiyan]=n.btnCy,n.key2button[Game.Faction.kunlun]=n.btnKl,n.key2button[Game.Faction.wuhuntang]=n.btnWht,n.radioGroup=n.btnWd.group,n.key2button[PlayerAttribute.faction].selected=!0,n.selectFaction.textFlow=Game.TextParser.parse(lang.Format(n.tips,lang.String("None"))),n.radioGroup.addEventListener(eui.UIEvent.CHANGE,n.radioChangeHandler,n);var i=PlayerAttribute.faction,a=Game.factionSeries[i];n.mySeries=Game.series2Icon[a],n.myFaction=table.faction[i].logoName,n.onSelectFacion(i);for(var r=Game.Faction.start;r<Game.Faction.count;r++)WorldLine.IsFacionOpen(r)||Game.removeFromParent.apply(n.key2button[r]);return n}return __extends(n,t),n.prototype.close=function(){null!=this.timer&&(egret.clearTimeout(this.timer),this.timer=null),UIManager.pop(this)},n.prototype.onTouchTap=function(t){var n=this;switch(t.target){case this.btnSwitch:var i=parseInt(this.radioGroup.selectedValue);if(isNaN(i))return;var a=PlayerAttribute.faction,r=StringWithFormat("Môn phái hiện tại: {1}\nXác nhận chuyển thành: {2}?",table.faction[a].name,table.faction[i].name);e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],lang.String("operation confirm"),r,function(){return null==n.timer&&(n.timer=egret.setTimeout(function(){var e=parseInt(n.radioGroup.selectedValue);n.onSure(e)},n,300)),!0},null,null)}},n.prototype.onSure=function(e){var t=new net.def.UInt32Silce;t.values.push(this.itemId),t.values.push(e),net.socket.write(73,t.toArrayBuffer()),this.close()},n.prototype.onSelectFacion=function(e){switch(this.btnSwitch.enabled=!0,this.selectFaction.textFlow=Game.TextParser.parse(lang.Format(this.tips,table.faction[e].name)),this.factionBg=table.faction[e].bg,this.factionName=table.faction[e].logoName,this.factionLogoD=table.faction[e].logoD,this.btnSwitch.enabled=e!=PlayerAttribute.faction,e){case Game.Faction.tianwang:this.animation.load("tw","st"),this.currentState="tianwang";break;case Game.Faction.emei:this.currentState="emei",this.animation.load("em","st");break;case Game.Faction.gaibang:this.currentState="gaibang",this.animation.load("gb","st");break;case Game.Faction.wudu:this.currentState="wudu",this.animation.load("wu","st");break;case Game.Faction.wudang:this.currentState="wudang",this.animation.load("wd","st");break;case Game.Faction.shaolin:this.currentState="shaolin",this.animation.load("sl","st");break;case Game.Faction.tianren:this.currentState="tianren",this.animation.load("tr","st");break;case Game.Faction.tangmen:this.currentState="tangmen",this.animation.load("tm","st");break;case Game.Faction.cuiyan:this.currentState="cuiyan",this.animation.load("cy","st");break;case Game.Faction.kunlun:this.currentState="kunlun",this.animation.load("kl","st");break;case Game.Faction.wuhuntang:this.currentState="wuhuntang",this.animation.load("wht","st")}},n.prototype.radioChangeHandler=function(e){var t=parseInt(this.radioGroup.selectedValue);isNaN(t)||this.onSelectFacion(t)},n}(e.FitComponent);e.SwitchFaction=t,__reflect(t.prototype,"UI.SwitchFaction",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.touchCaptured=!1,t.touchCaptured=!1,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,t.onTouchBegin,t),t}return __extends(t,e),t.prototype.onTouchBegin=function(e){this.stage.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchCancle,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onStageTouchEnd,this),this.touchCaptured=!0,this.invalidateState(),e.updateAfterEvent()},t.prototype.onStageTouchEnd=function(e){var t=e.currentTarget;t.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchCancle,this),t.removeEventListener(egret.TouchEvent.TOUCH_END,this.onStageTouchEnd,this),this.touchCaptured=!1,this.invalidateState()},t.prototype.onTouchCancle=function(e){var t=e.$currentTarget;t.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchCancle,this),t.removeEventListener(egret.TouchEvent.TOUCH_END,this.onStageTouchEnd,this),this.touchCaptured=!1},Object.defineProperty(t.prototype,"selected",{get:function(){return this.selected},set:function(e){this.selected=e,this.invalidateState()},enumerable:!0,configurable:!0}),t.prototype.getCurrentState=function(){return this.enabled?1==this.selected?this.touchCaptured?"down":"up":this.touchCaptured?"down1":"up1":"disabled"},t}(eui.Component);e.TabItem=t,__reflect(t.prototype,"UI.TabItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="TalkTabSkin",t.onUpdate=MakeDelayExecute(t.updateNewMsgFlag,t,Game.MSPF),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(){this.onUpdate(),Game.dispatcher.addEventListener(Game.EVENT.onNewChatReceived,this.onStateChange,this),Game.dispatcher.addEventListener(Game.EVENT.onNewChatClicked,this.onStateChange,this)},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.onNewChatReceived,this.onStateChange,this),Game.dispatcher.removeEventListener(Game.EVENT.onNewChatClicked,this.onStateChange,this),this.onUpdate.stop()},t.prototype.updateNewMsgFlag=function(){this["new"].visible=ChatSys.checkNewMsg(Number(this.data.channelid))},t.prototype.onStateChange=function(e){var t=e.data;t==this.data.channelid&&this.updateNewMsgFlag()},t}(eui.ItemRenderer);e.TalkTabSkin=t,__reflect(t.prototype,"UI.TalkTabSkin")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="TaskPanelSkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),null!=n._text&&(n._desc.textFlow=Game.HtmlTextParser.parse(n._text)),n.list.itemRenderer=e.AwardCell,null!=n._awards&&(n.list.dataProvider=new eui.ArrayCollection(n._awards)),n}return __extends(n,t),Object.defineProperty(n.prototype,"desc",{get:function(){return this._text},set:function(e){this._text=e,null!=this._desc&&(this._desc.textFlow=Game.HtmlTextParser.parse(this._text))},enumerable:!0,configurable:!0}),n.prototype.setAward=function(e){this._awards=e,null!=this.list&&(this.list.dataProvider=new eui.ArrayCollection(this._awards))},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnOk:(null==this.OnOk||this.OnOk())&&(this.btnOk.enabled=!1,UIManager.pop(this),e.taskPanel=null)}},n.prototype.close=function(){UIManager.pop(this),e.taskPanel=null},n}(e.FitComponent);e.TaskPanel=t,__reflect(t.prototype,"UI.TaskPanel",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var TenfoldAward;!function(e){function t(t){return null!=r&&(egret.clearTimeout(r),r=null),0==t?void(e.buffTime.delta=0):(r=egret.setTimeout(a,null,t*Game.Second),void(e.buffTime.delta=t))}function n(t){0!=t&&(null!=r&&(egret.clearTimeout(r),r=null),e.buffTime.delta<0?e.buffTime.delta=t:e.buffTime.delta+=t,r=egret.setTimeout(a,null,e.buffTime.delta*Game.Second))}function i(){return e.buffTime}function a(){egret.clearTimeout(r),r=null,e.buffTime.delta=0,e.expTime>=10&&badge.onLight(badge.action.TenFoldExpTime,!0)}e.LIMIT_LEVEL=25,e.expTime=0;var r;e.buffTime=new RemainingTime(0),e.buyTimes=0,e.setBuffTime=t,e.addBuffTime=n,e.getBuffTime=i}(TenfoldAward||(TenfoldAward={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.buyTimes=0,e.skinName="TenfoldGainSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.txtBuffTime="00:00:00",e}return __extends(n,t),n.prototype.onTouchTap=function(e){switch(e.target){case this.btnReceive:if(TenfoldAward.expTime<10)return;if(Game.isCityHome())return void PopUpMessage.push(lang.String("operation not permitted"),color.Warning);net.socket.write(142,null),TenfoldAward.addBuffTime(600),TenfoldAward.expTime-=10,this.expTime=TenfoldAward.expTime,this.expTime<10&&(this.btnReceive.enabled=!1),this.onEnterFrame(),this.updateRestTime(),badge.onLight(badge.action.TenFoldExpTime,!1);break;case this.btnBuy:if(TenfoldAward.expTime>=120)return void PopUpMessage.push(lang.String("tenfold exp max time"),color.RED);var t=PlayerAttribute.vipItem.level-1;if(0>t)return void PopUpMessage.push(lang.String("tenfold exp no times"),color.RED);var n=table.tenFoldExpCfg.vipTimes[t];if(TenfoldAward.buyTimes>=n)return void PopUpMessage.push(lang.String("tenfold exp no times"),color.RED);var i=table.tenFoldExpCfg.price[TenfoldAward.buyTimes],a=PlayerAttribute.currency[Game.Currency.GoldCoin];if(i>a)return void PopUpMessage.push(lang.String("tenfold exp coin not enough"),color.RED);this.onBuy(!1,i);break;case this.imgClose:this.close()}},n.prototype.close=function(){UIManager.pop(this)},n.prototype.onAddToStage=function(){SecondTicker.addEventListener(this.onEnterFrame,this),Game.dispatcher.addEventListener(Game.EVENT.TenfoldExp,this.onGetTenfoldMinuts,this),this.onGetTenfoldMinuts(),guide.addEventListener(guide.GuideOperation.TenfoldGain,this.onGuideReminder,this),guide.completed()||this.playGuideMovie(guide.info.operation)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.TenfoldExp,this.onGetTenfoldMinuts,this),SecondTicker.removeEventListener(this.onEnterFrame,this),guide.removeEventListener(guide.GuideOperation.TenfoldGain,this.onGuideReminder,this)},n.prototype.onGetTenfoldMinuts=function(){this.expTime=TenfoldAward.expTime,this.buyTimes=TenfoldAward.buyTimes,PlayerAttribute.Level<TenfoldAward.LIMIT_LEVEL||(this.expTime>=10?this.btnReceive.enabled=!0:this.btnReceive.enabled=!1,this.onEnterFrame())},n.prototype.onEnterFrame=function(){this.txtBuffTime=TenfoldAward.getBuffTime().getHourMinuteSecond()},n.prototype.updateRestTime=function(){null!=this.btnReceive&&null==this.cooldownTimer&&(this.btnReceive.enabled=!1,this.cooldownTimer=egret.setTimeout(this.finishCooldown,this,Game.Second))},n.prototype.finishCooldown=function(){this.expTime>=10&&(this.btnReceive.enabled=!0),this.cooldownTimer=null},n.prototype.onGuideReminder=function(){var e=this;this.visible&&guide.pushMovie({weight:1,handle:function(){e.playGuideMovie(guide.info.operation)}})},n.prototype.playGuideMovie=function(e){switch(e){case guide.GuideOperation.TenfoldGain:guide.AddMovieClip(this.btnReceive);break;default:return}},n.prototype.onBuy=function(t,n){if(t)net.socket.write(265,null);else{var i=lang.String("prompt title"),a=lang.StringWithFormat("confirm buy tenfold exp times",n),r=this;e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],i,a,function(){return r.onBuy(!0,n),!0},null,null)}},n}(e.FitComponent);e.TenfoldGain=t,__reflect(t.prototype,"UI.TenfoldGain",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.boxNumer=0,t.count=0,t.skinName="TreasureUseSkin",t.remainingTime=new RemainingTime,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.AddItem,this.onAddItem,this),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,this.onAddItem,this),SecondTicker.addEventListener(this.onSecondTicker,this),this.refresh()||this.next()},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.AddItem,this.onAddItem,this),Game.dispatcher.removeEventListener(Game.EVENT.UpdateItem,this.onAddItem,this),SecondTicker.removeEventListener(this.onSecondTicker,this),this.imgCell.clearBagcell(),this.goodsName.text="",this.boxNumer=null,this.count=null},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnUse:this.onClickUse()}},t.prototype.onClickUse=function(){PlayerAttribute.useItemByGD(1,this.id,this.boxNumer),this.next(this.id)},t.prototype.onAddItem=function(e){var t=e.data;if(1==t.Item.Type){var n=t.Item;this.check(n)&&(this.id=n.DetailType,this.refresh())}},t.prototype.onRemoveItem=function(e){var t=e.data;1==t.Item.Type},t.prototype.Check=function(){this.id=this.nextBox(),null!=this.id&&this.showPage()},t.prototype.showCheck=function(e){if(2004!=e)return!0;if(GuildWarTaskScene.tokenUsed>=GuildWarTaskScene.MAX_DAILY_TOKEN_USE)return!1;var t=table.props[1][e].params;if(null!=t){var n=t.value.level||0;return PlayerAttribute.Level>=n}return!0},t.prototype.showPage=function(){1==this.showCheck(this.id)&&UIManager.push(this)},t.prototype.check=function(e){return this.showCheck(e.DetailType)&&!e.manualuse&&e.Usable?!0:!1},t.prototype.nextBox=function(e){var t=PlayerAttribute.bag.props[1];if(null!=t){var n;for(var i in t){var a=parseInt(i),r=PlayerAttribute.bag.items[a].Item;if(this.check(r)&&(null==e||r.DetailType!=e)){n=r.DetailType;break}}return n}},t.prototype.next=function(e){this.id=this.nextBox(),this.id!=e?this.refresh():UIManager.pop(this)},t.prototype.refresh=function(){if(null==this.id)return!1;if(this.boxNumer=0,this.count=PlayerAttribute.GetItemCount(1,this.id),this.count<=0)return!1;this.boxNumer=this.count;var e=table.props[1][this.id],t=e.quality||0,n='<font color="'+egret.toColorString(Item.QualityColor[t])+'">'+e.name+"</font>";return this.goodsName.textFlow=Game.HtmlTextParser.parse(n),this.imgCell.setItem(1,e.source,1,t),this.remainingTime.delta=3,this.btnUse.label=lang.StringWithFormat("use({1}second)",this.remainingTime.second),!0},t.prototype.onTimeout=function(){this.onClickUse()},t.prototype.closehandle=function(){this.parent.removeChild(this)},t.prototype.onSecondTicker=function(){0==this.remainingTime.second?this.onClickUse():this.btnUse.label=lang.StringWithFormat("use({1}second)",this.remainingTime.second)},t}(e.FitComponent);e.TreasureUse=t,__reflect(t.prototype,"UI.TreasureUse",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="UpdateIssuesUISkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.open=function(){return null==this._instance&&(this._instance=new t),UIManager.pushPage(this._instance),this._instance},t.prototype.close=function(){UIManager.pop(this)},t.prototype.onAddToStage=function(){this.scroller.viewport.scrollV=0;for(var e="",t=0;t<table.notices.activity.length;t++){var n=table.notices.activity[t];e+="<font color="+color.HeadLines+">"+n.title+"</font>\n";for(var i="",a=0;a<n.issues.length;a++)i+=n.issues[a],a!=n.issues.length-1&&(i+="\n");e+="<font color="+color.MainBody+">"+i+"</font>",t!=table.notices.activity.length-1&&(e+="\n\n")}this.labelDesc.textFlow=Game.HtmlTextParser.parse(e),egret.localStorage.setItem("noticeVersion",table.notices.version)},t.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},t}(e.FitComponent);e.UpdateIssuesUI=t,__reflect(t.prototype,"UI.UpdateIssuesUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="UseItemJueXueSkin",n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.listJueXue.itemRenderer=e.BagCell,n.listJueXue.addEventListener(eui.ItemTapEvent.ITEM_TAP,n.onClickItemList,n),n}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onAddToStage=function(){this.refresh(),this.scrollerJueXue.viewport.scrollV=0,this.panel.btnBack.visible=!1,Game.dispatcher.addEventListener(Game.EVENT.AddItem,this.refresh,this),Game.dispatcher.addEventListener(Game.EVENT.RemoveItem,this.refresh,this),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,this.refresh,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.AddItem,this.refresh,this),Game.dispatcher.removeEventListener(Game.EVENT.RemoveItem,this.refresh,this),Game.dispatcher.removeEventListener(Game.EVENT.UpdateItem,this.refresh,this),this.itemId=0,this.setPart(-1)},n.prototype.onOpenUI=function(e){this.itemId=e.Id;var t=this.getJueXue();null!=t&&(this.setPart(t.Part),UIManager.pushPage(n.instance))},n.prototype.onOpenUI2=function(e){this.itemId=0,this.setPart(e),UIManager.pushPage(n.instance)},n.prototype.onOpenUI3=function(e){this.itemId=e;var t=this.getJueXue();return null==t?void PopUpMessage.push(lang.String("item have been used"),color.RED):(this.pushType=!0,this.setPart(t.Part),void UIManager.push(n.instance))},n.prototype.onTouchTap=function(t){switch(t.target){case this.imgClose:this.close();break;case this.btnDismantlings:var n=this.listJueXue.dataProvider;n&&n.source&&n.source.length>0&&e.ItemSplitUI.instance.onOpenUI(lang.String("juexue_split"),1,n.source,this.calcBack,this.splitItems,this.pushType);break;case this.btnSendChat:this.onSendChat()}},n.prototype.close=function(){UIManager.pop(this)},n.prototype.setPart=function(e){this.itemPart=e,e>0&&e<=Item.JueXuePartsCount?this.partName=lang.String(Item.JueXuePart[e]):this.partName=""},n.prototype.onClickItemList=function(e){var t=e.itemRenderer,n=t.data;if(null!=n&&this.itemId!=n.Id){this.itemId=n.Id;var i=this.getJueXue();null!=i&&(this.setPart(i.Part),this.refreshTips())}},n.prototype.getJueXue=function(){if(this.itemId<=0)return null;var e=PlayerAttribute.bag.GetBagItem(this.itemId);return null==e?(this.itemId=0,null):e.Item},n.prototype.refreshTips=function(){var e=this.getJueXue();null==e?this.itemTip.clear():this.itemTip.update({Id:this.itemId,Item:e},PlayerAttribute.juexues);var t=PlayerAttribute.juexues[this.itemPart];null==t?this.itemTipMount.clear():this.itemTipMount.update({Id:-1,Item:t},PlayerAttribute.juexues)},n.prototype.sortList=function(e,t){var n=e.Item,i=t.Item;return n.Quality!=i.Quality?i.Quality-n.Quality:i.FightingPower-n.FightingPower},n.prototype.fiterPart=function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n].Item;i.Part==this.itemPart&&t.push(e[n])}return t.sort(this.sortList),t},n.prototype.refreshList=function(){var e=PlayerAttribute.bag.GetItemList(11),t=this.fiterPart(e),n=this.listJueXue.dataProvider;null==n?this.listJueXue.dataProvider=new eui.ArrayCollection(t):n.replaceAll(t)},n.prototype.refresh=function(){this.refreshTips(),this.refreshList()},n.prototype.onSendChat=function(){var e=this.getJueXue();null!=e&&ChatMsg.makeChatMsg_JueXue(e)},n.prototype.calcBack=function(e){var t=[];if(null==e)return t;for(var n=0,i=0;i<e.length;i++){var a=e[i],r=a.Item;n+=table.juexuelevelup.growthBack[r.Quality][r.Level]}return 0==n?t:(t.push({genre:Item.JueXueChip.genre,detail:Item.JueXueChip.detail,num:n}),t)},n.prototype.splitItems=function(e){if(null!=e){for(var t=new net.def.UInt32Silce,n=0;n<e.length;n++){var i=e[n];t.values.push(i.Id)}t.values.length>0&&net.socket.write(2113,t.toArrayBuffer())}},n}(e.FitComponent);e.UseItemJueXue=t,__reflect(t.prototype,"UI.UseItemJueXue",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){function t(){return n.onSale(!0),!0}var n,i=function(i){function a(){var e=i.call(this)||this;return e.selectNumer=0,e.count=0,e.skinName="UseItemStackSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(a,i),Object.defineProperty(a,"instance",{get:function(){return null==this._instance&&(this._instance=new a),this._instance},enumerable:!0,configurable:!0}),a.prototype.updateBtnConsignState=function(){var e=!0;switch(this.bagItem.Type){case 0:case 6:case 16:e=!1}if(e){var t=this.bagItem,n=t.Type,i=t.DetailType;e=Consignment.IsConsignmentWare(n,i)}e?(this.btnConsign.visible=!0,this.btnConsign.scaleX=1,this.btnConsign.scaleY=1):(this.btnConsign.visible=!1,this.btnConsign.scaleX=0,this.btnConsign.scaleY=0)},a.prototype.onAddToStage=function(){if(null!=this.bagItem){this.countGroup.visible=!0,this.currentState=Bag.TipState(this.bagItem.Type),this.count=this.bagItem.Count,this.selectNumer=this.count,this.btnUse.enabled=this.bagItem.Usable,this.btnUse.label=lang.String("useitemstack onuse btn msg use"),this.btnSell.enabled=!0,this.updateBtnConsignState();var e;switch(this.bagItem.Type){case 0:var t=this.bagItem;null!=PlayerAttribute.Equips[t.Part]&&(this.btnUse.label=lang.String("useitemstack onuse btn msg compare"),this.btnUse.enabled=!0),e={type:"equipInstance",content:t},this.itemTip.update(e);break;case 6:var n=this.bagItem;e={type:"bookInstance",content:n},this.itemTip.update(e);break;case 16:var i=this.bagItem;e={type:"partnerEquip",content:i},this.itemTip.update(e);break;case 11:egret.error("useitemstack "+this.bagItem.Type+" error");break;case 21:var a=this.bagItem;this.btnSendChat.label=lang.String("WenShi split"),null!=PlayerAttribute.wenshis[a.pos]&&(this.btnUse.label=lang.String("useitemstack onuse btn msg compare"),this.btnUse.enabled=!0),e={type:"wenshiInstance",content:a},this.itemTip.update(e);break;default:var r=this.bagItem;e={type:"item",content:{genre:r.Type,detailType:r.DetailType,bagId:r.BagId}},this.itemTip.update(e),1==this.bagItem.Type&&this.bagItem.manualuse&&(this.countGroup.visible=!1)}egret.Capabilities.isMobile||(this.labSelectNumber.type=egret.TextFieldType.INPUT,this.labSelectNumber.restrict="0-9",this.labSelectNumber.addEventListener(egret.Event.CHANGE,this.onNumberChange,this))
}},a.prototype.onRemoveFromStage=function(){this.selectNumer=0,this.bagItem=null,egret.Capabilities.isMobile||this.labSelectNumber.removeEventListener(egret.Event.CHANGE,this.onNumberChange,this)},a.prototype.onOpenUI=function(e){this.bagItem=e.Item,this.itemId=e.Id,UIManager.pushPage(a.instance)},a.prototype.onTouchTap=function(e){switch(e.target){case this.btnUse:this.onClickUse();break;case this.btnPlus:this.onClickPlus();break;case this.btnMinus:this.onClickMinus();break;case this.imgClose:this.close();break;case this.btnSendChat:this.onSendChat();break;case this.btnSell:this.onSale(!1);break;case this.btnCompare:this.onEquipCompare();break;case this.btnConsign:Consignment.Open(Consignment.PAGE_SELL)}},a.prototype.close=function(){UIManager.pop(this)},a.prototype.onEquipCompare=function(){null!=this.bagItem&&0==this.bagItem.Type&&e.EquipCompare.open(this.bagItem)},a.prototype.onWenShiCompare=function(){null!=this.bagItem&&21==this.bagItem.Type&&e.WenShiCompare.open(this.bagItem)},a.prototype.onSale=function(i){if(null!=this.bagItem){if(!i){var a=!1;switch(this.bagItem.Type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 12:case 13:case 14:case 15:case 17:case 18:a=!0}var r=this.bagItem.Quality>=4;if(a&&r){var o=lang.String("operation confirm"),s="Vật phẩm có giá trị, đồng ý bán?";return n=this,void e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],o,s,t,null,null)}}var l=parseInt(this.labSelectNumber.text);if(isNaN(l)&&(l=1),0>=l)return void PopUpMessage.push(lang.StringWithFormat("bag item select number wrong"),color.RED);l>this.bagItem.Count&&(l=this.bagItem.Count);var u;switch(this.bagItem.Type){case 0:u=new net.def.C2SSingleSmelting,u.setId(this.itemId),u.setForceDelete(!0),net.socket.write(40,u.toArrayBuffer());break;case 6:u=new net.def.BagItemId,u.id=this.itemId,net.socket.write(114,u.toArrayBuffer());break;case 7:u=new net.def.C2SRemoveItem,u.id=this.itemId,u.count=l,net.socket.write(246,u.toArrayBuffer());break;case 8:u=new net.def.C2SRemoveItem,u.id=this.itemId,u.count=l,net.socket.write(245,u.toArrayBuffer());break;case 16:UIManager.push(new e.PartnerEquipSplitUI);break;case 19:e.CollectCardUI.open(3);break;case 20:var c=PlayerAttribute.bag.items[this.itemId].Item;c.DetailType<120?UIManager.push(new e.WuxingshiSplitUI(1)):UIManager.push(new e.WuxingshiSplitUI(2));break;default:PlayerAttribute.discarditem(this.itemId,l)}UIManager.pop(this)}},a.prototype.onSendChat=function(){if(null!=this.bagItem)switch(this.bagItem.Type){case 6:ChatMsg.makeChatMsg_Book(this.bagItem);break;case 0:ChatMsg.makeChatMsg_Equip(this.bagItem);break;case 16:ChatMsg.makeChatMsg_PartnerEquip(this.bagItem);break;case 11:egret.error("useitemstack "+this.bagItem.Type+" error");break;case 21:this.close(),UIManager.push(new e.WenShiSplitUI);break;default:ChatMsg.makeChatMsg_Item(this.bagItem)}},a.prototype.onClickUse=function(){if(null!=this.bagItem&&(this.bagItem.Usable||0==this.bagItem.Type)){switch(this.bagItem.Type){case 4:UIManager.openEnhancement();break;case 8:Partner.ApplyComposePartner(this.bagItem);break;case 9:e.PlayerCabinet.instance.changePage(1),UIManager.openRole();break;case 0:var t=this.bagItem;null!=PlayerAttribute.Equips[t.Part]?this.onEquipCompare():this.bagItem.Use();break;case 15:UIManager.openRole(),UIManager.pushPage(e.AvatarUI.instance);break;case 13:UIManager.openRole(),SuperWeapon.showUi();break;case 16:e.PlayerCabinet.instance.changePage(1),UIManager.openRole();break;case 14:var n=this.bagItem;null!=n.operation&&Operation.open(n.operation);break;case 17:Game.isWildMap()||PopUpMessage.push(lang.String("can not open guild"),color.RED),""==Player.instance.guildName&&Game.isWildMap()&&(PopUpMessage.push(lang.StringWithFormat("no guild"),color.RED),Guild.openGuildEnroll()),""!=Player.instance.guildName&&Game.isWildMap()&&e.GuildBusiTask.open();break;case 19:e.CollectCardUI.open(0);break;case 20:var i=this.bagItem,a=Wuxingyinmanager.GetWuxingshiIdByDetail(i.DetailType),r=Wuxingyinmanager.GetSuitIdByWuxingshiId(a);e.WuxingshiDetail.instance.setSelectSuitId(r),e.WuxingshiDetail.instance.setSelectWuxingshiId(a),e.WuxingyinPanel.open(r);break;case 11:egret.error("useitemstack "+this.bagItem.Type+" error");break;case 21:var o=this.bagItem;null!=PlayerAttribute.wenshis[o.pos]?this.onWenShiCompare():this.bagItem.Use();break;default:this.bagItem.Use()}UIManager.pop(this)}},a.prototype.onClickPlus=function(){this.selectNumer++,this.selectNumer>=this.count&&(this.selectNumer=this.count)},a.prototype.onClickMinus=function(){this.selectNumer--,this.selectNumer<1&&(this.selectNumer=1)},a.prototype.onNumberChange=function(e){var t=parseInt(this.labSelectNumber.text);isNaN(t)&&(t=1),t=Math.min(t,this.bagItem.Count),t=Math.max(1,t),this.labSelectNumber.text=t.toString()},a}(e.FitComponent);e.UseItemStack=i,__reflect(i.prototype,"UI.UseItemStack",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="VipGiftItemSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.dataChanged=function(){var e=color.WHITE;switch(this.awardList.dataProvider=new eui.ArrayCollection(this.data.award),this.data.status){case 0:this.btnBuy.enabled=!0,this.btnBuy.visible=!0;break;case 2:this.btnBuy.visible=!1;break;default:this.btnBuy.enabled=!1,this.btnBuy.visible=!0,e=color.RED}this.itemName.textFlow=Game.HtmlTextParser.parse(lang.StringWithFormat("[discountshop]vip{1} buy","<font color="+e+">"+this.data.level+"</font>"))},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnBuy:if(PlayerAttribute.currency[Game.Currency.GoldCoin]<table.vipBoxes[this.data.level].price)return PopUpMessage.push(lang.String("not enough anyCoin"),color.RED),void UIManager.push(new e.GoldCoinPrompt);Vip.requestBuyItem(this.data.level)}},n}(eui.ItemRenderer);e.VipGiftItem=t,__reflect(t.prototype,"UI.VipGiftItem")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(t,n){var i=e.call(this)||this;return i.skinName="VipLevelUpSkin",i.oldLevel=t,i.curLevel=n,i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i.addEventListener(egret.TouchEvent.TOUCH_TAP,i.onTouchTap,i),i}return __extends(t,e),t.prototype.onAddToStage=function(){var e=this.curLevel==Vip.VipMaxLevel;this.bitmapCurLevel.visible=!e,this.imgVipEnd.visible=e;var t,n=new Array,i="";t=0==this.oldLevel?[]:table.vipPrivilegeDesc[this.oldLevel];for(var a=table.vipPrivilegeDesc[this.curLevel],r=0;r<a.length;r++)if(t[r]){var o=t[r].desc.replace(/\n/,"");n.push({textData:Game.HtmlTextParser.parse(StringWithFormat(o,"<font color="+color.WHITE+">"+t[r].param+"</font>")),num:a[r].param,bDiff:a[r].param!=t[r].param})}else i+=StringWithFormat(a[r].desc,a[r].param);this.list.dataProvider=new eui.ArrayCollection(n),this.lblCurPrivilege.textFlow=Game.HtmlTextParser.parse(i),this.lblAwards.textFlow=Game.HtmlTextParser.parse(lang.StringWithFormat("[discountshop]vip{1} buy","<font color="+color.WHITE+">"+this.curLevel+"</font>"));var s=table.vipBoxes[this.curLevel].award;this.awardList.dataProvider=new eui.ArrayCollection(s),egret.setTimeout(this.close,this,5*Game.Second)},t.prototype.close=function(){UIManager.pop(this)},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnClose:this.close()}},t}(e.FitComponent);e.VipLevelUp=t,__reflect(t.prototype,"UI.VipLevelUp",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.curExp=0,t.maxCurExp=0,t.chargeAmount=0,t.curLevel=0,t.nextLevel=1,t.txtVipGiftDesc="",t.skinName="VipUISkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.tab.addEventListener(eui.ItemTapEvent.ITEM_TAP,t.onBarItemTap,t),t}return __extends(t,e),Object.defineProperty(t.prototype,"isOpened",{get:function(){return this.show},enumerable:!0,configurable:!0}),t.prototype.close=function(){Vip.hideVipUi()},t.prototype.onAddToStage=function(){this.show=!0,this.viewLevel=0,this.onVipDataChanged()},t.prototype.onRemoveFromStage=function(){this.show=!1,this.tab.selectedIndex=0},t.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close();break;case this.btnCharge:Recharge.openRechargeUI();break;case this.btnViewNext:this.viewLevel<Vip.VipMaxLevel&&(this.viewLevel++,this.onBottomDataChanged(!1));break;case this.btnViewPrev:this.viewLevel>this.curLevel+1&&(this.viewLevel--,this.onBottomDataChanged(!1))}},t.prototype.onBarItemTap=function(){badge.onLight(badge.action.VipPrivilegeBox,!1)},t.prototype.updateUi=function(e){var t=PlayerAttribute.vipItem;this.curLevel=t.level,this.curVipIcon=Vip.getVipIcon(this.curLevel);var n;this.curLevel==Vip.VipMaxLevel?(this.nextTipGroup.visible=!1,this.nextVipIcon="",n=Vip.VipMaxLevel,this.bitmapCurLevel.visible=!1,this.imgVipEnd.visible=!0):(this.nextTipGroup.visible=!0,n=this.curLevel+1,this.nextVipIcon=Vip.getVipIcon(n),this.bitmapCurLevel.visible=!0,this.imgVipEnd.visible=!1),this.maxCurExp=table.vipExps[n].exp,this.curExp=t.exp,1==this.tab.selectedIndex&&(e=!1),this.lblCurPrivilege.textFlow=Game.HtmlTextParser.parse(this.getLevelPrivilege(this.curLevel,0)),this.onBottomDataChanged(e)},t.prototype.onVipDataChanged=function(){this.updateUi(!0),this.onUpdateGiftList()},t.prototype.onBottomDataChanged=function(e){if(this.curLevel==Vip.VipMaxLevel)return this.nextTipGroup.visible=!1,this.lblNextPrivilege.textFlow=Game.HtmlTextParser.parse(this.getLevelPrivilege(-1,1)),this.viewIcon=Vip.getVipIcon(-1),this.chargeAmount=0,void(this.bitmapViewLevel.visible=!1);this.bitmapViewLevel.visible=!0;var t=PlayerAttribute.vipItem;e&&(this.viewLevel=this.curLevel+1),this.btnViewPrev.visible=this.viewLevel-this.curLevel!=1,this.btnViewNext.visible=this.viewLevel!=Vip.VipMaxLevel,this.chargeAmount=table.vipExps[this.viewLevel].exp-t.exp,this.viewIcon=Vip.getVipIcon(this.viewLevel),this.lblNextPrivilege.textFlow=Game.HtmlTextParser.parse(this.getLevelPrivilege(this.viewLevel,1))},t.prototype.getLevelPrivilege=function(e,t){if(0>=e||e>Vip.VipMaxLevel)return"";var n,i;0==t?(n=color.WHITE,i=14):(n=color.GREEN,i=14);for(var a="",r=table.vipPrivilegeDesc[e],o=r.length,s=0==this.curLevel?o:table.vipPrivilegeDesc[this.curLevel].length,l=0;l!=o;l++){var u=r[l].desc,c=r[l].param,h=void 0;h=-1!=c?StringWithFormat(u,"<font color="+n+" size="+i+">"+c+"</font>"):u,l>=s&&(h="<font color="+color.GREEN+">"+h+"</font>"),a+=h}return a},t.prototype.onUpdateGiftList=function(){for(var e=PlayerAttribute.vipItem,t=[],n=1;n<=Vip.VipMaxLevel;n++){var i=0!=(e.boxStatus&1<<n-1),a=void 0;a=e.level>=n?i?2:0:1,t.push({level:n,value:table.vipBoxes[n].value,price:table.vipBoxes[n].price,award:table.vipBoxes[n].award,status:a})}t.sort(function(e,t){return e.status==t.status?e.level-t.level:e.status-t.status});var r=this.list.dataProvider;null==r?this.list.dataProvider=new eui.ArrayCollection(t):r.replaceAll(t)},t}(e.FitComponent);e.VipUI=t,__reflect(t.prototype,"UI.VipUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(n){var i=t.call(this)||this;i.player=null,i.wearId=0,i.showTime=0,i.skinName="WeaponShowSkin",null!=n&&(i.wearId=n),i.mc=new e.MovieClipComponent,i.mc.Load("skill/Ui_menke/Ui_menke.json","Ui_menke"),i.mc.horizontalCenter="0",i.mc.verticalCenter="-20",i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i.addEventListener(egret.Event.REMOVED_FROM_STAGE,i.onRemoveFromStage,i),i.addEventListener(egret.TouchEvent.TOUCH_TAP,i.onTouchTap,i);var a=Player.instance;return i.player=a,i.rolePreview.setStatue(PlayerAttribute.faction,null,null),i.rolePreview.updateSuperWeaponEffect(i.wearId),i}return __extends(n,t),n.prototype.onAddToStage=function(){this.player=Player.instance,this.rolePreview.updateSuperWeaponEffect(this.wearId),this.showTime=Game.getServerDate().getTime(),this.addChild(this.mc),this.mc.gotoAndPlay(0,1)},n.prototype.onRemoveFromStage=function(){this.player=null,this.rolePreview.clear(),this.mc.free()},n.prototype.onTouchTap=function(e){this.canClose()&&UIManager.pop(this)},n.prototype.canClose=function(){var e=Game.getServerDate().getTime();return e-this.showTime<n.minExistTime?!1:!0},n.minExistTime=1500,n}(e.FitComponent);e.WeaponShow=t,__reflect(t.prototype,"UI.WeaponShow",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="WemShiCompareSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.open=function(e){null==this._instance&&(this._instance=new t),this._instance.otherEquip=e;var n=e.pos,i=PlayerAttribute.wenshis[n];return this._instance.body.update({type:"wenshiInstance",content:i}),this._instance.other.update({type:"wenshiInstance",content:e}),this._instance.btnSwap.enabled=!1,UIManager.pushPage(this._instance),this._instance},t.prototype.onUse=function(){this.otherEquip.Usable&&(this.otherEquip.Use(),UIManager.pop(this))},t.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close();break;case this.btnUse:this.onUse()}},t.prototype.close=function(){UIManager.pop(this)},t}(e.FitComponent);e.WenShiCompare=t,__reflect(t.prototype,"UI.WenShiCompare",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){e.WenShiAttribColor=[color.GREEN,color.GREEN,color.BLUE,color.PURPLE,color.ORANGE,color.RED];var t=function(t){function n(){var e=t.call(this)||this;e.skinName="WenShiDevelopSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),Game.dispatcher.addEventListener(Game.EVENT.WenShiSyncUpgrade,e.onWenShiUpgradeSuccess,e),Game.dispatcher.addEventListener(Game.EVENT.WenShiSyncBreakThrough,e.onWenShiBreakThroughSuccess,e),Game.dispatcher.addEventListener(Game.EVENT.WenShiChange,e.onDataChange,e),e.attribdescgroup=[],e.attribdescgroup[0]=e.attribdesc0,e.attribdescgroup[1]=e.attribdesc1,e.attribdescgroup[2]=e.attribdesc2,e.checkboxgroup=[],e.checkboxgroup[0]=e.checkbox0,e.checkboxgroup[1]=e.checkbox1,e.checkboxgroup[2]=e.checkbox2,e.prgbarGroup=[],e.prgbarGroup[0]=e.prgbar0,e.prgbarGroup[1]=e.prgbar1,e.prgbarGroup[2]=e.prgbar2;var n=table.props[14][Item.WenShiCostItemId];e.materialcell.icon=n.source,e.materialcell.quality=n.quality;var i=egret.toColorString(color.PURPLE),a="<font color="+i+">"+n.name+"</font>\n";return e.materialname.textFlow=Game.HtmlTextParser.parse(a),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.Close=function(){null!=this._instance&&UIManager.pop(this._instance)},n.prototype.childrenCreated=function(){this.mc=[],t.prototype.childrenCreated.call(this);for(var n=0;n<Game.EquipPart.EquipCount;n++)this.mc[n]=new e.MovieClipComponent,this.mc[n].removeWhenComplete=!1,this.mc[n].position="TL",this.mc[n].x=38+417*(n%2),this.mc[n].y=38+92*~~(n/2),this.mc[n].visible=!1,this.wenshis.addChild(this.mc[n])},n.prototype.AutoSelectEquip=function(){null==this.selectedPos&&(this.selectedPos=0)},n.prototype.SetBaseAttribDesc=function(t,n,i){var a=PlayerAttribute.wenshis[this.selectedPos];if(null==a)return void(this.attribdescgroup[t].textFlow=Game.HtmlTextParser.parse(""));if(null!=this.attribdescgroup[t])if(0==i)this.attribdescgroup[t].textFlow=Game.HtmlTextParser.parse("");else{var r=e.WenShiAttribColor[a.quality],o=egret.toColorString(r),s="";s=a.baseattributes[t].level==Item.WenShiQualityLevel[a.quality]&&a.baseattributes[t].progress==a.getLevelUpMaxProgress(a.quality)||a.baseattributes[t].level==Item.WenShiMaxLevel?n+" "+lang.StringWithFormat("WenShi {1}-{2}level",i-4,i):n+" "+lang.StringWithFormat("WenShi {1}level",i),s="<font color="+o+">"+s+"</font>",this.attribdescgroup[t].textFlow=Game.HtmlTextParser.parse(s)}},n.prototype.SetBaseAttribProgressBar=function(e,t,n){if(null!=this.prgbarGroup[e]){var i=PlayerAttribute.wenshis[this.selectedPos];null==i?(this.prgbarGroup[e].maximum=0,this.prgbarGroup[e].value=0,this.prgbarGroup[e].labelFunction=function(e,t){return"0/0"}):(this.prgbarGroup[e].maximum=t,this.prgbarGroup[e].value=n+1,i.baseattributes[e].level==Item.WenShiQualityLevel[i.quality]&&i.baseattributes[e].progress==i.getLevelUpMaxProgress(i.quality)?this.prgbarGroup[e].labelFunction=function(e,t){return e+"/"+t+lang.String("WenShi CanBreakThrough")}:i.baseattributes[e].level>=Item.WenShiMaxLevel&&this.prgbarGroup[e].value==i.getLevelUpMaxProgress(i.quality)?this.prgbarGroup[e].labelFunction=function(e,t){return e+"/"+t+lang.String("WenShi MaxLevel")}:this.prgbarGroup[e].labelFunction=function(e,t){return e+"/"+t})}},n.prototype.InitBaseAttrib=function(){for(var e=0;e<Item.WenShiBaseAttribCount;e++)this.SetBaseAttribDesc(e,"",0),this.SetBaseAttribProgressBar(e,0,0),this.SetBaseAttribCheckBox(e,!0)},n.prototype.SetBaseAttribCheckBox=function(e,t){null!=this.checkboxgroup[e]&&(this.checkboxgroup[e].selected=t)},n.prototype.CheckWenShiMaxLevel=function(){var e=PlayerAttribute.wenshis[this.selectedPos];if(null==e)return!1;for(var t=0;t<e.baseattributes.length;t++)if(e.baseattributes[t].level<Item.WenShiMaxLevel)return!1;return!0},n.prototype.CheckWenShiMaxPhase=function(){var e=PlayerAttribute.wenshis[this.selectedPos];return null==e?!1:e.phase<Item.WenShiMaxPhase?!1:!0},n.prototype.CheckCanPhaseUp=function(){return this.CheckWenShiMaxLevel()&&!this.CheckWenShiMaxPhase()?!0:!1},n.prototype.CheckCanUpgrade=function(){var e=PlayerAttribute.wenshis[this.selectedPos];if(null==e)return!1;var t=e.baseattributes[this.selectedattrib];return t.level>=Item.WenShiMaxLevel?!1:t.level<Item.WenShiQualityLevel[e.quality]||t.level==Item.WenShiQualityLevel[e.quality]&&t.progress<e.getLevelUpMaxProgress(e.quality)?!0:!1},n.prototype.CheckCanBreakThrough=function(){var e=this.selectedPos,t=PlayerAttribute.wenshis[e];if(null!=t){for(var n=0;n<t.baseattributes.length;n++)if(t.baseattributes[n].progress!=t.getLevelUpMaxProgress(t.quality)||t.baseattributes[n].level!=Item.WenShiQualityLevel[t.quality])return!1;return!0}return!1},n.prototype.autoCheck=function(){for(var e=this.selectedPos,t=PlayerAttribute.wenshis[e],n=-1,i=0;i<Item.WenShiBaseAttribCount;i++)this.checkboxgroup[i].selected=!0;if(null!=t){for(var i=0;i<t.baseattributes.length;i++)t.baseattributes[i].progress==t.getLevelUpMaxProgress(t.quality)&&t.baseattributes[i].level==Item.WenShiQualityLevel[t.quality]?(this.checkboxgroup[i].enabled=!1,this.checkboxgroup[i].visible=!1):t.baseattributes[i].level==Item.WenShiMaxLevel?(this.checkboxgroup[i].enabled=!1,this.checkboxgroup[i].visible=!1):-1==n?(n=i,this.checkboxgroup[i].enabled=!0,this.checkboxgroup[i].visible=!0):(this.checkboxgroup[i].enabled=!0,this.checkboxgroup[i].visible=!0);-1!=n&&(this.checkboxgroup[n].selected=!1,this.selectedattrib=n)}else for(var i=0;i<Item.WenShiBaseAttribCount;i++)this.checkboxgroup[i].enabled=!1,this.checkboxgroup[i].visible=!1},n.prototype.onDataChange=function(){var t=this.selectedPos,n=PlayerAttribute.wenshis[t];if(this.totalPower=PlayerAttribute.GetWenShiPower(PlayerAttribute.wenshis),null!=n){for(var i=0;i<n.baseattributes.length;i++){this.SetBaseAttribDesc(i,Buff.GetDesc(n.baseattributes[i].id,n.baseattributes[i].values),n.baseattributes[i].level);var a=n.getLevelUpMaxProgress(n.quality);n.baseattributes[i].level>=Item.WenShiMaxLevel?this.SetBaseAttribProgressBar(i,a,a-1):this.SetBaseAttribProgressBar(i,a,n.baseattributes[i].progress)}for(var r="",i=0;i<n.qualityattributes.length;i++)if(null!=n.qualityattributes[i]){var o=n.Quality<i+1?color.GRAY:e.WenShiAttribColor[n.quality],s=egret.toColorString(o);r+=lang.StringWithFormat("WenShi {1}pin",i+1),r+="<font color="+s+">"+Buff.GetDesc(n.qualityattributes[i].id,n.qualityattributes[i].values)+"</font>\n"}this.qualityattrib.textFlow=Game.HtmlTextParser.parse(r);var l=PlayerAttribute.bag.getCount(14,Item.WenShiCostItemId);if(this.CheckCanPhaseUp()){this.btnupgrade.label=lang.String("WenShi phase up");var u=n.getPhaseUpCost();l>=u?PlayerAttribute.Level>=table.wenshis[n.id+8].requireLevel?(this.btnupgrade.enabled=!0,this.materialcount.textFlow=Game.HtmlTextParser.parse('<font color="#09e118">'+u+"/</font>"+l)):(this.btnupgrade.enabled=!1,this.materialcount.textFlow=Game.HtmlTextParser.parse(lang.StringWithFormat("WenShi phase up levellimit{1}",table.wenshis[n.id+8].requireLevel))):(this.btnupgrade.enabled=!1,this.materialcount.textFlow=Game.HtmlTextParser.parse('<font color="#f01616">'+u+"/</font>"+l))}else if(this.CheckWenShiMaxLevel())this.btnupgrade.enabled=!1;else{this.btnupgrade.label=this.CheckCanBreakThrough()?lang.String("WenShi breakthrough"):lang.String("WenShi upgrade");var u=this.CheckCanBreakThrough()?n.getBreakThroughCost(n.quality):n.getLevelUpCost(n.quality);l>=u?(this.btnupgrade.enabled=!0,this.materialcount.textFlow=Game.HtmlTextParser.parse('<font color="#09e118">'+u+"/</font>"+l)):(this.btnupgrade.enabled=!1,this.materialcount.textFlow=Game.HtmlTextParser.parse('<font color="#f01616">'+u+"/</font>"+l))}}else this.InitBaseAttrib(),this.qualityattrib.textFlow=Game.HtmlTextParser.parse(""),this.btnupgrade.enabled=!1},n.prototype.RefreashCheckBox=function(e){for(var t=0;t<Item.WenShiBaseAttribCount;t++)e!=t&&this.SetBaseAttribCheckBox(t,!0)},n.prototype.PhaseUp=function(){var e=this.selectedPos,t=new net.def.C2SWenShiPhaseUp;t.setPos(e),net.socket.write(2211,t.toArrayBuffer())},n.prototype.BreakThrough=function(){var e=this.selectedPos,t=new net.def.C2SWenShiBreakThrough;t.setPos(e),net.socket.write(2119,t.toArrayBuffer())},n.prototype.autoUpgrade=function(){if(this.CheckCanUpgrade()){var e=(this.selectedPos,new net.def.C2SWenShiUpgrade);e.setPos(this.selectedPos),e.setAttribindx(this.selectedattrib),net.socket.write(2118,e.toArrayBuffer())}else this.stopAutoUpgrade()},n.prototype.stopAutoUpgrade=function(){return this.upgrading?(this.upgrading=!1,egret.clearTimeout(this.timer),void(this.timer=null)):void 0},n.prototype.onTouchTap=function(t){if(t.target instanceof e.EquipCell)return this.selectedPos=t.target.data.part,this.onDataChange(),this.stopAutoUpgrade(),void this.autoCheck();switch(t.target){case this.checkbox0:this.selectedattrib=0,this.stopAutoUpgrade(),this.RefreashCheckBox(0);break;case this.checkbox1:this.selectedattrib=1,this.stopAutoUpgrade(),this.RefreashCheckBox(1);break;case this.checkbox2:this.selectedattrib=2,this.stopAutoUpgrade(),this.RefreashCheckBox(2);break;case this.btnupgrade:this.CheckCanPhaseUp()?this.PhaseUp():this.CheckCanBreakThrough()?this.BreakThrough():null!=this.timer?this.stopAutoUpgrade():(this.upgrading=!0,this.autoUpgrade())}},n.prototype.onWenShiBreakThroughSuccess=function(){var e=this.selectedPos,t=this.mc[e];t.Load("skill/Ui_qianghua01/Ui_qianghua01.json","Ui_qianghua01"),t.gotoAndPlay(0,1),t.visible=!0,this.autoCheck(),this.onDataChange()},n.prototype.onWenShiUpgradeSuccess=function(){if(this.upgrading){var e=this.selectedPos,t=this.mc[e];t.Load("skill/Ui_qianghua01/Ui_qianghua01.json","Ui_qianghua01"),t.gotoAndPlay(0,1),t.visible=!0,this.CheckCanUpgrade()?this.timer=egret.setTimeout(this.autoUpgrade,this,300):(this.stopAutoUpgrade(),this.autoCheck()),this.onDataChange()}},n.prototype.onAddToStage=function(){this.totalPower=PlayerAttribute.GetWenShiPower(PlayerAttribute.wenshis),this.AutoSelectEquip(),this.InitBaseAttrib(),this.onDataChange(),this.autoCheck()},n.prototype.onRemoveFromStage=function(){this.stopAutoUpgrade()},n}(e.FitComponent);e.WenShiDevelop=t,__reflect(t.prototype,"UI.WenShiDevelop",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="WenShiDevelopViewSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.attribdescgroup=[],e.attribdescgroup[0]=e.attribdesc0,e.attribdescgroup[1]=e.attribdesc1,e.attribdescgroup[2]=e.attribdesc2,e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.Close=function(){null!=this._instance&&UIManager.pop(this._instance)},n.prototype.AutoSelectEquip=function(){null==this.selectedPos&&(this.selectedPos=0)},n.prototype.SetBaseAttribDesc=function(t,n,i){var a=e.otherWenShis[this.selectedPos];if(null==a)return void(this.attribdescgroup[t].textFlow=Game.HtmlTextParser.parse(""));if(null!=this.attribdescgroup[t])if(0==i)this.attribdescgroup[t].textFlow=Game.HtmlTextParser.parse("");else{var r=e.WenShiAttribColor[a.quality],o=egret.toColorString(r),s=n+" "+lang.StringWithFormat("WenShi {1}level",i);s="<font color="+o+">"+s+"</font>",this.attribdescgroup[t].textFlow=Game.HtmlTextParser.parse(s)}},n.prototype.InitBaseAttrib=function(){for(var e=0;e<Item.WenShiBaseAttribCount;e++)this.SetBaseAttribDesc(e,"",0)},n.prototype.onDataChange=function(){var t=this.selectedPos,n=e.otherWenShis[t];if(this.totalPower=PlayerAttribute.GetWenShiPower(e.otherWenShis),null!=n){for(var i=0;i<n.baseattributes.length;i++)this.SetBaseAttribDesc(i,Buff.GetDesc(n.baseattributes[i].id,n.baseattributes[i].values),n.baseattributes[i].level);for(var a="",i=0;i<n.qualityattributes.length;i++)if(null!=n.qualityattributes[i]){var r=n.Quality<i+1?color.GRAY:e.WenShiAttribColor[n.quality],o=egret.toColorString(r);a+=lang.StringWithFormat("WenShi {1}pin",i+1),a+="<font color="+o+">"+Buff.GetDesc(n.qualityattributes[i].id,n.qualityattributes[i].values)+"</font>\n"}this.qualityattrib.textFlow=Game.HtmlTextParser.parse(a)}else this.InitBaseAttrib(),this.qualityattrib.textFlow=Game.HtmlTextParser.parse("")},n.prototype.onTouchTap=function(t){return t.target instanceof e.EquipCell?(this.selectedPos=t.target.data.part,void this.onDataChange()):void 0},n.prototype.onAddToStage=function(){this.totalPower=PlayerAttribute.GetWenShiPower(e.otherWenShis),this.AutoSelectEquip(),this.InitBaseAttrib(),this.onDataChange()},n.prototype.onRemoveFromStage=function(){},n}(e.FitComponent);e.WenShiDevelopView=t,__reflect(t.prototype,"UI.WenShiDevelopView",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;n.skinName="EquipGroupSkin",n.part=Game.EquipPart.EquipWeapon,n.array=new Array(Game.EquipPart.EquipCount);for(var i=0;i<Game.EquipPart.EquipCount;i++)n.array[i]={part:i,icon:null,quality:null,enhancement:null,level:null};return n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),Game.dispatcher.addEventListener(Game.EVENT.WenShiChange,n.onDataChange,n),Game.dispatcher.addEventListener(Game.EVENT.WenShiSyncBreakThrough,n.onDataChange,n),n.list.itemRenderer=e.EquipCell,n}return __extends(n,t),n.prototype.onAddToStage=function(){this.onDataChange()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.WenShiChange,this.onDataChange,this)},n.prototype.onDataChange=function(){for(var e=PlayerAttribute.wenshis,t=0;t<Game.EquipPart.EquipCount;t++){var i=this.array[t];null!=e[t]?(i.icon=e[t].Icon,i.quality=e[t].Quality,i.level=e[t].requireLevel):(i.icon=n.icon[t],i.quality=null,i.level=null),i.enhancement=0}var a=this.list.dataProvider;null==a?this.list.dataProvider=new eui.ArrayCollection(this.array):(a.refresh(),this.list.selectedIndex=this.part)},n.icon=["ui/playerui/equip_0.png","ui/playerui/equip_1.png","ui/playerui/equip_2.png","ui/playerui/equip_3.png","ui/playerui/equip_4.png","ui/playerui/equip_5.png","ui/playerui/equip_6.png","ui/playerui/equip_7.png"],n}(eui.Component);e.WenShiEquipped=t,__reflect(t.prototype,"UI.WenShiEquipped",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;n.skinName="EquipGroupSkin",n.part=Game.EquipPart.EquipWeapon,n.array=new Array(Game.EquipPart.EquipCount);for(var i=0;i<Game.EquipPart.EquipCount;i++)n.array[i]={part:i,icon:null,quality:null,enhancement:null,level:null};return n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.list.itemRenderer=e.EquipCell,n}return __extends(n,t),n.prototype.onAddToStage=function(){this.onDataChange()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.WenShiChange,this.onDataChange,this)},n.prototype.onDataChange=function(){for(var t=e.otherWenShis,n=0;n<Game.EquipPart.EquipCount;n++){var i=this.array[n];null!=t[n]?(i.icon=t[n].Icon,i.quality=t[n].Quality,i.level=t[n].requireLevel):(i.icon=e.WenShiEquipped.icon[n],i.quality=null,i.level=null),i.enhancement=0}var a=this.list.dataProvider;null==a?this.list.dataProvider=new eui.ArrayCollection(this.array):(a.refresh(),this.list.selectedIndex=this.part)},n.icon=["ui/playerui/equip_0.png","ui/playerui/equip_1.png","ui/playerui/equip_2.png","ui/playerui/equip_3.png","ui/playerui/equip_4.png","ui/playerui/equip_5.png","ui/playerui/equip_6.png","ui/playerui/equip_7.png"],n}(eui.Component);e.WenShiEquippedView=t,__reflect(t.prototype,"UI.WenShiEquippedView",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="WenShiIconSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),Game.dispatcher.addEventListener(Game.EVENT.WenShiChange,e.onDataChange,e),e.wenshiimgGroup=[],e.wenshiimgGroup[0]=e.wenshiimg0,e.wenshiimgGroup[1]=e.wenshiimg1,e.wenshiimgGroup[2]=e.wenshiimg2,e.wenshiimgGroup[3]=e.wenshiimg3,e.wenshiimgGroup[4]=e.wenshiimg4,e.wenshiimgGroup[5]=e.wenshiimg5,e.wenshiimgGroup[6]=e.wenshiimg6,e.wenshiimgGroup[7]=e.wenshiimg7,e}return __extends(n,t),n.prototype.onTouchTap=function(t){switch(t.target){case this.wenshiimg0:case this.wenshiimg1:case this.wenshiimg2:case this.wenshiimg3:case this.wenshiimg4:case this.wenshiimg5:case this.wenshiimg6:case this.wenshiimg7:UIManager.pushPage(e.WenShiDevelop.instance)}},n.prototype.onAddToStage=function(){this.onDataChange()},n.prototype.onRemoveFromStage=function(){},n.prototype.onDataChange=function(){for(var e=0;e<Item.WenShiMaxPosCount;e++){var t=PlayerAttribute.wenshis[e];null!=t&&(this.wenshiimgGroup[e].source=t.Icon)}},n}(eui.Component);e.WenShiIcon=t,__reflect(t.prototype,"UI.WenShiIcon",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="WenShiIconViewSkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.wenshiimgGroup=[],n.wenshiimgGroup[0]=n.wenshiimg0,n.wenshiimgGroup[1]=n.wenshiimg1,n.wenshiimgGroup[2]=n.wenshiimg2,n.wenshiimgGroup[3]=n.wenshiimg3,n.wenshiimgGroup[4]=n.wenshiimg4,n.wenshiimgGroup[5]=n.wenshiimg5,n.wenshiimgGroup[6]=n.wenshiimg6,n.wenshiimgGroup[7]=n.wenshiimg7,e.otherWenShis=[],e.otherWenShis[0]=n.wenshi0,e.otherWenShis[1]=n.wenshi1,e.otherWenShis[2]=n.wenshi2,e.otherWenShis[3]=n.wenshi3,e.otherWenShis[4]=n.wenshi4,e.otherWenShis[5]=n.wenshi5,e.otherWenShis[6]=n.wenshi6,e.otherWenShis[7]=n.wenshi7,n}return __extends(n,t),n.prototype.onTouchTap=function(t){switch(t.target){case this.wenshiimg0:case this.wenshiimg1:case this.wenshiimg2:case this.wenshiimg3:case this.wenshiimg4:case this.wenshiimg5:case this.wenshiimg6:case this.wenshiimg7:UIManager.push(e.WenShiDevelopView.instance)
}},n.prototype.onAddToStage=function(){},n.prototype.onRemoveFromStage=function(){},n.prototype.SetWenShi=function(t,n){e.otherWenShis[t]=n,this.wenshiimgGroup[t].source=n.Icon},n.prototype.GetWenShi=function(){return this.wenshiimgGroup},n}(eui.Component);e.WenShiIconView=t,__reflect(t.prototype,"UI.WenShiIconView",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.data=null,e.selectImg="ui/common1/btn_check2_1d1.png",e.noSelectImg="ui/common1/btn_check2_0u.png",e.skinName="WenShiSplitItemSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.dataChanged=function(){null!=this.data&&(this.cell.data=this.data.item,this.imgSelect.source=this.data.selecte?this.selectImg:this.noSelectImg)},n.prototype.onTouchTap=function(e){switch(e.target){case this.cell:this.displayTips();break;default:this.selectItem()}},n.prototype.displayTips=function(){if(null!=this.data){var t=this.data.item.Item,n={type:"wenshiInstance",content:t};e.ItemTips.instance.data=n,UIManager.push(e.ItemTips.instance)}},n.prototype.selectItem=function(){this.data.selecte=!this.data.selecte,this.imgSelect.source=this.data.selecte?this.selectImg:this.noSelectImg,Game.dispatcher.dispatchEventWith(Game.EVENT.WenShiSplitSelectItemChange)},n}(eui.ItemRenderer);e.WenShiSplitItem=t,__reflect(t.prototype,"UI.WenShiSplitItem")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="WenShiSplitMaterialItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){var e=table.props[this.data.genre][this.data.detail];this.materialName.textFlow=Game.HtmlTextParser.parse(e.name),this.num=this.data.num,this.cell.data={type:"item",content:{genre:this.data.genre,detailType:this.data.detail}}},t}(eui.ItemRenderer);e.WenShiSplitMaterialItem=t,__reflect(t.prototype,"UI.WenShiSplitMaterialItem")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.array=[],e.arrayMaterial=[],e.skinName="WenShiSplitUISkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.arrCheckBos=[],e.listData=new eui.ArrayCollection,e.array=[],e.listMaterialData=new eui.ArrayCollection,e.arrayMaterial=[],e.arrCheckBos.push(e.selectZero),e.arrCheckBos.push(e.selectOne),e.arrCheckBos.push(e.selectTwo),e.arrCheckBos.push(e.selectThree),e.arrCheckBos.push(e.selectFour),e}return __extends(n,t),n.prototype.onAddToStage=function(){this.list.itemRenderer=e.WenShiSplitItem,this.list.dataProvider=this.listData,this.listMaterial.itemRenderer=e.PartnterEquipSplitMaterialItem,this.listMaterial.dataProvider=this.listMaterialData,this.displayWenShiList(),Game.dispatcher.addEventListener(Game.EVENT.AddItem,this.onItemChange,this),Game.dispatcher.addEventListener(Game.EVENT.RemoveItem,this.onItemChange,this),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,this.onItemChange,this),this.list.addEventListener(egret.Event.CHANGE,this.selectItemChange,this),Game.dispatcher.addEventListener(Game.EVENT.WenShiSplitSelectItemChange,this.selectItemChange,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.AddItem,this.onItemChange,this),Game.dispatcher.removeEventListener(Game.EVENT.RemoveItem,this.onItemChange,this),Game.dispatcher.removeEventListener(Game.EVENT.UpdateItem,this.onItemChange,this),this.list.removeEventListener(egret.Event.CHANGE,this.selectItemChange,this),Game.dispatcher.removeEventListener(Game.EVENT.WenShiSplitSelectItemChange,this.selectItemChange,this)},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close();break;case this.btnSplit:this.split();break;case this.selectZero:case this.selectOne:case this.selectTwo:case this.selectThree:case this.selectFour:this.selectQuality()}},n.prototype.close=function(){UIManager.pop(this)},n.prototype.selectQuality=function(){this.displayWenShiList(),this.selectItemChange()},n.prototype.onItemChange=function(e){var t=e.data;21==t.Item.Type&&this.displayWenShiList()},n.prototype.sort=function(e,t){var n=e.Item,i=t.Item;return i.quality-n.quality},n.prototype.displayWenShiList=function(){this.array=[];var e=PlayerAttribute.bag.GetAllWenShis();e.sort(this.sort);for(var t=0;t!=e.length;t++){var n=e[t].Item;n.quality<Item.WenShiMaxQuality&&this.array.push({item:e[t],selecte:this.arrCheckBos[n.quality].selected})}this.listData.replaceAll(this.array),this.selectItemChange()},n.prototype.sortMaterial=function(e,t){return e[0]!=t[0]?e[0]-t[0]:e[1]-t[1]},n.prototype.selectItemChange=function(){var e=[];e[0]=Item.WenShiSplitMaterial[0],e[1]=Item.WenShiSplitMaterial[1],e[2]=0;for(var t=0;t!=this.listData.length;t++){var n=this.listData.getItemAt(t),i=n.item.Item;if(n.selecte){var a=i.GetSplitMaterial();e[2]+=a}else this.arrCheckBos[i.quality].selected=!1}this.arrayMaterial=[],this.arrayMaterial.push({genre:e[0],detail:e[1],num:e[2]}),this.listMaterialData.replaceAll(this.arrayMaterial)},n.prototype.getMaterialString=function(e){for(var t=[],n=0;n!=e.length;n++){var i=e[n][0],a=e[n][1],r=e[n][2],o=table.props[i][a];t.push(o.name+" x"+r)}return t},n.prototype.split=function(){for(var e=[],t=0;t!=this.listData.length;t++){var n=this.listData.getItemAt(t);n.selecte&&e.push(n.item.Id)}var i=new net.def.IndexList;i.indexs=e,net.socket.write(2200,i.toArrayBuffer())},n}(e.FitComponent);e.WenShiSplitUI=t,__reflect(t.prototype,"UI.WenShiSplitUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="WildBossEndSkin",e.ready=!1,e.myRank=0,e.myDamage=0,e.isShowRankList=!1,e.rankListData=new Array,e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(n,t),n.prototype.close=function(){UIManager.pop(this),null!=this.funClose&&this.funClose()},n.prototype.onAddToStage=function(){this.ready=!0,1==this.isShowRankList&&this.doUpdateRankList(),this.doUpdateAwardList()},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},n.prototype.doUpdateRankList=function(){this.ready&&(this.damageRankList.itemRenderer=e.PlayerKillList,this.damageRankList.dataProvider=new eui.ArrayCollection(this.rankListData))},n.prototype.doUpdateAwardList=function(){this.ready&&(this.awardList.itemRenderer=e.AwardCell,this.awardList.dataProvider=new eui.ArrayCollection(this.awardListData))},n.prototype.updateWildBossData=function(e,t){if(null!=e){if(this.currentState="wildboss",this.isShowRankList=!0,this.myRank=e.myRankInfo.rank,this.myName=Player.instance.Name,this.myDamage=Math.floor(e.myRankInfo.value/1e3),this.rankBg)switch(this.myRank){case 1:this.rankBg.source="ui/ranking/first_icon.png";break;case 2:this.rankBg.source="ui/ranking/second_icon.png";break;case 3:this.rankBg.source="ui/ranking/third_icon.png";break;case 4:this.rankBg.source="ui/ranking/0.png"}this.updateRankList(e.rankList.items),this.updateAwardList(e.awards)}},n.prototype.updateLittleBossData=function(e,t){null!=e&&(this.currentState="littleboss",this.isShowRankList=!1,this.updateAwardList(e.awards))},n.prototype.updateRankList=function(e){for(var t=new Array,n=e.length,i=0;n>i;i++)t[i]={rank:e[i].rank,name:e[i].name,damage:Math.floor(e[i].value/1e3)};this.rankListData=t,this.doUpdateRankList()},n.prototype.updateAwardList=function(e){if(null!=e&&0!=e.length){for(var t=new Array,n=e.length,i=0;n>i;i++){var a=table.parseAward(e[i]);t[i]=a}this.awardListData=t,this.doUpdateAwardList()}},n.prototype.setCloseCallBack=function(e){this.funClose=e},n}(e.FitComponent);e.WildBossEnd=t,__reflect(t.prototype,"UI.WildBossEnd",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t;!function(e){e[e.WildBoss=1]="WildBoss",e[e.CrossServerBoss=2]="CrossServerBoss"}(t=e.WildBossNoteViewType||(e.WildBossNoteViewType={}));var n=function(n){function i(e){var i=n.call(this)||this;return i.remainingTime=new RemainingTime,i.isShowAwardTips=!1,i.skinName="WildBossNoteSkin",i.addEventListener(egret.TouchEvent.TOUCH_TAP,i.onTouchTap,i),i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i.addEventListener(egret.Event.REMOVED_FROM_STAGE,i.onRemoveFromStage,i),i.myRank=0,i.myScore=0,i.ready=!1,i.data=new Array,i.data[0]={rank:1,name:"",damage:0},i.viewType=e,i.isShowAwardTips=e==t.WildBoss,i}return __extends(i,n),i.prototype.onAddToStage=function(){SecondTicker.addEventListener(this.updateRestTime,this),this.ready=!0,this.rankPannel.visible=this.viewType==t.CrossServerBoss||this.viewType==t.WildBoss,this.doUpdateList()},i.prototype.onRemoveFromStage=function(){this.crossBossIdx=null,SecondTicker.removeEventListener(this.updateRestTime,this)},Object.defineProperty(i.prototype,"restTime",{get:function(){return this.remainingTime.delta},set:function(e){this.remainingTime.delta=e,this.updateRestTime()},enumerable:!0,configurable:!0}),i.prototype.updateRestTime=function(){this.time=this.remainingTime.getMinuteSecond()},i.prototype.onTouchTap=function(n){switch(n.target){case this.btnExit:net.socket.write(141,null);break;case this.btnAwardTips:if(this.viewType==t.CrossServerBoss)UIManager.push(new e.AwardsRulePanel("Thưởng Khiêu Chiến",CrossServer.bossConfig[this.crossBossIdx].awardsRule));else{var i=new e.Rule;i.skinName="WildBossAwardTipSkin",UIManager.pushNoTween(i)}}},i.prototype.updateBossStatus=function(e){switch(e){case 2:case 3:this.txtLeftTimeLabel=lang.String("close rest time");break;default:this.txtLeftTimeLabel=lang.String("escape rest time")}},i.prototype.updateRankValue=function(e,t){this.myRank=e,this.myScore=t},i.prototype.updateBossHP=function(e,t){null!=this.bossBar&&(this.bossBar.maximum=e,this.bossBar.value=t)},i.prototype.doUpdateList=function(){this.ready&&(this.list.itemRenderer=e.PlayerKillList,this.list.dataProvider=new eui.ArrayCollection(this.data))},i.prototype.updateRankingListData=function(e){this.data=e,this.doUpdateList()},i}(e.FitComponent);e.WildBossNoteUI=n,__reflect(n.prototype,"UI.WildBossNoteUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="YesouTaskMiniSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTap,t),t.onSyncYesouTask(),t}return __extends(t,e),t.prototype.onTweenFinish=function(){},t.prototype.playTween=function(e){},t.prototype.onSyncYesouTask=function(){var e=yesouTaskManager.getCurTaskCfg();this.desc=yesouTaskManager.getTaskDesc(e),this.awardDesc=e.awardDesc,yesouTaskManager.curTaskId==yesouTaskManager.FINISHTASKID&&(this.awardDesc=lang.String("yesoutask mini msg click here to close")),this.invalidateState(),yesouTaskManager.dailyTimes<yesouTaskManager.dailyMaxTimes?this.dailyTimes="("+yesouTaskManager.dailyTimes+"/"+yesouTaskManager.dailyMaxTimes+")":this.dailyTimes=""},t.prototype.onTaskReminder=function(){var e=this;guide.pushMovie({weight:0,handle:function(){e.showMovie()}})},t.prototype.onTap=function(e){switch(e.target){default:yesouTaskManager.onTouchTap()}},t.prototype.showMovie=function(){},t.prototype.getCurrentState=function(){var e=yesouTaskManager.getCurTaskCfg();return null==e?"task":yesouTaskManager.curTaskValue>=e.target[0]?"completed":"task"},t}(eui.Component);e.YesouTaskMini=t,__reflect(t.prototype,"UI.YesouTaskMini",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="YesouTaskPhaseAwardItemSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.dataChanged=function(){var e=yesouTaskManager.phaseAwardConfig[this.data.index];this.taskNum.text=yesouTaskManager.sumTimes+"/"+e.taskNum,this.awardItem.data=e.awards[0],this.getAwardGroup.visible=yesouTaskManager.sumTimes>=e.taskNum&&yesouTaskManager.getAwardInfo[this.data.index]?!0:!1,this.badgeGroup.visible=yesouTaskManager.sumTimes>=e.taskNum&&!yesouTaskManager.getAwardInfo[this.data.index]?!0:!1},t.prototype.onTouchTap=function(e){switch(e.target){case this.badgeGroup:var t=new net.def.Index;t.setIndex(this.data.index),net.socket.write(2008,t.toArrayBuffer())}},t}(eui.ItemRenderer);e.YesouTaskPhaseAwardItem=t,__reflect(t.prototype,"UI.YesouTaskPhaseAwardItem")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="YesouTaskUISkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.dataTaskAward=new eui.ArrayCollection,n.listTaskAward.itemRenderer=e.AwardCell,n.listTaskAward.dataProvider=n.dataTaskAward,n}return __extends(n,t),n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.YesouTaskChanged,this.update,this),Game.dispatcher.addEventListener(Game.EVENT.AddItem,this.update,this),Game.dispatcher.addEventListener(Game.EVENT.RemoveItem,this.update,this),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,this.update,this),Game.dispatcher.addEventListener(Game.EVENT.BagItemChange,this.update,this),this.update()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.YesouTaskChanged,this.update,this),Game.dispatcher.removeEventListener(Game.EVENT.AddItem,this.update,this),Game.dispatcher.removeEventListener(Game.EVENT.RemoveItem,this.update,this),Game.dispatcher.removeEventListener(Game.EVENT.UpdateItem,this.update,this),Game.dispatcher.removeEventListener(Game.EVENT.BagItemChange,this.update,this)},n.prototype.update=function(){var e=yesouTaskManager.getCurTaskCfg();if(null!=e){for(var t=[],n=0;n!=e.awards.length;n++)t[n]=e.awards[n];this.dataTaskAward.replaceAll(t),this.dailyTimes.text="("+yesouTaskManager.dailyTimes+"/"+yesouTaskManager.dailyMaxTimes+")",this.taskDesc.text=lang.StringWithFormat("yesoutask cur task desc{1}",yesouTaskManager.getTaskDesc(e)),this.taskDesc.textColor=yesouTaskManager.curTaskValue>=e.target[0]?color.GREEN:color.WHITE;var i=PlayerAttribute.GetItemCount(yesouTaskManager.QUICKFINISH_ITEM_GENRE,yesouTaskManager.QUICKFINISH_ITEM_DETAIL);this.quickFinishCost.text=i+" / 1",this.quickFinishCost.textColor=i>=1?color.GREEN:color.RED,this.btnQuickFinish.enabled=i>=1?!0:!1,yesouTaskManager.curTaskValue>=e.target[0]?(this.btnGetAward.label=lang.String("yesoutask btn msg get award"),this.btnQuickFinish.enabled=!1):this.btnGetAward.label=lang.String("yesoutask btn msg do task"),this.btnGetAward.visible=yesouTaskManager.curTaskId!=yesouTaskManager.FINISHTASKID,this.phaseAward0.data={index:0},this.phaseAward1.data={index:1},this.phaseAward2.data={index:2},this.phaseAward3.data={index:3},this.phaseAward4.data={index:4},this.phaseAward5.data={index:5},this.phaseAward6.data={index:6},this.phaseAward7.data={index:7},this.phaseAward8.data={index:8},this.phaseAward9.data={index:9}}},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnGetAward:yesouTaskManager.onTouchTap();break;case this.btnQuickFinish:this.QuickFinish();break;case this.btnGainRes:this.BuyQuickFinishItem();break;case this.btnRules:var n=new e.Rule;n.skinName="YesouRules",UIManager.pushPage(n)}},n.prototype.QuickFinish=function(){return yesouTaskManager.sumTimes>=yesouTaskManager.FINISHTASKNUM?void PopUpMessage.push(lang.String("yesoutask you should get phase award first"),color.RED):PlayerAttribute.GetItemCount(yesouTaskManager.QUICKFINISH_ITEM_GENRE,yesouTaskManager.QUICKFINISH_ITEM_DETAIL)<=0?void PopUpMessage.push(lang.String("yesoutask no item can not quick finish task"),color.RED):void net.socket.write(2007,null)},n.prototype.BuyQuickFinishItem=function(){var e=GoldCoinShop.mapGoods[yesouTaskManager.QUICKFINISH_ITEM_GENRE][yesouTaskManager.QUICKFINISH_ITEM_DETAIL];null!=e&&GoldCoinShop.buy(e.pos,e.id)},n}(e.FitComponent);e.YesouTaskUI=t,__reflect(t.prototype,"UI.YesouTaskUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.nowarn=!1,n.skinName="MoneyTreeSkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.mc=new e.MovieClipComponent,n.mc.horizontalCenter=0,n.mc.verticalCenter=-145,n}return __extends(n,t),n.prototype.onAddToStage=function(){MoneyTreeManager.updateUIData()},n.prototype.onRemoveFromStage=function(){Game.removeFromParent.apply(this.mc),this.mc.free()},n.prototype.SetGainProgress=function(e,t){this.maxValue=t,this.curValue=e,this.percent=Math.floor(100*e/t)/100},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnIrrigate:if(this.leftIrrigateTimes<1)return void PopUpMessage.push(lang.String("moneytree daily irrigate times runs out"),color.RED);this.Irrigate(),badge.onLight(badge.action.MoneyTree,!1);break;case this.btnGain:MoneyTreeManager.Gain(),this.showEffect(),badge.onLight(badge.action.MoneyTree,!1)}},n.prototype.Irrigate=function(){var t=this;if(!this.nowarn&&this.nextIrrigatePrice>0&&PlayerAttribute.currency[Game.Currency.SilverCoin]<this.nextIrrigatePrice){var n=new e.SliverCoinPrompt;n.title=lang.String("operation confirm"),n.content=lang.StringWithFormat("if replace {1} silver with gold",this.nextIrrigatePrice-PlayerAttribute.currency[Game.Currency.SilverCoin]),n.cb=function(e){return PlayerAttribute.currency[Game.Currency.SilverCoin]+PlayerAttribute.currency[Game.Currency.GoldCoin]<t.nextIrrigatePrice?(Recharge.openRechargeUI(),void UIManager.pop(n)):(MoneyTreeManager.Irrigate(),t.showEffect(),t.nowarn=e,void UIManager.pop(n))},UIManager.push(n)}else MoneyTreeManager.Irrigate(),this.showEffect()},n.prototype.showEffect=function(){this.mc.Load("skill/tm_fanwei/tm_fanwei.json","tm_fanwei"),this.mc.gotoAndPlay(0,1),this.getChildIndex(this.mc)<0&&this.addChild(this.mc)},n}(e.FitComponent);e.MoneyTree=t,__reflect(t.prototype,"UI.MoneyTree",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="RetrieveItemSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),n.prototype.onAddToStage=function(){this.btnGetAward.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGetAward,this)},n.prototype.onRemoveFromStage=function(){},n.prototype.dataChanged=function(){if(null!=this.data){this.currentState=this.data.state;var t=RewardRetrieveLogic.awardsData(this.data.awardId,this.data.currency);this.list.itemRenderer=e.AwardCell,this.list.dataProvider=new eui.ArrayCollection(t)}},n.prototype.onGetAward=function(){var t=this;if(RewardRetrieveLogic.checkCurrency(this.data.currency,this.data.cost,!1))RewardRetrieveLogic.requestGetAward(this.data.id,this.data.currency,1);else{if(this.data.currency!=Game.Currency.SilverCoin)return void RewardRetrieveLogic.showTipMoneyMsg(this.data.currency);var n=lang.String("operation confirm"),i=this.data.cost-PlayerAttribute.currency[Game.Currency.SilverCoin],a=(lang.String("silverCoin"),lang.StringWithFormat("if replace {1} silver with gold",i));e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],n,a,function(){return t.confirmGetAward(),!0},null,null)}},n.prototype.confirmGetAward=function(){RewardRetrieveLogic.checkCurrency(this.data.currency,this.data.cost,!0)?RewardRetrieveLogic.requestGetAward(this.data.id,this.data.currency,1):RewardRetrieveLogic.showTipMoneyMsg(Game.Currency.GoldCoin)},n}(eui.ItemRenderer);e.RetrieveItem=t,__reflect(t.prototype,"UI.RetrieveItem")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="RewardRetrieveSkin",e.costTotal=0,e.setCurrency(RewardRetrieveLogic.Currency_Perfect),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),RewardRetrieveLogic.requestServerInfo(),e}return __extends(n,t),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.tab.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onBarItemTap,this)},n.prototype.onAddToStage=function(){this.updateUi(),RewardRetrieveLogic.onUiChange(this)},n.prototype.onRemoveFromStage=function(){RewardRetrieveLogic.onUiChange(null)},n.prototype.onGetAllAward=function(){var t=this,n=lang.String("operation confirm"),i="",a="";if(this.currency==Game.Currency.SilverCoin)if(RewardRetrieveLogic.checkCurrency(this.currency,this.costTotal,!1))i=lang.String("silverCoin"),a=lang.StringWithFormat("confirm retrieve",this.costTotal,i);else{var r=this.costTotal-PlayerAttribute.currency[Game.Currency.SilverCoin];a=lang.StringWithFormat("if replace {1} silver with gold",r)}else i=lang.String("copperCoin"),a=lang.StringWithFormat("confirm retrieve without cost",this.costTotal,i);e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],n,a,function(){return t.confirmGetAllAward(),!0},null,null)},n.prototype.confirmGetAllAward=function(){RewardRetrieveLogic.checkCurrency(this.currency,this.costTotal,!0)?RewardRetrieveLogic.requestGetAllAward(this.currency):RewardRetrieveLogic.showTipMoneyMsg(this.currency)},n.prototype.setCurrency=function(e){e==RewardRetrieveLogic.Currency_Perfect?this.currentState="perfect":this.currentState="normal",this.currency=e},n.prototype.onSwitchType=function(e){this.currency!=e&&(this.setCurrency(e),this.updateUi())},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnGetAllAward:this.onGetAllAward()}},n.prototype.onBarItemTap=function(e){switch(e.itemIndex){case 0:this.onSwitchType(RewardRetrieveLogic.Currency_Perfect);break;case 1:this.onSwitchType(RewardRetrieveLogic.Currency_Normal)}},n.prototype.updateUi=function(){this.costTotal=0;var e,t=RewardRetrieveLogic.getSubjects(),n=0;e=new Array;for(var i=PlayerAttribute.Level,a=0;a<t.length;a++)if(!(t[a].count<=0)){var r=t[a];if(!(2==r.id||r.id>=19&&r.id<=22)||!(i<r.level||i>r.maxLevel)){var o={id:r.id,sortIndex:r.sortIndex,name:r.name,currency:this.currency,count:r.count,cost:r.cost(this.currency),enabled:!0,enoughcoin:r.enabled(this.currency,!1),state:this.currentState,awardId:r.awardId};e.push(o),n+=o.count,this.costTotal=this.costTotal+o.cost*o.count}}e.sort(this.sortItems),this.data=e,this.list.dataProvider=new eui.ArrayCollection(this.data),this.btnGetAllAward.enabled=n>0},n.prototype.sortItems=function(e,t){return e.sortIndex-t.sortIndex},n}(e.FitComponent);e.RewardRetrieve=t,__reflect(t.prototype,"UI.RewardRetrieve",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.skinName="SevenGiftSkin",t.tab.addEventListener(eui.UIEvent.CHANGE,t.onDaySelected,t),t.btnGetAward.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onWithDraw,t),t.imgGroup.addEventListener(egret.Event.COMPLETE,t.onTweenGroupComplete,t),t.imgGroup.play(0),t}return __extends(t,e),t.prototype.close=function(){UIManager.pop(this)},t.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:case this.btnBack:case this.btnClose:this.close()}},t.prototype.onAddToStage=function(){this.mc.visible=!0,this.mc.Load("skill/vip_bg2/vip_bg2.json","vip_bg2"),this.mc.gotoAndPlay(0,-1);var e=CumulativeLogin.withDay();null!=e.idx?this.tab.selectedIndex=e.idx:this.tab.selectedIndex=0,this.onUpdate(),Game.dispatcher.addEventListener(Game.EVENT.CumulativeLogin,this.onUpdate,this),guide.addEventListener(guide.GuideOperation.SevenGift,this.onGuideReminder,this)},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.CumulativeLogin,this.onUpdate,this),this.mc.visible=!1,this.mc.stop(),this.mc.free(),guide.removeEventListener(guide.GuideOperation.SevenGift,this.onGuideReminder,this)},t.prototype.changePage=function(e){this.tab.selectedIndex=e,this.onUpdate()},t.prototype.onDaySelected=function(e){var t=this.tab.selectedIndex;null==CumulativeLogin.data||0>t||(this.cell.data=table.cumulativeLoginBonus[t].content[0],this.cell.onRefresh(),this.giftIcon0=table.cumulativeLoginBonus[this.tab.selectedIndex].icons[0],this.giftIcon1=table.cumulativeLoginBonus[this.tab.selectedIndex].icons[1],this.showBtnAwardStatus(t),guide.completed()||0!=this.tab.selectedIndex?guide.removeMovieClip(this.guideEffect):this.playGuideMovie(guide.info.operation))},t.prototype.onWithDraw=function(){if("up"==this.btnGetAward.currentState){var e=new net.def.C2SGetCumulativeLoginBonus;e.index=this.tab.selectedIndex,net.socket.write(37,e.toArrayBuffer())}},t.prototype.onUpdate=function(){if(null!=CumulativeLogin.data){this.cell.data=table.cumulativeLoginBonus[this.tab.selectedIndex].content[0],this.cell.onRefresh(),this.giftIcon0=table.cumulativeLoginBonus[this.tab.selectedIndex].icons[0],this.giftIcon1=table.cumulativeLoginBonus[this.tab.selectedIndex].icons[1],this.showBtnAwardStatus(this.tab.selectedIndex);for(var e=0;e<CumulativeLogin.data.bonus.length;e++)this["day"+(e+1)+"Notice"]=!CumulativeLogin.data.bonus[e]&&e<CumulativeLogin.data.count;guide.completed()||0!=this.tab.selectedIndex?guide.removeMovieClip(this.guideEffect):this.playGuideMovie(guide.info.operation)}},t.prototype.showBtnAwardStatus=function(e){var t=!CumulativeLogin.data.bonus[e]&&e<CumulativeLogin.data.count;CumulativeLogin.data.bonus[e]?this.btnGetAward.currentState="down":t?this.btnGetAward.currentState="up":this.btnGetAward.currentState="disabled"},t.prototype.onTweenGroupComplete=function(){this.imgGroup.play(0)},t.prototype.onGuideReminder=function(){var e=this;this.visible&&guide.pushMovie({weight:1,handle:function(){e.playGuideMovie(guide.info.operation)}})},t.prototype.playGuideMovie=function(e){switch(e){case guide.GuideOperation.SevenGift:0==this.tab.selectedIndex&&guide.AddMovieClip(this.guideEffect)}},t}(eui.Component);e.SevenGift=t,__reflect(t.prototype,"UI.SevenGift",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.totalBetGroup.alpha=.5},t.prototype.dataChanged=function(){this.flash.visible=this.data.win,this.data.betPlayerNum||this.data.betTotal?this.totalBetGroup.visible=!0:this.totalBetGroup.visible=!1,this.data.myBet?this.myBetGroup.visible=!0:this.myBetGroup.visible=!1},t}(eui.ItemRenderer);e.ActivityBetItem=t,__reflect(t.prototype,"UI.ActivityBetItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="ActivityBetMainUISkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.tabBar.addEventListener(eui.ItemTapEvent.ITEM_TAP,e.onBarItemTap,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.open=function(){var e=this.instance;return UIManager.push(e),e},n.close=function(){null!=this._instance&&(e.ActivityBetOn.close(),UIManager.pop(this._instance))},n.prototype.onAddToStage=function(){this.switchPage(0),this.tabBar.selectedIndex=0,this.openDay=Bet.getActLeftTimeStr(),Game.dispatcher.addEventListener(Game.EVENT.BetDataChange,this.onBetCoinChange,this),Game.dispatcher.addEventListener(Game.EVENT.BetClientDataChange,this.onBetCoinChange,this),Game.dispatcher.addEventListener(Game.EVENT.BetShopDataChange,this.onShopScoreChange,this),Game.dispatcher.addEventListener(Game.EVENT.CurrencyChange[Game.Currency.BetCoin],this.onBetCoinChange,this),Game.dispatcher.addEventListener(Game.EVENT.CurrencyChange[Game.Currency.BetScore],this.onShopScoreChange,this),Bet.mainUIVisiable=!0},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.BetDataChange,this.onBetCoinChange,this),Game.dispatcher.removeEventListener(Game.EVENT.BetClientDataChange,this.onBetCoinChange,this),Game.dispatcher.removeEventListener(Game.EVENT.BetShopDataChange,this.onShopScoreChange,this),Game.dispatcher.removeEventListener(Game.EVENT.CurrencyChange[Game.Currency.BetCoin],this.onBetCoinChange,this),Game.dispatcher.removeEventListener(Game.EVENT.CurrencyChange[Game.Currency.BetScore],this.onShopScoreChange,this),Bet.mainUIVisiable=!1,Bet.autoApplyBet()},n.prototype.onBetCoinChange=function(){this.betCoin=Bet.getBetCoin()-Bet.myBetTotal,this.openDay=Bet.getActLeftTimeStr()},n.prototype.onShopScoreChange=function(){this.betScore=Bet.getBetScore()},n.prototype.onTouchTap=function(t){switch(t.target){case this.imgClose:this.close();break;case this.btnAddBetCoin:UIManager.push(new e.ItemNum(Bet.betShopCfg[0]));break;case this.btnRules:var n=new e.Rule;n.skinName="ActivityBetRulesSkin",UIManager.push(n)}},n.prototype.onBarItemTap=function(e){this.switchPage(e.itemIndex)},n.prototype.switchPage=function(t){switch(t){case 0:this.view.removeChildren(),this.betUI||(this.betUI=new e.ActivityBetUI),this.view.addChild(this.betUI);break;case 1:this.view.removeChildren(),this.betShop||(this.betShop=new e.ActivityBetShopUI),this.view.addChild(this.betShop)}},n}(e.FitComponent);e.ActivityBetMainUI=t,__reflect(t.prototype,"UI.ActivityBetMainUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="ActivityBetOnSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.open=function(e){var t=this.instance;return t.betData=e,UIManager.push(t),t},t.close=function(){null!=this._instance&&UIManager.pop(this._instance)},t.prototype.onAddToStage=function(){this.onDataChange(),this.typeSource=this.betData.icon,this.boxNumer=this.betData.myBet||0,Game.dispatcher.addEventListener(Game.EVENT.BetDataChange,this.onDataChange,this)},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.BetDataChange,this.onDataChange,this)},t.prototype.onDataChange=function(){this.betCoin=Bet.getViewBetCoin()},t.prototype.tryAddBet=function(e){Bet.addClientBet(this.betData.id,e)&&(this.onDataChange(),this.boxNumer+=e)},t.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:return Game.dispatcher.dispatchEventWith(Game.EVENT.BetClientDataChange),void this.close();case this.btnMinus:this.tryAddBet(-1);break;case this.btnMinus10:this.tryAddBet(-10);break;case this.btnPlus:this.tryAddBet(1);break;case this.btnPlus10:this.tryAddBet(10)}},t}(e.FitComponent);e.ActivityBetOn=t,__reflect(t.prototype,"UI.ActivityBetOn",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="ActivityBetShopUISkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(){this.scroller.viewport.scrollV=0,this.onUpdate(),Game.dispatcher.addEventListener(Game.EVENT.BetShopDataChange,this.onUpdate,this),Game.dispatcher.addEventListener(Game.EVENT.CurrencyChange[Game.Currency.BetScore],this.onUpdate,this)
},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.BetShopDataChange,this.onUpdate,this),Game.dispatcher.removeEventListener(Game.EVENT.CurrencyChange[Game.Currency.BetScore],this.onUpdate,this)},t.prototype.onUpdate=function(){var e=this.list.dataProvider;null==e?this.list.dataProvider=new eui.ArrayCollection(Bet.betShopCfg):e.replaceAll(Bet.betShopCfg)},t}(eui.Component);e.ActivityBetShopUI=t,__reflect(t.prototype,"UI.ActivityBetShopUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.actInitNum=0,e.skinName="ActivityBetUISkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.list1dataProvider=new eui.ArrayCollection(Bet.betAreaLittleBig),e.list2dataProvider=new eui.ArrayCollection(Bet.betAreaBaozi),e.list3dataProvider=new eui.ArrayCollection(Bet.betAreaSpot),e.resultdataProvider=new eui.ArrayCollection([]),e.actInitNum=Bet.initNum,e}return __extends(n,t),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list1.dataProvider=this.list1dataProvider,this.list2.dataProvider=this.list2dataProvider,this.list3.dataProvider=this.list3dataProvider,this.listResult.dataProvider=this.resultdataProvider,this.list1.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListTap,this),this.list2.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListTap,this),this.list3.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListTap,this)},n.prototype.onAddToStage=function(){this.updateBetResultList(),Game.dispatcher.addEventListener(Game.EVENT.BetDataChange,this.onDataChange,this),Game.dispatcher.addEventListener(Game.EVENT.BetClientDataChange,this.onDataChange,this),SecondTicker.addEventListener(this.onTicker,this),Bet.applyBetData()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.BetDataChange,this.onDataChange,this),Game.dispatcher.removeEventListener(Game.EVENT.BetClientDataChange,this.onDataChange,this),SecondTicker.removeEventListener(this.onTicker,this),this.remainTime=null,this.onStopTween(),this.cover.visible=!0,this.dice1="",this.dice2="",this.dice3=""},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnConfirm:Bet.restoreMyLastBets()||(Bet.applyBet(),this.btnConfirm.enabled=!1)}},n.prototype.onDataChange=function(){var e=Bet.getLeftTime();-1!=e?(null==this.remainTime&&(this.remainTime=new RemainingTime),this.remainTime.delta=e):this.remainTime=null,this.actInitNum!=Bet.initNum?(this.actInitNum=Bet.initNum,this.list1dataProvider.replaceAll(Bet.betAreaLittleBig),this.list2dataProvider.replaceAll(Bet.betAreaBaozi),this.list3dataProvider.replaceAll(Bet.betAreaSpot)):(this.list1dataProvider.refresh(),this.list2dataProvider.refresh(),this.list3dataProvider.refresh()),this.betState.textFlow=Game.HtmlTextParser.parse(Bet.getStatusStr()),this.btnConfirm.enabled=Bet.CanBet(0,!1),this.cover.visible=2!=Bet.getStatus(),this.updateBetResultList(),Bet.CanAutoRestoreBet()?this.btnConfirm.label="Đặt cược nhanh":this.btnConfirm.label="Chốt"},n.prototype.onTicker=function(){this.remainTime&&(this.remainTime.delta>0?(this.remainTime.delta%5==0&&1==Bet.getStatus()&&Bet.applyBetData(),3==this.remainTime.delta&&Bet.autoApplyBet(),this.remainTime.delta<3600?this.betCountDown=this.remainTime.getMinuteSecond():this.betCountDown=this.remainTime.getHourMinuteSecond(),this.remainTime.delta<=5&&this.onPlayTween()):(Bet.applyBetData(),this.betCountDown="",this.onStopTween()))},n.prototype.updateBetResultList=function(){for(var e=Bet.history,t=[],n=0;n<e.length;n++){var i=e[n].spot1+e[n].spot2+e[n].spot3,a=e[n].spot1==e[n].spot2&&e[n].spot1==e[n].spot3,r="Tiểu",o=6647195;i>10&&(r="Đại",o=5462662),a&&(r="-");var s="";n==e.length-1&&(s="ui/common1/new.png"),t.push({icon:s,idx:r,color:o,img1:"ui/gambling/dice_a_"+e[n].spot1+".png",img2:"ui/gambling/dice_a_"+e[n].spot2+".png",img3:"ui/gambling/dice_a_"+e[n].spot3+".png"})}this.resultdataProvider.replaceAll(t),this.onBetResult()},n.prototype.onListTap=function(t){if(Bet.CanBet(0,!0)){var n=t.itemRenderer,i=n.data;e.ActivityBetOn.open(i)}},n.prototype.onPlayTween=function(){this.tweenGroup.play(0)},n.prototype.onStopTween=function(){this.tweenGroup.play(0),this.tweenGroup.stop()},n.prototype.onBetResult=function(){if(2==Bet.getStatus()){this.onStopTween(),this.cover.visible=!1,this.dice1="",this.dice2="",this.dice3="";var e=Bet.getLastResult();null!=e&&(this.dice1="ui/gambling/dice_"+e.spot1+".png",this.dice2="ui/gambling/dice_"+e.spot2+".png",this.dice3="ui/gambling/dice_"+e.spot3+".png")}},n}(eui.Component);e.ActivityBetUI=t,__reflect(t.prototype,"UI.ActivityBetUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.targetBetCoin=0,t._coin=0,t.skinName="BetCoinPromoteSkin",t.touchEnabled=!1,t.touchChildren=!1,t}return __extends(t,e),t.show=function(e){null==this._instance&&(this._instance=new t);var n=~~(messageLayer.width/2-100),i=~~(.32*messageLayer.height);this._instance.x=n,this._instance.y=i,messageLayer.addChild(this._instance),this._instance.targetBetCoin+=e,egret.Tween.removeTweens(this._instance),egret.Tween.get(this._instance).set({alpha:1}).to({coin:this._instance.targetBetCoin},500).to({alpha:0},400).set({coin:0,targetBetCoin:0,alpha:1}).call(Game.removeFromParent,this._instance)},Object.defineProperty(t.prototype,"coin",{get:function(){return this._coin},set:function(e){e=Math.round(e),this._coin=e,this.displayCoin=e>=0?"+"+e:""+e},enumerable:!0,configurable:!0}),t}(eui.Component);e.BetCoinPromote=t,__reflect(t.prototype,"UI.BetCoinPromote",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.challengeAwards=[],t.levelUpAwards=[],t.skinName="ArenaResultSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.onAddToStage=function(){this.challengeAwards.length>0&&(this.list.dataProvider=new eui.ArrayCollection(this.challengeAwards)),this.levelUpAwards.length>0?this.goldCoinlist.dataProvider=new eui.ArrayCollection(this.levelUpAwards):Game.removeFromParent.apply(this.rankAwardGroup),null==this.diffRank&&Game.removeFromParent.apply(this.diffGroup)},t.prototype.onRemoveFromStage=function(){this.challengeAwards=[],this.levelUpAwards=[]},t.prototype.setChallengeAwards=function(e,t,n,i){this.challengeAwards=[],e>0&&this.challengeAwards.push({type:"exp",content:e}),t>0&&this.challengeAwards.push({type:"silverCoin",content:t}),n>0&&this.challengeAwards.push({type:"readingCoin",content:n}),i>0&&this.challengeAwards.push({type:"arenaCoin",content:i})},t.prototype.setLevelUpAwards=function(e){this.levelUpAwards=[],e>0&&this.levelUpAwards.push({type:"silverCoin",content:e})},t.prototype.setRankinfo=function(e,t,n){this.lastTopRank=e,this.curRank=n;var i=e-t;i>0?this.diffRank=""+lang.String("better high")+i:0>i?this.diffRank=""+lang.String("better down")+i:this.diffRank=null},t.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:UIManager.pop(this)}},t.prototype.close=function(){UIManager.pop(this),ArenaChallenge.onOpenArena()},t}(e.FitComponent);e.ArenaResult=t,__reflect(t.prototype,"UI.ArenaResult",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.factionname="",t.skinName="ArenaCellSkin",t.guide=!1,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.btnSign.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onSign,t),t.btnView.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onView,t),t}return __extends(t,e),t.prototype.onAddToStage=function(){this.guide&&(guide.addEventListener(guide.GuideOperation.GuideArena,this.onGuideReminder,this),guide.completed()||this.playGuideMovie(guide.info.operation))},t.prototype.onRemoveFromStage=function(){this.guide&&guide.removeEventListener(guide.GuideOperation.GuideArena,this.onGuideReminder,this)},t.prototype.ondataChanged=function(){this.factionname=table.faction[this.data.faction].name,this.rank=this.data.rank,this.rolename=this.data.name,this.fightpower=this.data.fp,this.statue.setStatue(this.data.faction,null,null),""==this.data.name||0==this.data.revengable?(this.enabled=!1,this.btnSign.enabled=!1):(this.enabled=!0,this.btnSign.enabled=!0),this.bRival?this.btnSign.label=lang.String("tiao zhan"):this.btnSign.label=lang.String("revenge"),this.enabled&&this.data.isMirror?this.btnView.enabled=!0:this.btnView.enabled=!1},t.prototype.setData=function(e,t,n){this.data=e,this.bRival=t,this.Id=n,this.ondataChanged(),this.statue.visible=!0,this.btnSign.visible=!0},t.prototype.clearData=function(){this.factionname=lang.String("None"),this.statue.visible=!1,this.statue.clear(),this.rolename="",this.rank=null,this.fightpower=null,this.Id=null,this.enabled=!1,this.btnSign.visible=!1},t.prototype.onSign=function(){return ArenaChallenge.freeChances+ArenaChallenge.paidChances<=0?0==ArenaChallenge.canBuyTimes()?void PopUpMessage.push(lang.String("challenge times fail"),color.RED):void UIManager.push(new n):void(this.bRival?ArenaChallenge.onC2SArenaChallenge(this.Id):ArenaChallenge.onC2SArenaRevenge(this.Id))},t.prototype.onGuideReminder=function(){var e=this;this.guide&&this.visible&&guide.pushMovie({weight:1,handle:function(){e.playGuideMovie(guide.info.operation)}})},t.prototype.playGuideMovie=function(e){e==guide.GuideOperation.GuideArena&&guide.AddMovieClip(this.btnSign)},t.prototype.onView=function(){this.bRival?ArenaChallenge.onViewRival(this.Id):ArenaChallenge.onViewEnemy(this.Id)},t}(eui.Component);e.ArenaCell=t,__reflect(t.prototype,"UI.ArenaCell",["eui.UIComponent","egret.DisplayObject"]);var n=function(e){function t(){var n=e.call(this)||this;return n.skinName="ConfirmBoxSkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(eui.UIEvent.ADDED_TO_STAGE,n.onAddToStage,n),n.title=lang.String("buy immediately"),n.orgContentMsg=lang.StringWithFormat("buy the goods {1} with {2} silvercoin",lang.String("arenaChanges"),t.PRICE),n.onOK=n.onSure,n}return __extends(t,e),t.prototype.onSure=function(){if(PlayerAttribute.currency[Game.Currency.GoldCoin]+PlayerAttribute.currency[Game.Currency.SilverCoin]<t.PRICE)return void PopUpMessage.push(lang.String("not enough silvercoin"),color.RED);UIManager.pop(this);var e=new net.def.C2SArenaBuyChances;e.setTimes(1),net.socket.write(220,e.toArrayBuffer())},t.prototype.onAddToStage=function(){PlayerAttribute.currency[Game.Currency.SilverCoin]<t.PRICE&&(this.content.text+="\n"+lang.StringWithFormat("if replace {1} silver with gold",t.PRICE-PlayerAttribute.currency[Game.Currency.SilverCoin]))},t.PRICE=50,t}(e.ShopPrompt);e.ArenaBuyTimes=n,__reflect(n.prototype,"UI.ArenaBuyTimes");var i=function(t){function i(){var e=t.call(this)||this;return e.skinName="ArenaUISkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(i,t),Object.defineProperty(i,"instance",{get:function(){return null==this._instance&&(this._instance=new i),this._instance},enumerable:!0,configurable:!0}),i.Close=function(){null!=this._instance&&this._instance.close()},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.updateRestTime(),this.tab.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickTab,this)},i.prototype.updateRestTime=function(){null==this.cooldownTimer&&(this.cooldownTimer=egret.setTimeout(this.finishCooldown,this,Game.Second))},i.prototype.finishCooldown=function(){this.cooldownTimer=null},i.prototype.onClickTab=function(){switch(this.tab.selectedIndex){case 0:this.updateArenaCells(ArenaChallenge.rivals,!0),this.selectId=1,this.onSelectArena();break;case 1:this.updateArenaCells(ArenaChallenge.enemies,!1),this.selectId=0,this.onSelectArena()}},i.prototype.close=function(){UIManager.pop(this),null!=this.cooldownTimer&&(egret.clearTimeout(this.cooldownTimer),this.cooldownTimer=null)},i.prototype.onTouchTap=function(t){switch(t.target){case this.btnToplist:return void e.RankingUI.open(e.RankKind.ArenaRank);case this.imgClose:return void this.close();case this.btnRules:var i=new e.Rule;return i.skinName="ArenaInfoSkin",void UIManager.pushPage(i);case this.arenaCell1:this.selectId=1,this.onSelectArena();break;case this.arenaCell2:this.selectId=2,this.onSelectArena();break;case this.arenaCell3:this.selectId=3,this.onSelectArena();break;case this.arenaCell4:this.selectId=4,this.onSelectArena();break;case this.arenaCell5:this.selectId=5,this.onSelectArena();break;case this.btnMall:UIManager.openArenaShop();break;case this.btnBuyChangce:if(0==ArenaChallenge.canBuyTimes())return void PopUpMessage.push(lang.String("buy times used up"),color.RED);UIManager.push(new n);break;case this.btnRefresh:ArenaChallenge.refreshMatchInfo()}},i.prototype.onSelectArena=function(){for(var e=0;e<this.groupArenacell.numChildren;e++){var t=this.groupArenacell.getChildAt(e);this.selectId-1==e?(this.select=t,t.selected=!0):t.selected=!1}},i.prototype.onAddToStage=function(){this.d=Player.instance,this.updateRestTime(),PlayerAttribute.vipItem.getActivatedLevel()<1?this.btnBuyChangce.enabled=!1:this.btnBuyChangce.enabled=!0,Game.dispatcher.addEventListener(Game.EVENT.ArenaChallenge,this.onRefresh,this),Game.dispatcher.addEventListener(Game.EVENT.ArenaChallengeTimes,this.onRefreshTimes,this)},i.prototype.onRemoveFromStage=function(){this.d=null,this.clearArenainfo(),Game.dispatcher.removeEventListener(Game.EVENT.ArenaChallenge,this.onRefresh,this),Game.dispatcher.removeEventListener(Game.EVENT.ArenaChallengeTimes,this.onRefreshTimes,this)},i.prototype.onRefreshTimes=function(){this.changces=ArenaChallenge.freeChances+ArenaChallenge.paidChances},i.prototype.onRefresh=function(){ArenaChallenge.highestRank<=i.MaxRank?(this.selfrank=String(ArenaChallenge.rank),this.highestRank=String(ArenaChallenge.highestRank)):(this.selfrank="--",this.highestRank="--"),this.changces=ArenaChallenge.freeChances+ArenaChallenge.paidChances,this.tab.selectedIndex=0,this.updateArenaCells(ArenaChallenge.rivals,!0),this.selectId=5,this.onSelectArena(),this.onBadge()},i.prototype.onBadge=function(){if(0==this.tab.selectedIndex)for(var e=0;e<ArenaChallenge.enemies.length;e++)if(1==ArenaChallenge.enemies[e].revengable)return},i.prototype.updateArenaCells=function(e,t){this.select=this.arenaCell1;for(var n=0;5>n;n++){var i=this.groupArenacell.getChildAt(n);i.clearData(),null!=e[n]&&i.setData(e[n],t,n)}},i.prototype.clearArenainfo=function(){for(var e=0;5>e;e++){var t=this.groupArenacell.getChildAt(e);t.clearData(),t.selected=!1}},i.MaxRank=3e3,i}(e.FitComponent);e.ArenaUI=i,__reflect(i.prototype,"UI.ArenaUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.showing=!1,e.curDataType=0,e.curSubCategory=0,e.txtBonus="",e.cateName="",e.skinName="AuctionUiSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);var e=[{name:"Bang Hội",type:"btnGuild",action:Auction.auctionGuildRedhot.join(",")},{name:"Toàn Máy Chủ",type:"btnGlobal",action:Auction.auctionGlobalRedhot.join(",")},{name:"Bản Thân",type:"btnMyAuction",action:Auction.auctionSelfRedhot.join(",")}];this.tabBar.dataProvider=new eui.ArrayCollection(e),this.tabBar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onBarItemTap,this),this.cateList.addEventListener(egret.Event.CHANGE,this.onCategoryChange,this)},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},n.prototype.onAddToStage=function(){Auction.initOthersRedhotTag(),Auction.checkUpdate(Auction.ViewType.Global,Auction.auctionGlobalOther,!0),this.showing=!0,this.updateCategory(Auction.ViewType.Guild),this.UpdateName(),badge.onLight(badge.action.AuctionEnabled,!1),net.socket.write(79,null)},n.prototype.onRemoveFromStage=function(){this.showing=!1},n.prototype.requestData=function(e,t){this.curDataType=e,this.curSubCategory=t,Auction.checkUpdate(e,t,!1)||this.updateUi(e,t)},n.prototype.notifyAfterBuy=function(e,t){this.curDataType==Auction.ViewType.Self?this.updateUi(this.curDataType,0):this.updateUi(e,t)},n.prototype.updateUi=function(t,n){if(this.showing&&t==this.curDataType&&n==this.curSubCategory){switch(this.curDataType){case Auction.ViewType.Guild:this.txtTips.textFlow=Game.HtmlTextParser.parse(lang.StringWithFormat("autionTips1{1}",this.cateName));var i=Auction.guildBonusCache[n];i>0?this.txtBonus=lang.StringWithFormat("bonus forecast",""+i+Auction.currencyStr[Auction.CurrencyType.Bonus]):this.txtBonus="";break;case Auction.ViewType.Global:this.txtTips.textFlow=Game.HtmlTextParser.parse(lang.String("autionTips2")),this.txtBonus="";break;case Auction.ViewType.Self:this.txtTips.text="",this.txtBonus=""}var a=Auction.getCacheData(t,n);if(null!=a){for(var r=new Array,o=0;o<a.length;o++){var s=a[o],l="",u="";if(void 0!==table.props[s.genre]){var c=table.props[s.genre][s.detailType];if(void 0!==c&&(l=c.name,u=c.source,0!=s.count)){var h={itemName:l,icon:u,count:s.count,orgPrice:s.orgPrice*s.count,curPrice:s.curPrice*s.count,maxPrice:s.maxPrice*s.count,competePrice:(s.curPrice+s.priceDelta)*s.count,sellTime:s.sellTime,sn:s.sn,hasCompete:s.hasCompete,expTime:FormatTimeByRelativeDate(s.expTime,!1),itemId:s.itemId,isGuild:s.isGuild,itemData:{type:"item",content:{genre:s.genre,detailType:s.detailType,count:s.count>1?s.count:""}}};r.push(h)}}}r.length>0&&r.sort(this.sortItem),this.itemsList.itemRenderer=e.AuctionUiItem,this.itemsList.dataProvider=new eui.ArrayCollection(r)}}},n.prototype.updateCategory=function(e){this.tabBar.selectedIndex=e,this.loadCategoryList(e);var t=0,n=this.cateData;n.length>0&&(t=n[0].cate,this.cateList.selectedIndex=0),this.showing&&this.requestData(e,t),null!=this.scroller&&(this.scroller.stopAnimation(),this.scroller.viewport.scrollV=0)},n.prototype.sortItem=function(e,t){var n=t.sellTime-e.sellTime;return 0!=n?n:t.sn-e.sn},n.prototype.onDataChange=function(e){},n.prototype.onBarItemTap=function(e){switch(e.itemIndex){case 0:badge.onLight(Auction.auctionRedhot[Auction.ViewType.Guild][table.auctionGuildCates[0].category],!1),this.updateCategory(Auction.ViewType.Guild);break;case 1:badge.onLight(Auction.auctionRedhot[Auction.ViewType.Global][Auction.enabledItemCategory[0].cate],!1),this.updateCategory(Auction.ViewType.Global);break;case 2:badge.onLight(Auction.auctionRedhot[Auction.ViewType.Self][0],!1),this.updateCategory(Auction.ViewType.Self)}},n.prototype.onCategoryChange=function(){var e=this.cateList.selectedIndex;if(this.UpdateName(),e>=0){var t=this.cateData[e].cate;this.requestData(this.curDataType,t)}null!=this.scroller&&(this.scroller.stopAnimation(),this.scroller.viewport.scrollV=0)},n.prototype.UpdateName=function(){if(null!=this.cateList){var e=this.cateList.selectedItem;null==e&&(this.cateList.selectedIndex=0,e=this.cateList.selectedItem),null!=e&&(this.cateName=e.name)}},n.prototype.close=function(){UIManager.pop(this)},n.prototype.loadCategoryList=function(t){var n=new Array;switch(t){case Auction.ViewType.Guild:for(var i=table.auctionGuildCates.length,a=0;i>a;a++){var r=table.auctionGuildCates[a],o={name:r.name,cate:r.category,action:""+Auction.auctionRedhot[Auction.ViewType.Guild][r.category]};n.push(o)}break;case Auction.ViewType.Global:for(var s=Auction.enabledItemCategory,i=s.length,a=0;i>a;a++){var r=s[a],l={name:r.name,cate:r.cate,action:""+Auction.auctionRedhot[Auction.ViewType.Global][r.cate]};n.push(l)}break;case Auction.ViewType.Self:var u={name:lang.String("my auction"),cate:0,action:""+Auction.auctionRedhot[Auction.ViewType.Self][0]};n.push(u)}this.cateData=n,this.cateList.itemRenderer=e.AuctionUiCategory,this.cateList.dataProvider=new eui.ArrayCollection(n)},n}(e.FitComponent);e.AuctionUi=t,__reflect(t.prototype,"UI.AuctionUi",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.onTouchTap=function(e){switch(e.target){default:Auction.globalOhtersRethotTag[this.data.cate]&&(Auction.globalOhtersRethotTag[this.data.cate]=!1),badge.onLight(this.data.action,!1)}},t}(eui.ItemRenderer);e.AuctionUiCategory=t,__reflect(t.prototype,"UI.AuctionUiCategory")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="AuctionUiItemSkin",e}return __extends(n,t),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btnBuy.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuy,this),this.btnCompete.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCompete,this)},n.prototype.dataChanged=function(){null!=this.data&&(this.itemName.text=this.data.itemName,this.curPrice=this.data.competePrice,this.maxPrice=this.data.maxPrice,this.expTime=this.data.expTime,this.isGuild=this.data.isGuild,this.itemId=this.data.itemId,this.count=this.data.count,this.competePrice=this.data.competePrice,this.hasCompete=this.data.hasCompete,this.cell.data=this.data.itemData,this.itemName.textColor=Item.QualityColor[this.cell.quality],this.orgPrice=this.data.orgPrice,this.orgPrice<=0&&(this.orgPrice=this.maxPrice))},n.prototype.onBuy=function(){this.onRequest(!1,!0)},n.prototype.onCompete=function(){this.onRequest(!0,!0)},n.prototype.onConfirmBuy=function(e,t){return Auction.requestBuy(this.itemId,this.isGuild,e,t,this.count),!0},n.prototype.onRequest=function(t,n){var i=this,a=t?this.competePrice:this.maxPrice,r=this.isGuild?Auction.CurrencyType.Guild:Auction.CurrencyType.Global,o=Auction.currencyStr[r];if(PlayerAttribute.currency[r]<a){var s=!1;if(r==Game.Currency.SilverCoin&&PlayerAttribute.currency[r]+PlayerAttribute.currency[Game.Currency.GoldCoin]>=a&&(s=!0),!s){var l=lang.StringWithFormat("item {1} not enough",o);return PopUpMessage.push(l,color.RED),!1}if(n){var u=lang.StringWithFormat("confirm substitude",lang.String("silverCoin"),lang.String("goldCoin"));return e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],lang.String("prompt title"),u,function(){return i.onRequest(t,!1)},null,null),!1}}r==Game.Currency.SilverCoin&&PlayerAttribute.currency[r]<a&&(o=Auction.currencyStr[Game.Currency.GoldCoin]),t&&a>=this.maxPrice&&(t=!1,a=this.maxPrice);var c,h=lang.String("prompt title"),d=""+a+o;return c=t?lang.StringWithFormat("confirm compete",d):lang.StringWithFormat("confirm onetime buy",d),e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],h,c,function(){return i.onConfirmBuy(t,a)},null,null),n},n}(eui.ItemRenderer);e.AuctionUiItem=t,__reflect(t.prototype,"UI.AuctionUiItem")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="BabelInviteItemSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.dataChanged=function(){this.txtFaction=table.faction[this.data.faction].name,this.portrait=table.faction[this.data.faction].portrait;for(var e=!1,t=0;t!=Babel.invitedPlayers.length;t++)if(this.data.name==Babel.invitedPlayers[t]){e=!0;break}this.setInvited(e)},t.prototype.setInvited=function(e){e?(this.btnInvite.label=lang.String("babel invite btn msg already invited"),this.btnInvite.enabled=!1):(this.btnInvite.label=lang.String("babel invite btn msg not invited"),this.btnInvite.enabled=!0)},t.prototype.onTouchTap=function(e){if(null!=this.data)switch(e.target){case this.btnInvite:Babel.InviteFriend(this.data.name),this.setInvited(!0)}},t}(eui.ItemRenderer);e.BabelInviteItem=t,__reflect(t.prototype,"UI.BabelInviteItem")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="BabelInvitePanelSkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.dataFriends=new eui.ArrayCollection,n.listFriends.itemRenderer=e.BabelInviteItem,n.listFriends.dataProvider=n.dataFriends,n}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},n.prototype.close=function(){UIManager.pop(this)},n.prototype.SetFriendData=function(e){for(var t=[],n=0;n!=e.getFriends().length;n++){var i=e.getFriends()[n];t.push({name:i.getName(),faction:i.getFaction(),fp:i.getFp(),level:i.getLevel()})}this.dataFriends.replaceAll(t)},n}(e.FitComponent);e.BabelInvitePanel=t,__reflect(t.prototype,"UI.BabelInvitePanel",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.remainingTime=new RemainingTime,t.skinName="BabelPKNoteSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.BabelSyncSummaryInfo,this.updateSummaryInfo,this),SecondTicker.addEventListener(this.onTimer,this)},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.BabelSyncSummaryInfo,this.updateSummaryInfo,this),SecondTicker.removeEventListener(this.onTimer,this)},t.prototype.onTimer=function(){this.stageLeftTime=this.remainingTime.getMinuteSecond()},t.prototype.updateSummaryInfo=function(){switch(Babel.dataSummaryPKInfo.getStage()){case Babel.STAGE_PREPARE:this.stageDesc=lang.String("babel stage desc prepare");break;case Babel.STAGE_PK:this.stageDesc=lang.String("babel stage desc pk");break;case Babel.STAGE_END:this.stageDesc=lang.String("babel stage desc end")}this.remainingTime.delta=Babel.dataSummaryPKInfo.getStageLeftTime();var e=0,t=0,n=0,i=0;Babel.dataSummaryPKInfo.getMyCamp()==Babel.dataSummaryPKInfo.getCampA()?(e=Babel.dataSummaryPKInfo.getCampAKillNum(),t=Babel.dataSummaryPKInfo.getCampADamage(),n=Babel.dataSummaryPKInfo.getCampBKillNum(),i=Babel.dataSummaryPKInfo.getCampBDamage()):(e=Babel.dataSummaryPKInfo.getCampBKillNum(),t=Babel.dataSummaryPKInfo.getCampBDamage(),n=Babel.dataSummaryPKInfo.getCampAKillNum(),i=Babel.dataSummaryPKInfo.getCampADamage());var a=this.calcKillDisplayValue(e,n);this.barKill.value=a[0],this.killOffset.text=a[1]>=0?"+"+a[1]+"%":a[1]+"%";var r=this.calcDamageDisplayValue(t,i);this.barDamage.value=r[0],this.damageOffset.text=r[1]>=0?"+"+r[1]+"%":r[1]+"%",this.myCampKill.text=lang.StringWithFormat("babel {1} kill number",e),this.enemyCampKill.text=lang.StringWithFormat("babel {1} kill number",n),this.roundLevel.text=lang.StringWithFormat("bable {1} round level",Babel.dataSummaryPKInfo.getLevel())},t.prototype.calcKillDisplayValue=function(e,t){if(e==t)return[5,0];if(e-t>=5)return[10,50];if(t-e>=5)return[0,-50];var n=e-t;return n>0?[5+n,10*n]:[5+n,10*-n]},t.prototype.calcDamageDisplayValue=function(e,t){if(e==t)return[50,0];var n=~~(e/(e+t)*100);return[n,n-50]},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnDetailPKInfo:Babel.applyPKInfo();break;default:return}},t}(e.FitComponent);e.BabelPKNote=t,__reflect(t.prototype,"UI.BabelPKNote",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="BabelPlayerInfoItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){var e=color.WHITE;Babel.selfCamp!=Babel.INVALIDCAMP&&(e=Babel.selfCamp==this.data.getCamp()?color.GREEN:color.RED),this.select=this.data.getName()==Player.instance.Name,this.imgFactionIcon.source=table.faction[this.data.getFaction()].logo,this.playerName.text=this.data.getName(),this.playerName.textColor=e,this.level.text=this.data.getLevel().toString(),this.level.textColor=e,this.killNum.text=this.data.getKillNum().toString(),this.killNum.textColor=e,this.deathNum.text=this.data.getDeathNum().toString(),this.deathNum.textColor=e,this.damage.text=FormatBigNumber(this.data.getDamage()),this.damage.textColor=e},t}(eui.ItemRenderer);e.BabelPlayerInfoItem=t,__reflect(t.prototype,"UI.BabelPlayerInfoItem")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.winImg="ui/big/winLose_1.png",n.loseImg="ui/big/winLose_2.png",n.skinName="BabelPlayerInfoPanelSkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.dataList=new eui.ArrayCollection,n.dataFinalAward=new eui.ArrayCollection,n.autoClose=!0,n.lastUpdateTime=egret.getTimer(),n.list.itemRenderer=e.BabelPlayerInfoItem,n.list.dataProvider=n.dataList,n.finalAwards.itemRenderer=e.AwardCell,n.finalAwards.dataProvider=n.dataFinalAward,n}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:UIManager.pop(this);break;default:return}},n.prototype.onAddToStage=function(){this.panel.btnBack.visible=!1,this.updateInfo(),this.finalAwards.visible=this.dataFinalAward.length>0,SecondTicker.addEventListener(this.onTimer,this)},n.prototype.onRemoveFromStage=function(){SecondTicker.removeEventListener(this.onTimer,this)},n.prototype.onTimer=function(){if(this.autoClose){var e=Babel.dataPKInfo.getWinCamp()!=Babel.INVALIDCAMP?9e3:5e3;egret.getTimer()>this.lastUpdateTime+e&&this.close()}},n.prototype.close=function(){this.autoClose=!0,this.dataFinalAward.removeAll(),UIManager.pop(this)},n.prototype._sort=function(e,t){if(Babel.selfCamp!=Babel.INVALIDCAMP){if(e.getCamp()!=t.getCamp())return e.getCamp()==Babel.selfCamp?-1:1}else if(e.getCamp()!=t.getCamp())return e.getCamp()-t.getCamp();return e.getKillNum()!=t.getKillNum()?t.getKillNum()-e.getKillNum():e.getDamage()!=t.getDamage()?t.getDamage()-e.getDamage():e.getDeathNum()!=t.getDeathNum()?e.getDamage()-t.getDamage():e.getName()<t.getName()?1:-1},n.prototype.updateInfo=function(){this.lastUpdateTime=egret.getTimer();var e=Babel.dataPKInfo;this.roundLevel.text=lang.StringWithFormat("bable {1} round level",e.getRoundLevel());var t=e.getPlayers();t.sort(this._sort),this.dataList.replaceAll(t);var n="",i=0,a=0,r=0,o=0;e.getWinCamp()!=Babel.INVALIDCAMP&&Babel.selfCamp!=Babel.INVALIDCAMP&&(n=e.getWinCamp()==Babel.selfCamp?this.winImg:this.loseImg),Babel.selfCamp==e.getCampA()?(i=e.getCampAKillNum(),a=e.getCampADamage(),r=e.getCampBKillNum(),o=e.getCampBDamage()):Babel.selfCamp==e.getCampB()&&(i=e.getCampBKillNum(),a=e.getCampBDamage(),r=e.getCampAKillNum(),o=e.getCampADamage()),this.imgPKResult.source=n,this.myCampKillNum.text=i.toString(),this.myCampDamage.text=a.toString(),this.enemyCampKillNum.text=r.toString(),this.enemyCampDamage.text=o.toString(),e.getStage()==Babel.STAGE_END&&4==e.getRoundNum()?this.finalAwardMsg.text=lang.StringWithFormat("babel you reach level{1} award by mail",e.getRoundLevel()+1):this.finalAwardMsg.text=""},n.prototype.ShowFinalAward=function(e){this.finalAwards.visible=!0;
for(var t=new Array,n=0;n!=e.length;n++){var i=table.parseAward(e[n]);t[n]=i}this.dataFinalAward.replaceAll(t)},n}(e.FitComponent);e.BabelPlayerInfoPanel=t,__reflect(t.prototype,"UI.BabelPlayerInfoPanel",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.remainingTime=new RemainingTime,e.skinName="BabelPrepareNoteSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.updateRestTime=function(){this.time=this.remainingTime.getMinuteSecond()},n.prototype.onAddToStage=function(){SecondTicker.addEventListener(this.updateRestTime,this)},n.prototype.onRemoveFromStage=function(){SecondTicker.removeEventListener(this.updateRestTime,this)},n.prototype.updateData=function(){var e=Babel.dataPrepareSceneInfo;this.playerNum=e.getPlayerCount(),this.remainingTime.delta=e.getLeftTime(),this.mapName=table.maps[World.mapId].name,this.updateRestTime()},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnExit:this.onExit()}},n.prototype.onExit=function(){if(Game.isCrossServer()){var t=lang.String("operation confirm"),n=lang.StringWithFormat("babel confirm leave prepare map");e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],t,n,function(){return net.socket.write(2059,null),!0},null,null)}},n}(e.FitComponent);e.BabelPrepareNote=t,__reflect(t.prototype,"UI.BabelPrepareNote",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="BabelPreparePlayerInfoItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){var e=color.WHITE;Babel.selfCamp!=Babel.INVALIDCAMP&&(e=Babel.selfCamp==this.data.getCamp()?color.GREEN:color.RED),this.imgFactionIcon.source=table.faction[this.data.getFaction()].logo,this.playerName.text=this.data.getName(),this.playerName.textColor=e,this.level.text=this.data.getLevel().toString(),this.level.textColor=e},t}(eui.ItemRenderer);e.BabelPreparePlayerInfoItem=t,__reflect(t.prototype,"UI.BabelPreparePlayerInfoItem")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="BabelPreparePlayerInfoPanelSkin",n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.listDataMyCamp=new eui.ArrayCollection,n.listDataEnemyCamp=new eui.ArrayCollection,n.listMyCamp.itemRenderer=e.BabelPreparePlayerInfoItem,n.listMyCamp.dataProvider=n.listDataMyCamp,n.listEnemyCamp.itemRenderer=e.BabelPreparePlayerInfoItem,n.listEnemyCamp.dataProvider=n.listDataEnemyCamp,n}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onAddToStage=function(){this.updateInfo(),SecondTicker.addEventListener(this.onTimer,this)},n.prototype.onRemoveFromStage=function(){SecondTicker.removeEventListener(this.onTimer,this)},n.prototype.onTimer=function(){this.leftTime-=1,this.leftTime<=0&&UIManager.pop(this)},n.prototype.updateInfo=function(){this.leftTime=10;var e=Babel.dataPKInfo;this.roundLevel.text=lang.StringWithFormat("bable {1} round level",e.getRoundLevel()),this.listDataMyCamp.removeAll(),this.listDataEnemyCamp.removeAll();for(var t=e.getPlayers(),n=0;n!=t.length;n++){var i=t[n];i.getCamp()==Babel.selfCamp?this.listDataMyCamp.addItem(i):this.listDataEnemyCamp.addItem(i)}this.listDataMyCamp.refresh(),this.listDataEnemyCamp.refresh()},n}(e.FitComponent);e.BabelPreparePlayerInfoPanel=t,__reflect(t.prototype,"UI.BabelPreparePlayerInfoPanel",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.emptyMemberData={level:0,fp:0,faction:1,name:"",bCaptain:!1,state:"empty"},n.skinName="BabelSignPanelSkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.dataAward=new eui.ArrayCollection,n.dataMember=new eui.ArrayCollection,n.listAward.dataProvider=n.dataAward,n.listAward.itemRenderer=e.AwardCell,n.listMember.dataProvider=n.dataMember,n.listMember.itemRenderer=e.BabelTeamItem,n}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close();break;case this.btnSign:Babel.Sign()}},n.prototype.close=function(){UIManager.pop(this),net.socket.write(2057,null)},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.BabelSyncTeamInfo,this.updateData,this),this.dataAward.replaceAll(Babel.awards)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.BabelSyncTeamInfo,this.updateData,this)},n.prototype.updateData=function(){var e=!1;this.dataMember.removeAll();for(var t=0;3!=t;t++)this.dataMember.addItem(this.emptyMemberData);for(var t=0;t!=Babel.dataTeamInfo.members.length;t++){var n=Babel.dataTeamInfo.members[t];this.dataMember.replaceItemAt({name:n.getName(),faction:n.getFaction(),state:"member",icon:"",bMaster:n.getBMaster(),online:n.getOnline(),level:n.getLevel(),fp:n.getFp()},t),n.getName()==Player.instance.Name&&(e=n.getBMaster())}this.dataMember.refresh(),this.btnSign.visible=e},n}(e.FitComponent);e.BabelSignPanel=t,__reflect(t.prototype,"UI.BabelSignPanel",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="BabelTeamItemSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.onTouchTap=function(e){if(null!=this.data)switch(e.target){case this.imgInvite:case this.groupEmpty:Babel.ShowInviteList()}},t.prototype.dataChanged=function(){this.currentState=this.data.state,this.captainFlag.visible=this.data.bMaster,this.imgFaction.source=table.faction[this.data.faction].logo,this.playerName.text=this.data.name,this.playerLevel.text=lang.StringWithFormat("{1}level",this.data.level),this.playerFp.text=lang.StringWithFormat("fp:{1}",this.data.fp)},t}(eui.ItemRenderer);e.BabelTeamItem=t,__reflect(t.prototype,"UI.BabelTeamItem")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.remainingTime=new RemainingTime,t.prepareRemainingTime=new RemainingTime,t.skinName="CatchThiefNoteSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.HideTimeGroup=function(){this.timeGroup.visible=!1},t.prototype.ShowTimeGroup=function(){this.timeGroup.visible=!0},t.prototype.onAddToStage=function(){SecondTicker.addEventListener(this.onTimer,this)},t.prototype.onRemoveFromStage=function(){SecondTicker.removeEventListener(this.onTimer,this)},t.prototype.releaseResource=function(){null!=this.mc&&this.mc.free()},Object.defineProperty(t.prototype,"second",{set:function(e){this.remainingTime.delta=e,this.onTimer()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"prepareSecond",{set:function(e){this.prepareRemainingTime.delta=e,this.onTimer()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"HP",{set:function(e){this.mineBar.value=e},enumerable:!0,configurable:!0}),t.prototype.onTimer=function(){this.rest=this.remainingTime.getMinuteSecond(),this.prepareRest=lang.Format("Bọn Trộm Khoáng âm thầm tiến về phía đại hiệp: {1}",this.prepareRemainingTime.getMinuteSecond()),0==this.prepareRemainingTime.minute&&0==this.prepareRemainingTime.second?this.prepareRestTimeGroup.visible=!1:this.prepareRestTimeGroup.visible=!0},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnskill:net.socket.write(227,null)}},t}(e.FitComponent);e.CatchThiefNote=t,__reflect(t.prototype,"UI.CatchThiefNote",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="CatchThiefResultSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onAddToStage=function(){this.awards.length>0&&(this.list.dataProvider=new eui.ArrayCollection(this.awards),this.list.itemRenderer=e.AwardCell)},n.prototype.onSyncResult=function(e,t){this.HP=e,this.awards=[],this.awards.push({type:"copperCoin",content:t})},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},n.prototype.close=function(){UIManager.pop(this)},n}(e.FitComponent);e.CatchThiefResult=t,__reflect(t.prototype,"UI.CatchThiefResult",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="CollectCardCardInfoSkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.cardId=0,n.star=0,n.level=0,n.dataAttribute=new eui.ArrayCollection,n.listAttribs.itemRenderer=e.CollectCardAttruibItem,n.listAttribs.dataProvider=n.dataAttribute,n}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onAddToStage=function(){0!=this.cardId&&this.updateCardsInfo()},n.prototype.onRemoveFromStage=function(){this.cardId=0},n.prototype.setCardId=function(e){this.cardId=e.id,this.cardInstance=e,this.star=e.star||0,this.level=e.level||0},n.prototype.updateCardsInfo=function(){this.selectCard.data={id:this.cardId,checkEnable:!1,checkBadge:!1,cardInstance:this.cardInstance};var e=collectCardManager.GetCardConfig(this.cardId);if(null!=e){this.cardName.textFlow=Game.TextParser.parse(collectCardManager.GetCardColorName(this.cardId)),this.cardDesc.textFlow=Game.TextParser.parse(e.desc);for(var t=collectCardManager.GetCardAttributeDesc(this.cardId,this.star,this.level),n=[],i=0;i!=t.length;i++)n.push(Game.TextParser.parse(t[i]));this.dataAttribute.replaceAll(n),this.qualityName.textFlow=Game.TextParser.parse(collectCardManager.GetColorQualityName(e.quality))}},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnClose:case this.btnClose1:case this.imgClose:UIManager.pop(this)}},n}(e.FitComponent);e.CollectCardCardInfo=t,__reflect(t.prototype,"UI.CollectCardCardInfo",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="CollectCardItemSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.AddItem,this.onItemChanged,this),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,this.onItemChanged,this),Game.dispatcher.addEventListener(Game.EVENT.RemoveItem,this.onItemChanged,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.AddItem,this.onItemChanged,this),Game.dispatcher.removeEventListener(Game.EVENT.UpdateItem,this.onItemChanged,this),Game.dispatcher.removeEventListener(Game.EVENT.RemoveItem,this.onItemChanged,this)},n.prototype.onItemChanged=function(e){var t=e.data;if(19==t.Item.Type&&this.data.checkEnable){var n=this.data.id;if(!collectCardManager.IsActivated(n)){var i=PlayerAttribute.GetItemCount(19,n);this.activateImg.visible=i>0}}},n.prototype.dataChanged=function(){var e=this.data.id;this.data.cardInstance?this.updateCardActivated(e,this.data.cardInstance):collectCardManager.IsActivated(e)?this.updateCardActivated(e):this.updateCardUnActivated(e)},n.prototype.updateCardActivated=function(e,t){var n;n=t?t:collectCardManager.GetActivatedCard(e);var i=collectCardManager.GetCardConfig(e);null!=n&&null!=i&&(this.qualityBG.source=collectCardManager.GetQualityBG(i.quality),this.cardSource=i.source,this.cardName.textFlow=Game.TextParser.parse(collectCardManager.GetCardColorName(e)),this.fp=n.fp,this.star=n.star,this.enableCard(!0),this.activateImg.visible=!1,this.updateStars(n.star),this.levelGroup.visible=!0,this.cardLevel=n.level)},n.prototype.enableCard=function(e){var t=null==this.cardGroup.filters;t!=e&&(e?this.cardGroup.filters=null:this.cardGroup.filters=[grayFlilter])},n.prototype.updateCardUnActivated=function(e){var t=collectCardManager.GetCardConfig(e);if(null!=t){this.qualityBG.source=collectCardManager.GetQualityBG(t.quality),this.cardSource=t.source,this.cardName.textFlow=Game.TextParser.parse(collectCardManager.GetCardColorName(e)),this.fp=collectCardManager.GetUnActivatedCardFp(e),this.star=0;var n=PlayerAttribute.GetItemCount(19,e),i=n>0?!0:!1;this.activateImg.visible=i,this.data.checkEnable?this.enableCard(!1):(this.activateImg.visible=!1,this.enableCard(!0)),this.levelGroup.visible=!1,this.updateStars(0)}},n.prototype.updateStars=function(e){this.cardImg1=e>=1?collectCardManager.enableStar:collectCardManager.disabelStar,this.cardImg2=e>=2?collectCardManager.enableStar:collectCardManager.disabelStar,this.cardImg3=e>=3?collectCardManager.enableStar:collectCardManager.disabelStar,this.cardImg4=e>=4?collectCardManager.enableStar:collectCardManager.disabelStar,this.cardImg5=e>=5?collectCardManager.enableStar:collectCardManager.disabelStar,this.cardImg6=e>=6?collectCardManager.enableStar:collectCardManager.disabelStar,this.cardImg7=e>=7?collectCardManager.enableStar:collectCardManager.disabelStar,this.cardImg8=e>=8?collectCardManager.enableStar:collectCardManager.disabelStar,this.cardImg9=e>=9?collectCardManager.enableStar:collectCardManager.disabelStar,this.cardImg10=e>=10?collectCardManager.enableStar:collectCardManager.disabelStar},n.prototype.onTouchTap=function(t){this.activateImg.visible?this.activate():(this.data.cardInstance?e.CollectCardCardInfo.instance.setCardId(this.data.cardInstance):e.CollectCardCardInfo.instance.setCardId({id:this.data.id,star:this.star,level:this.cardLevel,fp:this.fp}),UIManager.push(e.CollectCardCardInfo.instance))},n.prototype.activate=function(){var e=new net.def.BagItemId;e.setId(this.data.id),net.socket.write(278,e.toArrayBuffer())},n}(eui.ItemRenderer);e.CollectCardItem=t,__reflect(t.prototype,"UI.CollectCardItem")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="CollectCardItemSmallSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(){},t.prototype.onRemoveFromStage=function(){},t.prototype.enableCard=function(e){null==this.filters!=e&&(e?this.filters=null:this.filters=[grayFlilter])},t.prototype.dataChanged=function(){var e=this.data.id,t=collectCardManager.GetActivatedCard(e),n=collectCardManager.GetCardConfig(e);if(null!=n){if(this.cardName.textFlow=Game.HtmlTextParser.parse(collectCardManager.GetCardColorName(e)),this.cardIcon.source=collectCardManager.GetCardIconSource(e),this.enableCard(collectCardManager.IsActivated(e)),this.cardIconQuality.source=collectCardManager.GEtCellQualityBG(n.quality),"bag"==this.data.state){var i=PlayerAttribute.GetItemCount(19,e);this.cardInfo=lang.StringWithFormat("collect card item small card num{1}",i)}else if("star"==this.data.state){var a=null!=t?t.star:0;this.cardInfo=lang.StringWithFormat("collect card star{1}",a)}else if("level"==this.data.state){var r=null!=t?t.level:0;this.cardInfo=lang.StringWithFormat("{1}grade",r)}else this.cardInfo="";this.updateBadge()}},t.prototype.updateBadge=function(){if("bag"==this.data.state)return void(this.badgeLight=!1);var e=this.data.id;if(!collectCardManager.IsActivated(e))return void(this.badgeLight=!1);var t=collectCardManager.GetActivatedCard(e);if(null==t)return void(this.badgeLight=!1);if("star"==this.data.state){if(t.star>=collectCardManager.MAXSTAR)return void(this.badgeLight=!1);var n=collectCardManager.GetUpgradeStarCostExp(e);return void(this.badgeLight=collectCardManager.curTotalExp>=n)}if("level"==this.data.state){if(t.level>=collectCardManager.MAXLEVEL)return void(this.badgeLight=!1);var i=collectCardManager.GetUpgradeLevelCost(e);return void(this.badgeLight=PlayerAttribute.GetItemCount(19,e)>=i)}},t}(eui.ItemRenderer);e.CollectCardItemSmall=t,__reflect(t.prototype,"UI.CollectCardItemSmall")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="CollectCardRulesSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.onTouchTap=function(e){switch(e.target){case this.btnClose:case this.btnClose1:case this.imgClose:UIManager.pop(this)}},t}(e.FitComponent);e.CollectCardRules=t,__reflect(t.prototype,"UI.CollectCardRules",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(eui.ItemRenderer);e.CollectCardAttruibItem=t,__reflect(t.prototype,"UI.CollectCardAttruibItem");var n=function(e){function t(){var t=e.call(this)||this;return t.skinName="CollectCardSuitInfoSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.dataCurAttribs=new eui.ArrayCollection,t.dataNextAttribs=new eui.ArrayCollection,t.curKind=-1,t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.listCurLevelAttribs.dataProvider=this.dataCurAttribs,this.listNextLevelAttribs.dataProvider=this.dataNextAttribs},t.prototype.onAddToStage=function(){this.curKind>0&&this.updateAttributes()},t.prototype.onRemoveFromStage=function(){this.curKind=-1},t.prototype.setKind=function(e){this.curKind=e,this.curKind>0&&this.updateAttributes()},t.prototype.updateAttributes=function(){var e=collectCardManager.GetKindName(this.curKind);this.kindName=lang.StringWithFormat("collect card {1} suit",e);var t=collectCardManager.GetCardSuitCompareInfo(this.curKind),n=t[0];this.curLevelCond=n.sumaryMsg;for(var i=[],a=0;a!=n.attribs.length;a++)i.push(Game.TextParser.parse(n.attribs[a]));this.dataCurAttribs.replaceAll(i);var r=t[1];this.nextLevelCond=r.sumaryMsg;for(var o=[],a=0;a!=r.attribs.length;a++)o.push(Game.TextParser.parse(r.attribs[a]));this.dataNextAttribs.replaceAll(o)},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnClose:case this.btnClose1:case this.imgClose:UIManager.pop(this)}},t}(e.FitComponent);e.CollectCardSuitInfo=n,__reflect(n.prototype,"UI.CollectCardSuitInfo",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,n){function i(i){t.call(n,i,e)}if(RES.hasRes(e)){var a=RES.getRes(e);a?i(a):RES.asyncLoad(e,function(e){i(e)},1)}else RES.getResByUrl(e,i,this,RES.ResourceItem.TYPE_IMAGE)},e.prototype.addAssetReference=function(e){var t=RES.config.getKeyByAlias(e),n=t.indexOf("#");n>=0&&(t=t.substr(0,n)),RES.addRel(t)},e.prototype.delAssetReference=function(e){var t=RES.config.getKeyByAlias(e),n=t.indexOf("#");n>=0&&(t=t.substr(0,n)),RES.using[t]&&RES.delRel(t,2*Game.cacheDuration)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="PageCollectCardSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.dataList=new eui.ArrayCollection,e}return __extends(n,t),n.prototype.setCard=function(t){this.card=t,e.CollectCardUI.card=t},n.prototype.getCard=function(){return void 0==this.card&&(this.card=e.CollectCardUI.card),this.card},n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=e.CollectCardItem,this.list.dataProvider=this.dataList,this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onSelectItem,this)},n.prototype.onSelectItem=function(){null!=this.list.selectedItem&&this.setCard(this.list.selectedItem.id)},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.CollectCardSyncCards,this.onSyncCards,this);var e=this.kind,t=this.getCard();if(this.changePage(e,0>t),0>t)this.list.selectedIndex=0;else for(var n=this.list.dataProvider,i=0;i<n.length;i++)if(n.getItemAt(i).id==t){this.list.selectedIndex=i;break}},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.CollectCardSyncCards,this.onSyncCards,this),this.kind=void 0,this.card=void 0},n.prototype.onSyncCards=function(){this.onTouchKindBtn()},n.prototype.onTouchTap=function(e){this.onTouchTapTarget(e.target)},n.prototype.onTapKindItem=function(e){this.kind=e,this.parent&&this.changePage(e,!0)},n.prototype.changePage=function(e,t){this.onTouchKindBtn(),t&&(this.list.selectedIndex=0,this.setCard(this.list.dataProvider.getItemAt(0).id))},n.prototype.onTouchTapTarget=function(t){switch(t){case this.btnSuitInfo:e.CollectCardSuitInfo.instance.setKind(this.kind),UIManager.push(e.CollectCardSuitInfo.instance);break;case this.btnRules:e.CollectCardRules.instance.currentState="collectCardRule",UIManager.push(e.CollectCardRules.instance)}},n.prototype.onTouchKindBtn=function(){var e=collectCardManager.GetKindName(this.kind);this.kindName=lang.StringWithFormat("collect card {1} suit",e),this.kindTotalFp=collectCardManager.GetKindTotalFp(this.kind),this.updateCards(),this.updateKindAttribute()},n.prototype.updateCards=function(){for(var e=[],t=collectCardManager.GetKindCards(this.kind),n=0;n!=t.length;n++)e.push({id:t[n],checkEnable:!0,checkBadge:!0});e.sort(this.__sortCards),this.dataList.replaceAll(e)},n.prototype.__sortCards=function(e,t){var n=collectCardManager.IsActivated(e.id),i=collectCardManager.IsActivated(t.id),a=collectCardManager.GetCardConfig(e.id),r=collectCardManager.GetCardConfig(t.id),o=a.quality,s=r.quality;if(n==i){if(!n){var l=PlayerAttribute.GetItemCount(19,e.id),u=PlayerAttribute.GetItemCount(19,t.id);if(l&&u)return o!=s?s-o:e.id-t.id;if(!l&&!u)return e.id-t.id;if(l)return-1;if(u)return 1}return o!=s?n?s-o:o-s:e.id-t.id}return n?-1:i?1:void 0},n.prototype.updateKindAttribute=function(){var e=collectCardManager.GetKindAttributeDesc(this.kind),t=e.length;this.kindAttrib1.textFlow=t>0?Game.TextParser.parse(e[0]):[],this.kindAttrib2.textFlow=t>1?Game.TextParser.parse(e[1]):[],this.kindAttrib3.textFlow=t>2?Game.TextParser.parse(e[2]):[],this.kindAttrib4.textFlow=t>3?Game.TextParser.parse(e[3]):[],this.kindAttrib5.textFlow=t>4?Game.TextParser.parse(e[4]):[],this.kindAttrib6.textFlow=t>5?Game.TextParser.parse(e[5]):[],this.kindAttrib7.textFlow=t>6?Game.TextParser.parse(e[6]):[],this.kindAttrib8.textFlow=t>7?Game.TextParser.parse(e[7]):[]},n}(e.FitComponent);e.PageCollectCard=t,__reflect(t.prototype,"UI.PageCollectCard",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.selectTypeSpecified=1,n.selectTypeQuality=2,n.skinName="PageCollectCardSplitSkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.dataCards=new eui.ArrayCollection,n.dataSelectCards=new eui.ArrayCollection,n.listGap=6,n.selectType=0,n.listCards.addEventListener(eui.ItemTapEvent.ITEM_TAP,n.onSelectItem,n),n.listCards.itemRenderer=e.CollectCardItemSmall,n.listCards.dataProvider=n.dataCards,n.listSelectCards.itemRenderer=e.CollectCardItemSmall,n.listSelectCards.dataProvider=n.dataSelectCards,n}return __extends(n,t),n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.CollectCardSyncExp,this.onSyncExp,this),Game.dispatcher.addEventListener(Game.EVENT.AddItem,this.onItemChanged,this),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,this.onItemChanged,this),Game.dispatcher.addEventListener(Game.EVENT.RemoveItem,this.onItemChanged,this),this.updateCards(),this.totalExp=collectCardManager.curTotalExp},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.CollectCardSyncExp,this.onSyncExp,this),Game.dispatcher.removeEventListener(Game.EVENT.AddItem,this.onItemChanged,this),Game.dispatcher.removeEventListener(Game.EVENT.UpdateItem,this.onItemChanged,this),Game.dispatcher.removeEventListener(Game.EVENT.RemoveItem,this.onItemChanged,this),this.reset()},n.prototype.reset=function(){this.chooseCard=0,this.getExp=0,this.dataSelectCards.removeAll(),this.dataSelectCards.refresh(),this.selectGreen.selected=!1,this.selectBule.selected=!1,this.selectPurple.selected=!1,this.selectOrange.selected=!1,this.selectRed.selected=!1,this.listCards.selectedIndices=[]},n.prototype.onItemChanged=function(e){var t=e.data;19==t.Item.Type&&this.updateCards()},n.prototype.onSyncExp=function(){this.totalExp=collectCardManager.curTotalExp},n.prototype.updateCards=function(){for(var e=[],t=collectCardManager.GetBagCardNums(),n=0;n!=t.length;n++){var i=t[n].id;!collectCardManager.IsActivated(i)||collectCardManager.GetCardLevel(i)<collectCardManager.MAXLEVEL||e.push({id:i,state:"bag"})}e.sort(this.__sortCards),this.dataCards.replaceAll(e)},n.prototype.__sortCards=function(e,t){var n=collectCardManager.GetCardConfig(e.id),i=collectCardManager.GetCardConfig(t.id),a=n.quality,r=i.quality;return a==r?e.id-t.id:r-a},n.prototype.onSelectItem=function(){if(null==this.listCards.selectedItems||0==this.listCards.selectedItems.length)this.getExp=0,this.chooseCard=0,this.dataSelectCards.removeAll(),this.dataSelectCards.refresh();else{this.chooseCard=this.listCards.selectedItems.length;for(var e=[],t=0,n=0;n!=this.listCards.selectedItems.length;n++){var i=this.listCards.selectedItems[n].id;if(collectCardManager.IsActivated(i)&&!(collectCardManager.GetCardLevel(i)<collectCardManager.MAXLEVEL)){var a=PlayerAttribute.GetItemCount(19,i);t+=collectCardManager.GetCardSplitExp(i)*a,e.push({id:i,state:"bag"})}}this.getExp=t,this.dataSelectCards.replaceAll(e);var r=e.length;if(r>0){var o=~~((440-82.6*r)/(r-1)/.7);this.listGap=o>6?6:o}}},n.prototype.split=function(){var t=this;if(!(this.chooseCard<=0)){for(var n=!1,i=0,a=[],r=0;r!=this.listCards.selectedItems.length;r++){var o=this.listCards.selectedItems[r].id;a.push(o);var s=collectCardManager.GetCardConfig(o);(4==s.quality||5==s.quality)&&(n=!0);var l=collectCardManager.GetCardSplitExp(o);i+=l*PlayerAttribute.GetItemCount(19,o)}var u="";u=n?lang.StringWithFormat("collect card split confirm include valuable card can get {1} exp",i):lang.StringWithFormat("collect card split confirm can get {1} exp",i);var c=lang.String("operation confirm");e.ConfirmBox.Show(e.ConfirmBoxStyle.team,c,u,function(){return t.confirmSplit(a),!0},null,null)}},n.prototype.confirmSplit=function(e){for(var t=new net.def.C2SCollectCardSplitCards,n=0;n!=e.length;n++){var i=e[n];t.ids.push(i)}net.socket.write(281,t.toArrayBuffer()),this.reset()},n.prototype.selectQuality=function(){var e=!1,t={};this.selectGreen.selected&&(t[1]={}),this.selectBule.selected&&(t[2]={}),this.selectPurple.selected&&(t[3]={}),this.selectOrange.selected&&(t[4]={},e=!0),this.selectRed.selected&&(t[5]={},e=!0);for(var n=0,i=[],a={},r=collectCardManager.GetBagCardNums(),o=0;o!=r.length;o++)if(null!=t[r[o].quality]){var s=r[o].id;if(!collectCardManager.IsActivated(s)||collectCardManager.GetCardLevel(s)<collectCardManager.MAXLEVEL)continue;var l=collectCardManager.GetCardSplitExp(s);n+=l*r[o].num,i.push({id:r[o].id,state:"bag"}),a[r[o].id]={}}this.getExp=n,this.chooseCard=i.length,this.dataSelectCards.replaceAll(i);var u=i.length;if(u>0){var c=~~((440-82.6*u)/(u-1)/.7);this.listGap=c>6?6:c}for(var h=[],o=0;o!=this.dataCards.length;o++){var s=this.dataCards.getItemAt(o).id;null!=a[s]&&h.push(o)}this.listCards.selectedIndices=h},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnClose:case this.btnClose1:case this.imgClose:UIManager.pop(this);break;case this.btnSplit:this.split();break;case this.selectGreen:case this.selectBule:case this.selectPurple:case this.selectOrange:case this.selectRed:this.selectQuality();break;case this.btnRules:e.CollectCardRules.instance.currentState="splitRule",UIManager.push(e.CollectCardRules.instance)}},n}(e.FitComponent);e.PageCollectCardSplit=t,__reflect(t.prototype,"UI.PageCollectCardSplit",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="CardRankSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.dataList=new eui.ArrayCollection,e}return __extends(n,t),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.listCards.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onSelectItem,this),this.listCards.itemRenderer=e.CollectCardItemSmall,this.listCards.dataProvider=this.dataList},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.CollectCardSyncCards,this.onSyncCards,this),Game.dispatcher.addEventListener(Game.EVENT.CollectCardUpgradeLevelSuccess,this.onSuccess,this);var e=this.kind,t=this.getCard();this.changePage(e,0>t),this.selectItem(t);for(var n=this.listCards.dataProvider,i=0;i<n.length;i++)if(n.getItemAt(i).id==t){this.listCards.selectedIndex=i;break}},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.CollectCardSyncCards,this.onSyncCards,this),Game.dispatcher.removeEventListener(Game.EVENT.CollectCardUpgradeLevelSuccess,this.onSuccess,this),this.kind=void 0,this.card=void 0},n.prototype.setCard=function(t){this.card=t,e.CollectCardUI.card=t},n.prototype.getCard=function(){return void 0==this.card&&(this.card=e.CollectCardUI.card),this.card},n.prototype.onSuccess=function(){var t=new e.MovieClipComponent;t.horizontalCenter=0,t.verticalCenter=0,t.removeWhenComplete=!0,t.visible=!0,t.scaleX=.7,t.scaleY=.7,this.selectCard.addChild(t),t.Load("skill/vip_bg2/vip_bg2.json","vip_bg2"),t.gotoAndPlay(0,1)},n.prototype.onSyncCards=function(){this.onTouchKindBtn(this.kind,!1);var e=this.getCard();e>0&&this.selectItem(e)},n.prototype.onTouchTap=function(e){this.onTouchTapTarget(e.target)},n.prototype.onTapKindItem=function(e){this.kind=e,this.parent&&this.changePage(e,!0)},n.prototype.changePage=function(e,t){this.kind=e,this.onTouchKindBtn(e,t)},n.prototype.onTouchTapTarget=function(t){switch(t){case this.btnClose:case this.btnClose1:case this.imgClose:UIManager.pop(this);
break;case this.btnUpgradeLevel:this.upgradeLevel();break;case this.btnSuitInfo:e.CollectCardSuitInfo.instance.setKind(this.kind),UIManager.push(e.CollectCardSuitInfo.instance);break;case this.btnRules:e.CollectCardRules.instance.currentState="upgradeLevelRule",UIManager.push(e.CollectCardRules.instance)}},n.prototype.upgradeLevel=function(){var e=this.getCard();if(e>0){var t=new net.def.BagItemId;t.setId(e),net.socket.write(280,t.toArrayBuffer())}},n.prototype.onTouchKindBtn=function(e,t){this.kindName=collectCardManager.GetKindName(e),this.kindName=lang.StringWithFormat("collect card {1} suit",this.kindName);for(var n=[],i=collectCardManager.GetKindCards(e),a=0;a!=i.length;a++)n.push({id:i[a],state:"level"});n.sort(this.__sortCards);var r=0;n.length>0&&(r=n[0].id),this.dataList.replaceAll(n),t&&r>0&&(this.selectItem(r),this.listCards.selectedIndex=0)},n.prototype.__sortCards=function(e,t){var n=collectCardManager.IsActivated(e.id),i=collectCardManager.IsActivated(t.id),a=collectCardManager.GetCardConfig(e.id),r=collectCardManager.GetCardConfig(t.id),o=a.quality,s=r.quality;return n==i?o!=s?n?s-o:o-s:e.id-t.id:n?-1:i?1:void 0},n.prototype.onSelectItem=function(){if(null!=this.listCards.selectedItem){var e=this.listCards.selectedItem.id;this.selectItem(e)}},n.prototype.selectItem=function(e){this.setCard(e),this.selectCard.data={id:e,checkEnable:!1,checkBadge:!1};var t=collectCardManager.GetActivatedCard(e),n=collectCardManager.GetCardConfig(e);if(null!=n){var i=null!=t?t.level:0,a=i+1>collectCardManager.MAXSTAR?collectCardManager.MAXSTAR:i+1;this.cardName=n.name,this.curLevel=lang.StringWithFormat("{1}grade",i),this.nextLevel=lang.StringWithFormat("{1}grade",a);var r=collectCardManager.GetCardLevelAttributeCompares(e);this.levelAttributeChange1.textFlow=Game.TextParser.parse(this.getAttribChange(r[0],i)),this.levelAttributeChange2.textFlow=Game.TextParser.parse(this.getAttribChange(r[1],i)),this.levelAttributeChange3.textFlow=Game.TextParser.parse(this.getAttribChange(r[2],i)),this.levelAttributeChange4.textFlow=Game.TextParser.parse(this.getAttribChange(r[3],i)),this.levelAttributeChange5.textFlow=Game.TextParser.parse(this.getAttribChange(r[4],i)),this.levelAttributeChange6.textFlow=Game.TextParser.parse(this.getAttribChange(r[5],i)),this.levelAttributeChange7.textFlow=Game.TextParser.parse(this.getAttribChange(r[6],i)),this.levelAttributeChange8.textFlow=Game.TextParser.parse(this.getAttribChange(r[7],i));var o=collectCardManager.GetUpgradeLevelCost(e),s=PlayerAttribute.GetItemCount(19,e);this.cost.text="("+s+"/"+o+")",this.cost.textColor=s>=o?color.GREEN:color.RED,this.imgNextLevel.visible=i<collectCardManager.MAXLEVEL,this.imgNextLevel.scaleX=i<collectCardManager.MAXLEVEL?1:0,this.imgNextLevel.scaleY=i<collectCardManager.MAXLEVEL?1:0,this.labelNextLevel.visible=i<collectCardManager.MAXLEVEL,this.labelNextLevel.scaleX=i<collectCardManager.MAXLEVEL?1:0,this.labelNextLevel.scaleY=i<collectCardManager.MAXLEVEL?1:0,this.groupCost.visible=i<collectCardManager.MAXLEVEL;var l=collectCardManager.IsActivated(e);this.btnUpgradeLevel.enabled=l&&s>=o&&i<collectCardManager.MAXLEVEL?!0:!1}},n.prototype.getAttribChange=function(e,t){return null==e?"":t>=collectCardManager.MAXLEVEL?e.attrib+"</font><font color='#85E654'>+"+e.curParam+"</font>":e.attrib+"</font><font color='#85E654'>+"+e.curParam+"</font> --> </font><font color='#85E654'>+"+e.nextParam+"</font>"},n}(e.FitComponent);e.PageCollectCardUpgradeLevel=t,__reflect(t.prototype,"UI.PageCollectCardUpgradeLevel",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="PageCollectCardUpgradeStarSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.dataList=new eui.ArrayCollection,e}return __extends(n,t),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.listCards.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onSelectItem,this),this.listCards.itemRenderer=e.CollectCardItemSmall,this.listCards.dataProvider=this.dataList},n.prototype.setCard=function(t){this.card=t,e.CollectCardUI.card=t},n.prototype.getCard=function(){return void 0==this.card&&(this.card=e.CollectCardUI.card),this.card},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.CollectCardSyncCards,this.onSyncCards,this),Game.dispatcher.addEventListener(Game.EVENT.CollectCardSyncExp,this.onSyncCards,this),Game.dispatcher.addEventListener(Game.EVENT.CollectCardUpgradeStarSuccess,this.onSuccess,this);var e=this.kind,t=this.getCard();this.changePage(e,0>t),this.selectItem(t);for(var n=this.listCards.dataProvider,i=0;i<n.length;i++)if(n.getItemAt(i).id==t){this.listCards.selectedIndex=i;break}},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.CollectCardSyncCards,this.onSyncCards,this),Game.dispatcher.removeEventListener(Game.EVENT.CollectCardSyncExp,this.onSyncCards,this),Game.dispatcher.removeEventListener(Game.EVENT.CollectCardUpgradeStarSuccess,this.onSuccess,this),this.kind=void 0,this.card=void 0},n.prototype.changePage=function(e,t){this.kind=e,this.onTouchKindBtn(e,t)},n.prototype.onTapKindItem=function(e){this.kind=e,this.parent&&this.changePage(e,!0)},n.prototype.onSuccess=function(){var t=new e.MovieClipComponent;t.horizontalCenter=0,t.verticalCenter=0,t.removeWhenComplete=!0,t.visible=!0,t.scaleX=.7,t.scaleY=.7,this.selectCard.addChild(t),t.Load("skill/vip_bg2/vip_bg2.json","vip_bg2"),t.gotoAndPlay(0,1)},n.prototype.onTouchTap=function(e){this.onTouchTapTarget(e.target)},n.prototype.onTouchTapTarget=function(t){switch(t){case this.btnClose:case this.btnClose1:case this.imgClose:UIManager.pop(this);break;case this.btnUpgradeStr:this.upgradeStar();break;case this.btnRules:e.CollectCardRules.instance.currentState="upgradeStarRule",UIManager.push(e.CollectCardRules.instance)}},n.prototype.upgradeStar=function(){var e=this.getCard();if(e>0){var t=new net.def.BagItemId;t.setId(e),net.socket.write(279,t.toArrayBuffer())}},n.prototype.onSyncCards=function(){this.onTouchKindBtn(this.kind,!1);var e=this.getCard();e>0&&this.selectItem(e)},n.prototype.onTouchKindBtn=function(e,t){this.kindName=collectCardManager.GetKindName(e);for(var n=[],i=collectCardManager.GetKindCards(e),a=0;a!=i.length;a++)n.push({id:i[a],state:"star"});n.sort(this.__sortCards);var r=0;n.length>0&&(r=n[0].id),this.dataList.replaceAll(n),t&&r>0&&(this.selectItem(r),this.listCards.selectedIndex=0)},n.prototype.__sortCards=function(e,t){var n=collectCardManager.IsActivated(e.id),i=collectCardManager.IsActivated(t.id),a=collectCardManager.GetCardConfig(e.id),r=collectCardManager.GetCardConfig(t.id),o=a.quality,s=r.quality;return n==i?o!=s?n?s-o:o-s:e.id-t.id:n?-1:i?1:void 0},n.prototype.onSelectItem=function(){if(null!=this.listCards.selectedItem){var e=this.listCards.selectedItem.id;this.selectItem(e)}},n.prototype.selectItem=function(e){this.setCard(e),this.selectCard.data={id:e,checkEnable:!1,checkBadge:!1};var t=collectCardManager.GetActivatedCard(e),n=collectCardManager.GetCardConfig(e);if(null!=n){var i=null!=t?t.star:0,a=i+1>collectCardManager.MAXSTAR?collectCardManager.MAXSTAR:i+1;this.cardName=n.name,this.curStar=i,this.nextStar=a;var r=collectCardManager.GetCardStarAttributeCompares(e);this.starAttributeChange1.textFlow=Game.TextParser.parse(this.getAttribChange(r[0],i)),this.starAttributeChange2.textFlow=Game.TextParser.parse(this.getAttribChange(r[1],i)),this.starAttributeChange3.textFlow=Game.TextParser.parse(this.getAttribChange(r[2],i)),this.starAttributeChange4.textFlow=Game.TextParser.parse(this.getAttribChange(r[3],i)),this.starAttributeChange5.textFlow=Game.TextParser.parse(this.getAttribChange(r[4],i)),this.starAttributeChange6.textFlow=Game.TextParser.parse(this.getAttribChange(r[5],i)),this.starAttributeChange7.textFlow=Game.TextParser.parse(this.getAttribChange(r[6],i)),this.starAttributeChange8.textFlow=Game.TextParser.parse(this.getAttribChange(r[7],i));var o=collectCardManager.GetUpgradeStarCostExp(e),s=collectCardManager.curTotalExp,l=s>=o?color.GREEN:color.RED;this.cost.text="("+s+"/"+o+")",this.cost.textColor=l,this.imgNextStar.visible=i<collectCardManager.MAXSTAR,this.imgNextStar.scaleX=i<collectCardManager.MAXSTAR?1:0,this.imgNextStar.scaleY=i<collectCardManager.MAXSTAR?1:0,this.labelNextStar.visible=i<collectCardManager.MAXSTAR,this.labelNextStar.scaleX=i<collectCardManager.MAXSTAR?1:0,this.labelNextStar.scaleY=i<collectCardManager.MAXSTAR?1:0,this.imgNextStarIcon.visible=i<collectCardManager.MAXSTAR,this.imgNextStarIcon.scaleX=i<collectCardManager.MAXSTAR?1:0,this.imgNextStarIcon.scaleY=i<collectCardManager.MAXSTAR?1:0,this.groupCost.visible=i<collectCardManager.MAXSTAR;var u=collectCardManager.IsActivated(e);this.btnUpgradeStr.enabled=u&&s>=o&&i<collectCardManager.MAXSTAR?!0:!1}},n.prototype.getAttribChange=function(e,t){return null==e?"":t>=collectCardManager.MAXSTAR?e.attrib+"</font><font color='#84E654'>"+e.curParam+"%</font>":e.attrib+"</font><font color='#84E654'>"+e.curParam+"%</font> --> </font><font color='#84E654'>"+e.nextParam+"%</font>"},n}(e.FitComponent);e.PageCollectCardUpgradeStar=t,__reflect(t.prototype,"UI.PageCollectCardUpgradeStar",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.labelTaskDesc.text="Đã thắp sáng Thẻ Giải Đố"},t.prototype.dataChanged=function(){var e;switch(this.data.status){case 0:this.currentState="notfinished",e=color.Warning;break;case 1:this.currentState="canuse",e=color.Title1_Value;break;case 2:this.currentState="used",e=color.Title1_Value;break;default:this.currentState="notfinished",e=color.Warning}this.labelNum.textFlow=Game.HtmlTextParser.parse("<font color="+egret.toColorString(e)+">"+this.data.amount+"</font>/"+this.data.count),this.awardList.dataProvider=new eui.ArrayCollection(this.data.awards)},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnClick:activityCollectTreasure.applyAward(this.data.id)}},t}(eui.ItemRenderer);e.CollectTreasureAmountItem=t,__reflect(t.prototype,"UI.CollectTreasureAmountItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="CollectTreasureAmountUISkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(){this.scroller.viewport.scrollV=0,this.onRefresh(),Game.dispatcher.addEventListener(Game.EVENT.CollectTreasureDataChanged,this.onRefresh,this)},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.CollectTreasureDataChanged,this.onRefresh,this)},t.prototype.onRefresh=function(){for(var e=[],t=activityCollectTreasure.amountCfg,n=activityCollectTreasure.getAmount(),i=0;i<t.length;i++){var a=n;a>t[i].count&&(a=t[i].count),e.push({id:t[i].id,awards:t[i].awards,count:t[i].count,amount:a,status:t[i].status})}e.sort(function(e,t){return e.status!=t.status?(t.status+1)%3-(e.status+1)%3:e.count-t.count});var r=this.list.dataProvider;null==r?this.list.dataProvider=new eui.ArrayCollection(e):r.replaceAll(e)},t}(eui.Component);e.CollectTreasureAmountUI=t,__reflect(t.prototype,"UI.CollectTreasureAmountUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="CollectTreasureAwardItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){this.listAward.dataProvider=new eui.ArrayCollection(this.data.awards)},t}(eui.ItemRenderer);e.CollectTreasureAwardItem=t,__reflect(t.prototype,"UI.CollectTreasureAwardItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="CollectTreasureAwardUISkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.list.dataProvider=new eui.ArrayCollection(activityCollectTreasure.rankAwardCfg)},t.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.CollectTreasureRankList,this.onRefreshMyRank,this)},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.CollectTreasureRankList,this.onRefreshMyRank,this)},t.prototype.onRefreshMyRank=function(){this.rank=activityCollectTreasure.getMyRank()},t}(eui.Component);e.CollectTreasureAwardUI=t,__reflect(t.prototype,"UI.CollectTreasureAwardUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.arrCard=[],e.totalCount=0,e.skinName="CollectTreasureIdentifyUISkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.onceCost=activityCollectTreasure.getCost(!1),this.tenCost=activityCollectTreasure.getCost(!0),this.list.dataProvider=new eui.ArrayCollection(activityCollectTreasure.cardCfg)},n.prototype.onAddToStage=function(){this.arrCard=[],this.treasureMap.source=activityCollectTreasure.getMapsource(),this.onRefreshMap(),this.onRefreshCard(),Game.dispatcher.addEventListener(Game.EVENT.CollectTreasureDataChanged,this.onRefreshMap,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.CollectTreasureDataChanged,this.onRefreshMap,this)},n.prototype.onRefreshMap=function(){var t=this.list.dataProvider;t.refresh();var n=activityCollectTreasure.cardCfg;if(0==this.arrCard.length){this.totalCount=0;for(var i=0;i<n.length;i++)this.totalCount+=n[i].count,this.arrCard.push(n[i].count)}else{var a=0!=this.totalCount;this.totalCount=0;for(var i=0;i<n.length;i++)if(this.totalCount+=n[i].count,n[i].count!=this.arrCard[i]&&(this.arrCard[i]=n[i].count,a)){var r=new e.MovieClipComponent;r.removeWhenComplete=!0,r.position="TL",r.scaleX=1.3,r.scaleY=1.3,r.x=this.list.x+43+96*(i%5),r.y=this.list.y+43+96*~~(i/5),this.addChild(r),r.Load("skill/Ui_qianghua01/Ui_qianghua01.json","Ui_qianghua01"),r.gotoAndPlay(0,1)}}this.btn1.enabled=activityCollectTreasure.canOpenCard(!1),this.btn10.enabled=activityCollectTreasure.canOpenCard(!0),this.onRefreshCard()},n.prototype.onRefreshCard=function(){this.cell.data=activityCollectTreasure.unattunedcard,this.cell.onRefresh()},n.prototype.onButtonOpen=function(t){var n=PlayerAttribute.currency[Game.Currency.SilverCoin],i=PlayerAttribute.currency[Game.Currency.GoldCoin],a=activityCollectTreasure.getCost(t);if(n>=a)return void activityCollectTreasure.applyOpenCard(t);if(i+n>=a){var r=function(){var e=PlayerAttribute.currency[Game.Currency.SilverCoin],n=PlayerAttribute.currency[Game.Currency.GoldCoin];return a>n+e?void PopUpMessage.push(lang.String("not enough goldcoin"),color.RED):void activityCollectTreasure.applyOpenCard(t)};if(activityCollectTreasure.noWarn)r();else{var o=new e.SliverCoinPrompt;o.title=lang.String("operation confirm"),o.content=lang.StringWithFormat("if replace {1} silver with gold",a-n),o.cb=function(e){activityCollectTreasure.noWarn=e,r(),UIManager.pop(o)},UIManager.push(o)}}else PopUpMessage.push(lang.String("not enough anyCoin"),color.RED),Recharge.openRechargeUI()},n.prototype.onTouchTap=function(e){switch(e.target){case this.btn1:this.onButtonOpen(!1);break;case this.btn10:this.onButtonOpen(!0)}},n}(eui.Component);e.CollectTreasureIdentifyUI=t,__reflect(t.prototype,"UI.CollectTreasureIdentifyUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.minutes=0,e.skinName="CollectTreasureMainUISkin",e.minuteTiker=new Ticker(Game.Minute),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.onAddToStage=function(){activityCollectTreasure.mainUIVisiable=!0,this.onRefreshValue(),activityCollectTreasure.applyCardData(),activityCollectTreasure.applyRankList(),Game.dispatcher.addEventListener(Game.EVENT.CollectTreasureDataChanged,this.onRefreshValue,this),this.minuteTiker.addEventListener(this.updateTime,this)},n.prototype.onRemoveFromStage=function(){activityCollectTreasure.mainUIVisiable=!1,Game.dispatcher.removeEventListener(Game.EVENT.CollectTreasureDataChanged,this.onRefreshValue,this),this.minuteTiker.removeEventListener(this.updateTime,this)},n.prototype.updateTime=function(){this.minutes++,this.openDay=activityCollectTreasure.getLastTime(60*this.minutes)},n.prototype.onRefreshValue=function(){this.minutes=-1,this.updateTime(),this.value=activityCollectTreasure.totalValue},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnRule:var n=new e.Rule;n.skinName="CollectTreasureRulesSkin",UIManager.pushPage(n);break;case this.btnObtain:e.ResourceObtain.Open([e.ObtResId.collectTreasure])}},n}(e.FitComponent);e.CollectTreasureMainUI=t,__reflect(t.prototype,"UI.CollectTreasureMainUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="CollectTreasureMapItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){0==this.data.count?this.currentState="kong":this.currentState="light"},t}(eui.ItemRenderer);e.CollectTreasureMapItem=t,__reflect(t.prototype,"UI.CollectTreasureMapItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="CollectTreasureRankUISkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(){this.onRefreshMyRank(),Game.dispatcher.addEventListener(Game.EVENT.CollectTreasureRankList,this.onRefreshMyRank,this)},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.CollectTreasureRankList,this.onRefreshMyRank,this)},t.prototype.onRefreshMyRank=function(){this.rank=activityCollectTreasure.getMyRank();var e=this.list.dataProvider;null==e?this.list.dataProvider=new eui.ArrayCollection(activityCollectTreasure.rankData):e.replaceAll(activityCollectTreasure.rankData)},t}(eui.Component);e.CollectTreasureRankUI=t,__reflect(t.prototype,"UI.CollectTreasureRankUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.action="",t.icon="",t}return __extends(t,e),t}(eui.RadioButton);e.RadioButton=t,__reflect(t.prototype,"UI.RadioButton")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="CompositeGamesHallSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new e.CompositeGamesHall),this._instance},enumerable:!0,configurable:!0}),n.open=function(){var e=this.instance;return UIManager.pushPage(e),e},n.close=function(){null!=this._instance&&UIManager.pop(this._instance)},n.prototype.onAddToStage=function(){CompositeGamesSevenDayGift.finish()||null==CompositeGamesSevenDayGift.data?this.removeRadioButton(this.btnCompositeSevenDayGift):(this.btnCompositeSevenDayGift||(this.btnCompositeSevenDayGift=this.createRadioButton("Quà 7 Ngày","2211","ui/city1/btn_7day.png")),this.addRadioButton(this.btnCompositeSevenDayGift)),null!=CompositeGamesGroupon.rankList?(this.btnCompositeGroupon||(this.btnCompositeGroupon=this.createRadioButton("Mua Chung Gộp SV","2212","ui/city1/btn_budeng.png")),this.addRadioButton(this.btnCompositeGroupon)):this.removeRadioButton(this.btnCompositeGroupon);var e=this.btnGroup.getChildAt(0);e.selected=!0,this.onTouchTapTarget(e),this.scroller.viewport.scrollH=0},n.prototype.onRemoveFromStage=function(){for(var e=0;e<this.btnGroup.numChildren;e++){var t=this.btnGroup.getChildAt(e);t.selected=!1}},n.prototype.onTouchTap=function(e){this.onTouchTapTarget(e.target)},n.prototype.onTouchTapTarget=function(t){switch(t){case this.imgClose:case this.btnClose:case this.btnClose1:this.close();break;case this.btnCompositeSevenDayGift:this.sevenGift||(this.sevenGift=new e.CompositeGamesSevenDayGiftPanel),this.addObjecttoView(this.sevenGift);break;case this.btnCompositeGroupon:this.groupon||(this.groupon=new e.CompositeGrouponPanel),this.addObjecttoView(this.groupon)}},n.prototype.createRadioButton=function(t,n,i){var a=new e.RadioButton;return a.label=t,a.action=n,a.icon=i,a.groupName="rechargeActivity",a.skinName="RadioTemp3Skin",a},n.prototype.addRadioButton=function(e,t){e&&e.parent!=this.btnGroup&&(t?this.btnGroup.addChildAt(e,t):this.btnGroup.addChild(e))},n.prototype.removeRadioButton=function(e){e&&null!=e.parent&&Game.removeFromParent.apply(e)},n.prototype.addObjecttoView=function(e){e.parent!=this.view&&(this.view.removeChildren(),this.view.addChild(e))},n}(e.FitComponent);e.CompositeGamesHall=t,__reflect(t.prototype,"UI.CompositeGamesHall",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.skinName="CompositeGamesSevenDayGiftPanelSkin",t}return __extends(t,e),t.prototype.close=function(){UIManager.pop(this)},t.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:case this.btnBack:case this.btnClose:this.close()}},t.prototype.onAddToStage=function(){this.mc.visible=!0,this.mc.Load("skill/vip_bg2/vip_bg2.json","vip_bg2"),this.mc.gotoAndPlay(0,-1);var e=CompositeGamesSevenDayGift.withDay();null!=e.idx?this.tab.selectedIndex=e.idx:this.tab.selectedIndex=0,this.onUpdate(),Game.dispatcher.addEventListener(Game.EVENT.CompositeGamesSevenDayGift,this.onUpdate,this)},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.CompositeGamesSevenDayGift,this.onUpdate,this),this.mc.visible=!1,this.mc.stop(),this.mc.free()},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.tab.addEventListener(eui.UIEvent.CHANGE,this.onDaySelected,this),this.btnGetAward.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onWithDraw,this),this.imgGroup.addEventListener(egret.Event.COMPLETE,this.onTweenGroupComplete,this),this.imgGroup.play(0)},t.prototype.changePage=function(e){this.tab.selectedIndex=e,this.onUpdate()},t.prototype.onDaySelected=function(e){var t=this.tab.selectedIndex;null==CompositeGamesSevenDayGift.data||0>t||(this.cell.data=table.compositGamesSevenDayGift[t].content[0],this.cell.onRefresh(),this.giftIcon0=table.compositGamesSevenDayGift[this.tab.selectedIndex].icons[0],this.giftIcon1=table.compositGamesSevenDayGift[this.tab.selectedIndex].icons[1],this.showBtnAwardStatus(t))},t.prototype.onWithDraw=function(){if("up"==this.btnGetAward.currentState){var e=new net.def.Index;e.index=this.tab.selectedIndex,net.socket.write(2074,e.toArrayBuffer())}},t.prototype.onUpdate=function(){if(null!=CompositeGamesSevenDayGift.data){this.cell.data=table.compositGamesSevenDayGift[this.tab.selectedIndex].content[0],this.cell.onRefresh(),this.giftIcon0=table.compositGamesSevenDayGift[this.tab.selectedIndex].icons[0],this.giftIcon1=table.compositGamesSevenDayGift[this.tab.selectedIndex].icons[1],this.showBtnAwardStatus(this.tab.selectedIndex);for(var e=0;e<CompositeGamesSevenDayGift.data.bonus.length;e++)this["day"+(e+1)+"Notice"]=!CompositeGamesSevenDayGift.data.bonus[e]&&e<CompositeGamesSevenDayGift.data.count}},t.prototype.showBtnAwardStatus=function(e){var t=!CompositeGamesSevenDayGift.data.bonus[e]&&e<CompositeGamesSevenDayGift.data.count;CompositeGamesSevenDayGift.data.bonus[e]?this.btnGetAward.currentState="down":t?this.btnGetAward.currentState="up":this.btnGetAward.currentState="disabled"},t.prototype.onTweenGroupComplete=function(){this.imgGroup.play(0)},t}(eui.Component);e.CompositeGamesSevenDayGiftPanel=t,__reflect(t.prototype,"UI.CompositeGamesSevenDayGiftPanel",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.dataChanged=function(){var e=this.awardList.dataProvider;null==e?this.awardList.dataProvider=new eui.ArrayCollection(CompositeGamesGroupon.info_GrouponRankAwards[this.data.idx]):e.replaceAll(CompositeGamesGroupon.info_GrouponRankAwards[this.data.idx])},t}(eui.ItemRenderer);e.CompositeGrouponAwardsItem=t,__reflect(t.prototype,"UI.CompositeGrouponAwardsItem");var n=function(t){function n(){return t.call(this)||this}return __extends(n,t),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btnDraw.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onDraw,this)},n.prototype.dataChanged=function(){switch(this.awardList.dataProvider=new eui.ArrayCollection(CompositeGamesGroupon.info_GrouponAwards[this.data.idx].awards),this.count=CompositeGamesGroupon.info_GrouponAwards[this.data.idx].count,this.btnDraw.visible=!0,this.data.status){case 1:this.btnDraw.label=lang.String("receive"),this.btnDraw.enabled=!0;break;case 2:this.btnDraw.visible=!1;break;default:this.btnDraw.label=lang.String("receive"),this.btnDraw.enabled=!1}},n.prototype.onDraw=function(){if(CompositeGamesGroupon.charged){var t=new net.def.C2SOpeningGrouponAward;t.setIndex(this.data.idx),net.socket.write(2080,t.toArrayBuffer())}else{var n=lang.String("recharge drawn"),i=lang.String("CompositeGroupon charged user could drawwith");e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],n,i,function(){return Recharge.openRechargeUI(),!0},null,null)}},n}(eui.ItemRenderer);e.CompositeGrouponChargesItem=n,__reflect(n.prototype,"UI.CompositeGrouponChargesItem");var i=function(e){function t(){var t=e.call(this)||this;return t.totalCount=0,t.maxCount=3e5,t.myCount=0,t.skinName="CompositeGrouponPanelSkin",t.touchEnabled=!1,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.onAddToStage=function(){CompositeGamesGroupon.leftDays>0?this.openDate.textFlow=Game.HtmlTextParser.parse(lang.StringWithFormat("activity last days{1}",CompositeGamesGroupon.leftDays)):this.openDate.text=lang.String("already finish"),this.onRefreshCount(),this.onRefreshGrouponStatus(),this.onRefreshRanklist(),Game.dispatcher.addEventListener(Game.EVENT.CompositeGrouponRanklist,this.onRefreshRanklist,this),Game.dispatcher.addEventListener(Game.EVENT.CompositeGrouponAmount,this.onRefreshCount,this),Game.dispatcher.addEventListener(Game.EVENT.CompositeGrouponStatus,this.onRefreshGrouponStatus,this),net.socket.write(2081,null)},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.CompositeGrouponRanklist,this.onRefreshRanklist,this),Game.dispatcher.removeEventListener(Game.EVENT.CompositeGrouponAmount,this.onRefreshCount,this),Game.dispatcher.removeEventListener(Game.EVENT.CompositeGrouponStatus,this.onRefreshGrouponStatus,this),this.tab.selectedIndex=0},t.prototype.onRefreshCount=function(){this.myCount=CompositeGamesGroupon.personAmount,CompositeGamesGroupon.serverAmount>=this.maxCount?this.totalCount=this.maxCount:this.totalCount=CompositeGamesGroupon.serverAmount},t.prototype.onRefreshGrouponStatus=function(){for(var e=this.chargesDataGroup.dataProvider,t=[],n=0;n<CompositeGamesGroupon.info_GrouponAwards.length;n++)null!=CompositeGamesGroupon.grouponStatus&&null!=CompositeGamesGroupon.grouponStatus[n]?t.push({idx:n,status:CompositeGamesGroupon.grouponStatus[n]||0}):t.push({idx:n,status:0});t.sort(CompositeGamesGroupon.sortStatus),null==e?this.chargesDataGroup.dataProvider=new eui.ArrayCollection(t):e.replaceAll(t)},t.prototype.onRefreshRanklist=function(){var e=this.rankList.dataProvider,t=CompositeGamesGroupon.rankList;if(t.length<=0)for(var n=0;10>n;n++)t.push({round:n+1,name:lang.String("leave the seat of honour open"),time:0});null==e?this.rankList.dataProvider=new eui.ArrayCollection(t):(e.replaceAll(t),this.rankScroller.viewport.scrollV=0)},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnCharge:Recharge.openRechargeUI()}},t}(eui.ItemRenderer);e.CompositeGrouponPanel=i,__reflect(i.prototype,"UI.CompositeGrouponPanel")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="ConsignmentBuySkin",n.dataList=new eui.ArrayCollection,n.list.itemRenderer=e.ConsignmentSpecificItem,n.list.dataProvider=n.dataList,n.maxNum=0,n.specificGenre=0,n.specificDetailType=0,n.onChange=MakeDelayExecute(n.toBottom,n,10*Game.MSPF),n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n}return __extends(n,t),n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.ConsignmentSyncSpecificItemList,this.updateItemList,this),this.labelNum.type=egret.TextFieldType.INPUT,this.labelNum.restrict="0-9",this.labelNum.addEventListener(egret.Event.CHANGE,this.onNumberChange,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.ConsignmentSyncSpecificItemList,this.updateItemList,this),this.labelNum.removeEventListener(egret.Event.CHANGE,this.onNumberChange,this),this.maxNum=0,this.specificGenre=0,this.specificDetailType=0,this.onChange.stop()},n.prototype.SetSpecificItemGD=function(e,t){this.specificGenre=e,this.specificDetailType=t},n.prototype.updateItemList=function(){Consignment.dataSpecificItemList.getList().length<=0&&Game.ShowNotifyErrorMsg(lang.String("consignment this ware is sold out")),this.maxNum=this.calcTotalNum(),this.updateCost();var e=parseInt(this.labelNum.text);isNaN(e)&&(e=0);for(var t=[],n=Consignment.dataSpecificItemList.getList(),i=0;i!=n.length;i++){var a=n[i],r=e>0?!0:!1;e-=a.getTotalNum(),t.push({item:a,select:r})}t.reverse(),this.dataList.replaceAll(t),this.onChange()},n.prototype.calcTotalNum=function(){for(var e=0,t=Consignment.dataSpecificItemList.getList(),n=0;n!=t.length;n++){var i=t[n];e+=i.getTotalNum()}return e},n.prototype.onNumberChange=function(){var e=parseInt(this.labelNum.text);isNaN(e)&&(e=0),e=Math.min(e,this.maxNum),e=Math.max(0,e),this.labelNum.text=e.toString(),this.updateCost(),this.updateItemList()},n.prototype.updateCost=function(){var e=parseInt(this.labelNum.text);if(isNaN(e))return e=0,void(this.labelCost.text="0");for(var t=0,n=e,i=Consignment.dataSpecificItemList.getList(),a=0;a!=i.length;a++){var r=0,o=i[a];r=o.getTotalNum()>=n?n:o.getTotalNum(),n-=r,t+=r*o.getPrice()}this.labelCost.text=t.toString()},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnCancel:this.Close();
break;case this.btnBuy:this.Buy();break;case this.btnIncrease1:this.Increase(1);break;case this.btnIncrease10:this.Increase(10);break;case this.btnDecrease1:this.Decrease(1);break;case this.btnDecrease10:this.Decrease(10)}},n.prototype.Close=function(){UIManager.pop(this)},n.prototype.Buy=function(){var t=parseInt(this.labelNum.text),n=parseInt(this.labelCost.text);if(0>=t)return void Game.ShowNotifyErrorMsg(lang.String("consignment input wrong number"));if(!(0>=n)){if(PlayerAttribute.currency[Game.Currency.GoldCoin]<n)return void UIManager.push(new e.GoldCoinPrompt);var i=new net.def.C2SConsignmentItemBuy;i.genre=this.specificGenre,i.detailType=this.specificDetailType,i.totalNum=t,i.totalPrice=n,net.socket.write(2097,i.toArrayBuffer())}},n.prototype.Increase=function(e){var t=parseInt(this.labelNum.text);isNaN(t)&&(t=0),t+=e,t=Math.min(t,this.maxNum),t=Math.max(t,0),this.labelNum.text=t.toString(),this.updateCost(),this.updateItemList()},n.prototype.Decrease=function(e){var t=parseInt(this.labelNum.text);isNaN(t)&&(t=0),t-=e,t=Math.min(t,this.maxNum),t=Math.max(t,0),this.labelNum.text=t.toString(),this.updateCost(),this.updateItemList()},n.prototype.toBottom=function(){var e=this.scroller,t=e.viewport.contentHeight-e.height;0>t&&(t=0),e.viewport.scrollV=t},n}(e.FitComponent);e.ConsignmentBuy=t,__reflect(t.prototype,"UI.ConsignmentBuy",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.noWarnSilverCoin=!1,e.remainingTime=new RemainingTime,e.skinName="ConsignmentMineItemSkin",e.needUpdateTime=!1,e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.onAddToStage=function(){},n.prototype.onRemoveFromStage=function(){this.needUpdateTime&&(this.needUpdateTime=!1,SecondTicker.removeEventListener(this.onTimer,this))},n.prototype.onTimer=function(){"itemnormal"==this.currentState&&(this.labelTimeout.text=this.remainingTime.getHourMinuteSecond(),this.remainingTime.delta<=0&&(this.data.state="itemtimeout",this.dataChanged()))},n.prototype.dataChanged=function(){switch(this.currentState=this.data.state,this.currentState){case"lock":this.updateStateLock();break;case"empty":this.updateStateEmpty();break;case"itemnormal":this.updateStateItemNormal();break;case"itemtimeout":this.updateStateItemTimeout()}},n.prototype.updateStateLock=function(){this.labelUnlockPrice.text=this.data.shelfPrice.toString()},n.prototype.updateStateEmpty=function(){},n.prototype.updateStateItemNormal=function(){this.udpateItem(),this.remainingTime.delta=this.data.item.getLeftTime(),this.needUpdateTime||(this.needUpdateTime=!0,SecondTicker.addEventListener(this.onTimer,this))},n.prototype.updateStateItemTimeout=function(){this.udpateItem()},n.prototype.udpateItem=function(){var e=this.data.item.getGenre(),t=this.data.item.getDetailType(),n=this.data.item.getTotalNum(),i=this.data.item.getSoldNum(),a=this.data.item.getPrice();this.data.item.getLeftTime();this.cell.data={type:"item",content:{genre:e,detailType:t}};var r=table.props[e][t];this.labelItemName.text=r.name,this.labelItemName.textColor=Item.QualityColor[r.quality],this.labelTotalNum.text=n.toString(),this.labelSoldNum.text=i.toString(),this.labelPrice.text=a.toString()},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnUnlock:this.ApplyUnLockShelf();break;case this.btnConsign:this.OpenConsign();break;case this.btnCancel:this.ApplyCancel();break;case this.btnReConsign:this.OpenReConsign()}},n.prototype.ApplyUnLockShelf=function(){var t=this;if("lock"==this.currentState){var n=parseInt(this.labelUnlockPrice.text);if(!(0>=n)){var i=PlayerAttribute.currency[Game.Currency.GoldCoin],a=PlayerAttribute.currency[Game.Currency.SilverCoin];if(n>a&&i+a>=n&&!this.noWarnSilverCoin){var r=n-a,o=new e.SliverCoinPrompt;return o.title=lang.String("operation confirm"),o.content=lang.StringWithFormat("if replace {1} silver with gold",r),o.cb=function(e){t.noWarnSilverCoin=e,t.ConfirmBuyShelf(),UIManager.pop(o)},void UIManager.push(o)}return PlayerAttribute.currency[Game.Currency.GoldCoin]+PlayerAttribute.currency[Game.Currency.SilverCoin]<n?void UIManager.pushPage(new e.SilverPromptByCost(n,function(){UIManager.pop(this),PlayerAttribute.currency[Game.Currency.GoldCoin]+PlayerAttribute.currency[Game.Currency.SilverCoin]<n&&UIManager.push(new e.GoldCoinPrompt)})):void this.ConfirmBuyShelf()}}},n.prototype.ConfirmBuyShelf=function(){net.socket.write(2094,null)},n.prototype.OpenConsign=function(){"empty"==this.currentState&&UIManager.pushPage(new e.ConsignmentSell)},n.prototype.ApplyCancel=function(){if("itemnormal"==this.currentState||"itemtimeout"==this.currentState){var e=new net.def.Name;e.name=this.data.item.getKey(),net.socket.write(2099,e.toArrayBuffer())}},n.prototype.OpenReConsign=function(){if("itemtimeout"==this.currentState){var t=new e.ConsignmentQuickSell;t.item=this.data.item,UIManager.pushPage(t)}},n}(eui.ItemRenderer);e.ConsignmentMineItem=t,__reflect(t.prototype,"UI.ConsignmentMineItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="ConsignmentPanelSkin",n.panelBuy=new e.ConsignmentPanelBuy,n.panelSell=new e.ConsignmentPanelSell,n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.onAddToStage=function(){this.tab.selectedIndex=this.selectPage,this.changePage(),this.tab.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this)},n.prototype.onRemoveFromStage=function(){},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:UIManager.pop(this);break;default:return}},n.prototype.onItemTap=function(){var e=this.tab.selectedIndex;this.selectPage!=e&&(this.selectPage=e,this.changePage())},n.prototype.changePage=function(){this.groupPanel.removeChildren(),this.selectPage==Consignment.PAGE_BUY&&this.groupPanel.addChild(this.panelBuy),this.selectPage==Consignment.PAGE_SELL&&this.groupPanel.addChild(this.panelSell)},n}(e.FitComponent);e.ConsignmentPanel=t,__reflect(t.prototype,"UI.ConsignmentPanel",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;n.skinName="ConsignmentPanelBuySkin",n.dataList=new eui.ArrayCollection,n.listItem.dataProvider=n.dataList,n.listItem.itemRenderer=e.ConsignmentSummaryItem,n.selectedValue=-1,n.radios=[],n.radioGroup=new eui.RadioButtonGroup;var i=function(e,t){var i=new eui.RadioButton;i.skinName="RadioTemp2Skin",i.group=n.radioGroup,i.label=t,i.value=e,n.groupBtn.addChild(i),n.radios.push(i),-1==n.selectedValue&&(n.selectedValue=e)};for(var a in Consignment.ConfigWareType){var r=Consignment.ConfigWareType[Number(a)];i(r.typeId,r.name)}return n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.radioGroup.addEventListener(eui.UIEvent.CHANGE,n.radioChangeHandler,n),n}return __extends(n,t),n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.onAddToStage=function(){this.radioGroup.selectedValue=this.selectedValue,this.applyWareType(this.selectedValue),Game.dispatcher.addEventListener(Game.EVENT.ConsignmentSyncTypeWareList,this.upadteTypeWareList,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.ConsignmentSyncTypeWareList,this.upadteTypeWareList,this)},n.prototype.radioChangeHandler=function(){this.applyWareType(this.radioGroup.selectedValue)},n.prototype.applyWareType=function(e){this.selectedValue=e;var t=new net.def.Index;t.index=e,net.socket.write(2092,t.toArrayBuffer())},n.prototype.upadteTypeWareList=function(){this.dataList.replaceAll(Consignment.dataTypeWareList.getList())},n}(e.FitComponent);e.ConsignmentPanelBuy=t,__reflect(t.prototype,"UI.ConsignmentPanelBuy",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="ConsignmentPanelSellSkin",n.dataList=new eui.ArrayCollection,n.list.dataProvider=n.dataList,n.list.itemRenderer=e.ConsignmentMineItem,n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n}return __extends(n,t),n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.onAddToStage=function(){this.ApplySellerInfo(),Game.dispatcher.addEventListener(Game.EVENT.ConsignmentSyncSellerInfo,this.updateItemList,this),Game.dispatcher.addEventListener(Game.EVENT.ConsignmentSyncSellerMoney,this.updateSellerMoney,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.ConsignmentSyncSellerInfo,this.updateItemList,this),Game.dispatcher.removeEventListener(Game.EVENT.ConsignmentSyncSellerMoney,this.updateSellerMoney,this)},n.prototype.updateItemList=function(){for(var e=[],t=this.calcShowShelfNum(),n=Consignment.dataSellerInfo.getList().length,i=0;i!=t;i++)e.push(this.getShelfInfo(i,n));this.dataList.replaceAll(e)},n.prototype.getShelfInfo=function(e,t){var n=e+1,i=Consignment.dataSellerInfo.getShelfNum();if(n>i)return{state:"lock",item:null,shelfPrice:Consignment.GetShelfPrice(e)};if(n>t)return{state:"empty",item:null,shelfPrice:0};var a=Consignment.dataSellerInfo.getList()[e];return a.getLeftTime()<=0?{state:"itemtimeout",item:a,shelfPrice:0}:{state:"itemnormal",item:a,shelfPrice:0}},n.prototype.calcShowShelfNum=function(){var e=Consignment.dataSellerInfo.getShelfNum();return e<Consignment.ConfigShelf.maxNum&&(e+=1),e},n.prototype.updateSellerMoney=function(){this.labelMoney.text=Consignment.dataSellerMoney.toString()},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnFetchMoney:this.ApplyFetchMoney()}},n.prototype.ApplyFetchMoney=function(){net.socket.write(2098,null)},n.prototype.ApplySellerInfo=function(){net.socket.write(2093,null)},n}(e.FitComponent);e.ConsignmentPanelSell=t,__reflect(t.prototype,"UI.ConsignmentPanelSell",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.item=null,t.skinName="ConsignmentQuickSellSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.onAddToStage=function(){this.selectItem.data={item:this.item,genre:0,detailType:0},Game.dispatcher.addEventListener(Game.EVENT.ConsignmentConsign,this.Close,this)},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.ConsignmentConsign,this.Close,this)},t.prototype.Close=function(){UIManager.pop(this)},t}(e.FitComponent);e.ConsignmentQuickSell=t,__reflect(t.prototype,"UI.ConsignmentQuickSell",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.wareInfo=null,e.noWarnSilverCoin=!1,e.skinName="ConsignmentSelectItemComponentSkin",e.bReConsign=!1,e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.onAddToStage=function(){this.labelNum.type=egret.TextFieldType.INPUT,this.labelNum.restrict="0-9",this.labelNum.addEventListener(egret.Event.CHANGE,this.onNumberChange,this),null==this.data&&this.reset()},n.prototype.onRemoveFromStage=function(){this.labelNum.removeEventListener(egret.Event.CHANGE,this.onNumberChange,this),this.wareInfo=null,this.bReConsign=!1},n.prototype.onNumberChange=function(){if(this.IsEmpty())return void Game.ShowNotifyErrorMsg(lang.String("consignment pls select item first"));var e=this.GetHoldItemCount(this.data.genre,this.data.detailType),t=parseInt(this.labelNum.text);isNaN(t)&&(t=1),t=Math.min(t,e),t=Math.max(1,t),this.labelNum.text=t.toString(),this.updateTotalPrice()},n.prototype.reset=function(){this.cell.clearcell(),this.labelItemName.text="",this.labelNum.text="0",this.labelPrice.text="0",this.labelTotalPrice.text="0"},n.prototype.dataChanged=function(){if(null!=this.data){if(null!=this.data.item&&(this.bReConsign=!0,this.data.genre=this.data.item.getGenre(),this.data.detailType=this.data.item.getDetailType()),this.wareInfo=Consignment.GetWareInfo(this.data.genre,this.data.detailType),this.bReConsign){for(var e=this.data.item.getPrice(),t=!1,n=0;n!=this.wareInfo.priceList.length;n++)if(e==this.wareInfo.priceList[n]){t=!0;break}t||this.data.item.setPrice(this.wareInfo.priceList[0])}var i=table.props[this.data.genre][this.data.detailType];if(this.labelItemName.text=i.name,this.labelItemName.textColor=Item.QualityColor[i.quality],this.cell.data={type:"item",content:{genre:this.data.genre,detailType:this.data.detailType}},this.bReConsign)this.labelNum.text=(this.data.item.getTotalNum()-this.data.item.getSoldNum()).toString(),this.labelPrice.text=this.data.item.getPrice().toString();else{var a=PlayerAttribute.GetItemCount(this.data.genre,this.data.detailType),r=a>0?1:0,o=this.wareInfo.priceList[0];this.labelNum.text=r.toString(),this.labelPrice.text=o.toString()}this.updateTotalPrice()}},n.prototype.updateTotalPrice=function(){var e=parseInt(this.labelNum.text),t=parseInt(this.labelPrice.text),n=~~(e*t*.95);this.labelTotalPrice.text=n.toString()},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnConsign:this.Consign();break;case this.btnNumIncrease:this.NumberIncrease();break;case this.btnNumDecrease:this.NumberDecrease();break;case this.btnPriceIncrease:this.PriceIncrease();break;case this.btnPriceDecrease:this.PriceDescrease()}},n.prototype.Consign=function(){var t=this;if(this.IsEmpty())return void Game.ShowNotifyErrorMsg(lang.String("consignment pls select item first"));var n=parseInt(this.labelNum.text);parseInt(this.labelPrice.text);if(0>=n)return void Game.ShowNotifyErrorMsg(lang.String("consignment input wrong number"));var i=PlayerAttribute.currency[Game.Currency.GoldCoin],a=PlayerAttribute.currency[Game.Currency.SilverCoin];if(a<Consignment.ConfigSetting.saleOperationCostValue&&i+a>=Consignment.ConfigSetting.saleOperationCostValue&&!this.noWarnSilverCoin){var r=Consignment.ConfigSetting.saleOperationCostValue-a,o=new e.SliverCoinPrompt;return o.title=lang.String("operation confirm"),o.content=lang.StringWithFormat("if replace {1} silver with gold",r),o.cb=function(e){t.noWarnSilverCoin=e,t.ConfirmConsign(),UIManager.pop(o)},void UIManager.push(o)}return i+a<Consignment.ConfigSetting.saleOperationCostValue?void UIManager.pushPage(new e.SilverPromptByCost(Consignment.ConfigSetting.saleOperationCostValue,function(){UIManager.pop(this),PlayerAttribute.currency[Game.Currency.GoldCoin]+PlayerAttribute.currency[Game.Currency.SilverCoin]<Consignment.ConfigSetting.saleOperationCostValue&&UIManager.push(new e.GoldCoinPrompt)})):void this.ConfirmConsign()},n.prototype.ConfirmConsign=function(){var e=parseInt(this.labelNum.text),t=parseInt(this.labelPrice.text),n=new net.def.ConsignmentItemMine;n.setGenre(this.data.genre),n.setDetailType(this.data.detailType),n.setTotalNum(e),n.setSoldNum(0),n.setPrice(t),n.setLeftTime(0),this.bReConsign?n.setKey(this.data.item.getKey()):n.setKey(""),net.socket.write(2095,n.toArrayBuffer()),Game.dispatcher.dispatchEventWith(Game.EVENT.ConsignmentConsign)},n.prototype.GetHoldItemCount=function(e,t){var n=PlayerAttribute.GetItemCount(this.data.genre,this.data.detailType);return this.bReConsign&&(n+=this.data.item.getTotalNum()-this.data.item.getSoldNum()),n},n.prototype.NumberIncrease=function(){if(this.IsEmpty())return void Game.ShowNotifyErrorMsg(lang.String("consignment pls select item first"));var e=parseInt(this.labelNum.text),t=this.GetHoldItemCount(this.data.genre,this.data.detailType);t>e&&(e+=1),this.labelNum.text=e.toString(),this.updateTotalPrice()},n.prototype.NumberDecrease=function(){if(this.IsEmpty())return void Game.ShowNotifyErrorMsg(lang.String("consignment pls select item first"));var e=parseInt(this.labelNum.text);e>1&&(e-=1),this.labelNum.text=e.toString(),this.updateTotalPrice()},n.prototype.PriceIncrease=function(){if(this.IsEmpty())return void Game.ShowNotifyErrorMsg(lang.String("consignment pls select item first"));for(var e=parseInt(this.labelPrice.text),t=e,n=0;n!=this.wareInfo.priceList.length;n++){var i=this.wareInfo.priceList[n];if(i>e){t=i;break}}this.labelPrice.text=t.toString(),this.updateTotalPrice()},n.prototype.PriceDescrease=function(){if(this.IsEmpty())return void Game.ShowNotifyErrorMsg(lang.String("consignment pls select item first"));for(var e=parseInt(this.labelPrice.text),t=0,n=0;n!=this.wareInfo.priceList.length;n++){var i=this.wareInfo.priceList[n];if(!(e>i))break;t=i}0!=t&&(this.labelPrice.text=t.toString(),this.updateTotalPrice())},n.prototype.IsEmpty=function(){return null==this.data?!0:null==this.data.item&&null==this.data.genre&&null==this.data.detailType?!0:null==this.data.item&&0==this.data.genre&&0==this.data.detailType?!0:!1},n}(eui.ItemRenderer);e.ConsignmentSelectItemComponent=t,__reflect(t.prototype,"UI.ConsignmentSelectItemComponent",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="ConsignmentSellSkin",n.dataList=new eui.ArrayCollection,n.list.itemRenderer=e.AwardCell,n.list.dataProvider=n.dataList,n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,n.onClickItem,n),n}return __extends(n,t),n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.onAddToStage=function(){this.updateWareList(),Game.dispatcher.addEventListener(Game.EVENT.ConsignmentSyncSellerInfo,this.onConsingFinish,this),Game.dispatcher.addEventListener(Game.EVENT.ConsignmentItemChange,this.updateWareList,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.ConsignmentSyncSellerInfo,this.onConsingFinish,this),Game.dispatcher.addEventListener(Game.EVENT.ConsignmentItemChange,this.updateWareList,this)},n.prototype.updateWareList=function(){for(var e=[],t=Consignment.GetBagWareList(),n=0;n!=t.length;n++){var i=t[n],a=i[0],r=i[1],o=i[2];o>0&&e.push({type:"item",forbidTip:!0,content:{genre:a,detailType:r,count:o}})}var s=5-e.length;if(s>0)for(var n=0;n!=s;n++)e.push(null);this.dataList.replaceAll(e)},n.prototype.onClickItem=function(e){var t=e.itemRenderer;return null==t.data?void this.selectItem.reset():void(this.selectItem.data={item:null,genre:t.data.content.genre,detailType:t.data.content.detailType})},n.prototype.onConsingFinish=function(){Consignment.GetFreeShelfNum()>0?this.resetSelectItem():UIManager.pop(this)},n.prototype.resetSelectItem=function(){this.selectItem.data=null,this.selectItem.reset()},n}(e.FitComponent);e.ConsignmentSell=t,__reflect(t.prototype,"UI.ConsignmentSell",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="ConsignmentSpecificItemSkin",t}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.dataChanged=function(){this.imgSelect.visible=this.data.select;var e=this.data.item.getGenre(),t=this.data.item.getDetailType(),n=this.data.item.getTotalNum(),i=this.data.item.getPrice();this.cell.data={type:"item",content:{genre:e,detailType:t}};var a=table.props[e][t];this.labelName.text=a.name,this.labelName.textColor=Item.QualityColor[a.quality],this.labelTotalNum.text=n.toString(),this.labelPrice.text=i.toString()},t}(eui.ItemRenderer);e.ConsignmentSpecificItem=t,__reflect(t.prototype,"UI.ConsignmentSpecificItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="ConsignmentSummaryItemSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnSelect:this.ApplySpecificItemList()}},n.prototype.ApplySpecificItemList=function(){var t=new net.def.IndexList;t.indexs.push(this.data.getGenre()),t.indexs.push(this.data.getDetailType()),net.socket.write(2096,t.toArrayBuffer());var n=new e.ConsignmentBuy;n.SetSpecificItemGD(this.data.getGenre(),this.data.getDetailType()),UIManager.pushPage(n)},n.prototype.dataChanged=function(){var e=this.data.getGenre(),t=this.data.getDetailType(),n=this.data.getTotalNum();this.cell.data={type:"item",content:{genre:e,detailType:t}};var i=table.props[e][t];this.labelItemName.text=i.name,this.labelItemName.textColor=Item.QualityColor[i.quality],this.labelLeftNum.text=n.toString()},n}(eui.ItemRenderer);e.ConsignmentSummaryItem=t,__reflect(t.prototype,"UI.ConsignmentSummaryItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="CrossServerBossEntranceSkin",e.onDataChanged=MakeDelayExecute(e.onRefreshAll,e,Game.Second),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.list.dataProvider=new eui.ArrayCollection(CrossServer.bossConfig),e}return __extends(n,t),n.prototype.onTouchTap=function(t){switch(t.target){case this.imgClose:UIManager.pop(this);break;case this.btnRules:var n=new e.Rule;n.skinName="CrossServerBossInfo",UIManager.pushPage(n)}},n.prototype.close=function(){UIManager.pop(this)},n.prototype.onAddToStage=function(){this.onDataChanged(),Game.dispatcher.addEventListener(Game.EVENT.LevelUp,this.onRefresh,this),Game.dispatcher.addEventListener(Game.EVENT.CrossServerBossStatusChanged,this.onDataChanged,this),Game.dispatcher.addEventListener(Game.EVENT.SyncCrossServerBossStatus,this.onRefresh,this),net.socket.write(239,null)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.LevelUp,this.onRefresh,this),Game.dispatcher.removeEventListener(Game.EVENT.CrossServerBossStatusChanged,this.onDataChanged,this),Game.dispatcher.removeEventListener(Game.EVENT.SyncCrossServerBossStatus,this.onRefresh,this),this.onDataChanged.stop()},n.prototype.onRefresh=function(){var e=this.list.dataProvider;null!=e&&e.refresh()},n.prototype.onRefreshTime=function(){for(var e=Game.getServerDate(),t=e.getHours(),n=e.getMinutes(),i=Reminder.events[Reminder.EventName.CrossServerBoss],a=i.timeLine,r=0;r<a.length;r++){if(t<a[r].hour)return void(this.labelNextTime.text=lang.StringWithFormat("tipNextWarTime",a[r].hour+":"+a[r].minute));if(t==a[r].hour){if(n<a[r].minute)return void(this.labelNextTime.text=lang.StringWithFormat("tipNextWarTime",a[r].hour+":"+a[r].minute));if(n>=a[r].minute&&n<a[r].minute+i.duration/Game.Minute)return void(r<CrossServer.leftJoinCounts.length&&(this.labelNextTime.text=lang.Format("Số lần tham gia BOSS Liên Server{1}",CrossServer.leftJoinCounts[r])))}}this.labelNextTime.text=lang.StringWithFormat("tipNextWarTime",""+lang.String("tommorow")+a[0].hour+":"+a[0].minute)},n.prototype.onRefreshAll=function(){this.onRefreshTime(),this.onRefresh()},n}(e.FitComponent);e.CrossServerBossEntrance=t,__reflect(t.prototype,"UI.CrossServerBossEntrance",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="CrossServerBossItemSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.dataChanged=function(){if(this.txtLevel=lang.StringWithFormat("level:{1}",this.data.level),this.btnEnter.enabled=PlayerAttribute.Level>=this.data.needLevel&&!!Player.instance.guildName&&CrossServer.bossStatue,this.labelNeedLevel.text=lang.StringWithFormat("{1}level",this.data.needLevel),PlayerAttribute.Level>=this.data.needLevel)if(this.labelNeedLevel.textColor=color.GREEN,CrossServer.bossStatue)switch(this.data.status){case CrossServer.BossStatusType.Close:this.btnEnter.label=lang.String("not start"),this.btnEnter.enabled=!1;break;case CrossServer.BossStatusType.Open:this.btnEnter.label=lang.String("tiao zhan"),this.btnEnter.enabled=!0;break;case CrossServer.BossStatusType.Finish:this.btnEnter.label=lang.String("knockback"),this.btnEnter.enabled=!1}else this.btnEnter.label=lang.String("knockback"),this.btnEnter.enabled=!1;else this.labelNeedLevel.textColor=color.RED,this.btnEnter.label=lang.String("tiao zhan"),this.btnEnter.enabled=!1},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnEnter:CrossServer.bossEnter(this.data.mapId);break;case this.btnAwardTips:UIManager.push(new e.AwardsRulePanel("Thưởng Khiêu Chiến",this.data.awardsRule))}},n}(eui.ItemRenderer);e.CrossServerBossItem=t,__reflect(t.prototype,"UI.CrossServerBossItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="CrossServerBossResultSkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.dataFinalAward=new eui.ArrayCollection,n.finalAwards.itemRenderer=e.AwardCell,n.finalAwards.dataProvider=n.dataFinalAward,n}return __extends(n,t),n.prototype.close=function(){UIManager.pop(this)},n.prototype.onAddToStage=function(){this.finalAwards.visible=this.dataFinalAward.length>0},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},n.prototype.updateRankListData=function(e,t){this.ranks=e,this.list.dataProvider=new eui.ArrayCollection(this.ranks);for(var n=Player.instance.guildName,i=0;i<e.length;i++){var a=e[i].name;a==n&&(this.myRank=e[i].rank,this.myScroe=e[i].damage,this.myName=n)}t?this.awardTips="Thưởng Hạng Bang đã đưa vào Đấu Giá Bang\nThưởng Hạng Cá Nhân được gửi qua Thư.":this.awardTips="Hãy nhận thưởng cá nhân qua Thư"},n.prototype.ShowFinalAward=function(e){this.finalAwards.visible=!0;for(var t=new Array,n=0;n!=e.length;n++){var i=table.parseAward(e[n]);t[n]=i}this.dataFinalAward.replaceAll(t)},n}(e.FitComponent);e.CrossServerBossResult=t,__reflect(t.prototype,"UI.CrossServerBossResult",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.timeRest="12:21",e.loaded=!1,e.bgRes="ui/bigBg/publicBossMap_0.jpg",e.remainingTime=new RemainingTime,e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.OnTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.OnAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.OnRemoveFromStage,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.loaded=!0,this.memberList.itemRenderer=e.UIDungeonGroupMember},n.prototype.Refresh=function(){var t=DungeonGroup.dungeonInfo[DungeonGroup.groupType];this.DungeonTitle=t.name,this.bgRes=t.bg,this.awardList.dataProvider=new eui.ArrayCollection(t.awardView),this.memberList.dataProvider=new eui.ArrayCollection(DungeonGroup.PlayerList);for(var n=0,i=0;i<DungeonGroup.PlayerList.length;i++)n=DungeonGroup.PlayerList[i].fp+n;this.realFP=n.toString(),e.UIDungeonGroup.instance.OnChangeLeader()},n.prototype.OnChangeLeader=function(){DungeonGroup.leadreIndex==DungeonGroup.myIndex?this.btnGO.visible=!0:this.btnGO.visible=!1},n.prototype.OnAddToStage=function(){this.recoFP=DungeonGroup.dungeonInfo[DungeonGroup.groupType].recommendFp.toString(),SecondTicker.addEventListener(this.onTimer,this)},n.prototype.OnRemoveFromStage=function(){SecondTicker.removeEventListener(this.onTimer,this)},n.prototype.Try2LeaveGroup=function(){var t=this,n=!1;if(DungeonGroup.leadreIndex==DungeonGroup.myIndex&&DungeonGroup.PlayerList)for(var i=0;i<DungeonGroup.PlayerList.length;i++)if(i!=DungeonGroup.myIndex&&null!=DungeonGroup.PlayerList[i]&&!DungeonGroup.PlayerList[i].empty){n=!0;break}n?e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],"Rời Đội","Đội trưởng rời Đội, Đội sẽ bị giải tán, rời đội?",function(){return UIManager.pop(t),net.socket.write(2105,null),!0},null,null):(UIManager.pop(this),net.socket.write(2105,null))},n.prototype.OnTouchTap=function(e){switch(e.target){case this.btnGO:net.socket.write(2109,null);break;case this.btnClose:this.Try2LeaveGroup()}},n.prototype.onTimer=function(){this.remainingTime.delta<=0&&DungeonGroup.leadreIndex==DungeonGroup.myIndex&&(UIManager.pop(this),net.socket.write(2105,null)),this.timeRest=this.remainingTime.getMinuteSecond()},Object.defineProperty(n.prototype,"second",{set:function(e){this.remainingTime.delta=e,this.onTimer()},enumerable:!0,configurable:!0}),n}(e.FitComponent);e.UIDungeonGroup=t,__reflect(t.prototype,"UI.UIDungeonGroup",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.cbFilter=[],e.filterSnapShot=[!0,!0,!0],e.addEventListener(egret.Event.ADDED_TO_STAGE,e.OnAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.OnRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=e.UIDungeonGroupBeInvitedItem,this.cbFilter.push(this.cbWorld),this.cbFilter.push(this.cbGuild),this.cbFilter.push(this.cbFriend)},n.prototype.OnAddToStage=function(){this.list.dataProvider=DungeonGroup.finalInviteInfo,this.cbWorld.selected=DungeonGroup.filter[0],this.cbGuild.selected=DungeonGroup.filter[1],this.cbFriend.selected=DungeonGroup.filter[2],this.filterSnapShot[0]=DungeonGroup.filter[0],this.filterSnapShot[1]=DungeonGroup.filter[1],this.filterSnapShot[2]=DungeonGroup.filter[2]},n.prototype.OnRemoveFromStage=function(){if(this.filterSnapShot[2]=!0,DungeonGroup.filter[2]=!0,this.filterSnapShot[0]!=DungeonGroup.filter[0]||this.filterSnapShot[1]!=DungeonGroup.filter[1]||this.filterSnapShot[2]!=DungeonGroup.filter[2]){var e=JSON.stringify(DungeonGroup.filter);egret.localStorage.setItem("dungeonGroupMsgFilter",e)}},n.prototype.UpdateFilter=function(e){DungeonGroup.filter[e]=!DungeonGroup.filter[e],this.cbFilter[e].selected=DungeonGroup.filter[e],DungeonGroup.UpdateInviteFilter()},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close();break;case this.cbWorld:this.UpdateFilter(0);break;case this.cbGuild:this.UpdateFilter(1);break;case this.cbFriend:this.UpdateFilter(2);break;case this.btnRemoveAll:DungeonGroup.RemoveAllSelectedInvite()
}},n.prototype.close=function(){UIManager.pop(this)},n}(e.FitComponent);e.UIDungeonGroupBeInvited=t,__reflect(t.prototype,"UI.UIDungeonGroupBeInvited",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.endTime=Game.getServerDate().getTime()+36e5,e.timeRest="12:21",e.remainingTime=new RemainingTime,e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.TouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.OnAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.RemoveFromStage,e),e}return __extends(n,t),n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},n.prototype.OnAddToStage=function(){SecondTicker.addEventListener(this.onTimer,this),null!=this.data&&this.updateSecond()},n.prototype.RemoveFromStage=function(){SecondTicker.removeEventListener(this.onTimer,this)},n.prototype.onTimer=function(){this.timeRest=this.remainingTime.getMinuteSecond()},n.prototype.updateSecond=function(){var e=this.data.endTime-Math.floor(Game.getServerDate().getTime()/1e3);this.remainingTime.delta=e,this.onTimer()},n.prototype.TouchTap=function(t){switch(t.target){case this.btnAccpet:if(!DungeonGroup.JoinGroup(this.data.groupID,this.data.groupType))break;UIManager.pop(e.UIDungeonGroupBeInvited.instance);case this.btnIgnore:DungeonGroup.RemoveInviteItemByID(this.data.idx)}},n.prototype.dataChanged=function(){this.endTime=this.data.endTime,this.updateSecond();var e=DungeonGroup.dungeonInfo[this.data.groupType],t=e.needItemOwner;switch(DungeonGroup.leadreIndex!=DungeonGroup.myIndex&&(t=e.needItemGuest),this.needList.dataProvider=new eui.ArrayCollection(t),this.data.from){case 0:this.labelFrom.textColor=color.YELLOW,this.labelFrom.text=lang.String("dgroup from world");break;case 1:this.labelFrom.textColor=color.BLUE,this.labelFrom.text=lang.String("dgroup from guild");break;case 2:this.labelFrom.textColor=color.GREEN,this.labelFrom.text=lang.String("dgroup from friend")}},n}(eui.ItemRenderer);e.UIDungeonGroupBeInvitedItem=t,__reflect(t.prototype,"UI.UIDungeonGroupBeInvitedItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.cdTime="12:21",e.remainingTime=new RemainingTime,e.inviteSign={},e.lastReqDataSec=0,e.loaded=!1,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.OnAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.OnRemoveFromStage,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.loaded=!0,this.invList.itemRenderer=e.UIDungeonGroupInviteItem,this.cbList=[],this.cbList.push(this.cbWorld),this.cbList.push(this.cbGuild),this.cbList.push(this.cbAll),this.selectAll=!1},n.prototype.SelectAll=function(){this.selectAll=!this.selectAll,1==this.selectAll?Game.dispatcher.dispatchEventWith(Game.EVENT.DGroupInviteSelectAll):Game.dispatcher.dispatchEventWith(Game.EVENT.DGroupInviteUnSelectAll)},n.prototype.OnAddToStage=function(){this.lastReqDataSec+2>Game.countOpenSeconds()?this.OnDataArrive():(this.lastReqDataSec=Game.countOpenSeconds(),net.socket.write(2107,null));var e=Game.getServerDate().getTime(),t=egret.localStorage.getItem("dungeonGroup_LastInviteTimeMap");this.inviteSign=JSON.parse(t),this.inviteSign=null==this.inviteSign?{}:this.inviteSign;var n=null!=this.inviteSign[Player.instance.Name]?this.inviteSign[Player.instance.Name]:0;this.second=n+60*Game.Second-e,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.OnTouchTap,this),SecondTicker.addEventListener(this.onTimer,this),1==this.loaded&&(this.cbAll.selected=!1,this.selectAll=!1)},n.prototype.OnDataArrive=function(){this.invList.dataProvider=new eui.ArrayCollection(DungeonGroup.inviteList),DungeonGroup.inviteList.length>0?this.cbAll.enabled=!0:this.cbAll.enabled=!1,Guild.guildInfo?this.cbGuild.enabled=!0:this.cbGuild.enabled=!1},n.prototype.OnRemoveFromStage=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.OnTouchTap,this),SecondTicker.removeEventListener(this.onTimer,this)},n.prototype.Invite=function(){var e=new net.def.C2SDGroupInvite,t=!1;e.bGlbMsg=this.cbWorld.selected,e.bGuildMsg=this.cbGuild.selected;for(var n=0;n<this.invList.dataProvider.length;n++){var i=this.invList.dataProvider.getItemAt(n);1==i.selected&&(t=!0,e.uuid.push(i.uuid))}t=t||e.bGlbMsg||e.bGuildMsg,t?(this.inviteSign[Player.instance.Name]=Game.getServerDate().getTime(),egret.localStorage.setItem("dungeonGroup_LastInviteTimeMap",JSON.stringify(this.inviteSign)),net.socket.write(2108,e.toArrayBuffer()),UIManager.pop(this)):PopUpMessage.push(lang.String("dgroup choose invite player"),color.RED)},n.prototype.onTimer=function(){this.remainingTime.delta<=0?this.btnInvite.enabled=!0:this.btnInvite.enabled=!1,this.cdTime=this.remainingTime.getMinuteSecond()},Object.defineProperty(n.prototype,"second",{set:function(e){this.remainingTime.delta=e/Game.Second,this.onTimer()},enumerable:!0,configurable:!0}),n.prototype.OnTouchTap=function(e){switch(e.target){case this.cbAll:this.SelectAll();break;case this.imgClose:case this.btnClose:UIManager.pop(this);break;case this.btnInvite:this.Invite()}},n}(e.FitComponent);e.UIDungeonGroupInvite=t,__reflect(t.prototype,"UI.UIDungeonGroupInvite",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.OnTouch,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.OnAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.OnRemoveFromStage,t),t}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.OnAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.DGroupInviteSelectAll,this.select,this),Game.dispatcher.addEventListener(Game.EVENT.DGroupInviteUnSelectAll,this.unselect,this)},t.prototype.OnRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.DGroupInviteSelectAll,this.select,this),Game.dispatcher.removeEventListener(Game.EVENT.DGroupInviteUnSelectAll,this.unselect,this)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.dataChanged=function(){this.facIcon=table.faction[this.data.faction].logo,this.roleImg=table.faction[this.data.faction].portrait,this.UpdateSelect()},t.prototype.UpdateSelect=function(){1==this.data.selected?this.cbSelect.selected=!0:this.cbSelect.selected=!1},t.prototype.select=function(){this.data.selected=!0,this.UpdateSelect()},t.prototype.unselect=function(){this.data.selected=!1,this.UpdateSelect()},t.prototype.changeSelect=function(e){this.data.selected=!this.data.selected,this.UpdateSelect()},t.prototype.OnTouch=function(){this.changeSelect()},t}(eui.ItemRenderer);e.UIDungeonGroupInviteItem=t,__reflect(t.prototype,"UI.UIDungeonGroupInviteItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.roleDbOffset=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,5],[-15,0],[0,0],[0,0],[5,25],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],e.addEventListener(egret.Event.ADDED_TO_STAGE,e.OnAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.OnRemoveFromStage,e),e}return __extends(n,t),n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},n.prototype.OnAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.OnDungeonGroupChangeLeader,this.OnChangeLeader,this),this.groupInvite.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTapInvite,this)},n.prototype.OnRemoveFromStage=function(){this.groupInvite.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTapInvite,this)},n.prototype.OnChangeLeader=function(){DungeonGroup.leadreIndex==this.data.idx?this.imgLeader.visible=!0:this.imgLeader.visible=!1},n.prototype.dataChanged=function(){if(1==this.data.empty)this.currentState="empty";else{this.currentState="full",this.animation.mask=this.imgMask,this.animation.x=this.animation.x+this.roleDbOffset[this.data.faction][0],this.animation.y=this.animation.y+this.roleDbOffset[this.data.faction][1],this.animation.updateSpeed(.5),this.animation.load(table.faction[this.data.faction].animation,"st"),this.facIcon=table.faction[this.data.faction].logo,this.vipIcon=Vip.getVipIcon(this.data.viplevel),this.strLv="Lv:"+this.data.level.toString(),this.strFp="LC:"+this.data.fp.toString(),this.rolebg=table.faction[this.data.faction].bg;var e=DungeonGroup.dungeonInfo[DungeonGroup.groupType].needItemOwner;DungeonGroup.leadreIndex!=this.data.idx&&(e=DungeonGroup.dungeonInfo[DungeonGroup.groupType].needItemGuest),this.needItem.data=e[0],this.need=e[0].content.count,this.has=this.data.ticketNum[0],this.OnChangeLeader()}},n.prototype.onTouchTapInvite=function(t){UIManager.push(e.UIDungeonGroupInvite.instance)},n}(eui.ItemRenderer);e.UIDungeonGroupMember=t,__reflect(t.prototype,"UI.UIDungeonGroupMember")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.OnAddToStage,e),e.LoadChallengeData(),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.tabbar.selectedIndex=0,this.tabbar.addEventListener(egret.TouchEvent.TOUCH_TAP,this.ChangeDifficult,this),this.list.itemRenderer=e.UIGroupDungeonPageItem},n.prototype.LoadChallengeData=function(){var e=DungeonGroup.GetDungeonGroupInfo(DungeonGroup.DungeonType.DungeonTypeNormal),t=DungeonGroup.GetDungeonGroupInfo(DungeonGroup.DungeonType.DungeonTypeHard);this.normalChallenge=new eui.ArrayCollection(e),this.eliteChallenge=new eui.ArrayCollection(t)},n.prototype.UpdateData=function(){for(var e=[{name:"Khiêu chiến thường",key:"QingyiScene"},{name:"Khiêu chiến Anh Hùng",key:"QingyiHeroScene"}],t=[],n=0;n<e.length;n++)WorldLine.IsOpen(e[n].key)&&t.push(e[n]);this.tabbar.dataProvider=new eui.ArrayCollection(t),0==this.tabbar.selectedIndex?this.list.dataProvider=this.normalChallenge:1==this.tabbar.selectedIndex&&(this.list.dataProvider=this.eliteChallenge),this.scoller.viewport.scrollV=0},n.prototype.OnAddToStage=function(){this.UpdateData()},n.prototype.ChangeDifficult=function(e){this.UpdateData()},n}(e.FitComponent);e.UIGroupDungeonPage=t,__reflect(t.prototype,"UI.UIGroupDungeonPage",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.loaded=!1,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.OnAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.OnRemoveFromStage,t),t}return __extends(t,e),t.prototype.OnAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.OnUpdateFp,this.OnUpdate,this),Game.dispatcher.addEventListener(Game.EVENT.LevelUp,this.OnUpdate,this),this.OnUpdate()},t.prototype.OnRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.OnUpdateFp,this.OnUpdate,this),Game.dispatcher.removeEventListener(Game.EVENT.LevelUp,this.OnUpdate,this)},t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.loaded=!0,this.btnGo.addEventListener(egret.TouchEvent.TOUCH_TAP,this.Go,this)},t.prototype.OnUpdate=function(){null!=this.data&&this.loaded&&(this.lableNeedFp.text=this.data.needFp.toString(),this.labelNeedLv.text=this.data.needLv.toString(),this.labelNeedQy.text=PartnerQingyi.ConfigLevelList[this.data.qingyiGroup.need].name,this.lableNeedFp.textColor=PlayerAttribute.fp>=this.data.needFp?color.GREEN:color.RED,this.labelNeedLv.textColor=PlayerAttribute.Level>=this.data.needLv?color.GREEN:color.RED,this.labelNeedQy.textColor=PartnerQingyi.GetMyDataGroupLevel(this.data.qingyiGroup.id)>=this.data.qingyiGroup.need?color.GREEN:color.RED)},t.prototype.dataChanged=function(){this.OnUpdate(),this.awardList.dataProvider=new eui.ArrayCollection(this.data.awardView),this.needList.dataProvider=new eui.ArrayCollection(this.data.needItemOwner)},t.prototype.Go=function(){DungeonGroup.Try2CreateGroup(this.data.groupType)},t}(eui.ItemRenderer);e.UIGroupDungeonPageItem=t,__reflect(t.prototype,"UI.UIGroupDungeonPageItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="UIGroupMemberInDungeonSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},n.prototype.dataChanged=function(){this.captainflag.visible=this.data.bCaptain,this.lifeBar.maximum=this.data.maxLife,this.lifeBar.value=this.data.life,this.data.online?this.iconUI.imgHead=table.faction[this.data.faction].portrait:this.iconUI.imgHead=table.faction[this.data.faction].offlinePortrait},n.prototype.onTouchTap=function(e){switch(e.target){case this.iconUI:this.showMemberMenu()}},n.prototype.showMemberMenu=function(){if(null==YanEmperor.teamMenu){YanEmperor.teamMenu=new e.YanEmperorTeamMenu;var t=this.data.name;this.iconUI.localToGlobal(0,0);YanEmperor.teamMenu.x=this.x+this.iconUI.width/2,YanEmperor.teamMenu.y=this.y+this.iconUI.height/2,YanEmperor.teamMenu.playerName=t,YanEmperor.teamMenu.playerFaction=this.data.faction;var n=[];Player.instance.Name==t?n.push({label:"Rời đội",action:"quitTeam"}):(n.push({label:"Mật",action:"chat"}),friend.checkByName(t)||n.push({label:"Thêm Hảo Hữu",action:"addFriend"})),YanEmperor.teamMenu.buttons=n,this.parent.addChild(YanEmperor.teamMenu)}},n}(eui.ItemRenderer);e.UIGroupMemberInDungeon=t,__reflect(t.prototype,"UI.UIGroupMemberInDungeon",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.onTouchTap=function(e){switch(e.target){case this.btnInvite:this.onInvite()}},t.prototype.onInvite=function(){},t}(eui.ItemRenderer);e.DungeonAssistItem=t,__reflect(t.prototype,"UI.DungeonAssistItem")}(UI||(UI={}));var UI;!function(e){function t(){return null==e.dungeonHallUI&&(e.dungeonHallUI=new a),e.dungeonHallUI}function n(){null==e.dungeonHallUI&&(e.dungeonHallUI=new a),UIManager.pushPage(e.dungeonHallUI)}function i(){null!=e.dungeonHallUI&&(DungeonHallMgr.ApplyQuitRoom(),UIManager.pop(e.dungeonHallUI))}e.getDungeonHall=t,e.openDungeonHall=n,e.closeDungeonHall=i;var a=function(t){function n(){var n=t.call(this)||this;return n.changeTargetTime=0,n.changeTargetCD=300,n.refreshTeamListTime=0,n.refreshTeamListCD=2e3,n.skinName="DungeonHallSkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.memberList.dataProvider=DungeonHallMgr.dataMemberList,n.memberList.itemRenderer=e.MyTeamList,n}return __extends(n,t),n.prototype.onAddToStage=function(){guide.addEventListener(guide.GuideOperation.GuideCatchThief,this.onGuideReminder,this),guide.addEventListener(guide.GuideOperation.GuideFengLingDu,this.onGuideReminder,this),guide.completed()||this.playGuideMovie(guide.info.operation),this.stateTime=0,SecondTicker.addEventListener(this.onTimer,this)},n.prototype.onRemoveFromStage=function(){guide.removeEventListener(guide.GuideOperation.GuideCatchThief,this.onGuideReminder,this),guide.removeEventListener(guide.GuideOperation.GuideFengLingDu,this.onGuideReminder,this),SecondTicker.removeEventListener(this.onTimer,this)},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnExit:this.onLeave();break;case this.btnRules:this.showRule()}},n.prototype.close=function(){DungeonHallMgr.ApplyQuitRoom(),UIManager.pop(this)},n.prototype.showRule=function(){var t;switch(DungeonHallMgr.curTarget){case 1:t=new e.Rule,t.skinName="CatchThiefInfoSkin",UIManager.pushPage(t);break;case 2:t=new e.Rule,t.skinName="FenglingRuleSkin",UIManager.pushPage(t)}},n.prototype.onLeave=function(){DungeonHallMgr.ApplyQuitRoom()},n.prototype.HideAllCond=function(){this.condtype1.visible=!1,this.condtype2.visible=!1,this.condvalue1.visible=!1,this.condvalue2.visible=!1},n.prototype.SetCond=function(e,t,n){t!=DungeonHallMgr.CondType_InWildMap&&(1==e&&(this.condtype1.visible=!0,this.condvalue1.visible=!0,this.condtype1.text=lang.String(DungeonHallMgr.CondType[t]),this.condvalue1.text=String(n)),2==e&&(this.condtype2.visible=!0,this.condvalue2.visible=!0,this.condtype2.text=lang.String(DungeonHallMgr.CondType[t]),this.condvalue2.text=String(n)))},n.prototype.onGuideReminder=function(){var e=this;this.visible&&guide.pushMovie({weight:3,handle:function(){e.playGuideMovie(guide.info.operation)}})},n.prototype.playGuideMovie=function(e){switch(e){case guide.GuideOperation.GuideCatchThief:case guide.GuideOperation.GuideFengLingDu:break;default:return}},n.prototype.OnStateChange=function(e){var t="";switch(e){case DungeonHallMgr.DungeonRoom_State_Idle:if(t=lang.String("dungeon state desc idle"),this.stateDesc.text==t&&""!=this.stateDesc.text)return;this.stateDesc.text=t;break;case DungeonHallMgr.DungeonRoom_State_WaitFriend:if(t=lang.String("dungeon state desc wait"),this.stateDesc.text==t&&""!=this.stateDesc.text)return;this.stateDesc.text=t;break;case DungeonHallMgr.DungeonRoom_State_Opening:if(t=lang.String("dungeon state desc open"),this.stateDesc.text==t&&""!=this.stateDesc.text)return;this.stateDesc.text=t;break;default:return this.stateDesc.visible=!1,void(this.stateLeftTime.visible=!1)}this.stateDesc.visible=!0,this.stateLeftTime.visible=!0,this.stateTime=0,this.stateLeftTime.text=this.getMinuteSecond(this.stateTime)},n.prototype.onTimer=function(){this.updateStateTime()},n.prototype.getMinuteSecond=function(e){var t=Math.floor(e/60),n=Math.floor(e%60);return NumberFormat(t,2)+":"+NumberFormat(n,2)},n.prototype.updateStateTime=function(){this.stateLeftTime.text=this.getMinuteSecond(++this.stateTime)},n}(e.FitComponent);e.DungeonHall=a,__reflect(a.prototype,"UI.DungeonHall",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="DungeonInviteSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.SyncFriends,DungeonHallMgr.updateDataInviteFriend,null)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.SyncFriends,DungeonHallMgr.updateDataInviteFriend,null)},n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.friendList.itemRenderer=e.MemberList,this.friendList.dataProvider=DungeonHallMgr.dataInviteFriend},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},n.prototype.close=function(){UIManager.pop(this)},n}(e.FitComponent);e.DungeonInvite=t,__reflect(t.prototype,"UI.DungeonInvite",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.awarddatas=[],t.skinName="FenglingResultSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.onAddToStage=function(){this.awarddatas.length>0&&(this.list.dataProvider=new eui.ArrayCollection(this.awarddatas))},t.prototype.onRemoveFromStage=function(){this.awarddatas=[]},t.prototype.setAwardlist=function(e,t,n,i){this.awarddatas=[],e>0&&this.awarddatas.push({type:"goldCoin",content:e}),t>0&&this.awarddatas.push({type:"copperCoin",content:t}),n>0&&this.awarddatas.push({type:"exp",content:n}),i>0&&this.awarddatas.push({type:"readingCoin",content:i})},t.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:default:this.close()}},t.prototype.close=function(){UIManager.pop(this)},t}(e.FitComponent);e.FenglingResult=t,__reflect(t.prototype,"UI.FenglingResult",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.onTouchTap=function(e){switch(e.target){case this.imgAddMember:this.onAddMember();break;case this.imgHead:this.showMemberMenu()}},n.prototype.showMemberMenu=function(){if(null==e.teamMenu&&"assist"!=this.currentState&&"babelmember"!=this.currentState){e.teamMenu=new e.TeamMenu;var t=this.data.name,n=this.imgHead.localToGlobal(0,0);e.teamMenu.x=n.x+this.imgHead.width/2,e.teamMenu.y=n.y+this.imgHead.height/2,e.teamMenu.playerName=t,e.teamMenu.playerFaction=this.data.faction,e.teamMenu.assistId=0,Player.instance.Name==t?e.teamMenu.currentState="self":e.teamMenu.currentState="member",UIManager.pushPage(e.teamMenu)}},n.prototype.onAddMember=function(){switch(this.currentState){case"wllsempty":WulinLiansai.ApplyInviteFriend();break;case"babelempty":Babel.ShowInviteList();break;default:DungeonHallMgr.ShowDungeonInvite()}},n.prototype.dataChanged=function(){this.currentState=this.data.state,"assist"==this.currentState?this.showAssistData():this.showPlayerData()},n.prototype.showAssistData=function(){var e=this.data.faction;this.txtFaction=table.faction[e].name,this.portrait=table.faction[e].portrait,this.captainflag.visible=!1},n.prototype.showPlayerData=function(){var e=this.data.faction;this.txtFaction=table.faction[e].name,this.captainflag.visible=this.data.bMaster,this.data.online?this.portrait=table.faction[e].portrait:this.portrait=table.faction[e].offlinePortrait},n}(eui.ItemRenderer);e.MyTeamList=t,__reflect(t.prototype,"UI.MyTeamList")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="AssistItemSkin",t.addEventListener(eui.UIEvent.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.btnEmploy.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onEmploy,this)},t.prototype.onEmploy=function(){var e=this.data.callback;null!=e&&e(this.data)},t.prototype.dataChanged=function(){this.priceLabel.visible=null!=this.data&&null!=this.data.price,this.btnEmploy.enabled=PlayerAttribute.currency[Game.Currency.CopperCoin]>=this.data.price},t.prototype.onAddToStage=function(){null!=this.data&&null!=this.data.price&&(this.btnEmploy.enabled=PlayerAttribute.currency[Game.Currency.CopperCoin]>=this.data.price)},t}(eui.ItemRenderer);e.AssistItem=t,__reflect(t.prototype,"UI.AssistItem")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="AssistListSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.open=function(e){return null==this._instance&&(this._instance=new n),this._instance.callback=e,UIManager.pushPage(this._instance),friend.refreshFriends(),this._instance},n.prototype.childrenCreated=function(){var n=this;t.prototype.childrenCreated.call(this);for(var i=table.encounter.mercenary,a=[],r=i.length,o=table.npcs,s=function(e){var t=n.callback;null!=t&&(UIManager.pop(n),n.callback=null,t(e))},l=0;r>l;l++){var u=i[l],c=o[u.id];a.push({id:l+1,name:c.name,fp:Encounter.fp,level:Encounter.level,price:u.price,icon:u.icon,callback:s})}r=friend.friendData.length;for(var l=0;r>l;l++){var h=friend.friendData[l];a.push({id:0,name:h.name,fp:h.fp,level:h.level,uuid:h.uuid,icon:h.icon,callback:s})}this.list.itemRenderer=e.AssistItem,this.list.dataProvider=new eui.ArrayCollection(a)},n.prototype.close=function(){UIManager.pop(this),this.callback=null},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},n}(e.FitComponent);e.AssistList=t,__reflect(t.prototype,"UI.AssistList",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.onTouchTap=function(t){var n=this;switch(t.target){case this.btnGo:this.onTapGo();break;case this.btnInvite:if(null==this.data.npc)return;e.AssistList.open(function(e){n.assist=e})}},n.prototype.dataChanged=function(){switch(this.award1.visible=!1,this.data.award.type){case"item":this.award1.data=this.data.award,this.award1.visible=!0,this.btnGo.skinName="ButtonTemp4Skin",this.labelName.textFlow=Game.HtmlTextParser.parse(this.data.name+"\n"+lang.String("encounter award box"));break;case"list":this.labelName.textFlow=Game.HtmlTextParser.parse(lang.String("outside man")+"\n"+("<font color='"+egret.toColorString(color.Title1_Value)+"'>"+this.data.name+"</font>")),this.btnGo.skinName="ButtonTemp2Skin",this.data.award.content.length>1&&(this.award1.data=this.data.award.content[1],this.award1.visible=!0)}null!=this.btnInvite&&(this.btnInvite.visible=null!=this.data.npc)},n.prototype.onTapGo=function(){if(null!=this.assist&&null!=this.assist.price&&PlayerAttribute.currency[Game.Currency.CopperCoin]<this.assist.price)return void PopUpMessage.push(lang.String("not enough copperCoin"),color.RED);var t=new net.def.C2SSelectEncounter;t.id=this.data.id,null==this.assist?t.assist=0:(t.assist=this.assist.id,0==this.assist.id&&(t.friend=this.assist.uuid)),net.socket.write(150,t.toArrayBuffer()),this.assist=null,null!=this.data.npc&&(e.closeOfflineHandle(),e.HUD.instance.showBattle())},n}(eui.ItemRenderer);e.EncounterItem=t,__reflect(t.prototype,"UI.EncounterItem")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="EncountersResultSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=e.AwardCell,null!=this.awards&&null==this.list.dataProvider&&(this.list.dataProvider=new eui.ArrayCollection(this.awards))},n.prototype.onTouchTap=function(e){switch(e.target){default:UIManager.pop(this)}},n.prototype.close=function(){UIManager.pop(this),null!=this.onReturn&&(this.onReturn(),this.onReturn=null)},n}(e.FitComponent);e.EncountersResult=t,__reflect(t.prototype,"UI.EncountersResult",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(){function e(){this.selectedItem={data:null}}return e}();__reflect(t.prototype,"EquipMakingParts");var n=function(){function e(){this.icon="",this.count="",this.color=0}return e}();__reflect(n.prototype,"EquipMakingCostItem");var i=function(){function e(){this.items=new Array;for(var t=0;t<e.total;t++)this.items[t]=new n}return Object.defineProperty(e.prototype,"item1",{get:function(){return this.items[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"item2",{get:function(){return this.items[1]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"item3",{get:function(){return this.items[2]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"item4",{get:function(){return this.items[3]},enumerable:!0,configurable:!0}),e.prototype.setIcon=function(e,t){this.items[e].icon=t},e.prototype.setCount=function(e,t){this.items[e].count=t},e.prototype.setColor=function(e,t){this.items[e].color=t},e.total=4,e}();__reflect(i.prototype,"EquipMakingCosts");var a=function(n){function a(){var e=n.call(this)||this;e.txtEquipName="",e.equipFp=0,e.selectedPart=0,e.nBtnMakeXpos=0,e.showing=!1,e.skinName="EquipMakingSkin",e.imgCosts=[],e.imgCosts.push(e.imgCost1),e.imgCosts.push(e.imgCost2),e.imgCosts.push(e.imgCost3),e.imgCosts.push(e.imgCost4),e.btnpart0.selected=!0,e.btnparts=[],e.btnparts.push(e.btnpart0),e.btnparts.push(e.btnpart1),e.btnparts.push(e.btnpart2),e.btnparts.push(e.btnpart3),e.btnparts.push(e.btnpart4),e.btnparts.push(e.btnpart5),e.btnparts.push(e.btnpart6),e.btnparts.push(e.btnpart7),e.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,e.onBarItemTap,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.equip=new t,e.cost=new i,e.unlockedEquips={};for(var a=[{name:"Trang bị",key:1},{name:"Bộ",key:EquipmentSet.GetNameListData().length}],r=[],o=0;o<a.length;o++)0!=a[o].key&&r.push(a[o]);return e.tabbar.dataProvider=new eui.ArrayCollection(r),e}return __extends(a,n),a.open=function(e){if(null==e&&(e=0),1==e){if(PlayerAttribute.Level<EquipmentSetMaker.level)return void PopUpMessage.push(lang.StringWithFormat("open on level {1}",EquipmentSetMaker.level),color.Warning);if(0==EquipmentSet.GetNameListData().length)return void PopUpMessage.push(lang.String("not open yet!"),color.Warning)}return null==this._instance&&(this._instance=new a),this._instance.page=e,UIManager.pushPage(this._instance),this._instance},a.prototype.close=function(){UIManager.pop(this)},a.SetEquipLevel=function(e){this._instance.selectEquipLevel=e,this._instance.equipLevel="Cấp trang bị : "+table.guildEquipbuildHouse.equipLimitName[e],this._instance.updateEquipList(),this._instance.updateSelectedInfo()},a.onMakeResult=function(e,t){e&&(this._instance.updateSelectedInfo(),this._instance.showResult(t))},a.IsVisiable=function(){return null!=this._instance&&this._instance.showing},a.prototype.onAddToStage=function(){this.showing=!0,Game.dispatcher.addEventListener(Game.EVENT.AddItem,this.updateSelectedInfo,this),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,this.updateSelectedInfo,this),Game.dispatcher.addEventListener(Game.EVENT.RemoveItem,this.updateSelectedInfo,this),Game.dispatcher.addEventListener(Game.EVENT.SyncGuildInfo,this.onHouseLevelUp,this),Game.dispatcher.addEventListener(Game.EVENT.CurrencyChange[Game.Currency.GuildContribution],this.updateSelectedInfo,this),Game.dispatcher.addEventListener(Game.EVENT.BagItemChange,this.close,this),0==this.nBtnMakeXpos&&(this.nBtnMakeXpos=this.btnMake.x);var e=10*Math.floor(PlayerAttribute.Level/10)+1,t=Math.min(Guild.equipBuildLevel,table.guildEquipbuildHouse.equipLimit.length);if(null==this.selectEquipLevel)for(var n=t-1;n>=0;n--)if(e>table.guildEquipbuildHouse.equipLimit[n]){this.selectEquipLevel=n;break}null==this.selectEquipLevel&&(this.selectEquipLevel=0),this.selectEquipLevel>t-1&&(this.selectEquipLevel=t-1),this.updateEquipList(),this.updateSelectedInfo(),this.equipLevel="Cấp trang bị : "+table.guildEquipbuildHouse.equipLimitName[this.selectEquipLevel],this.onHouseLevelUp(),this.tabbar.selectedIndex=this.page},a.prototype.onRemoveFromStage=function(){this.showing=!1,Game.dispatcher.removeEventListener(Game.EVENT.AddItem,this.updateSelectedInfo,this),Game.dispatcher.removeEventListener(Game.EVENT.UpdateItem,this.updateSelectedInfo,this),Game.dispatcher.removeEventListener(Game.EVENT.RemoveItem,this.updateSelectedInfo,this),Game.dispatcher.removeEventListener(Game.EVENT.SyncGuildInfo,this.onHouseLevelUp,this),Game.dispatcher.removeEventListener(Game.EVENT.CurrencyChange[Game.Currency.GuildContribution],this.updateSelectedInfo,this),Game.dispatcher.removeEventListener(Game.EVENT.BagItemChange,this.close,this)
},a.prototype.onBarItemTap=function(e){var t=e.itemIndex;return 1==t&&PlayerAttribute.Level<EquipmentSetMaker.level?(PopUpMessage.push(lang.StringWithFormat("open on level {1}",EquipmentSetMaker.level),color.Warning),void(this.tabbar.selectedIndex=this.page)):void(this.page=t)},a.prototype.onHouseLevelUp=function(){this.houseLevel=Guild.equipBuildLevel+"/"+table.guildEquipbuildHouse.levelLimit[Guild.guildInfo.level-1];for(var e="",t=0;t<table.guildEquipbuildHouse.equipLimit.length;t++)Guild.equipBuildLevel>t&&(e=table.guildEquipbuildHouse.equipLimitName[t]);this.equipMaxLevel="Trang bị cấp cao nhất được chế tạo: "+e},a.prototype.updateEquipList=function(){for(var e=Game.Faction[PlayerAttribute.faction],t=new Array,n=0;n<Game.EquipPart.EquipCount;n++){for(var i=n,a=table.equipMakeConfig.equips[i],r=-1,o=a[this.selectEquipLevel].rates.length-1;o>=0;o--)if(a[this.selectEquipLevel].rates[o]>0){r=o;break}if(r>0){var s=table.equips[i][a[this.selectEquipLevel].equipId];t.push({id:s.id,level:s.level,part:i,icon:s[e].icon,quality:r,enhancement:null,qualityMovieEnabled:!1,redRate:a[this.selectEquipLevel].rates[r],fp:a[this.selectEquipLevel].fp}),this.unlockedEquips[n]=a[this.selectEquipLevel]}else t.push({id:0,level:0,part:i,icon:"ui/skill/book_0.png",quality:null,enhancement:null,qualityMovieEnabled:!1,redRate:0,fp:0}),this.unlockedEquips[n]=null}this.equipData=t},a.prototype.updateSelectedInfo=function(){this.btnMake.enabled=!1;for(var e=0;4>e;e++)this.cost.setIcon(e,"ui/skill/book_0.png"),this.cost.setCount(e,"");this.qualityProp1.text="",this.qualityProp2.text="",this.qualityProp3.text="";var t=PlayerAttribute.bag;if(this.selectedPart>=0&&null!=this.unlockedEquips[this.selectedPart]){var n=table.equipMakeConfig.costs[this.selectedPart][this.selectEquipLevel],a=n.materials,r=a.length,o=!0,s=PlayerAttribute.Equips[this.selectedPart];null!=s?(this.curEquipCell.data={type:"equipInstance",content:s},this.equipTips=lang.String("selected equip"),this.lblEquipName.textFlow=Game.HtmlTextParser.parse(s.Name),this.curEquipLevel=lang.StringWithFormat("{1}level",s.Level)):(this.curEquipCell.data=null,this.equipTips=lang.String("not Mounted"),this.lblEquipName.text="",this.curEquipLevel="");for(var e=0;r>e;e++){var l=a[e].genre,u=a[e].detailType,c=table.props[l][u].source,h=a[e].count;this.cost.setIcon(e,c);var d=Math.min(t.CalcCount(l,u),999);this.cost.setCount(e,d+"/"+h),d>=h?this.cost.setColor(e,color.GREEN):(this.cost.setColor(e,color.RED),o=!1)}if(r<i.total){var p=n.guildContribution;this.cost.setIcon(r,"ui/guild/guild_gongxian.png");var g=Math.min(PlayerAttribute.currency[Game.Currency.GuildContribution],999);this.cost.setCount(r,g+"/"+p),p>g?(this.cost.setColor(r,color.RED),o=!1):this.cost.setColor(r,color.GREEN)}this.btnMake.enabled=o;var m=this.equipData[this.selectedPart];this.previewIcon=m.icon,this.equip.selectedItem.data={id:m.id,level:m.level,part:m.part,icon:m.icon,quality:m.quality,enhancement:null,qualityMovieEnabled:!0,fp:m.fp};var f=(table.getEquipBaseAttr(m.quality,m.level,m.part),Game.Faction[PlayerAttribute.faction]);this.txtEquipName=table.equips[this.selectedPart][m.id][f].name;var v=table.equips[this.selectedPart][m.id].level;this.txtEquipLevel=lang.StringWithFormat("level:{1}",v),v-=v%10;lang.StringWithFormat("equip level suit",v);this.equipFp=m.fp;for(var y=["Xác suất TB ngẫu nhiên: ","Xác suất T.Bị Lục: ","Xác suất T.Bị Lam: ","Xác suất T.Bị Tím: ","Xác suất TB Cam: ","Xác suất T.Bị Đỏ: "],b=[color.WHITE,color.GREEN,color.BLUE,color.PURPLE,color.YELLOW,color.ORANGE],S=[],E=[],C=table.equipMakeConfig.equips[this.selectedPart][this.selectEquipLevel].rates,T=0,e=0;6>e;e++)T+=C[e];for(var e=0;6>e;e++)C[e]>0&&(S.push(""+y[e]+Math.floor(100*C[e]/T)+"%"),E.push(b[e]));S.length>0&&(this.qualityProp1.text=S[0],this.qualityProp1.textColor=E[0]),S.length>1&&(this.qualityProp2.text=S[1],this.qualityProp2.textColor=E[1]),S.length>2&&(this.qualityProp3.text=S[2],this.qualityProp3.textColor=E[2])}else this.equip.selectedItem.data={id:0,level:1,part:0,icon:"ui/skill/book_0.png",quality:null,enhancement:null},this.previewIcon="ui/common/lock1.png",this.txtEquipName="",this.txtEquipLevel="",this.equipFp=0,this.curEquipCell.data=null,this.equipTips=lang.String("not Mounted"),this.lblEquipName.text="",this.curEquipLevel=""},a.prototype.onTouchTap=function(t){switch(t.target){case this.btnEquipLevel:e.EquipMakingChoose.open(this.selectEquipLevel);break;case this.btnHouseLevel:e.EquipMakingLevel.open();break;case this.btnGainRes:e.ResourceObtain.Open([e.ObtResId.equipMaking]);break;case this.btnGainResmap:e.ResourceObtain.Open([e.ObtResId.equipMakingmap]);break;case this.imgClose:this.close();break;case this.btnMake:this.onBtnMakeClick(!1);break;case this.btnRule:var n=new e.Rule;n.skinName="GuildRulesSkin",n.currentState="makeRule",UIManager.pushPage(n);break;case this.btnpart0:this.selectedPart=0,this.updateSelectedInfo();break;case this.btnpart1:this.selectedPart=1,this.updateSelectedInfo();break;case this.btnpart2:this.selectedPart=2,this.updateSelectedInfo();break;case this.btnpart3:this.selectedPart=3,this.updateSelectedInfo();break;case this.btnpart4:this.selectedPart=4,this.updateSelectedInfo();break;case this.btnpart5:this.selectedPart=5,this.updateSelectedInfo();break;case this.btnpart6:this.selectedPart=6,this.updateSelectedInfo();break;case this.btnpart7:this.selectedPart=7,this.updateSelectedInfo();break;default:if(t.target instanceof e.EquipCell){var i=t.target.data.part;if(i==this.selectedPart)return;this.selectedPart=i,this.updateSelectedInfo()}else for(var a=this.imgCosts.length,r=0;a>r;r++)if(t.target==this.imgCosts[r])return void this.onShowCostItemTip(r)}},a.prototype.onShowCostItemTip=function(t){if(this.selectedPart>=0&&null!=this.unlockedEquips[this.selectedPart]){var n=table.equipMakeConfig.costs[this.selectedPart][this.selectEquipLevel].materials;if(t<n.length){var i={type:"item",content:{genre:n[t].genre,detailType:n[t].detailType,count:n[t].count}},a=e.ItemTips.instance;a.data=i,UIManager.push(e.ItemTips.instance)}else t==n.length&&e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],"Cống hiến","Tham gia hoạt động bang, nhận cống hiến bang",null,null,null)}},a.prototype.showResult=function(t){if(0!=t){var n=PlayerAttribute.bag.GetBagItem(t);if(null!=n&&n.Item instanceof Item.Equip){var i=n.Item,a=new e.EquipMakingResult(!0);a.desc=i.Name,a.data=i,UIManager.pushPage(a)}}},a.prototype.onBtnMakeClick=function(e){var t=this.equip.selectedItem.data;null!=t&&t.id>0&&this.onConfirmMake(t.part,this.selectEquipLevel,!1,0)},a.prototype.onConfirmMake=function(e,t,n,i){return i>0&&i>PlayerAttribute.currency[Game.Currency.GoldCoin]?(PopUpMessage.push(lang.String("not enough goldcoin"),color.RED),!0):(EquipMake.requestMake(e,t,n),!0)},a}(e.FitComponent);e.EquipMaking=a,__reflect(a.prototype,"UI.EquipMaking",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.selectIndex=0,e.skinName="EquipMakingChooseSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),n.open=function(e){return null==this._instance&&(this._instance=new n),this._instance.selectIndex=e,UIManager.pushPage(this._instance),this._instance},n.prototype.close=function(){e.EquipMaking.SetEquipLevel(this.selectIndex),UIManager.pop(this)},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.SyncGuildInfo,this.onDataChanged,this),this.list.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectList,this),this.onDataChanged(),this.list.selectedIndex=this.selectIndex,this.scroller.viewport.scrollV=0},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.SyncGuildInfo,this.onDataChanged,this)},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},n.prototype.onSelectList=function(){this.selectIndex!=this.list.selectedIndex&&(this.selectIndex=this.list.selectedIndex)},n.prototype.onDataChanged=function(){this.data=[];for(var t=0;t<table.guildEquipbuildHouse.equipLimit.length;t++)Guild.equipBuildLevel>t&&this.data.push({name:table.guildEquipbuildHouse.equipLimitName[t],selected:t==this.selectIndex});this.list.itemRenderer=e.EquipMakingChooseItem,this.list.dataProvider=new eui.ArrayCollection(this.data)},n}(e.FitComponent);e.EquipMakingChoose=t,__reflect(t.prototype,"UI.EquipMakingChoose",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.dataChanged=function(){this.labelDisplay.text=this.data.name,this.data.selected},t}(eui.ItemRenderer);e.EquipMakingChooseItem=t,__reflect(t.prototype,"UI.EquipMakingChooseItem")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="EquipMakingLevelSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.open=function(){return t.close(),null==this._instance&&(this._instance=new t),UIManager.pushPage(this._instance),this._instance},t.close=function(){null!=this._instance&&Game.removeFromParent.apply(this._instance)},t.prototype.onAddToStage=function(){this.dataChanged(),Game.dispatcher.addEventListener(Game.EVENT.SyncGuildInfo,this.dataChanged,this)},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.SyncGuildInfo,this.dataChanged,this)},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnBack:t.close();break;case this.btnUpgrade:net.socket.write(2017,null)}},t.prototype.dataChanged=function(){this.houseLevel="Lv"+Guild.equipBuildLevel,this.maxLevel="Lv"+table.guildEquipbuildHouse.levelLimit[Guild.guildInfo.level-1],Guild.equipBuildLevel<table.guildEquipbuildHouse.cost.length?(this.costFund=""+table.guildEquipbuildHouse.cost[Guild.equipBuildLevel],this.btnUpgrade.enabled=!0):(this.costFund="0",this.btnUpgrade.enabled=!1),this.haveFund=""+Guild.fund},t}(e.FitComponent);e.EquipMakingLevel=t,__reflect(t.prototype,"UI.EquipMakingLevel",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(n){var i=t.call(this)||this;return i.desc="",i.skinName="EquipMakingResultSkin",i.addEventListener(egret.TouchEvent.TOUCH_TAP,i.onTouchTap,i),i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),n&&(i.mc=new e.MovieClipComponent,i.mc.source="skill/Ui_book/Ui_book.json",i.mc.name="Ui_book",i.mc.horizontalCenter="0",i.mc.verticalCenter="0"),i.showEffect(),i}return __extends(n,t),n.prototype.onTouchTap=function(t){switch(t.target){case this.imgClose:UIManager.pop(this);break;case this.equip:for(var n=this.data,i=PlayerGem.GetMaxSocket(n.Level),a=new Array(i),r=0;i>r;r++)a[r]=0;e.EquipTips.open("other",n,0,a,PlayerAttribute.Equips,0)}},n.prototype.onAddToStage=function(){this.refresh()},n.prototype.refresh=function(){if(null!=this.data){var e=this.data;this.equip.data={quality:e.Quality,icon:e.Icon,rbcorner:lang.StringWithFormat("{1}level",e.Level)},this.data;var t=e.Quality;this.mcRedEquipEffect.visible=5==t}null!=this.itemName&&null!=this.desc&&(this.itemName.textFlow=Game.HtmlTextParser.parse(this.desc))},n.prototype.showEffect=function(){null!=this.mc&&(this.getChildIndex(this.mc)<0&&this.addChild(this.mc),this.mc.gotoAndPlay(0,1))},n}(e.FitComponent);e.EquipMakingResult=t,__reflect(t.prototype,"UI.EquipMakingResult",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.dataChanged=function(){this.labelDisplay.text=this.data.label,this.labelDisplay.textColor=Item.QualityColor[this.data.quality]},t}(eui.ItemRenderer);e.EquipSetMakeNameItem=t,__reflect(t.prototype,"UI.EquipSetMakeNameItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.equipsPart={},e.skinName="EquipSetMakingSkin",e.setNameList.addEventListener(eui.ItemTapEvent.ITEM_TAP,e.onSetNameChange,e),e.equipsArray=new eui.ArrayCollection([]),e.equipsList.dataProvider=e.equipsArray,e.materialArray=new eui.ArrayCollection([]),e.materialList.dataProvider=e.materialArray,e.equipsList.addEventListener(eui.ItemTapEvent.ITEM_TAP,e.onTouchEquipsList,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToState,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.onAddToState=function(){this.setNameList.dataProvider=new eui.ArrayCollection(EquipmentSet.GetNameListData()),this.setNameList.selectedIndex=0,this.onSetNameChange(),Game.dispatcher.addEventListener(Game.EVENT.AddItem,this.onUpdateEquipList,this),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,this.onUpdateEquipList,this),Game.dispatcher.addEventListener(Game.EVENT.RemoveItem,this.onUpdateEquipList,this),Game.dispatcher.addEventListener(Game.EVENT.EquipsChange,this.onSetNameChange,this),Game.dispatcher.addEventListener(Game.EVENT.BagEquipChanged,this.onUpdateEquipList,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.AddItem,this.onUpdateEquipList,this),Game.dispatcher.removeEventListener(Game.EVENT.UpdateItem,this.onUpdateEquipList,this),Game.dispatcher.removeEventListener(Game.EVENT.RemoveItem,this.onUpdateEquipList,this),Game.dispatcher.removeEventListener(Game.EVENT.EquipsChange,this.onSetNameChange,this),Game.dispatcher.removeEventListener(Game.EVENT.BagEquipChanged,this.onUpdateEquipList,this)},n.prototype.onSetNameChange=function(){var e=this.setNameList.selectedItem;if(null!=e){this.setId=e.value;for(var t=EquipmentSet.infos[this.setId],n=0;n<Game.EquipPart.EquipCount;n++){var i=this.equipSetGroup.getChildAt(n);i.selected=!1,i.enabled=!1,i.icon="ui/common1/suo_0.png",this.equipsPart[n]=null}for(var a=t.equips,r=0,o=0,s=t.attributes;o<s.length;o++){var l=s[o];r+=l.fp}this.setFP.textFlow=Game.HtmlTextParser.parse(StringWithFormat("Lực Chiến Bộ: {1}","<font color="+color.Title1_Value+">"+r+"</font>"));for(var u,n=0;n<a.length;n++){var c=a[n].part;this.equipsPart[c]=a[n].id;var i=this.equipSetGroup.getChildAt(c);if(i.enabled=!0,null!=PlayerAttribute.Equips[c]&&PlayerAttribute.Equips[c].Id==a[n].id)i.icon=PlayerAttribute.Equips[c].Icon;else{var h=Item.EquipFormatPart[c];i.icon="icon/equip/"+h+".png"}}for(var n=0;n<this.equipSetGroup.numChildren;n++){var i=this.equipSetGroup.getChildAt(n);if(i.enabled){i.selected=!0,u=n;break}}this.refreshTag(),this.onPartChange(u)}},n.prototype.onUpdateEquipList=function(){null!=this.selectedPart&&(this.refreshTag(),this.onPartChange(this.selectedPart))},n.prototype.onPartChange=function(e){"string"==typeof e&&(e=parseInt(e)),this.scroller.viewport.scrollV=0,this.selectedPart=e;var t=this.equipsPart[e];if(null==t)return void(this.equipId=null);this.equipId=t;var n=Game.Faction[PlayerAttribute.faction],i=EquipmentSet.infos[this.setId],a=table.equips[e][t];this.cell.data={quality:i.quality,icon:a[n].icon,name:a[n].name,type:"clientitem",desc:EquipmentSetMaker.setting[e][t].product.desc},this.equipName.text=a[n].name,this.equipName.textColor=Item.QualityColor[i.quality],this.BaseDesc.textFlow=Game.HtmlTextParser.parse(this.getBaseDesc(e,t,a.level)),this.setAttributeDesc.textFlow=Game.HtmlTextParser.parse(EquipmentSet.GetDesc(e,t,PlayerAttribute.faction)),this.FPDesc.textFlow=Game.HtmlTextParser.parse(this.getFPDesc());var r=EquipmentSetMaker.findEquips(e,t),o=[];r.wear&&o.push({icon:r.wear.Icon,quality:r.wear.Quality,rbcorner:lang.StringWithFormat("{1}level",r.wear.Level),plugin:"icon/equip_tips/tips_1.png",bagId:0,equip:r.wear});for(var s=0;s<r.list.length;s++)o.push({icon:r.list[s].Icon,quality:r.list[s].Quality,rbcorner:lang.StringWithFormat("{1}level",r.list[s].Level),plugin:null,bagId:r.list[s].BagId,equip:r.list[s]});this.equipsArray.replaceAll(o),o.length>0?this.equipsList.selectedIndex=0:this.equipsList.selectedIndex=-1,this.onMaterialChage()},n.prototype.onMaterialChage=function(){if(this.equipsList.selectedIndex<0)return this.materialArray.replaceAll([]),this.tips="Bạn không có trang bị dự bị\n\n"+EquipmentSetMaker.setting[this.selectedPart][this.equipId].product.desc||"",this.FPDesc.textFlow=Game.HtmlTextParser.parse(this.getFPDesc()),this.btnMake.enabled=!1,void(this.equipShowCell.visible=!1);this.tips="",this.btnMake.enabled=!0,this.equipShowCell.visible=!0;var e=this.equipsList.selectedItem.equip;this.equipShowCell.data={type:"equipInstance",content:e},this.FPDesc.textFlow=Game.HtmlTextParser.parse(this.getFPDesc(e));for(var t=EquipmentSetMaker.equips[this.selectedPart][this.equipId][e.Id][e.Klass],n=EquipmentSetMaker.setting[this.selectedPart][this.equipId].formula[t].items,i=EquipmentSetMaker.setting[this.selectedPart][this.equipId].formula[t].coin,a=[],r=0;r<n.length;r++)a.push({type:"item",content:n[r].content,obtainId:n[r].obtainId});null!=i&&a.push({type:i.type,content:i.content}),this.materialArray.replaceAll(a)},n.prototype.onTouchEquipsList=function(){this.onMaterialChage()},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnMake:if(0==this.checkMaterial(!0))return;var n=this.equipsList.selectedItem,i=EquipmentSetMaker.equips[this.selectedPart][this.equipId][n.equip.Id][n.equip.Klass];EquipmentSetMaker.make(EquipmentSetMaker.setting[this.selectedPart][this.equipId].formula[i].id,this.selectedPart,n.bagId);break;case this.btnpart0:this.onPartChange(this.btnpart0.value);break;case this.btnpart1:this.onPartChange(this.btnpart1.value);break;case this.btnpart2:this.onPartChange(this.btnpart2.value);break;case this.btnpart3:this.onPartChange(this.btnpart3.value);break;case this.btnpart4:this.onPartChange(this.btnpart4.value);break;case this.btnpart5:this.onPartChange(this.btnpart5.value);break;case this.btnpart6:this.onPartChange(this.btnpart6.value);break;case this.btnpart7:this.onPartChange(this.btnpart7.value);break;case this.cell:var a=e.ItemTips.instance;a.data=this.cell.data,UIManager.push(a)}},n.prototype.checkMaterial=function(t){var n=table.equips[this.selectedPart][this.equipId];if(PlayerAttribute.Level<n.level)return t&&PopUpMessage.push("Trang bị không phù hợp cấp mang, không thể chế tạo!",color.Warning),!1;if(this.equipsList.selectedIndex<0)return t&&PopUpMessage.push("Hãy chọn 1 món trang bị làm nguyên liệu chính!",color.Warning),!1;for(var i=this.equipsList.selectedItem.equip,a=EquipmentSetMaker.equips[this.selectedPart][this.equipId][i.Id][i.Klass],r=EquipmentSetMaker.setting[this.selectedPart][this.equipId].formula[a].items,o=0;o<r.length;o++){var s=r[o].content.genre,l=r[o].content.detailType,u=PlayerAttribute.bag.CalcCount(s,l);if(u<r[o].content.count)return t&&(null!=r[o].obtainId&&e.ResourceObtain.Open([r[o].obtainId]),PopUpMessage.push(StringWithFormat("Thiếu: {1}",r[o].name),color.Warning)),!1}return!0},n.prototype.getBaseDesc=function(e,t,n){var i=color.Title1_Value,a=[],r=EquipmentSetMaker.setting[e][t],o=r.product.baseAttribute;return a.push(lang.String("Part")+"<font color="+i+">"+lang.String(Game.EquipPart[e])+"</font>"),n<=PlayerAttribute.Level?a.push(lang.String("levelTitle")+"<font color="+i+">"+n+"</font>"):a.push(lang.String("levelTitle")+"<font color="+color.Warning+">"+n+"</font>"),a.push(table.getAttrDesc(o)),a.join("\n")},n.prototype.getFPDesc=function(e){if(!e)return lang.String("equipRank")+"<font color="+color.Title1_Value+">????</font>";var t=EquipmentSetMaker.setting[this.selectedPart][this.equipId],n=t.product.baseAttribute,i=int(n.life*FightingPower.Life)||0;i+=n.attack*FightingPower.Attack||0,i+=n.defense*FightingPower.Defense||0;for(var a=0;a<e.LightAttributes.length;a++){var r=e.LightAttributes[a];i+=Buff.GetFightingPower(r.id,r.values)}return lang.String("equipRank")+"<font color="+color.Title1_Value+">"+i+"</font>"},n.prototype.refreshTag=function(){for(var e=egret.createMap(),t=EquipmentSet.infos[this.setId].equips,n=EquipmentSet.infos[this.setId].quality,i=0;i<t.length;i++){var a=t[i].part,r=t[i].id;if(!e[a])if(null==PlayerAttribute.Equips[a]||PlayerAttribute.Equips[a].Id!=r){var o=PlayerAttribute.bag.findEquip(a,r,n);o.length>0&&(e[a]=!0)}else e[a]=!0}for(var i=0;i<this.tagGroup.numChildren;i++){var s=this.tagGroup.getChildAt(i);e[i]?s.source="ui/common1/buff_2.png":s.source="ui/common1/buff_1.png"}},n}(eui.Component);e.EquipSetMaking=t,__reflect(t.prototype,"UI.EquipSetMaking",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="FourSymbolBuyOverTimeSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),n.prototype.onAddToStage=function(){var e=StringWithFormat("Muốn tốn <font color='#ffffff'>{1}</font> KNB Khóa tăng <font color='#ffffff'>{2}</font> giây.\nSố lần còn: <font color='#ffffff'>{3}/{4}</font>",Foursymbols.setting.overtimeCost,Foursymbols.setting.overtime,Foursymbols.setting.overtimeCount-Foursymbols.overtimeCount,Foursymbols.setting.overtimeCount);this.content.textFlow=Game.HtmlTextParser.parse(e),this.onTimer(),SecondTicker.addEventListener(this.onTimer,this)},n.prototype.onRemoveFromStage=function(){SecondTicker.removeEventListener(this.onTimer,this)},n.prototype.onTimer=function(){this.timer-=1;var e=StringWithFormat("<font color='#539E58'>Còn </font>({1})",this.timer);this.restTime.textFlow=Game.HtmlTextParser.parse(e),this.timer<=0&&this.close()},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnCancel:Foursymbols.skip(),this.close();break;case this.btnOK:if(!this.onOk())return;this.close()}},n.prototype.onOk=function(){if(Foursymbols.setting.overtimeCount<=Foursymbols.overtimeCount)return PopUpMessage.push("Số lần không đủ",color.RED),!1;var t=Foursymbols.setting.overtimeCost,n=PlayerAttribute.currency[Game.Currency.SilverCoin],i=PlayerAttribute.currency[Game.Currency.GoldCoin];if(t>n){if(i+n>=t){if(Foursymbols.noWarnBuyOvertimeCost)return Foursymbols.buyOvertime(),!0;var a=new e.SliverCoinPrompt;return a.title=lang.String("operation confirm"),a.content=lang.StringWithFormat("if replace {1} silver with gold",t-n),a.cb=function(e){Foursymbols.buyOvertime(),UIManager.pop(a),Foursymbols.noWarnBuyOvertimeCost=e},UIManager.push(a),!0}return PopUpMessage.push(lang.String("not enough anyCoin"),color.RED),!1}return Foursymbols.buyOvertime(),!0},n}(e.FitComponent);e.FourSymbolBuyOverTime=t,__reflect(t.prototype,"UI.FourSymbolBuyOverTime",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="FoursymbolsAwardUISkin",t.restTime=5,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.close=function(){UIManager.pop(this)},t.prototype.onAddToStage=function(){this.onTimer(),SecondTicker.addEventListener(this.onTimer,this)},t.prototype.onRemoveFromStage=function(){SecondTicker.removeEventListener(this.onTimer,this)},t.prototype.onTimer=function(){this.restTime--,this.tips=StringWithFormat("{1} giây sau tự đóng",this.restTime),this.restTime<=0&&this.close()},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnClose:this.close(),this.restTime>1&&Foursymbols.skip()}},t.prototype.updateAwards=function(e){this.list.dataProvider=new eui.ArrayCollection(table.parseAwards(e))},t}(e.FitComponent);e.FourSymbolsAwardUI=t,__reflect(t.prototype,"UI.FourSymbolsAwardUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;t.skinName="FourSymbolsBuyTimesUI",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t);var n=table.props[Foursymbols.setting.item.genre][Foursymbols.setting.item.detailType];return t.cell.data={type:"item",content:{genre:Foursymbols.setting.item.genre,detailType:Foursymbols.setting.item.detailType},obtainId:Foursymbols.setting.item.obtainId},t.itemName.textFlow=Game.HtmlTextParser.parse("<font color="+Item.QualityColor[n.quality]+">"+n.name+"</font>"),t}return __extends(t,e),t.open=function(){null==this.instance&&(this.instance=new t),UIManager.pushPage(this.instance)},t.prototype.onAddToStage=function(){this.boxNumer=1,this.myCount=PlayerAttribute.bag.CalcCount(Foursymbols.setting.item.genre,Foursymbols.setting.item.detailType),this.updateItemCount(),this.updateTimes(),Game.dispatcher.addEventListener(Game.EVENT.FoursymbolsSyncTask,this.updateTimes,this),Game.dispatcher.addEventListener(Game.EVENT.AddItem,this.updateItem,this),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,this.updateItem,this)},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.FoursymbolsSyncTask,this.updateTimes,this),Game.dispatcher.removeEventListener(Game.EVENT.AddItem,this.updateItem,this),Game.dispatcher.removeEventListener(Game.EVENT.UpdateItem,this.updateItem,this)},t.prototype.updateItem=function(e){if(null!=e&&null!=e.data){var t=e.data.Item;t.Type==Foursymbols.setting.item.genre&&t.DetailType==Foursymbols.setting.item.detailType&&(this.myCount=PlayerAttribute.bag.CalcCount(Foursymbols.setting.item.genre,Foursymbols.setting.item.detailType),this.updateItemCount())}},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnMinus:this.boxNumer-=1;break;case this.btnMinus10:this.boxNumer-=10;break;case this.btnPlus:this.boxNumer+=1;break;case this.btnPlus10:this.boxNumer+=10;break;case this.btnChange:return void(Foursymbols.buy(this.boxNumer)&&this.close())}this.boxNumer<1&&(this.boxNumer=1),Foursymbols.buyTimes>0&&this.boxNumer>Foursymbols.buyTimes&&(this.boxNumer=Foursymbols.buyTimes),this.updateItemCount()},t.prototype.updateItemCount=function(){this.needCount=this.boxNumer*Foursymbols.setting.item.count,this.myCount>=this.needCount?this.lbMyCount.textColor=color.GREEN:this.lbMyCount.textColor=color.RED,this.updateBtnState()},t.prototype.updateBtnState=function(){this.boxNumer<=Foursymbols.buyTimes?this.btnChange.enabled=!0:this.btnChange.enabled=!1},t.prototype.updateTimes=function(){this.lbTimes.text=""+Foursymbols.buyTimes,Foursymbols.buyTimes<=0?this.lbTimes.textColor=color.RED:this.lbTimes.textColor=color.WHITE},t}(e.FitComponent);e.FourSymbolsBuyTimesUI=t,__reflect(t.prototype,"UI.FourSymbolsBuyTimesUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;n.txtColor=16777215,n.radioGroup=new eui.RadioButtonGroup,n.skinName="FourSymbolsEntranceSkin";var i=Foursymbols.maxPalace;n.radios=[];var a=function(t,a){for(var r=t;a>=r;r++){var o=Foursymbols.palaces[r],s=new e.FourSymbolsPalaceItem(n.radioGroup,o.name,o.id);s.enabled=i>=r-1,n.palaceGroup.addChild(s),n.radios.push(s)}},r=function(e){var t=new eui.Label;t.text=e,t.fontFamily="Tahoma",t.textAlign=egret.HorizontalAlign.CENTER,t.size=14,t.height=34,t.verticalAlign="middle",t.textColor=8486782,n.palaceGroup.addChild(t)};return r("Xuân Cung"),a(1,6),r("Hạ Cung"),a(7,12),r("Thu Cung"),a(13,18),r("Đông Cung"),a(19,24),n.radioGroup.addEventListener(eui.UIEvent.CHANGE,n.radioChangeHandler,n),n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.scrollVMax=1408,n}return __extends(n,t),n.open=function(){null==this.instance&&(this.instance=new n),UIManager.pushPage(this.instance)},n.prototype.onAddToStage=function(){var e=Foursymbols.findMaxPalace(),t=Clamp(e,1,24);this.radioGroup.selectedValue=t,this.updateTimes(),this.doUpdateFastest(t),Foursymbols.applyFastest(),Game.dispatcher.addEventListener(Game.EVENT.FoursymbolsSyncTask,this.updateTimes,this),Game.dispatcher.addEventListener(Game.EVENT.FoursymbolsSyncRecord,this.updateRecord,this),Game.dispatcher.addEventListener(Game.EVENT.FoursymbolsSyncFastest,this.updateFastest,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingshiLevelup,this.updateDungeonAttr,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingshiRestore,this.updateDungeonAttr,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingshiEnchase,this.updateDungeonAttr,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingshiEnchaseSuit,this.updateDungeonAttr,this),this.showPlaceInfo(t),this.setScrollerView(t)},n.prototype.onRemoveFromStage=function(){this.radioGroup.selectedValue=null,Game.dispatcher.removeEventListener(Game.EVENT.FoursymbolsSyncTask,this.updateTimes,this),Game.dispatcher.removeEventListener(Game.EVENT.FoursymbolsSyncRecord,this.updateRecord,this),Game.dispatcher.removeEventListener(Game.EVENT.FoursymbolsSyncFastest,this.updateFastest,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingshiLevelup,this.updateDungeonAttr,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingshiRestore,this.updateDungeonAttr,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingshiEnchase,this.updateDungeonAttr,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingshiEnchaseSuit,this.updateDungeonAttr,this)},n.prototype.updateFastest=function(){this.doUpdateFastest(this.radioGroup.selectedValue)},n.prototype.doUpdateFastest=function(e){var t=e,n=Foursymbols.FastestRecords.length;if(this.imgKing.visible=!1,n+1>t){var i=Foursymbols.FastestRecords[t-1];i&&i.name?(this.firstName=i.name,this.firstRecord=FormatMMSS(i.cost*Game.Second),this.imgKing.visible=i.name==Player.instance.Name):(this.firstRecord=lang.String("None"),this.firstName="")}else this.firstRecord=lang.String("None"),this.firstName="";for(var a=this.radios.length,r=0;a>r;r++){var o=this.radios[r],i=Foursymbols.FastestRecords[o.value-1];i&&i.name?o.win=Player.instance.Name==i.name:o.win=!1;var s=Foursymbols.palaces[o.value],l=s.attribute,u=Wuxingyinmanager.GetAllDungeonAttributsDesc(l);u[0].value>=s.attack&&u[1].value>=s.defense?o.ability=r<=Foursymbols.maxPalace:o.ability=!1}},n.prototype.updateRecord=function(e){var t=e.data;t.weekPlace>0?this.weekRecord=Foursymbols.getFullPalaceName(t.weekPlace)+" "+FormatMMSS(t.weekRecord*Game.Second):this.weekRecord=lang.String("None"),t.record>0?this.fastestRecord=FormatMMSS(t.record*Game.Second):this.fastestRecord=lang.String("None")},n.prototype.updateTimes=function(){this.timesLable.text=(Foursymbols.freeTimes+Foursymbols.extendTimes).toString();for(var e=this.radios.length,t=Foursymbols.maxPalace,n=0;e>n;n++)this.radios[n].enabled=t>=n},n.prototype.updateDungeonAttr=function(){this.updatePalaceAttr(this.radioGroup.selectedValue)},n.prototype.updatePalaceAttr=function(e){var t,n=Foursymbols.palaces[e],i=n.attribute,a=Wuxingyinmanager.GetAllDungeonAttributsDesc(i);n.attack>0?(this.attackName=a[0].key,t=a[0].value<n.attack?color.RED:color.GREEN,this.attackFP.textFlow=Game.HtmlTextParser.parse("<font color="+t+">"+a[0].value+"</font> / "+n.attack)):(this.attackName="",this.attackFP.text=""),n.defense>0?(this.defensekName=a[1].key,t=a[1].value<n.defense?color.RED:color.GREEN,this.defenseFP.textFlow=Game.HtmlTextParser.parse("<font color="+t+">"+a[1].value+"</font> / "+n.defense)):(this.defensekName="",this.defenseFP.text=""),0==n.attack&&0==n.defense&&(this.attackFP.text=lang.String("None"))},n.prototype.showPlaceInfo=function(e){var t=Foursymbols.palaces[e];this.imgBG.source=t.imgBG,this.placeName=t.name,this.txtColor=parseInt(t.textColor,16),this.list.dataProvider=new eui.ArrayCollection(t.awardsClient),this.updatePalaceAttr(e);
var n=new net.def.Index;n.index=e,net.socket.write(133,n.toArrayBuffer())},n.prototype.setScrollerView=function(e){var t=~~((e-1)/6)+1,n=318*(t-1),i=this.scrollVMax-this.scroller.height;i>=n?this.scroller.viewport.scrollV=n:this.scroller.viewport.scrollV=i},n.prototype.radioChangeHandler=function(){this.showPlaceInfo(this.radioGroup.selectedValue),this.doUpdateFastest(this.radioGroup.selectedValue)},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnRule:var n=new e.Rule;n.skinName="FoursymbolsRuleSkin",UIManager.pushPage(n);break;case this.btnRankAward:e.FourSymbolsRankAwardUI.open();break;case this.btnEnter:Foursymbols.apply(this.radioGroup.selectedValue);break;case this.btnBuyTimes:e.FourSymbolsBuyTimesUI.open();break;case this.imgClose:this.close();break;case this.btnGoRankUI:e.RankingUI.open(e.RankKind.FoursymbolsRank);break;case this.btnGoWuxingyin:e.WuxingyinUI.open()}},n.prototype.close=function(){UIManager.pop(this),e.FourSymbolsRankAwardUI.close()},n}(e.FitComponent);e.FourSymbolsEntrance=t,__reflect(t.prototype,"UI.FourSymbolsEntrance",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.timeCost=0,e.deltaCost=0,e.totalTime=0,e.phase=0,e.remainingTime=new RemainingTime,e._totalPhase=0,e.skinName="FoursymbolsHUDSkin",e.skulls=[],e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.timeAnim.text="",e}return __extends(n,t),Object.defineProperty(n.prototype,"totalPhase",{get:function(){return this._totalPhase},set:function(e){this._totalPhase=e,this.processGroup.removeChildren();for(var t=0;t<this._totalPhase;t++)this.skulls[t]||(this.skulls[t]=new eui.Image),this.skulls[t].source="icon/other/bone_b.png",this.processGroup.addChild(this.skulls[t])},enumerable:!0,configurable:!0}),n.prototype.onAddToStage=function(){turnTimer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this),SecondTicker.addEventListener(this.onSecondTick,this),this.mc1.addEventListener(egret.Event.COMPLETE,this.onTweenGroupComplete1,this)},n.prototype.onRemoveFromStage=function(){SecondTicker.removeEventListener(this.onSecondTick,this),turnTimer.removeEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this.mc1.removeEventListener(egret.Event.COMPLETE,this.onTweenGroupComplete1,this),this.timeAnim.text="",this.mc1.stop(),this.mc2.stop()},n.prototype.onTimer=function(){var e=AI.bb.select,t=mapCharacter[e];null!=t?(this.targetId!=e&&(this.bossName=t.Name,this.npcIcon=table.npcs[t.templateId].icon,this.targetId=e),this.bossBar.maximum=t.MaxLife,this.bossBar.value=t.Life,this.bossInfo.visible=!0):this.bossInfo.visible=!1},n.prototype.onSecondTick=function(){switch(this.status){case Foursymbols.Status.StatusFighting:this.gCountDown.visible&&(this.gCountDown.visible=!1),this.timeCost+=Game.Second,this.updateTime();break;case Foursymbols.Status.StatusPreparing:var e=this.remainingTime;if(0==this.remainingTime.minute){var t=e.second;t>=1&&3>=t?(this.countdown.text=""+t,this.descCountDown=StringWithFormat("{1}  {2}",this.palace,lang.StringWithFormat("{1}round",this.phase+1)),this.gCountDown.visible=!0):this.gCountDown.visible=!1}break;default:this.gCountDown.visible&&(this.gCountDown.visible=!1)}},n.prototype.updateTime=function(){var e=this.totalTime-this.timeCost;0>e&&(e=0),this.hourglass=FormatMMSS(e),this.time=FormatMMSS(this.timeCost)},n.prototype.update=function(e,t,n,i){this.timeCost=n,this.totalTime=i;for(var a=0;a<this._totalPhase;a++)e>a?this.skulls[a].source="icon/other/bone_a.png":this.skulls[a].source="icon/other/bone_b.png";this.phase=e,this.status=t,this.updateTime(),t==Foursymbols.Status.StatusPreparing&&(this.remainingTime.delta=Foursymbols.setting.prepareTime)},n.prototype.playTimeCost=function(e){this.timeAnim.text="+"+Foursymbols.setting.penalty+"s",this.timeAnim.x=this.width/2,this.timeAnim.y=this.height/3,this.mc1.play(0),this.deltaCost=e-this.timeCost},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnExit:e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],lang.String("operation confirm"),"Đồng ý rời khỏi Tứ Tượng Địa Cung?",function(){return Foursymbols.quit(),!0},null,null)}},n.prototype.onTweenGroupComplete1=function(){var e=this,t=this.inspector.localToGlobal(0,0);egret.Tween.get(this.timeAnim).to({x:t.x+50,y:t.y+70,scaleX:.2,scaleY:.2},300).call(function(){e.timeAnim.text="",e.timeCost+=e.deltaCost,e.updateTime(),e.mc2.play(0)})},n}(e.FitComponent);e.FourSymbolsHUD=t,__reflect(t.prototype,"UI.FourSymbolsHUD",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(t,n,i){var a=e.call(this)||this;return a.skinName="FourSymbolsPalaceItemSkin",a.radio.group=t,a.radio.label=n,a.radio.value=i,a.img.visible=!1,a}return __extends(t,e),Object.defineProperty(t.prototype,"enabled",{set:function(e){this.radio.enabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"win",{set:function(e){this.img.visible=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.radio.value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ability",{set:function(e){this.imgAbility.source=e?"ui/Wuxingyin/jiHuo_2.png":"ui/Wuxingyin/jiHuo_1.png"},enumerable:!0,configurable:!0}),t}(eui.Component);e.FourSymbolsPalaceItem=t,__reflect(t.prototype,"UI.FourSymbolsPalaceItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.dataChanged=function(){if(1==this.data.rank)this.icon="ui/ranking/first_icon.png",this.rankDesc=null;else{this.icon=null;var e=this.data.rank+this.data.count-1;e>this.data.rank?e>=9999?this.rankDesc=this.data.rank+"-Về sau":this.rankDesc=this.data.rank+"-"+e:this.rankDesc=""+this.data.rank}this.awardList.dataProvider=new eui.ArrayCollection(this.data.awards)},t}(eui.ItemRenderer);e.FourSymbolsRankAwardItem=t,__reflect(t.prototype,"UI.FourSymbolsRankAwardItem")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="FourSymbolsRankAwardUISkin",t.list.dataProvider=new eui.ArrayCollection(Foursymbols.rankAwardList),t}return __extends(t,e),t.open=function(){null==this.instance&&(this.instance=new t),UIManager.pushPage(this.instance)},t.close=function(){null!=this.instance&&UIManager.pop(this.instance)},t}(e.FitComponent);e.FourSymbolsRankAwardUI=t,__reflect(t.prototype,"UI.FourSymbolsRankAwardUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="FoursymbolsResultSkin",t.timeCostLabel.visible=!1,t.phaseLabel.visible=!1,t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.prototype.grading=function(e,t,n,i){var a=~~(n/1e3);e&&(a=~~(t/1e3));for(var r=Foursymbols.MaxFightingTime-a+100*i,o=0,s=Foursymbols.setting.grade;o<s.length;o++){var l=s[o];if(r>=l.min&&r<=l.max)return l.name}return Foursymbols.setting.grade[0].name},t.prototype.onRemoveFromStage=function(){egret.Tween.removeTweens(this),egret.Tween.removeTweens(this.gradeImg)},t.prototype.play=function(e,t,n,i,a){this.win=e,this.totalTime=n,this.totalPhase=a,this.orgPhase=i,this.timeCostLabel.visible=!1,this.phaseLabel.visible=!1,this.gradeImg.source="",this.gradeImg.alpha=1,this.step=0,this.grade=null,this.phase=0,this.timeCost=0,this.playGradingTime(t).call(this.showGrade,this,[t,0,1.7,1]).wait(300).call(this.playGradingPhase,this,[i])},t.prototype.playGradingTime=function(e){return this.timeCostLabel.visible=!0,egret.Tween.get(this,{onChange:this.gradingTimeAnimation,onChangeObj:this},null,!1).wait(100).to({timeCost:e},300)},t.prototype.playGradingPhase=function(e){var t=egret.Tween.get(this,{onChange:this.gradingPhaseAnimation,onChangeObj:this},null,!0);return this.phaseLabel.visible=!0,e>0?t.to({phase:e},300*e):t.wait(300).call(this.showLastGrade,this,[e])},t.prototype.gradingTimeAnimation=function(){this.timeCostLabel.text=FormatMMSS(~~this.timeCost)},t.prototype.setGradeImage=function(e){this.gradeImg.source="ui/Wuxingyin/"+e+".png",this.gradeImg.anchorOffsetX=this.gradeImg.width/2,this.gradeImg.anchorOffsetY=this.gradeImg.height/2,this.grade=e},t.prototype.gradingPhaseAnimation=function(){var e=~~this.timeCost,t=~~this.phase;this.phaseLabel.text=t+"/"+this.totalPhase;var n=this.grading(this.win,e,this.totalTime,t).toLowerCase();this.orgPhase==t?this.showGrade(e,t,3,.5):this.grade!=n&&this.showGrade(e,t,1.7,1)},t.prototype.close=function(){UIManager.pop(this),Foursymbols.skip()},t.prototype.showLastGrade=function(e){this.phase=e;var t=~~this.timeCost;this.grading(this.win,t,this.totalTime,e).toLowerCase()},t.prototype.showGrade=function(e,t,n,i){var a=this.grading(this.win,e,this.totalTime,t).toLowerCase();this.setGradeImage(a),egret.Tween.get(this.gradeImg,null,null,!0).to({scaleX:n,scaleY:n,alpha:i},100).to({scaleX:1,scaleY:1,alpha:1},100)},t.prototype.updateAwards=function(e){this.list.dataProvider=new eui.ArrayCollection(table.parseAwards(e))},t}(e.FitComponent);e.FourSymbolsResult=t,__reflect(t.prototype,"UI.FourSymbolsResult",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.dataChanged=function(){null!=this.btnRequest&&(friend.check(this.data.uuid)||this.data.name==Player.instance.Name?this.btnRequest.enabled=!1:this.btnRequest.enabled=!0)},n.prototype.onTouchTap=function(t){if(null!=this.data)switch(t.target){case this.btnAccpet:this.btnAccpet.enabled=!1,null!=this.parent&&(this.parent.dataProvider=new eui.ArrayCollection(friend.friendApplyData)),friend.accept(this.data.uuid);break;case this.btnIgnore:this.btnIgnore.enabled=!1,null!=this.parent&&(this.parent.dataProvider=new eui.ArrayCollection(friend.friendApplyData)),friend.removeRequest(this.data.uuid);break;case this.btnRequest:this.btnRequest.enabled=!1,friend.sendRequest(this.data.name);break;case this.icon:UIManager.push(new e.ChatPlayerDsc),friend.search(this.data.name)}},n}(eui.ItemRenderer);e.FriendItem=t,__reflect(t.prototype,"UI.FriendItem")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="FriendsApplySkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.list.itemRenderer=e.FriendItem,n.refresh(),n}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},n.prototype.close=function(){UIManager.pop(this)},n.prototype.onAddToStage=function(){this.refresh()},n.prototype.refresh=function(){null!=this.list&&(this.list.dataProvider=new eui.ArrayCollection(friend.friendApplyData))},n}(e.FitComponent);e.FriendsApply=t,__reflect(t.prototype,"UI.FriendsApply",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(e,n){var i=t.call(this)||this;return i.skinName="FriendsDeleteConfirmSkin",i.friendInfo=e,i.nType=n,i.addEventListener(egret.TouchEvent.TOUCH_TAP,i.onTouchTap,i),i}return __extends(n,t),n.prototype.DelObjectByType=function(){this.nType==Game.FriendPageType.Friend&&(friend.removeFriend(this.friendInfo.uuid),e.FriendsUI.instance.refresh())},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnDel:this.DelObjectByType();case this.btnCancel:UIManager.pop(this)}},n}(e.FitComponent);e.FriendsDeleteConfirm=t,__reflect(t.prototype,"UI.FriendsDeleteConfirm",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="FriendsListSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.onTouchTap=function(t){switch(t.target){case this.btnArbitrageInfo:this.processOnButtonByType();break;case this.headimg:UIManager.push(new e.ChatPlayerDsc),friend.search(this.data.name)}},n.prototype.dataChanged=function(){return this.data.nType==Game.FriendPageType.Friend?void(this.currentState="friend"):this.data.nType==Game.FriendPageType.BlackList?void(this.currentState="blacklist"):this.data.nType==Game.FriendPageType.RecentContact?void(this.currentState="recentcontact"):void 0},n.prototype.processOnButtonByType=function(){return this.data.nType==Game.FriendPageType.Friend?(UIManager.pop(e.FriendsUI.instance),UIManager.push(e.ChatDetail.instance),void ChatSys.createNewPrivateChannel(this.data.name,this.data.faction)):this.data.nType==Game.FriendPageType.BlackList?void BlackList.removePlayerFromBlackList(this.data.name):this.data.nType==Game.FriendPageType.RecentContact?(UIManager.pop(e.FriendsUI.instance),UIManager.push(e.ChatDetail.instance),void ChatSys.createNewPrivateChannel(this.data.name,this.data.faction)):void 0},n}(eui.ItemRenderer);e.FriendsList=t,__reflect(t.prototype,"UI.FriendsList")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.friendList=[],n.skinName="FriendsSearchSkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.list.itemRenderer=e.FriendItem,n.list.dataProvider=new eui.ArrayCollection(n.friendList),n}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onRemoveFromStage=function(){this.txtsearch=""},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close();break;case this.btnSearch:if(""==this.textInput.text)return;friend.search(this.textInput.text);break;case this.btnApply:if(this.list.selectedIndex<0||""==this.list.selectedItem.name)return;friend.sendRequest(this.list.selectedItem.name)}},n.prototype.close=function(){UIManager.pop(this)},n.prototype.setFriendList=function(e){this.textInput.text="",this.friendList=[];for(var t=0;t<e.length;t++)this.friendList.push(e[t]);this.list.dataProvider=new eui.ArrayCollection(this.friendList),this.friendList.length<=0&&(this.txtsearch="Không tìm thấy kết quả")},n}(e.FitComponent);e.FriendsSearch=t,__reflect(t.prototype,"UI.FriendsSearch",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.remainingTime=new RemainingTime,n.friendList=[],n.skinName="FriendsUISkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.list.itemRenderer=e.FriendsList,n.tabbar.selectedIndex=0,n.tabbar.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onChangeNotice,n),n.remainingTime.delta=0,n.refresh(),n}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onAddToStage=function(){this.tabbar.selectedIndex=Game.FriendPageType.Friend,Game.dispatcher.addEventListener(Game.EVENT.onPlayerInited,this.leaveMap,this),Game.dispatcher.addEventListener(Game.EVENT.SyncFriends,this.onSyncFriends,this),this.onChangeNotice(),friend.refreshFriends()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.onPlayerInited,this.leaveMap,this),Game.dispatcher.removeEventListener(Game.EVENT.SyncFriends,this.onSyncFriends,this)},n.prototype.leaveMap=function(){null!=e.FriendsUI.instance&&UIManager.pop(e.FriendsUI.instance)},n.prototype.UpdateBlackList=function(){null!=this.tabbar&&this.tabbar.selectedIndex==Game.FriendPageType.BlackList&&this.onChangeNotice()},n.prototype.onSyncFriends=function(){this.refresh()},n.prototype.UpdateRecentContact=function(){null!=this.tabbar&&this.tabbar.selectedIndex==Game.FriendPageType.RecentContact&&this.onChangeNotice()},n.prototype.compareFunc=function(e,t){return t.txtOffline==e.txtOffline?t.timeStamp>e.timeStamp?1:t.timeStamp<e.timeStamp?-1:0:t.txtOffline>e.txtOffline?1:t.txtOffline<e.txtOffline?-1:void 0},n.prototype.onChangeNotice=function(){var e=this.list.dataProvider;return null==e&&(this.list.dataProvider=new eui.ArrayCollection),this.tabbar.selectedIndex==Game.FriendPageType.Friend?(this.currentState="friend",void this.refresh()):this.tabbar.selectedIndex==Game.FriendPageType.BlackList?(this.currentState="blacklist",void this.ShowBlackList()):this.tabbar.selectedIndex==Game.FriendPageType.RecentContact?(this.currentState="recentcontact",void this.ShowRecentContact()):void 0},n.prototype.ShowRecentContact=function(){if(null!=this.list){var e=[];for(var t in RecentContact.recentContact)null!=RecentContact.recentContact[t]&&(e.push(new RecentContact.RecentContactInfo(t,RecentContact.recentContact[t].faction,RecentContact.recentContact[t].time)),1!=friend.checkByName(t)?e[e.length-1].Relationship=lang.String("stranger"):e[e.length-1].Relationship=lang.String("friend"));e.sort(this.compareFunc);var n=this.list.dataProvider;null==n?this.list.dataProvider=new eui.ArrayCollection(e):n.replaceAll(e)}},n.prototype.ShowBlackList=function(){if(null!=this.list){var e=[];for(var t in BlackList.blacklist)null!=BlackList.blacklist[t]&&e.push(new BlackList.BlackListInfo(t,BlackList.blacklist[t].faction));var n=this.list.dataProvider;null==n?this.list.dataProvider=new eui.ArrayCollection(e):n.replaceAll(e)}},n.prototype.DelFriend=function(){this.list.selectedIndex<0||""==this.list.selectedItem.name||UIManager.pushPage(new e.FriendsDeleteConfirm(this.list.selectedItem,Game.FriendPageType.Friend))},n.prototype.DelItem=function(){return this.tabbar.selectedIndex==Game.FriendPageType.Friend?void this.DelFriend():void 0},n.prototype.onTouchTap=function(t){switch(t.target){case this.imgClose:this.close();break;case this.btnAddFriend:UIManager.pushPage(e.FriendsSearch.instance);break;case this.btnCheckFriend:UIManager.pushPage(e.FriendsApply.instance),badge.onLight(badge.action.FriendApply,!1);break;case this.btnDelFriend:this.DelItem()}},n.prototype.refresh=function(){if(null!=this.list&&null!=this.tabbar&&this.tabbar.selectedIndex==Game.FriendPageType.Friend){for(var e=this.list.dataProvider,t=[],n=0;n<friend.friendData.length;n++)t.push(new friend.RoleBriefUI(friend.friendData[n]));null==e?this.list.dataProvider=new eui.ArrayCollection(t):e.replaceAll(t)}},n.prototype.close=function(){UIManager.pop(this),n._instance=null},n.Close=function(){null!=this._instance&&this._instance.close()},n}(e.FitComponent);e.FriendsUI=t,__reflect(t.prototype,"UI.FriendsUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="GuangMingDingAwardUISkin",t.restTime=5,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.close=function(){UIManager.pop(this)},t.prototype.onAddToStage=function(){this.onTimer(),SecondTicker.addEventListener(this.onTimer,this)},t.prototype.onRemoveFromStage=function(){SecondTicker.removeEventListener(this.onTimer,this)},t.prototype.onTimer=function(){this.restTime--,this.tips=StringWithFormat("{1} giây sau tự đóng",this.restTime),this.restTime<=0&&this.close()},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnClose:this.close(),this.restTime>1&&Foursymbols.skip()}},t.prototype.updateAwards=function(e){this.list.dataProvider=new eui.ArrayCollection(table.parseAwards(e))},t}(e.FitComponent);e.GuangMingDingAwardUI=t,__reflect(t.prototype,"UI.GuangMingDingAwardUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="GuangMingDingBuyOverTimeSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),n.prototype.onAddToStage=function(){var e=StringWithFormat("Muốn tốn <font color='#ffffff'>{1}</font> KNB Khóa tăng <font color='#ffffff'>{2}</font> giây.\nSố lần còn: <font color='#ffffff'>{3}/{4}</font>",Foursymbols.setting.overtimeCost,Foursymbols.setting.overtime,Foursymbols.setting.overtimeCount-Foursymbols.overtimeCount,Foursymbols.setting.overtimeCount);this.content.textFlow=Game.HtmlTextParser.parse(e),this.onTimer(),SecondTicker.addEventListener(this.onTimer,this)},n.prototype.onRemoveFromStage=function(){SecondTicker.removeEventListener(this.onTimer,this)},n.prototype.onTimer=function(){this.timer-=1;var e=StringWithFormat("<font color='#539E58'>Còn </font>({1})",this.timer);this.restTime.textFlow=Game.HtmlTextParser.parse(e),this.timer<=0&&this.close()},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnCancel:Foursymbols.skip(),this.close();break;case this.btnOK:if(!this.onOk())return;this.close()}},n.prototype.onOk=function(){if(Foursymbols.setting.overtimeCount<=Foursymbols.overtimeCount)return PopUpMessage.push("Số lần không đủ",color.RED),!1;var t=Foursymbols.setting.overtimeCost,n=PlayerAttribute.currency[Game.Currency.SilverCoin],i=PlayerAttribute.currency[Game.Currency.GoldCoin];if(t>n){if(i+n>=t){if(Foursymbols.noWarnBuyOvertimeCost)return Foursymbols.buyOvertime(),!0;var a=new e.SliverCoinPrompt;return a.title=lang.String("operation confirm"),a.content=lang.StringWithFormat("if replace {1} silver with gold",t-n),a.cb=function(e){Foursymbols.buyOvertime(),UIManager.pop(a),Foursymbols.noWarnBuyOvertimeCost=e},UIManager.push(a),!0}return PopUpMessage.push(lang.String("not enough anyCoin"),color.RED),!1}return Foursymbols.buyOvertime(),!0},n}(e.FitComponent);e.GuangMingDingBuyOverTime=t,__reflect(t.prototype,"UI.GuangMingDingBuyOverTime",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;t.skinName="GuangMingDingBuyTimesUI",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t);var n=table.props[Foursymbols.setting.gmditem.genre][Foursymbols.setting.gmditem.detailType];return t.cell.data={type:"item",content:{genre:Foursymbols.setting.gmditem.genre,detailType:Foursymbols.setting.gmditem.detailType},obtainId:Foursymbols.setting.gmditem.obtainId},t.itemName.textFlow=Game.HtmlTextParser.parse("<font color="+Item.QualityColor[n.quality]+">"+n.name+"</font>"),t}return __extends(t,e),t.open=function(){null==this.instance&&(this.instance=new t),UIManager.pushPage(this.instance)},t.prototype.onAddToStage=function(){this.boxNumer=1,this.myCount=PlayerAttribute.bag.CalcCount(Foursymbols.setting.gmditem.genre,Foursymbols.setting.gmditem.detailType),this.updateItemCount(),this.updateTimes(),Game.dispatcher.addEventListener(Game.EVENT.FoursymbolsSyncTask,this.updateTimes,this),Game.dispatcher.addEventListener(Game.EVENT.AddItem,this.updateItem,this),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,this.updateItem,this)},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.FoursymbolsSyncTask,this.updateTimes,this),Game.dispatcher.removeEventListener(Game.EVENT.AddItem,this.updateItem,this),Game.dispatcher.removeEventListener(Game.EVENT.UpdateItem,this.updateItem,this)},t.prototype.updateItem=function(e){if(null!=e&&null!=e.data){var t=e.data.Item;t.Type==Foursymbols.setting.gmditem.genre&&t.DetailType==Foursymbols.setting.gmditem.detailType&&(this.myCount=PlayerAttribute.bag.CalcCount(Foursymbols.setting.gmditem.genre,Foursymbols.setting.gmditem.detailType),this.updateItemCount())}},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnMinus:this.boxNumer-=1;break;case this.btnMinus10:this.boxNumer-=10;break;case this.btnPlus:this.boxNumer+=1;break;case this.btnPlus10:this.boxNumer+=10;break;case this.btnChange:return void(Foursymbols.buyGuangMingDing(this.boxNumer)&&this.close())}this.boxNumer<1&&(this.boxNumer=1),Foursymbols.gmdBuyTimes>0&&this.boxNumer>Foursymbols.gmdBuyTimes&&(this.boxNumer=Foursymbols.gmdBuyTimes),this.updateItemCount()},t.prototype.updateItemCount=function(){this.needCount=this.boxNumer*Foursymbols.setting.gmditem.count,this.myCount>=this.needCount?this.lbMyCount.textColor=color.GREEN:this.lbMyCount.textColor=color.RED,this.updateBtnState()},t.prototype.updateBtnState=function(){this.boxNumer<=Foursymbols.gmdBuyTimes?this.btnChange.enabled=!0:this.btnChange.enabled=!1},t.prototype.updateTimes=function(){this.lbTimes.text=""+Foursymbols.gmdBuyTimes,Foursymbols.gmdBuyTimes<=0?this.lbTimes.textColor=color.RED:this.lbTimes.textColor=color.WHITE},t}(e.FitComponent);e.GuangMingDingBuyTimesUI=t,__reflect(t.prototype,"UI.GuangMingDingBuyTimesUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;n.txtColor=16777215,n.radioGroup=new eui.RadioButtonGroup,n.skinName="GuangMingDingEntranceSkin";var i=Foursymbols.maxPalace;n.radios=[];var a=function(t,a){for(var r=t;a>=r;r++){var o=Foursymbols.palaces[r],s=new e.GuangMingDingPalaceItem(n.radioGroup,o.name,o.id);s.enabled=i>=r-1,n.palaceGroup.addChild(s),n.radios.push(s)}},r=function(e){var t=new eui.Label;t.text=e,t.fontFamily="Tahoma",t.textAlign=egret.HorizontalAlign.CENTER,t.size=14,t.height=34,t.verticalAlign="middle",t.textColor=8486782,n.palaceGroup.addChild(t)};return n.basedungeonid=24,r("Thiên Ứng Giáo"),a(25,32),r("Minh Giáo"),a(33,41),r("Quang Minh Đỉnh"),a(42,50),n.radioGroup.addEventListener(eui.UIEvent.CHANGE,n.radioChangeHandler,n),n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.scrollVMax=1408,n}return __extends(n,t),n.open=function(){null==this.instance&&(this.instance=new n),UIManager.pushPage(this.instance)},n.prototype.onAddToStage=function(){var e=Foursymbols.findMaxGuangMingDing(),t=Clamp(e,25,50);this.radioGroup.selectedValue=t,this.updateTimes(),this.doUpdateFastest(t),Foursymbols.applyFastest(),Game.dispatcher.addEventListener(Game.EVENT.FoursymbolsSyncTask,this.updateTimes,this),Game.dispatcher.addEventListener(Game.EVENT.FoursymbolsSyncRecord,this.updateRecord,this),Game.dispatcher.addEventListener(Game.EVENT.FoursymbolsSyncFastest,this.updateFastest,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingshiLevelup,this.updateDungeonAttr,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingshiRestore,this.updateDungeonAttr,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingshiEnchase,this.updateDungeonAttr,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingshiEnchaseSuit,this.updateDungeonAttr,this),this.showPlaceInfo(t),this.setScrollerView(t)},n.prototype.onRemoveFromStage=function(){this.radioGroup.selectedValue=null,Game.dispatcher.removeEventListener(Game.EVENT.FoursymbolsSyncTask,this.updateTimes,this),Game.dispatcher.removeEventListener(Game.EVENT.FoursymbolsSyncRecord,this.updateRecord,this),Game.dispatcher.removeEventListener(Game.EVENT.FoursymbolsSyncFastest,this.updateFastest,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingshiLevelup,this.updateDungeonAttr,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingshiRestore,this.updateDungeonAttr,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingshiEnchase,this.updateDungeonAttr,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingshiEnchaseSuit,this.updateDungeonAttr,this)},n.prototype.updateFastest=function(){this.doUpdateFastest(this.radioGroup.selectedValue)},n.prototype.doUpdateFastest=function(e){var t=e,n=Foursymbols.FastestRecords.length;if(this.imgKing.visible=!1,n+1>t){var i=Foursymbols.FastestRecords[t-1];i&&i.name?(this.firstName=i.name,this.firstRecord=FormatMMSS(i.cost*Game.Second),this.imgKing.visible=i.name==Player.instance.Name):(this.firstRecord=lang.String("None"),this.firstName="")}else this.firstRecord=lang.String("None"),this.firstName="";for(var a=this.radios.length,r=0;a>r;r++){var o=this.radios[r],i=Foursymbols.FastestRecords[o.value-1];i&&i.name?o.win=Player.instance.Name==i.name:o.win=!1;var s=Foursymbols.palaces[o.value],l=s.attribute,u=Wuxingyinmanager.GetAllDungeonAttributsDesc(l);u[0].value>=s.attack&&u[1].value>=s.defense?o.ability=r+this.basedungeonid<=Foursymbols.maxPalace:o.ability=!1}},n.prototype.updateRecord=function(e){var t=e.data;t.weekPlace>0?this.weekRecord=Foursymbols.getFullPalaceName(t.weekPlace)+" "+FormatMMSS(t.weekRecord*Game.Second):this.weekRecord=lang.String("None"),t.record>0?this.fastestRecord=FormatMMSS(t.record*Game.Second):this.fastestRecord=lang.String("None")},n.prototype.updateTimes=function(){this.timesLable.text=(Foursymbols.gmdFreeTimes+Foursymbols.gmdExtendTimes).toString();for(var e=this.radios.length,t=Foursymbols.maxPalace,n=0;e>n;n++)this.radios[n].enabled=n+this.basedungeonid<=t},n.prototype.updateDungeonAttr=function(){this.updatePalaceAttr(this.radioGroup.selectedValue)},n.prototype.updatePalaceAttr=function(e){var t,n=Foursymbols.palaces[e],i=n.attribute,a=Wuxingyinmanager.GetAllDungeonAttributsDesc(i);n.attack>0?(this.attackName=a[0].key,t=a[0].value<n.attack?color.RED:color.GREEN,this.attackFP.textFlow=Game.HtmlTextParser.parse("<font color="+t+">"+a[0].value+"</font> / "+n.attack)):(this.attackName="",this.attackFP.text=""),n.defense>0?(this.defensekName=a[1].key,t=a[1].value<n.defense?color.RED:color.GREEN,this.defenseFP.textFlow=Game.HtmlTextParser.parse("<font color="+t+">"+a[1].value+"</font> / "+n.defense)):(this.defensekName="",this.defenseFP.text=""),0==n.attack&&0==n.defense&&(this.attackFP.text=lang.String("None"))},n.prototype.showPlaceInfo=function(e){var t=Foursymbols.palaces[e];this.imgBG.source=t.imgBG,this.placeName=t.name,this.txtColor=parseInt(t.textColor,16),this.list.dataProvider=new eui.ArrayCollection(t.awardsClient),this.updatePalaceAttr(e);var n=new net.def.Index;n.index=e,net.socket.write(133,n.toArrayBuffer())},n.prototype.setScrollerView=function(e){var t=~~((e-this.basedungeonid-1)/6)+1,n=318*(t-1),i=this.scrollVMax-this.scroller.height;i>=n?this.scroller.viewport.scrollV=n:this.scroller.viewport.scrollV=i},n.prototype.radioChangeHandler=function(){this.showPlaceInfo(this.radioGroup.selectedValue),this.doUpdateFastest(this.radioGroup.selectedValue)},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnRule:var n=new e.Rule;n.skinName="GuangMingDingRuleSkin",UIManager.pushPage(n);break;case this.btnRankAward:e.GuangMingDingRankAwardUI.open();break;case this.btnEnter:Foursymbols.apply(this.radioGroup.selectedValue);break;case this.btnBuyTimes:e.GuangMingDingBuyTimesUI.open();break;case this.imgClose:this.close();break;case this.btnGoRankUI:e.RankingUI.open(e.RankKind.GuangMingDingRank);break;case this.btnGoWuxingyin:e.WuxingyinUI.open()}},n.prototype.close=function(){UIManager.pop(this),e.GuangMingDingRankAwardUI.close()},n}(e.FitComponent);e.GuangMingDingEntrance=t,__reflect(t.prototype,"UI.GuangMingDingEntrance",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.timeCost=0,e.deltaCost=0,e.totalTime=0,e.phase=0,e.remainingTime=new RemainingTime,e._totalPhase=0,e.skinName="FoursymbolsHUDSkin",e.skulls=[],e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.timeAnim.text="",e
}return __extends(n,t),Object.defineProperty(n.prototype,"totalPhase",{get:function(){return this._totalPhase},set:function(e){this._totalPhase=e,this.processGroup.removeChildren();for(var t=0;t<this._totalPhase;t++)this.skulls[t]||(this.skulls[t]=new eui.Image),this.skulls[t].source="icon/other/bone_b.png",this.processGroup.addChild(this.skulls[t])},enumerable:!0,configurable:!0}),n.prototype.onAddToStage=function(){turnTimer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this),SecondTicker.addEventListener(this.onSecondTick,this),this.mc1.addEventListener(egret.Event.COMPLETE,this.onTweenGroupComplete1,this)},n.prototype.onRemoveFromStage=function(){SecondTicker.removeEventListener(this.onSecondTick,this),turnTimer.removeEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this.mc1.removeEventListener(egret.Event.COMPLETE,this.onTweenGroupComplete1,this),this.timeAnim.text="",this.mc1.stop(),this.mc2.stop()},n.prototype.onTimer=function(){var e=AI.bb.select,t=mapCharacter[e];null!=t?(this.targetId!=e&&(this.bossName=t.Name,this.npcIcon=table.npcs[t.templateId].icon,this.targetId=e),this.bossBar.maximum=t.MaxLife,this.bossBar.value=t.Life,this.bossInfo.visible=!0):this.bossInfo.visible=!1},n.prototype.onSecondTick=function(){switch(this.status){case Foursymbols.Status.StatusFighting:this.gCountDown.visible&&(this.gCountDown.visible=!1),this.timeCost+=Game.Second,this.updateTime();break;case Foursymbols.Status.StatusPreparing:var e=this.remainingTime;if(0==this.remainingTime.minute){var t=e.second;t>=1&&3>=t?(this.countdown.text=""+t,this.descCountDown=StringWithFormat("{1}  {2}",this.palace,lang.StringWithFormat("{1}round",this.phase+1)),this.gCountDown.visible=!0):this.gCountDown.visible=!1}break;default:this.gCountDown.visible&&(this.gCountDown.visible=!1)}},n.prototype.updateTime=function(){var e=this.totalTime-this.timeCost;0>e&&(e=0),this.hourglass=FormatMMSS(e),this.time=FormatMMSS(this.timeCost)},n.prototype.update=function(e,t,n,i){this.timeCost=n,this.totalTime=i;for(var a=0;a<this._totalPhase;a++)e>a?this.skulls[a].source="icon/other/bone_a.png":this.skulls[a].source="icon/other/bone_b.png";this.phase=e,this.status=t,this.updateTime(),t==Foursymbols.Status.StatusPreparing&&(this.remainingTime.delta=Foursymbols.setting.prepareTime)},n.prototype.playTimeCost=function(e){this.timeAnim.text="+"+Foursymbols.setting.penalty+"s",this.timeAnim.x=this.width/2,this.timeAnim.y=this.height/3,this.mc1.play(0),this.deltaCost=e-this.timeCost},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnExit:e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],lang.String("operation confirm"),"Đồng ý rời khỏi Tứ Tượng Địa Cung?",function(){return Foursymbols.quit(),!0},null,null)}},n.prototype.onTweenGroupComplete1=function(){var e=this,t=this.inspector.localToGlobal(0,0);egret.Tween.get(this.timeAnim).to({x:t.x+50,y:t.y+70,scaleX:.2,scaleY:.2},300).call(function(){e.timeAnim.text="",e.timeCost+=e.deltaCost,e.updateTime(),e.mc2.play(0)})},n}(e.FitComponent);e.GuangMingDingHUD=t,__reflect(t.prototype,"UI.GuangMingDingHUD",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(t,n,i){var a=e.call(this)||this;return a.skinName="GuangMingDingPalaceItemSkin",a.radio.group=t,a.radio.label=n,a.radio.value=i,a.img.visible=!1,a}return __extends(t,e),Object.defineProperty(t.prototype,"enabled",{set:function(e){this.radio.enabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"win",{set:function(e){this.img.visible=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.radio.value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ability",{set:function(e){this.imgAbility.source=e?"ui/Wuxingyin/jiHuo_2.png":"ui/Wuxingyin/jiHuo_1.png"},enumerable:!0,configurable:!0}),t}(eui.Component);e.GuangMingDingPalaceItem=t,__reflect(t.prototype,"UI.GuangMingDingPalaceItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.dataChanged=function(){if(1==this.data.rank)this.icon="ui/ranking/first_icon.png",this.rankDesc=null;else{this.icon=null;var e=this.data.rank+this.data.count-1;e>this.data.rank?e>=9999?this.rankDesc=this.data.rank+"-Về sau":this.rankDesc=this.data.rank+"-"+e:this.rankDesc=""+this.data.rank}this.awardList.dataProvider=new eui.ArrayCollection(this.data.awards)},t}(eui.ItemRenderer);e.GuangMingDingRankAwardItem=t,__reflect(t.prototype,"UI.GuangMingDingRankAwardItem")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="FourSymbolsRankAwardUISkin",t.list.dataProvider=new eui.ArrayCollection(Foursymbols.gmdrankAwardList),t}return __extends(t,e),t.open=function(){null==this.instance&&(this.instance=new t),UIManager.pushPage(this.instance)},t.close=function(){null!=this.instance&&UIManager.pop(this.instance)},t}(e.FitComponent);e.GuangMingDingRankAwardUI=t,__reflect(t.prototype,"UI.GuangMingDingRankAwardUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="FoursymbolsResultSkin",t.timeCostLabel.visible=!1,t.phaseLabel.visible=!1,t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.prototype.grading=function(e,t,n,i){var a=~~(n/1e3);e&&(a=~~(t/1e3));for(var r=Foursymbols.MaxFightingTime-a+100*i,o=0,s=Foursymbols.setting.grade;o<s.length;o++){var l=s[o];if(r>=l.min&&r<=l.max)return l.name}return Foursymbols.setting.grade[0].name},t.prototype.onRemoveFromStage=function(){egret.Tween.removeTweens(this),egret.Tween.removeTweens(this.gradeImg)},t.prototype.play=function(e,t,n,i,a){this.win=e,this.totalTime=n,this.totalPhase=a,this.orgPhase=i,this.timeCostLabel.visible=!1,this.phaseLabel.visible=!1,this.gradeImg.source="",this.gradeImg.alpha=1,this.step=0,this.grade=null,this.phase=0,this.timeCost=0,this.playGradingTime(t).call(this.showGrade,this,[t,0,1.7,1]).wait(300).call(this.playGradingPhase,this,[i])},t.prototype.playGradingTime=function(e){return this.timeCostLabel.visible=!0,egret.Tween.get(this,{onChange:this.gradingTimeAnimation,onChangeObj:this},null,!1).wait(100).to({timeCost:e},300)},t.prototype.playGradingPhase=function(e){var t=egret.Tween.get(this,{onChange:this.gradingPhaseAnimation,onChangeObj:this},null,!0);return this.phaseLabel.visible=!0,e>0?t.to({phase:e},300*e):t.wait(300).call(this.showLastGrade,this,[e])},t.prototype.gradingTimeAnimation=function(){this.timeCostLabel.text=FormatMMSS(~~this.timeCost)},t.prototype.setGradeImage=function(e){this.gradeImg.source="ui/Wuxingyin/"+e+".png",this.gradeImg.anchorOffsetX=this.gradeImg.width/2,this.gradeImg.anchorOffsetY=this.gradeImg.height/2,this.grade=e},t.prototype.gradingPhaseAnimation=function(){var e=~~this.timeCost,t=~~this.phase;this.phaseLabel.text=t+"/"+this.totalPhase;var n=this.grading(this.win,e,this.totalTime,t).toLowerCase();this.orgPhase==t?this.showGrade(e,t,3,.5):this.grade!=n&&this.showGrade(e,t,1.7,1)},t.prototype.close=function(){UIManager.pop(this),Foursymbols.skip()},t.prototype.showLastGrade=function(e){this.phase=e;var t=~~this.timeCost;this.grading(this.win,t,this.totalTime,e).toLowerCase()},t.prototype.showGrade=function(e,t,n,i){var a=this.grading(this.win,e,this.totalTime,t).toLowerCase();this.setGradeImage(a),egret.Tween.get(this.gradeImg,null,null,!0).to({scaleX:n,scaleY:n,alpha:i},100).to({scaleX:1,scaleY:1,alpha:1},100)},t.prototype.updateAwards=function(e){this.list.dataProvider=new eui.ArrayCollection(table.parseAwards(e))},t}(e.FitComponent);e.GuangMingDingResult=t,__reflect(t.prototype,"UI.GuangMingDingResult",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.stoneMsec=[0,0,0],e.loaded=!1,e.msgId=0,e.sourceOpen="ui/yongWuDian/a2.png",e.sourceClose="ui/yongWuDian/a1.png",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.imgList=[],this.imgList.push(this.img1),this.imgList.push(this.img2),this.imgList.push(this.img3),this.grpList=[],this.grpList.push(this.secGroup1),this.grpList.push(this.secGroup2),this.grpList.push(this.secGroup3),this.secList=[],this.secList.push(this.labelSec1),this.secList.push(this.labelSec2),this.secList.push(this.labelSec3),this.loaded=!0},n.prototype.onAddToStage=function(){SecondTicker.addEventListener(this.onTimer,this)},n.prototype.onRemoveFromStage=function(){SecondTicker.addEventListener(this.onTimer,this)},n.prototype.onTimer=function(){this.labelSec1.text=BravePalace.chapter1Stones[0].delta.toString(),this.labelSec2.text=BravePalace.chapter1Stones[1].delta.toString(),this.labelSec3.text=BravePalace.chapter1Stones[2].delta.toString()},n.prototype.Update=function(){if(this.loaded){var e=0;this.visible=!0,this.currentState="state1";for(var t=0;t<BravePalace.chapter1Stones.length;t++)BravePalace.chapter1Stones[t].deltaMillisecond>0?(e++,this.grpList[t].visible=!0,this.secList[t].text=BravePalace.chapter1Stones[t].delta.toString(),this.imgList[t].source=this.sourceOpen):(this.grpList[t].visible=!1,this.imgList[t].source=this.sourceClose);3==e&&this.SetWarrning("<font color=#2bca4b size = 14>BOSS đã được mở phong ấn</font>","Tập trung ở giữa!",5)}},n.prototype.SetWarrning=function(t,n,i){if(this.loaded){this.currentState="state2",this.visible=!0,this.Title=Game.HtmlTextParser.parse(t),this.MainDesc=Game.HtmlTextParser.parse(n);var a=++this.msgId;MakeDelayExecute(function(){e.BravePalaceBoard.instance.msgId==a&&(e.BravePalaceBoard.instance.visible=!1)},null,i*Game.Second)()}},n}(e.FitComponent);e.BravePalaceBoard=t,__reflect(t.prototype,"UI.BravePalaceBoard",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.Loaded=!1,t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.Loaded=!0},t.prototype.onAddToStage=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.OnTouchTap,this),this.Update()},t.prototype.onRemoveFromStage=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.OnTouchTap,this)},t.prototype.Update=function(){for(var e=[this.cbCheck0,this.cbCheck1,this.cbCheck2,this.cbCheck3,this.cbCheck4],t=BravePalace.nMaxLevel,n=0;n<e.length;n++)e[n].selected=!1,t>=n?e[n].enabled=!0:e[n].enabled=!1;e[BravePalace.nSelectedLevel].selected=!0},t.prototype.OnSelect=function(e){BravePalace.SelectSceneLevel(e)},t.prototype.OnTouchTap=function(e){switch(e.target){case this.cbCheck0:this.OnSelect(0);break;case this.cbCheck1:this.OnSelect(1);break;case this.cbCheck2:this.OnSelect(2);break;case this.cbCheck3:this.OnSelect(3);break;case this.cbCheck4:this.OnSelect(4)}},t}(e.FitComponent);e.BravePalaceLvSelect=t,__reflect(t.prototype,"UI.BravePalaceLvSelect",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(e.FitComponent);e.BravePalaceRulePage=t,__reflect(t.prototype,"UI.BravePalaceRulePage",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.OnAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.OnRemoveFromStage,t),t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.OnAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.OnClickAwardPageClose,this.Close,this)},t.prototype.OnRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.OnClickAwardPageClose,this.Close,this)},t.prototype.Close=function(){UIManager.pop(this)},t}(e.FitComponent);e.BravePalaceSceneResult=t,__reflect(t.prototype,"UI.BravePalaceSceneResult",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.Loaded=!1,e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.awardList.dataProvider=new eui.ArrayCollection(BravePalace.cfg.awardView),this.Loaded=!0,this.Update()},n.prototype.onAddToStage=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.OnTouchTap,this),this.Loaded&&this.Update()},n.prototype.onRemoveFromStage=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.OnTouchTap,this)},n.prototype.Update=function(){var e=BravePalace.nSelectedLevel;BravePalace.sceneState==BravePalace.SceneState.Running&&(e=BravePalace.runningLevel),this.szLevelName="Độ khó hiện nay:"+BravePalace.szLevelName[e],this.szStatus=BravePalace.szStatusName[BravePalace.sceneState]},n.prototype.OnTouchTap=function(t){switch(t.target){case this.btnRules:UIManager.pushPage(e.BravePalaceRulePage.instance);break;case this.btnSelectLevel:Guild.isGuildManager()?UIManager.push(e.BravePalaceLvSelect.instance):PopUpMessage.push("CHỉ Bang Chủ hoặc Bang Phó có thể điều chỉnh độ khó!",color.RED);break;case this.btnGO:BravePalace.EnterScene()}},n}(e.FitComponent);e.BravePalaceUI=t,__reflect(t.prototype,"UI.BravePalaceUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.actListData=[],n.skinName="GuildActivitySkin",n.actList.itemRenderer=e.GuildActivityItem,n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onAddToStage=function(){this.actListData=[{name:"Thiên Bảo Khố",info:"",btnName:"Tham gia",actType:e.GuildHome.ActGuildDungeon},{name:"Nhiệm vụ bang",info:"",btnName:"Tham gia",actType:e.GuildHome.ActTask},{name:"Lửa Trại Bang",info:"",btnName:"Tham gia",actType:e.GuildHome.ActToast},{name:"Thám Bảo Bang",info:"",btnName:"Tham gia",actType:e.GuildHome.ActWheel},{name:"Nhiệm Vụ Thương Hội",info:"",btnName:"Tham gia",actType:e.GuildHome.ActBusiTask}],WorldLine.IsOpen("BravePalace")&&this.actListData.push({name:"Dũng Võ Điện",info:"",btnName:"Tham gia",actType:e.GuildHome.ActBravePalace}),this.updateItems(),Game.dispatcher.addEventListener(Game.EVENT.GuildToastBegin,this.updateItems,this),Game.dispatcher.addEventListener(Game.EVENT.GuildToastEnd,this.updateItems,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.GuildToastBegin,this.updateItems,this),Game.dispatcher.removeEventListener(Game.EVENT.GuildToastEnd,this.updateItems,this)},n.prototype.updateItems=function(){for(var e=[],t=0;t<this.actListData.length;t++){var n=this.actListData[t];("Thiên Bảo Khố"!=n.name||WorldLine.IsOpen("GuildDungeon"))&&e.push(n)}this.actList.dataProvider=new eui.ArrayCollection(e)},n}(eui.Component);e.GuildActivity=t,__reflect(t.prototype,"UI.GuildActivity",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="GuildActivityItemSkin",e}return __extends(n,t),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoveFromStage,this)},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.GuildBusiTaskDataChange,this.dataChanged,this),Game.dispatcher.addEventListener(Game.EVENT.SyncGuildInfo,this.dataChanged,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.GuildBusiTaskDataChange,this.dataChanged,this),Game.dispatcher.removeEventListener(Game.EVENT.SyncGuildInfo,this.dataChanged,this)},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnConfirm:this.onConfirm()}},n.prototype.onConfirm=function(){switch(this.data.actType){case e.GuildHome.ActTask:e.GuildHome.instance.changePage(e.GuildHome.PageTask);break;case e.GuildHome.ActToast:this.onClickToast();break;case e.GuildHome.ActWheel:e.GuildHome.instance.OpenGardenPage();break;case e.GuildHome.ActShop:UIManager.pushPage(e.GuildShop.instance);break;case e.GuildHome.ActForge:break;case e.GuildHome.ActSalary:var t=new e.Rule;t.skinName="GuildSalarySkin",UIManager.push(t);break;case e.GuildHome.ActBusiTask:UIManager.pop(e.GuildHome.instance),e.GuildBusiTask.open();break;case e.GuildHome.ActEquipBuild:UIManager.pop(e.GuildHome.instance),e.EquipMaking.open();break;case e.GuildHome.ActGuildDungeon:UIManager.pop(e.GuildHome.instance),GuildDungeon.Hotkey2Open(!0);break;case e.GuildHome.ActBravePalace:UIManager.pop(e.GuildHome.instance),BravePalace.OpenUI()}},n.prototype.onClickToast=function(){Guild.inToastTime?(UIManager.pop(e.GuildHome.instance),net.socket.write(94,null)):Player.instance.guildPos==Guild.GuildPosition.GuildPos_Leader?UIManager.push(e.GuildToast.instance):(UIManager.pop(e.GuildHome.instance),net.socket.write(94,null))},n.prototype.dataChanged=function(){switch(this.txtActName.text=this.data.name,this.btnConfirm.label=this.data.btnName,this.infoDesc=Game.HtmlTextParser.parse(this.data.info),this.data.actType){case e.GuildHome.ActBusiTask:this.infoDesc=Game.HtmlTextParser.parse(Guild.busiTaskData.finishCount+"/"+table.guildBusiTask.taskCountPerDay);break;case e.GuildHome.ActToast:this.infoDesc=Game.HtmlTextParser.parse(Guild.formatToastTime(Guild.toastTime)),Guild.inToastTime?this.btnConfirm.label=lang.String("guild activity item toast btn msg join"):Player.instance.guildPos==Guild.GuildPosition.GuildPos_Leader?this.btnConfirm.label=lang.String("guild activity item toast btn msg change"):this.btnConfirm.label=lang.String("guild activity item toast btn msg join");break;case e.GuildHome.ActEquipBuild:this.infoDesc=Game.HtmlTextParser.parse("Lv"+Guild.equipBuildLevel);break;case e.GuildHome.ActBravePalace:this.infoDesc=Game.HtmlTextParser.parse(Guild.formatToastTime(100*BravePalace.cfg.startTime.hour+BravePalace.cfg.startTime.minute))}},n}(eui.ItemRenderer);e.GuildActivityItem=t,__reflect(t.prototype,"UI.GuildActivityItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.applicants=[],e.skinName="GuildApplicantSkin",e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close();break;case this.btnSure:this.onAllsure();break;case this.btnRefuse:this.onAllrefuse();break;case this.approval:this.onCheckChange()}},n.prototype.onRemoveFromStage=function(){this.applicants=[]},n.prototype.showApplicants=function(){this.memberList.itemRenderer=e.GuildApplicantItem,this.memberList.dataProvider=new eui.ArrayCollection(this.applicants),this.approval.selected=Guild.needApproval},n.prototype.close=function(){UIManager.pop(this),""!=Player.instance.guildName&&Guild.openGuildHome()},n.prototype.onAllsure=function(){if(!(this.applicants.length<1)){for(var e=[],t=0;t<this.memberList.selectedItems.length;t++)e.push(this.memberList.selectedItems[t].name);var n=new net.def.C2SGuildApprove;n.setApprove(!0),n.setNames(e),net.socket.write(87,n.toArrayBuffer()),net.socket.write(89,null)}},n.prototype.onAllrefuse=function(){if(!(this.applicants.length<1)){for(var e=[],t=0;t<this.memberList.selectedItems.length;t++)e.push(this.memberList.selectedItems[t].name);var n=new net.def.C2SGuildApprove;n.setApprove(!1),n.setNames(e),net.socket.write(87,n.toArrayBuffer()),net.socket.write(89,null)}},n.prototype.onCheckChange=function(){var e=new net.def.Bool;e.setOk(this.approval.selected),net.socket.write(93,e.toArrayBuffer()),Guild.needApproval=this.approval.selected},n}(e.FitComponent);e.GuildApplicant=t,__reflect(t.prototype,"UI.GuildApplicant",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="GuildApplicantItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){this.data.offlineTime>0?(this.currentState="offline",this.txtOffline=FormatDDHH(60*this.data.offlineTime)):(this.currentState="online",this.txtOffline=lang.String("online")),0==this.data.vipLevel?this.vipIcon=null:this.vipIcon=Vip.getVipIcon(this.data.vipLevel)},t}(eui.ItemRenderer);e.GuildApplicantItem=t,__reflect(t.prototype,"UI.GuildApplicantItem")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.radioGroup=new eui.RadioButtonGroup,t.skinName="GuildAppointmentSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(){this.radioLeader.group=this.radioGroup,this.radioVice.group=this.radioGroup,this.radioMem.group=this.radioGroup},t.prototype.setAppointName=function(e,t){this.name=e,this.position=t,this.txtPos=lang.String(Guild.PositionName[t])},t.prototype.onRemoveFromStage=function(){this.name=null,this.position=null},t.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close();break;case this.btnAppoint:if(this.radioGroup.selectedValue==this.position)return void PopUpMessage.push(lang.String("guild appoint same warn"),color.RED);var t=new net.def.C2SGuildAppoint;t.setName(this.name),t.setPos(this.radioGroup.selectedValue),net.socket.write(85,t.toArrayBuffer()),UIManager.pop(this),net.socket.write(88,null)}},t.prototype.close=function(){UIManager.pop(this)},t}(e.FitComponent);e.GuildAppointment=t,__reflect(t.prototype,"UI.GuildAppointment",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="GuildbuffSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.onAddToStage()},n.prototype.onAddToStage=function(){this.UpdateGuildSkillUI(),Player.instance.guildPos==Guild.GuildPosition.GuildPos_Leader||Player.instance.guildPos==Guild.GuildPosition.GuildPos_ViceLeader?this.btnOpenGuildSkillPage.visible=!0:this.btnOpenGuildSkillPage.visible=!1,Game.dispatcher.addEventListener(Game.EVENT.GuildLevelUp,this.UpdateGuildSkillUI,this),Game.dispatcher.addEventListener(Game.EVENT.UpdateUsingGuildSkill,this.UpdateGuildSkillUI,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.GuildLevelUp,this.UpdateGuildSkillUI,this),Game.dispatcher.removeEventListener(Game.EVENT.UpdateUsingGuildSkill,this.UpdateGuildSkillUI,this)},n.prototype.InitGuildSkillUI=function(){this.skillname0=lang.String("GuildSkill_NoUsingSkill"),this.skillname1=lang.String("GuildSkill_NoUsingSkill"),this.skillname2=lang.String("GuildSkill_NoUsingSkill"),this.skillname3=lang.String("GuildSkill_NoUsingSkill"),this.SkillLv0="",this.SkillLv1="",this.SkillLv2="",this.SkillLv3=""},n.prototype.UpdateGuildSkillUI=function(){if(this.InitGuildSkillUI(),Guild.usingSkill&&Guild.HasGuildSkill()){var e=table.mapGuildSkill;this.skillicon0.source=table.mapGuildSkill[0].icon,this.skillname0=table.mapGuildSkill[0].name,this.SkillLv0="Lv"+Guild.guildInfo.level,Guild.usingSkill[0]>0&&(this.skillname1=e[Guild.usingSkill[0]].name,this.skillicon1.source=e[Guild.usingSkill[0]].icon,this.SkillLv1="Lv:"+Guild.GetGuildSkillLv(Guild.usingSkill[0])),Guild.usingSkill[1]>0&&(this.skillname2=e[Guild.usingSkill[1]].name,this.skillicon2.source=e[Guild.usingSkill[1]].icon,this.SkillLv2="Lv:"+Guild.GetGuildSkillLv(Guild.usingSkill[1])),Guild.usingSkill[2]>0&&(this.skillname3=e[Guild.usingSkill[2]].name,this.skillicon3.source=e[Guild.usingSkill[2]].icon,this.SkillLv3="Lv:"+Guild.GetGuildSkillLv(Guild.usingSkill[2]))}},n.prototype.onTouchTap=function(t){var n=-1;switch(t.target){case this.btnDesc:var i=new e.Rule;i.skinName="GuildRulesSkin",i.currentState="GuildSkillDesc",UIManager.push(i);break;case this.skillicon0:n=0;break;case this.skillicon1:n=1;break;case this.skillicon2:n=2;break;case this.skillicon3:n=3}0>n||(Guild.usingSkill[n-1]>0||0>=n)&&(0==n?e.GuildSkillDescPad.instance.Show(0):e.GuildSkillDescPad.instance.Show(Guild.usingSkill[n-1]))},n}(eui.Component);e.Guildbuff=t,__reflect(t.prototype,"UI.Guildbuff",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="ChamberTaskSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),n.open=function(){return null==this._instance&&(this._instance=new n),UIManager.pushPage(this._instance),this._instance},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.GuildBusiTaskDataChange,this.onDataChanged,this),Game.dispatcher.addEventListener(Game.EVENT.AddItem,this.onDataChanged,this),Game.dispatcher.addEventListener(Game.EVENT.RemoveItem,this.onDataChanged,this),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,this.onDataChanged,this),this.taskList.itemRenderer=e.GuildBusiTaskItem,this.onDataChanged()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.GuildBusiTaskDataChange,this.onDataChanged,this),Game.dispatcher.removeEventListener(Game.EVENT.AddItem,this.onDataChanged,this),Game.dispatcher.removeEventListener(Game.EVENT.RemoveItem,this.onDataChanged,this),Game.dispatcher.removeEventListener(Game.EVENT.UpdateItem,this.onDataChanged,this)},n.prototype.onTouchTap=function(t){switch(t.target){case this.imgClose:this.close();break;case this.btnApply:this.onFinalAward();break;case this.btnbusitaskMaterial:e.ResourceObtain.Open([e.ObtResId.busitask]);break;case this.btnHelpOthers:Guild.onCity2GuildMain(),UIManager.pop(this)}},n.prototype.close=function(){UIManager.pop(this)},n.prototype.onDataChanged=function(){this.times=Guild.GetBusiTaskSeekHelp(),this.FinishCount=Guild.busiTaskData.finishCount,this.TotalCount=table.guildBusiTask.taskCountPerDay,this.listData=[];for(var e=0;e<table.guildBusiTask.taskCountPerDay;e++)this.listData.push({index:e,TaskId:Guild.busiTaskData.taskId[e]});var t=this.taskList.dataProvider;null==t?this.taskList.dataProvider=new eui.ArrayCollection(this.listData):t.replaceAll(this.listData),0==Guild.busiTaskData.finalAward?(this.btnApply.label="Giao nhiệm vụ",this.FinishCount>=this.TotalCount?this.btnApply.enabled=!0:this.btnApply.enabled=!1):(this.btnApply.label="Đã nhận thưởng",this.btnApply.enabled=!1)},n.prototype.onFinalAward=function(){if(!(this.FinishCount<this.TotalCount)){var e=new net.def.C2SGuildBusiTaskReq;e.setType(5),net.socket.write(2015,e.toArrayBuffer())}},n}(e.FitComponent);e.GuildBusiTask=t,__reflect(t.prototype,"UI.GuildBusiTask",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="SeekHelpListSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),n.open=function(e){return null==this._instance&&(this._instance=new n),this._instance.SetKey(e),UIManager.pushPage(this._instance),this._instance},n.prototype.SetKey=function(e){this.key=e},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.SyncGuildMemberList,this.onDataChanged,this),Game.dispatcher.addEventListener(Game.EVENT.GuildBusiTaskDataChange,this.onDataChanged,this),this.taskList.itemRenderer=e.GuildBusiTaskHelpItem,this.onDataChanged()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.SyncGuildMemberList,this.onDataChanged,this),Game.dispatcher.removeEventListener(Game.EVENT.GuildBusiTaskDataChange,this.onDataChanged,this)},n.prototype.onTouchTap=function(e){},n.prototype.close=function(){UIManager.pop(this)},n.prototype.onDataChanged=function(){for(var e=null,t=0;t<Guild.MemberList.length;t++)if(this.key==Guild.MemberList[t].name){e=Guild.MemberList[t];break}if(null==e)return this.guildname="",void(this.taskList.dataProvider=new eui.ArrayCollection([]));this.leftSeekCount="Trợ giúp: "+Guild.GetBusiTaskHelpOthers(),this.guildname=lang.StringWithFormat("guild busi task seeklist name",e.name),this.dataList=[];for(var t=0;t<e.seekhelp.length;t++)this.dataList.push({Name:e.name,TaskId:e.seekhelp[t],Status:e.seekHelpStatus[t]});var n=this.taskList.dataProvider;null==n?this.taskList.dataProvider=new eui.ArrayCollection(this.dataList):n.replaceAll(this.dataList)},n}(e.FitComponent);e.GuildBusiTaskHelp=t,__reflect(t.prototype,"UI.GuildBusiTaskHelp",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="SeekHelpListItemSkin",e}return __extends(n,t),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this)},n.prototype.onTouchTap=function(t){var n=this,i=table.guildBusiTask.taskList[this.data.TaskId],a=PlayerAttribute.bag.findBagItem(i.genre,i.detailType);switch(t.target){case this.btnFinish:if(Guild.GetBusiTaskHelpOthers()<=0)return;if(null==a||a.Item.Count<i.count){var r=lang.String("guild busi task"),o=lang.StringWithFormat("guild busi task help cost money",table.guildBusiTask.fastHelpCost);
return PlayerAttribute.currency[Game.Currency.SilverCoin]<table.guildBusiTask.fastHelpCost&&(o+=lang.StringWithFormat("if replace {1} silver with gold",table.guildBusiTask.fastHelpCost-PlayerAttribute.currency[Game.Currency.SilverCoin])),void e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],r,o,function(){if(table.guildBusiTask.fastHelpCost-PlayerAttribute.currency[Game.Currency.SilverCoin]>PlayerAttribute.currency[Game.Currency.GoldCoin])return PopUpMessage.push(lang.String("not enough silvercoin"),color.RED),!0;var e=new net.def.C2SGuildBusiTaskReq;return e.setType(4),e.setName(n.data.Name),e.setIndex(n.data.TaskId),net.socket.write(2015,e.toArrayBuffer()),!0},null,null)}var s=new net.def.C2SGuildBusiTaskReq;s.setType(3),s.setName(this.data.Name),s.setIndex(this.data.TaskId),net.socket.write(2015,s.toArrayBuffer());break;case this.item:var l=PlayerAttribute.bag.getCount(i.genre,i.detailType);e.ItemTips.instance.data={type:"item",content:{genre:i.genre,detailType:i.detailType,count:l}},UIManager.push(e.ItemTips.instance)}},n.prototype.dataChanged=function(){var e=table.guildBusiTask.taskList[this.data.TaskId],t=table.props[e.genre][e.detailType];null!=t&&(this.desc=t.name+"x"+e.count,this.item.icon=t.source,this.item.quality=t.quality,this.have=lang.StringWithFormat("guild busi task have item count",PlayerAttribute.bag.getCount(e.genre,e.detailType)),0!=this.data.Status?(this.btnFinish.label="Đã xong",this.btnFinish.enabled=!1):(this.btnFinish.label="Giao hàng",this.btnFinish.enabled=Guild.GetBusiTaskHelpOthers()>0))},n}(eui.ItemRenderer);e.GuildBusiTaskHelpItem=t,__reflect(t.prototype,"UI.GuildBusiTaskHelpItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="ChamberTaskItemSkin",e}return __extends(n,t),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this)},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnSeekHelp:this.onSeekHelp();break;case this.btnFinish:this.onFinishTask();break;case this.item:this.onClickItem()}},n.prototype.onSeekHelp=function(){var e=new net.def.C2SGuildBusiTaskReq;e.setType(2),e.setIndex(this.data.TaskId),net.socket.write(2015,e.toArrayBuffer())},n.prototype.onFinishTask=function(){var e=new net.def.C2SGuildBusiTaskReq;e.setType(1),e.setIndex(this.data.index),net.socket.write(2015,e.toArrayBuffer())},n.prototype.onClickItem=function(){var t=table.guildBusiTask.taskList[this.data.TaskId],n=PlayerAttribute.bag.getCount(t.genre,t.detailType);e.ItemTips.instance.data={type:"item",content:{genre:t.genre,detailType:t.detailType,count:n}},UIManager.push(e.ItemTips.instance)},n.prototype.dataChanged=function(){for(var e=table.guildBusiTask.taskList[this.data.TaskId],t=!1,n=0;n<Guild.busiTaskData.seekHelp.length;n++)if(Guild.busiTaskData.seekHelp[n]==this.data.TaskId){t=!0;break}0==Guild.busiTaskData.taskStatus[this.data.index]?(this.btnSeekHelp.visible=!0,t?(this.btnSeekHelp.label="Đã cầu cứu",this.btnSeekHelp.enabled=!1):this.btnSeekHelp.enabled=Guild.busiTaskData.finishCount<table.guildBusiTask.taskCountPerDay&&Guild.GetBusiTaskSeekHelp()>0,this.btnFinish.label="Giao hàng",this.btnFinish.enabled=Guild.busiTaskData.finishCount<table.guildBusiTask.taskCountPerDay):(this.btnSeekHelp.visible=!1,this.btnFinish.label="Đã xong",this.btnFinish.enabled=!1);var i=table.props[e.genre][e.detailType];null!=i&&(this.desc=i.name+"x"+e.count,this.have=lang.StringWithFormat("guild busi task have item count",PlayerAttribute.bag.getCount(e.genre,e.detailType)),this.item.icon=i.source,this.item.quality=i.quality)},n}(eui.ItemRenderer);e.GuildBusiTaskItem=t,__reflect(t.prototype,"UI.GuildBusiTaskItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="GuildCheckBoxSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.onTouchTap=function(e){switch(e.target){case this.btnClose:case this.imgClose:this.close();break;case this.btnSure:this.onSure()}},t.prototype.close=function(){UIManager.pop(this)},t.prototype.onSure=function(){return PlayerAttribute.currency[Game.Currency.GoldCoin]<Guild.Drink_GoldCoin?void PopUpMessage.push(lang.String("not enough goldcoin"),color.RED):this.param>=200?void PopUpMessage.push(lang.String("guild drink max warn"),color.RED):(net.socket.write(96,null),void this.close())},t}(e.FitComponent);e.GuildCheckBox=t,__reflect(t.prototype,"UI.GuildCheckBox",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="GuildCreatSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close();break;case this.btnCreat:switch(this.currentState){case"rename":this.onRename();break;default:this.onCreate()}}},n.prototype.close=function(){UIManager.pop(this)},n.prototype.onRemoveFromStage=function(){this.textInput.text=null},n.prototype.onCreate=function(){var t=this;if(""!=Player.instance.guildName)return void UIManager.pop(this);if(""==this.textInput.text)return void PopUpMessage.push(lang.String("guild input guildname warn"),color.RED);if(Guild.costCoin-PlayerAttribute.currency[Game.Currency.SilverCoin]>PlayerAttribute.currency[Game.Currency.GoldCoin])return void PopUpMessage.push(lang.String("not enough silvercoin"),color.RED);if(PlayerAttribute.currency[Game.Currency.SilverCoin]<Guild.costCoin){var n=lang.String("operation confirm"),i=lang.StringWithFormat("if replace {1} silver with gold",Guild.costCoin-PlayerAttribute.currency[Game.Currency.SilverCoin]),a=function(){var n=new net.def.Name;return n.setName(t.textInput.text),net.socket.write(81,n.toArrayBuffer()),UIManager.pop(t),UIManager.pop(e.GuildEnroll.instance),!0},r=function(){return UIManager.pop(t),UIManager.pop(e.GuildEnroll.instance),!0};return void e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],n,i,a,r,null)}var o=new net.def.Name;o.setName(this.textInput.text),net.socket.write(81,o.toArrayBuffer()),UIManager.pop(this),UIManager.pop(e.GuildEnroll.instance)},n.prototype.onRename=function(){if(Player.instance.guildPos!=Guild.GuildPosition.GuildPos_Leader)return void UIManager.pop(this);if(""==this.textInput.text)return void PopUpMessage.push(lang.String("guild input guildname warn"),color.RED);if(PlayerAttribute.currency[Game.Currency.GoldCoin]<Guild.costCoin)return void PopUpMessage.push(lang.String("not enough goldcoin"),color.RED);var e=new net.def.Name;e.setName(this.textInput.text),net.socket.write(84,e.toArrayBuffer()),UIManager.pop(this)},n}(e.FitComponent);e.GuildCreat=t,__reflect(t.prototype,"UI.GuildCreat",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="GuildDonateSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onAddToStage=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),GuildDonateMgr.RequestDonatedCount()},n.prototype.onRemoveFromStage=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this)},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnGoldDonate:UIManager.pushPage(e.GuildDonateGoldCoin.instance),e.GuildDonateGoldCoin.instance.UpdateCountState();break;case this.btnSilverDonate:UIManager.pushPage(e.GuildDonateSilverCoin.instance),e.GuildDonateSilverCoin.instance.UpdateCountState()}},n.prototype.close=function(){UIManager.pop(this)},n.prototype.UpdateDonateState=function(){this.txtGoldCount.text=GuildDonateMgr.GetGoldDonateStateString(),this.txtSilverCount.text=GuildDonateMgr.GetSilverDonateStateString()},n._instance=null,n}(e.FitComponent);e.GuildDonate=t,__reflect(t.prototype,"UI.GuildDonate",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var table;!function(e){function t(){var e,t="public_config/mapeffect.json";e=RES.getRes(t),null==e&&egret.error("cannot load config:",t),MapEffect.cfg={};for(var n=0;n<e.length;n++){var i=e[n];MapEffect.cfg[i.templeteID]=i}}e.LoadMapEffectConfig=t}(table||(table={}));var MapEffect;!function(e){function t(t){var n=e.cfg[t.templeteId],a=n.totalTimeMs-t.timepass;a>0&&i(t.id,new egret.Point(t.x,t.y),n.resname,a,n.animationName,n.playtimes,t.timepass)}function n(t){for(var n in e.MapEffectBuffer)delete e.MapEffectBuffer[n];for(var a=0;a<t.effects.length;a++){var r=t.effects[a],o=e.cfg[r.templeteId],s=o.totalTimeMs-r.timepass;s>0&&i(r.id,new egret.Point(r.x,r.y),o.resname,s,o.animationName,o.playtimes,r.timepass)}}function i(t,n,i,a,r,o,s){var l=new ECS.GameObject,u=ECS.Transform.generate(l);u.x=n.x,u.y=n.y;var c=ECS.DragonBoneRenderer.generate(i,l);c.playTimes=null!=o?o:-1,c.gotoTime=null!=s?s:0,c.animationName=null!=r?r:"",c.onloaded=function(){var e=c.armatureDisplay;e.touchEnabled=!1,Scene.addChildToGround(e)};var h=ECS.LifeTimeComponent.generate(a,l);l.addComponent(u),l.addComponent(c),l.addComponent(h),ECS.world.add(l),e.MapEffectBuffer[t]=l,MakeDelayExecute(function(){null!=e.MapEffectBuffer[t]&&delete e.MapEffectBuffer[t]},null,a)}function a(t){null!=e.MapEffectBuffer[t]&&(e.MapEffectBuffer[t].destory(),delete e.MapEffectBuffer[t])}function r(){for(var t in e.MapEffectBuffer)e.MapEffectBuffer[t].destory();e.MapEffectBuffer={}}e.MapEffectBuffer={},e.OnSyncOneMapEffect=t,e.OnSyncAllMapEffect=n,e.CreateGlobalDragonBoneEffect=i,e.RemoveEffect=a,e.RemoveAll=r}(MapEffect||(MapEffect={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="GuildDonateGoldCoinSkin",t.currentState="goldCoin",t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.getDonateCurrencyType=function(){return Game.Currency.GoldCoin},t.prototype.getVipDonateCountMax=function(){var e=GuildDonateMgr.GetVipDonateCountMax();return e?e.goldCount:0},t.prototype.getDonatedCount=function(){return GuildDonateMgr.GetGoldDonatedCount()},t.prototype.getDonateInfoMap=function(){return table.mapGoldDonateInfo},t._instance=null,t}(e.GuildDonateCoin);e.GuildDonateGoldCoin=t,__reflect(t.prototype,"UI.GuildDonateGoldCoin")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="GuildDonateGoldCoinSkin",t.currentState="silverCoin",t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.getDonateCurrencyType=function(){return Game.Currency.SilverCoin},t.prototype.getVipDonateCountMax=function(){var e=GuildDonateMgr.GetVipDonateCountMax();return e?e.silverCount:0},t.prototype.getDonatedCount=function(){return GuildDonateMgr.GetSilverDonatedCount()},t.prototype.getDonateInfoMap=function(){return table.mapSilverDonateInfo},t._instance=null,t}(e.GuildDonateCoin);e.GuildDonateSilverCoin=t,__reflect(t.prototype,"UI.GuildDonateSilverCoin")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="GuildDungeonPageSkin",e.difficultName1=GuildDungeon.DungeonLevelName[0],e.difficultName2=GuildDungeon.DungeonLevelName[1],e.difficultName3=GuildDungeon.DungeonLevelName[2],e.loaded=!1,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.awardList0.dataProvider=new eui.ArrayCollection(GuildDungeon.awardsConfig[0]),this.awardList1.dataProvider=new eui.ArrayCollection(GuildDungeon.awardsConfig[1]),this.awardList2.dataProvider=new eui.ArrayCollection(GuildDungeon.awardsConfig[2])},n.prototype.onAddToStage=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.OnTouchTap,this),Game.dispatcher.addEventListener(Game.EVENT.AddItem,this.itemCountChange,this),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,this.itemCountChange,this),this.cbDiff=[],this.cbDiff.push(this.cbDiff1),this.cbDiff.push(this.cbDiff2),this.cbDiff.push(this.cbDiff3),this.loaded=!0,this.UpdatePage(),(Game.getServerDate().getDate()!=GuildDungeon.lastSyncTime.getDate()||Game.getServerDate().getHours()>=4&&GuildDungeon.lastSyncTime.getHours()<4)&&net.socket.write(2083,null)},n.prototype.onRemoveFromStage=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.OnTouchTap,this),Game.dispatcher.removeEventListener(Game.EVENT.AddItem,this.itemCountChange,this),Game.dispatcher.removeEventListener(Game.EVENT.UpdateItem,this.itemCountChange,this)},n.prototype.UpdateLead=function(e){var t="1:"+GuildDungeon.szMysteryLead[e[0]-1]+"\n";t+="2:"+GuildDungeon.szMysteryLead[e[1]-1]+"\n",t+="3:"+GuildDungeon.szMysteryLead[e[2]-1]+"\n",t+="4:"+GuildDungeon.szMysteryLead[e[3]-1]+"\n",this.labelDescLead.text=t},n.prototype.UpdatePage=function(){if(this.UpdateLead(GuildDungeon.randomList[GuildDungeon.randomBossPos]),GuildDungeon.dailyAwarded>=GuildDungeon.MaxDailyAward)this.limitWarrning.visible=!0,this.view.alpha=.5,this.lableflopTimes.text="0",this.lableflopTimes.textColor=color.RED;else{this.limitWarrning.visible=!1,this.view.alpha=1;var e=GuildDungeon.MaxDailyAward-GuildDungeon.dailyAwarded;this.lableflopTimes.text=e.toString(),this.lableflopTimes.textColor=color.WHITE}this.UpdateMaxDifficult(),this.UpdateCostItem(),0==GuildDungeon.open?this.currentState="openDungeon":(this.currentState="joinDungeon",this.UpdateRunningInfo())},n.prototype.UpdateRunningInfo=function(){this.cbCheck.label=GuildDungeon.DungeonLevelName[GuildDungeon.runningLevel],this.txtOpenPlayer.text=GuildDungeon.openByWhom,this.view.selectedIndex=GuildDungeon.runningLevel},n.prototype.UpdateCostItem=function(){var e=PlayerAttribute.bag.CalcCount(14,2020);this.txtCostItem.text=e.toString()+"/"+GuildDungeon.itemCost,this.txtCostItem.textColor=color.GREEN,e<GuildDungeon.itemCost&&(this.txtCostItem.textColor=color.RED)},n.prototype.itemCountChange=function(e){if(null!=e){var t=e.data.Item;14==t.Type&&2020==t.DetailType&&this.UpdateCostItem()}},n.prototype.UpdateMaxDifficult=function(){this.difficultSelected=GuildDungeon.currentMaxDungeonLevel;for(var e=0;e<this.cbDiff.length;e++)this.cbDiff[e].selected=!1,this.difficultSelected<e?this.cbDiff[e].enabled=!1:this.cbDiff[e].enabled=!0;this.cbDiff[this.difficultSelected].selected=!0,this.view.selectedIndex=this.difficultSelected},n.prototype.OnChooseDiff=function(e){this.difficultSelected=e,this.cbDiff[e].selected=!0,this.view.selectedIndex=e},n.prototype.OnTouchTap=function(t){switch(t.target){case this.cbDiff1:this.OnChooseDiff(0);break;case this.cbDiff2:this.OnChooseDiff(1);break;case this.cbDiff3:this.OnChooseDiff(2);break;case this.btnGO:if(PlayerAttribute.Level<GuildDungeon.needPlayerLevel)return void PopUpMessage.push("Chưa đạt Lv50, không thể vào phó bản!",color.RED);0==GuildDungeon.open?GuildDungeon.OpenDungeon(this.difficultSelected):GuildDungeon.JoinDungeon();break;case this.btnRules:var n=new e.Rule;n.skinName="GuildDungeonRule",UIManager.push(n);break;case this.btnBuyTicket:e.ResourceObtain.Open([e.ObtResId.guilddungeonTicket]);break;case this.imgClose:this.close()}},n}(e.FitComponent);e.GuildDungeonPage=t,__reflect(t.prototype,"UI.GuildDungeonPage",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="GuildDungeonResultSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onTap=function(){UIManager.pop(this)},n.prototype.onAddToStage=function(){1==this.win?this.currentState="succeed":this.currentState="failed",0==this.normaldata.length?this.normalList.visible=!1:(this.normalList.itemRenderer=e.AwardCell,this.normalList.dataProvider=new eui.ArrayCollection(this.normaldata)),0==this.ownerData.length?this.ownerGroup.visible=!1:(this.ownerGroup.visible=!0,this.ownerList.itemRenderer=e.AwardCell,this.ownerList.dataProvider=new eui.ArrayCollection(this.ownerData))},n.prototype.show=function(e,t,n){this.win=n,this.normaldata=e,this.ownerData=t},n.prototype.onTouchTap=function(e){UIManager.pop(this)},n}(e.FitComponent);e.GuildDungeonResult=t,__reflect(t.prototype,"UI.GuildDungeonResult",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.selectName="",e.skinName="GuildEnrollSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.otherslist.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchList,this)},n.prototype.onTouchList=function(){this.selectName=this.otherslist.selectedItem.name;this.otherslist.selectedItem},n.prototype.onTouchTap=function(t){switch(t.target){case this.imgClose:this.close();break;case this.creatGuild:UIManager.pushPage(e.GuildCreat.instance);break;case this.btnSearch:UIManager.pushPage(new e.guildSearchUI)}},n.prototype.close=function(){UIManager.pop(this),""!=Player.instance.guildName&&Guild.openGuildHome()},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.GuildQuit,this.close,this),Game.dispatcher.addEventListener(Game.EVENT.SyncGuildList,this.listChange,this),""!=Player.instance.guildName?this.creatGuild.visible=!1:this.creatGuild.visible=!0},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.GuildQuit,this.close,this),Game.dispatcher.removeEventListener(Game.EVENT.SyncGuildList,this.listChange,this),this.otherslist.selectedIndex=null,this.selectName="",this.applyState=null,this.otherState=null},n.prototype.listChange=function(){var t=Guild.appliedGuild,n=Guild.othersGuild;t.length>0&&(this.applyState=lang.String("guild applying guild"),this.otherState=lang.String("guild non-applied guild")),this.appliedlist.itemRenderer=e.GuildItem,t.sort(this.sortGuildsByMemberCount),this.appliedlist.dataProvider=new eui.ArrayCollection(t),this.otherslist.itemRenderer=e.GuildItem;for(var i=[],a=[],r=0;r<n.length;r++)n[r].name==Player.instance.guildName?i.push(n[r]):a.push(n[r]);i.push.apply(i,a),this.otherslist.dataProvider=new eui.ArrayCollection(i)},n.prototype.sortGuildsByMemberCount=function(e,t){return e.name==Player.instance.guildName?-1:t.name==Player.instance.guildName?1:e.memberCount==Guild.maxMembercounts[e.level]?1:t.memberCount==Guild.maxMembercounts[t.level]?-1:e.level!=t.level?e.level-t.level:t.memberCount-e.memberCount},n}(e.FitComponent);e.GuildEnroll=t,__reflect(t.prototype,"UI.GuildEnroll",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=50,n=30,i=14,a=48,r=500,o=function(o){function s(){var e=o.call(this)||this;return e.moves=0,e.skinName="GuildGardenSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.pos=0,e.timer=new egret.Timer(r,-1),e.timer.addEventListener(egret.TimerEvent.TIMER,e.onTimer,e),e}return __extends(s,o),Object.defineProperty(s,"instance",{get:function(){return null==this._instance&&(this._instance=new s),this._instance},enumerable:!0,configurable:!0}),s.prototype.onGuildLevelUp=function(){if(!Guild.guildInfo)return void(this.bonus="0%");var e=Guild.guildInfo.level;e>=5?this.bonus="20%":e>=3?this.bonus="10%":this.bonus="0%"},s.prototype.onTouchTap=function(t){switch(t.target){case this.btnRotate:if(null==Player.instance.guildName||""==Player.instance.guildName)return void PopUpMessage.push(lang.String("no guild"),color.RED);if(this.currency<PrizeWheel.cost)return void e.ResourceObtain.Open([e.ObtResId.guildcontribute]);this.btnRotate.enabled=!1,this.state=0,this.timer.delay=.3*r,this.moves=0,this.dest=null,this.timer.reset(),this.timer.start(),PrizeWheel.roll();break;case this.btnGainRes:e.ResourceObtain.Open([e.ObtResId.guildcontribute]);break;case this.imgClose:UIManager.pop(this);break;case this.btnClose:UIManager.pop(this)}},s.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.SyncGuildInfo,this.onGuildLevelUp,this),Game.dispatcher.addEventListener(Game.EVENT.CurrencyChange[Game.Currency.GuildContribution],this.onGuildCurrency,this),Game.dispatcher.addEventListener(Game.EVENT.SyncPrizeWheel,this.onSyncPrizeWheel,this),Game.dispatcher.addEventListener(Game.EVENT.NotifyPrizeWheelResult,this.onNotifyPrizeWheelResult,this),this.cost=PrizeWheel.cost,this.onSyncPrizeWheel(),this.onGuildCurrency(),this.onGuildLevelUp(),this.result&&this.timer.start()},s.prototype.onRemoveFromStage=function(){this.timer.stop(),Game.dispatcher.removeEventListener(Game.EVENT.SyncGuildInfo,this.onGuildLevelUp,this),Game.dispatcher.removeEventListener(Game.EVENT.CurrencyChange[Game.Currency.GuildContribution],this.onGuildCurrency,this),Game.dispatcher.removeEventListener(Game.EVENT.SyncPrizeWheel,this.onSyncPrizeWheel,this),Game.dispatcher.removeEventListener(Game.EVENT.NotifyPrizeWheelResult,this.onNotifyPrizeWheelResult,this)},s.prototype.onGuildCurrency=function(){this.currency=PlayerAttribute.currency[Game.Currency.GuildContribution]},s.prototype.onNotifyPrizeWheelResult=function(e){this.result=e.data},s.prototype.onSyncPrizeWheel=function(){this.onRefreshDayCount();for(var e=this.wheel.numChildren,t=0;e>t;t++){var n=this.wheel.getChildAt(t);n.data=PrizeWheel.prizes[PrizeWheel.cell[t]]}},s.prototype.onRefreshDayCount=function(){this.dayCountLimit=PrizeWheel.getLetfCount(),this.dayCountLimit<=0?this.btnRotate.enabled=!1:this.btnRotate.enabled=!0},s.prototype.onTimer=function(){var e=this;switch(this.state){case 1:this.timer.delay=~~Math.min(this.timer.delay+1.3*n,r);break;case 0:this.timer.delay=Math.max(this.timer.delay-n,t)}var o=this.wheel.numChildren,s=this.pos;this.pos=(this.pos+1)%o;var l=this.wheel.getChildAt(s);l.selected=!1;var u=this.wheel.getChildAt(this.pos);u.selected=!0,null==this.dest&&PrizeWheel.cell[this.pos]==this.result&&(this.dest=this.pos),null!=this.dest&&0==this.state&&this.moves>a&&i<=Math.abs(this.dest-this.pos+o)%o&&(this.state=1,this.moves=0),1==this.state&&this.dest==this.pos&&(egret.setTimeout(function(){e.onRefreshDayCount(),PrizeWheel.draw()},null,300),this.result=null,this.dest=null,this.timer.stop()),this.moves++},s}(e.FitComponent);e.GuildGarden=o,__reflect(o.prototype,"UI.GuildGarden",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="GuildGiftSkin",e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.UpdateGiftList()},n.prototype.UpdateGiftList=function(){this.giftListData=[{name:lang.String("guild shop"),btnName:lang.String("go"),info:"",actType:e.GuildHome.ActShop},{name:lang.String("guild salary"),btnName:lang.String("details"),info:Guild.GetCurrentSalaryDesc(),actType:e.GuildHome.ActSalary},{name:"Rèn Bang",btnName:"Đi",info:"",actType:e.GuildHome.ActEquipBuild}],this.giftList.itemRenderer=e.GuildActivityItem,this.giftList.dataProvider=new eui.ArrayCollection(this.giftListData)},n}(eui.Component);e.GuildGift=t,__reflect(t.prototype,"UI.GuildGift",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.guildInfo=new Guild.guild,e.maxMemcount=0,e.reputation=0,e.weeklyReputation=0,e.maxReputation=0,e.skinName="GuildHomeSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.GuildQuit,this.close,this),Game.dispatcher.addEventListener(Game.EVENT.SyncGuildInfo,this.setGuildInfo,this),Game.dispatcher.addEventListener(Game.EVENT.GuildLevelUp,this.setGuildInfo,this),Game.dispatcher.addEventListener(Game.EVENT.CurrencyChange[Game.Currency.GuildContribution],this.onContributionChanged,this),Game.dispatcher.addEventListener(Game.EVENT.SyncGuildMemberList,this.updateMemberCount,this),this.pageGuildbuff.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),Player.instance.guildPos!=Guild.GuildPosition.GuildPos_Member?(this.btnChange.visible=!0,this.btnRename.visible=Guild.canRename):(this.btnChange.visible=!1,this.btnRename.visible=!1),this.changePage(0),SecondTicker.addEventListener(this.onUpdate,this),0==Guild.inactiveness?this.txtInactiveness="":this.txtInactiveness=lang.String("guild inactiveness announce");var t=egret.localStorage.getItem("needShowGuildAnnounce");"1"==t&&(egret.localStorage.setItem("needShowGuildAnnounce","0"),UIManager.pushPage(new e.GuildInfoChange("display"))),this.UpdateGuildFund(),this.onContributionChanged()},n.prototype.onRemoveFromStage=function(){this.pageGuildbuff.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),Game.dispatcher.removeEventListener(Game.EVENT.SyncGuildMemberList,this.updateMemberCount,this),Game.dispatcher.removeEventListener(Game.EVENT.SyncGuildInfo,this.setGuildInfo,this),Game.dispatcher.removeEventListener(Game.EVENT.GuildLevelUp,this.setGuildInfo,this),Game.dispatcher.removeEventListener(Game.EVENT.CurrencyChange[Game.Currency.GuildContribution],this.onContributionChanged,this),Game.dispatcher.removeEventListener(Game.EVENT.GuildQuit,this.close,this),SecondTicker.removeEventListener(this.onUpdate,this),this.ClearRadioBtnSelect()},n.prototype.onTouchTap=function(t){switch(t.target){case this.pageGuildbuff.btnOpenGuildSkillPage:UIManager.pushPage(e.GuildSkill.instance);break;case this.btnChange:UIManager.pushPage(new e.GuildInfoChange("modify"));break;case this.imgClose:this.close();break;case this.btnotherGuild:Guild.openGuildEnroll(),UIManager.pop(this);break;case this.btnMembers:this.view.selectedIndex=n.PageMember;break;case this.btnActicity:this.view.selectedIndex=n.PageActivity;break;case this.btnGift:this.view.selectedIndex=n.PageGift;break;case this.btnTask:this.view.selectedIndex=n.PageTask;break;case this.btnSkill:this.view.selectedIndex=n.PageGuildSkill,this.pageGuildbuff.UpdateGuildSkillUI();break;case this.btnRules:var i=new e.Rule;i.skinName="GuildRulesSkin",i.currentState="guildInfo",UIManager.pushPage(i);break;case this.btnDonate:UIManager.pushPage(e.GuildDonate.instance);break;case this.btnRename:e.ChangeName.Open("guild")}},n.prototype.setGuildInfo=function(){this.guildInfo=Guild.guildInfo,this.guildLevel=lang.Format("Lv{1}",this.guildInfo.level),this.maxMemcount=Guild.maxMembercounts[this.guildInfo.level],this.maxReputation=Guild.maxReputations[this.guildInfo.level],this.reputation=Guild.reputation,this.weeklyReputation=Guild.weeklyReputation,this.bar1.value=Guild.weeklyReputation,this.pageGuildGift.UpdateGiftList(),""!=Guild.announce?this.guildIntro.prompt=Game.Unescape(Guild.announce):this.guildIntro.prompt=lang.String("guild input guildannounce default"),this.btnRename.visible=Guild.canRename},n.prototype.updateMemberCount=function(){var e=0;for(var t in Guild.MemberList)Guild.MemberList[t].offlineTime<=0&&e++;this.txtGuildOnline=""+e},n.prototype.onUpdate=function(){},n.prototype.changePage=function(e){switch(e){case n.PageMember:this.btnMembers.selected=!0,this.view.selectedIndex=e;break;case n.PageActivity:this.btnActicity.selected=!0,this.view.selectedIndex=e;break;case n.PageGift:this.btnGift.selected=!0,this.view.selectedIndex=e;break;case n.PageGuildSkill:this.btnSkill.selected=!0,this.view.selectedIndex=e;break;case n.PageTask:this.ClearRadioBtnSelect(),this.view.selectedIndex=e;break;case n.PageToast:this.ClearRadioBtnSelect(),this.view.selectedIndex=e}},n.prototype.ClearRadioBtnSelect=function(){this.btnSkill&&(this.btnSkill.selected=!1),this.btnGift&&(this.btnGift.selected=!1),this.btnMembers&&(this.btnMembers.selected=!1),this.btnActicity&&(this.btnActicity.selected=!1)},n.prototype.OpenGardenPage=function(){UIManager.pushPage(e.GuildGarden.instance)},n.prototype.onContributionChanged=function(){this.txtContribution.text=PlayerAttribute.currency[Game.Currency.GuildContribution].toString()+"/"+n.MAX_DEVOTE_CONTRIBUTION},n.prototype.UpdateGuildFund=function(){this.txtFund=Guild.fund.toString()},n.prototype.close=function(){UIManager.pop(this)},n.ActTask=0,n.ActToast=1,n.ActWheel=2,n.ActShop=3,n.ActForge=4,n.ActSalary=5,n.ActBusiTask=6,n.ActEquipBuild=7,n.ActGuildDungeon=8,n.ActBravePalace=9,n.PageMember=0,n.PageActivity=1,n.PageGift=2,n.PageGuildSkill=3,n.PageTask=4,n.PageToast=5,n.MAX_DEVOTE_CONTRIBUTION=1e6,n}(e.FitComponent);e.GuildHome=t,__reflect(t.prototype,"UI.GuildHome",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(t){var n=e.call(this)||this;return n.skinName="GuildInfoChangeSkin",n.currentState=t,n.addEventListener(eui.UIEvent.ADDED_TO_STAGE,n.onAddToStage,n),n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closehandle,this),this.imgClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closehandle,this),this.btnApply.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onApplyChange,this)},t.prototype.onAddToStage=function(){this.inputIntro.text="";var e="";e=""!=Guild.announce?Game.Unescape(Guild.announce):lang.String("guild input guildannounce default"),"display"==this.currentState?this.inputIntro.prompt=e:this.inputIntro.text=e,Player.instance.guildPos!=Guild.GuildPosition.GuildPos_Leader&&Player.instance.guildPos!=Guild.GuildPosition.GuildPos_ViceLeader?this.btnApply.enabled=!1:this.btnApply.enabled=!0},t.prototype.closehandle=function(){UIManager.pop(this)},t.prototype.onApplyChange=function(){if(Player.instance.guildPos!=Guild.GuildPosition.GuildPos_Leader&&Player.instance.guildPos!=Guild.GuildPosition.GuildPos_ViceLeader)return void UIManager.pop(this);var e=this.inputIntro.text;if(""==e&&(e=lang.String("guild input guildannounce default")),e!=Guild.announce){var t=new net.def.C2SGuildText,n=Game.Escape(e);t.setText(n),net.socket.write(92,t.toArrayBuffer()),UIManager.pop(this),net.socket.write(83,null)}},t}(e.FitComponent);
e.GuildInfoChange=t,__reflect(t.prototype,"UI.GuildInfoChange",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="GuildItemSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.dataChanged=function(){this.guildname=this.data.name+" (Lv"+this.data.level+")",this.maxCount=Guild.maxMembercounts[this.data.level]},t.prototype.onTouchTap=function(e){var t=new net.def.C2SReqGuildTipInfo;t.guildName=this.data.name,net.socket.write(2046,t.toArrayBuffer())},t}(eui.ItemRenderer);e.GuildItem=t,__reflect(t.prototype,"UI.GuildItem")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.expRate=0,e.drinkTimes=0,e.remainingTime=new RemainingTime,e.refreshBoxRemainingTime=new RemainingTime,e.toastRedPacketRemainingTime=new RemainingTime,e.skinName="GuildManorSkin",e.running=!1,e.lefttime=lang.String("not start"),e.txtRate="100%",e.winCount=lang.String("not start"),e.memberCount=lang.String("None"),e.openTime=lang.StringWithFormat("at time {1} open toast",Guild.formatToastTime(Guild.toastTime)),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},n.prototype.onAddToStage=function(){SecondTicker.addEventListener(this.onTimer,this),Game.dispatcher.addEventListener(Game.EVENT.SyncGuildInfo,this.onSyncGuildInfo,this),Game.dispatcher.addEventListener(Game.EVENT.GuildTrainingStateChanged,this.onTrainingStateChanged,this)},n.prototype.onRemoveFromStage=function(){SecondTicker.removeEventListener(this.onTimer,this),Game.dispatcher.removeEventListener(Game.EVENT.SyncGuildInfo,this.onSyncGuildInfo,this),Game.dispatcher.removeEventListener(Game.EVENT.GuildTrainingStateChanged,this.onTrainingStateChanged,this)},n.prototype.onSyncGuildInfo=function(){this.openTime=lang.StringWithFormat("at time {1} open toast",Guild.formatToastTime(Guild.toastTime))},n.prototype.onTimer=function(){this.remainingTime.delta<=0?1==this.running&&(this.running=!1,this.lefttime=lang.String("already finish")):this.lefttime=this.remainingTime.getMinuteSecond(),this.refreshBoxRemainingTime.delta<0?this.refreshBoxLeftTime=lang.String("guild refreshed all box"):this.refreshBoxLeftTime=this.refreshBoxRemainingTime.getMinuteSecond(),this.toastRedPacketRemainingTime.delta<0?this.toastRedPacketLeftTime=lang.String("guild refreshed all box"):this.toastRedPacketLeftTime=this.toastRedPacketRemainingTime.getMinuteSecond()},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnExit:this.onExit();break;case this.btnDrink:this.onDrink();break;case this.btnGuild:Guild.openGuildHome();break;case this.btnRedPacket:e.WelfareHall.open(),e.WelfareHall.instance.ShowRedPacket();break;case this.btnAuction:Auction.showUi();break;case this.btnTraining:this.onTraining()}},n.prototype.onTraining=function(){net.socket.write(2002,null)},n.prototype.onExit=function(){net.socket.write(95,null)},n.prototype.onDrink=function(){if(this.remainingTime.delta<=0)return void PopUpMessage.push(lang.String("guild drink warn"),color.RED);if(this.drinkTimes>0)return void PopUpMessage.push(lang.String("guild drink times warn"),color.RED);var t=new e.GuildCheckBox;t.param=this.expRate,UIManager.pushPage(t),t=null},n.prototype.setInfo=function(e,t,n,i,a,r,o){t>0&&(this.running=!0),this.memberCount=e.toString(),this.remainingTime.delta=t,this.expRate=n,this.txtRate=this.expRate+"%",this.winCount=i.toString(),this.drinkTimes=a,this.refreshBoxRemainingTime.delta=r,this.toastRedPacketRemainingTime.delta=o},n.prototype.onTrainingStateChanged=function(){Guild.TrainingState==Guild.TRAININGSTATE_OVER||Guild.TrainingState==Guild.TRAININGSTATE_TRAINING?this.btnTraining.enabled=!1:this.btnTraining.enabled=!0},n}(e.FitComponent);e.GuildManor=t,__reflect(t.prototype,"UI.GuildManor",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.members=[],e.skinName="GuildMemberSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onTouchTap=function(t){switch(t.target){case this.btnQuite:var n=lang.String("operation confirm"),i=lang.StringWithFormat("guild quite second ensure");e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],n,i,function(){return net.socket.write(90,null),UIManager.pop(e.GuildHome.instance),!0},null,null);break;case this.btnAppoint:if(null==this.memberList.selectedItem)return;if(this.memberList.selectedItem.name==Player.instance.Name)return void PopUpMessage.push(lang.String("guild appoint warn"),color.RED);var a=new e.GuildAppointment;UIManager.pushPage(a),a.setAppointName(this.memberList.selectedItem.name,this.memberList.selectedItem.position),a=null;break;case this.btnExile:if(null==this.memberList.selectedItem)return;if(this.memberList.selectedItem.name==Player.instance.Name)return void PopUpMessage.push(lang.String("guild appoint warn"),color.RED);if(Player.instance.guildPos==this.memberList.selectedItem.position)return void PopUpMessage.push(lang.String("guild appoint warn"),color.RED);var r=new net.def.Name;r.setName(this.memberList.selectedItem.name),net.socket.write(91,r.toArrayBuffer()),net.socket.write(88,null);break;case this.btnApply:UIManager.pushPage(e.GuildApplicant.instance),net.socket.write(89,null),UIManager.pop(e.GuildHome.instance),badge.onLight(badge.action.GuildNewApplication,!1)}},n.prototype.showMemberList=function(){this.members=[];for(var e=0;e<Guild.MemberList.length;e++)this.members.push(Guild.MemberList[e]);this.members.sort(this.sortMembersByOfflineTime);var t=this.memberList.dataProvider;null==t?this.memberList.dataProvider=new eui.ArrayCollection(this.members):t.replaceAll(this.members)},n.prototype.sortMembersByOfflineTime=function(e,t){return e.name==Player.instance.Name?-1:t.name==Player.instance.Name?1:e.offlineTime!=t.offlineTime?e.offlineTime-t.offlineTime:e.position!=t.position?e.position-t.position:e.weekContribution-t.weekContribution},n.prototype.onAddToStage=function(){this.onRefreshPosition(),this.showMemberList(),Game.dispatcher.addEventListener(Game.EVENT.SyncGuildMemberList,this.showMemberList,this),Game.dispatcher.addEventListener(Game.EVENT.GuildPositionChange,this.onRefreshPosition,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.SyncGuildMemberList,this.showMemberList,this),Game.dispatcher.removeEventListener(Game.EVENT.GuildPositionChange,this.onRefreshPosition,this)},n.prototype.onRefreshPosition=function(){var e=Player.instance.guildPos;e==Guild.GuildPosition.GuildPos_Leader?(this.btnApply.visible=!0,this.btnExile.visible=!0,this.btnAppoint.visible=!0,this.btnQuite.enabled=!0):e==Guild.GuildPosition.GuildPos_ViceLeader?(this.btnApply.visible=!0,this.btnExile.visible=!0,this.btnAppoint.visible=!1,this.btnQuite.enabled=!0):(this.btnApply.visible=!1,this.btnExile.visible=!1,this.btnAppoint.visible=!1,this.btnQuite.enabled=!0)},n}(e.FitComponent);e.GuildMember=t,__reflect(t.prototype,"UI.GuildMember",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.memName.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAddFriend,this)},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnSeekHelp:e.GuildBusiTaskHelp.open(this.data.name)}},n.prototype.dataChanged=function(){switch(this.data.position){case 0:this.txtPos=lang.String("None");break;case 1:this.txtPos=lang.String("leader");break;case 2:this.txtPos=lang.String("viceleader");break;case 3:this.txtPos=lang.String("member")}this.data.offlineTime>0?(this.currentState="offline",this.txtOffline=FormatDDHH(60*this.data.offlineTime)):(this.currentState="online",this.txtOffline=lang.String("online")),0==this.data.vipLevel?this.vipIcon=null:this.vipIcon=Vip.getVipIcon(this.data.vipLevel),this.btnSeekHelp.visible=!1;for(var e=0;e<this.data.seekHelpStatus.length;e++)if(0==this.data.seekHelpStatus[e]){this.btnSeekHelp.visible=!0;break}},n.prototype.onAddFriend=function(){this.data.name!=Player.instance.Name&&(UIManager.push(new e.ChatPlayerDsc),friend.search(this.data.name))},n}(eui.ItemRenderer);e.GuildMemberItem=t,__reflect(t.prototype,"UI.GuildMemberItem")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="RoshanboSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(){},t.prototype.assetLoaded=function(){this.btnStart.enabled=!0},t.prototype.onRemoveFromStage=function(){null!=this.timerId&&(egret.clearTimeout(this.timerId),this.timerId=null)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.btnStart.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onStart,this),this.opponent.text=this.opponentname},t.prototype.setResult=function(e,t){var n=this;switch(this.currentState="end",this.btnStart.enabled=!0,e){case 3:this.npcRoshambo.gotoAndStop("bo");break;case 1:this.npcRoshambo.gotoAndStop("ro");break;case 2:this.npcRoshambo.gotoAndStop("sham");break;default:PopUpMessage.push(lang.String("guild roshambo no target move"),color.RED)}switch(t){case 0:this.result.text="Thất bại",this.result.textColor=13421772;break;case 2:this.result.text="Hòa",this.result.textColor=1484815;break;case 1:this.result.text="Thắng",this.result.textColor=15900425}this.timerId=egret.setTimeout(function(){UIManager.pop(n),Guild.roshamboPanel=null,n.timerId=null},this,3e3)},t.prototype.onStart=function(){if("end"==this.currentState)null!=this.timerId&&(egret.clearTimeout(this.timerId),this.timerId=null),UIManager.pop(this),Guild.roshamboPanel=null;else{var e=void 0;if(null==this.list||null==this.list.selectedIndex)return;switch(this.list.selectedIndex){case 0:e=1;break;case 1:e=2;break;case 2:e=3;break;default:return void(e=0)}this.list.touchChildren=!1,this.btnStart.enabled=!1;var t=new net.def.C2SRoshambo;t.choice=e,net.socket.write(52,t.toArrayBuffer())}},t}(e.Roshambo);e.GuildRoshambo=t,__reflect(t.prototype,"UI.GuildRoshambo")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.skinName="GuildSearchUISkin",t.list.dataProvider=new eui.ArrayCollection([]),t}return __extends(t,e),t.prototype.close=function(){UIManager.pop(this)},t.prototype.onUpdate=function(e){if(""!=e){this.scroller.viewport.scrollV=0;for(var t=e.toLowerCase(),n=Guild.appliedGuild,i=Guild.othersGuild,a=[],r=0;r<n.length;r++){var o=n[r].name.toLowerCase(),s=o.indexOf(t);-1!=s&&a.push(n[r])}for(var r=0;r<i.length;r++){var o=i[r].name.toLowerCase(),s=o.indexOf(t);-1!=s&&a.push(i[r])}a.length<=0?this.txtsearch="Không tìm thấy kết quả":this.txtsearch="";var l=this.list.dataProvider;l.replaceAll(a)}},t.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close();break;case this.btnSearch:if(""==this.textInput.text)return;this.onUpdate(this.textInput.text)}},t}(e.FitComponent);e.guildSearchUI=t,__reflect(t.prototype,"UI.guildSearchUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skills=[],n.skinName="GuildSkillSkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.selectedSkillPlace=0,n.loaded=!1,n.nSelectSkillId=0,n.szUpgradeNeed=lang.String("GuildSkill NoneUpgrade"),n.listGuildSkill.addEventListener(eui.ItemTapEvent.ITEM_TAP,n.onTapList,n),n.choosePad.listGuildSkill.addEventListener(eui.ItemTapEvent.ITEM_TAP,n.GuildSkillChoosed,n),n.listGuildSkill.itemRenderer=e.GuildSkillInfo,n.UpdateGuildSkillLv(),n.UpdateUsingSkill(),n.UpdateGuildSkillLv(),n.loaded=!0,n}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.UpdateGuildSkillLevel,this.onSkillLevelUp,this),Game.dispatcher.addEventListener(Game.EVENT.GuildLevelUp,this.UpdateGuildSkillLv,this),this.choosePad.visible=!1,this.txtGuildFund.text=Guild.fund.toString(),this.UpdateSkillDesc(),this.UpdateLevelUpBtnState()},n.prototype.UpdateFund=function(){null!=this.txtGuildFund&&(this.txtGuildFund.text=Guild.fund.toString())},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.UpdateGuildSkillLevel,this.onSkillLevelUp,this),Game.dispatcher.removeEventListener(Game.EVENT.GuildLevelUp,this.UpdateGuildSkillLv,this)},n.prototype.UpdateUsingSkill=function(){this.imgUseSkill0.source="icon/chatHead/bg.png",this.imgUseSkill1.source="icon/chatHead/bg.png",this.imgUseSkill2.source="icon/chatHead/bg.png",Guild.usingSkill[0]>0&&(this.imgUseSkill0.source=table.mapGuildSkill[Guild.usingSkill[0]].icon),Guild.usingSkill[1]>0&&(this.imgUseSkill1.source=table.mapGuildSkill[Guild.usingSkill[1]].icon),Guild.usingSkill[2]>0&&(this.imgUseSkill2.source=table.mapGuildSkill[Guild.usingSkill[2]].icon)},n.prototype.UpdateGuildSkillLv=function(){this.skills=[];for(var e in table.mapGuildSkill){var t=table.mapGuildSkill[e],n="lock";t&&(Guild.GetGuildSkillLv(t.id)>0&&(n="unlock"),this.skills.push({skillid:t.id,name:t.name,icon:t.icon,addenabled:!1,state:n}))}this.listGuildSkill.dataProvider=new eui.ArrayCollection(this.skills)},n.prototype.OpenGuildSkillChoosePad=function(){this.choosePad&&this.choosePad.UpdateGuildSkillLv()&&(this.choosePad.visible=!0)},n.prototype.TryUseGuildSkill=function(e){var t=new net.def.C2SUseGuildSkill;t.setId(e),t.setPlace(this.selectedSkillPlace),net.socket.write(2014,t.toArrayBuffer())},n.prototype.GuildSkillChoosed=function(){if(Guild.fund<Guild.GUILDSKILL_CHANGECOST)return void PopUpMessage.push(lang.StringWithFormat("GuildSkill ChangeSkillNeed{1}",Guild.GUILDSKILL_CHANGECOST),color.RED);this.choosePad.visible=!1;var e=0;this.choosePad.listGuildSkill.selectedItem.skillid>0&&(e=this.choosePad.listGuildSkill.selectedItem.skillid),this.TryUseGuildSkill(e)},n.prototype.TryLevelUpSkill=function(){if(!(this.listGuildSkill.selectedIndex<0)){var e=this.listGuildSkill.selectedItem.skillid,t=Guild.GetGuildSkillLv(e);if(!(t>=Game.MAX_GUILDSKILL_LV))if(0>=t){var n=new net.def.C2SActivateGuildSkill;n.setId(e),net.socket.write(2012,n.toArrayBuffer())}else{var n=new net.def.C2SLvUpGuildSkill;n.setId(e),net.socket.write(2013,n.toArrayBuffer())}}},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnAutoUpSkill:this.TryLevelUpSkill(),this.UpdateLevelUpBtnState();break;case this.imgClose:this.close();break;case this.imgUseSkill0:this.selectedSkillPlace=0,this.OpenGuildSkillChoosePad();break;case this.imgUseSkill1:this.selectedSkillPlace=1,this.OpenGuildSkillChoosePad();break;case this.imgUseSkill2:this.selectedSkillPlace=2,this.OpenGuildSkillChoosePad()}},n.prototype.close=function(){UIManager.pop(this)},n.GuildSkillStringWithFormat=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return e.replace(/{(\d+)}/g,function(e,n){return t[n-1]})},n.GetGuildPassiveSkillDesc=function(){if(null!=Guild.guildInfo){var e=(Guild.guildInfo.level,Guild.GetGuildPassiveSkillAttack()),t=Guild.GetGuildPassiveSkillLife(),i=Guild.GetGuildPassiveSkillLuck();return table.mapGuildSkill[0].name,n.GuildSkillStringWithFormat(table.mapGuildSkill[0].desc,e,t,i)}},n.GetSkillDescription=function(e,t){if(0>=t)return lang.String("inactivate");if(t>Game.MAX_GUILDSKILL_LV)return lang.String("guildskill max level");if(0==e&&t>Guild.maxGuildLevel)return lang.String("guildskill max level");for(var i=table.mapGuildSkill[e],a=i.attr,r=[],o=0;o<a.length;o++)r.push(a[o].value[t-1]);return n.GuildSkillStringWithFormat.apply(n,[i.desc].concat(r))},n.prototype.UpdateLevelUpBtnState=function(){var e=0;this.listGuildSkill.selectedIndex>=0&&(e=this.listGuildSkill.selectedItem.skillid);var t=Guild.GetGuildSkillLv(e);this.btnAutoUpSkill.enabled=!0,(this.nSelectSkillId<=0||Guild.GetGuildSkillLv(this.nSelectSkillId)>=Game.MAX_GUILDSKILL_LV||Guild.fund<Guild.GUILDSKILL_UPGRADE_COST[t])&&(this.btnAutoUpSkill.enabled=!1)},n.prototype.GetUpgradeNeedDesc=function(e,t){return 0==e&&t>=Guild.maxGuildLevel?lang.String("GuildSkill NoneUpgrade"):0==e?lang.String("upgrade with guild"):t>=Game.MAX_GUILDSKILL_LV?lang.String("GuildSkill NoneUpgrade"):lang.StringWithFormat("GuildSkill NeedGuildFund{1}",Guild.GUILDSKILL_UPGRADE_COST[t])},n.prototype.UpdateSkillDesc=function(){this.desc1=Game.HtmlTextParser.parse(""),this.desc2=Game.HtmlTextParser.parse("");var e=Guild.GetGuildSkillLv(this.nSelectSkillId);this.desc1=Game.HtmlTextParser.parse(n.GetSkillDescription(this.nSelectSkillId,e)),this.desc2=Game.HtmlTextParser.parse(n.GetSkillDescription(this.nSelectSkillId,e+1)),this.szUpgradeNeed=this.GetUpgradeNeedDesc(this.nSelectSkillId,e)},n.prototype.onTapList=function(){!Guild.HasGuildSkill()||this.listGuildSkill.selectedIndex<0||(this.nSelectSkillId=this.listGuildSkill.selectedItem.skillid,Game.dispatcher.dispatchEventWith(Game.EVENT.SelectGuildSkill),this.UpdateSkillDesc(),this.UpdateLevelUpBtnState())},n.prototype.onSkillLevelUp=function(){this.UpdateLevelUpBtnState(),this.UpdateSkillDesc()},n}(e.FitComponent);e.GuildSkill=t,__reflect(t.prototype,"UI.GuildSkill",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skills=[],e.skinName="GuildSkillChoosePadSkin",e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new e.GuildSkill),this._instance},enumerable:!0,configurable:!0}),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoveFromStage,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),this.listGuildSkill.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTapList,this),this.listGuildSkill.itemRenderer=e.GuildSkillInfo,this.listGuildSkill.selectedIndex=0},n.prototype.UpdateGuildSkillLv=function(){this.skills=[];var e=0;for(var t in table.mapGuildSkill){var n=table.mapGuildSkill[t];n&&(Guild.GetGuildSkillLv(n.id)>0&&!Guild.IsSkillUsed(n.id)&&0!=n.id&&this.skills.push({skillid:n.id,name:n.name,icon:n.icon,addenabled:!1}),e+=1)}return this.skills.length<=0?(console.log("dont have any skill to choose"),!1):(this.listGuildSkill.dataProvider=new eui.ArrayCollection(this.skills),!0)},n.prototype.onTapList=function(){},n.prototype.onAddToStage=function(){this.UpdateGuildSkillLv()},n.prototype.onRemoveFromStage=function(){},n.prototype.onTapOther=function(){console.log("tap other place")},n.prototype.onTouchTap=function(e){switch(e.target){case this.listGuildSkill:break;case this.imgClose:this.visible=!1}},n}(e.FitComponent);e.GuildSkillChoosePad=t,__reflect(t.prototype,"UI.GuildSkillChoosePad",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="GuildSkillDescPadSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.selectedDesc=Game.HtmlTextParser.parse(""),e.selectedName="",e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.MakeDescription=function(t){var n=table.mapGuildSkill;this.selectedName=n[t].name,this.selectedDesc=Game.HtmlTextParser.parse(e.GuildSkill.GetSkillDescription(t,Guild.GetGuildSkillLv(t)))},n.prototype.Show=function(e){this.MakeDescription(e),UIManager.pushPage(this)},n.prototype.close=function(){UIManager.pop(this)},n.prototype.onTouchTap=function(e){},n}(e.FitComponent);e.GuildSkillDescPad=t,__reflect(t.prototype,"UI.GuildSkillDescPad",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="GuildSkillInfoSkin",n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.mc=new e.MovieClipComponent,n.mc.removeWhenComplete=!1,n.mc.position="center",n.mc.verticalCenter=0,n.mc.horizontalCenter=-60,n.mc.visible=!1,n}return __extends(n,t),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addChild(this.mc)},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.UpdateGuildSkillLevel,this.onSkillLevelUp,this),Game.dispatcher.addEventListener(Game.EVENT.SelectGuildSkill,this.onChangeSelectedItem,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.UpdateGuildSkillLevel,this.onSkillLevelUp,this),this.mc.visible=!1,this.mc.free()},n.prototype.dataChanged=function(){this.onRefreshLevel(),this.level>0?this.currentState="unlock":this.currentState="lock",this.onChangeSelectedItem()},n.prototype.onSkillLevelUp=function(){this.level<Guild.GetGuildSkillLv(this.data.skillid)&&(this.mc.Load("skill/Ui_quan03/Ui_quan03.json","Ui_quan03"),this.mc.visible=!0,this.mc.gotoAndPlay(0,1)),this.dataChanged()},n.prototype.onRefreshLevel=function(){this.level=Guild.GetGuildSkillLv(this.data.skillid),0==this.data.skillid&&(this.level=Guild.guildInfo.level),this.slevel=lang.Format("Lv{1}",this.level);this.check()},n.prototype.check=function(){return Guild.fund<Guild.GUILDSKILL_UPGRADE_COST[this.level]?"not enough fund":"1"},n.prototype.getCurrentState=function(){return null==this.data||null==this.data.state?"lock":this.data.state},n.prototype.onChangeSelectedItem=function(){null!=this.imgSelected&&(this.imgSelected.visible=!1,e.GuildSkill.instance.nSelectSkillId==this.data.skillid&&(this.imgSelected.visible=!0))},n}(eui.ItemRenderer);e.GuildSkillInfo=t,__reflect(t.prototype,"UI.GuildSkillInfo")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.updateDisplayList=function(t,n){e.prototype.updateDisplayList.call(this,t,n);var i=this.$target,a=i.numElements;if(!(a>5))for(var r=new egret.Rectangle,o=0;a>o;o++){var s=i.getElementAt(o);if(null!=s)switch(s.getPreferredBounds(r),o){case 0:s.x=0,s.y=0;break;case 1:s.x=t/2-r.width/2,s.y=0;break;case 2:s.x=t-r.width,s.y=0;break;case 3:s.x=0,s.y=n-r.height;break;case 4:s.x=t-r.width,s.y=n-r.height}}},t}(eui.LayoutBase);e.GuildTaskLayout=t,__reflect(t.prototype,"UI.GuildTaskLayout");var n=function(t){function n(){var e=t.call(this)||this;return e.finishMem=0,e.guildMemcount=0,e.weekReputation=0,e.maxTaskExp=0,e.maxCopper=0,e.restSeconds=0,e.taskTable=[],e.curReputation=0,e.skinName="GuildTaskSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=e.GuildTaskItem},n.prototype.onAddToStage=function(){this.txtNotice=lang.String("guild task not arrangede")},n.prototype.onTaskStatus=function(){var e=Guild.guildInfo.level-1,t=Guild.TaskAwardTable.rate[e],n=0,i=0;for(var a in Guild.TaskAwardTable.award){var r=Number(a);if(PlayerAttribute.Level<r){n=t*Guild.TaskAwardTable.award[a].exp,i=t*Guild.TaskAwardTable.award[a].copper;break}}if(this.maxTaskExp=~~(n/100),this.maxCopper=~~(i/100),this.curReputation=450*this.finishMem,Guild.tastStatus.length<=0)return this.expCount=0,this.copperCount=0,this.itemCount=0,void(this.contribution=0);for(var o=0,s=0;s<Guild.tastStatus.length;s++)Guild.tastStatus[s].done>=Guild.tastStatus[s].task.times&&(o+=1);this.expCount=Math.floor(n*o/(100*Guild.tastStatus.length)),this.copperCount=Math.floor(i*o/(100*Guild.tastStatus.length)),this.itemCount=~~(5*o/9),this.contribution=50*o},n.prototype.onRemoveFromStage=function(){this.maxTaskExp=0,this.maxCopper=0},n.prototype.onRefresh=function(){this.list.dataProvider=new eui.ArrayCollection(Guild.tastStatus),Guild.tastStatus.length>0&&(this.txtNotice=""),this.guildMemcount=Guild.guildInfo.memberCount,this.weekReputation=450*Guild.guildInfo.memberCount,this.onTaskStatus()},n.prototype.onOpenUI=function(){UIManager.pushPage(n.instance),net.socket.write(97,null)},n}(e.FitComponent);e.GuildTask=n,__reflect(n.prototype,"UI.GuildTask",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){return t.call(this)||this}return __extends(n,t),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btnJoin.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onJoin,this)},n.prototype.dataChanged=function(){this.data.done>=this.data.task.times?this.txtDonetimes.textColor=14332536:this.txtDonetimes.textColor=12504779,this.taskName=StringWithFormat(this.data.task.name,this.data.task.times)},n.prototype.onJoin=function(){if(!Game.isWildMap())return void PopUpMessage.push(lang.String("can not open guild"),color.RED);switch(UIManager.pop(e.GuildHome.instance),this.data.Id){case 0:TaohuaIsland.onOpenTaohuaIsland();break;case 1:MasterChallenge.openChallenge();break;case 2:HuashanPK.OpenHuashanPK();break;case 3:ArenaChallenge.onOpenArena();break;case 4:UIManager.pushPage(new e.CrossServerSongJinWar);break;case 5:DungeonHallMgr.OpenDungeonWithTarget(DungeonHallMgr.DungeonTarget_FerryBoat);break;case 6:UIManager.pushPage(new e.SeaSunEntrance);break;case 7:UIManager.pushPage(new e.QinEntrance);break;case 8:DungeonHallMgr.OpenDungeonWithTarget(DungeonHallMgr.DungeonTarget_CatchThief);break;case 9:UIManager.pushPage(new e.PersonalMatchUI)}},n}(eui.ItemRenderer);e.GuildTaskItem=t,__reflect(t.prototype,"UI.GuildTaskItem")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="GuildTipSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.send=function(e){var t=this;null!=this.timer&&(egret.clearTimeout(this.timer),this.timer=null),this.timer=egret.setTimeout(function(){var n=new net.def.Name;n.setName(e),net.socket.write(86,n.toArrayBuffer()),t.timer=null},this,100)},n.prototype.onAddToStage=function(){this.guildname=this.data.info.name+"(Lv"+this.data.info.level+")",this.leadername=this.data.info.leader,this.leaderImgHead=table.faction[this.data.leaderFaction].portrait,""!=this.data.announce?this.guildIntro=this.data.announce:this.guildIntro="Bang Chủ lười quá, không có thông báo!",this.guildmembernum=this.data.info.memberCount,this.maxmembernum=Guild.maxMembercounts[this.data.info.level],this.onlinenum=this.data.info.lastTopOnline,this.glevel=this.data.equipBuildHouseLevel,this.skillicon0.source=table.mapGuildSkill[0].icon,this.skillname0=table.mapGuildSkill[0].name,this.SkillLv0=lang.Format("Lv{1}",this.data.info.level);var e=this.data.guildSkill;""!=Player.instance.guildName?this.joinGuild.visible=!1:Guild.isAppliedGuild(this.data.info.name)?this.joinGuild.visible=!1:this.joinGuild.visible=!0,this.skillname1="Chưa thiết lập",this.skillname2="Chưa thiết lập",this.skillname3="Chưa thiết lập",this.skillicon1.source="ui/skill/skill_bg.png",this.skillicon2.source="ui/skill/skill_bg.png",this.skillicon3.source="ui/skill/skill_bg.png",this.SkillLv1="",this.SkillLv2="",this.SkillLv3="",this.data.memberCount>=Guild.maxMembercounts[this.data.level]?this.joinGuild.enabled=!1:this.joinGuild.enabled=!0,e.id.length>0&&(this.skillname1=table.mapGuildSkill[e.id[0]].name,this.skillicon1.source=table.mapGuildSkill[e.id[0]].icon,this.SkillLv1=lang.Format("Lv{1}",e.lv[0])),e.id.length>1&&(this.skillname2=table.mapGuildSkill[e.id[1]].name,this.skillicon2.source=table.mapGuildSkill[e.id[1]].icon,this.SkillLv2=lang.Format("Lv{1}",e.lv[1])),e.id.length>2&&(this.skillname3=table.mapGuildSkill[e.id[2]].name,this.skillicon3.source=table.mapGuildSkill[e.id[2]].icon,this.SkillLv3=lang.Format("Lv{1}",e.lv[2]))},n.prototype.onRemoveFromStage=function(){this.joinGuild.enabled=!1},n.prototype.onTouchTap=function(t){switch(t.target){case this.imgClose:this.close();break;case this.leaderGroup:UIManager.push(new e.ChatPlayerDsc),friend.search(this.leadername);break;case this.joinGuild:this.send(this.data.info.name),UIManager.pop(this)}},n.prototype.close=function(){UIManager.pop(this)},n}(e.FitComponent);e.GuildTip=t,__reflect(t.prototype,"UI.GuildTip",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.invalidTimes=[1900,1930,2e3,2030,2100,2130,2200,2230,2300],t.skinName="GuildToastSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.newTime=0,t.timechanged=!1,t.todayToastTime="",t.newToastTime="",t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.onAddToStage=function(){this.onSyncGuildInfo(),Game.dispatcher.addEventListener(Game.EVENT.SyncGuildInfo,this.onSyncGuildInfo,this)},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.SyncGuildInfo,this.onSyncGuildInfo,this)},t.prototype.onSyncGuildInfo=function(){this.todayToastTime=Guild.formatToastTime(Guild.toastTime),Guild.newToastTime>0?(this.newTime=Guild.newToastTime,this.btnAdd.enabled=!1,this.btnSub.enabled=!1,this.btnChangeTime.enabled=!1,this.btnChangeTime.label=lang.String("guild toast change time btn msg already changeed")):(this.newTime=Guild.toastTime,this.btnAdd.enabled=!0,this.btnSub.enabled=!0,this.btnChangeTime.label=lang.String("guild toast change time btn msg could change")),this.newToastTime=Guild.formatToastTime(this.newTime)},t.prototype.onChangeTime=function(){var e=new net.def.C2SChangeGuildToastTime;e.toastTime=this.newTime,net.socket.write(2001,e.toArrayBuffer())},t.prototype.onAdd=function(){this.newTime>=2300||(this.newTime%100==0?this.newTime+=30:this.newTime+=70,this.newTime>2300&&(this.newTime=2300),this.newToastTime=Guild.formatToastTime(this.newTime),this.timechanged=!0)},t.prototype.onSub=function(){this.newTime<=1900||(this.newTime%100==0?this.newTime-=70:this.newTime-=30,this.newTime<1900&&(this.newTime=1900),this.newToastTime=Guild.formatToastTime(this.newTime),this.timechanged=!0)},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnChangeTime:this.onChangeTime();break;case this.btnAdd:this.onAdd();
break;case this.btnSub:this.onSub();break;case this.imgClose:this.close();break;case this.btnEnter:UIManager.pop(this),net.socket.write(94,null)}},t.prototype.close=function(){UIManager.pop(this)},t}(e.FitComponent);e.GuildToast=t,__reflect(t.prototype,"UI.GuildToast",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="PlayerGuildBuffSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.cleanAttr=function(){this.nAttack=0,this.nLife=0,this.nLuck=0,this.nDefence=0,this.nGoldDef=0,this.nWoodDef=0,this.nWaterDef=0,this.nFireDef=0,this.nGroundDef=0,this.nFp=0},t.prototype.onAddToStage=function(){if(null!=Guild.usingSkill){this.cleanAttr(),this.nFp=Guild.GetGuildSkillFp(),this.nAttack=Guild.GetGuildPassiveSkillAttack(),this.nLife=Guild.GetGuildPassiveSkillLife(),this.nLuck=Guild.GetGuildPassiveSkillLuck(),this.nDefence=Guild.GetGuildPassiveSkillDefence();for(var e=0;e<Guild.usingSkill.length;e++){var n=Guild.usingSkill[e];if(!(0>=n)){var i=Guild.GetGuildSkillLv(n);if(!(0>=i))for(var a=table.mapGuildSkill[n].attr,r=0;r<a.length;r++)switch(a[r].attrId){case t.BUFFID_GOLDDEF:this.nGoldDef=this.nGoldDef+a[r].value[i-1];break;case t.BUFFID_WOODDEF:this.nWoodDef=this.nWoodDef+a[r].value[i-1];break;case t.BUFFID_WATERDEF:this.nWaterDef=this.nWaterDef+a[r].value[i-1];break;case t.BUFFID_FIREDEF:this.nFireDef=this.nFireDef+a[r].value[i-1];break;case t.BUFFID_GROUNDDEF:this.nGroundDef=this.nGroundDef+a[r].value[i-1]}}}}},t.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},t.prototype.close=function(){UIManager.pop(this)},t.BUFFID_GOLDDEF=8,t.BUFFID_WOODDEF=9,t.BUFFID_WATERDEF=10,t.BUFFID_FIREDEF=11,t.BUFFID_GROUNDDEF=12,t}(e.FitComponent);e.PlayerGuildBuff=t,__reflect(t.prototype,"UI.PlayerGuildBuff",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.dataChanged=function(){if(this.rank=null,this.rankBg)switch(this.data.rank){case 1:return void(this.rankBg.source="ui/ranking/first_icon.png");case 2:return void(this.rankBg.source="ui/ranking/second_icon.png");case 3:return void(this.rankBg.source="ui/ranking/third_icon.png");case 4:this.rankBg.source="ui/ranking/0.png"}this.rank=this.data.rank},t}(eui.ItemRenderer);e.PlayerKillList=t,__reflect(t.prototype,"UI.PlayerKillList")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="GuildArmamentArmItemSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.dataChanged=function(){var e=GuildArmament.getArmsLevelConfig(this.data.getCityId()),t=GuildArmament.getArmsTypeConfig(this.data.getArmsType());this.data.getOwnMap()?(this.btnOwnerOpt.scaleY=1,this.data.getMyCollecting()?this.btnOwnerOpt.label=lang.String("armament item ui btn msg end collect"):this.btnOwnerOpt.label=lang.String("armament item ui btn msg begin collect"),this.btnPublicOpt.label=lang.String("armament item ui btn msg patrol")):(this.btnOwnerOpt.scaleY=0,this.btnPublicOpt.label=lang.String("armament item ui btn msg rob")),this.collectingMsg.scaleY=this.data.getMyCollecting()?1:0,this.robbedMsg.scaleY=this.data.getBeingRobbed()?1:0,this.myScore=this.data.getMyScore(),this.mapScore=this.data.getMapScore()+"/"+e.maxScore,this.collecterNum=this.data.getCollecterNum()+"/"+e.maxCollecters,this.armName=t.name+" Lv."+e.level,this.imgMapIcon.source=t.mapIcon},t.prototype.onClickOwnerBtn=function(){this.data.getOwnMap()&&(this.data.getMyCollecting()?GuildArmament.endCollect():GuildArmament.beginCollect(this.data.getCityId(),this.data.getWorldIndex()))},t.prototype.onClickPublicBtn=function(){GuildArmament.enterWorld(this.data.getCityId(),this.data.getWorldIndex())},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnOwnerOpt:this.onClickOwnerBtn();break;case this.btnPublicOpt:this.onClickPublicBtn();break;default:return}},t}(eui.ItemRenderer);e.GuildArmamentArmItem=t,__reflect(t.prototype,"UI.GuildArmamentArmItem")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="GuildArmamentBuffSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.dataBuffs=new eui.ArrayCollection,e}return __extends(n,t),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.listBuff.itemRenderer=e.GuildArmamentBuffIconItem,this.listBuff.dataProvider=this.dataBuffs},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.GuildArmamentSyncEffectiveBuffs,this.updateEffectiveBuffs,this),this.panelBuff.visible=!1},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.GuildArmamentSyncEffectiveBuffs,this.updateEffectiveBuffs,this)},n.prototype.updateEffectiveBuffs=function(){for(var e=[],t=0;t!=GuildArmament.effectiveBuffs.length;t++)GuildArmament.effectiveBuffs[t].getLevel()>0&&e.push({buffId:GuildArmament.effectiveBuffs[t].getBuffId(),leftTimes:GuildArmament.effectiveBuffs[t].getLeftTimes(),maxTimes:GuildArmament.effectiveBuffs[t].getMaxTimes()});this.dataBuffs.replaceAll(e)},n.prototype.selectBuff=function(e){var t=GuildArmament.getBuffConfigByBuffId(e),n=GuildArmament.getBuffInfo(e);null==t||null==n||n.getLevel()<=0||(this.selectBuffId=e,this.panelBuff.visible=!0,this.buffIcon=t.buffIcon,this.buffTips.textFlow=Game.HtmlTextParser.parse(GuildArmament.getBuffTips(e)))},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnClose:case this.btnBack:case this.btnCancel:this.panelBuff.visible=!1;break;case this.btnUse:GuildWarMatchScene.useBuff(this.selectBuffId),this.panelBuff.visible=!1;break;default:return}},n}(e.FitComponent);e.GuildArmamentBuff=t,__reflect(t.prototype,"UI.GuildArmamentBuff",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="GuildArmamentBuffIconItemSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.dataChanged=function(){var e=GuildArmament.getBuffConfigByBuffId(this.data.buffId);this.buffIcon=e.buffIcon,this.leftTimes.text=this.data.leftTimes+"/"+this.data.maxTimes,this.leftTimes.textColor=this.data.leftTimes>0?color.GREEN:color.RED,this.imgDisable.visible=this.data.leftTimes<=0},t.prototype.onTouchTap=function(e){GuildWarMatchScene.clickBuff(this.data.buffId)},t}(eui.ItemRenderer);e.GuildArmamentBuffIconItem=t,__reflect(t.prototype,"UI.GuildArmamentBuffIconItem")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="GuildArmamentBuffItemSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.dataChanged=function(){var e=GuildArmament.getArmsTypeConfig(this.data.armsType),t=GuildArmament.getBuffConfigByArmsType(this.data.armsType),n=GuildArmament.getBuffLevelInfo(this.data.armsType);this.buffIcon=t.buffIcon,this.buffDesc=t.buffDesc,this.buffLevel="Lv."+n.curLevel,this.scoreIcon=e.scoreIcon,this.nextLevelNeed.text=this.data.score+"/"+n.nextLevelScore},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgBuffIcon:this.showBuffTips();break;default:return}},n.prototype.showBuffTips=function(){var t=this.data.armsType,n=GuildArmament.getBuffLevelInfo(t),i=n.curLevel,a=GuildArmament.getBuffTips2(t,i);e.ConfirmBox.Show(e.ConfirmBoxStyle.bufftips,"",a,null,null,null)},n}(eui.ItemRenderer);e.GuildArmamentBuffItem=t,__reflect(t.prototype,"UI.GuildArmamentBuffItem")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="GuildArmamentChangeItemSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.onTouchTap=function(e){switch(e.target){case this.btnChange:GuildArmament.changeAward(this.data.armsType);break;default:return}},t.prototype.dataChanged=function(){var e=GuildArmament.getArmsTypeConfig(this.data.armsType),t=~~(this.data.score/e.changeRate);this.scoreIcon=e.scoreIcon,this.scoreNum.text=this.data.score+"/"+e.changeRate,this.scoreNum.textColor=t>0?color.GREEN:color.RED,this.cellAward.data=e.changeAward,this.awardName=table.getAwardName(e.changeAward),this.awardNum="x "+t,this.btnChange.enabled=t>0,this.badge.visible=t>0},t}(eui.ItemRenderer);e.GuildArmamentChangeItem=t,__reflect(t.prototype,"UI.GuildArmamentChangeItem")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="GuildArmamentChangeUISkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.dataItem=new eui.ArrayCollection,e.dataBuff=new eui.ArrayCollection,e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.listItem.itemRenderer=e.GuildArmamentChangeItem,this.listItem.dataProvider=this.dataItem,this.listBuff.itemRenderer=e.GuildArmamentBuffItem,this.listBuff.dataProvider=this.dataBuff},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.GuildArmamentSyncScoreInfo,this.updateScoreItems,this),this.updateScoreItems()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.GuildArmamentSyncScoreInfo,this.updateScoreItems,this)},n.prototype.updateScoreItems=function(){for(var e=[],t=0;t!=GuildArmament.myScore.length;t++)e.push({armsType:t,score:GuildArmament.myScore[t]});this.dataItem.replaceAll(e);for(var n=[],t=0;t!=GuildArmament.guildScore.length;t++)n.push({armsType:t,score:GuildArmament.guildScore[t]});this.dataBuff.replaceAll(n)},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:case this.btnClose:case this.btnBack:UIManager.pop(this);break;default:return}},n}(e.FitComponent);e.GuildArmamentChangeUI=t,__reflect(t.prototype,"UI.GuildArmamentChangeUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.killStreak=0,e.remainingTime=new RemainingTime,e.skinName="GuildArmamentConvoyNoteSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),n.prototype.onTimer=function(){this.rest=this.remainingTime.getMinuteSecond()},n.prototype.onAddToStage=function(){SecondTicker.addEventListener(this.onTimer,this)},n.prototype.onRemoveFromStage=function(){SecondTicker.removeEventListener(this.onTimer,this)},Object.defineProperty(n.prototype,"convoyStage",{set:function(e){switch(e){case GuildArmament.CONVOY_STAGE_PREPARE:this.stageDesc.text=lang.String("convoy note stage desc prepare");break;case GuildArmament.CONVOY_STAGE_PK:this.stageDesc.text=lang.String("convoy note stage desc pk");break;case GuildArmament.CONVOY_STAGE_END:this.stageDesc.text=lang.String("convoy note stage desc end")}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"second",{set:function(e){this.remainingTime.delta=e,this.onTimer()},enumerable:!0,configurable:!0}),n.prototype.setKillStreak=function(e){this.killStreak=e},n.prototype.setCamp=function(e){this.groupProtectBox.visible=e==GuildArmament.CONVOY_CAMP_PROTECTOR},n.prototype.setProtectBoxNum=function(e){this.protectBoxNum=e},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnExit:this.onClickExit();break;default:return}},n.prototype.onClickExit=function(){var t=lang.String("operation confirm"),n=lang.StringWithFormat("convoy leave scene confirm msg");e.ConfirmBox.Show(e.ConfirmBoxStyle.team,t,n,function(){return net.socket.write(141,null),!0},null,null)},n}(e.FitComponent);e.GuildArmamentConvoyNote=t,__reflect(t.prototype,"UI.GuildArmamentConvoyNote",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="GuildArmamentConvoyResultSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.dataList=new eui.ArrayCollection,t}return __extends(t,e),t.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close();break;default:return}},t.prototype.close=function(){UIManager.pop(this)},t}(e.FitComponent);e.GuildArmamentConvoyResult=t,__reflect(t.prototype,"UI.GuildArmamentConvoyResult",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="GuildArmamentRobHistorySkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.dataHistory=new eui.ArrayCollection,e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.listHistory.itemRenderer=e.GuildArmamentRobItem,this.listHistory.dataProvider=this.dataHistory},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.GuildArmamentSyncRobHistory,this.updateHistoryItems,this),this.updateHistoryItems()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.GuildArmamentSyncRobHistory,this.updateHistoryItems,this)},n.prototype.updateHistoryItems=function(){this.dataHistory.replaceAll(GuildArmament.robHistory)},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:case this.btnClose:case this.btnBack:UIManager.pop(this);break;default:return}},n}(e.FitComponent);e.GuildArmamentRobHistory=t,__reflect(t.prototype,"UI.GuildArmamentRobHistory",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="GuildArmamentRobItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){var e=GuildArmament.getArmsTypeConfig(this.data.getArmsType());this.robTime=this.data.getRobTime(),this.robberName=this.data.getRobberName(),this.armsTypeName=e.name},t}(eui.ItemRenderer);e.GuildArmamentRobItem=t,__reflect(t.prototype,"UI.GuildArmamentRobItem")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="GuildArmamentUISkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.dataArms=new eui.ArrayCollection,e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.GuildArmamentSyncArmsInfo,this.updateArmItems,this),this.listArms.itemRenderer=e.GuildArmamentArmItem,this.listArms.dataProvider=this.dataArms},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.GuildArmamentSyncArmsInfo,this.updateArmItems,this)},n.prototype.updateArmItems=function(){this.dataArms.replaceAll(GuildArmament.armsInfo)},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:case this.btnClose:case this.btnBack:UIManager.pop(this);break;default:return}},n}(e.FitComponent);e.GuildArmamentUI=t,__reflect(t.prototype,"UI.GuildArmamentUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="RedPacketCareerSkin",t.careers=new eui.ArrayCollection,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.onAddToStage=function(){this.onRefresh()},t.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},t.prototype.close=function(){UIManager.pop(this)},t.compare=function(e,t){var n=e.status?1:0,i=t.status?1:0;return n==i?e.weight-t.weight:n-i},t.prototype.onRefresh=function(){if(!this.list){this.list=[];var e={};for(var n in RedPacket.settings){var i=RedPacket.settings[n];if(i.group){var a=e[i.group];a||(a=new RedPacket.GroupCareer,a.kinds=[],e[i.group]=a,this.list.push(a)),a.kinds.push(i.kind)}else{var a=new RedPacket.BaseCareer;a.kind=i.kind,this.list.push(a)}}this.list.sort(t.compare),this.careers.replaceAll(this.list)}},t}(e.FitComponent);e.RedPacketCareer=t,__reflect(t.prototype,"UI.RedPacketCareer",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.dataChanged=function(){this.data.status?(this.btnName=lang.String("redpacket got"),this.btn.enabled=!1):(this.btnName=lang.String("redpacket get"),this.btn.enabled=!0)},t}(eui.ItemRenderer);e.RedPacketCareerItemRenderer=t,__reflect(t.prototype,"UI.RedPacketCareerItemRenderer")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.dataChanged=function(){this.data.faction&&(this.portrait=table.faction[this.data.faction].portrait)},t}(eui.ItemRenderer);e.RedPacketInfoItem=t,__reflect(t.prototype,"UI.RedPacketInfoItem",["eui.UIComponent","egret.DisplayObject"]);var n=function(t){function n(){var e=t.call(this)||this;return e.skinName="RedPacketResultSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.records=new eui.ArrayCollection,e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.setInfo=function(e){null!=this.timerId&&(egret.clearTimeout(this.timerId),this.timerId=null),null!=this.packetId&&this.packetId.toHex()==e.id.toHex()||!this.results||(this.results.scrollV=0),this.packetId=e.id,RedPacket.isToastRedPacket(e.kind)?this.roleName=lang.String("guild toast redpacket name"):this.roleName=lang.StringWithFormat("{1}'s redpacket",e.owner),this.total=e.total,this.countDesc=e.quantity,e.quantity<=0?this.statusTip=lang.String("redpacket empty"):this.statusTip=null;var t=RedPacket.settings[e.kind];t&&(this.source=t.desc),this.setList(e.records),e.quantity>0&&(this.timerId=egret.setTimeout(this.onTimeout,this,1e3))},n.prototype.onTimeout=function(){this.timerId=null,RedPacket.FetchRedPacketDetail(this.packetId)},n.prototype.setList=function(e){this.myLuckyMoney.visible=!1;for(var t=-1,n=0;n<e.length;n++)if(e[n].name==Player.instance.Name){this.myLuckyMoney.visible=!0,this.luckyMoney=e[n].amount,t=n;break}if(t>=0){var i=e[t];e[t]=e[0],e[0]=i}this.records.replaceAll(e)},n.prototype.onRemoveFromStage=function(){null!=this.timerId&&(egret.clearTimeout(this.timerId),this.timerId=null),this.records.removeAll(),this.packetId=null,this.roleName=null,this.total=null,this.countDesc=null,this.statusTip=null,Game.dispatcher.removeEventListener(Game.EVENT.S2CRedPacketDetail,RedPacket.openRedPacketResult,null)},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},n.prototype.close=function(){UIManager.popNoTweens(this)},n.prototype.open=function(t){UIManager.pushNoTween(e.RedPacketResult.instance),this.setInfo(t)},n}(e.FitComponent);e.RedPacketResult=n,__reflect(n.prototype,"UI.RedPacketResult",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="RedPacketItemSkin",t.btnSend.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onSend,t),t}return __extends(t,e),t.prototype.dataChanged=function(){this.total=""+this.data.total},t.prototype.onSend=function(){RedPacket.send(this.data.kind)},t}(eui.ItemRenderer);e.RedPacketItem=t,__reflect(t.prototype,"UI.RedPacketItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="RedPacketUISkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.history=new eui.ArrayCollection,t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.HistoryRedPackets,this.onHistoryRedPackets,this)},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.HistoryRedPackets,this.onHistoryRedPackets,this)},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnClose:case this.btnClose1:case this.imgClose:UIManager.pop(this)}},t.compare=function(e,t){return e.deltaTime-t.deltaTime},t.prototype.onHistoryRedPackets=function(e){var n=e.data;n.sort(t.compare),this.history.replaceAll(n)},t}(e.FitComponent);e.RedPacketUI=t,__reflect(t.prototype,"UI.RedPacketUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="RedPacketViewItemSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.dataChanged=function(){null!=this.data.owner&&""!=this.data.owner?this.roleName=lang.StringWithFormat("{1}'s redpacket",this.data.owner):this.roleName="";var e=RedPacket.settings[this.data.kind];e&&(this.wishes=e.desc)},t.prototype.onTouchTap=function(e){switch(e.target){default:RedPacket.FetchRedPacketDetail(this.data.id)}},t}(eui.ItemRenderer);e.RedPacketViewItem=t,__reflect(t.prototype,"UI.RedPacketViewItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.convoyPrepareRemainingTime=new RemainingTime,e.dataArmamentScore=new eui.ArrayCollection,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.skinName="ChoseCitySkin",e}return __extends(n,t),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.tabPage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onChangePage,this),this.tabCity.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onChangeCity,this),this.listArmamentScore.dataProvider=this.dataArmamentScore,this.listArmamentScore.itemRenderer=e.AwardCell},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnJoin:this.onBtnJoin();break;case this.btnArmament:this.onBtnArmament();break;case this.btnRules:var n=new e.Rule;n.skinName="GuildWarChampaInfo",UIManager.push(n);break;case this.btnAwardsRule:var i=GuildWarTaskScene.getZhanchengAwards();UIManager.push(new e.AwardsRulePanel(i.title,i.awardsRule));break;case this.btnArmamentChangeAward:if(""==Player.instance.guildName)return void PopUpMessage.push(lang.String("armament you have no guild cannot get score info"),color.RED);null==e.GuildArmamentChangeUI.instance.parent&&UIManager.push(e.GuildArmamentChangeUI.instance),GuildArmament.applyPlayerInfo();break;case this.btnArmamentRobHistory:GuildArmament.applyRobHistory()}},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.GuildWarMatchCityListChange,this.onProcCitysInfo,this),Game.dispatcher.addEventListener(Game.EVENT.GuildWarMatchTimeLineChange,this.onProcTimeLine,this),Game.dispatcher.addEventListener(Game.EVENT.GuildArmamentSyncCityState,this.updateArmamentBtnState,this),Game.dispatcher.addEventListener(Game.EVENT.GuildArmamentSyncPlayerInfo,this.updateArmsPlayerInfo,this),GuildArmament.applyPlayerInfo(),SecondTicker.addEventListener(this.onTimer_ConvoyPrepareLeftTime,this),this.refresh()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.GuildWarMatchCityListChange,this.onProcCitysInfo,this),Game.dispatcher.removeEventListener(Game.EVENT.GuildWarMatchTimeLineChange,this.onProcTimeLine,this),Game.dispatcher.removeEventListener(Game.EVENT.GuildArmamentSyncCityState,this.updateArmamentBtnState,this),Game.dispatcher.removeEventListener(Game.EVENT.GuildArmamentSyncPlayerInfo,this.updateArmsPlayerInfo,this),SecondTicker.removeEventListener(this.onTimer_ConvoyPrepareLeftTime,this)},n.prototype.getCityLevel=function(e){return 1==e?1:e>=2&&3>=e?2:e>=4&&7>=e?3:4},n.prototype.onBtnJoin=function(){var e=Number(this.tabCity.selectedItem.id);GuildWarMatchScene.CanSignupCity(e,!1)&&GuildWarMatchScene.ConfirmSignupGuildWarMatch(e)},n.prototype.onBtnArmament=function(){var t=Number(this.tabCity.selectedItem.id);if(GuildArmament.isOpen()&&GuildArmament.cityState.cityId==t){if(GuildArmament.cityState.inCollectTime)return UIManager.push(e.GuildArmamentUI.instance),void GuildArmament.applyArmsInfo(Number(this.tabCity.selectedItem.id));var n=GuildArmament.cityState.stage==GuildArmament.CONVOY_STAGE_PREPARE||GuildArmament.cityState.stage==GuildArmament.CONVOY_STAGE_PK;GuildArmament.cityState.isMyCity&&Guild.isGuildManager()?(GuildArmament.cityState.inConvoyTime&&!n&&GuildArmament.openConvoy(t),n&&GuildArmament.enterConvoy(t)):(GuildArmament.cityState.inConvoyTime||n)&&GuildArmament.enterConvoy(t)}},n.prototype.onChangeCity=function(){this.openCity(Number(this.tabCity.selectedItem.id))},n.prototype.onChangePage=function(){this.openPage(Number(this.tabPage.selectedItem.pageId))},n.prototype.refresh=function(){GuildWarMatchScene.IsGuildWar2()?this.OpenByCity(1):this.OpenByCity(8),this.updateStateDesc()},n.prototype.openDefaultPage=function(){return null!=this.timeLine?GuildWarMatchScene.IsGuildWar2()&&this.timeLine.myFight>0?this.OpenByCity(1):this.timeLine.myFight>0?this.OpenByCity(this.timeLine.myFight):this.timeLine.myRight>0&&2==this.timeLine.step?this.openPage(4-this.timeLine.myRight+1):this.timeLine.myOwn>0?this.OpenByCity(this.timeLine.myOwn):GuildWarMatchScene.IsGuildWar2()?this.openPage(4):this.openPage(4-GuildWarMatchScene.GetSignupCityLevel()+1):GuildWarMatchScene.IsGuildWar2()?this.openPage(4):this.openPage(1)},n.prototype.onProcCitysInfo=function(){this.citysInfo=GuildWarMatchScene.getCitysInfo(),this.openDefaultPage()},n.prototype.onProcTimeLine=function(){this.timeLine=GuildWarMatchScene.getTimeLine(),this.openDefaultPage(),this.updateStateDesc()},n.prototype.updateStateDesc=function(){this.stateDesc=GuildWarMatchScene.GetStatusDesc()},n.prototype.OpenByCity=function(e){var t=this.getCityLevel(e);this.openPage(4-t+1),this.openCity(e)},n.prototype.openPage=function(e){e>=1&&4>=e||(e=1),this.tabPage.selectedIndex=e-1,this.openCitys(4-e+1)},n.prototype.openCitys=function(e){this.cityIdStart=8;var t=15;if(GuildWarMatchScene.IsGuildWar2()){if(null!=this.timeLine&&e>this.timeLine.openLevel)return PopUpMessage.push(lang.String("guildwar2 city not open"),color.RED),void this.openPage(4)}else if(null!=this.timeLine&&e<GuildWarMatchScene.GetSignupCityLevel()&&e!=this.getCityLevel(this.timeLine.myOwn))return PopUpMessage.push(lang.String("guildwarcity not open"),color.RED),void this.openPage(1);switch(e){case 1:this.cityIdStart=1,t=1;break;case 2:this.cityIdStart=2,t=3;break;case 3:this.cityIdStart=4,t=7;break;default:case 4:this.cityIdStart=8,t=15}for(var n=[],i=this.cityIdStart;t>=i;i++){var a=this.getCityConfig(i);null!=a&&n.push({name:a.name,id:a.id,action:null})}this.tabCity.dataProvider=new eui.ArrayCollection(n),this.openCity(this.cityIdStart)},n.prototype.openCity=function(e){(e<this.cityIdStart||e>=this.cityIdStart+this.tabCity.dataProvider.length)&&(e=this.cityIdStart),this.tabCity.selectedIndex=e-this.cityIdStart;var t=this.getCityConfig(e);null!=t&&(this.cityName=t.name,this.cityImg=t.img);var n=this.getCityInfo(e);if(null!=n){n.owner!=Player.instance.guildName?this.ownerName=n.owner:this.ownerName=lang.String("this is my own city");var i=Math.floor(this.citysInfo.myFight/10),a=this.citysInfo.myFight%10,r=n.guild1,o=n.guild2;if(GuildWarMatchScene.IsGuildWar2()&&(i=0,a=0,r=!1,o=!1),this.hasOwner=""!=n.owner,this.guild1Group.visible=r,this.guild2Group.visible=o,this.owner.visible=""!=n.owner,this.guild1="Đã tuyên chiến",this.guild2="Đã tuyên chiến",i==e)switch(a){case 0:this.guild1="Bang đã tuyên chiến";break;case 1:this.guild2="Bang đã tuyên chiến"}}this.btnJoin.enabled=this.canSignup(e),this.dataArmamentScore.replaceAll(GuildArmament.getCityScoreItems(e)),GuildArmament.applyCityState(e)},n.prototype.canSignup=function(e){return GuildWarMatchScene.CanSignupCity(e,!1)},n.prototype.getCityConfig=function(e){return e>=1&&e<=table.guildwarConfig.citys.length?table.guildwarConfig.citys[e-1]:void 0},n.prototype.getCityInfo=function(e){return null!=this.citysInfo&&e>=1&&e<=this.citysInfo.citys.length?this.citysInfo.citys[e-1]:void 0},n.prototype.updateArmamentBtnState=function(){var e=Number(this.tabCity.selectedItem.id);if(GuildArmament.cityState.cityId==e){var t="",n=GuildArmament.isOpen(),i=GuildArmament.cityState.inCollectTime,a=GuildArmament.cityState.inConvoyTime,r=GuildArmament.cityState.isMyCity,o=GuildArmament.cityState.stage,s=o==GuildArmament.CONVOY_STAGE_PREPARE||o==GuildArmament.CONVOY_STAGE_PK;n&&(i||a||s)&&(i&&(t=r?lang.String("armament chosecity ui btn msg collect armament"):lang.String("armament chosecity ui btn msg rob armament")),r?Guild.isLeader()?(GuildArmament.cityState.inConvoyTime&&!s&&(t=lang.String("armament chosecity ui btn msg convoy open")),s&&(t=lang.String("armament chosecity ui btn msg convoy protector"))):(a||s)&&(t=lang.String("armament chosecity ui btn msg convoy protector")):(a||s)&&(t=lang.String("armament chosecity ui btn msg convoy robber")),i||o!=GuildArmament.CONVOY_STAGE_END||(t="")),""!=t?(this.btnArmament.label=t,this.btnArmament.enabled=!0,this.groupArmament.scaleX=1,this.groupArmament.scaleY=1,this.groupArmament.visible=!0):(this.btnArmament.enabled=!1,this.groupArmament.scaleX=0,this.groupArmament.scaleY=0,this.groupArmament.visible=!1),n&&GuildArmament.cityState.cityId==e&&s?(this.convoyPrepareRemainingTime.delta=GuildArmament.cityState.getConvoyPrepareLeftTime(),this.onTimer_ConvoyPrepareLeftTime()):this.convoyPrepareRemainingTime.delta=0;var l="",u=color.RED;n&&(r?a&&!s?(l=lang.String("convoy stage info not open yet"),u=color.RED):a&&s&&(l=lang.String("convoy stage info already open"),u=color.GREEN):this.hasOwner?a&&(0==o&&(l=lang.String("convoy stage info not open yet"),u=color.RED),o==GuildArmament.CONVOY_STAGE_PK&&(l=lang.String("convoy stage info already open"),u=color.GREEN)):(l=lang.String("convoy stage info no owner cannot open"),u=color.RED),o==GuildArmament.CONVOY_STAGE_END&&(l="")),""!=l?(this.convoyStageInfo.scaleX=1,this.convoyStageInfo.scaleY=1,this.convoyStageInfo.text=l,this.convoyStageInfo.textColor=u,this.convoyPrepareRemainingTime.delta=0,this.convoyPrepareLeftTime=""):(this.convoyStageInfo.scaleX=0,this.convoyStageInfo.scaleY=0,this.convoyStageInfo.text=l),this.btnArmament.enabled=this.hasOwner
}},n.prototype.updateArmsPlayerInfo=function(){this.armsCollectTime.text=GuildArmament.todayCollectTimes+"/"+GuildArmament.armsSetting.dailyMaxCollectTimes,this.armsRobTime.text=GuildArmament.todayRobTimes+"/"+GuildArmament.armsSetting.dailyMaxRobTimes},n.prototype.onTimer_ConvoyPrepareLeftTime=function(){if(this.convoyPrepareRemainingTime.delta>0){var e=this.convoyPrepareRemainingTime.getMinuteSecond();this.convoyPrepareLeftTime=lang.StringWithFormat("convoy prepare lefttime {1}",e)}else this.convoyPrepareLeftTime=""},n}(e.FitComponent);e.ChoseCity=t,__reflect(t.prototype,"UI.ChoseCity",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="DonationsSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btnDonate.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnDonate,this),this.btnViewSort.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnViewSort,this)},n.prototype.onAddToStage=function(){this.refresh(),Game.dispatcher.addEventListener(Game.EVENT.AddItem,this.refresh,this),Game.dispatcher.addEventListener(Game.EVENT.RemoveItem,this.refresh,this),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,this.refresh,this),Game.dispatcher.addEventListener(Game.EVENT.BagItemChange,this.refresh,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.AddItem,this.refresh,this),Game.dispatcher.removeEventListener(Game.EVENT.RemoveItem,this.refresh,this),Game.dispatcher.removeEventListener(Game.EVENT.UpdateItem,this.refresh,this),Game.dispatcher.removeEventListener(Game.EVENT.BagItemChange,this.refresh,this)},n.prototype.close=function(){UIManager.pop(this)},n.prototype.onBtnViewSort=function(){e.RankingUI.open(e.RankKind.GuildWarRank)},n.prototype.onBtnDonate=function(){GuildWarMatchScene.ApplyDonate()},n.prototype.refresh=function(){var e=GuildWarMatchScene.GetDonateInfo();this.num=e.num,this.exp=e.exp,this.con=e.con,this.score=e.score,this.btnDonate.enabled=e.num>0},n}(e.FitComponent);e.Donations=t,__reflect(t.prototype,"UI.Donations",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){return t.call(this)||this}return __extends(n,t),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),this.addEventListener(Game.EVENT.GuildWarTokenChange,this.updateToken,this)},n.prototype.updateButton=function(e){0==e&&(this.currentState="notyet"),4==e&&(this.currentState="closed"),5==e&&(this.currentState="recharge"),2==e&&(this.currentState="finished"),1==e&&(this.currentState="opening",this.data.taskId>Guild.GuildWarTask.CollectToken&&(this.data.tips=lang.String("guildwartaskscene can open"))),3==e&&(this.currentState="finished_still_open",this.data.taskId>Guild.GuildWarTask.CollectToken&&(this.data.tips=lang.String("guildwartaskscene can open")))},n.prototype.dataChanged=function(){this.progressBar.maximum=this.data.maxProgress,this.progressBar.value=this.data.progress,this.updateButton(this.data.checkFunc())},n.prototype.updateToken=function(){this.data.taskId==Guild.GuildWarTask.CollectToken&&(this.progressBar.value=Guild.GuildWarGetToken(),this.updateButton(this.data.checkFunc()))},n.prototype.processOnClick=function(){return"recharge"==this.currentState?void e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],lang.String("guildwar"),lang.StringWithFormat("guildwar recharge desc",600),function(){return net.socket.write(2047,null),!0},function(){return!0},function(){return!0}):Game.isWildMap()?(this.data.onClick(),void UIManager.pop(e.GuildWarHome.instance)):void PopUpMessage.push(lang.String("operation not permitted"),color.RED)},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnJoin:this.processOnClick();break;case this.btnRule:var n=void 0;switch(this.data.taskId){case Guild.GuildWarTask.CollectToken:n=GuildWarTaskScene.getFuniushanAwards(),UIManager.push(new e.AwardsRulePanel(n.title,n.awardsRule));break;case Guild.GuildWarTask.AttackGate:n=GuildWarTaskScene.getFuniushanmenAwards(),UIManager.push(new e.AwardsRulePanel(n.title,n.awardsRule));break;case Guild.GuildWarTask.Unstoppable:n=GuildWarTaskScene.getShanzeiqiantingAwards(),UIManager.push(new e.AwardsRulePanel(n.title,n.awardsRule));break;case Guild.GuildWarTask.FuniushanFinal:n=GuildWarTaskScene.getFuniushanmokuAwards(),UIManager.push(new e.AwardsRulePanel(n.title,n.awardsRule))}}},n}(eui.ItemRenderer);e.expedition_item=t,__reflect(t.prototype,"UI.expedition_item",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.MaxPage=4,e.dataSet=[],e.skinName="ExpeditionSkin",e.PageId=0,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.SwitchPage=function(e){this.PageId=e,this.UpdatePage()},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnDonate:this.onBtnDonate();break;case this.btnJoinBattle:this.onBtnJoinBattle();break;case this.btnRules:var n=new e.Rule;n.skinName="GuildWarReadyInfo",UIManager.push(n)}},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.GuildWarMatchTimeLineChange,this.UpdatePage,this),Game.dispatcher.addEventListener(Game.EVENT.GuildWarInfoUpdate,this.UpdatePage,this),this.UpdatePage()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.GuildWarMatchTimeLineChange,this.UpdatePage,this),Game.dispatcher.removeEventListener(Game.EVENT.GuildWarInfoUpdate,this.UpdatePage,this)},n.prototype.onBtnDonate=function(){GuildWarMatchScene.CanDonate(!0)&&UIManager.push(new e.Donations)},n.prototype.onBtnJoinBattle=function(){GuildWarMatchScene.ApplyJoinMatch(!1)},n.prototype.UpdatePage=function(){switch(this.taskList.itemRenderer=e.expedition_item,this.dataSet=[],this.PageId){default:case 1:this.UpdatePage_1()}this.taskList.dataProvider=new eui.ArrayCollection(this.dataSet)},n.prototype.UpdatePage_1=function(){var t=table.guildwarTask,n=Guild.GuildWarTask.CollectToken;this.dataSet.push({taskId:n,name:t[n].name,tips:t[n].tips,desc:t[n].desc,progress:Guild.GuildWarGetToken(),maxProgress:Guild.MAX_GUILDWAR_TOKEN,icon:t[n].icon,checkFunc:function(){return Game.eraDay+1>7?Guild.guildWar.token>=Guild.MAX_GUILDWAR_TOKEN?2:5:Guild.guildWar.token>=Guild.MAX_GUILDWAR_TOKEN?3:Game.eraDay+1<t[n].eraDay||PlayerAttribute.Level<30?0:1},onClick:function(){if(LittleBoss.current<3)return void PopUpMessage.push(lang.String("GuildWar NeedBeatBoss"),color.RED);var e=new net.def.C2SApplyEnterMap;e.setMapId(5e4),net.socket.write(23,e.toArrayBuffer())}});for(var i=function(n){var i=t[n].eraDay-(Game.eraDay+1),r=Game.getServerDate(),o=new Date(r.getFullYear(),r.getMonth(),r.getDate()+i,r.getHours(),r.getMinutes(),r.getSeconds()),s=o.getDate().toString()+"/"+(o.getMonth()+1).toString(),l=Game.getServerDate().getHours(),u=Game.getServerDate().getMinutes(),c="";(Game.eraDay+1<t[n].eraDay||Game.eraDay+1==t[n].eraDay&&1945>100*l+u)&&(c+=lang.StringWithFormat("guildwartask open date{1}",s)),(Guild.guildWar.token<Guild.MAX_GUILDWAR_TOKEN||Guild.GuildWarGetTaskProgress()<n)&&(c=c+"\n"+lang.String("guildwartask need premission")),a.dataSet.push({taskId:n,name:t[n].name,tips:c,desc:t[n].desc,progress:Guild.GuildWarGetTaskProgress()>n,maxProgress:1,icon:t[n].icon,checkFunc:function(){return Guild.GuildWarGetTaskProgress()>n?3:Game.eraDay+1<t[n].eraDay||Guild.guildWar.token<Guild.MAX_GUILDWAR_TOKEN||Guild.GuildWarGetTaskProgress()<n?0:Game.eraDay+1==t[n].eraDay&&1945>100*l+u?0:1},onClick:function(){e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],lang.String("guildwar"),lang.String("guildwartask confirm content"),function(){var e=new net.def.C2SJoinGuildWarTaskScene;return e.taskId=n,net.socket.write(2021,e.toArrayBuffer()),!0},function(){return!0},function(){return!0})}})},a=this,r=Guild.GuildWarTask.AttackGate;r<=Guild.GuildWarTask.FuniushanFinal;r++)i(r);this.btnJoinBattle.enabled=GuildWarMatchScene.CanJoinBattle(!1,!1),this.updateStateDesc()},n.prototype.updateStateDesc=function(){this.stateDesc=GuildWarMatchScene.GetStatusDesc()},n}(eui.Component);e.expedition=t,__reflect(t.prototype,"UI.expedition",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="FristWarRewardSkin",t}return __extends(t,e),t.prototype.close=function(){UIManager.pop(this)},t}(eui.Component);e.FristWarReward=t,__reflect(t.prototype,"UI.FristWarReward",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="GuildWarAwardTipSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},t.prototype.close=function(){UIManager.pop(this)},t}(e.FitComponent);e.GuildWarAwardTip=t,__reflect(t.prototype,"UI.GuildWarAwardTip",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.rank=[],e.skinName="GuildBossNoteSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.myRank=0,this.myScore=0,this.reviveCount=30},n.prototype.UpdateRank=function(){null!=this.rank&&null!=this.list&&(this.list.itemRenderer=e.PlayerKillList,this.list.dataProvider=new eui.ArrayCollection(this.rank))},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnBonus:var n=void 0;switch(this.type){case GuildWarTaskScene.GuildWarTaskType.guildwartask_fnsm:n=GuildWarTaskScene.getFuniushanmenAwards(),UIManager.push(new e.AwardsRulePanel(n.title,n.awardsRule));break;case GuildWarTaskScene.GuildWarTaskType.guildwartask_shanzei:n=GuildWarTaskScene.getShanzeiqiantingAwards(),UIManager.push(new e.AwardsRulePanel(n.title,n.awardsRule));break;case GuildWarTaskScene.GuildWarTaskType.guildwartask_moku:n=GuildWarTaskScene.getFuniushanmokuAwards(),UIManager.push(new e.AwardsRulePanel(n.title,n.awardsRule))}}},n}(e.FitComponent);e.GuildWarBossNote=t,__reflect(t.prototype,"UI.GuildWarBossNote",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.awardList.itemRenderer=e.AwardCell,this.awardList.dataProvider=new eui.ArrayCollection(table.guildWarAward[1])},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.GuildWarSignInfo,this.UpdatePage,this),this.UpdatePage()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.GuildWarSignInfo,this.UpdatePage,this)},n.prototype.UpdatePage=function(){Guild.GuildWarGetTaskProgress()>=1?this.currentState="signed":this.currentState="unsigned"},n.prototype.Trying2SignUp=function(){net.socket.write(2020,null)},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnSignUp:this.Trying2SignUp();break;case this.btnRules:var n=new e.Rule;n.skinName="GuildWarInfo",UIManager.push(n)}},n}(eui.Component);e.GuildWarEntry=t,__reflect(t.prototype,"UI.GuildWarEntry",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="GuildWarHomeSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.tabPage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onChangePage,this),this.pageStack.selectedIndex=t.pageLogin,this.tabPage.selectedIndex=t.pageLogin,this.UpdatePage()},t.prototype.UpdatePage=function(){return null!=this.pageId?void this.openPage(this.pageId):void(Guild.GuildWarGetTaskProgress()<1?(this.tabPage.visible=!1,this.pageStack.selectedIndex=t.pageLogin,this.tabPage.selectedIndex=t.pageLogin):(this.tabPage.visible=!0,this.openPage(GuildWarMatchScene.getDefaultPage())))},t.prototype.openPage=function(e){return null==this.tabPage?void(this.pageId=e):(Guild.GuildWarGetTaskProgress()<1?(this.tabPage.visible=!1,this.pageStack.selectedIndex=t.pageLogin,this.tabPage.selectedIndex=t.pageLogin):(this.tabPage.visible=!0,e==t.pageCityBattle&&(GuildWarMatchScene.canOpenGuildWar2()||(PopUpMessage.push(lang.String("guildwar2 will open at week 5"),color.RED),e=t.pageChooseCity)),e>=0&&e<this.pageStack.length&&(this.pageStack.selectedIndex=e,this.tabPage.selectedIndex=e)),void(this.pageId=null))},t.prototype.OpenPage=function(e){this.openPage(e),UIManager.push(this)},t.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.GuildWarSignInfo,this.UpdatePage,this),Game.dispatcher.addEventListener(Game.EVENT.GuildWarMatchCityListChange,this.UpdatePage,this),GuildWarMatchScene.ApplyCityInfo(),this.UpdatePage()},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.GuildWarSignInfo,this.UpdatePage,this),Game.dispatcher.removeEventListener(Game.EVENT.GuildWarMatchCityListChange,this.UpdatePage,this)},t.prototype.onChangePage=function(){this.pageStack.length-1>=this.tabPage.selectedIndex&&this.openPage(this.tabPage.selectedIndex)},t.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},t.prototype.close=function(){UIManager.pop(this)},t.pageLogin=0,t.pageExpedition=1,t.pageCityBattle=2,t.pageChooseCity=3,t}(e.FitComponent);e.GuildWarHome=t,__reflect(t.prototype,"UI.GuildWarHome",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="GuildWarTaskResultSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onAddToStage=function(){1==this.win?this.currentState="succeed":this.currentState="failed",0==this.data.length?(this.list.visible=!1,this.myAwardGroup.visible=!1):(this.list.itemRenderer=e.AwardCell,this.list.dataProvider=new eui.ArrayCollection(this.data)),0==this.auctionData.length?this.auctionList.visible=!1:(this.auctionList.visible=!0,this.auctionlist.itemRenderer=e.AwardCell,this.auctionlist.dataProvider=new eui.ArrayCollection(this.auctionData))},n.prototype.show=function(e,t,n){this.win=n,this.data=e,this.auctionData=t},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:}},n.prototype.close=function(){UIManager.pop(this)},n}(e.FitComponent);e.GuildWarTaskResult=t,__reflect(t.prototype,"UI.GuildWarTaskResult",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.remainingTime=new RemainingTime,e.skinName="GuildWarTimeSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),n.prototype.UpdateState=function(e,t){this.currentState=""+e,this.second=t},n.prototype.UpdateMemberCount=function(e){this.memberNum=""+e},n.prototype.UpdateScore=function(e,t){this.score0=""+e,this.score1=""+t},n.prototype.onTimer=function(){this.rest=this.remainingTime.getMinuteSecond()},n.prototype.onAddToStage=function(){SecondTicker.addEventListener(this.onTimer,this)},n.prototype.onRemoveFromStage=function(){SecondTicker.removeEventListener(this.onTimer,this)},Object.defineProperty(n.prototype,"second",{set:function(e){this.remainingTime.delta=e,this.onTimer()},enumerable:!0,configurable:!0}),n.prototype.onTouchTap=function(t){switch(t.target){case this.btnAwardTips:UIManager.push(new e.GuildWarAwardTip)}},n}(e.FitComponent);e.GuildWarTime=t,__reflect(t.prototype,"UI.GuildWarTime",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="ReadyAreaSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.GuildWarMatchMemberCountChange,this.applyMemberList,this),Game.dispatcher.addEventListener(Game.EVENT.GuildWarMatchMemberListChange,this.updateMemberList,this),this.updateMemberList(),this.applyMemberList()},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.GuildWarMatchMemberCountChange,this.applyMemberList,this),Game.dispatcher.removeEventListener(Game.EVENT.GuildWarMatchMemberListChange,this.updateMemberList,this)},t.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},t.prototype.applyMemberList=function(){GuildWarMatchScene.ApplyMembersList()},t.prototype.updateMemberList=function(){var e=GuildWarMatchScene.GetMemberList();this.memberList.dataProvider=new eui.ArrayCollection(e),this.memberNum=e.length},t.prototype.close=function(){UIManager.pop(this)},t}(e.FitComponent);e.ReadyArea=t,__reflect(t.prototype,"UI.ReadyArea",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="Guildwar2AwardSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.open=function(e){this.opened&&this.close(),this.guild=e,this.week=GuildWarMatchScene.GetWeekNo(),this.week<5&&(this.week=5),UIManager.push(this)},n.prototype.onAddToStage=function(){this.updateAwardList(),this.opened=!0},n.prototype.onRemoveFromStage=function(){this.opened=!1},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},n.prototype.updateAwardList=function(){var t=table.getGuildwar2AwardConfig(this.guild,this.week);return null==t?void this.close():(this.guild?this.currentState="guild":this.currentState="personal",this.scroll.verticalScrollBar.viewport.scrollV=0,this.awardList.itemRenderer=e.Guildwar2AwardItem,void(this.awardList.dataProvider=new eui.ArrayCollection(t.viewAwards)))},n.prototype.close=function(){UIManager.pop(this)},n}(e.FitComponent);e.Guildwar2Award=t,__reflect(t.prototype,"UI.Guildwar2Award",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="Guildwar2AwardItemSkin",e}return __extends(n,t),n.prototype.dataChanged=function(){if(null!=this.data){if(this.score="",this.rank="",this.city="",null!=this.data.score)this.currentState="personal",this.score="Điểm đạt "+this.data.score;else{this.currentState="guild",this.rank="Hạng "+this.data.rank;var t=GuildWarMatchScene.getGuildWar2AwardCityName(this.data.rank);null!=t&&(this.city="Chiếm "+t)}this.listAward.itemRenderer=e.AwardCell,this.listAward.dataProvider=new eui.ArrayCollection(this.data.viewAward)}},n}(eui.ItemRenderer);e.Guildwar2AwardItem=t,__reflect(t.prototype,"UI.Guildwar2AwardItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.remainingTime=new RemainingTime,t.guideMaxTime=0,t.guideLeftTime=0,t.skinName="GuildWar2BattleInfoSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.prototype.UpdateState=function(e,t){this.currentState=""+e,this.second=t},t.prototype.UpdateScore=function(e){var t="          ";if(null==e)return this.playerNum=null,this.topGuild=t,this.topGuildScore=null,this.myGuildScore=null,this.myScore=null,this.flag1=t,this.flag2=t,void(this.flag3=t);this.playerNum=e.playerCount,this.topGuild=e.topGuildName,this.topGuildScore=e.topGuildScore,this.myGuildScore=e.myGuildScore,this.myScore=e.myScore;var n=e.flagOwner;null!=n&&n.length>=3&&(this.flag1=n[0],this.flag2=n[1],this.flag3=n[2]),""==this.topGuild&&(this.topGuild=t),""==this.flag1&&(this.flag1=t),""==this.flag2&&(this.flag2=t),""==this.flag3&&(this.flag3=t)},t.prototype.onTimer=function(){this.rest=this.remainingTime.getMinuteSecond(),this.guideMaxTime>0&&this.guideLeftTime<this.guideMaxTime&&(this.guideLeftTime++,this.bar.value=this.guideLeftTime,this.guideLeftTime>=this.guideMaxTime&&(this.groupProgress.visible=!1,this.groupGoto.visible=!0))},t.prototype.onAddToStage=function(){SecondTicker.addEventListener(this.onTimer,this),this.foldToggle.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onFoldTopGroup,this),Game.dispatcher.addEventListener(Game.EVENT.GuildWar2GuideChange,this.onEventSyncGuide,this),"1"==this.currentState&&(GuildWar2Scene.setGuideTime(10),this.onEventSyncGuide())},t.prototype.onRemoveFromStage=function(){SecondTicker.removeEventListener(this.onTimer,this),this.foldToggle.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onFoldTopGroup,this),Game.dispatcher.removeEventListener(Game.EVENT.GuildWar2GuideChange,this.onEventSyncGuide,this)},t.prototype.onEventSyncGuide=function(){var e=GuildWar2Scene.getGuideTime();return"1"!=this.currentState?void(this.groupGuide.visible=!1):(this.groupGuide.visible=e>0,void(e>0?(this.guideMaxTime=e,this.guideLeftTime=0,this.groupProgress.visible=!0,this.groupGoto.visible=!1,this.bar.maximum=e,this.bar.value=0):(this.guideMaxTime=0,this.guideLeftTime=0)))},Object.defineProperty(t.prototype,"second",{set:function(e){this.remainingTime.delta=e,this.onTimer()},enumerable:!0,configurable:!0}),t.prototype.onTouchTap=function(e){switch(e.target){case this.btnAwardTips:break;case this.btnGoto1:GuildWar2Scene.gotoTrap(1);break;case this.btnGoto2:GuildWar2Scene.gotoTrap(2);break;case this.btnGoto3:GuildWar2Scene.gotoTrap(3);break;case this.btnGoto4:GuildWar2Scene.gotoTrap(4)}},t.prototype.onFoldTopGroup=function(){this.foldToggle.selected?(Game.removeFromParent.apply(this.groupInfo),this.groupMain.right=this.foldToggle.width+5):this.groupInfo.parent!=this.groupMain&&(this.groupMain.addChildAt(this.groupInfo,1),this.groupMain.right=5)},t}(e.FitComponent);e.GuildWar2BattleInfo=t,__reflect(t.prototype,"UI.GuildWar2BattleInfo",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.memberNum=0,e.delayClose=MakeDelayExecute(e.close,e,4e4),e.skinName="GuildWar2GuildListSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.open=function(e,t){this.applyData=e,UIManager.push(this),t&&this.delayClose()},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.GuildWar2GuildListChange,this.updateMemberList,this),this.updateMemberList(),this.applyData&&this.applyMemberList(),this.opened=!0},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.GuildWar2GuildListChange,this.updateMemberList,this),this.opened=!1},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},n.prototype.applyMemberList=function(){GuildWar2Scene.ApplyMembersList()},n.prototype.updateMemberList=function(){var t=GuildWar2Scene.GetGuildList();this.memberNum=0;for(var n=0;n<t.length;n++)this.memberNum+=t[n].playerCount;this.guildList.itemRenderer=e.GuildWar2GuildListItem,this.guildList.dataProvider=new eui.ArrayCollection(t)},n.prototype.close=function(){UIManager.pop(this)},n}(e.FitComponent);e.GuildWar2GuildList=t,__reflect(t.prototype,"UI.GuildWar2GuildList",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="GuildWar2GuildListItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){null!=this.data&&(this.data.name==Guild.guildInfo.name?this.currentState="mine":this.currentState="normal")},t}(eui.ItemRenderer);e.GuildWar2GuildListItem=t,__reflect(t.prototype,"UI.GuildWar2GuildListItem")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="Guildwar2MainSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.GuildWarMatchTimeLineChange,this.refresh,this),this.refresh()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.GuildWarMatchTimeLineChange,this.refresh,this)},n.prototype.refresh=function(){this.btnJoinBattle.enabled=GuildWarMatchScene.CanJoinBattle(!0,!1),this.updateStateDesc()},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnPersonalAward:e.Guildwar2Award.instance.open(!1);break;case this.btnGuildAward:e.Guildwar2Award.instance.open(!0);break;case this.btnJoinBattle:GuildWarMatchScene.ApplyJoinMatch(!0)}},n.prototype.updateStateDesc=function(){this.stateDesc=GuildWarMatchScene.GetStatusDesc(),this.labelFight.textFlow=Game.HtmlTextParser.parse(GuildWarMatchScene.GetGuildWar2FightStatus())},n}(eui.Component);e.Guildwar2Main=t,__reflect(t.prototype,"UI.Guildwar2Main",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="HalfYearDrawAwardSkin",n.dataList=new eui.ArrayCollection,n.list.dataProvider=n.dataList,n.list.itemRenderer=e.AwardCell,n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n}return __extends(n,t),n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.onAddToStage=function(){this.imgBg.source=HalfYearDraw.drawBoxUIConfig.imgBg,this.dataList.replaceAll(HalfYearDraw.drawBoxUIConfig.awards),this.updateData(),Game.dispatcher.addEventListener(Game.EVENT.HalfYearDrawSycnInfo,this.updateData,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.HalfYearDrawSycnInfo,this.updateData,this)},n.prototype.updateData=function(){var e=HalfYearDraw.getDrawBoxTimes();if(e>0)this.groupFree.visible=!0,this.groupPay.visible=!1,this.freeCostTimes1.text="1",this.freeCostTimes1.textColor=color.GREEN,this.freeCostTimes10.text="10",this.freeCostTimes10.textColor=e>=10?color.GREEN:color.RED;else{this.groupFree.visible=!1,this.groupPay.visible=!0;var t=PlayerAttribute.currency[Game.Currency.GoldCoin];this.payCostTimes1.text=""+HalfYearDraw.drawBoxCost,this.payCostTimes1.textColor=t>=HalfYearDraw.drawBoxCost?color.GREEN:color.RED,this.payCostTimes10.text=""+HalfYearDraw.drawBoxCostTen,this.payCostTimes10.textColor=t>=HalfYearDraw.drawBoxCostTen?color.GREEN:color.RED}},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnFree1:HalfYearDraw.drawAward(HalfYearDraw.DRAWAWARDTYPE_KEY,1);break;case this.btnFree10:HalfYearDraw.drawAward(HalfYearDraw.DRAWAWARDTYPE_KEY,10);break;case this.btnPay1:HalfYearDraw.drawAward(HalfYearDraw.DRAWAWARDTYPE_MONEY,1);break;case this.btnPay10:HalfYearDraw.drawAward(HalfYearDraw.DRAWAWARDTYPE_MONEY,10)}},n}(eui.Component);e.HalfYearDrawAward=t,__reflect(t.prototype,"UI.HalfYearDrawAward",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="HalfYearDrawHallSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.tabBar.addEventListener(eui.ItemTapEvent.ITEM_TAP,e.onBarItemTap,e),e}return __extends(n,t),n.open=function(e){null==this.instance&&(this.instance=new n),null==e&&(e=HalfYearDraw.isWheelFree()?0:1),this.instance.page=e,UIManager.pushPage(this.instance)},n.changePage=function(e){null==this.instance&&(this.instance=new n),this.instance.page=e,this.instance.tabBar.selectedIndex=e},n.prototype.onBarItemTap=function(){this.page=this.tabBar.selectedIndex},n.prototype.onAddToStage=function(){this.tabBar.selectedIndex=this.page,this.openDate.text=Activity.getLastTime(HalfYearDraw.activity.kindId),this.updateData(),Game.dispatcher.addEventListener(Game.EVENT.HalfYearDrawSycnInfo,this.updateData,this),Game.dispatcher.addEventListener(Game.EVENT.CurrencyChange[Game.Currency.Fubi],this.updateData,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.HalfYearDrawSycnInfo,this.updateData,this),Game.dispatcher.removeEventListener(Game.EVENT.CurrencyChange[Game.Currency.Fubi],this.updateData,this)},n.prototype.updateData=function(){this.freeTimes=HalfYearDraw.getDrawBoxTimes(),this.fubiNum.text=PlayerAttribute.currency[Game.Currency.Fubi].toString()},n.prototype.onTouchTap=function(t){switch(t.target){case this.imgClose:this.close();break;case this.btnRules:var n=new e.Rule;n.skinName="HalfyearDrawRuleSkin",UIManager.pushPage(n)}},n}(e.FitComponent);e.HalfYearDrawHall=t,__reflect(t.prototype,"UI.HalfYearDrawHall",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="HalfyearDrawKeyResultSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),n.open=function(e){null==this.instance&&(this.instance=new n),this.instance.count=e,this.instance.leftTime=10,UIManager.pushPage(this.instance)},n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.onAddToStage=function(){SecondTicker.addEventListener(this.onTimer_UpdateTime,this),this.showLeftTime(),this.cell.data={type:"clientitem",icon:"icon/item/ys.png",name:"Chìa May Mắn",quality:4,desc:"Chìa May Mắn, dùng mở Rương May Mắn",count:""+this.count,plugin:""}
},n.prototype.onRemoveFromStage=function(){SecondTicker.removeEventListener(this.onTimer_UpdateTime,this)},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.Close();break;case this.btnOpenBox:this.gotoDrawBox()}},n.prototype.Close=function(){UIManager.pop(this)},n.prototype.gotoDrawBox=function(){this.Close(),e.HalfYearDrawHall.changePage(1)},n.prototype.onTimer_UpdateTime=function(){this.leftTime=this.leftTime-1,this.leftTime<=0&&this.Close(),this.showLeftTime()},n.prototype.showLeftTime=function(){this.closeTips.text=this.leftTime+" giây sau tự đóng"},n}(e.FitComponent);e.HalfyearDrawKeyResult=t,__reflect(t.prototype,"UI.HalfyearDrawKeyResult",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="HalfyearShopSkin",n.dataList=new eui.ArrayCollection,n.list.itemRendererSkinName="FameGoodsSkin",n.list.itemRenderer=e.FameGoods,n.list.dataProvider=n.dataList,n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n}return __extends(n,t),n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.onAddToStage=function(){this.scroller.viewport.scrollV=0,this.onUpdate(),Game.dispatcher.addEventListener(Game.EVENT.HalfYearDrawSycnInfo,this.onUpdate,this),Game.dispatcher.addEventListener(Game.EVENT.CurrencyChange[Game.Currency.BetScore],this.onUpdate,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.HalfYearDrawSycnInfo,this.onUpdate,this),Game.dispatcher.removeEventListener(Game.EVENT.CurrencyChange[Game.Currency.BetScore],this.onUpdate,this)},n.prototype.onUpdate=function(){this.dataList.replaceAll(HalfYearDraw.shopGoods)},n}(eui.Component);e.HalfyearShop=t,__reflect(t.prototype,"UI.HalfyearShop",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.speedUpTime=2,t.speedCutTime=2,t.maxSpeed=1080,t.uniformSpeedTime=0,t.skinName="HalfYearWheelSkin",t.touchEnabled=!1,t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.timer=new egret.Timer(50,-1),t.timer.addEventListener(egret.TimerEvent.TIMER,t.onTimer,t),t}return __extends(t,e),t.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.HalfYearDrawChanceResult,this.onNotifyResult,this),Game.dispatcher.addEventListener(Game.EVENT.HalfYearDrawSycnInfo,this.updateData,this),this.imgWheel.source=HalfYearDraw.drawKeyUIConfig.imgWheel,this.image.source=HalfYearDraw.drawKeyUIConfig.imgWhirl,this.pointer.source=HalfYearDraw.drawKeyUIConfig.imgPointer,this.bg=HalfYearDraw.drawKeyUIConfig.imgBackGround,this.whirl.play(),this.whirl.addEventListener(egret.Event.COMPLETE,this.onTweenGroupComplete,this),this.updateData()},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.HalfYearDrawChanceResult,this.onNotifyResult,this),Game.dispatcher.addEventListener(Game.EVENT.HalfYearDrawSycnInfo,this.updateData,this),this.whirl.stop()},t.prototype.updateData=function(){this.redPoint.visible=HalfYearDraw.getDrawKeyTimes()>0},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnStart:this.startRoll()}},t.prototype.getCurrentSpeed=function(){return this.usedTime<this.speedUpTime?this.usedTime*(this.maxSpeed/this.speedUpTime):null!=this.result?this.maxSpeed:this.usedTime<this.speedUpTime+this.uniformSpeedTime||null==!this.result?this.maxSpeed:this.maxSpeed-this.usedTime*(this.maxSpeed/this.speedUpTime)},t.prototype.onNotifyResult=function(e){this.result=e.data;var t=HalfYearDraw.drawKeyUIConfig.offsets[this.result]*HalfYearDraw.drawKeyUIConfig.angle,n=Math.floor(Math.random()*HalfYearDraw.drawKeyUIConfig.divisions[this.result]);this.startAngle=this.imgWheel.rotation;var i=0,a=n*HalfYearDraw.drawKeyUIConfig.angle+t,r=0;this.usedTime<this.speedUpTime?(i=(this.getCurrentSpeed()+this.maxSpeed)*(this.speedUpTime-this.usedTime)/2,r=this.maxSpeed/this.speedUpTime*this.usedTime*this.usedTime/2):(r=this.maxSpeed/this.speedUpTime*this.speedUpTime*this.speedUpTime/2,this.usedTime=this.speedUpTime),this.startAngle-=r;var o=this.maxSpeed*this.speedCutTime/2,s=a-this.startAngle-r-i-o;s+=1800,this.uniformSpeedTime=s/this.maxSpeed},t.prototype.startRoll=function(){Player.instance.dead||this.timer.running||null==this.result&&this.roll()&&(this.usedTime=0,this.startAngle=this.imgWheel.rotation,this.timer.reset(),this.timer.start())},t.prototype.onTimer=function(){var e=.05;this.usedTime+=e;var t=0,n=this.usedTime;if(n>this.speedUpTime&&(n=this.speedUpTime),t+=this.maxSpeed/this.speedUpTime*n*n/2,this.usedTime>this.speedUpTime){var n=this.usedTime-this.speedUpTime;n>=this.uniformSpeedTime&&null!=this.result&&(n=this.uniformSpeedTime),t+=this.maxSpeed*n}var i=!1;if(null!=this.result&&this.usedTime>this.speedUpTime+this.uniformSpeedTime){var n=this.usedTime-(this.speedUpTime+this.uniformSpeedTime);n>this.speedCutTime&&(n=this.speedCutTime,i=!0),t+=this.maxSpeed*n-this.maxSpeed/this.speedCutTime*n*n/2}this.imgWheel.rotation=(t+this.startAngle)%360,i&&(this.draw(),this.result=null,this.timer.stop())},t.prototype.roll=function(){return HalfYearDraw.roll()},t.prototype.draw=function(){HalfYearDraw.draw()},t.prototype.onTweenGroupComplete=function(){this.whirl.play(0)},t}(eui.Component);e.HalfYearWheel=t,__reflect(t.prototype,"UI.HalfYearWheel",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(t){var n=e.call(this)||this;return n.skinName="HalfYearWheelResultSkin",n.result=t,n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n}return __extends(t,e),t.prototype.onTouchTap=function(){null==this.timer&&(this.timer=egret.setTimeout(this.close,this,1*Game.Second))},t}(e.FitComponent);e.HalfYearWheelResult=t,__reflect(t.prototype,"UI.HalfYearWheelResult",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.remainingTime=new RemainingTime,t.skinName="HuashanPKNoteSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.onAddToStage=function(){SecondTicker.addEventListener(this.updateRestTime,this)},t.prototype.onRemoveFromStage=function(){SecondTicker.removeEventListener(this.updateRestTime,this)},Object.defineProperty(t.prototype,"restTime",{get:function(){return this.remainingTime.delta},set:function(e){this.remainingTime.delta=e,this.updateRestTime()},enumerable:!0,configurable:!0}),t.prototype.updateRestTime=function(){this.lefttime=this.remainingTime.getMinuteSecond()},t.prototype.onExit=function(){HuashanPK.onC2SExit()},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnExit:this.onExit()}},t.prototype.syncInfo=function(e,t,n,i){this.round=e,this.curFinishRound=Math.max(e-1,0),this.leftnpc=t,this.restTime=n,this.NextAchievementAwardRound=i;var a=this.NextAchievementAwardRound-this.curFinishRound;if(this.groupInfo.visible=a>0,this.groupFinish.visible=!this.groupInfo.visible,1==this.groupInfo.visible){this.txtLeftRound=lang.StringWithFormat("{1}round",a);var r=(table.getHuashanPKAwardByRound(this.curFinishRound),table.getHuashanPKAwardByRound(this.NextAchievementAwardRound)),o=r?r.dailySilverCoin:0;this.txtSilver=""+o+lang.String("silver coin");var s=r?r.offlineExpPercent:0;this.txtExp=s+"%"}},t}(e.FitComponent);e.HuashanPKNote=t,__reflect(t.prototype,"UI.HuashanPKNote",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.dataChanged=function(){this.data.name==Player.instance.Name?this.select=!0:this.select=!1},t}(eui.ItemRenderer);e.HuashanPKRecordItem=t,__reflect(t.prototype,"UI.HuashanPKRecordItem")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.remainingTime=new RemainingTime,e.awarddatas=[],e.skinName="HuashanPKResultSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),n.prototype.onTouchTap=function(e){switch(e.target){case this.btnRepeat:HuashanPK.retry(),this.close();break;case this.btnNext:HuashanPK.nextDegree(),this.close();break;case this.btnReturn:HuashanPK.onC2SExit(),this.close();break;case this.imgClose:this.close()}},n.prototype.resetRemainTime=function(){this.remainingTime.delta=3,this.updateRemainTime()},n.prototype.updateRemainTime=function(){this.lefttime=this.remainingTime.getMinuteSecond(),this.remainingTime.deltaMillisecond<=0&&this.close()},n.prototype.onAddToStage=function(){SecondTicker.addEventListener(this.updateRemainTime,this),this.awarddatas.length>0&&(this.list.dataProvider=new eui.ArrayCollection(this.awarddatas),this.list.itemRenderer=e.AwardCell)},n.prototype.onRemoveFromStage=function(){SecondTicker.removeEventListener(this.updateRemainTime,this),this.awarddatas=[],this.gate=null},n.prototype.timerComFunc=function(){this.close()},n.prototype.close=function(){UIManager.pop(this)},n.prototype.setEquiplist=function(e){for(var t=0;t<e.length;t++)this.awarddatas.push({type:"equip",content:{bagId:e[t],data:PlayerAttribute.GetItem(e[t])}})},n.prototype.setAwardlist=function(e){this.awarddatas=e},n}(e.FitComponent);e.HuashanPKResult=t,__reflect(t.prototype,"UI.HuashanPKResult",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="HuashanPKUISkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.awardDataProvider=new eui.ArrayCollection,e.firstList=HuashanPK.firstListData,e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.onSyncPlayerInfo=function(e){null!=this._instance&&(this._instance.NextAchievementAwardRound=e.getNextAwardRound(),this._instance.dailyGetSilver=e.getDailyAwardSilverCoin(),this._instance.groupDailyAward.visible=this._instance.dailyGetSilver>0,this._instance.updateLeftRound(),this._instance.updateAwardValue())},n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.listAward.itemRenderer=e.AwardCell,this.listAward.dataProvider=this.awardDataProvider},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.SyncHuashanPKDegree,this.onSyncDegree,this),guide.addEventListener(guide.GuideOperation.GuideHuashanPK,this.onGuideReminder,this),guide.completed()||this.playGuideMovie(guide.info.operation),this.onSyncDegree()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.SyncHuashanPKDegree,this.onSyncDegree,this),guide.removeEventListener(guide.GuideOperation.GuideHuashanPK,this.onGuideReminder,this)},n.prototype.onSyncDegree=function(){this.setDegree(HuashanPK.maxRound),this.setAwardlist(HuashanPK.calcAward(HuashanPK.maxRound+1))},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnActive1:this.onClickStart();break;case this.btnRule:var n=new e.Rule;n.skinName="GuildRulesSkin",n.currentState="huaPKRule",UIManager.pushPage(n);break;case this.imgClose:this.close();break;case this.btnGetDailyAward:this.getDailyAward()}},n.prototype.getDailyAward=function(){net.socket.write(2069,null)},n.prototype.close=function(){UIManager.pop(this)},n.prototype.onClickGetRecords=function(){net.socket.write(70,null)},n.prototype.onClickStart=function(){UIManager.pop(this),net.socket.write(39,null),e.HUD.instance.showBattle()},n.prototype.setDegree=function(e){this.txtlevel1=lang.StringWithFormat("round num X {1}",e+1),this.CurRound=e+1,this.curFinishRound=Math.max(e,0),this.updateLeftRound(),this.updateAwardValue()},n.prototype.updateLeftRound=function(){var e=this.NextAchievementAwardRound-this.curFinishRound;e>0?this.txtLeftRound=lang.String("huashanpk next award left:")+lang.StringWithFormat("{1}round",e):this.txtLeftRound=lang.String("huashanpk next award left:")+lang.String("huashanpk award finished")},n.prototype.updateAwardValue=function(){var e=table.getHuashanPKAwardByRound(this.curFinishRound),t=table.getHuashanPKAwardByRound(this.NextAchievementAwardRound);this.nSilverCurrent=e?e.dailySilverCoin:0;var n=e?e.offlineExpPercent:0;this.txtExpCurrent=n+"%";var i=this.NextAchievementAwardRound-this.curFinishRound;i>0?(this.txtSilverNext=t?t.dailySilverCoin.toString():"0",n=t?t.offlineExpPercent:0,this.txtExpNext=n+"%"):(this.txtSilverNext=lang.String("huashanpk award finished"),this.txtExpNext=lang.String("huashanpk award finished"))},n.prototype.setAwardlist=function(e){this.awardDataProvider.replaceAll(e)},n.prototype.onGuideReminder=function(){var e=this;if(this.visible){var t=guide.info.operation;t==guide.GuideOperation.GuideHuashanPK&&guide.pushMovie({weight:2,handle:function(){e.playGuideMovie(t)}})}},n.prototype.playGuideMovie=function(e){e==guide.GuideOperation.GuideHuashanPK&&guide.AddMovieClip(this.btnActive1)},n}(e.FitComponent);e.HuashanPKUI=t,__reflect(t.prototype,"UI.HuashanPKUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="ReminderIconSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.onTouchTap=function(e){switch(e.target){case this.btnClose:Game.removeFromParent.apply(this),this.clearResourceReference();break;default:this.onTap&&this.onTap(e)}},t}(eui.Component);e.BaseReminderIcon=t,__reflect(t.prototype,"UI.BaseReminderIcon",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="ReminderIconSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.show=function(e,n){n&&(this._instance||(this._instance=new t),this._instance.update(e),n.addChild(this._instance))},t.hide=function(){this._instance&&(Game.removeFromParent.apply(this._instance),this._instance.clearResourceReference(),this._instance=null)},t.prototype.update=function(e){var t=LittleBoss.getLittleBossMissionByMapId(e);return null==t?!1:(this.reminderName=t.name,this.reminderIcon=t.pic,void(this.reminderAction="BOSS Giữ Ải"))},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnClose:t.hide();break;default:var n=LittleBoss.getNextMapId();null!=n&&LittleBoss.requestEnterLittleBossMap(n),t.hide()}},t}(eui.Component);e.LittleBossIcon=t,__reflect(t.prototype,"UI.LittleBossIcon",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="ReminderIconSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.update=function(e,t){null!=e?(this.reminderIcon=Reminder.getIcon(e),this.reminderName=Reminder.getName(e),""==t?this.reminderAction=Reminder.getAction(this.reminderEventType):this.reminderAction=t):(this.reminderIcon=null,this.reminderName=null,this.reminderAction=null),this.reminderEventType=e},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnClose:e.battle.onReminderOut();break;default:null!=this.reminderEventType&&Reminder.onClick(this.reminderEventType),e.battle.onReminderOut()}},n}(eui.Component);e.ReminderIcon=t,__reflect(t.prototype,"UI.ReminderIcon",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="ReminderIconSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.update=function(e){var t=WildBoss.getMissions().items,n=t[e].mapId;this.reminderName=t[e].name,this.reminderIcon=table.maps[n].icon,this.reminderAction="BOSS Thế Giới",this.bossIdx=e,this.mapId=n},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnClose:WildBoss.HideIcon();break;default:var t=this.bossIdx;null!=t&&(WildBoss.requestEnterWildBossMap(this.mapId),this.bossIdx=null),WildBoss.HideIcon()}},t.prototype.close=function(){Game.removeFromParent.apply(this),this.bossIdx=0},t}(eui.Component);e.WildBossIcon=t,__reflect(t.prototype,"UI.WildBossIcon",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.touchEnabled=!1,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.skinName="JianMenGuanHUDSkin",t.remainingTime=new RemainingTime,t.group0.visible=!1,t.progress.visible=!1,t.counter2.visible=!1,t}return __extends(t,e),t.prototype.onAddToStage=function(){SecondTicker.addEventListener(this.onSecondTick,this),this.tweenGroup.addEventListener(egret.Event.COMPLETE,this.onTweenGroupComplete,this),this.captureTween.addEventListener(egret.Event.COMPLETE,this.onCaptureTweenComplete,this)},t.prototype.onRemoveFromStage=function(){SecondTicker.removeEventListener(this.onSecondTick,this),this.tweenGroup.removeEventListener(egret.Event.COMPLETE,this.onTweenGroupComplete,this),this.captureTween.removeEventListener(egret.Event.COMPLETE,this.onCaptureTweenComplete,this)},t.prototype.SetCounter=function(e,t,n){this.progress.maximum=n,this.progress.value=t,this.progress.currentState=e},t.prototype.ShowCounter=function(){this.progress.visible=!0},t.prototype.SetOvertimeVisible=function(e){this.counter2.visible!=e&&(this.counter2.visible=e,e?this.tweenGroup.play(0):this.tweenGroup.stop())},Object.defineProperty(t.prototype,"restTime",{get:function(){return this.remainingTime.deltaMillisecond},set:function(e){this.remainingTime.deltaMillisecond=e,this.updateRestTime()},enumerable:!0,configurable:!0}),t.prototype.updateRestTime=function(){this.time=this.remainingTime.getMinuteSecond()},t.prototype.onSecondTick=function(){this.updateRestTime()},t.prototype.onTweenGroupComplete=function(){this.tweenGroup.play(0)},t.prototype.SetTips=function(e,t){""==e?this.tips.visible=!1:(this.tips.text=e,this.tips.textColor=t,this.tips.visible=!0)},t.prototype.Capture=function(e){this.group0.visible=!0,this.group0.currentState=e,this.captureTween.play(0)},t.prototype.onCaptureTweenComplete=function(){this.captureTween.stop(),this.group0.visible=!1},t.prototype.setScore=function(e,t){e?this.friendScore.text=t:this.enemyScore.text=t},t}(e.FitComponent);e.JianMenGuanHUD=t,__reflect(t.prototype,"UI.JianMenGuanHUD",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.touchEnabled=!1,t.skinName="JianMenGuanResultSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.close=function(){UIManager.pop(this)},t.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},t}(e.FitComponent);e.JianMenGuanResult=t,__reflect(t.prototype,"UI.JianMenGuanResult",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="JianMenGuanUISkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.list.itemRenderer=e.AwardCell,n}return __extends(n,t),n.open=function(){null==this.instance&&(this.instance=new n),UIManager.push(this.instance)},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnSign:JianMenGuan.signup();break;case this.imgClose:this.close();break;case this.btnRules:JianMenGuan.OpenRuleUI()}},n.prototype.close=function(){UIManager.pop(this)},n.prototype.onAddToStage=function(){this.list.dataProvider=new eui.ArrayCollection(table.mapWanderings[27].awards),this.isSign(),Game.dispatcher.addEventListener(Game.EVENT.LevelUp,this.isSign,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.LevelUp,this.isSign,this)},n.prototype.isSign=function(){1!=this.btnSign.enabled&&(PlayerAttribute.Level<JianMenGuan.config.level?this.btnSign.enabled=!1:this.btnSign.enabled=!0)},n}(e.FitComponent);e.JianMenGuanUI=t,__reflect(t.prototype,"UI.JianMenGuanUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="LevelUpGiftSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.close=function(){UIManager.pop(t.instance)},t.prototype.onAddToStage=function(){this.onRefresh(),Game.dispatcher.addEventListener(Game.EVENT.LevelUpGiftChange,this.onRefresh,this),Game.dispatcher.addEventListener(Game.EVENT.LevelUp,this.onRefresh,this),Game.dispatcher.addEventListener(Game.EVENT.LevelUpGiftOpen,this.onShowGift,this),Game.dispatcher.addEventListener(Game.EVENT.TimingCardChange,this.onRefresh,this)},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.LevelUpGiftChange,this.onRefresh,this),Game.dispatcher.removeEventListener(Game.EVENT.LevelUp,this.onRefresh,this),Game.dispatcher.removeEventListener(Game.EVENT.LevelUpGiftOpen,this.onShowGift,this),Game.dispatcher.removeEventListener(Game.EVENT.TimingCardChange,this.onRefresh,this)},t.prototype.onRefresh=function(){var e=[];for(var t in table.levelUpGift){var n=table.levelUpGift[t],i=table.levelUpGiftVIP[t],a=Number(t);e.push({level:a,status:n.status,status2:i.status,awards:n.awards,awards2:i.awards})}e.sort(this.sortbylevel);var r=this.list.dataProvider;r?r.replaceAll(e):this.list.dataProvider=new eui.ArrayCollection(e)},t.prototype.sortbylevel=function(e,t){var n=e.status&&e.status2?1:0,i=t.status&&t.status2?1:0;return n==i?e.level-t.level:n-i},t.prototype.onShowGift=function(e){null!=e&&0==e.data&&this.close()},t}(e.FitComponent);e.LevelUpGiftUI=t,__reflect(t.prototype,"UI.LevelUpGiftUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="LevelUpGiftItemSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.dataChanged=function(){this.btnDraw.visible=!this.data.status,this.imgDraw.visible=this.data.status;var e;PlayerAttribute.Level>=this.data.level?(e=egret.toColorString(color.Title1_Value),this.btnDraw.enabled=!0):(e=egret.toColorString(color.Warning),this.btnDraw.enabled=!1),this.list.dataProvider=new eui.ArrayCollection(this.data.awards),this.desc.textFlow=Game.HtmlTextParser.parse(lang.Format("Đạt Lv<font color="+e+"> {1} </font>",this.data.level)),this.btnDraw2.enabled=this.btnDraw.enabled,this.btnDraw2.visible=!this.data.status2,this.imgDraw2.visible=this.data.status2,this.desc_vip.textColor=Recharge.isTimingCard(Recharge.MonthlyCard_Type)?color.Title1_Value:color.Warning,this.list2.dataProvider=new eui.ArrayCollection(this.data.awards2)},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnDraw:var t=new net.def.C2SLevelupGiftAward;t.setLevel(this.data.level),t.setType(1),net.socket.write(2067,t.toArrayBuffer());break;case this.btnDraw2:if(!Recharge.isTimingCard(Recharge.MonthlyCard_Type))return PopUpMessage.push("Nạp Thẻ Tháng được nhận.",color.Warning),void Recharge.openRechargeUI();var t=new net.def.C2SLevelupGiftAward;t.setLevel(this.data.level),t.setType(2),net.socket.write(2067,t.toArrayBuffer())}},t}(eui.ItemRenderer);e.LevelUpGiftItem=t,__reflect(t.prototype,"UI.LevelUpGiftItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="LotteryAwardItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){this.listAward.dataProvider=new eui.ArrayCollection(this.data.awards)},t}(eui.ItemRenderer);e.LotteryAwardItem=t,__reflect(t.prototype,"UI.LotteryAwardItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="LotteryAwardViewSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.ActivityLotterySyncInfo,this.onRefreshLotterys,this),this.onRefreshAwards(),this.onRefreshLotterys()},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.ActivityLotterySyncInfo,this.onRefreshLotterys,this)},t.prototype.onRefreshAwards=function(){if(null==ActivityLotteryTicket.cfg.clientAwards)return void egret.error("lottery client awards not found");var e=[ActivityLotteryTicket.cfg.clientAwards.first,ActivityLotteryTicket.cfg.clientAwards.second,ActivityLotteryTicket.cfg.clientAwards.three,ActivityLotteryTicket.cfg.clientAwards.lucky],t=this.listZodiac.dataProvider,n=t.source;if(e.length!=n.length)return void egret.error("lottery client awards sum error");for(var i=0;i<n.length;i++)n[i].awards=e[i];t.refresh()},t.prototype.onRefreshLotterys=function(){for(var e=this.listLottery.dataProvider,t=e.source,n=0;n<t.length;n++)t[n].index=n,t[n].zodiacs=ActivityLotteryTicket.LastBettings[n];e.refresh()},t}(e.FitComponent);e.LotteryAwardView=t,__reflect(t.prototype,"UI.LotteryAwardView",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="LotteryBuySkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.close=function(){null!=this._instance&&UIManager.pop(this._instance)},n.prototype.close=function(){UIManager.pop(this)},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.ActivityLotterySyncInfo,this.onRefreshUI,this),this.onRefreshUI()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.ActivityLotterySyncInfo,this.onRefreshUI,this)},n.prototype.onRefreshUI=function(){var e=ActivityLotteryTicket.cfg,t=table.props[e.ticketItem.genre][e.ticketItem.detailType];this.itemname.text=t.name,this.itemname.textColor=Item.QualityColor[t.quality],this.itemDesc.textFlow=Game.HtmlTextParser.parse(t.desc),this.price=e.ticketPrice,this.showcase.icon=t.source,this.showcase.quality=t.quality,this.showcase.rbcorner="1",this.boxNumer=Math.min(1,ActivityLotteryTicket.CanBuyTickets),this.currencyIcon=Game.currency2Icon[Game.Currency.SilverCoin],this.canBuyTotalTip="Còn được mua: "+ActivityLotteryTicket.CanBuyTickets},n.prototype.onTouchTap=function(t){var n=this;switch(t.target){case this.btnBuy:if(this.boxNumer<=0||this.boxNumer>ActivityLotteryTicket.CanBuyTickets)return;var i=this.price*this.boxNumer;if(PlayerAttribute.currency[Game.Currency.SilverCoin]<i){var a=new e.SliverCoinPrompt;a.title=lang.String("operation confirm"),a.content=lang.StringWithFormat("if replace {1} silver with gold",i-PlayerAttribute.currency[Game.Currency.SilverCoin]),a.cb=function(e){return PlayerAttribute.currency[Game.Currency.SilverCoin]+PlayerAttribute.currency[Game.Currency.GoldCoin]<i?(Recharge.openRechargeUI(),void UIManager.pop(a)):(ActivityLotteryTicket.c2s_buyTicket(n.boxNumer),void UIManager.pop(a))},UIManager.push(a)}else ActivityLotteryTicket.c2s_buyTicket(this.boxNumer);break;case this.imgClose:this.close();break;case this.btnMinus:this.boxNumer>0&&(this.boxNumer-=1);break;case this.btnPlus:this.boxNumer<ActivityLotteryTicket.CanBuyTickets&&(this.boxNumer+=1)}},n}(e.FitComponent);e.LotteryBuy=t,__reflect(t.prototype,"UI.LotteryBuy",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="LotteryHistorySkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.close=function(){null!=this._instance&&UIManager.pop(this._instance)},t.prototype.close=function(){UIManager.pop(this)},t.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.ActivityLotterySyncInfo,this.onRefreshUI,this),this.onRefreshUI()},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.ActivityLotterySyncInfo,this.onRefreshUI,this)},t.prototype.onRefreshUI=function(){var e=ActivityLotteryTicket.globalLottery.slice(1),t=this.listHistory.dataProvider;null==t?this.listHistory.dataProvider=new eui.ArrayCollection(e):t.replaceAll(e)},t}(e.FitComponent);e.LotteryHistory=t,__reflect(t.prototype,"UI.LotteryHistory",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="LotteryHistoryItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){var e=this.data;if(null!=e&&4==e.length){var t=e[0];this.dateName=~~(t/1e4)+"/"+~~(t%1e4/100)+"/"+~~(t%1e4%100),this.imgzodiac1=ActivityLotteryTicket.getImage(e[1]),this.imgzodiac2=ActivityLotteryTicket.getImage(e[2]),this.imgzodiac3=ActivityLotteryTicket.getImage(e[3])}},t}(eui.ItemRenderer);e.LotteryHistoryItem=t,__reflect(t.prototype,"UI.LotteryHistoryItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="LotteryItemSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.dataChanged=function(){var e=this.data;if(null!=e&&null!=e.zodiacs&&4==e.zodiacs.length){var t=0,n=e.zodiacs.slice(0,3);switch(this.imgzodiac1.source=ActivityLotteryTicket.getImage(n[0]),this.imgzodiac2.source=ActivityLotteryTicket.getImage(n[1]),this.imgzodiac3.source=ActivityLotteryTicket.getImage(n[2]),e.type){case"lottery":t=1==e.zodiacs[3]?ActivityLotteryTicket.checkNotZero(n)?1:0:ActivityLotteryTicket.checkNotZero(n)?2:0;break;case"award":this.imgzodiac1.alpha=ActivityLotteryTicket.matchZodiac(n[0])?1:.5,this.imgzodiac2.alpha=ActivityLotteryTicket.matchZodiac(n[1])?1:.5,this.imgzodiac3.alpha=ActivityLotteryTicket.matchZodiac(n[2])?1:.5;var i=ActivityLotteryTicket.getRank(n);this.rank=ActivityLotteryTicket.getRankName(i),this.expired=i>0&&0==e.zodiacs[3]?ActivityLotteryTicket.getExpired():"",t=i>0?0==e.zodiacs[3]?1:2:0}switch(t){case 1:this.btnLottery.visible=!0,this.btnLottery.enabled=!0;break;case 2:this.btnLottery.visible=!1,this.btnLottery.enabled=!1;break;default:this.btnLottery.visible=!0,this.btnLottery.enabled=!1}}},n.prototype.onTouchTap=function(t){var n=this.data;if(null!=n&&null!=n.zodiacs&&4==n.zodiacs.length)switch(t.target){case this.btnLottery:switch(n.type){case"lottery":var i=ActivityLotteryTicket.cfg.ticketItem;
if(PlayerAttribute.bag.CalcCount(i.genre,i.detailType)<=0)return void UIManager.push(e.LotteryBuy.instance);var a=n.zodiacs.slice(0,3);ActivityLotteryTicket.c2s_reqLottery(n.index,a),Game.dispatcher.dispatchEventWith(Game.EVENT.ActivityLotteryClearSelected);break;case"award":ActivityLotteryTicket.c2s_reqAward(n.index)}}},n}(eui.ItemRenderer);e.LotteryItem=t,__reflect(t.prototype,"UI.LotteryItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="LotteryTicketUISkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.tab.addEventListener(eui.ItemTapEvent.ITEM_TAP,e.onTabChange,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.open=function(){var e=30;return PlayerAttribute.Level<e?void PopUpMessage.push(lang.StringWithFormat("open on level {1}",e),color.RED):ActivityLotteryTicket.activity.inTime()?void UIManager.push(this.instance):void PopUpMessage.push(lang.String("not open"),color.RED)},n.close=function(){null!=this._instance&&UIManager.pop(this._instance)},n.prototype.close=function(){UIManager.pop(this)},n.prototype.onAddToStage=function(){this.tab.selectedIndex=0,Game.dispatcher.addEventListener(Game.EVENT.ActivityLotterySyncInfo,this.onRefreshUI,this),this.onRefreshUI(),ActivityLotteryTicket.c2s_reqSync()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.ActivityLotterySyncInfo,this.onRefreshUI,this)},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnBuy:UIManager.push(e.LotteryBuy.instance);break;case this.btnHistory:UIManager.push(e.LotteryHistory.instance)}},n.prototype.onRefreshUI=function(){this.onRefreshTicket(),this.onRefreshLottery()},n.prototype.onTabChange=function(e){this.onRefreshLottery()},n.prototype.onRefreshLottery=function(){this.dateTip="Thời gian còn: "+ActivityLotteryTicket.activity.reaminingTime;var e="icon/item/kong.png",t=ActivityLotteryTicket.globalLottery[0][0],n=ActivityLotteryTicket.globalLottery[0].slice(1);if(0!=this.tab.selectedIndex&&!ActivityLotteryTicket.checkNotZero(n)){if(1==ActivityLotteryTicket.globalLottery.length)return this.imgzodiac1=e,this.imgzodiac2=e,this.imgzodiac3=e,this.zodiacsTip="",void(this.timeTip="");t=ActivityLotteryTicket.globalLottery[1][0],n=ActivityLotteryTicket.globalLottery[1].slice(1)}this.imgzodiac1=0==n[0]?e:ActivityLotteryTicket.getImage(n[0]),this.imgzodiac2=0==n[1]?e:ActivityLotteryTicket.getImage(n[1]),this.imgzodiac3=0==n[2]?e:ActivityLotteryTicket.getImage(n[2]);var i=ActivityLotteryTicket.getName(n[0]),a=ActivityLotteryTicket.getName(n[1]),r=ActivityLotteryTicket.getName(n[2]);this.zodiacsTip=~~(t/1e4)+"/"+~~(t%1e4/100)+"/"+~~(t%1e4%100)+" "+i+","+a+","+r,this.timeTip=ActivityLotteryTicket.checkNotZero(n)?"Đã mở thưởng":"Mỗi ngày 20:00 mở thưởng"},n.prototype.onRefreshTicket=function(){var e=ActivityLotteryTicket.cfg.ticketItem;this.ticketNum=PlayerAttribute.bag.CalcCount(e.genre,e.detailType)},n}(e.FitComponent);e.LotteryTicketUI=t,__reflect(t.prototype,"UI.LotteryTicketUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="LotteryTicketViewSkin",t.selectedZodiacs=[0,0,0,0],t.listZodiacs.addEventListener(eui.ItemTapEvent.ITEM_TAP,t.onItemTap,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.ActivityLotterySyncInfo,this.onRefreshLotterys,this),Game.dispatcher.addEventListener(Game.EVENT.ActivityLotteryClearSelected,this.onClearSelected,this),this.onRefreshLotterys()},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.ActivityLotterySyncInfo,this.onRefreshLotterys,this),Game.dispatcher.removeEventListener(Game.EVENT.ActivityLotteryClearSelected,this.onClearSelected,this)},t.prototype.onItemTap=function(e){var t=e.itemIndex,n=this.listZodiacs.dataProvider,i=n.source;switch(i[t].status){case"up":i[t].status="upAndSelected";break;case"upAndSelected":i[t].status="up";break;case"disabled":return}for(var a=0,r=0;r<i.length;r++)"upAndSelected"==i[r].status&&a++;for(var r=0;r<i.length;r++)3==a?"upAndSelected"!=i[r].status&&(i[r].status="disabled"):"disabled"==i[r].status&&(i[r].status="up");n.refresh(),this.onRefreshLotterys()},t.prototype.onClearSelected=function(){for(var e=this.listZodiacs.dataProvider,t=e.source,n=0;n<t.length;n++)t[n].status="up";e.refresh(),this.onRefreshLotterys()},t.prototype.onRefreshLotterys=function(){for(var e=this.listZodiacs.dataProvider,t=e.source,n=0,i=!1,a=0;a<t.length;a++)3>n&&"upAndSelected"==t[a].status&&(this.selectedZodiacs[n]=a+1,n++,i=!0);for(var a=n;3>a;a++)this.selectedZodiacs[a]=0;this.selectedZodiacs[3]=1;for(var r=this.listLottery.dataProvider,o=r.source,s=!0,a=0;a<o.length;a++){o[a].index=a;var l=ActivityLotteryTicket.Bettings[a].slice(0,3);s&&!ActivityLotteryTicket.checkNotZero(l)&&i?(s=!1,o[a].zodiacs=this.selectedZodiacs):o[a].zodiacs=ActivityLotteryTicket.Bettings[a]}r.refresh()},t}(e.FitComponent);e.LotteryTicketView=t,__reflect(t.prototype,"UI.LotteryTicketView",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="ZodiacItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){var e=this.data;null!=e&&null!=e.status&&(this.btnSelect.currentState=e.status,this.btnSelect.enabled="disabled"==e.status)},t}(eui.ItemRenderer);e.ZodiacItem=t,__reflect(t.prototype,"UI.ZodiacItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(){function e(e,t){this.timer=new egret.Timer(t,0),this.interval=t,this.pos=0,this.n=e,this.keys=[]}return e.prototype.start=function(e){this.timer.delay=this.interval,this.time=e,this.key=0,this.tick=0,this.target=null,this.timer.start(),this.timer.addEventListener(egret.TimerEvent.TIMER,this.update,this)},e.prototype.stop=function(){this.timer.stop(),this.timer.removeEventListener(egret.TimerEvent.TIMER,this.update,this)},Object.defineProperty(e.prototype,"running",{get:function(){return this.timer.running},enumerable:!0,configurable:!0}),e.prototype.update=function(){for(var e=0,t=this.key;t<this.keys.length;t++){if(this.tick<this.keys[t].t){e=this.keys[t].a;break}this.key=t}this.timer.delay+e<50?this.timer.delay=50:this.timer.delay+e>450?this.timer.delay=450:this.timer.delay+=e,this.tick++,this.pos=(this.pos+1)%this.n,this.onUpdate(this.pos),this.time<this.tick&&this.target==this.pos&&(this.timer.stop(),this.onStop())},e}();__reflect(t.prototype,"Rotator");var n=function(e){function n(){var n=e.call(this)||this;n.skinName="LuckyWheelSkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.r1=new t(ActivityLuckyWheel.cfg.prizes.length,80),n.r2=new t(ActivityLuckyWheel.cfg.multiple.length,80),n.r1.onUpdate=function(e){n.light1.rotation=360*e/ActivityLuckyWheel.cfg.prizes.length};var i=MakeDelayExecute(n.onStop,n,200);return n.r1.onStop=i,n.r2.onUpdate=function(e){n.light2.rotation=360*-e/ActivityLuckyWheel.cfg.multiple.length},n.r2.onStop=i,n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.r1.keys=[{t:8,a:-20},{t:20,a:0},{t:28,a:40}],n.r2.keys=[{t:8,a:-20},{t:30,a:0},{t:38,a:40},{t:39,a:100}],n.awards=[n.award1,n.award2,n.award3,n.award4,n.award5,n.award6,n.award7,n.award8],n.multiples=[n.multiple1,n.multiple2,n.multiple3,n.multiple4,n.multiple5,n.multiple6],n}return __extends(n,e),n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.SyncActivityLuckyWheel,this.onUpdateTask,this),Game.dispatcher.addEventListener(Game.EVENT.ActivityLuckyWheelResult,this.onSyncResult,this);for(var e=0;e<this.awards.length;e++){var t=this.awards[e];t.data=ActivityLuckyWheel.cfg.prizes[e].award}for(var e=0;e<this.multiples.length;e++){var t=this.multiples[e];t.text="X"+ActivityLuckyWheel.cfg.multiple[e].value}this.onUpdateTask()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.SyncActivityLuckyWheel,this.onUpdateTask,this),Game.dispatcher.removeEventListener(Game.EVENT.ActivityLuckyWheelResult,this.onSyncResult,this)},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnRoll:this.startRoll()}},n.prototype.onUpdateTask=function(){var e=ActivityLuckyWheel.task;this.rollCount=e.count,this.need=e.gold+"/"+e.next,this.btnRoll.enabled=this.rollCount>0&&!this.r1.running&&!this.r2.running},n.prototype.onStop=function(){this.r2.running||this.r1.running||(this.btnRoll.enabled=this.rollCount>0&&!this.r1.running&&!this.r2.running,ActivityLuckyWheel.draw())},n.prototype.startRoll=function(){Player.instance.dead||ActivityLuckyWheel.roll()&&(this.r1.running||this.r2.running||(this.r1.start(38),this.r2.start(48),this.btnRoll.enabled=!1))},n.prototype.onSyncResult=function(e){this.r1.target=e.data.prizeIdx,this.r2.target=e.data.multipleIdx},n}(eui.Component);e.LuckyWheelUI=n,__reflect(n.prototype,"UI.LuckyWheelUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.bossIcons=["ui/challenge/boss1.png","ui/challenge/boss2.png","ui/challenge/boss3.png","ui/challenge/boss4.png"],n.skinName="ChallengeCopyTitleSkin",n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.awardlist.itemRenderer=e.AwardCell,n}return __extends(n,t),n.prototype.dataChanged=function(){this.currentState=this.data.state,this.headIcon=this.bossIcons[this.data.iconId],this.chapter=this.data.id+1,this.bitmapChapter=""+this.chapter,this.showaward(),guide.completed()||guide.info.operation!=guide.GuideOperation.GuideMasterChallenge||this.chapter!=guide.info.target?guide.removeMovieClip(this.btnSingup):guide.AddMovieClip(this.btnSingup)},n.prototype.onRemoveFromStage=function(){},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnSingup:MasterChallenge.onSignup(this.data.id)}},n.prototype.showaward=function(){var e=this.data.id;switch(this.currentState){case"pass":this.awardlist.dataProvider=new eui.ArrayCollection(table.challenges[e].dailyaward),this.btnSingup.label=lang.String("tiao zhan");break;case"open":case"closed":this.awardlist.dataProvider=new eui.ArrayCollection(table.challenges[e].award),this.btnSingup.label=lang.String("tiao zhan")}},n}(eui.ItemRenderer);e.ChallengeCopyTitle=t,__reflect(t.prototype,"UI.ChallengeCopyTitle")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.resetTimes=0,e.ibTimes=0,e.txtState="",e.needLevel=0,e.needpower=0,e.awardmsg="",e.MAXTIMES=2,e.JOINTIMES=2,e.gatedatas=[],e.skinName="ChallengeCopyUISkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.LevelUp,this.updateChallenge,this),Game.dispatcher.addEventListener(Game.EVENT.SyncMasterChallengeData,this.updateChallengeData,this),this.resetTimes=MasterChallenge.challengeLeft,this.ibTimes=MasterChallenge.ibLeft,this.gatedatas=[];var e=MasterChallenge.MaxChapter,t=e-1;0>t&&(t=0),t>=MasterChallenge.ChapterCount&&(t=MasterChallenge.ChapterCount-1);var n=t+3;n>=MasterChallenge.ChapterCount&&(n=MasterChallenge.ChapterCount-1);for(var i=0;n>=t;n--){var a=table.challenges[n],r={state:MasterChallenge.getStagestate(n),id:a.chapter,fp:a.fp,level:a.level,iconId:i};this.gatedatas.push(r),i++}var o=this.gatelist.dataProvider;null==o?this.gatelist.dataProvider=new eui.ArrayCollection(this.gatedatas):o.replaceAll(this.gatedatas);for(var s=0;s<this.gatedatas.length;s++)if("open"==this.gatedatas[s].state){this.gatelist.selectedIndex=s;break}this.gatelist.selectedIndex<0&&(this.gatelist.selectedIndex=0),guide.addEventListener(guide.GuideOperation.GuideMasterChallenge,this.onGuideReminder,this),this.updateChallengeData()},n.prototype.updateChallengeData=function(){this.resetTimes=MasterChallenge.challengeLeft,this.ibTimes=MasterChallenge.ibLeft},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.LevelUp,this.updateChallenge,this),Game.dispatcher.removeEventListener(Game.EVENT.SyncMasterChallengeData,this.updateChallengeData,this),this.d=null,this.gatelist.selectedIndex=0,guide.removeEventListener(guide.GuideOperation.GuideMasterChallenge,this.onGuideReminder,this)},n.prototype.onTouchTap=function(t){switch(t.target){case this.imgClose:this.close();break;case this.btnAddTimes:this.onAddTimes();break;case this.btnRules:var n=new e.Rule;n.skinName="ChallengeInfoSkin",UIManager.pushPage(n)}},n.prototype.close=function(){UIManager.pop(this)},n.prototype.updateChallenge=function(){var e=this.gatelist.dataProvider;null==e?this.gatelist.dataProvider=new eui.ArrayCollection(this.gatedatas):e.replaceAll(this.gatedatas)},n.prototype.onAddTimes=function(){MasterChallenge.ibLeft<=0?PopUpMessage.push(lang.String("buy times used up"),color.GREEN):UIManager.pushPage(e.ChallengeTimes.instance)},n.prototype.onGuideReminder=function(){var e=this;this.visible&&guide.pushMovie({weight:1,handle:function(){var t=e.gatelist.dataProvider;t.refresh()}})},n}(e.FitComponent);e.ChallengeCopyUI=t,__reflect(t.prototype,"UI.ChallengeCopyUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.remainingTime=new RemainingTime,n.skinName="ChallengeNoteSkin",n.teamList.itemRenderer=e.UIGroupMemberInDungeon,n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n}return __extends(n,t),n.prototype.onTimer=function(){this.rest=this.remainingTime.getMinuteSecond()},n.prototype.onAddToStage=function(){SecondTicker.addEventListener(this.onTimer,this),null!=this.Id&&(this.gate=this.Id+1)},n.prototype.onRemoveFromStage=function(){SecondTicker.removeEventListener(this.onTimer,this)},Object.defineProperty(n.prototype,"second",{set:function(e){this.remainingTime.delta=e,this.onTimer()},enumerable:!0,configurable:!0}),n}(e.FitComponent);e.ChallengeNote=t,__reflect(t.prototype,"UI.ChallengeNote",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.awarddatas=[],n.skinName="ChallengeSucceedSkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.list.itemRenderer=e.AwardCell,n.awarddatas.length>0&&null==n.list.dataProvider&&(n.list.dataProvider=new eui.ArrayCollection(n.awarddatas)),n}return __extends(n,t),n.prototype.onTouchTap=function(t){var n=(Player.instance,this.Id);switch(t.target){case this.btnRepeat:if(n<MasterChallenge.MaxChapter&&MasterChallenge.challengeLeft<=0)return;if(n>MasterChallenge.MaxChapter)return void PopUpMessage.push(lang.String("challenge previous gate fail"),color.GREEN);net.socket.write(74,null),this.closehandle();break;case this.btnNext:if(n+1<MasterChallenge.MaxChapter&&MasterChallenge.challengeLeft<=0)return void(MasterChallenge.ibLeft>0?UIManager.pushPage(e.ChallengeTimes.instance):PopUpMessage.push(lang.String("challenge times fail"),color.GREEN));if(n+1>MasterChallenge.MaxChapter)return void PopUpMessage.push(lang.String("challenge previous gate fail"),color.GREEN);net.socket.write(75,null),this.closehandle();break;case this.btnReturn:this.closehandle(),MasterChallenge.onC2SExit();break;default:this.closehandle()}},n.prototype.onAddToStage=function(){this.gate=this.Id+1;Player.instance;null!=this.list&&this.awarddatas.length>0&&(this.list.dataProvider=new eui.ArrayCollection(this.awarddatas)),this.Id<=MasterChallenge.MaxChapter&&MasterChallenge.challengeLeft<=0&&(this.btnRepeat.enabled=!1);var e=this.Id+1;(e>=MasterChallenge.ChapterCount||table.challenges[e].level>PlayerAttribute.Level)&&(this.btnNext.enabled=!1),e<MasterChallenge.MaxChapter&&MasterChallenge.challengeLeft<=0&&(this.btnNext.enabled=!1),Game.isWildMap()?this.btnGroup.visible=!1:this.btnGroup.visible=!0},n.prototype.onRemoveFromStage=function(){this.awarddatas=[],this.gate=null,this.Id=null,this.btnNext.enabled=!0,this.btnRepeat.enabled=!0},n.prototype.timerComFunc=function(){this.closehandle()},n.prototype.closehandle=function(){UIManager.pop(this)},n.prototype.setEquiplist=function(e){for(var t=0;t<e.length;t++){var n=PlayerAttribute.GetItem(e[t]);if(0==n.Item.Type){var i=n.Item;this.awarddatas.push({type:"equip",content:{data:i}})}}},n.prototype.setAwardlist=function(e){for(var t=0;t<e.length;t++)this.awarddatas.push(table.parseAward(e[t]))},n}(e.FitComponent);e.ChallengeResult=t,__reflect(t.prototype,"UI.ChallengeResult",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="ChallengeTimesSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onTouchTap=function(e){switch(e.target){case this.btnBuy:this.onBuyChallenge();break;case this.btnClose:default:UIManager.pop(this)}},n.prototype.onBuyChallenge=function(){if(MasterChallenge.ibLeft<=0)return void PopUpMessage.push(lang.String("buy times used up"),color.GREEN);var t=PlayerAttribute.currency[Game.Currency.SilverCoin],i=PlayerAttribute.currency[Game.Currency.GoldCoin],a=100;return a>i+t?void PopUpMessage.push(lang.String("not enough anyCoin"),color.RED):a>t?void UIManager.push(new e.SilverPromptByCost(a,function(){return PlayerAttribute.currency[Game.Currency.GoldCoin]+PlayerAttribute.currency[Game.Currency.SilverCoin]<a?void PopUpMessage.push(lang.String("not enough goldcoin"),color.RED):(UIManager.pop(this),net.socket.write(60,null),void(n.instance&&UIManager.pop(n.instance)))})):(net.socket.write(60,null),void UIManager.pop(this))},n}(e.FitComponent);e.ChallengeTimes=t,__reflect(t.prototype,"UI.ChallengeTimes",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="MeridianCheckSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.close,t),t.lblAttribute.textFlow=Game.HtmlTextParser.parse(Meridian.getAllDesc()),t}return __extends(t,e),t.prototype.close=function(){UIManager.pop(this)},t}(e.FitComponent);e.MeridianAttributes=t,__reflect(t.prototype,"UI.MeridianAttributes",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="MeridianLabelSkin",eui.Binding.bindHandler(t,["data","actived"],t.invalidateState,t),t}return __extends(t,e),t.prototype.getCurrentState=function(){return null==this.data||1!=this.data.actived?"inactivated":"activated"},t}(eui.ItemRenderer);e.MeridianLabel=t,__reflect(t.prototype,"UI.MeridianLabel")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.line=new egret.Shape,t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.addChildAt(this.line,1),this.hide()},t.prototype.hide=function(){this.hideAcupoints||(this.hideAcupoints=!0,this.line.graphics.clear(),this.acupoints.visible=!1)},t.prototype.refresh=function(){if(this.$UIComponent[29]){this.hideAcupoints=!1;var e=this.acupoints.numChildren;if(e!=Meridian.MaxAcupoints)return void egret.error("numChildren != "+Meridian.MaxAcupoints);this.line.graphics.clear(),this.acupoints.visible=!0;for(var t=0;e>t;t++){var n=this.acupoints.getChildAt(t);t<Meridian.acupoint?n.currentState="full":t==Meridian.acupoint?n.currentState="lock":n.currentState="lock"}this.line.graphics.lineStyle(2,65280);for(var t=0;e>t;t++){var n=this.acupoints.getChildAt(t),i=n.x+n.scaleX*n.width/2,a=n.y+n.scaleX*n.height/2;0!=t?t<Meridian.acupoint&&this.line.graphics.lineTo(i,a):this.line.graphics.moveTo(i,a)}}},t}(eui.Component);e.MeridiansChart=t,__reflect(t.prototype,"UI.MeridiansChart",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;e.skinName="MeridianUISkin",e.autoTrain=MakeDelayExecute(e.onTouchTrain,e,100),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.chartprops=[];var n=function(e){return{alpha:e.alpha,scaleX:e.scaleX,scaleY:e.scaleY,x:e.x,y:e.y}};return e.chartprops.push(n(e.chart1)),e.chartprops.push(n(e.chart2)),e.chartprops.push(n(e.chart3)),e.chartprops.push(n(e.chart4)),e.charts=[],e.charts.push(e.chart1),e.charts.push(e.chart2),e.charts.push(e.chart3),e.charts.push(e.chart4),e.initRotate(),e}return __extends(n,t),n.prototype.initRotate=function(){var e,t=this.chartprops.length;e=Meridian.level>=Meridian.MaxLevel?1:t-~~(Meridian.level/Meridian.MaxAcupoints)%t;for(var n=0,i=e;e+t>i;i++){var a=this.chartprops[n],r=this.charts[i%t];r.alpha=a.alpha,r.scaleX=a.scaleX,r.scaleY=a.scaleY,r.x=a.x,r.y=a.y,i==e?r.refresh():r.hide(),n++}this.addChildAt(this.charts[e%t],this.numChildren)},n.prototype.rotate=function(e){var t=this,n=e.length,i=n-~~(Meridian.level/Meridian.MaxAcupoints)%n,a=0,r=function(){a++,a==n&&(Meridian.reload(),t.autoTrain())};e[(i+1)%n].refresh();for(var o=function(t){var i=e[t%n],a=e[(t+1)%n];egret.Tween.get(i).wait(200).call(function(){i.hide()},s).to({x:a.x,y:a.y,scaleX:a.scaleX,scaleY:a.scaleY,alpha:a.alpha},200).call(r,s)},s=this,l=i;i+n>l;l++)o(l)},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.SyncMeridians,this.onSyncMeridians,this),Game.dispatcher.addEventListener(Game.EVENT.CurrencyChange[Game.Currency.Zhenqi],this.onSyncCurrencyChange,this),Game.dispatcher.addEventListener(Game.EVENT.MeridiansUpgrade,this.onMeridianUpgrade,this),Game.dispatcher.addEventListener(Game.EVENT.MeridiansLevelUp,this.autoTrain,this),this.refresh(),guide.addEventListener(guide.GuideOperation.GuideMeridian,this.onGuideReminder,this),guide.completed()||this.playGuideMovie(guide.info.operation)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.SyncMeridians,this.onSyncMeridians,this),Game.dispatcher.removeEventListener(Game.EVENT.CurrencyChange[Game.Currency.Zhenqi],this.onSyncCurrencyChange,this),Game.dispatcher.removeEventListener(Game.EVENT.MeridiansUpgrade,this.onMeridianUpgrade,this),Game.dispatcher.removeEventListener(Game.EVENT.MeridiansLevelUp,this.autoTrain,this),guide.removeEventListener(guide.GuideOperation.GuideMeridian,this.onGuideReminder,this),this.autoTrain.stop()},n.prototype.onMeridianUpgrade=function(){null!=this.charts&&Meridian.level<Meridian.MaxLevel?this.rotate(this.charts):(Meridian.reload(),this.autoTrain())},n.prototype.onSyncMeridians=function(){this.fp=Meridian.fp,this.currentAttribute=Meridian.getDesc(Meridian.id),this.currentAttributeNext=Meridian.getNextDesc(Meridian.id),this.cost=table.meridian.cost[Meridian.grade*Meridian.MaxMeridians+Meridian.id],this.onSyncCurrencyChange();for(var e=this.labels.dataProvider,t=0;t<e.length;t++){var n=e.getItemAt(t),i=void 0;if(Meridian.level>=Meridian.MaxLevel){if(i=Meridian.maiFnt[t],Meridian.grade>0&&Meridian.grade<=10)i+=Meridian.gradeFnt[Meridian.grade];else if(Meridian.grade>10&&Meridian.grade<20)i+=Meridian.gradeFnt[10]+Meridian.gradeFnt[Meridian.grade];else{var a=Math.floor(Meridian.grade/10),r=Meridian.grade%10;i+=0==r?Meridian.gradeFnt[a]+Meridian.gradeFnt[20]:Meridian.gradeFnt[a]+Meridian.gradeFnt[r+10]}n.actived=!0}else if(Meridian.level<Meridian.MaxLevel&&t>=Meridian.id){var a=Math.floor(Meridian.grade/10),r=Meridian.grade%10;i=Meridian.maiFnt[t],i+=Meridian.grade>0&&Meridian.grade<=10?Meridian.gradeFnt[Meridian.grade]:Meridian.grade>10&&Meridian.grade<20?Meridian.gradeFnt[10]+Meridian.gradeFnt[Meridian.grade]:0==r?Meridian.gradeFnt[a]+Meridian.gradeFnt[20]:Meridian.gradeFnt[a]+Meridian.gradeFnt[r+10],n.actived=Meridian.grade==Meridian.MaxGrade}else{i=Meridian.maiFnt[t];var o=Meridian.grade+1,a=Math.floor(o/10),r=o%10;i+=o>0&&10>=o?Meridian.gradeFnt[o]:o>10&&20>o?Meridian.gradeFnt[10]+Meridian.gradeFnt[o]:0==r?Meridian.gradeFnt[a]+Meridian.gradeFnt[20]:Meridian.gradeFnt[a]+Meridian.gradeFnt[r+10],n.actived=!0}n.name=i}null!=this.chartprops&&this.initRotate()},n.prototype.onSyncCurrencyChange=function(){var e=PlayerAttribute.currency[Game.Currency.Zhenqi];e>=this.cost?this.ZhenQi=Game.HtmlTextParser.parse('<font color="#6cef5b">'+e+"</font>"):this.ZhenQi=Game.HtmlTextParser.parse('<font color="#F01616">'+e+"</font>"),this.descGroup.visible=Meridian.level<Meridian.MaxLevel,this.costGroup.visible=this.descGroup.visible},n.prototype.refresh=function(){this.onSyncMeridians(),this.onSyncCurrencyChange()},n.prototype.onTouchTrain=function(){var e=PlayerAttribute.currency[Game.Currency.Zhenqi];e<this.cost||net.socket.write(26,null)},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnTrain:var n=PlayerAttribute.currency[Game.Currency.Zhenqi];if(n<this.cost)return void this.GainZhenqi();this.autoTrain();break;case this.btnGenZhenqi:this.GainZhenqi();break;case this.btnDetail:UIManager.pushPage(new e.MeridianAttributes)}},n.prototype.GainZhenqi=function(){e.ResourceObtain.Open([e.ObtResId.zhenqiItem])},n.prototype.onGuideReminder=function(){var e=this;if(this.visible){var t=guide.info.operation;t==guide.GuideOperation.GuideMeridian&&guide.pushMovie({weight:1,handle:function(){guide.AddMovieClip(e.btnTrain)}})}},n.prototype.playGuideMovie=function(e){e==guide.GuideOperation.GuideMeridian&&guide.AddMovieClip(this.btnTrain)},n}(eui.Component);e.MeridianUI=t,__reflect(t.prototype,"UI.MeridianUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(e){var n=t.call(this)||this;return n.storage=0,n.skinName="JadePurchaseSkin",n.goods=e,n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n}return __extends(n,t),n.prototype.close=function(){UIManager.pop(this)},n.prototype.onAddToStage=function(){this.UpdateStorage(),this.itemname=this.goods.name,this.itemDesc.textFlow=Game.HtmlTextParser.parse(this.goods.desc),this.showcase.icon=this.goods.icon,this.showcase.quality=this.goods.quality,this.goldCoinprice1=this.goods.param.goldCoin,this.goldCoinprice10=10*this.goods.param.goldCoin,this.silverCoinprice1=this.goods.param.silverCoin,this.silverCoinprice5=5*this.goods.param.silverCoin,Game.dispatcher.addEventListener(Game.EVENT.MonthlyActUpdateCounterTask,this.UpdateStorage,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.MonthlyActUpdateCounterTask,this.UpdateStorage,this)},n.prototype.UpdateStorage=function(){var e=monthlyactivity.GetCounter(monthlyactivity.act.buyJade.counterID);this.storage=monthlyactivity.act.buyJade.maxTimes-e,this.labelLeftStock.textFlow=Game.HtmlTextParser.parse("Tồn kho: <font color="+egret.toColorString(color.Title1_Value)+">"+this.storage+"</font>")},n.prototype.onTouchTap=function(e){switch(e.target){case this.goldBuy1:this.buyJadebyGoldCoin(1);break;case this.goldBuy10:this.buyJadebyGoldCoin(10);break;case this.silverBuy1:this.buyJadebySilverCoin(1);break;case this.silverBuy5:this.buyJadebySilverCoin(5);break;default:return}},n.prototype.buyJadebyGoldCoin=function(t){var n=PlayerAttribute.currency[Game.Currency.GoldCoin],i=this.goods.param.goldCoin*t;if(i>n)return PopUpMessage.push(lang.String("not enough goldcoin"),color.RED),void UIManager.push(new e.GoldCoinPrompt);var a=new net.def.C2SBuyJade;a.number=t,net.socket.write(2062,a.toArrayBuffer())},n.prototype.buyJadebySilverCoin=function(t){var n=PlayerAttribute.currency[Game.Currency.SilverCoin],i=this.goods.param.silverCoin*t;if(this.storage<t)return void PopUpMessage.push(lang.String("not enough storage"),color.RED);if(i>n)return void UIManager.push(new e.SilverPromptByCost(i,function(){if(PlayerAttribute.currency[Game.Currency.GoldCoin]+PlayerAttribute.currency[Game.Currency.SilverCoin]<i)return PopUpMessage.push(lang.String("not enough goldcoin"),color.RED),UIManager.popNoTweens(this),void UIManager.push(new e.GoldCoinPrompt);UIManager.pop(this);var n=new net.def.C2SBuyJadeWithSliverCoin;n.number=t,net.socket.write(2068,n.toArrayBuffer())}));var a=new net.def.C2SBuyJadeWithSliverCoin;a.number=t,net.socket.write(2068,a.toArrayBuffer())},n}(e.FitComponent);e.JadePurchase=t,__reflect(t.prototype,"UI.JadePurchase",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(e){var n=t.call(this)||this;return n.skinName="MonthlyActivityAwardPageSkin",n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.award=e,n}return __extends(n,t),n.prototype.onAddToStage=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),this.listAward.itemRenderer=e.AwardCell,this.listAward.dataProvider=new eui.ArrayCollection(this.award)},n.prototype.onRemoveFromStage=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this)},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:case this.btnReturn:UIManager.pop(this)}},n}(e.FitComponent);e.MonthlyActivityAwardPage=t,__reflect(t.prototype,"UI.MonthlyActivityAwardPage")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="MonthlyActivityCounterTaskSkin",e.touchEnabled=!1,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.MonthlyActUpdateCounterTask,this.Update,this),this.Update()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.MonthlyActUpdateCounterTask,this.Update,this)},n.prototype.Update=function(){for(var t=[],n=monthlyactivity.act.counterTasks,i=0;i<n.length;i++){var a=1e3-i-300*monthlyactivity.counterTask[i];monthlyactivity.GetCounter(n[i].counterID)<n[i].target&&(a-=300),t.push({id:i,counterID:n[i].counterID,power:a})}t.sort(function(e,t){return e.power<t.power?1:e.power>t.power?-1:0}),this.taskList.itemRenderer=e.MonthlyActivityCounterTaskItem,this.taskList.dataProvider=new eui.ArrayCollection(t)},n}(eui.Component);e.MonthlyActivityCounterTask=t,__reflect(t.prototype,"UI.MonthlyActivityCounterTask",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="MonthlyActivityCounterTaskItemSkin",n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.awardList.itemRenderer=e.AwardCell,n}return __extends(n,t),n.prototype.dataChanged=function(){var e=monthlyactivity.act.counterTasks[this.data.id];
monthlyactivity.GetCounter(e.counterID)<e.target?this.currentState="notfinished":monthlyactivity.counterTask[this.data.id]?this.currentState="used":this.currentState="canuse";var t=e.target,n=monthlyactivity.GetCounter(e.counterID);this.labelNum.text=String(n)+"/"+String(t),this.labelTaskDesc.textFlow=Game.HtmlTextParser.parse(e.desc),this.awardList.dataProvider=new eui.ArrayCollection(e.award)},n.prototype.onAddToStage=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this)},n.prototype.onRemoveFromStage=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this)},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnClick:var t=new net.def.C2SMonthlyActCounterAward;t.awardID=this.data.id,net.socket.write(2061,t.toArrayBuffer())}},n}(eui.ItemRenderer);e.MonthlyActivityCounterTaskItem=t,__reflect(t.prototype,"UI.MonthlyActivityCounterTaskItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="MonthlyActivityFrameSkin",e.touchEnabled=!1,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.tabPage.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTabBar,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onAddToStage=function(){this.tabPage.selectedIndex=0,this.pageStack.selectedIndex=0,this.onJadeChange(),Game.dispatcher.addEventListener(Game.EVENT.CurrencyChange[Game.Currency.Jade],this.onJadeChange,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.CurrencyChange[Game.Currency.Jade],this.onJadeChange,this)},n.prototype.onTouchTabBar=function(){this.tabPage.selectedIndex!=this.pageStack.selectedIndex&&(this.pageStack.selectedIndex=this.tabPage.selectedIndex)},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnJadeGainRes:e.ResourceObtain.Open([e.ObtResId.jade]);break;case this.btnRules:var n=new e.Rule;n.skinName="MonthlyActivityRulesSkin",UIManager.pushPage(n)}},n.prototype.onJadeChange=function(){this.jadeCount.textFlow=Game.HtmlTextParser.parse(lang.String(monthlyactivity.Jade.name)+":<font color="+egret.toColorString(color.Title1_Value)+">"+PlayerAttribute.currency[Game.Currency.Jade]+"</font>")},n}(eui.Component);e.MonthlyActivityFrame=t,__reflect(t.prototype,"UI.MonthlyActivityFrame",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(t){var n=e.call(this)||this;return n.targetID=0,n.awardData=[],n.skinName="MonthlyActivityListItemSkin",n.targetID=t,n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n}return __extends(t,e),t.prototype.onAddToStage=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),this.Update(),Game.dispatcher.addEventListener(Game.EVENT.MonthlyActUpdateTarget,this.Update,this),Game.dispatcher.addEventListener(Game.EVENT.CurrencyChange[Game.Currency.Jade],this.Update,this)},t.prototype.onRemoveFromStage=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),Game.dispatcher.removeEventListener(Game.EVENT.MonthlyActUpdateTarget,this.Update,this),Game.dispatcher.removeEventListener(Game.EVENT.CurrencyChange[Game.Currency.Jade],this.Update,this)},t.prototype.Update=function(){if(null!=this.targetID){var e=monthlyactivity.act.targets[this.targetID];if(null!=e){this.strTimes=String(monthlyactivity.GetCounter(e.counterID))+"/"+String(e.maxTimes);var t=this.awardList.dataProvider;t?t.replaceAll(e.award):this.awardList.dataProvider=new eui.ArrayCollection(e.award);var n=this.listElems.dataProvider;n?n.replaceAll(e.elems):this.listElems.dataProvider=new eui.ArrayCollection(e.elems)}}},t.prototype.onTouchTap=function(e){var t;switch(e.target){case this.btnDoOnce:if(t=monthlyactivity.CheckTarget(this.targetID),t.num<1)return t.tips&&PopUpMessage.push(t.tips,color.RED,!1),void monthlyactivity.resourceObtain(t.idx);var n=new net.def.C2SMonthlyActReqDoTarget;n.setTargetID(this.targetID),n.setTimes(1),net.socket.write(2060,n.toArrayBuffer());break;case this.btnDoTenTimes:if(t=monthlyactivity.CheckTarget(this.targetID,10),t.num<10)return t.tips&&PopUpMessage.push(t.tips,color.RED,!1),void monthlyactivity.resourceObtain(t.idx);var n=new net.def.C2SMonthlyActReqDoTarget;n.setTargetID(this.targetID),n.setTimes(10),net.socket.write(2060,n.toArrayBuffer())}},t}(eui.Component);e.MonthlyActivityListItem=t,__reflect(t.prototype,"UI.MonthlyActivityListItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="MonthlyActivityMainSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(n,t),n.prototype.onAddToStage=function(){if(this.activitytime=monthlyactivity.getEndDateString(),null!=this.groupTask){for(;this.groupTask.$children.length>0;)this.groupTask.removeChildAt(0);for(var t=monthlyactivity.act.targets,n=0;n<t.length;n++)this.groupTask.addChild(new e.MonthlyActivityListItem(n));this.imgBackGround.source=monthlyactivity.act.backImg}},n}(eui.Component);e.MonthlyActivityMain=t,__reflect(t.prototype,"UI.MonthlyActivityMain",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="NienBossDetailItemSkin",t}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.getRankIcon=function(e){var t="";switch(e){case 1:t="ui/ranking/first_icon.png";break;case 2:t="ui/ranking/second_icon.png";break;case 3:t="ui/ranking/third_icon.png"}return t},t.prototype.dataChanged=function(){this.rankIcon.source=this.getRankIcon(this.data.getRank()),this.rank=this.data.getRank(),this.playerName=this.data.getName(),this.level=this.data.getLevel(),this.fp=this.data.getFp(),this.damage=FormatBigNumber(this.data.getDamage()),this.factionIcon.source=table.faction[this.data.getFaction()].logo,this.vipIcon.source=Vip.getVipIcon(this.data.getVipLevel())},t}(eui.ItemRenderer);e.NienBossDetailItem=t,__reflect(t.prototype,"UI.NienBossDetailItem")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.remainingTime=new RemainingTime,n.skinName="NienBossDetailPanelSkin",n.dataRank=new eui.ArrayCollection,n.dataAllAward=new eui.ArrayCollection,n.listRank.itemRenderer=e.NienBossDetailItem,n.listRank.dataProvider=n.dataRank,n.listAllAward.itemRenderer=e.AwardCell,n.listAllAward.dataProvider=n.dataAllAward,n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n}return __extends(n,t),n.prototype.onAddToStage=function(){this.title=NienBoss.config.activityName,SecondTicker.addEventListener(this.updateRestTime,this),Game.dispatcher.addEventListener(Game.EVENT.NienBossSyncStage,this.updateData,this),Game.dispatcher.addEventListener(Game.EVENT.NienBossSyncRank,this.updateData,this),Game.dispatcher.addEventListener(Game.EVENT.NienBossSyncAward,this.updateData,this),this.updateData()},n.prototype.onRemoveFromStage=function(){SecondTicker.removeEventListener(this.updateRestTime,this),Game.dispatcher.removeEventListener(Game.EVENT.NienBossSyncStage,this.updateData,this),Game.dispatcher.removeEventListener(Game.EVENT.NienBossSyncRank,this.updateData,this),Game.dispatcher.removeEventListener(Game.EVENT.NienBossSyncAward,this.updateData,this)},n.prototype.updateRestTime=function(){this.time=this.remainingTime.getMinuteSecond()},n.prototype.updateData=function(){null!=NienBoss.bossInfoStage&&(this.remainingTime.delta=NienBoss.bossInfoStage.getLeftTime()),null!=NienBoss.bossInfoRank&&(this.dataRank.replaceAll(NienBoss.bossInfoRank.getRankList()),this.myInfo.data=NienBoss.bossInfoRank.getMyInfo()),null!=NienBoss.bossInfoAward&&(this.myCollectNum.text=NienBoss.bossInfoAward.getTotalCollectNum()+" / "+NienBoss.bossInfoAward.getMaxCollectNum(),this.dataAllAward.replaceAll(table.parseAwards(NienBoss.bossInfoAward.allAward))),this.groupAward.visible=this.dataAllAward.length>0},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:UIManager.pop(this);break;default:return}},n.prototype.close=function(){UIManager.pop(this)},n}(e.FitComponent);e.NienBossDetailPanel=t,__reflect(t.prototype,"UI.NienBossDetailPanel",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.remainingTime=new RemainingTime,e.skinName="NienBossNoteSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onAddToStage=function(){this.activityName=NienBoss.config.activityName,SecondTicker.addEventListener(this.updateRestTime,this),Game.dispatcher.addEventListener(Game.EVENT.NienBossSyncStage,this.updateData,this),Game.dispatcher.addEventListener(Game.EVENT.NienBossSyncAward,this.updateData,this)},n.prototype.onRemoveFromStage=function(){SecondTicker.removeEventListener(this.updateRestTime,this),Game.dispatcher.removeEventListener(Game.EVENT.NienBossSyncStage,this.updateData,this),Game.dispatcher.removeEventListener(Game.EVENT.NienBossSyncAward,this.updateData,this)},n.prototype.updateRestTime=function(){this.time=this.remainingTime.getMinuteSecond()},n.prototype.updateData=function(){if(null!=NienBoss.bossInfoStage&&(this.remainingTime.delta=NienBoss.bossInfoStage.getLeftTime()),null!=NienBoss.bossInfoAward){this.collectNum.text=NienBoss.bossInfoAward.totalCollectNum+" / "+NienBoss.bossInfoAward.maxCollectNum;var e=NienBoss.bossInfoAward.collectItems[0],t=e.getObjType(),n=NienBoss.getObjAward(t);this.icon0.source=table.getAwardIcon(n),this.num0=e.count;var i=NienBoss.bossInfoAward.collectItems[1],a=i.getObjType(),r=NienBoss.getObjAward(a);this.icon1.source=table.getAwardIcon(r),this.num1=i.count;var o=NienBoss.bossInfoAward.collectItems[2],s=o.getObjType(),l=NienBoss.getObjAward(s);this.icon2.source=table.getAwardIcon(l),this.num2=o.count}this.updateRestTime()},n.prototype.updateBossHP=function(e,t){null!=this.bossBar&&(this.bossBar.maximum=e,this.bossBar.value=t)},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnDetail:var n=new e.NienBossDetailPanel;UIManager.pushPage(n);break;case this.btnExit:this.onClickExit()}},n.prototype.onClickExit=function(){var t=lang.String("operation confirm"),n=lang.StringWithFormat("nienboss leave scene confirm msg");e.ConfirmBox.Show(e.ConfirmBoxStyle.team,t,n,function(){return net.socket.write(141,null),!0},null,null)},n}(e.FitComponent);e.NienBossNote=t,__reflect(t.prototype,"UI.NienBossNote",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="NienBossSignPanelSkin",n.dataAward=new eui.ArrayCollection,n.listAward.itemRenderer=e.AwardCell,n.listAward.dataProvider=n.dataAward,n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n}return __extends(n,t),n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n),this.imgBg.source=NienBoss.config.signPanelBg},n.prototype.onAddToStage=function(){var e=[];for(var t in NienBoss.config.awards.objAward)e.push(NienBoss.config.awards.objAward[t]);this.dataAward.replaceAll(e),this.openLevel=lang.StringWithFormat("{1}level",NienBoss.config.levelLimit),this.openTime="";for(var n=0;n!=NienBoss.config.times.length;n++){var i=NienBoss.config.times[n],a=~~(i/100),r=i%100;this.openTime+=a+":"+r+"    ",n>0&&n%6==0&&(this.openTime+="\n")}},n.prototype.onRemoveFromStage=function(){},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnEnter:NienBoss.ApplyJoin();break;default:return}},n}(e.FitComponent);e.NienBossSignPanel=t,__reflect(t.prototype,"UI.NienBossSignPanel",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.btnDraw.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onDraw,this)},t.prototype.dataChanged=function(){this.buyTimes=this.data.chance-OpeningWheel.getDrawTimes(this.data.idx),this.buyTimes>0?(this.btnDraw.enabled=!0,this.soldOut.visible=!1):(this.btnDraw.enabled=!1,this.soldOut.visible=!0),this.awardCell.data=this.data.items[0];var e=table.props[this.data.items[0].content.genre][this.data.items[0].content.detailType];this.itemName.textFlow=Game.HtmlTextParser.parse("<font color="+egret.toColorString(Item.QualityColor[e.quality])+">"+e.name+"</font>")},t.prototype.onDraw=function(){return OpeningWheel.activity.open?OpeningWheel.currency<this.data.price?void PopUpMessage.push(lang.String("not enough holidaywheelcurrency"),color.RED):(OpeningWheel.buy(this.data.idx),void(this.btnDraw.enabled=!1)):(this.btnDraw.enabled=!1,void PopUpMessage.push(lang.String("out of time"),color.RED))},t}(eui.ItemRenderer);e.OpeningWheelShopItem=t,__reflect(t.prototype,"UI.OpeningWheelShopItem");var n=function(e){function t(){var t=e.call(this)||this;return t.skinName="HolidayWheelShopSkin",t.onDataChanged=MakeDelayExecute(t.onRefreshUI,t,200),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.close=function(){UIManager.pop(this)},t.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.OpeningWheelShopChance,this.onDataChanged,this),Game.dispatcher.addEventListener(Game.EVENT.OpeningWheelShopResult,this.onRefreshResult,this),Game.dispatcher.addEventListener(Game.EVENT.OpeningWheelCurrencyChanged,this.onCurrencyChanged,this),this.onCurrencyChanged(),this.onDataChanged()},t.prototype.onCurrencyChanged=function(){this.currency=OpeningWheel.currency},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.OpeningWheelShopChance,this.onDataChanged,this),Game.dispatcher.removeEventListener(Game.EVENT.OpeningWheelShopResult,this.onRefreshResult,this),Game.dispatcher.removeEventListener(Game.EVENT.OpeningWheelCurrencyChanged,this.onCurrencyChanged,this),this.onDataChanged.stop()},t.prototype.onRefreshUI=function(){var e=this.dataGroup.dataProvider;null==e?this.dataGroup.dataProvider=new eui.ArrayCollection(OpeningWheel.shopConfig):e.replaceAll(OpeningWheel.shopConfig)},t.prototype.onRefreshResult=function(e){var t=parseInt(e.data),n=this.dataGroup.dataProvider;n.itemUpdated(n.source[t])},t.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},t}(e.FitComponent);e.OpeningWheelShop=n,__reflect(n.prototype,"UI.OpeningWheelShop",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="HolidayWheelSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),n.prototype.onAddToStage=function(){this.onCurrencyChanged(),Game.dispatcher.addEventListener(Game.EVENT.NotifyOpeningWheel,this.onNotifyResult,this),Game.dispatcher.addEventListener(Game.EVENT.OpeningWheelCurrencyChanged,this.onCurrencyChanged,this),Game.dispatcher.addEventListener(Game.EVENT.OnSyncOpenningWheelFreeTimes,this.UpdateFreeTimes,this),this.openDate.text=Activity.getLastTime(OpeningWheel.activity.kindId),this.UpdateFreeTimes()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.NotifyOpeningWheel,this.onNotifyResult,this),Game.dispatcher.removeEventListener(Game.EVENT.OpeningWheelCurrencyChanged,this.onCurrencyChanged,this),Game.dispatcher.removeEventListener(Game.EVENT.OnSyncOpenningWheelFreeTimes,this.UpdateFreeTimes,this)},n.prototype.UpdateFreeTimes=function(){null!=this.btnRoll&&(OpeningWheel.FreeTimes>0?this.btnRoll.label="Miễn phí 1 lần":this.btnRoll.label="30 KNB")},n.prototype.getCell=function(e){return OpeningWheel.config[e]},n.prototype.getCurrency=function(){return OpeningWheel.currency},n.prototype.getCost=function(e){if(!e&&OpeningWheel.FreeTimes>0)return 0;var t=OpeningWheel.cost;return e&&(t=OpeningWheel.cost10),t},n.prototype.roll=function(e){return OpeningWheel.roll(e)},n.prototype.draw=function(){OpeningWheel.draw()},n.prototype.onTapShop=function(){UIManager.push(new e.OpeningWheelShop)},n}(e.BasePrizeWheel);e.OpeningWheelUI=t,__reflect(t.prototype,"UI.OpeningWheelUI")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="PartnerQingyiAttributeItemSkin",t}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.dataChanged=function(){this.attribute.text=this.data.attribute,this.oldValue.text=this.data.oldValue.toString(),this.newValue.text=this.data.newValue.toString()},t}(eui.ItemRenderer);e.PartnerQingyiAttributeItem=t,__reflect(t.prototype,"UI.PartnerQingyiAttributeItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="PartnerQingyiGroupButtonItemSkin",t}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.dataChanged=function(){this.btn.currentState=this.data.select?"up":"disabled";var e=PartnerQingyi.GetGroupConfig(this.data.groupId);this.btn.label=e.name;var t=PartnerQingyi.GetDataGroupLevel(this.data.groupId),n=PartnerQingyi.GetLevelConfig(t);this.imgLevel.source=null!=n?n.icon:"";var i=PartnerQingyi.badgeUnlockGroup[this.data.groupId],a=PartnerQingyi.badgeSkillLevelup[this.data.groupId],r=i||a;PartnerQingyi.curMode==PartnerQingyi.MODE_OTHER&&(r=!1),this.badge.visible=r},t}(eui.ItemRenderer);e.PartnerQingyiGroupButtonItem=t,__reflect(t.prototype,"UI.PartnerQingyiGroupButtonItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="PartnerQingyiGroupLevelItemSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.dataChanged=function(){var e=PartnerQingyi.GetLevelConfig(this.data.level);this.imgLevel.source=e.icon,this.imgItem.visible=this.data.itemFlag,this.imgSkill.visible=this.data.skillFlag;var t=PartnerQingyi.GetDataGroupLevel(this.data.groupId);t>=this.data.level?this.groupIcon.filters=null:this.groupIcon.filters=[grayFlilter]},n.prototype.onTouchTap=function(t){e.PartnerQingyiTips.open(this.data.groupId,this.data.level)},n}(eui.ItemRenderer);e.PartnerQingyiGroupLevelItem=t,__reflect(t.prototype,"UI.PartnerQingyiGroupLevelItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="PartnerQingyiInfoViewSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.open=function(){null==this.instance&&(this.instance=new t),PartnerQingyi.curMode=PartnerQingyi.MODE_OTHER,UIManager.push(this.instance)},t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},t.prototype.onAddToStage=function(){},t.prototype.onRemoveFromStage=function(){PartnerQingyi.curMode=PartnerQingyi.MODE_SELF},t}(e.FitComponent);e.PartnerQingyiInfoView=t,__reflect(t.prototype,"UI.PartnerQingyiInfoView",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.OPTMODE_NONE=1,n.OPTMODE_UNLOCKGROUP=1,n.OPTMODE_USEQINGYIITEM=2,n.OPTMODE_SKILLLEVELUP=3,n.skinName="PartnerQingyiMainSkin",n.dataListBtn=new eui.ArrayCollection,n.listBtn.dataProvider=n.dataListBtn,n.listBtn.itemRenderer=e.PartnerQingyiGroupButtonItem,n.dataListAttribute=new eui.ArrayCollection,n.listAttribute.dataProvider=n.dataListAttribute,n.selectGroupId=1,n.curOptMode=n.OPTMODE_NONE,n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.listBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onSelectListBtn,n),n}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.onAddToStage=function(){this.Update(),Game.dispatcher.addEventListener(Game.EVENT.PartnerQingyiOptUnlockGroup,this.Update,this),Game.dispatcher.addEventListener(Game.EVENT.PartnerQingyiOptUpdateQingyiValue,this.Update,this),Game.dispatcher.addEventListener(Game.EVENT.PartnerQingyiOptSkillLevelup,this.Update,this),Game.dispatcher.addEventListener(Game.EVENT.PartnerDataChange,this.Update,this),Game.dispatcher.addEventListener(Game.EVENT.PartnerQingyiOptPartnerDataChange,this.Update,this)},n.prototype.onRemoveFromStage=function(){this.selectGroupId=1,Game.dispatcher.removeEventListener(Game.EVENT.PartnerQingyiOptUnlockGroup,this.Update,this),Game.dispatcher.removeEventListener(Game.EVENT.PartnerQingyiOptUpdateQingyiValue,this.Update,this),Game.dispatcher.removeEventListener(Game.EVENT.PartnerQingyiOptSkillLevelup,this.Update,this),Game.dispatcher.removeEventListener(Game.EVENT.PartnerDataChange,this.Update,this),Game.dispatcher.removeEventListener(Game.EVENT.PartnerQingyiOptPartnerDataChange,this.Update,this)},n.prototype.Update=function(){this.UpdateBtnList(),this.UpdateOptBtn(),this.UpdateBadge(),this.UpdateNpc(),this.UpdateGroupLevel(),this.UpdateAttribute(),this.UpdateSkill(),this.UpdateFightingPower()},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnOpt:this.onClickOptBtn();break;case this.btnRule:var n=new e.Rule;n.skinName="PartnerQingyiRule",UIManager.pushPage(n)}},n.prototype.onClickOptBtn=function(){if(PartnerQingyi.curMode!=PartnerQingyi.MODE_OTHER)switch(this.curOptMode){case this.OPTMODE_UNLOCKGROUP:e.partnerQingyiUp.open_UnlockGroup(this.selectGroupId);break;case this.OPTMODE_USEQINGYIITEM:e.PartnerQingyiUpUseItem.open(this.selectGroupId);break;case this.OPTMODE_SKILLLEVELUP:e.partnerQingyiUp.open_SkillLevelup(this.selectGroupId)}},n.prototype.onSelectListBtn=function(){var e=this.listBtn.selectedIndex;this.selectGroupId=e+1,this.Update()},n.prototype.UpdateBtnList=function(){for(var e=[],t=1;t<=PartnerQingyi.MaxGroupId;t++)e.push({groupId:t,select:t==this.selectGroupId});this.dataListBtn.replaceAll(e)},n.prototype.UpdateOptBtn=function(){if(PartnerQingyi.curMode==PartnerQingyi.MODE_OTHER)return void(this.btnOpt.visible=!1);var e=PartnerQingyi.GetDataGroupLevel(this.selectGroupId);if(e>=PartnerQingyi.MaxQingyiLevel)return this.btnOpt.label=lang.String("partnerqingyi btn msg skill levelup"),void(this.curOptMode=this.OPTMODE_SKILLLEVELUP);var t=PartnerQingyi.GetDataQingyiValue(this.selectGroupId),n=PartnerQingyi.GetGroupLevelConfig(this.selectGroupId,e);return null!=n?t>=n.qingyiValue?(this.btnOpt.label=lang.String("partnerqingyi btn msg unlock group"),void(this.curOptMode=this.OPTMODE_UNLOCKGROUP)):(this.btnOpt.label=lang.String("partnerqingyi btn msg use qingyi item"),void(this.curOptMode=this.OPTMODE_USEQINGYIITEM)):0==e?(this.btnOpt.label=lang.String("partnerqingyi btn msg unlock group"),void(this.curOptMode=this.OPTMODE_UNLOCKGROUP)):void(this.curOptMode=this.OPTMODE_NONE)},n.prototype.UpdateBadge=function(){this.curOptMode==this.OPTMODE_UNLOCKGROUP&&PartnerQingyi.curMode==PartnerQingyi.MODE_SELF?this.badgeOpt.visible=PartnerQingyi.badgeUnlockGroup[this.selectGroupId]:this.curOptMode==this.OPTMODE_SKILLLEVELUP&&PartnerQingyi.curMode==PartnerQingyi.MODE_SELF?this.badgeOpt.visible=PartnerQingyi.badgeSkillLevelup[this.selectGroupId]:this.badgeOpt.visible=!1},n.prototype.UpdateNpc=function(){for(var e=PartnerQingyi.GetGroupConfig(this.selectGroupId),t=e.partners,n=t.length,i=0;i!=PartnerQingyi.GROUP_MAX_PARTNERNUM;i++){var a=this.groupNPCItem.getChildAt(i);if(n>i){var r=t[i],o=PartnerQingyi.GetDataPartnerInfo(r);null!=o&&o.getLevel()>0?a.data={state:"partner",id:r}:a.data={state:"item",id:r}}else a.data={state:"empty",id:0}}},n.prototype.UpdateGroupLevel=function(){var e=PartnerQingyi.GetDataGroupLevel(this.selectGroupId),t=PartnerQingyi.GetLevelConfig(e);this.labelGroupLevel.text=t.name,this.levelItem1.data={groupId:this.selectGroupId,level:1,itemFlag:!1,skillFlag:!1},this.levelItem2.data={groupId:this.selectGroupId,level:2,itemFlag:!0,skillFlag:!1},this.levelItem3.data={groupId:this.selectGroupId,level:3,itemFlag:!1,skillFlag:!1},this.levelItem4.data={groupId:this.selectGroupId,level:4,itemFlag:!0,skillFlag:!1},this.levelItem5.data={groupId:this.selectGroupId,level:5,itemFlag:!1,skillFlag:!0};var n=this.GetGroupLevelValueDesc(1);this.label1to2.text=n.text,this.label1to2.textColor=n.textColor;var i=this.GetGroupLevelValueDesc(2);this.label2to3.text=i.text,this.label2to3.textColor=i.textColor;var a=this.GetGroupLevelValueDesc(3);this.label3to4.text=a.text,this.label3to4.textColor=a.textColor;var r=this.GetGroupLevelValueDesc(4);this.label4to5.text=r.text,this.label4to5.textColor=r.textColor},n.prototype.UpdateAttribute=function(){var e=PartnerQingyi.GetDataGroupLevel(this.selectGroupId),t=PartnerQingyi.GetGroupLevelAttribute(this.selectGroupId,e);this.dataListAttribute.replaceAll(t)},n.prototype.UpdateSkill=function(){var e=PartnerQingyi.GetDataSkillLevel(this.selectGroupId);this.skillLevel.text=e.toString(),this.lbabelInactivate.visible=0==e,e=0==e?1:e,this.skillName.text=PartnerQingyi.GetGroupSkillName(this.selectGroupId),this.skillDesc.textFlow=Game.HtmlTextParser.parse(PartnerQingyi.GetGroupSkillDesc(this.selectGroupId,e)),this.imgSkillIcon.source=PartnerQingyi.GetGroupSkillIcon(this.selectGroupId)},n.prototype.UpdateFightingPower=function(){this.fp=PartnerQingyi.GetGroupFightingPower(this.selectGroupId)},n.prototype.GetGroupLevelValueDesc=function(e){var t=PartnerQingyi.GetGroupLevelConfig(this.selectGroupId,e),n=PartnerQingyi.GetDataGroupLevel(this.selectGroupId),i=PartnerQingyi.GetDataQingyiValue(this.selectGroupId),a=new eui.Label;return n>e?(a.text="",a.textColor=color.WHITE):e==n?(a.text=i+"/"+t.qingyiValue,a.textColor=color.WHITE):(a.text=t.qingyiValue.toString(),a.textColor=6194297),a},n}(eui.Component);e.PartnerQingyiMain=t,__reflect(t.prototype,"UI.PartnerQingyiMain",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="PartnerQingyiMaterialItemSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.onTouchTap=function(t){switch(t.target){case this.partnerCell:("partnerLevel"==this.data.type||"partnerSkillLevel"==this.data.type)&&(PartnerQingyi.HavePartner(this.data.partnerId)?e.PartnerSimpleUI.open(this.data.partnerId):this.ShowPartnerTips())}},n.prototype.dataChanged=function(){switch(this.data.type){case"partnerLevel":this.updatePartnerLevel();break;case"partnerSkillLevel":this.updatePartnerSkillLevel();break;case"item":this.updateItem()}},n.prototype.updatePartnerLevel=function(){this.itemCell.data=null,this.itemCell.visible=!1,this.itemCell.scaleX=0,this.itemCell.scaleY=0,this.partnerCell.visible=!0,this.partnerCell.scaleX=.6,this.partnerCell.scaleY=.6;var e=PartnerQingyi.GetPartnerLevel(this.data.partnerId);this.labelCurValue.text=e.toString(),this.labelCurValue.textColor=e>=this.data.needValue?color.GREEN:color.RED,this.labelNeedValue.text=this.data.needValue.toString(),this.partnerCell.data={id:this.data.partnerId,workPos:0},this.labelCondDesc.text=lang.String("partnerqingyi msg partner level")},n.prototype.updatePartnerSkillLevel=function(){this.itemCell.data=null,this.itemCell.visible=!1,this.itemCell.scaleX=0,this.itemCell.scaleY=0,this.partnerCell.visible=!0,this.partnerCell.scaleX=.6,this.partnerCell.scaleY=.6;var e=PartnerQingyi.GetPartnerSkillLevel(this.data.partnerId);this.labelCurValue.text=e.toString(),this.labelCurValue.textColor=e>=this.data.needValue?color.GREEN:color.RED,this.labelNeedValue.text=this.data.needValue.toString(),this.partnerCell.data={id:this.data.partnerId,workPos:0},this.labelCondDesc.text=lang.String("partnerqingyi msg partner skill level")},n.prototype.updateItem=function(){this.partnerCell.data=null,this.partnerCell.visible=!1,this.partnerCell.scaleX=0,this.partnerCell.scaleY=0,this.itemCell.visible=!0,this.itemCell.scaleX=.6,this.itemCell.scaleY=.6;var e=PlayerAttribute.GetItemCount(this.data.genre,this.data.detailType);this.labelCurValue.text=e.toString(),this.labelCurValue.textColor=e>=this.data.needValue?color.GREEN:color.RED,this.labelNeedValue.text=this.data.needValue.toString(),this.itemCell.data={type:"item",content:{genre:this.data.genre,detailType:this.data.detailType}},this.labelCondDesc.text=lang.String("partnerqingyi msg item num")},n.prototype.ShowPartnerTips=function(){var t=e.ItemTips.instance;t.data={type:"item",content:{genre:8,detailType:this.data.partnerId}},UIManager.push(e.ItemTips.instance)},n}(eui.ItemRenderer);e.PartnerQingyiMaterialItem=t,__reflect(t.prototype,"UI.PartnerQingyiMaterialItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="PartnerQingyiNpcItemSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.onTouchTap=function(t){if("partner"==this.data.state&&PartnerQingyi.curMode==PartnerQingyi.MODE_SELF&&e.PartnerSimpleUI.open(this.data.id),"item"==this.data.state)switch(t.target){case this.btnCompose:PartnerQingyi.curMode==PartnerQingyi.MODE_SELF&&Partner.ApplyComposePartnerById(this.data.id)}},n.prototype.dataChanged=function(){this.currentState=this.data.state,"empty"==this.data.state?this.updateStateEmpty():"partner"==this.data.state?this.updateStatePartner():"item"==this.data.state?this.updateStateItem():console.log("partnerQingyiNpcItem invalid data.state",this.data.state)},n.prototype.updateStateEmpty=function(){},n.prototype.updateStatePartner=function(){var e=Partner.GetPartnerCfg(this.data.id);this.actor.visible=!0,this.actor.setResource(e.resource,null,null);var t=PartnerQingyi.GetDataPartnerLevel(this.data.id),n=PartnerQingyi.GetDataPartnerSkillLevel(this.data.id);this.labelLevel.text=lang.StringWithFormat("partnerqingyi level {1}",t),this.labelSkillLevel.text=lang.StringWithFormat("partnerqingyi skill level {1}",n)},n.prototype.updateStateItem=function(){var e=8,t=this.data.id,n=PlayerAttribute.GetItemCount(e,t);
PartnerQingyi.curMode==PartnerQingyi.MODE_SELF?this.itemCell.data={type:"item",content:{genre:e,detailType:t,count:n}}:this.itemCell.data={type:"item",content:{genre:e,detailType:t}};var i=Partner.CheckComposePartnerById(t);PartnerQingyi.curMode==PartnerQingyi.MODE_OTHER&&(i=!1),this.btnCompose.visible=i,this.btnCompose.scaleX=i?1:0,this.btnCompose.scaleY=i?1:0},n}(eui.ItemRenderer);e.PartnerQingyiNpcItem=t,__reflect(t.prototype,"UI.PartnerQingyiNpcItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="PartnerQingyiSkillLevelupSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.open=function(e){null==this.instance&&(this.instance=new t),this.instance.groupId=e,UIManager.pushPage(this.instance)},t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.onTouchTap=function(e){switch(e.target){default:this.close()}},t.prototype.close=function(){UIManager.pop(this)},t.prototype.onAddToStage=function(){this.mc.play(1),this.refresh()},t.prototype.onRemoveFromStage=function(){},t.prototype.refresh=function(){var e=PartnerQingyi.GetGroupSkillIcon(this.groupId),t=PartnerQingyi.GetGroupSkillName(this.groupId),n=PartnerQingyi.GetDataSkillLevel(this.groupId),i=PartnerQingyi.GetGroupSkillDesc(this.groupId,n);this.imgSkillIcon.source=e,this.skillName=t,this.skillLevel=lang.StringWithFormat("partnerqingyi level {1}",n),this.skillDesc.textFlow=Game.TextParser.parse(i)},t}(e.FitComponent);e.PartnerQingyiSkillLevelup=t,__reflect(t.prototype,"UI.PartnerQingyiSkillLevelup",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="PartnerQingyiTipsSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.open=function(e,n){null==this.instance&&(this.instance=new t),this.instance.groupId=e,this.instance.level=n,PartnerQingyi.curMode==PartnerQingyi.MODE_SELF?UIManager.pushPage(this.instance):UIManager.push(this.instance)},t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.onAddToStage=function(){this.Update()},t.prototype.onRemoveFromStage=function(){},t.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},t.prototype.Update=function(){var e=PartnerQingyi.GetLevelConfig(this.level),t=PartnerQingyi.GetGroupLevelConfig(this.groupId,this.level);this.levelName.text=e.name;var n=PartnerQingyi.GetGroupLevelAttributeDesc(this.groupId,this.level),i=null!=t.awardTips?t.awardTips:"",a=""!=i?i+", "+n:n;a.trim,this.levelAward.text=a,this.levelDesc.text=t.desc;var r=PartnerQingyi.GetDataGroupLevel(this.groupId);r>=this.level?(this.levelDesc.text=t.desc,this.levelDesc.textColor=8561525):(this.levelDesc.text=lang.String("partnerqingyi locked"),this.levelDesc.textColor=color.RED)},t}(e.FitComponent);e.PartnerQingyiTips=t,__reflect(t.prototype,"UI.PartnerQingyiTips",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.MODE_UNLOCKGROUP=1,n.MODE_SKILLLEVELUP=2,n.skinName="partnerQingyiUpSkin",n.dataListPartner=new eui.ArrayCollection,n.listPartners.dataProvider=n.dataListPartner,n.listPartners.itemRenderer=e.PartnerQingyiMaterialItem,n.dataListMaterials=new eui.ArrayCollection,n.listMaterials.dataProvider=n.dataListMaterials,n.listMaterials.itemRenderer=e.PartnerQingyiMaterialItem,n.dataListAttribute=new eui.ArrayCollection,n.listAttribute.dataProvider=n.dataListAttribute,n.listAttribute.itemRenderer=e.PartnerQingyiAttributeItem,n.dataListAwardItem=new eui.ArrayCollection,n.listAwardItem.dataProvider=n.dataListAwardItem,n.listAwardItem.itemRenderer=e.AwardCell,n.dataListAwardSkill=new eui.ArrayCollection,n.listAwardSkill.dataProvider=n.dataListAwardSkill,n.listAwardSkill.itemRenderer=e.CircleCell,n.satisfyCondUnlockGroup=!0,n.satisfyCondSkillLevelup=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n}return __extends(n,t),n.open_UnlockGroup=function(e){null==this.instance&&(this.instance=new n),this.instance.mode=this.instance.MODE_UNLOCKGROUP,this.instance.groupId=e,UIManager.pushPage(this.instance)},n.open_SkillLevelup=function(e){null==this.instance&&(this.instance=new n),this.instance.mode=this.instance.MODE_SKILLLEVELUP,this.instance.groupId=e,UIManager.pushPage(this.instance)},n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.onAddToStage=function(){this.Update(),Game.dispatcher.addEventListener(Game.EVENT.PartnerQingyiOptUnlockGroup,this.Update,this),Game.dispatcher.addEventListener(Game.EVENT.PartnerQingyiOptUpdateQingyiValue,this.Update,this),Game.dispatcher.addEventListener(Game.EVENT.PartnerQingyiOptSkillLevelup,this.Update,this),Game.dispatcher.addEventListener(Game.EVENT.PartnerDataChange,this.Update,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.PartnerQingyiOptUnlockGroup,this.Update,this),Game.dispatcher.removeEventListener(Game.EVENT.PartnerQingyiOptUpdateQingyiValue,this.Update,this),Game.dispatcher.removeEventListener(Game.EVENT.PartnerQingyiOptSkillLevelup,this.Update,this),Game.dispatcher.removeEventListener(Game.EVENT.PartnerDataChange,this.Update,this)},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnOpt:this.onClickBtn()}},n.prototype.onClickBtn=function(){if(this.mode==this.MODE_UNLOCKGROUP){if(!this.satisfyCondUnlockGroup)return void PopUpMessage.push(lang.String("partnerqingyi opt cond not satisfied"),color.RED);PartnerQingyi.UnlockGroup(this.groupId)}else if(this.mode==this.MODE_SKILLLEVELUP){if(!this.satisfyCondSkillLevelup)return void PopUpMessage.push(lang.String("partnerqingyi opt cond not satisfied"),color.RED);PartnerQingyi.SkillLevelup(this.groupId)}},n.prototype.Update=function(){if(this.mode==this.MODE_UNLOCKGROUP){var e=PartnerQingyi.GetDataSkillLevel(this.groupId);e>0&&(this.mode=this.MODE_SKILLLEVELUP)}this.mode==this.MODE_UNLOCKGROUP&&(this.satisfyCondUnlockGroup=!0,this.panel.title=PartnerQingyi.GetGroupName(this.groupId),this.btnOpt.label=lang.String("partnerqingyi panel title unlock group"),this.groupUnlockGroup.visible=!0,this.groupSkillLevelup.visible=!1,this.update_Cond_UnlockGroup(),this.update_UnlockGroup()),this.mode==this.MODE_SKILLLEVELUP&&(this.satisfyCondSkillLevelup=!0,this.panel.title=PartnerQingyi.GetGroupName(this.groupId),this.btnOpt.label=lang.String("partnerqingyi btn msg skill levelup"),this.groupUnlockGroup.visible=!1,this.groupSkillLevelup.visible=!0,this.update_Cond_SkillLevelup(),this.update_SkillLevelup())},n.prototype.update_Cond_UnlockGroup=function(){var e=PartnerQingyi.GetDataGroupLevel(this.groupId)+1,t=PartnerQingyi.GetGroupConfig(this.groupId);if(null==t)return this.dataListPartner.removeAll(),void this.dataListMaterials.removeAll();var n=PartnerQingyi.GetGroupLevelConfig(this.groupId,e);if(null==n)return this.dataListPartner.removeAll(),void this.dataListMaterials.removeAll();for(var i=t.partners,a=[],r=[],o=0;o!=n.breakConds.length;o++){var s=n.breakConds[o];if("partnerLevel"==s.type)for(var l=0;l!=s.value.length;l++){var u=i[l],c=s.value[l];a.push({type:s.type,partnerId:u,genre:0,detailType:0,needValue:c});var h=PartnerQingyi.GetPartnerLevel(u);c>h&&(this.satisfyCondUnlockGroup=!1)}if("item"==s.type){var d=s.value[0],p=s.value[1],g=s.value[2];r.push({type:s.type,partnerId:0,genre:d,detailType:p,needValue:g});var m=PlayerAttribute.GetItemCount(d,p);g>m&&(this.satisfyCondUnlockGroup=!1)}}this.dataListPartner.replaceAll(a),this.dataListMaterials.replaceAll(r)},n.prototype.update_Cond_SkillLevelup=function(){var e=PartnerQingyi.GetGroupConfig(this.groupId);if(null==e)return this.dataListPartner.removeAll(),void this.dataListMaterials.removeAll();var t=PartnerQingyi.GetDataSkillLevel(this.groupId);if(0>=t)return this.dataListPartner.removeAll(),void this.dataListMaterials.removeAll();t+=1;var n=e.groupSkillId,i=PartnerQingyi.GetSkillLevelConfig(n,t);if(null==i)return this.dataListPartner.removeAll(),void this.dataListMaterials.removeAll();for(var a=e.partners,r=[],o=[],s=0;s!=i.breakConds.length;s++){var l=i.breakConds[s];if("partnerSkillLevel"==l.type)for(var u=0;u!=l.value.length;u++){var c=a[u],h=l.value[u];r.push({type:l.type,partnerId:c,genre:0,detailType:0,needValue:h});var d=PartnerQingyi.GetPartnerSkillLevel(c);h>d&&(this.satisfyCondSkillLevelup=!1)}if("item"==l.type){var p=l.value[0],g=l.value[1],m=l.value[2];o.push({type:l.type,partnerId:0,genre:p,detailType:g,needValue:m});var f=PlayerAttribute.GetItemCount(p,g);m>f&&(this.satisfyCondSkillLevelup=!1)}}this.dataListPartner.replaceAll(r),this.dataListMaterials.replaceAll(o)},n.prototype.update_UnlockGroup=function(){var e=PartnerQingyi.GetDataGroupLevel(this.groupId),t=e+1,n=PartnerQingyi.GetLevelConfig(e),i=PartnerQingyi.GetLevelConfig(t);this.oldLevelName.text=n.name,this.newLevelName.text=i.name;var a=PartnerQingyi.GetGroupLevelConfig(this.groupId,e),r=PartnerQingyi.GetGroupLevelConfig(this.groupId,t);if(null!=r){for(var o=[],s=0;s!=r.attributeTips.length;s++){var l=null==a?null:a.attributeTips[s],u=r.attributeTips[s],c=u[0],h=null==l?0:l[1],d=u[1],p=Buff.GetName(c);o.push({attribute:p,oldValue:h,newValue:d})}this.dataListAttribute.replaceAll(o);for(var g=[],m=[],s=0;s!=r.breakAwards.length;s++){var f=r.breakAwards[s];if("item"==f.type){var v=f.value[0],y=f.value[1],b=f.value[2];g.push({type:"item",content:{genre:v,detailType:y,count:b}})}if("skillLevel"==f.type){var S=PartnerQingyi.GetGroupSkillName(this.groupId),E=PartnerQingyi.GetGroupSkillIcon(this.groupId),C=3,T=PartnerQingyi.GetGroupSkillDesc(this.groupId,1);m.push({type:"clientitem",icon:E,name:S,quality:C,desc:T,count:""})}}if(g.length<=0&&m.length<=0?this.groupAward.visible=!1:(this.groupAward.visible=!0,this.dataListAwardItem.replaceAll(g),this.dataListAwardSkill.replaceAll(m)),null!=a){this.groupQingyiValue.visible=!0;var I=PartnerQingyi.GetDataQingyiValue(this.groupId),G=a.qingyiValue;this.levelIcon.source=n.icon,this.barValue.maximum=G,this.barValue.value=I,this.barValue.labelFunction=function(e,t){return""},this.curValue.text=I.toString(),this.curValue.textColor=I>=G?color.GREEN:color.RED,this.needValue.text=G.toString(),G>I&&(this.satisfyCondUnlockGroup=!1)}else this.groupQingyiValue.visible=!1}},n.prototype.update_SkillLevelup=function(){var e=PartnerQingyi.GetGroupConfig(this.groupId);if(null!=e){var t=e.groupSkillId,n=PartnerQingyi.GetSkillType(t);switch(n){case PartnerQingyi.SKILLTYPE_TRIGGER:this.update_SkillLevelup_Trigger();break;case PartnerQingyi.SKILLTYPE_PASSIVE:this.update_SkillLevelup_Passive()}}},n.prototype.update_SkillLevelup_Trigger=function(){var e=PartnerQingyi.GetGroupSkillId(this.groupId),t=PartnerQingyi.GetSkillMaxLevel(e),n=PartnerQingyi.GetDataSkillLevel(this.groupId),i=n+1,a=PartnerQingyi.GetGroupSkillName(this.groupId);this.curSkillName.text=a,this.curSkillLevel.text=lang.StringWithFormat("{1}level",n),this.curSkillDesc.textFlow=Game.TextParser.parse(PartnerQingyi.GetGroupSkillDesc(this.groupId,n)),this.curSkillIcon.source=PartnerQingyi.GetGroupSkillIcon(this.groupId),t>=i?(this.nextSkillName.text=a,this.nextSkilLevel.text=lang.StringWithFormat("{1}level",i),this.nextSkillDesc.textFlow=Game.TextParser.parse(PartnerQingyi.GetGroupSkillDesc(this.groupId,i))):(this.nextSkillName.text=lang.String("partnerqingyi skill reach max level"),this.nextSkilLevel.text="",this.nextSkillDesc.text="")},n.prototype.update_SkillLevelup_Passive=function(){var e=PartnerQingyi.GetGroupSkillId(this.groupId),t=PartnerQingyi.GetSkillMaxLevel(e),n=PartnerQingyi.GetDataSkillLevel(this.groupId),i=n+1,a=PartnerQingyi.GetGroupSkillName(this.groupId);this.curSkillName.text=a,this.curSkillLevel.text=lang.StringWithFormat("{1}level",n),this.curSkillDesc.textFlow=Game.TextParser.parse(PartnerQingyi.GetGroupSkillDesc(this.groupId,n)),this.curSkillIcon.source=PartnerQingyi.GetGroupSkillIcon(this.groupId),t>=i?(this.nextSkillName.text=a,this.nextSkilLevel.text=lang.StringWithFormat("{1}level",i),this.nextSkillDesc.textFlow=Game.TextParser.parse(PartnerQingyi.GetGroupSkillDesc(this.groupId,i))):(this.nextSkillName.text=lang.String("partnerqingyi skill reach max level"),this.nextSkilLevel.text="",this.nextSkillDesc.text="")},n}(e.FitComponent);e.partnerQingyiUp=t,__reflect(t.prototype,"UI.partnerQingyiUp",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.MATERIALTYPE_NORMAL=1,n.MATERIALTYPE_DOUBLE=2,n.skinName="PartnerQingyiUpUseItemSkin",n.dataListDoubleItem=new eui.ArrayCollection,n.listDoubleItem.dataProvider=n.dataListDoubleItem,n.listDoubleItem.itemRenderer=e.AwardCell,n.dataListNormalItem=new eui.ArrayCollection,n.listNormalItem.dataProvider=n.dataListNormalItem,n.listNormalItem.itemRenderer=e.AwardCell,n.autoSelect=MakeDelayExecute(n.Select,n,10*Game.MSPF),n.normalMateralNum=0,n.doubleMaterialNum=0,n.curValue=0,n.needValue=0,n.bCurSelectItemDouble=!1,n.selectItemGenre=0,n.selectItemDetailType=0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.listDoubleItem.addEventListener(eui.ItemTapEvent.ITEM_TAP,n.onClickItemDouble,n),n.listNormalItem.addEventListener(eui.ItemTapEvent.ITEM_TAP,n.onClickItemNormal,n),n}return __extends(n,t),n.open=function(e){null==this.instance&&(this.instance=new n),this.instance.groupId=e,this.instance.selectItemGenre=0,this.instance.selectItemDetailType=0,UIManager.pushPage(this.instance)},n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.onAddToStage=function(){this.panel.title=PartnerQingyi.GetGroupName(this.groupId),this.Update(),this.autoSelect(),Game.dispatcher.addEventListener(Game.EVENT.PartnerQingyiOptUpdateQingyiValue,this.Update,this),Game.dispatcher.addEventListener(Game.EVENT.PartnerQingyiOptUnlockGroup,this.Update,this),Game.dispatcher.addEventListener(Game.EVENT.AddItem,this.Update,this),Game.dispatcher.addEventListener(Game.EVENT.RemoveItem,this.Update,this),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,this.Update,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.PartnerQingyiOptUpdateQingyiValue,this.Update,this),Game.dispatcher.removeEventListener(Game.EVENT.PartnerQingyiOptUnlockGroup,this.Update,this),Game.dispatcher.removeEventListener(Game.EVENT.AddItem,this.Update,this),Game.dispatcher.removeEventListener(Game.EVENT.RemoveItem,this.Update,this),Game.dispatcher.removeEventListener(Game.EVENT.UpdateItem,this.Update,this)},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnUnlockGroup:this.onClickUnlockGroup();break;case this.btnUseItem:this.onClickUseItem(!1)}},n.prototype.onClickUnlockGroup=function(){e.partnerQingyiUp.open_UnlockGroup(this.groupId)},n.prototype.onClickUseItem=function(t){var n=this;if(0==this.selectItemGenre||0==this.selectItemDetailType)return void PopUpMessage.push(lang.String("partnerqingyi please select item"),color.RED);if(this.curValue>=this.needValue)return void PopUpMessage.push(lang.String("partnerqingyi qingyi value is full"),color.RED);var i=PlayerAttribute.GetItemCount(this.selectItemGenre,this.selectItemDetailType);if(0>=i)return void PopUpMessage.push(lang.String("partnerqingyi not enough item"),color.RED);if(!t){var a=PartnerQingyi.GetMaterialAddValue(this.groupId,this.selectItemGenre,this.selectItemDetailType);if(a+this.curValue>this.needValue){var r=lang.String("operation confirm"),o=lang.String("partnerqingyi use item overflow confirm msg");return void e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],r,o,function(){return n.onClickUseItem(!0),!0},null,null)}}PartnerQingyi.UseItem(this.selectItemGenre,this.selectItemDetailType,this.groupId)},n.prototype.getMaterialType=function(e,t,n){for(var i=this.MATERIALTYPE_NORMAL,a=0;a!=n.length;a++){var r=n[a];r[0]==e&&r[1]==t&&(i=this.MATERIALTYPE_DOUBLE)}return i},n.prototype.Update=function(){this.UpdateBagItem(),this.updateSelectCell(this.bCurSelectItemDouble)},n.prototype.UpdateBagItem=function(){var e=PartnerQingyi.GetGroupConfig(this.groupId);if(null!=e){var t=PartnerQingyi.GetDataGroupLevel(this.groupId),n=PartnerQingyi.GetGroupLevelConfig(this.groupId,t),i=PartnerQingyi.GetLevelConfig(t);this.levelIcon.source=i.icon;var a=PartnerQingyi.GetDataQingyiValue(this.groupId);this.labelCurValue.text=a.toString(),this.labelNeedValue.text=n.qingyiValue.toString(),this.labelCurValue.textColor=a>=n.qingyiValue?color.GREEN:color.RED,this.barValue.maximum=n.qingyiValue,this.barValue.value=a,this.curValue=a,this.needValue=n.qingyiValue;for(var r=e.doubleMaterials,o=[],s=[],l=0;l!=PartnerQingyi.ConfigMaterialList.length;l++){var u=PartnerQingyi.ConfigMaterialList[l],c=this.getMaterialType(u.genre,u.detailType,r),h=PlayerAttribute.GetItemCount(u.genre,u.detailType);c==this.MATERIALTYPE_DOUBLE?o.push({type:"item",forbidTip:!0,content:{genre:u.genre,detailType:u.detailType,count:h}}):c==this.MATERIALTYPE_NORMAL&&s.push({type:"item",forbidTip:!0,content:{genre:u.genre,detailType:u.detailType,count:h}})}this.normalMateralNum=s.length,this.doubleMaterialNum=o.length;var d=5-o.length,p=15-s.length;if(d>0)for(var l=0;l!=d;l++)o.push(null);if(p>0)for(var l=0;l!=p;l++)s.push(null);this.dataListDoubleItem.replaceAll(o),this.dataListNormalItem.replaceAll(s)}},n.prototype.Select=function(){if(this.doubleMaterialNum>0){this.listDoubleItem.selectedIndex=0;var e=this.dataListDoubleItem.getItemAt(0);return this.selectItemGenre=e.content.genre,this.selectItemDetailType=e.content.detailType,void this.updateSelectCell(!0)}if(this.normalMateralNum>0){this.listNormalItem.selectedIndex=0;var e=this.dataListNormalItem.getItemAt(0);return this.selectItemGenre=e.content.genre,this.selectItemDetailType=e.content.detailType,void this.updateSelectCell(!1)}},n.prototype.onClickItemDouble=function(e){this.listNormalItem.selectedIndex=-1;var t=e.itemRenderer;return null==t.data?(this.selectItemGenre=0,this.selectItemDetailType=0,void this.clearSelectCell()):(this.selectItemGenre=t.data.content.genre,this.selectItemDetailType=t.data.content.detailType,void this.updateSelectCell(!0))},n.prototype.onClickItemNormal=function(e){this.listDoubleItem.selectedIndex=-1;var t=e.itemRenderer;return null==t.data?(this.selectItemGenre=0,this.selectItemDetailType=0,void this.clearSelectCell()):(this.selectItemGenre=t.data.content.genre,this.selectItemDetailType=t.data.content.detailType,void this.updateSelectCell(!1))},n.prototype.clearSelectCell=function(){this.cellSelect.clearcell(),this.updateSelectCell(this.bCurSelectItemDouble)},n.prototype.updateSelectCell=function(e){if(0!=this.selectItemGenre&&0!=this.selectItemDetailType){this.bCurSelectItemDouble=e;var t=PlayerAttribute.GetItemCount(this.selectItemGenre,this.selectItemDetailType);this.cellSelect.data={type:"item",content:{genre:this.selectItemGenre,detailType:this.selectItemDetailType,count:t}};var n=PartnerQingyi.GetMaterialAddValue(this.groupId,this.selectItemGenre,this.selectItemDetailType);this.addQingyiValue.text=lang.StringWithFormat("partnerqingyi add qingyivalue {1}",n),this.addQingyiValue.textColor=e?color.GREEN:color.WHITE}else this.addQingyiValue.text=lang.StringWithFormat("partnerqingyi add qingyivalue {1}",0),this.addQingyiValue.textColor=color.WHITE},n}(e.FitComponent);e.PartnerQingyiUpUseItem=t,__reflect(t.prototype,"UI.PartnerQingyiUpUseItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="PersonalMatchAwardSkin",n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.rankList.itemRenderer=e.PersonalMatchAwardItem,n}return __extends(n,t),n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.PersonalMatchRank,this.updateRankList,this),this.updateRankList()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.PersonalMatchRank,this.updateRankList,this)},n.prototype.updateRankList=function(){if(null!=PersonalMatchScene.rankInfo){var e=PersonalMatchScene.rankInfo.list;this.rankList.dataProvider=new eui.ArrayCollection(e)}},n}(eui.Component);e.PersonalMatchAward=t,__reflect(t.prototype,"UI.PersonalMatchAward",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="PersonalMatchAwardDescSkin",t}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(eui.Component);e.PersonalMatchAwardDesc=t,__reflect(t.prototype,"UI.PersonalMatchAwardDesc",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="PersonalMatchAwardItemSkin",t}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.dataChanged=function(){if(null!=this.data){this.faction="";var e=table.faction[this.data.faction];null!=e&&(this.faction=e.logo);var t=PersonalMatchScene.battleInfo;if(null!=t){this.data.rank<=2*PersonalMatchScene.getMatchCount()?this.currentState="1":this.currentState="0",this.flash.visible=this.data.name==Player.instance.Name,this.viewRank=PersonalMatchScene.getRankName(this.data.rank);var n=PersonalMatchScene.getMatchCount();this.data.rank<=2*n?this.data.rank<=n?this.matchId=this.data.rank:this.matchId=2*n+1-this.data.rank:this.matchId=null}}},t}(eui.ItemRenderer);e.PersonalMatchAwardItem=t,__reflect(t.prototype,"UI.PersonalMatchAwardItem")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.remainingTime=new RemainingTime,e.delayClose=MakeDelayExecute(e.close,e,4e4),e.skinName="PersonalMatchPageSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.tabBar.addEventListener(eui.ItemTapEvent.ITEM_TAP,e.onBarItemTap,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.open=function(e,t){return this.opened&&this.close(),e&&PersonalMatchScene.applyRankList(),UIManager.push(this),t&&this.delayClose(),this},n.prototype.close=function(){UIManager.pop(this)},n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},n.prototype.onAddToStage=function(){this.switchPage(0),this.tabBar.selectedIndex=0,this.opened=!0,this.onUpdateBattleStatus(),SecondTicker.addEventListener(this.onTimer,this),Game.dispatcher.addEventListener(Game.EVENT.PersonalMatchStatus,this.onEventStatus,this)},n.prototype.onRemoveFromStage=function(){this.opened=!1,SecondTicker.removeEventListener(this.onTimer,this),Game.dispatcher.removeEventListener(Game.EVENT.PersonalMatchStatus,this.onEventStatus,this)},Object.defineProperty(n.prototype,"second",{set:function(e){this.remainingTime.delta=e,this.onTimer()},enumerable:!0,configurable:!0}),n.prototype.onTimer=function(){this.leftTime=this.remainingTime.getMinuteSecond()},n.prototype.onEventStatus=function(){var e=PersonalMatchScene.battleInfo;null!=e&&1==e.status&&this.close()},n.prototype.onUpdateBattleStatus=function(){this.state=PersonalMatchScene.getStatus(),this.round=PersonalMatchScene.getMatchName(),this.second=PersonalMatchScene.notePanel.remainingTime.delta},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},n.prototype.onBarItemTap=function(e){this.switchPage(e.itemIndex)},n.prototype.switchPage=function(t){switch(t){case 0:this.view.removeChildren(),this.pageList||(this.pageList=new e.PersonalMatchAward),this.view.addChild(this.pageList);break;case 1:this.view.removeChildren(),this.pageAward||(this.pageAward=new e.PersonalMatchAwardDesc),this.view.addChild(this.pageAward)}},n}(e.FitComponent);e.PersonalMatchPage=t,__reflect(t.prototype,"UI.PersonalMatchPage",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.remainingTime=new RemainingTime,t.skinName="PersonalMatchPannelSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.prototype.getDamage=function(e){if(1e4>e)return""+e;if(1e7>e){var t=Math.floor(e/1e3);return t+"K"}var n=Math.floor(e/1e6);return n+"M"},t.prototype.onDamageChange=function(){var e=PersonalMatchScene.damage;this.updateDamage(e.mine,e.his)},t.prototype.updateDamage=function(e,t){if(null!=this.processDmg){this.groupDamage.visible=!PersonalMatchScene.isViewer(),this.groupView.visible=!this.groupDamage.visible,this.viewState="Dang quan chiến";var n=PersonalMatchScene.battleInfo;if(null!=n&&0==n.status&&(this.viewState="Dang chở tông kết"),!this.groupDamage.visible)return this.myDmg=this.getDamage(0),this.himDmg=this.getDamage(0),this.processDmg.maximum=100,void(this.processDmg.value=50);this.myDmg=this.getDamage(e),this.himDmg=this.getDamage(t),0==e&&(e=1),0==t&&(t=1);var i=e+t;this.processDmg.maximum=i,this.processDmg.value=e;var a=Math.floor(100*(e-i/2)/i);a>=0?this.winDmg="+"+a+"%":this.winDmg="-"+-a+"%"}},t.prototype.onAddToStage=function(){SecondTicker.addEventListener(this.onTimer,this),this.foldToggle.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onFoldTopGroup,this),Game.dispatcher.addEventListener(Game.EVENT.PersonalMatchStatus,this.refresh,this),Game.dispatcher.addEventListener(Game.EVENT.PersonalMatchDamageChange,this.onDamageChange,this),this.refresh()},t.prototype.onRemoveFromStage=function(){SecondTicker.removeEventListener(this.onTimer,this),this.foldToggle.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onFoldTopGroup,this),Game.dispatcher.removeEventListener(Game.EVENT.PersonalMatchStatus,this.refresh,this),Game.dispatcher.removeEventListener(Game.EVENT.PersonalMatchDamageChange,this.onDamageChange,this)},t.prototype.refresh=function(){var e=PersonalMatchScene.battleInfo;if(this.groupGuide.visible=PersonalMatchScene.isViewer(),this.btnExit.visible=!(null!=e&&e.fighting),this.onDamageChange(),null!=e){this.currentState=""+e.status,this.second=e.leftTime,this.round=PersonalMatchScene.getMatchName(),e.myRank>0?this.myRank=PersonalMatchScene.getRankName(e.myRank):this.myRank="-";for(var t=PersonalMatchScene.getMatchCount(),n=0;n<this.btnGuides.length;n++)this.btnGuides[n].visible=t>n}},Object.defineProperty(t.prototype,"second",{set:function(e){this.remainingTime.delta=e,this.onTimer()},enumerable:!0,configurable:!0}),t.prototype.onTimer=function(){this.rest=this.remainingTime.getMinuteSecond()},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnGoto0:PersonalMatchScene.applyViewMatch(1);break;case this.btnGoto1:PersonalMatchScene.applyViewMatch(2);break;case this.btnGoto2:PersonalMatchScene.applyViewMatch(3);break;case this.btnGoto3:PersonalMatchScene.applyViewMatch(4);break;case this.btnGoto4:PersonalMatchScene.applyViewMatch(5);break;case this.btnGoto5:PersonalMatchScene.applyViewMatch(6);break;case this.btnGoto6:PersonalMatchScene.applyViewMatch(7);break;case this.btnGoto7:PersonalMatchScene.applyViewMatch(8);break;case this.btnExit:PersonalMatchScene.applyLeaveScene();break;case this.btnMember:PersonalMatchScene.onOpenMembers()}},t.prototype.onFoldTopGroup=function(){this.foldToggle.selected?(Game.removeFromParent.apply(this.groupInfo),this.groupMain.right=this.foldToggle.width+5,this.groupGuide.visible=!1,this.groupDamage.visible=!1):this.groupInfo.parent!=this.groupMain&&(this.groupMain.addChildAt(this.groupInfo,1),this.groupMain.right=5,this.groupGuide.visible=PersonalMatchScene.isViewer(),this.groupDamage.visible=!PersonalMatchScene.isViewer())},t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.btnGuides=[],this.btnGuides.push(this.btnGoto0),this.btnGuides.push(this.btnGoto1),this.btnGuides.push(this.btnGoto2),this.btnGuides.push(this.btnGoto3),this.btnGuides.push(this.btnGoto4),this.btnGuides.push(this.btnGoto5),this.btnGuides.push(this.btnGoto6),this.btnGuides.push(this.btnGoto7)},t}(e.FitComponent);e.PersonalMatchPannel=t,__reflect(t.prototype,"UI.PersonalMatchPannel",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.data=[{type:"item",content:{genre:14,detailType:2022}},{type:"clientitem",icon:"icon/item/jc_my_1.png",name:"Lệnh bài Tứ Tượng",quality:3,desc:"Nguyể liệu để khắc văn trong tinh toi trang bị",count:""},{type:"clientitem",icon:"icon/client_item/exp.png",name:"Nhiều EXP",quality:2,desc:"Được nhận thưởng EXP",count:""}],n.skinName="PersonalMatchUISkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.list.itemRenderer=e.AwardCell,n}return __extends(n,t),n.prototype.onTouchTap=function(t){switch(t.target){case this.btnSign:this.onSign();break;case this.imgClose:this.close();break;case this.btnRules:e.GameTip.instance.open("personalmatch")}},n.prototype.close=function(){UIManager.pop(this)},n.prototype.onSign=function(){var e=Game.getServerDate();return e.getHours()<PersonalMatchScene.getOpenTime()?void(this.txtWarStatus=lang.StringWithFormat("tipNextWarTime",PersonalMatchScene.getOpenTimeString())):e.getHours()>PersonalMatchScene.getOpenTime()?void(this.txtWarStatus=lang.StringWithFormat("tipNextWarTime",PersonalMatchScene.getOpenTimeString()+" ngày mai")):void net.socket.write(266,null)},n.prototype.onAddToStage=function(){this.list.dataProvider=new eui.ArrayCollection(this.data),this.isSign(),Game.dispatcher.addEventListener(Game.EVENT.SongjinEnrollResult,this.onSignResult,this),this.initUiData()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.SongjinEnrollResult,this.onSignResult,this)},n.prototype.isSign=function(){1!=this.btnSign.enabled&&(PlayerAttribute.Level<SongJin.OpenLevelForCrossServer?this.btnSign.enabled=!1:this.btnSign.enabled=!0)},n.prototype.initUiData=function(){SongJin.getDefaultTaskData();this.txtWarStatus=""},n.prototype.onSignResult=function(t){if(null!=t.data){var n=t.data.code;switch(n){case 0:UIManager.pop(this),e.HUD.instance.showBattle();break;case 3:this.txtWarStatus=lang.String("levelTooLow");break;case 2:this.txtWarStatus=lang.String("haveNoTimes");break;case 1:var i=Game.getServerDate();if(i.getHours()<PersonalMatchScene.getOpenTime()){this.txtWarStatus=lang.StringWithFormat("tipNextWarTime",PersonalMatchScene.getOpenTimeString());break}if(i.getHours()>=PersonalMatchScene.getOpenTime()){this.txtWarStatus=lang.StringWithFormat("tipNextWarTime",PersonalMatchScene.getOpenTimeString()+" ngày mai");
break}break;default:this.txtWarStatus=lang.String("enrollFailed")}}},n}(e.FitComponent);e.PersonalMatchUI=t,__reflect(t.prototype,"UI.PersonalMatchUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="PartnerEquipCellSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){if(null==this.data.id||this.data.id<=0)return this.cell.icon=null==this.data.defaultIcon?"":this.data.defaultIcon,this.cell.quality=0,this.imgStar1.scaleX=0,this.imgStar2.scaleX=0,this.imgStar3.scaleX=0,this.imgStar4.scaleX=0,this.imgStar5.scaleX=0,this.imgStar6.scaleX=0,this.cell.rbcorner="",void(this.cell.lbcorner="");var e=PartnerEquipManager.GetPartnerEquipInfo(this.data.id);this.cell.icon=e.source,this.cell.quality=e.quality,this.cell.rbcorner="Cấp "+e.level,this.cell.lbcorner=this.data.enhanceLevel>0?"+"+this.data.enhanceLevel:"",this.imgStar1.source=this.data.star>=1?PartnerEquipManager.enableStar:PartnerEquipManager.disableStar,this.imgStar2.source=this.data.star>=2?PartnerEquipManager.enableStar:PartnerEquipManager.disableStar,this.imgStar3.source=this.data.star>=3?PartnerEquipManager.enableStar:PartnerEquipManager.disableStar,this.imgStar4.source=this.data.star>=4?PartnerEquipManager.enableStar:PartnerEquipManager.disableStar,this.imgStar5.source=this.data.star>=5?PartnerEquipManager.enableStar:PartnerEquipManager.disableStar,this.imgStar6.source=this.data.star>=6?PartnerEquipManager.enableStar:PartnerEquipManager.disableStar;var t=PartnerEquipManager.GetMaxStar(this.data.id);this.imgStar1.scaleX=t>=1?.6:0,this.imgStar2.scaleX=t>=2?.6:0,this.imgStar3.scaleX=t>=3?.6:0,this.imgStar4.scaleX=t>=4?.6:0,this.imgStar5.scaleX=t>=5?.6:0,this.imgStar6.scaleX=t>=6?.6:0},t}(eui.ItemRenderer);e.PartnerEquipCell=t,__reflect(t.prototype,"UI.PartnerEquipCell")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="PartnerEquipInfoSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.PartnerEquipSync,this.updatePartnerEquip,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.PartnerEquipSync,this.updatePartnerEquip,this)},n.prototype.ChangeEquip=function(){if(!(this.equipId<=0)){var t=PartnerEquipManager.GetPartnerEquipInfo(this.equipId);UIManager.pushPage(e.PartnerEquipList.instance),e.PartnerEquipList.instance.ShowEquipPos=t.part,e.PartnerEquipList.instance.SelectPartnerPos=this.partnerPos,this.close()}},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close();break;case this.btnChange:this.ChangeEquip(),this.close();break;case this.btnUpgradeStar:this.UpgradeStar()}},n.prototype.close=function(){this.panel.title="",this.equipPropOld.text="",this.equipPropNew.text="",this.equipCell.icon="",this.equipCell.quality=null,this.equipCell.rbcorner="",this.btnChange.enabled=!1,this.equipId=0,this.partnerPos=0,this.fightingPowerOld=0,this.fightingPowerNew=0,UIManager.pop(this)},n.prototype.updatePartnerEquip=function(){if(null!=this.partnerPos&&null!=this.equipId){var e=PartnerEquipManager.GetPartnerEquipInfo(this.equipId),t=PartnerEquipManager.getEquipPos(this.partnerPos),n=t[0]+e.part,i=PartnerEquipManager.partnerEquipList[n];null!=i&&this.SetPartnerEquip(i.getId(),i.getStar(),this.partnerPos)}},n.prototype.SetPartnerEquip=function(e,t,n){var i=PartnerEquipManager.GetPartnerEquipInfo(e);if(null!=i){this.equipId=e,this.curStar=t,this.partnerPos=n,this.panel.title=i.name,this.equipCell.icon=i.source,this.equipCell.quality=i.quality,this.equipCell.rbcorner="Cấp "+i.level,this.btnChange.enabled=!0;var a=PartnerEquipManager.GetMaxStar(e),r=this.curStar+1;this.equipPropOld.textFlow=Game.HtmlTextParser.parse(PartnerEquipManager.GetEquipAttributeDesc(e,this.curStar)),this.fightingPowerOld=PartnerEquipManager.GetFP(e,this.curStar),this.updateCurStar(this.curStar,a),a>=r?(this.imgArrow.scaleX=1,this.groupNewAttribute.scaleX=1,this.imgArrow.visible=!0,this.groupNewAttribute.visible=!0,this.equipPropNew.textFlow=Game.HtmlTextParser.parse(PartnerEquipManager.GetEquipAttributeDesc(e,r)),this.fightingPowerNew=PartnerEquipManager.GetFP(e,r),this.updateNextStar(r,a)):(this.imgArrow.scaleX=0,this.groupNewAttribute.scaleX=0,this.imgArrow.visible=!1,this.groupNewAttribute.visible=!1),this.btnUpgradeStar.enabled=this.curStar<a,this.updateUpgardeStarCost(e,this.curStar)}},n.prototype.updateUpgardeStarCost=function(e,t){var n=PartnerEquipManager.GetMaxStar(e),i=PartnerEquipManager.GetUpgradeStarCost(e,t);if(null==i||t>=n)return void(this.groupCost.visible=!1);this.groupCost.visible=!0;var a=PartnerEquipManager.GetMaterialGD(i[0].type,e),r=a[0],o=a[1],s=i[0].num[t],l=PlayerAttribute.GetItemCount(r,o),u=PartnerEquipManager.GetMaterialGD(i[1].type,e),c=u[0],h=u[1],d=i[1].num[t],p=PlayerAttribute.GetItemCount(c,h);this.cellCost1.data={type:"item",content:{genre:r,detailType:o},obtainId:a[2]},this.cost1.text=l+"/"+s,this.cost1.textColor=l>=s?color.GREEN:color.RED,this.cellCost2.data={type:"item",content:{genre:c,detailType:h},obtainId:u[2]},this.cost2.text=p+"/"+d,this.cost2.textColor=p>=d?color.GREEN:color.RED;var g=0>=s||0>=d?0:1;this.groupCostSplit.scaleX=g,this.groupCostSplit.scaleY=g;var m=0>=s?0:1;this.cellCost1.scaleX=m,this.cellCost1.scaleY=m,this.cost1.scaleX=m,this.cost1.scaleY=m;var f=0>=d?0:1;this.cellCost2.scaleX=f,this.cellCost2.scaleY=f,this.cost2.scaleX=f,this.cost2.scaleY=f},n.prototype.updateCurStar=function(e,t){this.imgStarOld1.source=e>=1?PartnerEquipManager.enableStar:PartnerEquipManager.disableStar,this.imgStarOld2.source=e>=2?PartnerEquipManager.enableStar:PartnerEquipManager.disableStar,this.imgStarOld3.source=e>=3?PartnerEquipManager.enableStar:PartnerEquipManager.disableStar,this.imgStarOld4.source=e>=4?PartnerEquipManager.enableStar:PartnerEquipManager.disableStar,this.imgStarOld5.source=e>=5?PartnerEquipManager.enableStar:PartnerEquipManager.disableStar,this.imgStarOld6.source=e>=6?PartnerEquipManager.enableStar:PartnerEquipManager.disableStar,this.imgStarOld1.scaleX=t>=1?1:0,this.imgStarOld2.scaleX=t>=2?1:0,this.imgStarOld3.scaleX=t>=3?1:0,this.imgStarOld4.scaleX=t>=4?1:0,this.imgStarOld5.scaleX=t>=5?1:0,this.imgStarOld6.scaleX=t>=6?1:0},n.prototype.updateNextStar=function(e,t){this.imgStarNew1.source=e>=1?PartnerEquipManager.enableStar:PartnerEquipManager.disableStar,this.imgStarNew2.source=e>=2?PartnerEquipManager.enableStar:PartnerEquipManager.disableStar,this.imgStarNew3.source=e>=3?PartnerEquipManager.enableStar:PartnerEquipManager.disableStar,this.imgStarNew4.source=e>=4?PartnerEquipManager.enableStar:PartnerEquipManager.disableStar,this.imgStarNew5.source=e>=5?PartnerEquipManager.enableStar:PartnerEquipManager.disableStar,this.imgStarNew6.source=e>=6?PartnerEquipManager.enableStar:PartnerEquipManager.disableStar,this.imgStarNew1.scaleX=t>=1?1:0,this.imgStarNew2.scaleX=t>=2?1:0,this.imgStarNew3.scaleX=t>=3?1:0,this.imgStarNew4.scaleX=t>=4?1:0,this.imgStarNew5.scaleX=t>=5?1:0,this.imgStarNew6.scaleX=t>=6?1:0},n.prototype.UpgradeStar=function(){var e=PartnerEquipManager.GetPartnerEquipInfo(this.equipId);if(null!=e&&this.checkCost(!0)){var t=PartnerEquipManager.getEquipPos(this.partnerPos),n=t[0]+e.part,i=new net.def.Index;i.index=n,net.socket.write(2051,i.toArrayBuffer())}},n.prototype.checkCost=function(t){for(var n,i=!0,a=PartnerEquipManager.GetUpgradeStarCost(this.equipId,this.curStar),r=0;r<a.length;r++){n=PartnerEquipManager.GetMaterialGD(a[r].type,this.equipId);var o=a[r].num[this.curStar],s=PlayerAttribute.GetItemCount(n[0],n[1]);if(!(s>=o)){if(i=!1,t){var l=n[2];null!=l&&e.ResourceObtain.Open([l]);var u=table.props[n[0]][n[1]];PopUpMessage.push(StringWithFormat("Thiếu: {1}",u.name),color.Warning)}break}}return i},n}(e.FitComponent);e.PartnerEquipInfo=t,__reflect(t.prototype,"UI.PartnerEquipInfo",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.equips=[],n.skinName="PartnerEquipListSkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.dataEquipList=new eui.ArrayCollection,n.__partnerPos=-1,n.equipList.itemRenderer=e.PartnerEquipCell,n.equipList.dataProvider=n.dataEquipList,n.equipList.addEventListener(eui.ItemTapEvent.ITEM_TAP,n.onClickPartnerEquip,n),n}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},n.prototype.close=function(){this.__partnerPos=-1,this.dataEquipList.removeAll(),UIManager.pop(this)},n.prototype.compare=function(e,t){var n=e.Item,i=t.Item,a=PartnerEquipManager.GetPartnerEquipInfo(n.id),r=PartnerEquipManager.GetPartnerEquipInfo(i.id);return a.quality!=r.quality?r.quality-a.quality:a.level!=r.level?r.level-a.level:i.star-n.star},Object.defineProperty(n.prototype,"ShowEquipPos",{set:function(e){0>e||(this.__showEquipPos=e,this.__partnerPos>=0&&this.updateEquipList())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"SelectPartnerPos",{set:function(e){0>e||(this.__partnerPos=e,this.__showEquipPos>=0&&this.updateEquipList())},enumerable:!0,configurable:!0}),n.prototype.updateEquipList=function(){this.equips=[];var e=PartnerEquipManager.GetPartnerEquipLevelLimit(this.__partnerPos),t=PlayerAttribute.bag.GetPartnerEquip(this.__showEquipPos);if(t.length<=0)return void PopUpMessage.push(lang.String("partnerequip no equip in this pos"),color.RED);t.sort(this.compare);for(var n=0;n!=t.length;n++){var i=t[n].Item,a=i.id,r=PartnerEquipManager.GetPartnerEquipInfo(a),o=color.GREEN;r.level>e&&(o=color.RED),this.equips.push({id:i.id,star:i.star,bagId:i.BagId,defaultIcon:"",enhanceLevel:0})}this.dataEquipList.replaceAll(this.equips)},n.prototype.onClickPartnerEquip=function(e){if(!(this.__partnerPos<0)){var t=e.itemRenderer;if(null!=t.data&&null!=t.data.id&&t.data.id>0){var n=PartnerEquipManager.GetPartnerEquipLevelLimit(this.__partnerPos),i=PartnerEquipManager.GetPartnerEquipInfo(t.data.id);if(i.level>n){var a=PartnerEquipManager.GetPartnerEquipNeedLevel(t.data.id);return void PopUpMessage.push(lang.StringWithFormat("partnerequip partner mount equip limit level{1}",a),color.RED)}var r=new net.def.C2SMountPartnerEquip;r.setPartnerIndex(this.__partnerPos),r.setEquipId(t.data.bagId),net.socket.write(229,r.toArrayBuffer()),this.close()}}},n}(e.FitComponent);e.PartnerEquipList=t,__reflect(t.prototype,"UI.PartnerEquipList",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.data=null,e.selectImg="ui/common1/btn_check2_1d1.png",e.noSelectImg="ui/common1/btn_check2_0u.png",e.skinName="PartnerEquipSplitItemSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.dataChanged=function(){null!=this.data&&(this.cell.data=this.data.item,this.imgSelect.source=this.data.selecte?this.selectImg:this.noSelectImg)},n.prototype.onTouchTap=function(e){switch(e.target){case this.cell:this.displayTips();break;default:this.selectItem()}},n.prototype.displayTips=function(){if(null!=this.data){var t=this.data.item.Item,n={type:"partnerEquip",content:{id:t.id,star:t.star}};e.ItemTips.instance.data=n,UIManager.push(e.ItemTips.instance)}},n.prototype.selectItem=function(){this.data.selecte=!this.data.selecte,this.imgSelect.source=this.data.selecte?this.selectImg:this.noSelectImg,Game.dispatcher.dispatchEventWith(Game.EVENT.PartnerEquipSplitSelectItemChange)},n}(eui.ItemRenderer);e.PartnerEquipSplitItem=t,__reflect(t.prototype,"UI.PartnerEquipSplitItem")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.array=[],e.arrayMaterial=[],e.skinName="PartnerEquipSplitUISkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.arrCheckBos=[],e.listData=new eui.ArrayCollection,e.array=[],e.listMaterialData=new eui.ArrayCollection,e.arrayMaterial=[],e.arrCheckBos.push(null),e.arrCheckBos.push(null),e.arrCheckBos.push(e.selectBlue),e.arrCheckBos.push(e.selectPurple),e.arrCheckBos.push(e.selectOrange),e.arrCheckBos.push(e.selectRed),e}return __extends(n,t),n.prototype.onAddToStage=function(){this.list.itemRenderer=e.PartnerEquipSplitItem,this.list.dataProvider=this.listData,this.listMaterial.itemRenderer=e.PartnterEquipSplitMaterialItem,this.listMaterial.dataProvider=this.listMaterialData,this.displayPartnerEquipList(),Game.dispatcher.addEventListener(Game.EVENT.AddItem,this.onItemChange,this),Game.dispatcher.addEventListener(Game.EVENT.RemoveItem,this.onItemChange,this),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,this.onItemChange,this),this.list.addEventListener(egret.Event.CHANGE,this.selectItemChange,this),Game.dispatcher.addEventListener(Game.EVENT.PartnerEquipSplitSelectItemChange,this.selectItemChange,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.AddItem,this.onItemChange,this),Game.dispatcher.removeEventListener(Game.EVENT.RemoveItem,this.onItemChange,this),Game.dispatcher.removeEventListener(Game.EVENT.UpdateItem,this.onItemChange,this),this.list.removeEventListener(egret.Event.CHANGE,this.selectItemChange,this),Game.dispatcher.removeEventListener(Game.EVENT.PartnerEquipSplitSelectItemChange,this.selectItemChange,this)},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close();break;case this.btnSplit:this.split();break;case this.selectBlue:case this.selectPurple:case this.selectOrange:case this.selectRed:this.selectQuality()}},n.prototype.close=function(){UIManager.pop(this)},n.prototype.selectQuality=function(){this.displayPartnerEquipList(),this.selectItemChange()},n.prototype.onItemChange=function(e){var t=e.data;16==t.Item.Type&&this.displayPartnerEquipList()},n.prototype.sort=function(e,t){var n=e.Item,i=t.Item,a=PartnerEquipManager.GetPartnerEquipInfo(n.id),r=PartnerEquipManager.GetPartnerEquipInfo(i.id);return n.star!=i.star?i.star-n.star:a.quality!=r.quality?r.quality-a.quality:a.level-r.level},n.prototype.displayPartnerEquipList=function(){this.array=[];var e=PlayerAttribute.bag.GetAllPartnerEquips();e.sort(this.sort);for(var t=0;t!=e.length;t++){var n=e[t].Item,i=PartnerEquipManager.GetPartnerEquipInfo(n.id);this.array.push({item:e[t],selecte:this.arrCheckBos[i.quality].selected})}this.listData.replaceAll(this.array),this.selectItemChange()},n.prototype.sortMaterial=function(e,t){return e[0]!=t[0]?e[0]-t[0]:e[1]-t[1]},n.prototype.selectItemChange=function(){for(var e=[],t=0;t!=this.listData.length;t++){var n=this.listData.getItemAt(t),i=n.item.Item;if(n.selecte){var a=PartnerEquipManager.GetSplitMaterial(i.id,i.star);if(null!=a&&a[2]>0){for(var r=!1,o=0;o!=e.length;o++)if(e[o][0]==a[0]&&e[o][1]==a[1]){e[o][2]+=a[2],r=!0;break}r||e.push(a)}}else this.arrCheckBos[i.Quality].selected=!1}e.sort(this.sortMaterial),this.arrayMaterial=[];for(var t=0;t!=e.length;t++){var a=e[t];this.arrayMaterial.push({genre:a[0],detail:a[1],num:a[2]})}this.listMaterialData.replaceAll(this.arrayMaterial)},n.prototype.getMaterialString=function(e){for(var t=[],n=0;n!=e.length;n++){var i=e[n][0],a=e[n][1],r=e[n][2],o=table.props[i][a];t.push(o.name+" x"+r)}return t},n.prototype.split=function(){for(var e=[],t=0;t!=this.listData.length;t++){var n=this.listData.getItemAt(t);n.selecte&&e.push(n.item.Id)}var i=new net.def.IndexList;i.indexs=e,net.socket.write(242,i.toArrayBuffer())},n}(e.FitComponent);e.PartnerEquipSplitUI=t,__reflect(t.prototype,"UI.PartnerEquipSplitUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="PartnerManageSkin",e.onDataChanged=MakeDelayExecute(e.updatePetlist,e,200),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.close=function(){e.PetDetail.close(),UIManager.pop(this)},n.prototype.sortPetCompound=function(e,t){var n=e.work,i=t.work;if(!guide.completed())switch(guide.info.operation){case guide.GuideOperation.GuideMountPartner:5==n&&(n=0),5==i&&(i=0);break;case guide.GuideOperation.GuideComposePartner:if(2==e.id)return-1;if(2==t.id)return 1}return n==i?5==e.work?e.quality==t.quality?t.level-e.level:t.quality-e.quality:e.curPieces>=e.maxPieces&&t.curPieces>=t.maxPieces?t.quality-e.quality:e.curPieces>=e.maxPieces?-1:t.curPieces>=t.maxPieces?1:e.quality==t.quality?t.curPieces-e.curPieces:t.quality-e.quality:n-i},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.PartnerDataChange,this.onDataChanged,this),Game.dispatcher.addEventListener(Game.EVENT.PartnerCountChange,this.onDataChanged,this),Game.dispatcher.addEventListener(Game.EVENT.PartnerWorkPosChange,this.onDataChanged,this),Game.dispatcher.addEventListener(Game.EVENT.AddItem,this.updatePieces,this),Game.dispatcher.addEventListener(Game.EVENT.RemoveItem,this.updatePieces,this),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,this.updatePieces,this),this.onDataChanged(),guide.addEventListener(guide.GuideOperation.GuideComposePartner,this.onGuideReminder,this),guide.addEventListener(guide.GuideOperation.GuideMountPartner,this.onGuideReminder,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.PartnerDataChange,this.onDataChanged,this),Game.dispatcher.removeEventListener(Game.EVENT.PartnerCountChange,this.onDataChanged,this),Game.dispatcher.removeEventListener(Game.EVENT.PartnerWorkPosChange,this.onDataChanged,this),Game.dispatcher.removeEventListener(Game.EVENT.AddItem,this.updatePieces,this),Game.dispatcher.removeEventListener(Game.EVENT.RemoveItem,this.updatePieces,this),Game.dispatcher.removeEventListener(Game.EVENT.UpdateItem,this.updatePieces,this),guide.removeEventListener(guide.GuideOperation.GuideComposePartner,this.onGuideReminder,this),guide.removeEventListener(guide.GuideOperation.GuideMountPartner,this.onGuideReminder,this),this.onDataChanged.stop()},n.prototype.updatePetlist=function(){var e=[];for(var t in table.props[8]){var n=parseInt(t),i=Partner.GetPartnerCfg(n);if(null==Partner.idMap[n])e.push({id:n,quality:i.quality,work:6,curPieces:PlayerAttribute.bag.CalcCount(8,n),maxPieces:Partner.composeCost[i.quality],guide:!1,level:-1});else{var a=Partner.GetPartnerObj(n),r=a.workPos;0==r&&(r=5),5==r&&e.push({id:n,quality:i.quality,work:r,level:a.level,curPieces:PlayerAttribute.bag.CalcCount(8,n),maxPieces:Partner.composeCost[i.quality],guide:!1})}}if(e.sort(this.sortPetCompound),!guide.completed())switch(guide.info.operation){case guide.GuideOperation.GuideMountPartner:case guide.GuideOperation.GuideComposePartner:e[0].guide=!0}var o=this.petList.dataProvider;null==o?this.petList.dataProvider=new eui.ArrayCollection(e):o.replaceAll(e);for(var s=[],l=Partner.GetOpenWorkPos(),u=0;4>u;u++){var n=Partner.workList[u];if(0!=n){var i=Partner.GetPartnerCfg(n),a=Partner.GetPartnerObj(n);s.push({id:n,quality:i.quality,work:u+1,level:a.level,curPieces:PlayerAttribute.bag.CalcCount(8,n),maxPieces:Partner.composeCost[i.quality],guide:!1})}else l>u?s.push({id:null,work:u+1,icon:"ui/forge/add_bg1.png"}):s.push({id:null,work:u+1,icon:"ui/forge/lock_bg1.png"})}var c=this.workList.dataProvider;null==c?this.workList.dataProvider=new eui.ArrayCollection(s):c.replaceAll(s)},n.prototype.updatePieces=function(e){var t=e.data.Item;if(8==t.Genre){var n=this.petList.dataProvider;if(null!=n)for(var i=0;i<n.source.length;i++)if(t.DetailType==n.source[i].id){n.source[i].curPieces=PlayerAttribute.bag.CalcCount(8,t.DetailType),n.itemUpdated(n.source[i]);break}}},n.prototype.onGuideReminder=function(){var e=this;if(this.visible){var t=guide.info.operation;(t==guide.GuideOperation.GuideComposePartner||t==guide.GuideOperation.GuideMountPartner)&&guide.pushMovie({weight:2,handle:function(){var t=e.petList.dataProvider;t.refresh()}})}},n}(e.FitComponent);e.PartnerManage=t,__reflect(t.prototype,"UI.PartnerManage",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="PartnerManageItemSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.onTouchTap=function(t){switch(t.target){case this.btnWork:this.onWork();break;case this.btnRest:this.onRest();break;case this.btnCompound:this.onCompound();break;case this.petCase:null!=this.data.id&&(UIManager.pushPage(e.PetDetail.instance),e.PetDetail.instance.open(this.data.id,this.data.work,this.data.curPieces))}},n.prototype.onWork=function(){Partner.ApplyEquipPartner(this.data.id)},n.prototype.onRest=function(){Partner.ApplyUnEquipPartner(this.data.work)},n.prototype.onCompound=function(){if(null!=Partner.GetPartnerObj(this.data.id))return PopUpMessage.push(lang.String("already has this partner"),color.RED);if(this.data.curPieces<this.data.maxPieces)return void(this.btnCompound.enabled=!1);var e=new net.def.C2SPartnerId;e.setId(this.data.id),net.socket.write(259,e.toArrayBuffer())},n.prototype.dataChanged=function(){if(this.petCfg=Partner.GetPartnerCfg(this.data.id),null==this.petCfg)return this.currentState="pet",this.labelName.text="",this.labelName.textColor=Item.QualityColor[0],this.signIcon=null,this.txtFP=null,this.txtLevel=null,this.petCase.setItem(9,this.data.icon,0,null),this.btnWork.visible=!1,this.btnRest.visible=!1,void(this.petQuality=null);if(this.data.guide)switch(guide.info.operation){case guide.GuideOperation.GuideMountPartner:guide.AddMovieClip(this.btnWork);break;case guide.GuideOperation.GuideComposePartner:guide.AddMovieClip(this.btnCompound)}else switch(guide.info.operation){case guide.GuideOperation.GuideMountPartner:guide.removeMovieClip(this.btnWork);break;case guide.GuideOperation.GuideComposePartner:guide.removeMovieClip(this.btnCompound)}switch(this.labelName.text=this.petCfg.name,this.labelName.textColor=Item.QualityColor[this.petCfg.quality],this.data.work){case 1:this.currentState="pet",this.btnRest.visible=!0,this.btnRest.enabled=!0,this.signIcon="ui/pet/captainImg.png",this.btnWork.visible=!1,this.txtFP=lang.StringWithFormat("fp:{1}",Partner.GetPower(this.data.id)),this.txtLevel=lang.StringWithFormat("level:{1}",this.data.level);break;case 2:case 3:case 4:this.currentState="pet",this.btnRest.visible=!0,this.btnRest.enabled=!0,this.signIcon="ui/pet/killImg.png",this.btnWork.visible=!1,this.txtFP=lang.StringWithFormat("fp:{1}",Partner.GetPower(this.data.id)),this.txtLevel=lang.StringWithFormat("level:{1}",this.data.level);break;case 5:Partner.GetPartnerObj(this.data.id);this.currentState="pet",this.btnRest.visible=!1,this.signIcon="",this.btnWork.visible=!0,this.btnWork.enabled=!0,this.txtFP=lang.StringWithFormat("fp:{1}",Partner.GetPower(this.data.id)),this.txtLevel=lang.StringWithFormat("level:{1}",this.data.level);break;case 6:this.currentState="pieces",this.txtFP=null,this.txtLevel=null;var e;this.data.curPieces>=this.data.maxPieces?(this.btnCompound.visible=!0,e=16250837):(this.btnCompound.visible=!1,e=15734294);var t="<font color="+e+">"+this.data.curPieces+"</font>/"+this.data.maxPieces;this.labelPieces.textFlow=Game.HtmlTextParser.parse(lang.StringWithFormat("pieces:{1}",t))}this.petQuality=Partner.getQualityIcon(this.data.quality),this.petCase.setItem(9,this.petCfg.icon,0,this.petCfg.quality)},n}(eui.ItemRenderer);e.PartnerManageItem=t,__reflect(t.prototype,"UI.PartnerManageItem")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.totalPower=0,e.itemNum={g:9,d:2,n:0,max:0},e.onDataChange=MakeDelayExecute(e.delayDataChange,e,100),e.skinName="PartnerSimpleUISkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,e.onTouchBegin,e),e}return __extends(n,t),n.open=function(e){null==this.instance&&(this.instance=new n),this.instance.selectedPetId=e,UIManager.pushPage(this.instance)},n.prototype.onAddToStage=function(){this.refreshExpItem(),this.onPartnerChange(),Game.dispatcher.addEventListener(Game.EVENT.PartnerDataChange,this.onDataChange,this),Game.dispatcher.addEventListener(Game.EVENT.PartnerWorkPosChange,this.onPartnerChange,this),Game.dispatcher.addEventListener(Game.EVENT.AddItem,this.refreshExpItem,this),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,this.refreshExpItem,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.PartnerDataChange,this.onDataChange,this),Game.dispatcher.removeEventListener(Game.EVENT.PartnerWorkPosChange,this.onPartnerChange,this),Game.dispatcher.removeEventListener(Game.EVENT.AddItem,this.refreshExpItem,this),Game.dispatcher.removeEventListener(Game.EVENT.UpdateItem,this.refreshExpItem,this),this.onDataChange.stop()},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnWashBone:UIManager.pushPage(e.PetWashBone.instance.open(this.selectedPetId));break;case this.btnBreakThrough:UIManager.pushPage(e.PetBreakThrough.instance.open(this.selectedPetId));break;case this.btnGainRes:this.GainRes()}},n.prototype.onTouchBegin=function(e){var t,n=this;switch(e.target){default:return;case this.btnLevelUp:t=function(){n.addItemNum()}}t();var i=function(){t(),n.timerId=egret.setTimeout(i,n,10)};null!=this.timerId&&egret.clearTimeout(this.timerId),this.timerId=egret.setTimeout(i,this,1e3),this.stage.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchEnd,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},n.prototype.onTouchEnd=function(e){var t=e.$currentTarget;switch(t.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchEnd,this),t.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),null!=this.timerId&&(egret.clearTimeout(this.timerId),this.timerId=null),e.target){case this.btnLevelUp:this.itemNum.n>0&&(Partner.ApplyEatExpItem(this.selectedPetId,this.itemNum.n),this.itemNum.n=0);for(var n=0;n<badge.PartnerSockets.length;n++)badge.onLight(badge.PartnerSockets[n],!1)}},n.prototype.onPartnerChange=function(){var e=Partner.GetPartnerObj(this.selectedPetId);this.showPartnerDetail(e)},n.prototype.showPartnerDetail=function(e){if(null!=e&&null!=e.id){this.groupPetDec.visible=!0,this.groupPetAttr.visible=!0,this.selectedPetId=e.id;var t=Partner.GetPartnerCfg(e.id);Partner.GetBreakthroughCfg(e.id);this.labelPetName.textFlow=Game.HtmlTextParser.parse(Partner.GetPartnerName(t)),this.petQuality=Partner.getQualityIcon(t.quality),this.selectedPetLevelLimit=Partner.GetPartnerLevelLimit(t.quality),this.petIcon.setResource(t.resource,null,null),this.totalPower=Partner.GetPower(e.id),this.lastLevel=e.level,this.petLevel=e.level,this.maxExp=Partner.GetLevelExpCfg(this.petLevel),this.curExp=e.exp,this.maxLevel=Partner.GetPartnerLevelLimit(t.quality),this.attrVal1=""+(~~(e.attr[0]*e.level/10)+t.baseAttr[0][2]+Partner.getBreakthroughAttr(e.id,e.breakthrough[0],0)),this.attrVal2=""+(~~(e.attr[1]*e.level/10)+t.baseAttr[1][2]+Partner.getBreakthroughAttr(e.id,e.breakthrough[1],1)),this.attrVal3=""+(~~(e.attr[2]*e.level/10)+t.baseAttr[2][2]+Partner.getBreakthroughAttr(e.id,e.breakthrough[2],2)),this.attrVal4=""+(~~(e.attr[3]*e.level/10)+t.baseAttr[3][2]+Partner.getBreakthroughAttr(e.id,e.breakthrough[3],3)),this.attrName1=Buff.GetName(t.baseAttr[0][0])+":",this.attrName2=Buff.GetName(t.baseAttr[1][0])+":",this.attrName3=Buff.GetName(t.baseAttr[2][0])+":",this.attrName4=Buff.GetName(t.baseAttr[3][0])+":",this.petSkillName=Partner.getSkillName(t);var n=Partner.getTalentSkillLevel(e);this.petSkillLevel=lang.StringWithFormat("{1}level",n)}else this.groupPetDec.visible=!1,this.groupPetAttr.visible=!1,this.labelPetName.text=null,this.petIcon.clear(),this.maxExp=0,this.curExp=0,this.petLevel=null,this.petQuality=null,this.selectedPetLevelLimit=0,this.attrVal1=null,this.attrVal2=null,this.attrVal3=null,this.attrVal4=null,this.attrName1=null,this.attrName2=null,this.attrName3=null,this.attrName4=null,this.petSkillName=null,this.petSkillLevel=null,this.maxLevel=null,this.selectedPetId=null,this.totalPower=null},n.prototype.refreshExpItem=function(){this.itemNum.max=PlayerAttribute.bag.CalcCount(this.itemNum.g,this.itemNum.d),this.itemNum.n>this.itemNum.max&&(this.itemNum.n=this.itemNum.max),this.expItemName.text=(this.itemNum.max-this.itemNum.n).toString(),this.itemNum.max>0?this.expItemName.textColor=16777215:this.expItemName.textColor=16711680},n.prototype.addItemNum=function(){var e=Math.min(this.itemNum.max,32767);if(this.itemNum.n>=e){var t=lang.String("partner exp item");return PopUpMessage.push(lang.StringWithFormat("item {1} not enough",t),color.RED),void(this.itemNum.n<=0&&this.GainRes())}if(this.petLevel>=PlayerAttribute.Level)return void PopUpMessage.push(lang.StringWithFormat("partner level cannot larger than player level"),color.RED);if(this.petLevel>=this.selectedPetLevelLimit)return void PopUpMessage.push(lang.StringWithFormat("partner level is full"),color.RED);this.itemNum.n++,this.refreshExpItem();var n=Partner.GetPreviewExpLevel(this.selectedPetId,this.itemNum.n);if(null!=n){this.petLevel=n.level;var i=Partner.GetLevelExpCfg(n.level);this.maxExp!=i&&(this.maxExp=i),this.curExp!=n.exp&&(this.curExp=n.exp)}},n.prototype.delayDataChange=function(){var e=Partner.GetPartnerObj(this.selectedPetId);null!=e&&(this.lastLevel<e.level&&this._onLevelUp(),this.showPartnerDetail(e),this.refreshExpItem())},n.prototype._onLevelUp=function(){},n.prototype.GainRes=function(){e.ResourceObtain.Open([e.ObtResId.partnerExpItem])},n}(e.FitComponent);e.PartnerSimpleUI=t,__reflect(t.prototype,"UI.PartnerSimpleUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="PartnterEquipSplitMaterialItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){var e=table.props[this.data.genre][this.data.detail];this.materialName.textFlow=Game.HtmlTextParser.parse(e.name),this.num=this.data.num,this.cell.data={type:"item",content:{genre:this.data.genre,detailType:this.data.detail}}},t}(eui.ItemRenderer);e.PartnterEquipSplitMaterialItem=t,__reflect(t.prototype,"UI.PartnterEquipSplitMaterialItem")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.lastLevel=9999,n._delayRefresh=MakeDelayExecute(n.refresh,n,200),n.skinName="PetBreakThroughSkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.mc=new e.MovieClipComponent,n.mc.removeWhenComplete=!1,n.mc.visible=!1,n.mc.horizontalCenter=0,n.mc.verticalCenter=0,n}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.PartnerDataChange,this.onDataChange,this),Game.dispatcher.addEventListener(Game.EVENT.AddItem,this.onDataChange,this),Game.dispatcher.addEventListener(Game.EVENT.RemoveItem,this.onDataChange,this),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,this.onDataChange,this),Game.dispatcher.addEventListener(Game.EVENT.BagItemChange,this.onDataChange,this),Game.dispatcher.addEventListener(Game.EVENT.LevelUp,this.onDataChange,this),this._delayRefresh()
},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.PartnerDataChange,this.onDataChange,this),Game.dispatcher.removeEventListener(Game.EVENT.AddItem,this.onDataChange,this),Game.dispatcher.removeEventListener(Game.EVENT.RemoveItem,this.onDataChange,this),Game.dispatcher.removeEventListener(Game.EVENT.UpdateItem,this.onDataChange,this),Game.dispatcher.removeEventListener(Game.EVENT.BagItemChange,this.onDataChange,this),Game.dispatcher.removeEventListener(Game.EVENT.LevelUp,this.onDataChange,this),this.mc.visible=!1,this.mc.stop(),this.mc.free(),this._delayRefresh.stop()},n.prototype.onDataChange=function(){this._delayRefresh()},n.prototype._onLevelUp=function(){this.mc.visible=!0,this.mc.Load("skill/Ui_mijitupo/Ui_mijitupo.json","Ui_mijitupo"),this.mc.gotoAndPlay(0,1)},n.prototype.onTouchTap=function(t){switch(t.target){case this.imgClose:this.close();break;case this.btnTrain:Partner.ApplyPartnerBreakthrough(this.selectedPetId,0,!1);break;case this.btnGainRes:e.ResourceObtain.Open([e.ObtResId.breakThroughItem])}},n.prototype.close=function(){UIManager.pop(this)},n.prototype.refresh=function(){var t=Partner.GetPartnerObj(this.selectedPetId),n=Partner.GetPartnerCfg(this.selectedPetId);if(null==t||null==n)return void UIManager.pop(this);var i=Partner.getBreakthroughLevel(t),a=~~(i/Partner.partnerBreakthroughThreshold),r=i%Partner.partnerBreakthroughThreshold;i>this.lastLevel&&(this._onLevelUp(),0==r&&UIManager.pushPage(e.SkillBreakUp.instance.open(t))),this.lastLevel=i;var o=~~(t.level/Partner.partnerBreakthroughThreshold);this.breakthroughLv=a+"/"+o;var s=Partner.getTalentSkillLevel(t),l=1,u=Partner.getMaxBreakthroughLevel(t.level);i>=u&&Partner.IsPartnerMaxLevel(t)&&(l=0);var c=Partner.getSkillName(n);if(this.petSkillName=c+" "+lang.StringWithFormat("{1}level",""+s),this.petSkillDesc.textFlow=Game.HtmlTextParser.parse(Partner.getSkillDesc(n,s,1==t.workPos,!0)),l>0?(this.petSkillNameNext=c+" "+lang.StringWithFormat("{1}level",""+(s+l)),this.petSkillDescNext.textFlow=Game.HtmlTextParser.parse(Partner.getSkillDesc(n,s+l,1==t.workPos,!0))):(this.petSkillNameNext=lang.String("None"),this.petSkillDescNext.text=""),this.imgPetSkill.source=Partner.getSkillIcon(n),null!=n.rageSkillId&&0!=n.rageSkillId){var h=Skill.mapSkill[n.rageSkillId];null!=h&&(this.imgPetSkill.source=h.icon)}var d=Partner.getBreakthroughCost(this.selectedPetId,i+10,0);if(null!=d){this.nextGroup.visible=!0,this.costPetPieces=""+d.pieces,this.costBreakthroughItem=""+d.n,this.costCopperCoin=""+d.copperCoin;var p=PlayerAttribute.currency[Game.Currency.CopperCoin];p>=d.copperCoin?this.labelHaveCopperCoin.textFlow=Game.HtmlTextParser.parse('<font color="#09e118">'+p+"</font>"):this.labelHaveCopperCoin.textFlow=Game.HtmlTextParser.parse('<font color="#f01616">'+p+"</font>");var g=PlayerAttribute.bag.CalcCount(d.g,d.d);g>=d.n?this.labelHaveBreakthroughItem.textFlow=Game.HtmlTextParser.parse('<font color="#09e118">'+g+"</font>"):this.labelHaveBreakthroughItem.textFlow=Game.HtmlTextParser.parse('<font color="#f01616">'+g+"</font>");var m=PlayerAttribute.bag.CalcCount(8,t.id);m>=d.pieces?this.labelHvePetPieces.textFlow=Game.HtmlTextParser.parse('<font color="#09e118">'+m+"</font>"):this.labelHvePetPieces.textFlow=Game.HtmlTextParser.parse('<font color="#f01616">'+m+"</font>")}else this.nextGroup.visible=!1,this.costPetPieces="0",this.costBreakthroughItem="0",this.costCopperCoin="0",this.labelHaveBreakthroughItem.text="0",this.labelHaveCopperCoin.text="0",this.labelHvePetPieces.text="0"},n.prototype.open=function(e){return this.selectedPetId=e,this.lastLevel=9999,this},n}(e.FitComponent);e.PetBreakThrough=t,__reflect(t.prototype,"UI.PetBreakThrough",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="PetCellSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){if(null==this.data)return this.icon=null,this.quality=0,this.currentState="rest",void(this.rbcorner="");if(null!=this.data.id){var e=this.data;e.workPos>0?1==e.workPos?this.currentState="captain":this.currentState="fight":this.currentState="rest";var t=Partner.GetPartnerCfg(e.id);null!=t?(this.icon=t.icon,this.quality=t.quality):(this.icon=null,this.quality=0)}else if(null!=this.data.icon)this.currentState="rest",this.icon=this.data.icon,this.quality=0;else{var e=this.data;switch(this.currentState="result",e.type){case 1:var t=table.props[e.params[0]][e.params[1]];null!=t?(this.icon=t.source,this.quality=t.quality,this.rbcorner="x"+e.params[2]):(this.icon=null,this.quality=0,this.rbcorner=null);break;case 4:var t=Partner.GetPartnerCfg(e.params[0]);null!=t?(this.icon=t.icon,this.quality=t.quality,this.rbcorner=""):(this.icon=null,this.quality=0,this.rbcorner=null)}}},t}(e.Cell);e.PetCell=t,__reflect(t.prototype,"UI.PetCell")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.totalPower=0,e.skinName="PetDetailSkin",e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.open=function(e,t,n){null!=e&&(this.pid=e,this.work=t,this.curPieces=n,this.petCfg=Partner.GetPartnerCfg(this.pid),this.petObj=Partner.GetPartnerObj(this.pid),this.onAddToStage())},n.close=function(){null!=this._instance&&Game.removeFromParent.apply(this._instance)},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnCaptain:this.onCaptain();break;case this.btnInherit:this.onInherit();break;case this.btnSellpiece:this.onSellPieces();break;case this.btnRest:this.onRest();break;case this.btnWork:this.onWork();break;case this.btnCompound:this.onCompound()}},n.prototype.onAddToStage=function(){this.labelName.text=this.petCfg.name,this.labelName.textColor=Item.QualityColor[this.petCfg.quality],this.petQuality=Partner.getQualityIcon(this.petCfg.quality),this.petCase.setItem(9,this.petCfg.icon,0,this.petCfg.quality);var e=this.petObj,t=this.petCfg;null!=e?(this.attrVal1=""+(~~(e.attr[0]*e.level/10)+t.baseAttr[0][2]+Partner.getBreakthroughAttr(e.id,e.breakthrough[0],0)),this.attrVal2=""+(~~(e.attr[1]*e.level/10)+t.baseAttr[1][2]+Partner.getBreakthroughAttr(e.id,e.breakthrough[1],1)),this.attrVal3=""+(~~(e.attr[2]*e.level/10)+t.baseAttr[2][2]+Partner.getBreakthroughAttr(e.id,e.breakthrough[2],2)),this.attrVal4=""+(~~(e.attr[3]*e.level/10)+t.baseAttr[3][2]+Partner.getBreakthroughAttr(e.id,e.breakthrough[3],3))):(this.attrVal1=""+t.baseAttr[0][2],this.attrVal2=""+t.baseAttr[1][2],this.attrVal3=""+t.baseAttr[2][2],this.attrVal4=""+t.baseAttr[3][2]),this.attrName1=Buff.GetName(t.baseAttr[0][0])+":",this.attrName2=Buff.GetName(t.baseAttr[1][0])+":",this.attrName3=Buff.GetName(t.baseAttr[2][0])+":",this.attrName4=Buff.GetName(t.baseAttr[3][0])+":";var n=Partner.getTalentSkillLevel(this.petObj);switch(this.petSkillName=Partner.getSkillName(this.petCfg)+" "+lang.StringWithFormat("{1}level",n),null!=this.petObj?this.petSkillDesc=Game.HtmlTextParser.parse(Partner.getSkillDesc(this.petCfg,Partner.getTalentSkillLevel(this.petObj),1==this.petObj.workPos,!1)):this.petSkillDesc=Game.HtmlTextParser.parse(Partner.getSkillDesc(this.petCfg,0,!1,!1)),this.work){case 1:this.currentState="caption",this.signIcon="ui/pet/captainImg.png",this.txtFP=lang.StringWithFormat("fp:{1}",Partner.GetPartnerPower(this.petObj,null)),this.txtLevel=lang.StringWithFormat("level:{1}",this.petObj.level);break;case 2:case 3:case 4:this.currentState="work",this.signIcon="ui/pet/killImg.png",this.txtFP=lang.StringWithFormat("fp:{1}",Partner.GetPartnerPower(this.petObj,null)),this.txtLevel=lang.StringWithFormat("level:{1}",this.petObj.level);break;case 5:this.currentState="pet",this.signIcon="",this.btnInherit.enabled=!(1==this.petObj.level&&0==this.petObj.exp),this.txtFP=lang.StringWithFormat("fp:{1}",Partner.GetPartnerPower(this.petObj,null)),this.txtLevel=lang.StringWithFormat("level:{1}",this.petObj.level);break;case 6:this.currentState="pieces",this.curPieces>0?this.btnSellpiece.enabled=!0:this.btnSellpiece.enabled=!1,this.btnCompound.enabled=this.curPieces>=Partner.composeCost[this.petCfg.quality],this.txtFP=lang.StringWithFormat("fp:{1}",lang.String("None")),this.txtLevel=lang.StringWithFormat("level:{1}",lang.String("None"))}},n.prototype.onRemoveFromStage=function(){this.pid=null,this.work=null,this.curPieces=null},n.prototype.onCaptain=function(){Partner.ApplyBeenCaptain(this.pid),this.close()},n.prototype.onInherit=function(){UIManager.pushPage(e.PetInherit.instance),e.PetInherit.instance.setPartnerA(this.pid),this.close()},n.prototype.onSellPieces=function(){var t=this;if(!(this.curPieces<=0)){var n=PlayerAttribute.bag.findBagItem(8,this.pid);if(null==n)return void egret.error("PetManage SellPetPieces Error "+this.pid+": IS NOT IN BAG!!");if(5==n.Item.Quality){var i=lang.String("partner sell red pieces confirm title"),a=lang.String("partner sell red pieces confirm content");e.ConfirmBox.Show(e.ConfirmBoxStyle.team,i,a,function(){return t.sellPieces(),!0},null,null)}else this.sellPieces()}},n.prototype.sellPieces=function(){if(!(this.curPieces<=0)){var e=new net.def.C2SRemoveItem,t=PlayerAttribute.bag.findBagItem(8,this.pid);if(null==t)return void egret.error("PetManage SellPetPieces Error "+this.pid+": IS NOT IN BAG!!");e.id=t.Id,e.count=t.Item.Count,net.socket.write(245,e.toArrayBuffer()),this.close()}},n.prototype.onWork=function(){Partner.ApplyEquipPartner(this.pid),this.close()},n.prototype.onRest=function(){Partner.ApplyUnEquipPartner(this.work),this.close()},n.prototype.onCompound=function(){var e=Partner.composeCost[this.petCfg.quality];if(null!=Partner.GetPartnerObj(this.pid))return PopUpMessage.push(lang.String("already has this partner"),color.RED);if(this.curPieces<e)return void(this.btnCompound.enabled=!1);var t=new net.def.C2SPartnerId;t.setId(this.pid),net.socket.write(259,t.toArrayBuffer()),this.close()},n}(e.FitComponent);e.PetDetail=t,__reflect(t.prototype,"UI.PetDetail",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.noWarn=!1,e.tabItems=[{name:"Chiêu Mộ-Thường",action:"43"},{name:"Chiêu Mộ-Cao",action:"44"},{name:"Chiêu Mộ Hạn Giờ",action:"99"}],e.skinName="PetEnlistSkin",e.onDataChange=MakeDelayExecute(e.refresh,e,100),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.onDataChange(),e.onSyncPartnerRecruitTimes(),e.tab.addEventListener(eui.ItemTapEvent.ITEM_TAP,e.onTouchTabber,e),e}return __extends(n,t),n.open=function(e){return null==this._instance&&(this._instance=new n),null!=e?this._instance.page=e:this._instance.page=0,UIManager.pushPage(this._instance),this._instance},n.close=function(){null!=this._instance&&UIManager.pop(this._instance)},n.prototype.onAddToStage=function(){this.tab.selectedIndex=this.page,this.onRefreshRecruit(),Game.dispatcher.addEventListener(Game.EVENT.PartnerRecruitCDSync,this.onRecruitCDChange,this),Game.dispatcher.addEventListener(Game.EVENT.PartnerRecruitResult,this.onPartnerRecruitResult,this),Game.dispatcher.addEventListener(Game.EVENT.SyncPartnerRecruitTimes,this.onSyncPartnerRecruitTimes,this),Game.dispatcher.addEventListener(Game.EVENT.WeekendRecruit,this.onRefreshRecruit,this),SecondTicker.addEventListener(this.onTimer,this),this._enbableButtons(!0),this.times3=Partner.freeTime,this.labelNormalTimes.text="("+this.times3+"/"+Partner.MaxFreeTime+")",this._refreshCD(),guide.addEventListener(guide.GuideOperation.GuideRecruitPartner,this.onGuideReminder,this),guide.completed()||this.playGuideMovie(guide.info.operation)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.PartnerRecruitCDSync,this.onRecruitCDChange,this),Game.dispatcher.removeEventListener(Game.EVENT.PartnerRecruitResult,this.onPartnerRecruitResult,this),Game.dispatcher.removeEventListener(Game.EVENT.SyncPartnerRecruitTimes,this.onSyncPartnerRecruitTimes,this),Game.dispatcher.removeEventListener(Game.EVENT.WeekendRecruit,this.onRefreshRecruit,this),SecondTicker.removeEventListener(this.onTimer,this),guide.removeEventListener(guide.GuideOperation.GuideRecruitPartner,this.onGuideReminder,this),this.onDataChange.stop(),Partner.recruiting=!1},n.prototype.onTouchTabber=function(){this.page=this.tab.selectedIndex,2==this.page&&badge.onLight(badge.action.WeekendRecruit,!1)},n.prototype.onSyncPartnerRecruitTimes=function(){var e=this.times1,t=this.times2;if(this.times1=Partner.restTimes1(),this.times2=Partner.restTimes2(),null==e||0>=e&&this.times1>0||e>0&&this.times1<=0){var n=Partner.checkFreeRecruitCD(1);this.btnCoperRecruit1.enabled=Partner.checkRecruitCost(1,!1)&&(n||this.times1>0),this.btnCoperRecruit10.enabled=Partner.checkRecruitCost(2,!1)&&this.times1>0}if(null==t||0>=t&&this.times2>0||t>0&&this.times2<=0){var i=Partner.checkFreeRecruitCD(3);this.btnGoldRecruit1.enabled=Partner.checkRecruitCost(3,!1)&&(i||this.times2>0),this.btnGoldRecruit10.enabled=Partner.checkRecruitCost(4,!1)&&this.times2>0}},n.prototype.onTouchTap=function(t){switch(t.target){case this.imgDesc:case this.imgDesc0:var n=new e.Rule;n.skinName="PetEnlistRulesSkin",UIManager.pushPage(n);break;case this.btnCoperRecruit1:this.onClickRecruit(1),badge.onLightPartnerEnlist(0,!1);break;case this.btnCoperRecruit10:this.onClickRecruit(2);break;case this.btnGoldRecruit1:this.onClickRecruit(3),badge.onLightPartnerEnlist(1,!1);break;case this.btnGoldRecruit10:this.onClickRecruit(4);break;case this.imgClose:this.close()}},n.prototype.onClickRecruit=function(t){var n=this;if(this.noWarn)return void(Partner.ApplyRecruitPartner(t)&&this._enbableButtons(!1));if(Partner.checkFreeRecruitCD(t))return void(Partner.ApplyRecruitPartner(t)&&this._enbableButtons(!1));var i=Partner.getRecruitPartnerCost(t);if(i.type!=Game.Currency.SilverCoin)return void(Partner.ApplyRecruitPartner(t)&&this._enbableButtons(!1));if(PlayerAttribute.currency[i.type]>=i.num)return void(Partner.ApplyRecruitPartner(t)&&this._enbableButtons(!1));var a=new e.SliverCoinPrompt;a.title=lang.String("operation confirm"),a.content=lang.StringWithFormat("if replace {1} silver with gold",i.num-PlayerAttribute.currency[i.type]),a.cb=function(e){n.noWarn=e,Partner.ApplyRecruitPartner(t)&&n._enbableButtons(!1),UIManager.pop(a)},UIManager.push(a)},n.prototype.onTimer=function(){this._refreshCD()},n.prototype._refreshCD=function(){this.times3>0?this.lalbelCD1.textFlow=Game.HtmlTextParser.parse(Partner.getFreeRecruitCDString(1)):this.lalbelCD1.text=lang.String("no partner free recutite time"),this.lalbelCD2.textFlow=Game.HtmlTextParser.parse(Partner.getFreeRecruitCDString(3)),this.refresh()},n.prototype.onRecruitCDChange=function(){this.times3=Partner.freeTime,this.labelNormalTimes.text="("+this.times3+"/"+Partner.MaxFreeTime+")",this._refreshCD()},n.prototype.onPartnerRecruitResult=function(){this.refresh()},n.prototype._enbableButtons=function(e){this.btnCoperRecruit1.enabled=e,this.btnCoperRecruit10.enabled=e,this.btnGoldRecruit1.enabled=e,this.btnGoldRecruit10.enabled=e},n.prototype.refresh=function(){if(null!=this.btnCoperRecruit1){var e=Partner.checkFreeRecruitCD(1),t=Partner.checkFreeRecruitCD(3);this.btnCoperRecruit1.enabled=Partner.checkRecruitCost(1,!1)&&(e||this.times1>0),this.btnCoperRecruit10.enabled=Partner.checkRecruitCost(2,!1)&&this.times1>0,this.btnGoldRecruit1.enabled=Partner.checkRecruitCost(3,!1)&&(t||this.times2>0),this.btnGoldRecruit10.enabled=Partner.checkRecruitCost(4,!1)&&this.times2>0,e?this.btnCoperRecruit1.label=lang.String("free recruit one time"):this.btnCoperRecruit1.label=lang.String("recruit one time"),t?this.btnGoldRecruit1.label=lang.String("free recruit one time"):this.btnGoldRecruit1.label=lang.String("recruit one time");var n=PlayerAttribute.currencyTxt[Game.Currency.CopperCoin],i=PlayerAttribute.currency[Game.Currency.GoldCoin];this.btnCoperRecruit1.enabled?this.labelLeftCoper.textFlow=Game.HtmlTextParser.parse('<font color="#279E2F">'+n+"</font>"):this.labelLeftCoper.textFlow=Game.HtmlTextParser.parse('<font color="#FF0000">'+n+"</font>"),this.btnGoldRecruit1.enabled?this.labelLeftGold.textFlow=Game.HtmlTextParser.parse('<font color="#279E2F">'+i+"</font>"):this.labelLeftGold.textFlow=Game.HtmlTextParser.parse('<font color="#FF0000">'+i+"</font>")}},n.prototype.onGuideReminder=function(){var e=this,t=guide.info.operation;t==guide.GuideOperation.GuideRecruitPartner&&guide.pushMovie({weight:2,handle:function(){guide.AddMovieClip(e.btnGoldRecruit1)}})},n.prototype.playGuideMovie=function(e){e==guide.GuideOperation.GuideRecruitPartner&&guide.AddMovieClip(this.btnGoldRecruit1)},n.prototype.onRefreshRecruit=function(){WeekendRecruit.activity.open?(this.tab.dataProvider=new eui.ArrayCollection([this.tabItems[0],this.tabItems[1],this.tabItems[2]]),this.recruitUI||(this.recruitUI=new e.WeekendRecruitUI),this.recruitUI.parent!=this.view&&this.view.addChild(this.recruitUI)):(2==this.tab.selectedIndex&&(this.tab.selectedIndex=0,this.page=0),this.tab.dataProvider=new eui.ArrayCollection([this.tabItems[0],this.tabItems[1]]),this.recruitUI&&this.recruitUI.parent==this.view&&Game.removeFromParent.apply(this.recruitUI))},n}(e.FitComponent);e.PetEnlist=t,__reflect(t.prototype,"UI.PetEnlist",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="PetEnlistCellSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){if(null==this.data)return void(this.itemname=null);var e=this.data;if(!e.state)return void(this.currentState="question");switch(this.currentState="award",this.cell.data=e.award,this.cell.onRefresh(),e.award.type){case"item":var t=table.props[e.award.content.genre][e.award.content.detailType];this.itemname=t.name;break;case"partner":var n=e.award.content,i=Partner.GetPartnerCfg(n);null!=i&&(this.itemname=i.name);break;case"fubi":e.award.content;this.itemname=lang.String(table.CurrencyAward.currency[e.award.type].name);break;case"juexueInstance":var a=e.award.content.item.BagId,r=PlayerAttribute.bag.GetItem(a);this.itemname=r.name}},t.prototype.onRefresh=function(){this.dataChanged()},t}(eui.ItemRenderer);e.PetEnlistCell=t,__reflect(t.prototype,"UI.PetEnlistCell")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.awardList=[],n.skinName="PetEnlistResultSkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.mc=new e.MovieClipComponent,n.mc.removeWhenComplete=!1,n.mc.visible=!1,n.delayClose=MakeDelayExecute(n.close,n,500),n}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onTouchTap=function(t){if(t.target instanceof e.PetEnlistCell)return void this.showCell();switch(t.target){case this.imgClose:if(this.curIdx<this.awardList.length)return void this.showCell();this.imgClose.touchEnabled=!1,this.delayClose()}},n.prototype.showCell=function(){var e=this.awardList[this.curIdx].state;if(!e){this.showIdx=this.curIdx;var t=this.group.getChildAt(this.showIdx);this.showEffect(t.x,t.y),this.showAward(),this.curIdx+=1}},n.prototype.close=function(){UIManager.pop(this)},n.prototype.onAddToStage=function(){this.touchChildren=!1,this.mc.Load("skill/Ui_qianghua01/Ui_qianghua01.json","Ui_qianghua01"),this.a2.addEventListener(egret.Event.COMPLETE,this.onTweenGroupComplete,this),this.a2.play(0),this.curIdx=0},n.prototype.onRemoveFromStage=function(){this.a2.removeEventListener(egret.Event.COMPLETE,this.onTweenGroupComplete,this),this.delayClose.stop(),this.a2.play(0),this.a2.stop(),this.mc.stop(),this.mc.visible=!1,this.mc.free(),this.awardList=[],this.curIdx=0,this.imgClose.touchEnabled=!0},n.prototype.refresh=function(){var e=this.ResultAwardList;this.awardList=[];for(var t,n=0;n<e.length;n++)switch(e[n].type){case 1:t={type:"item",content:{genre:e[n].params[0],detailType:e[n].params[1],count:e[n].params[2]}},this.awardList.push({award:t,idx:n,state:!1});break;case 4:t={type:"partner",content:e[n].params[0]},this.awardList.push({award:t,idx:n,state:!1});break;case 3:t={type:Game.currency2AwardType[e[n].params[0]],content:e[n].params[1]},this.awardList.push({award:t,idx:n,state:!1});break;case 10:var i=PlayerAttribute.bag.GetItem(e[n].params[0]);t={type:"juexueInstance",content:{item:i,juexues:PlayerAttribute.juexues}},this.awardList.push({award:t,idx:n,state:!1})}for(var a=this.group.numChildren,n=0;a>n;n++){var r=this.group.getChildAt(n);r.data=this.awardList[n],r.onRefresh()}},n.prototype.showAward=function(){if(null!=this.showIdx&&!(this.showIdx>this.group.numChildren-1)){var t=this.group.getChildAt(this.showIdx);this.awardList[this.showIdx].state=!0,t.data=this.awardList[this.showIdx],t.onRefresh(),4==this.ResultAwardList[this.showIdx].type&&UIManager.push(e.PetEnlistShow.instance.show(this.showIdx))}},n.prototype.showEffect=function(e,t){this.mc.x=e-6,this.mc.y=t+10,this.mc.gotoAndPlay(0,1),this.group1.getChildIndex(this.mc)<0&&this.group1.addChild(this.mc)},n.prototype.onTweenGroupComplete=function(){this.touchChildren=!0,this.refresh()},n.prototype.updateAwards=function(e){this.ResultAwardList=e},n}(e.FitComponent);e.PetEnlistResult=t,__reflect(t.prototype,"UI.PetEnlistResult",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t._delayRefresh=MakeDelayExecute(t.refresh,t,100),t.skinName="PetEnlistShowSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.ani.addEventListener(egret.Event.COMPLETE,t.onTweenGroupComplete,t),t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.close=function(){UIManager.pop(this)},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnBack:case this.imgClose:this.bClose&&this.close()}},t.prototype.onRemoveFromStage=function(){this.ani.play(0),this.ani.stop(),this.bClose=!1},t.prototype.playMc=function(e){switch(e){case 2:this.currentState="q2";break;case 3:this.currentState="q3";break;case 4:this.currentState="q4";break;case 5:this.currentState="q5"}},t.prototype.show=function(e){return 0>e?(UIManager.pop(this),this):(this.partnerAwardIndex=e,this._delayRefresh(),this)},t.prototype.refresh=function(){var e=Partner.getLastRecruitAward(this.partnerAwardIndex);if(null==e||4!=e.type)return void UIManager.pop(this);var t=Partner.GetPartnerCfg(e.params[0]),n=e.params[1];this.petName=t.name,this.playMc(t.quality),this.bClose=!1,this.ani.play(0),this.petIcon.setResource(t.resource,null,null),this.groupPieces.visible=0!=n,this.pieces=lang.StringWithFormat("duplicate partner to {1} pieces",n),this.petSkillName=Partner.getSkillName(t),this.labelSkillDesc.textFlow=Game.HtmlTextParser.parse(Partner.getSkillDesc(t,1,!0,!1))},t.prototype.onTweenGroupComplete=function(){this.bClose=!0},t}(e.FitComponent);e.PetEnlistShow=t,__reflect(t.prototype,"UI.PetEnlistShow",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="PetInheritSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.showPartnerA(),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onAddToStage=function(){},n.prototype.onRemoveFromStage=function(){this.partnerAId=0,this.partnerBId=0,this.partnerAName="",this.partnerAExp=0,this.partnerBName="",this.partnerBCurLevel=0,this.partnerBNewLevel=0,this.currentState="choose"},n.prototype.setPartnerA=function(e){this.partnerAId=e,this.showPartnerA(),this.currentState="choose"},n.prototype.setPartnerB=function(t){this.currentState="inherit",this.partnerBId=t,this.partnerBItem.setPartner(t),UIManager.pop(e.PetInheritList.instance);var n=Partner.GetPartnerCfg(this.partnerBId),i=Partner.GetPartnerObj(this.partnerBId);if(null!=n&&null!=i){this.partnerBName=n.name;var a=Partner.calcInheritPreview(this.partnerAId,this.partnerBId);null!=a&&(this.partnerAExp=a.exp,this.partnerBCurLevel=a.curLevel,this.partnerBNewLevel=a.newLevel)}},n.prototype.showPartnerA=function(){if(null!=this.partnerAItem&&this.partnerAId>0){this.partnerAItem.setPartner(this.partnerAId),this.partnerAItem.touchEnabled=!1;var e=Partner.GetPartnerCfg(this.partnerAId),t=Partner.GetPartnerObj(this.partnerAId);if(null==e||null==t)return;this.partnerAName=e.name}},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close();break;case this.btnSelectPartner:this.onSelectPartner();break;case this.btnInherit:this.onInherit()}},n.prototype.close=function(){UIManager.pop(this)},n.prototype.onInherit=function(){var t=this;if(!(this.partnerAId<=0||this.partnerBId<=0)){var n=lang.String("partner inherit confirm box title"),i=lang.StringWithFormat("partner inherit confirm box content after inherit {1} will remove",this.partnerAName);e.ConfirmBox.Show(e.ConfirmBoxStyle.team,n,i,function(){var e=new net.def.C2SPartnerInherit;return e.partnerAId=t.partnerAId,e.partnerBId=t.partnerBId,net.socket.write(228,e.toArrayBuffer()),UIManager.pop(t),!0},null,null)}},n.prototype.onSelectPartner=function(){return Partner.getWorkPartnerCount()<=0?void PopUpMessage.push(lang.String("partner inherit need working partner"),color.RED):void UIManager.push(e.PetInheritList.instance)},n}(e.FitComponent);e.PetInherit=t,__reflect(t.prototype,"UI.PetInherit",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="PetInheritCellSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.showPartner(),e}return __extends(n,t),n.prototype.setPartner=function(e){this.partnerId=e,this.showPartner()},n.prototype.showPartner=function(){if(null!=this.petCase&&this.partnerId>0){var e=Partner.GetPartnerCfg(this.partnerId),t=Partner.GetPartnerObj(this.partnerId);if(null==e||null==t)return;this.partnerName=e.name,this.partnerLevel=t.level,this.petCase.setItem(9,e.icon,0,e.quality)}},n.prototype.dataChanged=function(){this.setPartner(this.data.id)},n.prototype.onTouchTap=function(){null!=this.data&&null!=this.data.id&&this.data.id>0?e.PetInherit.instance.setPartnerB(this.data.id):UIManager.push(e.PetInheritList.instance)},n}(eui.ItemRenderer);e.PetInheritCell=t,__reflect(t.prototype,"UI.PetInheritCell")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="PetInheritListSkin",n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.dataWorkPartnerList=new eui.ArrayCollection,n.petList.itemRenderer=e.PetInheritCell,n.petList.dataProvider=n.dataWorkPartnerList,n}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onAddToStage=function(){this.dataWorkPartnerList.removeAll();for(var e=0;e<Partner.workList.length;e++)Partner.workList[e]>0&&this.dataWorkPartnerList.addItem({id:Partner.workList[e]});this.dataWorkPartnerList.refresh()},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:UIManager.pop(this)}},n}(e.FitComponent);e.PetInheritList=t,__reflect(t.prototype,"UI.PetInheritList",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;n.array=[],n.totalPower=0,n.itemNum={g:9,d:2,n:0,max:0},n.onSelectedPartner=MakeDelayExecute(n.delaySelectPartner,n,100),n.onDataChange=MakeDelayExecute(n.delayDataChange,n,100),n.autoEnhace=!1,n.autoEnhanceList=[],n.skinName="PetUISkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.addEventListener(egret.TouchEvent.TOUCH_BEGIN,n.onTouchBegin,n),n.mc=new e.MovieClipComponent,n.mc.verticalCenter=-70,n.mc.horizontalCenter=0,n.mc.removeWhenComplete=!1,n.equipmcList=[];for(var i=0;i!=PartnerEquipManager.PartnerEquipPart.EquipCount;i++){var a=new e.MovieClipComponent;a.removeWhenComplete=!1,a.position="TL",a.x=51+418*(i%2),a.y=215+89*~~(i/2),a.visible=!1,n.equipmcList.push(a)}n.partnermcList=[];for(var i=0;i!=Partner.maxWorkPartnerCnt;i++){var r=new e.MovieClipComponent;r.removeWhenComplete=!1,r.position="TL",r.x=155+70*i,r.y=573,r.scaleX=.7,r.scaleY=.7,r.visible=!1,n.partnermcList.push(r)}n.petList.addEventListener(eui.ItemTapEvent.ITEM_TAP,n.onClickItem,n),n.equipList.addEventListener(eui.ItemTapEvent.ITEM_TAP,n.onClickPartnerEquip,n),n.mc.visible=!1,n.groupPetDec.addChild(n.mc),n.equipList.itemRenderer=e.PartnerEquipCell;for(var i=0;i!=n.equipmcList.length;i++)n.addChild(n.equipmcList[i]);for(var i=0;i!=Partner.maxWorkPartnerCnt;i++)n.addChild(n.partnermcList[i]);return n}return __extends(n,t),n.prototype.onAddToStage=function(){WorldLine.IsOpen("PartnerEquip")||Game.removeFromParent.apply(this.equipList),WorldLine.IsOpen("PartnerEquip")&&WorldLine.IsOpen("PartnerEquipEnahnce")||(Game.removeFromParent.apply(this.btnSplitPartnerEquip),Game.removeFromParent.apply(this.autoMountEquip),Game.removeFromParent.apply(this.btnEnhance)),this.updateWorkPos(),this.onSelectedPartner(),this.refreshExpItem(),Game.dispatcher.addEventListener(Game.EVENT.PartnerDataChange,this.onDataChange,this),Game.dispatcher.addEventListener(Game.EVENT.PartnerWorkPosChange,this.onPartnerChange,this),Game.dispatcher.addEventListener(Game.EVENT.AddItem,this.refreshExpItem,this),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,this.refreshExpItem,this),Game.dispatcher.addEventListener(Game.EVENT.UpdateVip,this.updateWorkPos,this),Game.dispatcher.addEventListener(Game.EVENT.LevelUp,this.updateWorkPos,this),Game.dispatcher.addEventListener(Game.EVENT.PartnerEquipSync,this.updatePartnerEquip,this),Game.dispatcher.addEventListener(Game.EVENT.PartnerEquipEnhanceSync,this.onEnhanceSuccess,this),guide.completed()||this.playGuideMovie(guide.info.operation),guide.addEventListener(guide.GuideOperation.GuideBreakThoughtPartner,this.onGuideReminder,this),guide.addEventListener(guide.GuideOperation.GuideLevelUpPartner,this.onGuideReminder,this),guide.addEventListener(guide.GuideOperation.GuideMountPartner,this.onGuideReminder,this),guide.addEventListener(guide.GuideOperation.GuideResetPartner,this.onGuideReminder,this),guide.addEventListener(guide.GuideOperation.GuideComposePartner,this.onGuideReminder,this),this.onAddToStage_Enhance()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.PartnerDataChange,this.onDataChange,this),Game.dispatcher.removeEventListener(Game.EVENT.PartnerWorkPosChange,this.onPartnerChange,this),Game.dispatcher.removeEventListener(Game.EVENT.AddItem,this.refreshExpItem,this),Game.dispatcher.removeEventListener(Game.EVENT.UpdateItem,this.refreshExpItem,this),Game.dispatcher.removeEventListener(Game.EVENT.UpdateVip,this.updateWorkPos,this),Game.dispatcher.removeEventListener(Game.EVENT.LevelUp,this.updateWorkPos,this),Game.dispatcher.removeEventListener(Game.EVENT.PartnerEquipSync,this.updatePartnerEquip,this),Game.dispatcher.removeEventListener(Game.EVENT.PartnerEquipEnhanceSync,this.onEnhanceSuccess,this),guide.removeEventListener(guide.GuideOperation.GuideBreakThoughtPartner,this.onGuideReminder,this),guide.removeEventListener(guide.GuideOperation.GuideLevelUpPartner,this.onGuideReminder,this),guide.removeEventListener(guide.GuideOperation.GuideMountPartner,this.onGuideReminder,this),guide.removeEventListener(guide.GuideOperation.GuideResetPartner,this.onGuideReminder,this),guide.removeEventListener(guide.GuideOperation.GuideComposePartner,this.onGuideReminder,this),this.mc.visible=!1,this.mc.stop(),this.mc.free(),this.onSelectedPartner.stop(),this.onDataChange.stop(),this.imgWash.visible=!1,this.imgBreak.visible=!1,this.stopAutoEnhance()
},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnWashBone:this.stopAutoEnhance(),UIManager.pushPage(e.PetWashBone.instance.open(this.selectedPetId)),this.imgWash.visible=!1;break;case this.btnBreakThrough:this.stopAutoEnhance(),UIManager.pushPage(e.PetBreakThrough.instance.open(this.selectedPetId)),this.imgBreak.visible=!1;break;case this.btnGainRes:this.stopAutoEnhance(),this.GainRes();break;case this.btnRules:this.stopAutoEnhance();var n=new e.Rule;n.skinName="PetRulesSkin",UIManager.pushPage(n);break;case this.btnPetManage:this.stopAutoEnhance(),UIManager.pushPage(e.PartnerManage.instance),badge.onLight(badge.action.PartnerComPose,!1);break;case this.autoMountEquip:this.stopAutoEnhance(),PartnerEquipManager.AutoMountPartnerEquip(this.petList.selectedIndex);break;case this.btnSplitPartnerEquip:this.stopAutoEnhance(),UIManager.push(new e.PartnerEquipSplitUI);break;case this.btnBeenLeader:this.stopAutoEnhance(),Partner.ApplyBeenCaptain(this.selectedPetId);break;case this.btnEnhance:if(this.stopAutoEnhance(),!PartnerEquipEnhance.openFlag){PopUpMessage.push(lang.String("partnerequip enhance not open"),color.RED);break}this.autoEnhace=!0,null!=this.enhanceTimer&&(egret.clearTimeout(this.enhanceTimer),this.enhanceTimer=null),this.autoEnhance()}},n.prototype.onTouchBegin=function(e){var t=this;this.stopAutoEnhance();var n;switch(e.target){default:return;case this.btnLevelUp:n=function(){t.addItemNum()}}n();var i=function(){n(),t.timerId=egret.setTimeout(i,t,10)};null!=this.timerId&&egret.clearTimeout(this.timerId),this.timerId=egret.setTimeout(i,this,1e3),this.stage.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchEnd,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},n.prototype.onTouchEnd=function(e){var t=e.$currentTarget;switch(t.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchEnd,this),t.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),null!=this.timerId&&(egret.clearTimeout(this.timerId),this.timerId=null),e.target){case this.btnLevelUp:this.itemNum.n>0&&(Partner.ApplyEatExpItem(this.selectedPetId,this.itemNum.n),this.itemNum.n=0);for(var n=0;n<badge.PartnerSockets.length;n++)badge.onLight(badge.PartnerSockets[n],!1);this.imgLevelUp.visible=!1}},n.prototype.doSelectPartner=function(){for(var e=this.petList.selectedIndex,t=0;4>t;t++)if(0!=Partner.workList[t]){var n=Partner.GetPartnerObj(Partner.workList[t]);if(n.level<=PlayerAttribute.Level){e=t,this.lastLevel=n.level;break}}return e},n.prototype.updateWorkPos=function(){for(var e=[],t=Partner.GetOpenWorkPos(),n=0;4>n;n++)0!=Partner.workList[n]?e.push(Partner.GetPartnerObj(Partner.workList[n])):t>n?e.push({id:null,icon:"ui/forge/add_bg1.png"}):e.push({id:null,icon:"ui/forge/lock_bg1.png"});var i=this.petList.dataProvider;return i?i.replaceAll(e):this.petList.dataProvider=new eui.ArrayCollection(e),e},n.prototype.onPartnerChange=function(){this.updateWorkPos();var e=Partner.GetPartnerObj(Partner.workList[this.petList.selectedIndex]);this.showPartnerDetail(e)},n.prototype.delaySelectPartner=function(e){null==e&&(e=this.doSelectPartner()),this.petList.selectedIndex=e;var t=Partner.GetPartnerObj(Partner.workList[e]);this.showPartnerDetail(t),this.updatePartnerEquip(),this.updateEnhanceData()},n.prototype.showPartnerDetail=function(e){if(null!=e&&null!=e.id){this.groupPetDec.visible=!0,this.groupPetAttr.visible=!0,this.btnBeenLeader.enabled=e.workPos>1,this.selectedPetId=e.id;var t=Partner.GetPartnerCfg(e.id);Partner.GetBreakthroughCfg(e.id);this.labelPetName.textFlow=Game.HtmlTextParser.parse(Partner.GetPartnerName(t)),this.petQuality=Partner.getQualityIcon(t.quality),this.selectedPetLevelLimit=Partner.GetPartnerLevelLimit(t.quality),this.petIcon.setResource(t.resource,null,null),this.totalPower=Partner.GetPower(e.id)+PartnerEquipManager.GetPartnerEquipFightingPower(this.petList.selectedIndex)+PartnerEquipEnhance.GetFightingPower2(this.petList.selectedIndex),this.lastLevel=e.level,this.petLevel=e.level,this.maxExp=Partner.GetLevelExpCfg(this.petLevel),this.curExp=e.exp,this.maxLevel=Partner.GetPartnerLevelLimit(t.quality),this.attrVal1=""+(~~(e.attr[0]*e.level/10)+t.baseAttr[0][2]+Partner.getBreakthroughAttr(e.id,e.breakthrough[0],0)),this.attrVal2=""+(~~(e.attr[1]*e.level/10)+t.baseAttr[1][2]+Partner.getBreakthroughAttr(e.id,e.breakthrough[1],1)),this.attrVal3=""+(~~(e.attr[2]*e.level/10)+t.baseAttr[2][2]+Partner.getBreakthroughAttr(e.id,e.breakthrough[2],2)),this.attrVal4=""+(~~(e.attr[3]*e.level/10)+t.baseAttr[3][2]+Partner.getBreakthroughAttr(e.id,e.breakthrough[3],3)),this.attrName1=Buff.GetName(t.baseAttr[0][0])+":",this.attrName2=Buff.GetName(t.baseAttr[1][0])+":",this.attrName3=Buff.GetName(t.baseAttr[2][0])+":",this.attrName4=Buff.GetName(t.baseAttr[3][0])+":";var n=PartnerEquipEnhance.getPartnerEnhanceAttribute(e.workPos-1),i=n[t.baseAttr[0][0]];null!=i&&i>0?this.attrEnhanceVal1="+"+i:this.attrEnhanceVal1=null;var a=n[t.baseAttr[1][0]];null!=a&&a>0?this.attrEnhanceVal2="+"+a:this.attrEnhanceVal2=null;var r=n[t.baseAttr[2][0]];null!=r&&r>0?this.attrEnhanceVal3="+"+r:this.attrEnhanceVal3=null;var o=n[t.baseAttr[3][0]];null!=o&&o>0?this.attrEnhanceVal4="+"+o:this.attrEnhanceVal4=null,this.petSkillName=Partner.getSkillName(t);var s=Partner.getTalentSkillLevel(e);this.petSkillLevel=lang.StringWithFormat("{1}level",s)}else this.groupPetDec.visible=!1,this.groupPetAttr.visible=!1,this.labelPetName.text=null,this.petIcon.clear(),this.maxExp=0,this.curExp=0,this.petLevel=null,this.petQuality=null,this.selectedPetLevelLimit=0,this.btnBeenLeader.enabled=!1,this.attrVal1=null,this.attrVal2=null,this.attrVal3=null,this.attrVal4=null,this.attrName1=null,this.attrName2=null,this.attrName3=null,this.attrName4=null,this.attrEnhanceVal1=null,this.attrEnhanceVal2=null,this.attrEnhanceVal3=null,this.attrEnhanceVal4=null,this.petSkillName=null,this.petSkillLevel=null,this.maxLevel=null,this.selectedPetId=null,this.totalPower=null},n.prototype.onClickItem=function(t){var n=t.itemRenderer;null!=n.data&&null!=n.data.id&&(this.lastLevel=n.data.level,n.data.id!=this.selectedPetId&&(this.imgWash.visible=!1,this.imgBreak.visible=!1)),this.showPartnerDetail(n.data),this.refreshExpItem(),this.imgLevelUp.visible=badge.blackboard[badge.PartnerSockets[this.petList.selectedIndex]];var i=Partner.GetOpenWorkPos();if(null==n.data.id&&this.petList.selectedIndex<i)UIManager.pushPage(e.PartnerManage.instance),badge.onLight(badge.action.PartnerComPose,!1);else if(this.petList.selectedIndex>=i){var a=Partner.WorkPosLevel[this.petList.selectedIndex],r=Partner.WorkPosVIP[this.petList.selectedIndex];PopUpMessage.push(lang.StringWithFormat("unlock:level{1} or vip{2}",a,r),color.GREEN)}this.updatePartnerEquip(),this.updateEnhanceData()},n.prototype.refreshExpItem=function(){this.itemNum.max=PlayerAttribute.bag.CalcCount(this.itemNum.g,this.itemNum.d),this.itemNum.n>this.itemNum.max&&(this.itemNum.n=this.itemNum.max),this.expItemName.text=(this.itemNum.max-this.itemNum.n).toString(),this.itemNum.max>0?this.expItemName.textColor=16777215:this.expItemName.textColor=16711680},n.prototype.addItemNum=function(){var e=Math.min(this.itemNum.max,32767);if(this.itemNum.n>=e){var t=lang.String("partner exp item");return PopUpMessage.push(lang.StringWithFormat("item {1} not enough",t),color.RED),void(this.itemNum.n<=0&&this.GainRes())}if(this.petLevel>=PlayerAttribute.Level)return void PopUpMessage.push(lang.StringWithFormat("partner level cannot larger than player level"),color.RED);if(this.petLevel>=this.selectedPetLevelLimit)return void PopUpMessage.push(lang.StringWithFormat("partner level is full"),color.RED);this.itemNum.n++,this.refreshExpItem();var n=Partner.GetPreviewExpLevel(this.selectedPetId,this.itemNum.n);if(null!=n){this.petLevel=n.level;var i=Partner.GetLevelExpCfg(n.level);this.maxExp!=i&&(this.maxExp=i),this.curExp!=n.exp&&(this.curExp=n.exp)}},n.prototype.delayDataChange=function(){this.updateWorkPos();var e=Partner.GetPartnerObj(this.selectedPetId);null!=e&&(this.lastLevel<e.level&&(this._onLevelUp(),~~(e.level/10)-~~(this.lastLevel/10)>0&&(PlayerAttribute.Level>=Partner.BreakThroughLimitLevel&&(this.imgBreak.visible=!0),this.imgWash.visible=!0)),this.showPartnerDetail(e),this.refreshExpItem(),this.updatePartnerEquip())},n.prototype._onLevelUp=function(){this.mc.visible=!0,this.mc.Load("skill/Ui_petup/Ui_petup.json","Ui_petup"),this.mc.gotoAndPlay(0,1)},n.prototype.GainRes=function(){e.ResourceObtain.Open([e.ObtResId.partnerExpItem])},n.prototype.onGuideReminder=function(){var e=this;if(this.visible){var t=guide.info.operation;guide.pushMovie({weight:1,handle:function(){e.playGuideMovie(t)}})}},n.prototype.playGuideMovie=function(e){var t;switch(e){case guide.GuideOperation.GuideBreakThoughtPartner:t=this.btnBreakThrough;break;case guide.GuideOperation.GuideLevelUpPartner:t=this.btnLevelUp;break;case guide.GuideOperation.GuideMountPartner:t=this.btnPetManage;break;case guide.GuideOperation.GuideResetPartner:t=this.btnWashBone;break;case guide.GuideOperation.GuideComposePartner:t=this.btnPetManage;break;default:return}guide.AddMovieClip(t)},n.prototype.updatePartnerEquip=function(){if(!(this.petList.selectedIndex<0)){var e=PartnerEquipManager.getEquipPos(this.petList.selectedIndex),t=e[0],i=e[1];this.array=[];for(var a=t;a!=i;a++){var r=PartnerEquipManager.partnerEquipList[a];if(r.getId()>0){var o=(PartnerEquipManager.GetPartnerEquipInfo(r.getId()),PartnerEquipEnhance.getEnhanceLevel(a));this.array[a-t]={id:r.getId(),star:r.getStar(),bagId:0,defaultIcon:"",enhanceLevel:o}}else this.array[a-t]={id:0,star:0,bagId:0,defaultIcon:n.defaultIcon[a-t],enhanceLevel:0}}var s=this.equipList.dataProvider;null==s?this.equipList.dataProvider=new eui.ArrayCollection(this.array):s.replaceAll(this.array),this.onPartnerChange(),this.showPartnerEquipEffect()}},n.prototype.showPartnerEquipEffect=function(){for(var e=0;e!=PartnerEquipManager.showEffectPart.length;e++){var t=PartnerEquipManager.showEffectPart[e],n=this.equipmcList[t];n.Load("skill/Ui_qianghua01/Ui_qianghua01.json","Ui_qianghua01"),n.gotoAndPlay(0,1),n.visible=!0}PartnerEquipManager.showEffectPart=[];for(var e=0;e!=PartnerEquipManager.showEffectPartner.length;e++){var i=PartnerEquipManager.showEffectPartner[e],n=this.partnermcList[i];n.Load("skill/Ui_qianghua01/Ui_qianghua01.json","Ui_qianghua01"),n.gotoAndPlay(0,1),n.visible=!0}PartnerEquipManager.showEffectPartner=[]},n.prototype.onClickPartnerEquip=function(t){var n=t.itemRenderer;null!=n.data&&null!=n.data.id&&n.data.id>0?(UIManager.pushPage(e.PartnerEquipInfo.instance),e.PartnerEquipInfo.instance.SetPartnerEquip(n.data.id,n.data.star,this.petList.selectedIndex)):(UIManager.pushPage(e.PartnerEquipList.instance),e.PartnerEquipList.instance.ShowEquipPos=this.equipList.selectedIndex,e.PartnerEquipList.instance.SelectPartnerPos=this.petList.selectedIndex)},n.prototype.onAddToStage_Enhance=function(){this.updateEnhanceData()},n.prototype.updateEnhanceData=function(){var e=PartnerEquipEnhance.badgeList[this.petList.selectedIndex];if(this.enhanceBtnBadge.visible=badge.blackboard[e],!PartnerEquipEnhance.openFlag)return void(this.btnGainResEnhanceMaterial.visible=!1);if(this.autoEnhanceList.length<=0&&(this.autoEnhanceList=PartnerEquipEnhance.getAutoEnhanceList(this.petList.selectedIndex),this.autoEnhanceList.length<=0))return void(this.btnGainResEnhanceMaterial.visible=!1);var t=this.petList.selectedIndex,n=this.autoEnhanceList[0],i=t*PartnerEquipManager.PARTNEREQUIP_EACHPARTNERCOUNT+n,a=PartnerEquipEnhance.getEnhanceLevel(i),r=a+1,o=PartnerEquipEnhance.GetAttributeConfig(t,r);if(null==o)return void(this.btnGainResEnhanceMaterial.visible=!1);this.btnGainResEnhanceMaterial.visible=!0;var s=o.cost[0],l=o.cost[1],u=o.cost[2],c=PlayerAttribute.GetItemCount(s,l);this.enhanceMaterialNeedNum.text=u.toString(),this.enhanceMaterialCurNum.text=c.toString(),this.enhanceMaterialCurNum.textColor=c>=u?color.GREEN:color.RED;var h=table.props[s][l];this.enhanceMaterialIcon.source=h.source},n.prototype.autoEnhance=function(){this.enhanceTimer=null;var e=this.petList.selectedIndex,t=this.enhance_AutoSelectEquip(e);t>=0&&PartnerEquipEnhance.ApplyEnhance(e,t)},n.prototype.enhance_AutoSelectEquip=function(e){var t=-1;return this.autoEnhace?(this.autoEnhanceList.length<=0?(this.autoEnhanceList=[],this.autoEnhanceList=PartnerEquipEnhance.getAutoEnhanceList(e),this.autoEnhanceList.length>0&&(t=this.autoEnhanceList.shift())):t=this.autoEnhanceList.shift(),this.autoEnhanceList.length<=0&&(this.autoEnhace=!1,-1==t&&PopUpMessage.push(lang.String("partnerEquipEnhance auto select no equip to enhace"),color.RED)),t):t},n.prototype.onEnhanceSuccess=function(){this.updateEnhanceData(),this.autoEnhace&&null==this.enhanceTimer&&(this.enhanceTimer=egret.setTimeout(this.autoEnhance,this,300)),PartnerEquipManager.showEffectPart=[];for(var e=0;e!=PartnerEquipEnhance.showEffectPart.length;e++)PartnerEquipManager.showEffectPart.push(PartnerEquipEnhance.showEffectPart[e]);this.showPartnerEquipEffect(),this.updatePartnerEquip()},n.prototype.stopAutoEnhance=function(){this.autoEnhace=!1,this.autoEnhanceList=[],null!=this.enhanceTimer&&(egret.clearTimeout(this.enhanceTimer),this.enhanceTimer=null)},n.defaultIcon=["ui/playerui/equip_4.png","ui/playerui/equip_0.png","ui/playerui/equip_2.png","ui/playerui/equip_1.png","ui/playerui/equip_6.png","ui/playerui/equip_3.png"],n}(eui.Component);e.PetUI=t,__reflect(t.prototype,"UI.PetUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.curState=0,n.lockState=0,n.cost=[0,0,1,1,2,3],n.needItem="0",n.onDataChange=MakeDelayExecute(n.refresh,n,100),n.selectAttrs=[],n.skinName="PetWashBoneSkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.mc=new e.MovieClipComponent,n.mc.removeWhenComplete=!1,n.mc.position="center",n.mc.horizontalCenter=0,n.mc.verticalCenter=0,n.mc.visible=!1,n.resEnough=!1,n.selectAttrs=[],n.selectAttrs.push(n.selectAttr1),n.selectAttrs.push(n.selectAttr2),n.selectAttrs.push(n.selectAttr3),n.selectAttrs.push(n.selectAttr4),n.tip.addChild(n.mc),n}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onAddToStage=function(){var e=Partner.GetPartnerObj(this.selectedPetId);if(null==e)return void UIManager.pop(this);this._clear();var t=Partner.GetPartnerCfg(e.id);this.partnerCfg=t,this.attrName1=Buff.GetName(t.baseAttr[0][0]),this.attrName2=Buff.GetName(t.baseAttr[1][0]),this.attrName3=Buff.GetName(t.baseAttr[2][0]),this.attrName4=Buff.GetName(t.baseAttr[3][0]),this.maxAttr01=this.trueAttrValue(t.baseAttr[0][1],0,e.level),this.maxAttr02=this.trueAttrValue(t.baseAttr[1][1],1,e.level),this.maxAttr03=this.trueAttrValue(t.baseAttr[2][1],2,e.level),this.maxAttr04=this.trueAttrValue(t.baseAttr[3][1],3,e.level),this.maxAttr1="/"+this.maxAttr01,this.maxAttr2="/"+this.maxAttr02,this.maxAttr3="/"+this.maxAttr03,this.maxAttr4="/"+this.maxAttr04,this.onDataChange(),Game.dispatcher.addEventListener(Game.EVENT.PartnerDataChange,this.onDataChange,this),Game.dispatcher.addEventListener(Game.EVENT.AddItem,this.onDataChange,this),Game.dispatcher.addEventListener(Game.EVENT.RemoveItem,this.onDataChange,this),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,this.onDataChange,this),Game.dispatcher.addEventListener(Game.EVENT.BagItemChange,this.onDataChange,this),guide.completed()||this.playGuideMovie(guide.info.operation),guide.addEventListener(guide.GuideOperation.GuideResetPartner,this.onGuideReminder,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.PartnerDataChange,this.onDataChange,this),Game.dispatcher.removeEventListener(Game.EVENT.AddItem,this.onDataChange,this),Game.dispatcher.removeEventListener(Game.EVENT.RemoveItem,this.onDataChange,this),Game.dispatcher.removeEventListener(Game.EVENT.UpdateItem,this.onDataChange,this),Game.dispatcher.removeEventListener(Game.EVENT.BagItemChange,this.onDataChange,this),guide.removeEventListener(guide.GuideOperation.GuideResetPartner,this.onGuideReminder,this),this.mc.visible=!1,this.mc.stop(),this.mc.free(),this.onDataChange.stop(),this.lblFPtips.text="",this.curAttr01=0,this.curAttr02=0,this.curAttr03=0,this.curAttr04=0,this.maxAttr01=0,this.maxAttr02=0,this.maxAttr03=0,this.maxAttr04=0},n.prototype._clear=function(){for(var e=0;e<this.selectAttrs.length;e++)this.selectAttrs[e].selected=!1},n.prototype.refresh=function(){var e=Partner.GetPartnerObj(this.selectedPetId);if(null==this.partnerCfg||null==e)return void UIManager.pop(this);var t=this.partnerCfg,n=this._getCostNum(t.quality),i=PlayerAttribute.bag.CalcCount(9,4);switch(i>=n?this.labelHaveItem.textFlow=Game.HtmlTextParser.parse('<font color="#09e118">'+i+"</font>"):this.labelHaveItem.textFlow=Game.HtmlTextParser.parse('<font color="#f01616">'+i+"</font>"),this.curState){case 0:this.curAttr01=this.trueAttrValue(e.attr[0],0,e.level),this.curAttr02=this.trueAttrValue(e.attr[1],1,e.level),this.curAttr03=this.trueAttrValue(e.attr[2],2,e.level),this.curAttr04=this.trueAttrValue(e.attr[3],3,e.level),this.oldAttrs=e.attr,this.needItem=""+n,this.resEnough=i>=n;break;case 1:this.curAttr1=this.trueAttrValue(e.attr[0],0,e.level),this.curAttr2=this.trueAttrValue(e.attr[1],1,e.level),this.curAttr3=this.trueAttrValue(e.attr[2],2,e.level),this.curAttr4=this.trueAttrValue(e.attr[3],3,e.level),this.newAttrs=e.attr,this.labelDeltaAttr1.textFlow=Game.HtmlTextParser.parse(this._getDeltaString(this.curAttr01,this.curAttr1)),this.labelDeltaAttr2.textFlow=Game.HtmlTextParser.parse(this._getDeltaString(this.curAttr02,this.curAttr2)),this.labelDeltaAttr3.textFlow=Game.HtmlTextParser.parse(this._getDeltaString(this.curAttr03,this.curAttr3)),this.labelDeltaAttr4.textFlow=Game.HtmlTextParser.parse(this._getDeltaString(this.curAttr04,this.curAttr4)),this.needItem="0",this.btnAgree.enabled=!0,this.btnRestore.enabled=!0;var a=Partner.GetWashBonePower(this.selectedPetId,this.oldAttrs),r=Partner.GetWashBonePower(this.selectedPetId,this.newAttrs),o=void 0;o=a>=r?"<font color='"+egret.toColorString(color.RED)+"'>-"+(a-r)+"</font>":"<font color='"+egret.toColorString(color.GREEN)+"'>+"+(r-a)+"</font>",this.lblFPtips.textFlow=Game.HtmlTextParser.parse(lang.StringWithFormat("fp:{1}",o))}},n.prototype._getDeltaString=function(e,t){var n=t-e,i="";return i=n>=0?" (+"+n+")":' (<font color="#f01616">-'+-n+"</font>)"},n.prototype.onTouchTap=function(t){switch(t.target){case this.imgClose:this.close();break;case this.selectAttr1:this.selectAttr1.selected=this.selectAttr1.selected&&this._oncheckBoxSelect(1,this.selectAttr1.selected),this.refresh();break;case this.selectAttr2:this.selectAttr2.selected=this.selectAttr2.selected&&this._oncheckBoxSelect(2,this.selectAttr2.selected),this.refresh();break;case this.selectAttr3:this.selectAttr3.selected=this.selectAttr3.selected&&this._oncheckBoxSelect(3,this.selectAttr3.selected),this.refresh();break;case this.selectAttr4:this.selectAttr4.selected=this.selectAttr4.selected&&this._oncheckBoxSelect(4,this.selectAttr4.selected),this.refresh();break;case this.btnAgree:this._onClickBtnAgree(!1);break;case this.btnRestore:this._onClickBtnRestore(!1);break;case this.btnGainRes:e.ResourceObtain.Open([e.ObtResId.washBoneItem]);break;default:this.refresh()}},n.prototype.close=function(){0==this.curState?UIManager.pop(this):PopUpMessage.push(lang.String("please agree or restore partner attribute"),color.RED)},n.prototype._onClickBtnAgree=function(t){var n=this;switch(this.curState){case 0:if(0==this.resEnough)return void e.ResourceObtain.Open([e.ObtResId.washBoneItem]);Partner.ApplyResetPartner(this.selectedPetId,this.getLockState())&&(this._setState(1),this.refresh());break;case 1:var i=Partner.GetWashBonePower(this.selectedPetId,this.oldAttrs),a=Partner.GetWashBonePower(this.selectedPetId,this.newAttrs);if(!t&&i>a){var r=lang.String("operation confirm"),o=lang.String("are you sure to agree a bad partner attribute?");e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],r,o,function(){return n._onClickBtnAgree(!0),!0},null,null)}else Partner.ApplyAgreePartnerAttr(this.selectedPetId)&&(this._setState(0),this.refresh(),this.mc.visible=!0,this.mc.Load("skill/Ui_menke/Ui_menke.json","Ui_menke"),this.mc.gotoAndPlay(0,1))}},n.prototype._onClickBtnRestore=function(t){var n=this;if(1==this.curState){var i=Partner.GetWashBonePower(this.selectedPetId,this.oldAttrs),a=Partner.GetWashBonePower(this.selectedPetId,this.newAttrs);if(!t&&a>i){var r=lang.String("operation confirm"),o=lang.String("are you sure to restore a better partner attribute?");e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],r,o,function(){return n._onClickBtnRestore(!0),!0},null,null)}else Partner.ApplyRestorePartnerAttr(this.selectedPetId),this._setState(0)}},n.prototype._setState=function(e){this.curState=e;var t=this.getLockState();if(this.currentState=""+this.curState,this.refresh(),1==this.curState){for(var n=0;n<this.selectAttrs.length;n++){var i=1<<n;this.selectAttrs[n].selected=0!=(t&i)}this.selectAttr1.selected=0!=(1&t)}},n.prototype._oncheckBoxSelect=function(e,t){var n=15,i=this.getLockState()!=n;return i||PopUpMessage.push(lang.StringWithFormat("can only lock {1} attribute",3),color.RED),i},n.prototype._getCostNum=function(e){for(var t=1,n=0;n<this.selectAttrs.length;n++)this.selectAttrs[n].selected&&(t*=2);return this.cost[e]*t},n.prototype.getLockState=function(){for(var e=0,t=0;t<this.selectAttrs.length;t++){var n=1<<t;this.selectAttrs[t].selected&&(e|=n)}return e},n.prototype.open=function(e){return this.selectedPetId=e,this},n.prototype.onGuideReminder=function(){var e=this;if(this.visible){var t=guide.info.operation;guide.pushMovie({weight:2,handle:function(){e.playGuideMovie(t)}})}},n.prototype.playGuideMovie=function(e){e==guide.GuideOperation.GuideResetPartner&&guide.AddMovieClip(this.btnAgree)},n.prototype.trueAttrValue=function(e,t,n){var i=~~(e/10*n)+this.partnerCfg.baseAttr[t][2];return i},n}(e.FitComponent);e.PetWashBone=t,__reflect(t.prototype,"UI.PetWashBone",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t._delayRefresh=MakeDelayExecute(t.refresh,t,100),t.skinName="SkillBreakUpSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.mc.play(1),t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.onTouchTap=function(e){switch(e.target){default:this.close()}},t.prototype.close=function(){UIManager.pop(this)},t.prototype.onAddToStage=function(){this._delayRefresh()},t.prototype.onRemoveFromStage=function(){this._delayRefresh.stop()},t.prototype.refresh=function(){if(this.petSkillName="",this.petSkillLevel1="",this.labelSkillDesc1.text="",null!=this.obj){var e=Partner.GetPartnerCfg(this.obj.id);if(null!=e){if(this.imgPetSkill1.source=Partner.getSkillIcon(e),null!=e.rageSkillId&&0!=e.rageSkillId){var t=Skill.mapSkill[e.rageSkillId];null!=t&&(this.imgPetSkill1.source=t.icon)}var n=Partner.getTalentSkillLevel(this.obj);this.petSkillLevel1=lang.StringWithFormat("{1}level",n),this.petSkillName=Partner.getSkillName(e),this.labelSkillDesc1.textFlow=Game.HtmlTextParser.parse(Partner.getSkillDesc(e,n,1==this.obj.workPos,!1))}}},t.prototype.open=function(e){return this.obj=e,this},t}(e.FitComponent);e.SkillBreakUp=t,__reflect(t.prototype,"UI.SkillBreakUp")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;n.mcs=[],n.skinName="AttributeOutlineSkin",n.addEventListener(egret.TouchEvent.TOUCH_BEGIN,n.onTouchBegin,n),n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n);for(var i=0;4>i;i++)n.mcs[i]=new e.MovieClipComponent,n.mcs[i].verticalCenter=-176+104*i,n.mcs[i].horizontalCenter=0;return n.msgtf=table.faction[PlayerAttribute.faction].name+lang.String("tian fu"),n}return __extends(n,t),n.prototype.onAddToStage=function(){this.onInitalData(),Game.dispatcher.addEventListener(Game.EVENT.LevelUp,this.onInitalData,this),Game.dispatcher.addEventListener(Game.EVENT.AbilityPoint,this.onAttriDataChange,this),guide.addEventListener(guide.GuideOperation.GuideAbility,this.onGuideReminder,this),guide.completed()||this.playGuideMovie(guide.info.operation)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.LevelUp,this.onInitalData,this),Game.dispatcher.removeEventListener(Game.EVENT.AbilityPoint,this.onAttriDataChange,this),guide.removeEventListener(guide.GuideOperation.GuideAbility,this.onGuideReminder,this);for(var e=0;4>e;e++)this.mcs[e].free()},n.prototype.onInitalData=function(){this.onAttriDataChange()},n.prototype.onTouchBegin=function(e){var t,n=this;switch(e.target){case this.btnStrgadd:t=function(){n.onAddability("strgPlus",1)};break;case this.btnStrgreduce:t=function(){n.onAddability("strgPlus",-1)};break;case this.btnOuteradd:t=function(){n.onAddability("outerPlus",1)};break;case this.btnOuterreduce:t=function(){n.onAddability("outerPlus",-1)};break;case this.btnInneradd:t=function(){n.onAddability("innerPlus",1)};break;case this.btnInnerreduce:t=function(){n.onAddability("innerPlus",-1)};break;case this.btnAgiadd:t=function(){n.onAddability("agiPlus",1)};break;case this.btnAgireduce:t=function(){n.onAddability("agiPlus",-1)};break;default:return}t();var i=function(){t(),null!=n.timerId&&(egret.clearTimeout(n.timerId),n.timerId=null),n.timerId=egret.setTimeout(i,n,200)};null!=this.timerId&&(egret.clearTimeout(this.timerId),this.timerId=null),this.timerId=egret.setTimeout(i,this,1e3),this.stage.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchEnd,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},n.prototype.onTouchEnd=function(e){var t=e.$currentTarget;t.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchEnd,this),t.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),null!=this.timerId&&(egret.clearTimeout(this.timerId),this.timerId=null)},n.prototype.onAttriDataChange=function(){this.abilitypoint=PlayerAttribute.abilitypoint,this.abilitypoint<=0?this.btnAuto.enabled=!1:this.btnAuto.enabled=!0,this.strength=PlayerAttribute.strength,this.agility=PlayerAttribute.agility,this.outerPower=PlayerAttribute.outerPower,this.innerPower=PlayerAttribute.innerPower,this.strgPlus=0,this.agiPlus=0,this.outerPlus=0,this.innerPlus=0},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnAuto:this.onAutoaddability();break;case this.btnReset:this.reset();break;case this.imgClose:this.close()}},n.prototype.close=function(){UIManager.pop(this)},n.prototype.onAddability=function(e,t){this.abilitypoint-t<0||this.abilitypoint-t>PlayerAttribute.abilitypoint||0==this[e]&&0>t||(this[e]=this[e]+t,this.abilitypoint=this.abilitypoint-t,this.onConfirmaddability())},n.prototype.onAutoaddability=function(){badge.onLight(badge.action.AddAbilityPoint,!1);var e=PlayerAttribute.abilitypoint;if(!(0>=e)){var t=PlayerAttribute.faction,n=table.faction[t],i=Math.floor(e/5),a=e-5*i;this.strgPlus=n.autoabilities.strength*i,this.agiPlus=n.autoabilities.agility*i,this.outerPlus=n.autoabilities.outerPower*i,this.innerPlus=n.autoabilities.innerPower*i,a-n.autoabilities.strength>=0&&(this.strgPlus=this.strgPlus+n.autoabilities.strength,a-=n.autoabilities.strength),a-n.autoabilities.outerPower>=0&&(this.outerPlus=this.outerPlus+n.autoabilities.outerPower,a-=n.autoabilities.outerPower),a-n.autoabilities.innerPower>=0&&(this.innerPlus=this.innerPlus+n.autoabilities.innerPower,a-=n.autoabilities.innerPower),a-n.autoabilities.agility>=0&&(this.agiPlus=this.agiPlus+n.autoabilities.agility,a-=n.autoabilities.agility),this.abilitypoint=a,this.onConfirmaddability()}},n.prototype.onConfirmaddability=function(){var e=Player.instance;if(null!=e){var t=new net.def.C2SAddAbilityPoint;t.setStrength(this.strgPlus),t.setOuterPower(this.outerPlus),t.setInnerPower(this.innerPlus),t.setAgility(this.agiPlus),net.socket.write(16,t.toArrayBuffer()),this.strgPlus>0&&(this.mcs[0].Load("skill/Ui_addpoint/Ui_addpoint.json","Ui_addpoint"),this.addChild(this.mcs[0]),this.mcs[0].gotoAndPlay(0,1)),this.outerPlus>0&&(this.mcs[1].Load("skill/Ui_addpoint/Ui_addpoint.json","Ui_addpoint"),this.addChild(this.mcs[1]),this.mcs[1].gotoAndPlay(0,1)),this.innerPlus>0&&(this.mcs[2].Load("skill/Ui_addpoint/Ui_addpoint.json","Ui_addpoint"),this.addChild(this.mcs[2]),this.mcs[2].gotoAndPlay(0,1)),this.agiPlus>0&&(this.mcs[3].Load("skill/Ui_addpoint/Ui_addpoint.json","Ui_addpoint"),this.addChild(this.mcs[3]),this.mcs[3].gotoAndPlay(0,1)),this.strgPlus=0,this.outerPlus=0,this.innerPlus=0,this.agiPlus=0,0==this.abilitypoint&&badge.onLight(badge.action.AddAbilityPoint,!1)}},n.prototype.reset=function(){net.socket.write(17,null)},n.prototype.onGuideReminder=function(){var e=this;this.visible&&guide.pushMovie({weight:2,handle:function(){e.playGuideMovie(guide.info.operation)}})},n.prototype.playGuideMovie=function(e){switch(e){case guide.GuideOperation.GuideAbility:guide.AddMovieClip(this.btnAuto);break;default:return}},n}(e.FitComponent);e.AttributeOutline=t,__reflect(t.prototype,"UI.AttributeOutline",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="AvatarItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){this.currentState=this.data.status;var e=table.avatars[this.data.id].item.genre,t=table.avatars[this.data.id].item.detailType;this.cell.icon=table.props[e][t].source,this.cell.rbcorner=null,this.cell.quality=5},t}(eui.ItemRenderer);e.AvatarItem=t,__reflect(t.prototype,"UI.AvatarItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;n.avatars=[],n.skinName="AvatarUISkin";for(var i in table.avatars)n.avatars.push({id:table.avatars[i].id,name:table.avatars[i].name,resource:table.avatars[i].resource,costs:table.avatars[i].costs,item:table.avatars[i].item,attributes:table.avatars[i].attributes});return n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.mc=new e.MovieClipComponent,n.mc.verticalCenter=-140,n.mc.horizontalCenter=0,n.mc.removeWhenComplete=!1,n.itemList.addEventListener(egret.Event.CHANGE,n.onSelectItem,n),n.mc.visible=!1,n.addChild(n.mc),n}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.Close=function(){null!=this._instance&&UIManager.pop(this._instance)},n.prototype.close=function(){n.Close()},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close();break;case this.btnLevelUp:var t=table.avatars[this.avatarId].item,n=PlayerAttribute.bag.CalcCount(t.genre,t.detailType),i=1;if(null!=Avatar.list[this.avatarId]&&(i=Avatar.list[this.avatarId].level),i>=WorldLine.GetMaxAvatarsLevel())return this.btnLevelUp.enabled=!1,void(this.costTip.visible=this.btnLevelUp.enabled);var a=table.avatars[this.avatarId].costs[i-1];n>=a?Avatar.LevelUp(this.avatarId):PopUpMessage.push(lang.StringWithFormat("item {1} not enough",lang.String("material")),color.RED);break;case this.btnEquip:Player.instance.avatar==this.avatarId?Avatar.Use(0):null!=Avatar.list[this.avatarId]&&Avatar.Use(this.avatarId);
break;case this.arrowLeft:this.onFlipTitle(!1);break;case this.arrowRight:this.onFlipTitle(!0)}},n.prototype.onAddToStage=function(){this.updateItems(),this.itemList.selectedIndex=0,this.autoSelectItem(),this.fp=Avatar.getFp(),Game.dispatcher.addEventListener(Game.EVENT.AvatarLevelChange,this.onLevelChange,this),Game.dispatcher.addEventListener(Game.EVENT.AvatarChange,this.onChange,this)},n.prototype.getAvatarOneItem=function(e){var t={id:0,status:"",badge:!1,txtLevel:""},n=table.avatars[e];t.id=e;var i=0;null!=Avatar.list[e]&&(i=Avatar.list[e].level),t.txtLevel=i>0?lang.StringWithFormat("{1}level",i):lang.StringWithFormat("{1}level",0),Player.instance.avatar==e?t.status="load":null!=Avatar.list[e]?t.status="unload":t.status="unactive",0==i&&(i=1);var a=!1;if(i<WorldLine.GetMaxAvatarsLevel()){var r=PlayerAttribute.bag.CalcCount(n.item.genre,n.item.detailType),o=n.costs[i-1];r>=o&&(a=!0)}return t.badge=a,t},n.prototype.onChange=function(e){e.data.id;this.updateItems()},n.prototype.onLevelChange=function(e){var t=e.data.id,n=e.data.level;t==this.avatarId&&(this.updateAttribute(n),this.updateCost(n),this.fp=Avatar.getFp(),this.mc.visible=!0,this.mc.Load("skill/Ui_petup/Ui_petup.json","Ui_petup"),this.mc.gotoAndPlay(0,1),this.btnLevelUp.enabled=n<WorldLine.GetMaxAvatarsLevel(),this.btnLevelUp.label=lang.String("level up"),this.costTip.visible=this.btnLevelUp.enabled),this.updateItems()},n.prototype.updateAttribute=function(e){var t=this.avatars[this.itemList.selectedIndex],n=t.attributes[e-1],i="",a="";isNaN(n.fp)||0==n.fp||(i+=lang.String("FightingPower")+"\n",a+=n.fp+"\n"),isNaN(n.life)||0==n.life||(i+=Buff.GetName(17)+":\n",a+=n.life+"\n"),isNaN(n.attack)||0==n.attack||(i+=Buff.GetName(1)+":\n",a+=n.attack+"\n"),isNaN(n.defense)||0==n.defense||(i+=Buff.GetName(7)+":",a+=n.defense),this.attributeNames0.text=i,this.attributeNum0.text=a,i="",a="",isNaN(n.strike)||0==n.strike||(i+=Buff.GetName(31)+":\n",a+=n.strike+"\n"),isNaN(n.antiStrike)||0==n.antiStrike||(i+=Buff.GetName(32)+":\n",a+=n.antiStrike+"\n"),isNaN(n.hit)||0==n.hit||(i+=Buff.GetName(16)+":\n",a+=n.hit+"\n"),isNaN(n.dodge)||0==n.dodge||(i+=Buff.GetName(15)+":",a+=n.dodge),this.attributeNames1.text=i,this.attributeNum1.text=a},n.prototype.updateCost=function(e){var t=this.avatars[this.itemList.selectedIndex],n=PlayerAttribute.bag.CalcCount(t.item.genre,t.item.detailType),i=t.costs[e-1],a=color.Warning;n>=i&&(a=color.Title1_Value),this.txtCostItem.textFlow=Game.HtmlTextParser.parse("<font color="+egret.toColorString(a)+">"+n+"</font> / "+i)},n.prototype.updateItems=function(){for(var e=[],t=0;t<this.avatars.length;t++){var n=this.getAvatarOneItem(this.avatars[t].id);e.push({id:n.id,status:n.status,badge:n.badge,txtLevel:n.txtLevel})}var i=this.itemList.dataProvider;if(null==i?this.itemList.dataProvider=new eui.ArrayCollection(e):i.replaceAll(e),null!=this.avatarId){var a=this.getAvatarOneItem(this.avatarId);"unactive"==a.status?(this.btnEquip.label="Biến thân",this.btnEquip.enabled=!1,this.avatarLv=""):(this.btnEquip.enabled=!0,"load"==a.status?this.btnEquip.label="Hồi phục":this.btnEquip.label="Biến thân",this.avatarLv="Lv. "+Avatar.list[a.id].level)}},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.AvatarLevelChange,this.onLevelChange,this),Game.dispatcher.addEventListener(Game.EVENT.AvatarChange,this.onChange,this),this.mc.visible=!1,this.mc.stop(),this.mc.free(),this.statue.clear()},n.prototype.onSelectItem=function(){var e=this.itemList.selectedIndex,t=this.itemList.selectedItem,n=this.avatars[e];this.avatarId=n.id,this.avatarName=n.name,this.statue.setResource(n.resource,null,"2");var i=0;"unactive"==t.status?(this.btnLevelUp.label=lang.String("activate"),i=1,this.btnEquip.label="Biến thân",this.btnEquip.enabled=!1,this.avatarLv=""):(this.btnLevelUp.label=lang.String("level up"),i=Avatar.list[t.id].level,this.btnEquip.enabled=!0,"load"==t.status?this.btnEquip.label="Hồi phục":this.btnEquip.label="Biến thân",this.avatarLv="Lv. "+i),this.btnLevelUp.enabled=i<WorldLine.GetMaxAvatarsLevel(),this.costTip.visible=this.btnLevelUp.enabled,this.updateCost(i),this.updateAttribute(i)},n.prototype.autoSelectItem=function(){for(var e=Player.instance,t=(e.avatar,0);t<this.avatars.length;t++)if(0!=e.avatar&&e.avatar==this.avatars[t].id){this.itemList.selectedIndex=t;break}this.onSelectItem()},n.prototype.onFlipTitle=function(e){var t=this.scroller.width-50;if(e){if(this.scroller.viewport.scrollH+t>=this.scroller.viewport.contentWidth)return;this.scroller.viewport.scrollH+=t}else this.scroller.viewport.scrollH>=t?this.scroller.viewport.scrollH-=t:this.scroller.viewport.scrollH=0},n}(e.FitComponent);e.AvatarUI=t,__reflect(t.prototype,"UI.AvatarUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="PlayerCabinetSkin",t.oldPage=0,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,t.onItemTap,t),t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.Close=function(){null!=this._instance&&UIManager.pop(this._instance)},t.prototype.onAddToStage=function(){switch(null==this.page&&this.changePage(0),this.page){case 1:badge.onLight(badge.action.PartnerUpgrage,!1)}},t.prototype.onItemTap=function(){if(3==this.tabbar.selectedIndex&&PlayerAttribute.Level<PartnerQingyi.openLevel)return PopUpMessage.push(lang.StringWithFormat("unlock:level{1}",PartnerQingyi.openLevel),color.RED),void(this.tabbar.selectedIndex=this.oldPage);var e=this.tabbar.selectedIndex;switch(this.page!=e&&(this.page=e,this.oldPage=e),this.page){case 1:badge.onLight(badge.action.PartnerUpgrage,!1)}},t.prototype.close=function(){UIManager.closeRole()},t.prototype.changePage=function(e){this.page=e},t}(e.FitComponent);e.PlayerCabinet=t,__reflect(t.prototype,"UI.PlayerCabinet",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="PlayerUISkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.titleView1.visible=!1,e}return __extends(n,t),n.prototype.onAddToStage=function(){WorldLine.IsOpen("CollectCard")||Game.removeFromParent.apply(this.btnCollectCard),WorldLine.IsOpen("WenShi")||Game.removeFromParent.apply(this.wenshiicon),WorldLine.IsOpen("WuXingYin")||Game.removeFromParent.apply(this.greoupWuXingYing),this.rolebg=table.faction[PlayerAttribute.faction].bg,this.txtLevel=lang.StringWithFormat("{1}level",PlayerAttribute.Level),this.factionIcon=table.faction[PlayerAttribute.faction].logoD,this.animation.load(table.faction[PlayerAttribute.faction].animation,"st"),this.d=Player.instance,Game.dispatcher.addEventListener(Game.EVENT.FactionTitleChange,this.onChangeUsingTitle,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingyinBadge,this.updateWuxingyinCell,this),guide.addEventListener(guide.GuideOperation.GuideEquip,this.onGuideReminder,this),guide.addEventListener(guide.GuideOperation.GuideAbility,this.onGuideReminder,this),this.onChangeUsingTitle(),guide.completed()||this.playGuideMovie(guide.info.operation),this.updateWuxingyinCell()},n.prototype.onRemoveFromStage=function(){this.titleView1.free(),Game.dispatcher.removeEventListener(Game.EVENT.FactionTitleChange,this.onChangeUsingTitle,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingyinBadge,this.updateWuxingyinCell,this),guide.removeEventListener(guide.GuideOperation.GuideEquip,this.onGuideReminder,this),guide.removeEventListener(guide.GuideOperation.GuideAbility,this.onGuideReminder,this),this.d=null},n.prototype.onTouchTap=function(t){if(t.target instanceof e.EquipCell){var n=t.target.data.part;null!=PlayerAttribute.Equips[n]&&e.EquipTips.open("default",PlayerAttribute.Equips[n],PlayerAttribute.enhancement[n],PlayerGem.gems[n],PlayerAttribute.Equips,Refine.levels[n])}switch(t.target){case this.btnAutoEquip:PlayerAttribute.AutoEquip(),badge.onLight(badge.action.AutoEquip,!1);break;case this.btnMagic:this.PushMagicUI();break;case this.btnWu:UIManager.pushPage(new e.PlayerWu);break;case this.btnAttribute:UIManager.pushPage(new e.AttributeOutline);break;case this.btntitle:UIManager.pushPage(e.TitleBreakThrough.instance);break;case this.btnSuperWeapon:SuperWeapon.showUi();break;case this.btnAvatar:UIManager.pushPage(e.AvatarUI.instance);break;case this.btnGuildSkillAttr:Guild.openGuildSkillAttr();break;case this.btnFriend:UIManager.pushPage(e.FriendsUI.instance);break;case this.btnCollectCard:var i=collectCardManager.kindConfig[1].require;if(PlayerAttribute.Level<i)return void PopUpMessage.push(lang.StringWithFormat("unlock:level{1}",i),color.RED);e.CollectCardUI.open();break;case this.wuxingyinCell:e.WuxingyinUI.open()}},n.prototype.onChangeUsingTitle=function(){var e=FactionTitle.getResource(FactionTitle.id);null!=e&&(this.titleView1.Load("title/"+e+"/"+e+".json",e),this.titleView1.play(-1),this.titleView1.visible=!0)},n.prototype.PushMagicUI=function(){net.socket.write(18,null)},n.prototype.onGuideReminder=function(){var e=this;this.visible&&guide.pushMovie({weight:1,handle:function(){e.playGuideMovie(guide.info.operation)}})},n.prototype.playGuideMovie=function(e){switch(e){case guide.GuideOperation.GuideEquip:guide.AddMovieClip(this.btnAutoEquip);break;case guide.GuideOperation.GuideAbility:guide.AddMovieClip(this.btnAttribute);break;case guide.GuideOperation.LevelUpFactionTitle:guide.AddMovieClip(this.btntitle);break;default:return}},n.prototype.updateWuxingyinCell=function(){this.wuxingyinCell.data=Wuxingyinmanager.getWuxingyinCellItemData(),this.badgeWuxingyin.visible=badge.blackboard[badge.action.Wuxingyin]},n}(eui.Component);e.PlayerUI=t,__reflect(t.prototype,"UI.PlayerUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;n.skinName="PlayerWuSkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.freeMovie,n),n.mc=new e.MovieClipComponent,n.mc.contentJustify=!1,n.mc.justify=!1,n.mc.position="center",n.mc.removeWhenComplete=!1;var i=PlayerAttribute.faction;n.txtfaction=table.faction[i].name;var a=n.efGroup.getChildAt(i-1);return n.mc.Load("mc/Ui_y5/Ui_y5.json","Ui_y5"),n.mc.horizontalCenter=a.horizontalCenter,n.mc.verticalCenter=a.verticalCenter,n.efGroup.addChild(n.mc),n.mc.play(-1),n}return __extends(n,t),n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},n.prototype.freeMovie=function(){null!=this.mc&&(this.mc.stop(),Game.removeFromParent.apply(this.mc),this.mc.free())},n.prototype.close=function(){UIManager.pop(this)},n}(e.FitComponent);e.PlayerWu=t,__reflect(t.prototype,"UI.PlayerWu",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="SuperWeaponUISkin",e.show=!1,e.weaponId=1,e.curWeapon=new SuperWeapon.SuperWeaponItem(e.weaponId),e.props=e.curWeapon.props,e.isReqWear=!1,e.propStatus={},e.strNeedLevel="",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.weaponTween.play(0),e.weaponTween.addEventListener(egret.Event.COMPLETE,e.onTweenGroupComplete,e),e}return __extends(n,t),Object.defineProperty(n.prototype,"isOpened",{get:function(){return this.show},enumerable:!0,configurable:!0}),n.prototype.onTweenGroupComplete=function(){this.weaponTween.play(0)},n.prototype.onAddToStage=function(){this.show=!0;var e=SuperWeapon.getOneLevelupWeaponId();e>0&&(this.weaponId=e),this.onWeaponDataChanged(),Game.dispatcher.addEventListener(Game.EVENT.AddItem,this.onBagItemChanged,this),this.itemList.addEventListener(egret.Event.CHANGE,this.onSelectItem,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.AddItem,this.onBagItemChanged,this),this.itemList.removeEventListener(egret.Event.CHANGE,this.onSelectItem,this),this.show=!1},n.prototype.onBagItemChanged=function(){this.updateUi(!1)},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnViewNext:this.onPageView(!0);break;case this.btnViewPrev:this.onPageView(!1);break;case this.imgClose:this.close();break;case this.btnForesee:UIManager.push(new e.WeaponShow(this.weaponId));break;case this.btnEquip:PlayerAttribute.superWeapons.wearId==this.weaponId?SuperWeapon.requestSetOutlook(!1,this.weaponId):(this.isReqWear=!0,SuperWeapon.requestSetOutlook(!0,this.weaponId),UIManager.push(new e.WeaponShow(this.weaponId)));break;case this.btnLevelUp:var n=this.curWeapon.cost,i=PlayerAttribute.bag.CalcCount(n.content.genre,n.content.detailType),a=n.content.num;i>=a?SuperWeapon.requestLevelUp(this.weaponId):PopUpMessage.push(lang.StringWithFormat("item {1} not enough",lang.String("material")),16711680)}},n.prototype.close=function(){SuperWeapon.hideUi()},n.prototype.onSelectItem=function(){var e=this.itemList.selectedIndex;e>=0&&(this.weaponId=e+1,this.prepareCurWeapon(),this.updateUi(!1))},n.prototype.onPageView=function(e){var t=this.scroller,n=t.height/2;e?t.viewport.scrollV+=n:t.viewport.scrollV>=n?t.viewport.scrollV-=n:t.viewport.scrollV=0},n.prototype.delayAdjustSelItem=function(){var e=this,t=this,n=egret.setTimeout(function(){e.autoAdjustSelItem.call(t),n=null},t,200)},n.prototype.autoAdjustSelItem=function(){var e=this.weaponId-1;null!=this.itemList&&this.itemList.numElements>e&&(this.scroller.viewport.scrollV=0,this.itemList.selectedIndex=e,e>=10&&this.onPageView(!0))},n.prototype.genWeaponListData=function(){for(var t=PlayerAttribute.superWeapons,n=new Array,i=!1,a=1;a<=SuperWeapon.MaxWeapons;a++){var r=table.superWeaponCfg[a],o=t.items[a].level,s=r.costs.cost.genre,l=r.costs.cost.detailType,u=table.props[s][l],c="";if(o<WorldLine.GetMaxSuperWeaponsLevel()){var h=PlayerAttribute.bag.CalcCount(s,l),d=t.items[a].cost.content.num;h>=d&&(c="ui/public/reddot.png",i=!0)}n.push({icon:r.icon,quality:u.quality,rbcorner:o>0?lang.StringWithFormat("{1}level",o):lang.String("inactivate"),plugin:c})}this.itemList.itemRenderer=e.Cell;var p=this.itemList.dataProvider;null==p?this.itemList.dataProvider=new eui.ArrayCollection(n):p.replaceAll(n),i||badge.onLight(badge.action.SuperWeaponTip,!1)},n.prototype.onWeaponDataChanged=function(){if(this.show){PlayerAttribute.superWeapons;this.isReqWear&&(this.isReqWear=!1),this.prepareCurWeapon(),this.updateUi(!0),this.delayAdjustSelItem()}},n.prototype.updateUi=function(e){if(this.show){var t=PlayerAttribute.superWeapons,n=this.curWeapon,i=table.superWeaponCfg[n.id];this.strNeedLevel=lang.StringWithFormat("superweapon need level{1}",i.wearLevel),n.level<i.wearLevel?this.txtNeedLevel.textColor=color.RED:this.txtNeedLevel.textColor=color.NewGREEN;var a=t.items[this.weaponId].level>=table.superWeaponCfg[this.weaponId].wearLevel;null!=this.effectMc&&(this.effectMc.visible=t.items[this.weaponId].level>0),this.weaponName=n.name,this.weaponDesc=n.desc,this.weaponImg=n.image,this.props=n.props,this.btnEquip.enabled=a,this.btnEquip.label=lang.String("put on"),a&&t.wearId==this.weaponId&&(this.btnEquip.label=lang.String("take off")),this.btnLevelUp.enabled=this.curWeapon.level<WorldLine.GetMaxSuperWeaponsLevel(),this.costGroup.visible=this.btnLevelUp.enabled,0==this.curWeapon.level?(this.btnLevelUp.label=lang.String("activate"),this.lblPropTitle.text=lang.String("weapon activated prop")):(this.btnLevelUp.label=lang.String("level up"),this.lblPropTitle.text=lang.String("weapon currenct prop"));var r=this.curWeapon.cost;if(this.cellCostItem.data=r,this.costGroup.visible){var o=PlayerAttribute.bag.CalcCount(r.content.genre,r.content.detailType),s=r.content.num;this.txtCostItem=lang.StringWithFormat("cost item",o,s)}e&&this.genWeaponListData()}},n.prototype.onLevelUpResult=function(e){var t=1==this.curWeapon.level?lang.String("activate"):lang.String("level up");t+=e?lang.String("success"):lang.String("fail"),e?(this.updateUi(!0),this.delayAdjustSelItem()):PopUpMessage.push(t,16711680)},n.prototype.prepareCurWeapon=function(){this.curWeapon=PlayerAttribute.superWeapons.items[this.weaponId],this.props=this.curWeapon.props;for(var e in this.props)this.propStatus["has_"+e]=this.props[e]>0},n}(e.FitComponent);e.SuperWeaponUI=t,__reflect(t.prototype,"UI.SuperWeaponUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(t){var n=e.call(this)||this;return n.skinName="PrologueAwardsUISkin",n.list.dataProvider=new eui.ArrayCollection(t),n.timer=5,n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n}return __extends(t,e),t.prototype.onAddToStage=function(){SecondTicker.addEventListener(this.onTimer,this)},t.prototype.onRemoveFromStage=function(){SecondTicker.removeEventListener(this.onTimer,this)},t.prototype.onTimer=function(){this.timer-=1,this.timer<=0&&this.close()},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnClose:this.close()}},t}(e.FitComponent);e.PrologueAwardsUI=t,__reflect(t.prototype,"UI.PrologueAwardsUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="npc_talkSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.setTimer=function(e){null!=this.timer&&egret.clearTimeout(this.timer),this.timer=egret.setTimeout(this.autoTap,this,e),null!=this.btn&&guide.AddMovieClip(this.btn)},t.prototype.cleanTimer=function(){null!=this.timer&&(egret.clearTimeout(this.timer),this.timer=null)},t.prototype.autoTap=function(){this.timer=null},t.prototype.onTouchTap=function(e){switch(e.target){case this.btn:this.handle()}},t}(e.FitComponent);e.PrologueDialogue=t,__reflect(t.prototype,"UI.PrologueDialogue",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(t,n){var i=e.call(this)||this;return i.skinName="PrologueEndAwardUISkin",i.list.dataProvider=new eui.ArrayCollection(t),i.handle=n,i}return __extends(t,e),t.prototype.close=function(){PlayerAttribute.AutoEquip(),null!=this.handle&&this.handle(),UIManager.pop(this)},t}(e.FitComponent);e.PrologueEndAwardUI=t,__reflect(t.prototype,"UI.PrologueEndAwardUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(t,n){var i=e.call(this)||this;i.skinName="EquipUseSkin",i.timer=new egret.Timer(5e3,1),i.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,i.timerComFunc,i),i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i.addEventListener(egret.Event.REMOVED_FROM_STAGE,i.onRemoveFromStage,i),i.addEventListener(egret.TouchEvent.TOUCH_TAP,i.onTouchTap,i);var a=Item.EquipParsePart[t.part],r=t.id,o=Game.Faction[PlayerAttribute.faction],s=table.equips[a][r];i.imgCell.icon=s[o].icon,i.imgCell.rbcorner=lang.StringWithFormat("{1}level",s.level);var l=t.quality||4;i.imgCell.quality=l;var u=Item.QualityColor[l];return i.goodsName.textFlow=Game.HtmlTextParser.parse("<font color="+u+">"+s[o].name+"</font>"),i.handle=n,i}return __extends(t,e),t.prototype.onTouchTap=function(e){this.closehandle()},t.prototype.closehandle=function(){this.close(),PlayerAttribute.AutoEquip(),null!=this.handle&&this.handle()},t.prototype.onAddToStage=function(){this.timer.start()},t.prototype.onRemoveFromStage=function(){this.timer.reset()},t.prototype.timerComFunc=function(){this.closehandle()},t}(e.FitComponent);e.PrologueEquipUse=t,__reflect(t.prototype,"UI.PrologueEquipUse",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="PrologueHUDSkin",e.touchEnabled=!1,e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.ADDED_TO_STAGE,e.onAddToStage,e),e.btnSkill.visible=!1,e.img.visible=!1,e.movieClip.Load("skill/Ui_quan02/Ui_quan02.json","Ui_quan02"),e}return __extends(n,t),n.prototype.onAddToStage=function(){SecondTicker.addEventListener(this.onRemindTimer,this),Game.dispatcher.addEventListener(Game.EVENT.AutoPlayChange,this.removeGuidePhase,this)},n.prototype.onRemoveFromStage=function(){this.freeMovie(),SecondTicker.removeEventListener(this.onRemindTimer,this),Game.dispatcher.removeEventListener(Game.EVENT.AutoPlayChange,this.removeGuidePhase,this)},n.prototype.freeMovie=function(){null!=this.movieClip&&(this.movieClip.stop(),Game.removeFromParent.apply(this.movieClip),this.movieClip.free())},n.prototype.onTouchTap=function(e){e.target},n.prototype.closeRemind=function(){this.remindGroup.visible=!1},n.prototype.pushRemind=function(e){this.timer=300,this.remindGroup.visible=!0,this.dialogue=Game.TextParser.parse(e)},n.prototype.onRemindTimer=function(){this.timer<=0?this.closeRemind():this.timer-=1},n.prototype.guidePhase=function(e){switch(e){case 6:guide.AddMovieClip(this.g4);break;default:return}},n.prototype.removeGuidePhase=function(){guide.removeMovieClip(this.g4),this.removeGuideSkill()},n.prototype.unlockSkill=function(e){var t,n=this;this.btnSkill.x=~~(this.width/2-38),this.btnSkill.y=~~(this.height/2-38);var i=PlayerAttribute.skillSlots;switch(egret.Tween.removeTweens(this.btnSkill),e){case 2:t=this.g2.localToGlobal(0,0),this.icon=i[1].icon;break;case 3:t=this.g3.localToGlobal(0,0),this.icon=i[2].icon;break;case 4:t=this.g4.localToGlobal(0,0),this.icon="ui/zuUi/icon_zd1.png";break;default:return void(this.icon="")}this.img.visible=!0,this.btnSkill.visible=!0,this.movieClip.play(-1),egret.Tween.get(this.btnSkill).wait(1600).to({x:t.x,y:t.y},500).call(function(){n.icon="",n.img.visible=!1,n.btnSkill.visible=!1,n.playing=!1,n.movieClip.stop()})},n.prototype.showAward=function(t){var n;switch(t){case 3:n=Prologue.awardsConfig.award1,this.push(new e.PrologueAwardsUI(n)),this.showGuideEquipUse(n,Prologue.onP2Step);break;case 10:n=Prologue.awardsConfig.box3Award,this.push(new e.PrologueAwardsUI(n)),this.showGuideEquipUse(n)}},n.prototype.showEnding=function(){var t=Prologue.awardsConfig.talkAward;this.push(new e.PrologueEndAwardUI(t,Prologue.onP2Step))},n.prototype.showGuideEquipUse=function(t,n){for(var i=0;i<t.length;i++)if("equip"==t[i].type){var a=new e.PrologueEquipUse(t[i].content,n);this.push(a),guide.AddMovieClip(a.btnUse);break}},n.prototype.push=function(e){return egret.Tween.removeTweens(e),e.parent==this.page?(e.scaleX=.9,e.scaleY=.9,e.alpha=0,egret.Tween.get(e).to({scaleX:1,scaleY:1,alpha:1},100),void this.page.addChild(e)):(e.scaleX=.9,e.scaleY=.9,e.alpha=0,egret.Tween.get(e).to({scaleX:1,scaleY:1,alpha:1},100),void this.page.addChild(e))},n.prototype.removeGuideSkill=function(){if(null!=this.skillMovieClip){var e=this.skillMovieClip.parent;null!=e&&e.removeChild(this.skillMovieClip)}},n}(e.FitComponent);e.PrologueHUD=t,__reflect(t.prototype,"UI.PrologueHUD",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.remainingTime=new RemainingTime,n.txtBossName="Bạch KhởiLý Tư",n.txtLeftTimeLabel="999/120000000",n.skinName="QinB1HUDSkin",n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.btnExit.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onExit,n),n.list.itemRenderer=e.QinResultItem,n}return __extends(n,t),n.prototype.onAddToStage=function(){SecondTicker.addEventListener(this.onTimer,this)},n.prototype.onRemoveFromStage=function(){SecondTicker.removeEventListener(this.onTimer,this)},n.prototype.onExit=function(){var t=this,n=lang.String("operation confirm"),i=lang.StringWithFormat("qinmausoleum confirm leave");e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],n,i,function(){return t.onConfirmExit(),!0},null,null)},n.prototype.onConfirmExit=function(){net.socket.write(141,null)},Object.defineProperty(n.prototype,"second",{set:function(e){this.remainingTime.delta=e,this.onTimer()},enumerable:!0,configurable:!0}),n.prototype.onTimer=function(){this.lefttime=this.remainingTime.getMinuteSecond()},n.prototype.updateTopList=function(e){for(var t=[],n=0;n<e.length;n++)t.push({rank:n+1,name:e[n].guild,score:e[n].score});this.list.dataProvider=new eui.ArrayCollection(t)},n}(e.FitComponent);e.QinB1HUD=t,__reflect(t.prototype,"UI.QinB1HUD",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.isClosed1=!0,e.isClosed2=!0,e.roleCount1=0,e.roleCount2=0,e.guildCount1=0,e.guildCount2=0,e.skinName="QinEntranceSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.radioGroup=new eui.RadioButtonGroup,e.btnNorth.group=e.radioGroup,e.btnSouth.group=e.radioGroup,e.radioGroup.addEventListener(eui.UIEvent.CHANGE,e.onSign,e),e.awards0.dataProvider=new eui.ArrayCollection(QinMausoleum.awardsData),e.awards1.dataProvider=new eui.ArrayCollection(QinMausoleum.awardsData),QinMausoleum.requestServerEntranceInfo(),e}return __extends(n,t),n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.QinMausoleumEntranceInfo,this.onServerEntranceInfo,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.QinMausoleumEntranceInfo,this.onServerEntranceInfo,this)},n.prototype.onTouchTap=function(t){switch(t.target){case this.imgClose:this.close();break;case this.btnRules:var n=new e.Rule;n.skinName="GuildRulesSkin",n.currentState="qinRule",UIManager.pushPage(n)}},n.prototype.close=function(){UIManager.pop(this)},n.prototype.onSign=function(e){var t=QinMausoleum.onSign(parseInt(this.radioGroup.selectedValue));t.result?UIManager.pop(this):PopUpMessage.push(t.msg,color.RED)},n.prototype.onServerEntranceInfo=function(e){this.updateEntranceInfo(e.data)},n.prototype.updateEntranceInfo=function(e){var t=e.getItems();if(this.isClosed1=!0,this.isClosed2=!0,this.roleCount1=0,this.roleCount2=0,this.guildCount1=0,this.guildCount2=0,t){var n=t[1];n&&(this.isClosed1=n.closed,this.roleCount1=n.roleCount,this.guildCount1=n.guildRoleCount),n=t[0],n&&(this.isClosed2=n.closed,this.roleCount2=n.roleCount,this.guildCount2=n.guildRoleCount)}},n}(e.FitComponent);e.QinEntrance=t,__reflect(t.prototype,"UI.QinEntrance",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="QinResultSkin",n.imgClose.addEventListener(egret.TouchEvent.TOUCH_TAP,n.close,n),n.selfAwardList.itemRenderer=e.AwardCell,n.guildAwardList.itemRenderer=e.AwardCell,n}return __extends(n,t),n.prototype.update=function(e,t,n,i){this.myScroe=e,this.myRank=t,this.guildAwardList.dataProvider=new eui.ArrayCollection(n),i&&i.length>0?(this.lblSelfAwardTip.visible=!1,this.selfAwardList.dataProvider=new eui.ArrayCollection(i)):this.lblSelfAwardTip.visible=!0},n.prototype.close=function(){UIManager.pop(this),Auction.showUi()},n}(e.FitComponent);e.QinResult=t,__reflect(t.prototype,"UI.QinResult",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="QinResultItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){switch(this.data.name==Player.instance.Name?this.select=!0:this.select=!1,this.rank=null,this.data.rank){case 1:this.rankIcon="ui/ranking/first_icon.png";break;case 2:this.rankIcon="ui/ranking/second_icon.png";break;case 3:this.rankIcon="ui/ranking/third_icon.png";break;default:this.rankIcon="ui/ranking/0.png",this.rank=this.data.rank}},t}(eui.ItemRenderer);e.QinResultItem=t,__reflect(t.prototype,"UI.QinResultItem")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="RankAwardItemSkin",n.listAward.itemRenderer=e.AwardCell,n}return __extends(n,t),n.prototype.dataChanged=function(){this.listAward.dataProvider=new eui.ArrayCollection(this.data.viewAward)},n}(eui.ItemRenderer);e.RankAwardItem=t,__reflect(t.prototype,"UI.RankAwardItem")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="RankAwardListSkin",n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.round=0,n.myRank="-",n.rankList.itemRenderer=e.RankAwardListItem,n}return __extends(n,t),n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.RankAwardDataChange,this.onRankAwardDataChange,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.RankAwardDataChange,this.onRankAwardDataChange,this)},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},n.prototype.onRankAwardDataChange=function(){this.updateRankList()},n.prototype.setRankType=function(e){this.rankType=e,this.currentState=""+this.rankType,this.updateRankList()},n.prototype.updateRankList=function(){this.leftTime=RankAward.GetNextTimeStr(),this.lableTitle.text=this.getTitle();var e=RankAward.GetRankAwardData(this.rankType);null!=e&&(this.round=e.round,this.lableTitle.text=this.getTitle(),e.rank.length>0&&(this.rankList.dataProvider=new eui.ArrayCollection(e.rank)),e.myRank>0?this.myRank=""+e.myRank:this.myRank="-")},n.prototype.getTitle=function(){var e="Hạng Cấp";return 1==this.rankType&&(e="Hạng L.Chiến"),this.round>0&&(e=1==this.rankType?"Hạng Lực Chiến Đợt "+this.round:"Hạng Cấp Đợt "+this.round),e},n}(e.FitComponent);e.RankAwardList=t,__reflect(t.prototype,"UI.RankAwardList",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="RankAwardListItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){null!=this.data.vip&&(this.imgVip.source=Vip.getVipIcon(this.data.vip))},t}(eui.ItemRenderer);e.RankAwardListItem=t,__reflect(t.prototype,"UI.RankAwardListItem")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(e){var n=t.call(this)||this;return n.skinName="RankAwardPageSkin",n.touchEnabled=!1,n.rankType=e,n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.tabPage.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onChangePage,n),n.btnRules.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onBtnRule,n),n.pageStack.selectedIndex=0,n.tabPage.selectedIndex=0,n.awardPage.setRankType(n.rankType),n.listPage.setRankType(n.rankType),n}return __extends(n,t),n.prototype.onAddToStage=function(){this.applyRankList(),this.UpdatePage()},n.prototype.applyRankList=function(){RankAward.ApplyRankAwardData(this.rankType)},n.prototype.onRemoveFromStage=function(){},n.prototype.UpdatePage=function(){return null!=this.pageId?void this.openPage(this.pageId):void 0},n.prototype.openPage=function(e){return null==this.tabPage?void(this.pageId=e):(e>=0&&e<this.pageStack.length&&(this.pageStack.selectedIndex=e,this.tabPage.selectedIndex=e),void(this.pageId=null))},n.prototype.onChangePage=function(){this.pageStack.length-1>=this.tabPage.selectedIndex&&(this.pageStack.selectedIndex=this.tabPage.selectedIndex)},n.prototype.onBtnRule=function(){switch(this.rankType){case 0:e.GameTip.instance.open("rankAwardLevel");break;case 1:e.GameTip.instance.open("rankAwardFP")
}},n}(eui.Component);e.RankAwardPage=t,__reflect(t.prototype,"UI.RankAwardPage",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="RankAwardUISkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.round=1,e.myRank="-",e}return __extends(n,t),n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.RankAwardDataChange,this.onRankAwardDataChange,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.RankAwardDataChange,this.onRankAwardDataChange,this)},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},n.prototype.setRankType=function(e){this.rankType=e,this.currentState=""+this.rankType,this.updateRankList()},n.prototype.onRankAwardDataChange=function(){this.updateRankList()},n.prototype.updateRankList=function(){this.leftTime=RankAward.GetNextTimeStr(),this.lableTitle.text=this.getTitle();var t=table.getRankAwardConfig(this.rankType,this.round);if(null!=t){this.awardList.itemRenderer=e.RankAwardItem,this.awardList.dataProvider=new eui.ArrayCollection(t.awards);var n=RankAward.GetRankAwardData(this.rankType);if(null!=n)return this.round<4&&this.round!=n.round+1?(this.round=n.round+1,this.round>4&&(this.round=4),this.updateRankList()):void(n.myRank>0?this.myRank=""+n.myRank:this.myRank="-")}},n.prototype.getTitle=function(){var e="Hạng Cấp";return 1==this.rankType&&(e="Hạng L.Chiến"),this.round>0&&(e=1==this.rankType?"Đua Lưc Chiến  Thưởng Tuần "+this.round:"Đua Cấp  Thưởng Tuần "+this.round),e},n}(e.FitComponent);e.RankAwardUI=t,__reflect(t.prototype,"UI.RankAwardUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="ActivityRechargeItemSkin",n.awardList.itemRenderer=e.AwardCell,n.typeDesc=lang.String("totalConsumption"),n.btnDraw.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onDraw,n),n}return __extends(n,t),n.prototype.dataChanged=function(){switch(this.awardList.dataProvider=new eui.ArrayCollection(ActivityConsumption.awardsConfig[this.data.idx].awards),this.count=ActivityConsumption.awardsConfig[this.data.idx].amount,this.btnDraw.visible=!0,this.data.status){case 1:this.btnDraw.label=lang.String("receive"),this.btnDraw.enabled=!0;break;case 2:this.btnDraw.visible=!1;break;default:this.btnDraw.label=lang.String("receive"),this.btnDraw.enabled=!1}},n.prototype.onDraw=function(){var e=new net.def.Index;e.setIndex(this.data.idx),net.socket.write(105,e.toArrayBuffer())},n}(eui.ItemRenderer);e.ActivityConsumptionItem=t,__reflect(t.prototype,"UI.ActivityConsumptionItem")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="ActivityConsumptionUISkin",n.touchEnabled=!1,n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.btnCharge.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onCharge,n),n.list.itemRenderer=e.ActivityConsumptionItem,n}return __extends(n,t),n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.ActivityConsumptionStatus,this.onRefreshAwards,this),Game.dispatcher.addEventListener(Game.EVENT.ActivityTotalConsumption,this.onRefreshAmass,this),this.openDate.text=Activity.getLastTime(ActivityConsumption.activity.kindId),this.onRefreshAmass(),this.onRefreshAwards()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.ActivityConsumptionStatus,this.onRefreshAwards,this),Game.dispatcher.removeEventListener(Game.EVENT.ActivityTotalConsumption,this.onRefreshAmass,this)},n.prototype.onRefreshAmass=function(){this.amassYuanbao=""+ActivityConsumption.totalConsumption},n.prototype.onRefreshAwards=function(){for(var e=this.list.dataProvider,t=ActivityConsumption.awardsStatus,n=[],i=0;i<ActivityConsumption.awardsConfig.length;i++)n.push({idx:i,status:t[i]||0});n.sort(Recharge.sortStatus),null==e?this.list.dataProvider=new eui.ArrayCollection(n):e.replaceAll(n)},n.prototype.onCharge=function(){UIManager.openMysteryShop()},n}(eui.Component);e.ActivityConsumptionUI=t,__reflect(t.prototype,"UI.ActivityConsumptionUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="ActivityRechargeItemSkin",n.awardList.itemRenderer=e.AwardCell,n.typeDesc=lang.String("openingCharges"),n.btnDraw.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onDraw,n),n}return __extends(n,t),n.prototype.dataChanged=function(){switch(this.awardList.dataProvider=new eui.ArrayCollection(ActivityRecharge.awardsConfig[this.data.idx].awards),this.count=ActivityRecharge.awardsConfig[this.data.idx].amount,this.btnDraw.visible=!0,this.data.status){case 1:this.btnDraw.label=lang.String("receive"),this.btnDraw.enabled=!0;break;case 2:this.btnDraw.visible=!1;break;default:this.btnDraw.label=lang.String("receive"),this.btnDraw.enabled=!1}},n.prototype.onDraw=function(){var e=new net.def.Index;e.setIndex(this.data.idx),net.socket.write(98,e.toArrayBuffer())},n}(eui.ItemRenderer);e.ActivityRechargeItem=t,__reflect(t.prototype,"UI.ActivityRechargeItem")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="ActivityRechargeUISkin",t.touchEnabled=!1,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.btnCharge.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onCharge,t),t}return __extends(t,e),t.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.ActivityRechargeStatus,this.onRefreshAwards,this),Game.dispatcher.addEventListener(Game.EVENT.ActivityTotalRecharge,this.onRefreshAmass,this),this.openDate.text=Activity.getLastTime(ActivityRecharge.activity.kindId),this.onRefreshAmass(),this.onRefreshAwards()},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.ActivityRechargeStatus,this.onRefreshAwards,this),Game.dispatcher.removeEventListener(Game.EVENT.ActivityTotalRecharge,this.onRefreshAmass,this)},t.prototype.onRefreshAmass=function(){this.amassYuanbao=""+ActivityRecharge.totalRecharge},t.prototype.onRefreshAwards=function(){for(var e=this.list.dataProvider,t=ActivityRecharge.awardsStatus,n=[],i=0;i<ActivityRecharge.awardsConfig.length;i++)n.push({idx:i,status:t[i]||0});n.sort(Recharge.sortStatus),null==e?this.list.dataProvider=new eui.ArrayCollection(n):e.replaceAll(n)},t.prototype.onCharge=function(){Recharge.openRechargeUI()},t}(eui.Component);e.ActivityRechargeUI=t,__reflect(t.prototype,"UI.ActivityRechargeUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="DailyRechargeAwardSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.dataChanged=function(){null!=this.data&&(this.cell.data=this.data.award,null!=this.data.day?this.tips=lang.StringWithFormat("recharge {1}days",this.data.day):this.tips="",2==this.data.state?this.currentState="finish":this.currentState="charge")},n.prototype.onTouchTap=function(t){switch(t.target){case this.cell:e.ItemTips.instance.data=this.data.award,UIManager.push(e.ItemTips.instance)}},n}(eui.ItemRenderer);e.DailyRechargeAward=t,__reflect(t.prototype,"UI.DailyRechargeAward",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="DailyRechargeItemSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.dataChanged=function(){this.list.dataProvider=new eui.ArrayCollection(this.data.award),this.btnGetAward.enabled=1==this.data.state,this.btnGetAward.visible=2!=this.data.state,this.labelDesc.textFlow=Game.HtmlTextParser.parse("Tích lũy nạp <font color="+egret.toColorString(color.Title2)+">"+this.data.day+"</font> ngày")},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnGetAward:DailyRecharge.drawAward(this.data.day-1);break;default:return}},t}(eui.ItemRenderer);e.DailyRechargeItem=t,__reflect(t.prototype,"UI.DailyRechargeItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="DailyRechargeUISkin",t.touchEnabled=!1,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.titleDesc.textFlow=Game.HtmlTextParser.parse(lang.StringWithFormat("dailyrecharge gold{1} to finish","<font color="+egret.toColorString(color.Title1_Value)+">"+DailyRecharge.threshold+"</font>")),t}return __extends(t,e),t.prototype.onAddToStage=function(){this.onRefreshDailyStatus(),this.updateGold(),Game.dispatcher.addEventListener(Game.EVENT.DailyRechargeGold,this.updateGold,this),Game.dispatcher.addEventListener(Game.EVENT.DailyRechargeSyncState,this.onRefreshDailyStatus,this)},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.DailyRechargeGold,this.updateGold,this),Game.dispatcher.removeEventListener(Game.EVENT.DailyRechargeSyncState,this.onRefreshDailyStatus,this)},t.prototype.onRefreshDailyStatus=function(){for(var e=[],t=0;t<DailyRecharge.awardsConfig.length;t++)e.push({day:DailyRecharge.awardsConfig[t].day,award:DailyRecharge.awardsConfig[t].awards,state:DailyRecharge.awardsStatus[t]||0});e.sort(function(e,t){return 2==e.state&&2!=t.state?1:2!=e.state&&2==t.state?-1:e.day-t.day});var n=this.listDailyAward.dataProvider;null==n?this.listDailyAward.dataProvider=new eui.ArrayCollection(e):n.replaceAll(e);var i=this.listTotalAward.dataProvider;null==i?this.listTotalAward.dataProvider=new eui.ArrayCollection(DailyRecharge.dataDisplayAwards):i.replaceAll(DailyRecharge.dataDisplayAwards),this.updateGold()},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnRecharge:Recharge.openRechargeUI()}},t.prototype.updateGold=function(){this.labelGold.textFlow=Game.HtmlTextParser.parse(DailyRecharge.getTodayStatus()),this.finishDays=DailyRecharge.day+" / "+DailyRecharge.awardsConfig.length},t}(eui.Component);e.DailyRechargeUI=t,__reflect(t.prototype,"UI.DailyRechargeUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="FirstBoxSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.list1.dataProvider=new eui.ArrayCollection(Recharge.firstboxConfig.awards1),e}return __extends(n,t),n.open=function(){return null==this._instance&&(this._instance=new n),UIManager.push(this._instance),this._instance},n.prototype.close=function(){UIManager.pop(this)},n.prototype.onAddToStage=function(){this.onRefresh(),Game.dispatcher.addEventListener(Game.EVENT.FirstChargeGift,this.onRefresh,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.FirstChargeGift,this.onRefresh,this)},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnClose:this.close();break;case this.btnAward:switch(Recharge.FirstChargeGift){case 0:this.close(),e.RechargeUI.open()}}},n.prototype.onRefresh=function(){var e=Recharge.firstboxConfig.awards1;switch(Recharge.FirstChargeGift){case 0:this.btnAward.visible=!0,this.btnAward.label="Nạp";for(var t=0;t<e.length;t++)e[t].status=Recharge.FirstBoxNone;this.list1.dataProvider=new eui.ArrayCollection(e);break;case 1:this.btnAward.visible=!1,e=Recharge.firstboxConfig.awards1,e[0].status=Recharge.FirstBoxUndrawn,e[1].status=Recharge.FirstBoxForbidDrawn,e[2].status=Recharge.FirstBoxForbidDrawn,this.list1.dataProvider=new eui.ArrayCollection(e);break;case 2:this.btnAward.visible=!1,e=Recharge.firstboxConfig.awards1,e[0].status=Recharge.FirstBoxdrawn,e[1].status=Recharge.FirstBoxUndrawn,e[2].status=Recharge.FirstBoxForbidDrawn,this.list1.dataProvider=new eui.ArrayCollection(e);break;case 3:this.btnAward.visible=!1,e=Recharge.firstboxConfig.awards1,e[0].status=Recharge.FirstBoxdrawn,e[1].status=Recharge.FirstBoxdrawn,e[2].status=Recharge.FirstBoxUndrawn,this.list1.dataProvider=new eui.ArrayCollection(e);break;case 4:this.btnAward.visible=!1,e=Recharge.firstboxConfig.awards1,e[0].status=Recharge.FirstBoxdrawn,e[1].status=Recharge.FirstBoxdrawn,e[2].status=Recharge.FirstBoxdrawn,this.list1.dataProvider=new eui.ArrayCollection(e)}},n}(e.FitComponent);e.FirstBox=t,__reflect(t.prototype,"UI.FirstBox",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="FirstBoxItemSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.onTouchTap=function(e){switch(e.target){case this.btnget:net.socket.write(2050,null)}},t.prototype.dataChanged=function(){this.desc.textFlow=Game.HtmlTextParser.parse(lang.StringWithFormat("FristBox AwardDesc{1}{2}",this.data.index,this.data.coin)),this.list.dataProvider=new eui.ArrayCollection(this.data.award),this.data.status==Recharge.FirstBoxNone?(this.btnget.enabled=!1,this.btnget.visible=!1,this.imgdrawn.visible=!0):this.data.status==Recharge.FirstBoxUndrawn?(this.btnget.enabled=!0,this.btnget.visible=!0,this.imgdrawn.visible=!1,this.btnget.label="Nhận"):this.data.status==Recharge.FirstBoxdrawn?(this.btnget.enabled=!1,this.btnget.visible=!0,this.imgdrawn.visible=!1,this.btnget.label="Đã nhận"):this.data.status==Recharge.FirstBoxForbidDrawn&&(this.btnget.enabled=!1,this.btnget.visible=!0,this.imgdrawn.visible=!1,this.btnget.label="Nhận"),1==Recharge.FirstBoxTodayDrawn&&(this.btnget.enabled=!1)},t}(eui.ItemRenderer);e.FirstBoxItem=t,__reflect(t.prototype,"UI.FirstBoxItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="FlashSaleItemSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.dataChanged=function(){switch(this.currentState=this.data.saleState,this.btnBuy.visible=this.data.amount>0,this.sellOutImg.visible=!this.btnBuy.visible,this.data.discount){case 20:case 30:case 40:case 50:case 60:case 70:case 80:this.discountIcon="ui/shop/"+this.data.discount+".png";break;default:this.discountIcon=""}this.newPrice=Math.floor(this.data.price*this.data.discount/100),this.cell.data=this.data.item;var e=this.data.item.content.genre,t=this.data.item.content.detailType,n=table.props[e][t];this.itemName.text=n.name,this.itemName.textColor=Item.QualityColor[this.cell.quality];var i=this.list.dataProvider;i?i.replaceAll(this.data.awards):this.list.dataProvider=new eui.ArrayCollection(this.data.awards)},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnBuy:if(PlayerAttribute.currency[Game.Currency.GoldCoin]<this.newPrice)return UIManager.push(new e.GoldCoinPrompt),void PopUpMessage.push(lang.String("not enough goldcoin"),color.RED);ActivityFlashSale.c2s_buy(this.data.idx)}},n}(eui.ItemRenderer);e.FlashSaleItem=t,__reflect(t.prototype,"UI.FlashSaleItem")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="FlashSaleUISkin",t.touchEnabled=!1,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.remainTime=new RemainingTime,t}return __extends(t,e),t.prototype.onAddToStage=function(){ActivityFlashSale.c2s_apply(),this.onRefreshStatus(),Game.dispatcher.addEventListener(Game.EVENT.ActivityFlashSaleAmount,this.onRefreshAmount,this),Game.dispatcher.addEventListener(Game.EVENT.ActivityFlashSaleStatus,this.onRefreshStatus,this),SecondTicker.addEventListener(this.onTimer,this)},t.prototype.onRemoveFromStage=function(){ActivityFlashSale.c2s_Unsubscribe(),SecondTicker.removeEventListener(this.onTimer,this),Game.dispatcher.removeEventListener(Game.EVENT.ActivityFlashSaleAmount,this.onRefreshAmount,this),Game.dispatcher.removeEventListener(Game.EVENT.ActivityFlashSaleStatus,this.onRefreshStatus,this)},t.prototype.onTimer=function(){this.remainTime.delta<0?this.lastTime="00:00:00":this.lastTime=this.remainTime.getHourMinuteSecond()},t.prototype.onRefreshAmount=function(){for(var e=[],t=ActivityFlashSale.status.batch,n=ActivityFlashSale.goodsConfig[t],i=0;i<n.length;i++)e.push({idx:n[i].idx,item:n[i].item,awards:n[i].awards,price:n[i].price,discount:n[i].discount,amount:ActivityFlashSale.awardsAmount[i]||0,saleState:1==ActivityFlashSale.status.sale?"selling":"waiting",stock:n[i].amount});var a=this.list.dataProvider;a?a.replaceAll(e):this.list.dataProvider=new eui.ArrayCollection(e)},t.prototype.onRefreshStatus=function(){this.tips=ActivityFlashSale.status.nextRound?lang.String("start selling"):lang.String("refresh shop"),this.remainTime.delta=ActivityFlashSale.getLastTime(),this.onTimer(),this.onRefreshAmount()},t}(eui.Component);e.FlashSaleUI=t,__reflect(t.prototype,"UI.FlashSaleUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="FortunePlanItemSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.dataChanged=function(){this.list.dataProvider=new eui.ArrayCollection(this.data.award),this.SetButton(this.data.flag),this.SetLable(this.data.flag),this.SetBlock(this.data.flag)},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnGetAward:FortunePlan.AwardOperation(this.data.level,this.data.flag);break;default:return}},t.prototype.GetAwardFlag=function(){return this.data.flag==FortunePlan.CoinType.Coin?FortunePlan.awardflag>>this.data.level-1&1:this.data.flag==FortunePlan.CoinType.BindCoin?FortunePlan.awardflag>>this.data.level+15&1:0},t.prototype.SetButton=function(e){if(FortunePlan.state==FortunePlan.FortunePlanState.State_Invest)this.btnGetAward.enabled=!0,this.btnGetAward.label="Gửi",this.szYLQ.textFlow=Game.HtmlTextParser.parse("Đã gửi"),this.data.flag==FortunePlan.CoinType.Coin?this.btnGetAward.visible=this.data.level>FortunePlan.coinlevel:this.btnGetAward.visible=this.data.level>FortunePlan.bindcoinlevel;else if(FortunePlan.state==FortunePlan.FortunePlanState.State_Refund){this.btnGetAward.label="Nhận",this.szYLQ.textFlow=Game.HtmlTextParser.parse("Đã nhận");var t=this.GetAwardFlag();this.btnGetAward.enabled=!1;var n=void 0;n=this.data.flag==FortunePlan.CoinType.Coin?FortunePlan.coinlevel:FortunePlan.bindcoinlevel,0>=n?this.btnGetAward.visible=!0:0==t&&this.data.level<=FortunePlan.day?(this.btnGetAward.visible=!0,this.btnGetAward.enabled=!0):this.data.level>FortunePlan.day?this.btnGetAward.visible=!0:1==t&&(this.btnGetAward.visible=!1)}},t.prototype.SetLable=function(e){if(FortunePlan.state==FortunePlan.FortunePlanState.State_Invest){var t=FortunePlan.GetNeedCoin(this.data.level,e);this.szDesc1.textFlow=Game.HtmlTextParser.parse("Gửi"),this.szDesc2.textFlow=Game.HtmlTextParser.parse(StringWithFormat('<font color="#1378DB"> hoàn trả tích lũy {1} ngày</font>',this.data.totalday)),this.szCoinCount.textFlow=Game.HtmlTextParser.parse(t.toString()),this.szCoinCount.visible=!0,e==FortunePlan.CoinType.BindCoin?(this.imgBindCoin.visible=!1,this.imgCoin.visible=!0):e==FortunePlan.CoinType.Coin&&(this.imgBindCoin.visible=!0,this.imgCoin.visible=!1)}else if(FortunePlan.state==FortunePlan.FortunePlanState.State_Refund){this.data.totalday?(this.szDesc1.textFlow=Game.HtmlTextParser.parse(StringWithFormat("Đăng nhập {1} lần",this.data.level)),this.szDesc2.text=""):(this.szDesc1.text=lang.String("inactivate"),this.szDesc2.text=""),this.imgBindCoin.visible=!1,this.imgCoin.visible=!1,this.szCoinCount.visible=!1,this.szDesc2.visible=!0;var n=this.GetAwardFlag();1==n&&(this.szDesc2.visible=!1)}},t.prototype.SetBlock=function(e){if(FortunePlan.state==FortunePlan.FortunePlanState.State_Invest){var t=FortunePlan.coinlevel;e==FortunePlan.CoinType.BindCoin&&(t=FortunePlan.bindcoinlevel),this.data.level==t?(this.szYLQ.visible=!0,this.imgLay.visible=!0,this.imgblock.visible=!1,this.imgInvestlevel.visible=!0):this.data.level<t?(this.szYLQ.visible=!1,this.imgLay.visible=!1,this.imgblock.visible=!0,this.imgInvestlevel.visible=!1):(this.imgblock.visible=!1,this.imgInvestlevel.visible=!1)}else FortunePlan.state==FortunePlan.FortunePlanState.State_Refund&&(this.imgblock.visible=!1,this.imgInvestlevel.visible=!1)},t}(eui.ItemRenderer);e.FortunePlanItemUI=t,__reflect(t.prototype,"UI.FortunePlanItemUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="FortunePlanSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.btnRules.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onBtnRule,e),e.tabPage.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onChangePage,e),e}return __extends(n,t),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},n.prototype.onChangePage=function(){0==this.tabPage.selectedIndex?this.RefreashCoinPage():this.RefreashBindCoinPage()},n.prototype.onAddToStage=function(){this.nowpage=FortunePlan.CoinType.Coin,this.tabPage.selectedIndex=0,FortunePlan.AskPlanerData(),Game.dispatcher.addEventListener(Game.EVENT.FortunePlanDataChange,this.RefreashPage,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.FortunePlanDataChange,this.RefreashPage,this)},n.prototype.onTouchTap=function(e){},n.prototype.RefreashPage=function(){this.szPlanDesc.textFlow=Game.HtmlTextParser.parse(FortunePlan.GetActivityDateString()),this.nowpage==FortunePlan.CoinType.Coin&&this.RefreashCoinPage(),this.nowpage==FortunePlan.CoinType.BindCoin&&this.RefreashBindCoinPage()},n.prototype.RefreashCoinPage=function(){this.nowpage=FortunePlan.CoinType.Coin;var e=[];if(FortunePlan.state==FortunePlan.FortunePlanState.State_Invest)for(var t=0;t<FortunePlan.dataInvestAwards.length;t++)e.push({level:FortunePlan.dataInvestAwards[t].level,totalday:FortunePlan.dataInvestAwards[t].totalday,award:FortunePlan.dataInvestAwards[t].award,flag:FortunePlan.CoinType.Coin});else if(FortunePlan.state==FortunePlan.FortunePlanState.State_Refund&&0!=FortunePlan.coinlevel){for(var n=FortunePlan.dataRefundAwards[FortunePlan.coinlevel-1].totalday,i=[],t=0;n>t;t++)0==FortunePlan.GetAwardState(t+1,FortunePlan.CoinType.Coin)?e.push({level:t+1,totalday:FortunePlan.dataRefundAwards[FortunePlan.coinlevel-1].totalday,award:FortunePlan.dataRefundAwards[FortunePlan.coinlevel-1].award,flag:FortunePlan.CoinType.Coin}):i.push({level:t+1,totalday:FortunePlan.dataRefundAwards[FortunePlan.coinlevel-1].totalday,award:FortunePlan.dataRefundAwards[FortunePlan.coinlevel-1].award});for(var t=0;t<i.length;t++)e.push({level:i[t].level,totalday:i[t].totalday,award:i[t].award,flag:FortunePlan.CoinType.Coin})}else if(FortunePlan.state==FortunePlan.FortunePlanState.State_Refund&&0==FortunePlan.coinlevel)for(var t=0;t<FortunePlan.dataInvestAwards.length;t++)e.push({level:FortunePlan.dataInvestAwards[t].level,totalday:null,award:FortunePlan.dataInvestAwards[t].award,flag:FortunePlan.CoinType.Coin});var a=this.listFortuneAward.dataProvider;null==a?this.listFortuneAward.dataProvider=new eui.ArrayCollection(e):a.replaceAll(e)},n.prototype.RefreashBindCoinPage=function(){this.nowpage=FortunePlan.CoinType.BindCoin;var e=[];if(FortunePlan.state==FortunePlan.FortunePlanState.State_Invest)for(var t=0;t<FortunePlan.dataInvestAwards.length&&null!=FortunePlan.dataInvestAwards[t].bindcoinaward;t++)e.push({level:FortunePlan.dataInvestAwards[t].level,totalday:FortunePlan.dataInvestAwards[t].totalday,award:FortunePlan.dataInvestAwards[t].bindcoinaward,flag:FortunePlan.CoinType.BindCoin});else if(FortunePlan.state==FortunePlan.FortunePlanState.State_Refund&&0!=FortunePlan.bindcoinlevel){for(var n=FortunePlan.dataRefundAwards[FortunePlan.bindcoinlevel-1].totalday,i=[],t=0;n>t;t++)0==FortunePlan.GetAwardState(t+1,FortunePlan.CoinType.BindCoin)?e.push({level:t+1,totalday:FortunePlan.dataRefundAwards[FortunePlan.bindcoinlevel-1].totalday,award:FortunePlan.dataRefundAwards[FortunePlan.bindcoinlevel-1].bindcoinaward,flag:FortunePlan.CoinType.BindCoin}):i.push({level:t+1,totalday:FortunePlan.dataRefundAwards[FortunePlan.bindcoinlevel-1].totalday,award:FortunePlan.dataRefundAwards[FortunePlan.bindcoinlevel-1].bindcoinaward});for(var t=0;t<i.length;t++)e.push({level:i[t].level,totalday:i[t].totalday,award:i[t].award,flag:FortunePlan.CoinType.BindCoin})}else if(FortunePlan.state==FortunePlan.FortunePlanState.State_Refund&&0==FortunePlan.bindcoinlevel)for(var t=0;t<FortunePlan.GetBindAwardCount();t++)e.push({level:FortunePlan.dataInvestAwards[t].level,totalday:null,award:FortunePlan.dataInvestAwards[t].bindcoinaward,flag:FortunePlan.CoinType.BindCoin});var a=this.listFortuneAward.dataProvider;null==a?this.listFortuneAward.dataProvider=new eui.ArrayCollection(e):a.replaceAll(e)},n.prototype.onBtnRule=function(){e.GameTip.instance.open("fortuneplan")},n}(eui.Component);e.FortunePlanUI=t,__reflect(t.prototype,"UI.FortunePlanUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.awardId=0,e.target="",e.skinName="HeroicCardAwardCellSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.SetAwardId=function(e,t){this.awardId=e;var n=table.heroicCardCfg.awards[this.awardId].award,i=table.props[n.genre][n.id].source,a=table.props[n.genre][n.id].quality,r=n.cnt;this.cell.quality=a,this.cell.icon=i,this.target=lang.StringWithFormat("HeroicCard {1}point",t),1>=r?this.cell.rbcorner=null:this.cell.rbcorner=r.toString(),this.cell.genre=n.genre},n.prototype.onTouchTap=function(t){switch(t.target){case this.cell:if("Useable"==this.currentState){var n=new net.def.C2SHeroicCardAwardReq;n.setAwardId(this.awardId),net.socket.write(2044,n.toArrayBuffer())}else{var i=table.heroicCardCfg.awards[this.awardId].award;e.ItemTips.instance.data={type:"item",content:{genre:i.genre,detailType:i.id,count:i.cnt}},UIManager.push(e.ItemTips.instance)}}},n}(eui.Component);e.HeroicCardAwardCell=t,__reflect(t.prototype,"UI.HeroicCardAwardCell",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.handle=null,e.skinName="HeroicCardItemSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),n.prototype.dataChanged=function(){this.Update()},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnFinish:if(null==this.handle){var t=new net.def.C2SHeroicCardFinishReq;t.setMissionId(this.data.id),net.socket.write(2039,t.toArrayBuffer())}else this.handle()}},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.HeroicCardSingleUpdate,this.Update,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.HeroicCardSingleUpdate,this.Update,this)},n.prototype.format=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return e.replace(/{(\d+)}/g,function(e,n){return t[n-1]})},n.prototype.getTargetString=function(e,t,n,i){switch(e){case HeroicCard.MissionId.Heroiccard_kill_mission:case HeroicCard.MissionId.Heroiccard_enhance_mission:case HeroicCard.MissionId.Heroiccard_gem_mission:case HeroicCard.MissionId.Heroiccard_partner_mission:case HeroicCard.MissionId.Heroiccard_songjin_mission:case HeroicCard.MissionId.Heroiccard_recharge_mission:return this.format(t,n,i);case HeroicCard.MissionId.Heroiccard_liansai_mission:return this.format(t,WulinLiansai.GetRankNameByLevel(i));case HeroicCard.MissionId.Heroiccard_equip_mission:return this.format(t,i)}return""},n.prototype.Update=function(){if(null!=this.data.id){var t=table.heroicCardCfg.missions[this.data.id],n=HeroicCard.hcMsTasks[this.data.id],i=t.tasks.length-1,a=n.value;HeroicCard.isFinished(this.data.id)||(i=n.targetId);var r=t.tasks[i].target;this.missionName=t.name,this.targetString=this.getTargetString(this.data.id,t.desc,a,r),this.awardable=!1,this.currentState="finished",HeroicCard.isFinished(this.data.id)||(this.currentState="goto",a>=r&&(this.currentState="complete")),this.awardList.itemRenderer=e.AwardCell,this.awardList.dataProvider=new eui.ArrayCollection(table.HeroCardShowAward[t.tasks[i].viewAward]),this.UpdateButton()}},n.prototype.UpdateButton=function(){if(this.handle=null,"goto"==this.currentState){if(!HeroicCard.inActTime())return void(this.btnFinish.enabled=!1);this.btnFinish.enabled=!0;var t=table.heroicCardCfg.missions[this.data.id];switch(t.missionKeyword){case"kill_mission":this.handle=function(){Operation.open(Operation.Type.OpenWorldMap)};break;case"enhance_mission":this.handle=function(){UIManager.openEnhancement()};break;case"gem_mission":this.handle=function(){UIManager.openGem()};break;case"equip_mission":this.handle=function(){UIManager.openPlayerUI()};break;case"partner_mission":this.handle=function(){UIManager.openPartnerUI()};break;case"songjin_mission":this.handle=function(){UIManager.pushPage(new e.CrossServerSongJinWar)};break;case"liansai_mission":this.handle=function(){WulinLiansai.OpenPanel(!0)};break;case"recharge_mission":this.handle=function(){Recharge.openRechargeUI()}}}},n}(eui.ItemRenderer);e.HeroicCardItem=t,__reflect(t.prototype,"UI.HeroicCardItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.taskListData=[],e.skinName="HeroicCardUISkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.HeroicCardAllUpdate,this.UpdatePage,this),Game.dispatcher.addEventListener(Game.EVENT.HeroicCardSingleUpdate,this.UpdateHeroicPoint,this),this.awardItems=[],this.awardItems.push(this.awardItem1),this.awardItems.push(this.awardItem2),this.awardItems.push(this.awardItem3),this.awardItems.push(this.awardItem4),this.awardItems.push(this.awardItem5),this.UpdatePage()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.HeroicCardSingleUpdate,this.UpdateHeroicPoint,this),Game.dispatcher.removeEventListener(Game.EVENT.HeroicCardSingleUpdate,this.UpdateHeroicPoint,this)},n.prototype.GetServerDate=function(e){var t=Game.getServerDate();return new Date(t.getFullYear(),t.getMonth(),t.getDate()+e,t.getHours(),t.getMinutes(),t.getSeconds())},n.prototype.UpdatePage=function(){var t=(Game.getServerDate(),this.GetServerDate(table.heroicCardCfg.startActEraDay-Game.countEraDay())),n=this.GetServerDate(table.heroicCardCfg.endActEraDay-Game.countEraDay()),i=this.GetServerDate(table.heroicCardCfg.startAwardEraDay-Game.countEraDay()),a=this.GetServerDate(table.heroicCardCfg.endAwardEraDay-Game.countEraDay()),r=t.getDate().toString()+"/"+(t.getMonth()+1).toString(),o=n.getDate().toString()+"/"+(n.getMonth()+1).toString(),s=i.getDate().toString()+"/"+(i.getMonth()+1).toString(),l=a.getDate().toString()+"/"+(a.getMonth()+1).toString();
this.activitytime=lang.StringWithFormat("heroic card activity time from {1} to {2}",r,o),this.exchangetime=lang.StringWithFormat("heroic card activity time from {1} to {2}",s,l),this.taskList.itemRenderer=e.HeroicCardItem,this.taskListData=[];for(var u=table.heroicCardCfg,c=0;c<u.missions.length;c++)if(0!=u.missions[c].useable){var h=1e3-c,d=u.missions[c],p=HeroicCard.hcMsTasks[c],g=p.targetId;if(g>=d.tasks.length)this.taskListData.push({id:c,power:0});else{var m=p.value,f=d.tasks[g].target;m>=f&&(h=2e3-c),this.taskListData.push({id:c,power:h})}}this.taskListData=this.taskListData.sort(function(e,t){return e.power<t.power?1:e.power>t.power?-1:0}),this.taskList.dataProvider=new eui.ArrayCollection(this.taskListData),this.UpdateHeroicPoint()},n.prototype.UpdateHeroicPoint=function(){this.progress.maximum=HeroicCard.MAX_HEROIC_POINT,this.progress.value=HeroicCard.HeroicPoint,this.UpdateAwardItem()},n.prototype.UpdateAwardItem=function(){for(var e=table.heroicCardCfg,t=0;t<this.awardItems.length;t++)this.awardItems[t].SetAwardId(t,e.awards[t].point),HeroicCard.AwardedPoint>=e.awards[t].point?this.awardItems[t].currentState="Used":HeroicCard.HeroicPoint<e.awards[t].point?this.awardItems[t].currentState="Locked":this.awardItems[t].currentState="Useable"},n}(e.FitComponent);e.HeroicCardUI=t,__reflect(t.prototype,"UI.HeroicCardUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.dataChanged=function(){var e=this.awardList.dataProvider;null==e?this.awardList.dataProvider=new eui.ArrayCollection(Recharge.info_GrouponRankAwards[this.data.idx]):e.replaceAll(Recharge.info_GrouponRankAwards[this.data.idx])},t}(eui.ItemRenderer);e.OpeningGrouponAwardsItem=t,__reflect(t.prototype,"UI.OpeningGrouponAwardsItem");var n=function(t){function n(){return t.call(this)||this}return __extends(n,t),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btnDraw.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onDraw,this)},n.prototype.dataChanged=function(){switch(this.awardList.dataProvider=new eui.ArrayCollection(Recharge.info_GrouponAwards[this.data.idx].awards),this.count=Recharge.info_GrouponAwards[this.data.idx].count,this.btnDraw.visible=!0,this.data.status){case 1:this.btnDraw.label=lang.String("receive"),this.btnDraw.enabled=!0;break;case 2:this.btnDraw.visible=!1;break;default:this.btnDraw.label=lang.String("receive"),this.btnDraw.enabled=!1}},n.prototype.onDraw=function(){if(Recharge.charged){var t=new net.def.C2SOpeningGrouponAward;t.setIndex(this.data.idx),net.socket.write(38,t.toArrayBuffer())}else{var n=lang.String("recharge drawn"),i=lang.String("OpeningGroupon charged user could drawwith");e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],n,i,function(){return Recharge.openRechargeUI(),!0},null,null)}},n}(eui.ItemRenderer);e.OpeningGrouponChargesItem=n,__reflect(n.prototype,"UI.OpeningGrouponChargesItem");var i=function(e){function t(){var t=e.call(this)||this;return t.totalCount=0,t.maxCount=3e5,t.myCount=0,t.skinName="OpeningGrouponUISkin",t.touchEnabled=!1,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.onAddToStage=function(){var e=Recharge.OpeningGrouponEndTime-Game.eraDay;e>0?this.openDate.textFlow=Game.HtmlTextParser.parse(lang.StringWithFormat("activity last days{1}",e)):this.openDate.text=lang.String("already finish"),this.onRefreshCount(),this.onRefreshGrouponStatus(),this.onRefreshRanklist(),Game.dispatcher.addEventListener(Game.EVENT.OpeningGrouponRanklist,this.onRefreshRanklist,this),Game.dispatcher.addEventListener(Game.EVENT.OpeningGrouponAmount,this.onRefreshCount,this),Game.dispatcher.addEventListener(Game.EVENT.OpeningGrouponStatus,this.onRefreshGrouponStatus,this),net.socket.write(80,null)},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.OpeningGrouponRanklist,this.onRefreshRanklist,this),Game.dispatcher.removeEventListener(Game.EVENT.OpeningGrouponAmount,this.onRefreshCount,this),Game.dispatcher.removeEventListener(Game.EVENT.OpeningGrouponStatus,this.onRefreshGrouponStatus,this),this.tab.selectedIndex=0},t.prototype.onRefreshCount=function(){this.myCount=Recharge.personAmount,Recharge.serverAmount>=this.maxCount?this.totalCount=this.maxCount:this.totalCount=Recharge.serverAmount},t.prototype.onRefreshGrouponStatus=function(){for(var e=this.chargesDataGroup.dataProvider,t=[],n=0;n<Recharge.info_GrouponAwards.length;n++)null!=Recharge.grouponStatus&&null!=Recharge.grouponStatus[n]?t.push({idx:n,status:Recharge.grouponStatus[n]||0}):t.push({idx:n,status:0});t.sort(Recharge.sortStatus),null==e?this.chargesDataGroup.dataProvider=new eui.ArrayCollection(t):e.replaceAll(t)},t.prototype.onRefreshRanklist=function(){var e=this.rankList.dataProvider,t=Recharge.rankList;if(t.length<=0)for(var n=0;10>n;n++)t.push({round:n+1,name:lang.String("leave the seat of honour open"),time:0});null==e?this.rankList.dataProvider=new eui.ArrayCollection(t):(e.replaceAll(t),this.rankScroller.viewport.scrollV=0)},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnCharge:Recharge.openRechargeUI()}},t}(eui.Component);e.OpeningGrouponUI=i,__reflect(i.prototype,"UI.OpeningGrouponUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="Recharge7DayUISkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.bar.maximum=Recharge7Day.getThreshold(),t.list0.dataProvider=new eui.ArrayCollection(Recharge7Day.awardsConfig[0].awards),t.list1.dataProvider=new eui.ArrayCollection(Recharge7Day.awardsConfig[1].awards),t.list2.dataProvider=new eui.ArrayCollection(Recharge7Day.awardsConfig[2].awards),t}return __extends(t,e),t.prototype.onAddToStage=function(){this.openDate.text=Activity.getLastTime(Recharge7Day.activity.kindId),this.onUpdateGold(),this.onRefreshState(),Game.dispatcher.addEventListener(Game.EVENT.Recharge7DayGold,this.onUpdateGold,this),Game.dispatcher.addEventListener(Game.EVENT.Recharge7DaySyncState,this.onRefreshState,this)},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.Recharge7DayGold,this.onUpdateGold,this),Game.dispatcher.removeEventListener(Game.EVENT.Recharge7DaySyncState,this.onRefreshState,this)},t.prototype.onUpdateGold=function(){var e,t=Recharge7Day.getThreshold();e=Recharge7Day.gold<t?"Hôm nay nạp: "+Recharge7Day.gold+"/"+t:"Đạt mục tiêu hôm nay",this.labelGold.textFlow=Game.HtmlTextParser.parse(e),this.labelLastDay.textFlow=Game.HtmlTextParser.parse(lang.StringWithFormat("already reach{1}/{2}day",Recharge7Day.day,Recharge7Day.getDuration())),this.bar.value=Recharge7Day.gold},t.prototype.onRefreshState=function(){this.btnDraw0.enabled=1==(Recharge7Day.awardsStatus[0]||0),this.btnDraw0.visible=2!=(Recharge7Day.awardsStatus[0]||0),this.btnDraw1.enabled=1==(Recharge7Day.awardsStatus[1]||0),this.btnDraw1.visible=2!=(Recharge7Day.awardsStatus[1]||0),this.btnDraw2.enabled=1==(Recharge7Day.awardsStatus[2]||0),this.btnDraw2.visible=2!=(Recharge7Day.awardsStatus[2]||0)},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnDraw0:Recharge7Day.drawAward(0);break;case this.btnDraw1:Recharge7Day.drawAward(1);break;case this.btnDraw2:Recharge7Day.drawAward(2);break;case this.btnRecharge:Recharge.openRechargeUI()}},t}(eui.Component);e.Recharge7DayUI=t,__reflect(t.prototype,"UI.Recharge7DayUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.features={},e.skinName="RechargeActivityHallSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new e.RechargeActivityHall),this._instance},enumerable:!0,configurable:!0}),n.open=function(){var e=this.instance;return UIManager.pushPage(e),e},n.close=function(){null!=this._instance&&UIManager.pop(this._instance)},n.prototype.registerFeature=function(e,t){return null!=this.features[e]?void egret.error("registerFeature key exsit: "+e):(t.onLight(!0),void(this.features[e]=t))},n.prototype.onTouchTap=function(e){this.onTouchTapTarget(e.target)},n.prototype.onTouchTapTarget=function(t){switch(t){case this.imgClose:case this.btnClose:case this.btnClose1:e.RechargeActivityHall.close();break;case this.btnOpeningGroupon:this.openingGrouponUI||(this.openingGrouponUI=new e.OpeningGrouponUI),this.addObjecttoView(this.openingGrouponUI);break;case this.arrowLeft:this.onFlipTitle(!1);break;case this.arrowRight:this.onFlipTitle(!0);break;case this.btnRankAwardLv:this.rankawardLv||(this.rankawardLv=new e.RankAwardPage(0)),this.addObjecttoView(this.rankawardLv);break;case this.btnRankAwardFP:this.rankawardFp||(this.rankawardFp=new e.RankAwardPage(1)),this.addObjecttoView(this.rankawardFp);break;case this.btnMonthlyAct:if(!monthlyactivity.CheckLevel()){PopUpMessage.push(lang.StringWithFormat("unlock:level{1}",monthlyactivity.GetMinLevel()),color.RED,!1);var n=this.btnGroup.getChildAt(0);n.selected=!0,this.onTouchTapTarget(n);break}this.MonthlyActivityUI||(this.MonthlyActivityUI=e.MonthlyActivityFrame.instance),this.addObjecttoView(this.MonthlyActivityUI);break;case this.btnOpeningWheel:this.openingWheel||(this.openingWheel=new e.OpeningWheelUI),this.addObjecttoView(this.openingWheel);break;case this.btnLeiChong:this.activityRecharge||(this.activityRecharge=new e.ActivityRechargeUI),this.addObjecttoView(this.activityRecharge);break;case this.btnLeiXiao:this.activityConsumption||(this.activityConsumption=new e.ActivityConsumptionUI),this.addObjecttoView(this.activityConsumption);break;case this.btnDailyGift:this.dailyGift||(this.dailyGift=new e.DailyGift),this.addObjecttoView(this.dailyGift);break;case this.btnFunding:this.fundingAward||(this.fundingAward=new e.FundingAward),this.addObjecttoView(this.fundingAward);break;case this.btnFlashSale:if(null==ActivityFlashSale.status)return void egret.error("ActivityFlashSale.status is null");this.flashSaleUI||(this.flashSaleUI=new e.FlashSaleUI),this.addObjecttoView(this.flashSaleUI);break;case this.btnDailyRecharge:this.dailyRecharge||(this.dailyRecharge=new e.DailyRechargeUI),this.addObjecttoView(this.dailyRecharge);break;case this.btnRecharge7day:this.recharge7Day||(this.recharge7Day=new e.Recharge7DayUI),this.addObjecttoView(this.recharge7Day);break;case this.btnNienBossSignPanel:this.nienBossSignPanel||(this.nienBossSignPanel=new e.NienBossSignPanel),this.addObjecttoView(this.nienBossSignPanel);break;case this.btnFortunePlan:this.fortunePlanUI||(this.fortunePlanUI=new e.FortunePlanUI),this.addObjecttoView(this.fortunePlanUI);break;case this.btnLoginGift:this.loginGift||(this.loginGift=new e.LoginGift),this.addObjecttoView(this.loginGift);break;case this.btnGrouponBuy:this.grouponBuy||(this.grouponBuy=new e.GrouponBuyUI),this.addObjecttoView(this.grouponBuy);break;case this.btnBuyRefund:this.buyRefund||(this.buyRefund=new e.BuyRefund),this.addObjecttoView(this.buyRefund);break;default:for(var i in this.features){var a=this.features[i];if(a.button==t){this.addObjecttoView(a.content),a.onLight(!1);break}}}},n.prototype.addObjecttoView=function(e){e.parent!=this.view&&(this.view.removeChildren(),this.view.addChild(e))},n.prototype.onActivityEvent=function(e,t){if(null!=e)if(e)t.open&&this.addRadioButton(t.button);else if(t.button.parent==this.btnGroup)if(1==t.button.selected){Game.removeFromParent.apply(t.button);var n=this.btnGroup.getChildAt(0);n.selected=!0,this.onTouchTapTarget(n)}else Game.removeFromParent.apply(t.button)},n.prototype.onFlipTitle=function(e){var t=this.scroller.width-50;if(e){if(this.scroller.viewport.scrollH+t>=this.scroller.viewport.contentWidth)return;this.scroller.viewport.scrollH+=t}else this.scroller.viewport.scrollH>=t?this.scroller.viewport.scrollH-=t:this.scroller.viewport.scrollH=0},n.prototype.AddMonthlyActButton=function(){if(this.btnGroup){var e=monthlyactivity.getRadioButtonInfo();null!=e&&(this.btnMonthlyAct?this.btnMonthlyAct.name!=e.name&&(this.btnMonthlyAct.name=e.name,this.btnMonthlyAct.icon=e.icon):this.btnMonthlyAct=this.createRadioButton(e.name,"2207,2208",e.icon),this.addRadioButton(this.btnMonthlyAct))}},n.prototype.RemoveMonthlyActButton=function(){this.btnGroup&&this.removeRadioButton(this.btnMonthlyAct)},n.prototype.addRadioButton=function(e,t){e&&e.parent!=this.btnGroup&&(t?this.btnGroup.addChildAt(e,t):this.btnGroup.addChild(e))},n.prototype.removeRadioButton=function(e){e&&null!=e.parent&&Game.removeFromParent.apply(e)},n.prototype.onAddToStage=function(){Recharge.isFunding()?(this.btnFunding||(this.btnFunding=this.createRadioButton("Đầu Tư","17","ui/city1/btn_ybwl.png")),this.addRadioButton(this.btnFunding)):this.removeRadioButton(this.btnFunding),monthlyactivity.IsOpenning()?this.AddMonthlyActButton():this.RemoveMonthlyActButton(),DailyRecharge.open&&WorldLine.IsOpen("DailyRefund")&&(this.btnDailyRecharge||(this.btnDailyRecharge=this.createRadioButton("Hoàn Trả Mỗi Ngày",""+badge.action.DailyRechargeAward,"ui/city1/btn_tiantianfanli.png")),this.addRadioButton(this.btnDailyRecharge)),Game.eraDay<=Recharge.OpeningGrouponEndTime?(this.btnOpeningGroupon||(this.btnOpeningGroupon=this.createRadioButton("Mua Chung","7","ui/city1/btn_budeng.png")),this.addRadioButton(this.btnOpeningGroupon)):this.removeRadioButton(this.btnOpeningGroupon),Recharge7Day.activity.open?(this.btnRecharge7day||(this.btnRecharge7day=this.createRadioButton("Nạp 7 ngày","86","ui/city1/btn_7day.png")),this.addRadioButton(this.btnRecharge7day)):this.removeRadioButton(this.btnRecharge7day),NienBoss.open&&null!=NienBoss.config?(this.btnNienBossSignPanel||(this.btnNienBossSignPanel=this.createRadioButton(NienBoss.config.activityName,""+badge.action.NienBoss,NienBoss.config.activityIcon)),this.addRadioButton(this.btnNienBossSignPanel)):this.removeRadioButton(this.btnNienBossSignPanel),OpeningWheel.activity.open?(this.btnOpeningWheel||(this.btnOpeningWheel=this.createRadioButton("Vòng Quay",null,"ui/holiday/btn_zhuanpan.png")),this.addRadioButton(this.btnOpeningWheel)):this.removeRadioButton(this.btnOpeningWheel),ActivityFlashSale.activity.open?(this.btnFlashSale||(this.btnFlashSale=this.createRadioButton("Tranh Mua-SV",null,"ui/city1/btn_tiantianfanli.png")),this.addRadioButton(this.btnFlashSale)):this.removeRadioButton(this.btnFlashSale),ActivityRecharge.activity.open?(this.btnLeiChong||(this.btnLeiChong=this.createRadioButton(lang.String("openingCharges"),"81","ui/city1/btn_leichong.png")),this.addRadioButton(this.btnLeiChong)):this.removeRadioButton(this.btnLeiChong),ActivityConsumption.activity.open?(this.btnLeiXiao||(this.btnLeiXiao=this.createRadioButton(lang.String("totalConsumption"),"82","ui/city1/btn_leixiao.png")),this.addRadioButton(this.btnLeiXiao)):this.removeRadioButton(this.btnLeiXiao),FortunePlan.activity.inTime()?(this.btnFortunePlan||(this.btnFortunePlan=this.createRadioButton("Đầu Tư Phát Tài","87,88","ui/city1/btn_tiantianfanli.png")),this.addRadioButton(this.btnFortunePlan)):this.removeRadioButton(this.btnFortunePlan),RankAward.inTime()?(this.btnRankAwardLv||(this.btnRankAwardLv=this.createRadioButton("Đua Cấp",null,"ui/city1/btn_RankAwardLv.png")),this.addRadioButton(this.btnRankAwardLv),this.btnRankAwardFP||(this.btnRankAwardFP=this.createRadioButton("Đua Lực Chiến",null,"ui/city1/btn_RankAwardFP.png")),this.addRadioButton(this.btnRankAwardFP)):(this.removeRadioButton(this.btnRankAwardLv),this.removeRadioButton(this.btnRankAwardFP)),ActivityLoginGift.activity.open?(this.btnLoginGift||(this.btnLoginGift=this.createRadioButton("Quà Đăng Nhập",""+badge.action.LoginGift,"ui/city1/btn_7day.png")),this.addRadioButton(this.btnLoginGift)):this.removeRadioButton(this.btnLoginGift),ActivityGrouponBuy.activity.open?(this.btnGrouponBuy||(this.btnGrouponBuy=this.createRadioButton("Mua Chung Toàn SV",""+badge.action.GrouponBuy,"ui/city1/btn_budeng.png")),this.addRadioButton(this.btnGrouponBuy)):this.removeRadioButton(this.btnGrouponBuy),ActivityBuyRefund.activity.open?(this.btnBuyRefund||(this.btnBuyRefund=this.createRadioButton("Mua hoàn trả",""+badge.action.BuyRefund,"ui/city1/zsz.png")),this.addRadioButton(this.btnBuyRefund)):this.removeRadioButton(this.btnBuyRefund);for(var e in this.features){var t=this.features[e];t.open&&this.addRadioButton(t.button),t.onAddToStage()}var n=this.btnGroup.getChildAt(0);n.selected=!0,this.onTouchTapTarget(n),this.scroller.viewport.scrollH=0,Game.dispatcher.addEventListener(Game.EVENT.OpeningWheelOpen,this.openWheelUI,this),Game.dispatcher.addEventListener(Game.EVENT.ActivityRechargeOpen,this.openActivityRechargeUI,this),Game.dispatcher.addEventListener(Game.EVENT.ActivityConsumptionOpen,this.openActivityConsumptionUI,this),Game.dispatcher.addEventListener(Game.EVENT.ActivityFlashSaleOpen,this.openActivityFlashSaleUI,this),Game.dispatcher.addEventListener(Game.EVENT.Recharge7DayOpen,this.openRecharge7DayUI,this),Game.dispatcher.addEventListener(Game.EVENT.FortunePlanActivityOpen,this.openFortunePlanUI,this),Game.dispatcher.addEventListener(Game.EVENT.ActivityLoginGift,this.openLoginGift,this),Game.dispatcher.addEventListener(Game.EVENT.ActivityGrouponBuy,this.openGrouponBuyUI,this),Game.dispatcher.addEventListener(Game.EVENT.ActivityBuyRefund,this.openBuyRefund,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.OpeningWheelOpen,this.openWheelUI,this),Game.dispatcher.removeEventListener(Game.EVENT.ActivityRechargeOpen,this.openActivityRechargeUI,this),Game.dispatcher.removeEventListener(Game.EVENT.ActivityConsumptionOpen,this.openActivityConsumptionUI,this),Game.dispatcher.removeEventListener(Game.EVENT.ActivityFlashSaleOpen,this.openActivityFlashSaleUI,this),Game.dispatcher.removeEventListener(Game.EVENT.Recharge7DayOpen,this.openRecharge7DayUI,this),Game.dispatcher.removeEventListener(Game.EVENT.ActivityLoginGift,this.openLoginGift,this),Game.dispatcher.removeEventListener(Game.EVENT.ActivityGrouponBuy,this.openGrouponBuyUI,this),Game.dispatcher.removeEventListener(Game.EVENT.ActivityBuyRefund,this.openBuyRefund,this);for(var e in this.features){var t=this.features[e];t.onRemoveFromStage()}for(var n=0;n<this.btnGroup.numChildren;n++){var i=this.btnGroup.getChildAt(n);i.selected=!1}},n.prototype.openWheelUI=function(e){if(null!=e)if(1==e.data)OpeningWheel.activity.inTime()&&(this.btnOpeningWheel||(this.btnOpeningWheel=this.createRadioButton("Vòng Quay",null,"ui/holiday/btn_zhuanpan.png")),this.addRadioButton(this.btnOpeningWheel));else if(0==e.data&&this.btnOpeningWheel.parent==this.btnGroup)if(1==this.btnOpeningWheel.selected){Game.removeFromParent.apply(this.btnOpeningWheel);var t=this.btnGroup.getChildAt(0);t.selected=!0,this.onTouchTapTarget(t)}else Game.removeFromParent.apply(this.btnOpeningWheel)},n.prototype.openActivityRechargeUI=function(e){if(null!=e)if(1==e.data)ActivityRecharge.activity.inTime()&&(this.btnLeiChong||(this.btnLeiChong=this.createRadioButton(lang.String("openingCharges"),"81","ui/city1/btn_leichong.png")),this.addRadioButton(this.btnLeiChong));else if(0==e.data&&this.btnLeiChong.parent==this.btnGroup)if(1==this.btnLeiChong.selected){Game.removeFromParent.apply(this.btnLeiChong);var t=this.btnGroup.getChildAt(0);t.selected=!0,this.onTouchTapTarget(t)}else Game.removeFromParent.apply(this.btnLeiChong)},n.prototype.openActivityConsumptionUI=function(e){if(null!=e)if(1==e.data)ActivityConsumption.activity.inTime()&&(this.btnLeiXiao||(this.btnLeiXiao=this.createRadioButton(lang.String("totalConsumption"),"82","ui/city1/btn_leixiao.png")),this.addRadioButton(this.btnLeiXiao));else if(0==e.data&&this.btnLeiXiao.parent==this.btnGroup)if(1==this.btnLeiXiao.selected){Game.removeFromParent.apply(this.btnLeiXiao);var t=this.btnGroup.getChildAt(0);t.selected=!0,this.onTouchTapTarget(t)}else Game.removeFromParent.apply(this.btnLeiXiao)},n.prototype.openActivityFlashSaleUI=function(e){if(null!=e)if(1==e.data)ActivityFlashSale.activity.inTime()&&(this.btnFlashSale||(this.btnFlashSale=this.createRadioButton("Tranh Mua-SV",null,"ui/city1/btn_tiantianfanli.png")),this.addRadioButton(this.btnFlashSale));else if(0==e.data&&this.btnFlashSale.parent==this.btnGroup)if(1==this.btnFlashSale.selected){Game.removeFromParent.apply(this.btnFlashSale);var t=this.btnGroup.getChildAt(0);t.selected=!0,this.onTouchTapTarget(t)}else Game.removeFromParent.apply(this.btnFlashSale)},n.prototype.openRecharge7DayUI=function(e){if(null!=e&&0==e.data&&this.btnRecharge7day.parent==this.btnGroup)if(1==this.btnRecharge7day.selected){Game.removeFromParent.apply(this.btnRecharge7day);var t=this.btnGroup.getChildAt(0);t.selected=!0,this.onTouchTapTarget(t)}else Game.removeFromParent.apply(this.btnRecharge7day)},n.prototype.openFortunePlanUI=function(e){if(null!=e)if(1==e.data)FortunePlan.activity.inTime()&&(this.btnFortunePlan||(this.btnFortunePlan=this.createRadioButton("Đầu Tư Phát Tài",null,"ui/city1/btn_tiantianfanli.png")),this.addRadioButton(this.btnFortunePlan));else if(0==e.data&&this.btnFortunePlan.parent==this.btnGroup)if(1==this.btnFortunePlan.selected){Game.removeFromParent.apply(this.btnFortunePlan);var t=this.btnGroup.getChildAt(0);t.selected=!0,this.onTouchTapTarget(t)}else Game.removeFromParent.apply(this.btnFortunePlan)},n.prototype.openLoginGift=function(e){if(null!=e)if(1==e.data)ActivityLoginGift.activity.inTime()&&(this.btnLoginGift||(this.btnLoginGift=this.createRadioButton("Quà Đăng Nhập",""+badge.action.LoginGift,"ui/city1/btn_7day.png")),this.addRadioButton(this.btnLoginGift));else if(0==e.data&&this.btnLoginGift.parent==this.btnGroup)if(1==this.btnLoginGift.selected){Game.removeFromParent.apply(this.btnLoginGift);var t=this.btnGroup.getChildAt(0);t.selected=!0,this.onTouchTapTarget(t)}else Game.removeFromParent.apply(this.btnLoginGift)},n.prototype.openBuyRefund=function(e){if(null!=e)if(1==e.data)ActivityBuyRefund.activity.inTime()&&(this.btnBuyRefund||(this.btnBuyRefund=this.createRadioButton("Mua hoàn trả",""+badge.action.BuyRefund,"ui/city1/zsz.png")),this.addRadioButton(this.btnBuyRefund));else if(0==e.data&&this.btnBuyRefund.parent==this.btnGroup)if(1==this.btnBuyRefund.selected){Game.removeFromParent.apply(this.btnBuyRefund);var t=this.btnGroup.getChildAt(0);t.selected=!0,this.onTouchTapTarget(t)}else Game.removeFromParent.apply(this.btnBuyRefund)},n.prototype.openGrouponBuyUI=function(e){if(null!=e)if(1==e.data)ActivityGrouponBuy.activity.inTime()&&(this.btnGrouponBuy||(this.btnGrouponBuy=this.createRadioButton("Mua Chung Toàn SV",""+badge.action.GrouponBuy,"ui/city1/btn_budeng.png")),this.addRadioButton(this.btnGrouponBuy));else if(0==e.data&&this.btnGrouponBuy.parent==this.btnGroup)if(1==this.btnGrouponBuy.selected){Game.removeFromParent.apply(this.btnGrouponBuy);var t=this.btnGroup.getChildAt(0);t.selected=!0,this.onTouchTapTarget(t)}else Game.removeFromParent.apply(this.btnGrouponBuy)},n.prototype.createRadioButton=function(t,n,i){var a=new e.RadioButton;return a.label=t,a.action=n,a.icon=i,a.groupName="rechargeActivity",a.skinName="RadioTemp3Skin",a},n.prototype.showFunding=function(){var e=this.btnGroup.getChildAt(0);e.selected=!1,this.onTouchTapTarget(this.btnFunding),this.btnFunding.selected=!0},n.prototype.showOpeningWheel=function(){if(OpeningWheel.activity.open){var e=this.btnGroup.getChildAt(0);e.selected=!1,this.onTouchTapTarget(this.btnOpeningWheel),this.btnOpeningWheel.selected=!0}},n.prototype.showFlashSale=function(){if(ActivityFlashSale.activity.open){var e=this.btnGroup.getChildAt(0);e.selected=!1,this.onTouchTapTarget(this.btnFlashSale),this.btnFlashSale.selected=!0}},n.prototype.showLeiChong=function(){if(ActivityRecharge.activity.open){var e=this.btnGroup.getChildAt(0);e.selected=!1,this.onTouchTapTarget(this.btnLeiChong),this.btnLeiChong.selected=!0}},n.prototype.showLeiXiao=function(){if(ActivityConsumption.activity.open){var e=this.btnGroup.getChildAt(0);e.selected=!1,this.onTouchTapTarget(this.btnLeiXiao),this.btnLeiXiao.selected=!0}},n.prototype.showRecharge7Day=function(){if(Recharge7Day.activity.open){var e=this.btnGroup.getChildAt(0);e.selected=!1,this.onTouchTapTarget(this.btnRecharge7day),this.btnRecharge7day.selected=!0}},n}(e.FitComponent);e.RechargeActivityHall=t,__reflect(t.prototype,"UI.RechargeActivityHall",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.btnCharge.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRecharge,this)},t.prototype.dataChanged=function(){null==this.data.status||1==this.data.status?this.firstTip="":this.firstTip=lang.StringWithFormat("first charge with{1} goldCoin",this.data.bonus)},t.prototype.onRecharge=function(){Payment.buy(this.data.wareId)},t}(eui.ItemRenderer);e.RechargeGoldCoinItem=t,__reflect(t.prototype,"UI.RechargeGoldCoinItem")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="RechargeUISkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.btnCard7.action=""+badge.action.WeeklyCard,t.btnCard30.action=""+badge.action.MonthlyCard,t}return __extends(t,e),t.open=function(){return null==this._instance&&(this._instance=new t),UIManager.push(this._instance),this._instance},t.close=function(){null!=this._instance&&UIManager.pop(this._instance)},t.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.onClose();break;case this.btnVip:Vip.showVipUi(),this.onClose();break;case this.btnCard7:if(Recharge.haveTimingCardDailyAward(Recharge.WeeklyCard_Type)){var t=new net.def.C2STimingCard;t.setType(0),net.socket.write(115,t.toArrayBuffer())}else Recharge.CanBuyTimingCard(Recharge.WeeklyCard_Type)&&Recharge.buyWeeklyCard();this.btnCard7.enabled=!1;break;case this.btnCard30:if(Recharge.haveTimingCardDailyAward(Recharge.MonthlyCard_Type)){var t=new net.def.C2STimingCard;t.setType(1),net.socket.write(115,t.toArrayBuffer())}else Recharge.CanBuyTimingCard(Recharge.MonthlyCard_Type)&&Recharge.buyMonthlyCard();this.btnCard30.enabled=!1}},t.prototype.onClose=function(){t.close()},t.prototype.onAddToStage=function(){var e=Recharge.getRechargeWareIds();this.dataGroup.dataProvider=new eui.ArrayCollection(e),this.onRefreshMonthly(),this.onRefreshVip(),Game.dispatcher.addEventListener(Game.EVENT.TimingCardChange,this.onRefreshMonthly,this),Game.dispatcher.addEventListener(Game.EVENT.ListGoldCoinWareStatus,this.onRefresh,this),Game.dispatcher.addEventListener(Game.EVENT.VipPithChange,this.onRefreshVip,this),net.socket.write(61,null)},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.TimingCardChange,this.onRefreshMonthly,this),Game.dispatcher.removeEventListener(Game.EVENT.ListGoldCoinWareStatus,this.onRefresh,this),Game.dispatcher.removeEventListener(Game.EVENT.VipPithChange,this.onRefreshVip,this)},t.prototype.onRefresh=function(e){for(var t=e.data,n=this.dataGroup.dataProvider,i=n.source,a=0;a<i.length;a++)i[a].status=t[a];n.refresh()},t.prototype.onRefreshMonthly=function(){var e=Recharge.getTimingCardCfg(Recharge.WeeklyCard_Type),t=Recharge.getTimingCardCfg(Recharge.MonthlyCard_Type);if(this.vnd7=e.vnd,this.vnd30=t.vnd,null==Recharge.timingcards||2!=Recharge.timingcards.length)this.labelCard7.textFlow=Game.HtmlTextParser.parse(lang.StringWithFormat("timing card buy tip {1}{2}",e.goldCoin,e.silverCoin)),this.labelCard30.textFlow=Game.HtmlTextParser.parse(lang.StringWithFormat("timing card buy tip {1}{2}",t.goldCoin,t.silverCoin)),this.btnCard7.label="Mua",this.btnCard30.label="Mua";else{var n=FormatYYYYMMDDHHMM(Number(Recharge.timingcards[Recharge.WeeklyCard_Type].expiredTime),!1);switch(Recharge.timingcards[Recharge.WeeklyCard_Type].status){case 0:this.labelCard7.textFlow=Game.HtmlTextParser.parse(lang.StringWithFormat("timing card buy tip {1}{2}",e.goldCoin,e.silverCoin)),this.btnCard7.label="Mua",this.btnCard7.enabled=!0;break;case 1:this.labelCard7.textFlow=Game.HtmlTextParser.parse(lang.StringWithFormat("timing card award tip {1}{2}",e.silverCoin,n)),this.btnCard7.label="Nhận",this.btnCard7.enabled=!0;break;case 2:this.labelCard7.textFlow=Game.HtmlTextParser.parse(lang.StringWithFormat("timing card award tip {1}{2}",e.silverCoin,n)),this.btnCard7.label="Đã nhận",this.btnCard7.enabled=!1;break;case 3:this.labelCard7.textFlow=Game.HtmlTextParser.parse(lang.StringWithFormat("timing card expired tip {1}{2}",e.silverCoin,n)),this.btnCard7.label="Mua",this.btnCard7.enabled=!0}var i=FormatYYYYMMDDHHMM(Number(Recharge.timingcards[Recharge.MonthlyCard_Type].expiredTime),!1);switch(Recharge.timingcards[Recharge.MonthlyCard_Type].status){case 0:this.labelCard30.textFlow=Game.HtmlTextParser.parse(lang.StringWithFormat("timing card buy tip {1}{2}",t.goldCoin,t.silverCoin)),this.btnCard30.label="Mua",this.btnCard30.enabled=!0;break;case 1:this.labelCard30.textFlow=Game.HtmlTextParser.parse(lang.StringWithFormat("timing card award tip {1}{2}",t.silverCoin,i)),this.btnCard30.label="Nhận",this.btnCard30.enabled=!0;break;case 2:this.labelCard30.textFlow=Game.HtmlTextParser.parse(lang.StringWithFormat("timing card award tip {1}{2}",t.silverCoin,i)),this.btnCard30.label="Đã nhận",this.btnCard30.enabled=!1;break;case 3:this.labelCard30.textFlow=Game.HtmlTextParser.parse(lang.StringWithFormat("timing card expired tip {1}{2}",t.silverCoin,i)),this.btnCard30.label="Mua",this.btnCard30.enabled=!0}}},t.prototype.onRefreshVip=function(){var e,t,n=PlayerAttribute.vipItem;switch(n.level){case Vip.VipMaxLevel:e=Vip.VipMaxLevel-1,t=Vip.VipMaxLevel;break;default:e=n.level,t=n.level+1}this.curVipIcon=Vip.getVipIcon(e),this.nextVipIcon=Vip.getVipIcon(t),this.vipBar.maximum=table.vipExps[t].exp,this.vipBar.value=n.exp},t}(e.FitComponent);e.RechargeUI=t,__reflect(t.prototype,"UI.RechargeUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="MyRedPacketsSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.taskRedPackets=new eui.ArrayCollection,e}return __extends(n,t),n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.TaskRedPacketChange,this.onSyncTaskRedPackets,this),Game.dispatcher.addEventListener(Game.EVENT.SyncGuildInfo,this.onSyncGuildInfo,this),this.onSyncTaskRedPackets()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.TaskRedPacketChange,this.onSyncTaskRedPackets,this),Game.dispatcher.removeEventListener(Game.EVENT.SyncGuildInfo,this.onSyncGuildInfo,this),this.packetCount=""},n.prototype.onSyncGuildInfo=function(){this.taskRedPackets.refresh()},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnHelp:UIManager.pushPage(new e.RedPacketCareer);break;case this.btnHistory:""!=Player.instance.guildName?RedPacket.openHistoryUI():PopUpMessage.push(lang.String("require guild"),color.RED)}},n.prototype.onSyncTaskRedPackets=function(){this.taskRedPackets.removeAll();for(var e in RedPacket.taskRedPackets){var t=RedPacket.taskRedPackets[e];this.taskRedPackets.addItem(t)}this.taskRedPackets.length>0?this.packetCount="("+lang.StringWithFormat("shuliang:{1}",this.taskRedPackets.length)+")":this.packetCount=""
},n}(eui.Component);e.MyRedPackets=t,__reflect(t.prototype,"UI.MyRedPackets",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.list=[],t.skinName="RedPacketSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.open=function(){return null==this._instance&&(this._instance=new t),this._instance.horizontalCenter=0,this._instance.verticalCenter=~~(.118*egret.MainContext.instance.stage.stageHeight),UIManager.push(this._instance),this._instance},t.onSyncRedPacket=function(){var e=[];for(var t in RedPacket.guildRedPackets)e.push(RedPacket.guildRedPackets[t]);if(e.length>0){var n=this.open();n.list=e,RedPacket.isToastRedPacket(e[e.length-1].kind)?n.sender=lang.String("guild toast redpacket name"):n.sender=lang.StringWithFormat("{1}'s redpacket",e[e.length-1].owner)}},t.prototype.onNewRedPackets=function(e){for(var t=e.length,n=this.list,i=0;t>i;i++){var a=e[i];this.list.push(a)}RedPacket.isToastRedPacket(n[n.length-1].kind)?this.sender=lang.String("guild toast redpacket name"):this.sender=lang.StringWithFormat("{1}'s redpacket",n[n.length-1].owner)},t.onRedPacketEmpty=function(e){if(null==this._instance)return null;for(var t=this._instance.list,n=t.length,i=1;n>i;i++){var a=t[i];if(a.id.toHex()==e)return t.splice(i,1),void(t.length>0&&(RedPacket.isToastRedPacket(t[t.length-1].kind)?this._instance.sender=lang.String("guild toast redpacket name"):this._instance.sender=lang.StringWithFormat("{1}'s redpacket",t[t.length-1].owner)))}},t.prototype.onTouchTap=function(){if(0==this.list.length)return void UIManager.popNoTweens(this);var e=this.list.pop(),t=RedPacket.isToastRedPacket(e.kind);if(!t&&RedPacket.times>=RedPacket.DailyTimes)return void UIManager.popNoTweens(this);RedPacket.receive(e.id);var n=null,i=!1;return this.list.length>0&&(n=this.list[this.list.length-1],i=RedPacket.isToastRedPacket(n.kind),RedPacket.isToastRedPacket(n.kind)?this.sender=lang.String("guild toast redpacket name"):this.sender=lang.StringWithFormat("{1}'s redpacket",this.list[this.list.length-1].owner)),null==n?void UIManager.popNoTweens(this):!i&&RedPacket.times>=RedPacket.DailyTimes?void UIManager.popNoTweens(this):void 0},t}(eui.Component);e.RedPacketIcon=t,__reflect(t.prototype,"UI.RedPacketIcon",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="BuySeaSunTimesSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),Game.dispatcher.addEventListener(Game.EVENT.SeaSunBuyTimeWithGoldConfirm,e.close,e),e}return __extends(n,t),n.prototype.onTouchTap=function(t){switch(t.target){case this.btnClose:case this.imgClose:this.close();break;case this.btnBuy:if(SeaSunVillage.buyTimes>0){var n=PlayerAttribute.currency[Game.Currency.SilverCoin],i=PlayerAttribute.currency[Game.Currency.GoldCoin],a=100;if(a>i+n)return void PopUpMessage.push(lang.String("not enough anyCoin"),color.RED);if(a>n)return void UIManager.push(new e.SilverPromptByCost(a,function(){return PlayerAttribute.currency[Game.Currency.GoldCoin]+PlayerAttribute.currency[Game.Currency.SilverCoin]<a?void PopUpMessage.push(lang.String("not enough goldcoin"),color.RED):(Game.dispatcher.dispatchEventWith(Game.EVENT.SeaSunBuyTimeWithGoldConfirm),UIManager.pop(this),void net.socket.write(63,null))}));net.socket.write(63,null)}SeaSunVillage.buyTimes--,this.close()}},n.prototype.close=function(){Game.dispatcher.removeEventListener(Game.EVENT.SeaSunBuyTimeWithGoldConfirm,this.close,this),UIManager.pop(this)},n}(e.FitComponent);e.BuySeaSunTimes=t,__reflect(t.prototype,"UI.BuySeaSunTimes",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="SeaSunDiceSkin",e.send=MakeDelayExecute(e.onSend,e,3*Game.Second),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.panel.btnBack.visible=!1,e.panel.btnClose.visible=!1,e.btnStart.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onStart,e),e.loadDiceRes(),e}return __extends(n,t),n.prototype.loadDiceRes=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return e="mc/dice/dice.json",t=RES.getRes(e),null!=t?[3,2]:[4,RES.getResAsync(e)];case 1:t=n.sent(),n.label=2;case 2:return this.npcDice=new egret.MovieClip(t.generateMovieClipData("dice")),this.myDice=new egret.MovieClip(t.generateMovieClipData("dice")),this.npcDiceGroup.addChild(this.npcDice),this.npcDice.x=this.npcDiceGroup.width/2,this.npcDice.y=this.npcDiceGroup.height/2+20,this.myDiceGroup.addChild(this.myDice),this.myDice.x=this.myDiceGroup.width/2,this.myDice.y=this.myDiceGroup.height/2+20,this.btnStart.enabled=!0,this.timerId=egret.setTimeout(this.onTimeout,this,3*Game.Second),[2]}})})},n.prototype.onTimeout=function(){this.timerId=null,this.onStart()},n.prototype.onRemoveFromStage=function(){null!=this.timerId&&(egret.clearTimeout(this.timerId),this.timerId=null)},n.prototype.onStart=function(){null!=this.timerId&&(egret.clearTimeout(this.timerId),this.timerId=null),"end"==this.currentState?(UIManager.pop(this),e.dice=null):(this.btnStart.enabled=!1,this.npcDice.play(-1),this.myDice.play(-1),this.send())},n.prototype.onSend=function(){var e=new net.def.C2SRollDice;e.count=2,net.socket.write(51,e.toArrayBuffer())},n.prototype.setResult=function(e,t){this.myDice.gotoAndStop(e.toString()),this.npcDice.gotoAndStop(t.toString()),this.currentState="end",this.btnStart.enabled=!0,e>t?(this.result.text="Thắng",this.result.textColor=15900425):t>e?(this.result.text="Thất bại",this.result.textColor=13421772):(this.result.text="Hòa",this.result.textColor=1484815)},n.prototype.freeAssets=function(){var e=RES.getRes("mc/dice/dice.json");null!=e&&(e.clearCache(),RES.destroyRes("mc/dice/dice.json"))},n}(e.FitComponent);e.SeaSunDice=t,__reflect(t.prototype,"UI.SeaSunDice",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="SeaSunEntranceSkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.awards.itemRenderer=e.AwardCell,n}return __extends(n,t),n.prototype.onAddToStage=function(){this.onSeaSunDataChanged(),Game.dispatcher.addEventListener(Game.EVENT.SeaSunData,this.onSeaSunDataChanged,this),guide.addEventListener(guide.GuideOperation.GuideSeasunVillage,this.onGuideReminder,this),this.onSelectChapter(),guide.completed()||this.playGuideMovie(guide.info.operation)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.SeaSunData,this.onSeaSunDataChanged,this),guide.removeEventListener(guide.GuideOperation.GuideSeasunVillage,this.onGuideReminder,this)},n.prototype.onSelectChapter=function(){var e=SeaSunVillage.chapterInfo[0].awards;this.awards.dataProvider=new eui.ArrayCollection(e)},n.prototype.onTouchTap=function(t){switch(t.target){case this.imgClose:this.close();break;case this.btnSign:SeaSunVillage.sign(0)&&(e.HUD.instance.showBattle(),this.close());break;case this.btnBuy:if(this.buyTimes<=0)return void PopUpMessage.push(lang.String("buy times used up"),color.GREEN);UIManager.pushPage(new e.BuySeaSunTimes);break;case this.btnRules:var n=new e.Rule;n.skinName="SeaSunInfoSkin",UIManager.pushPage(n)}},n.prototype.close=function(){UIManager.pop(this)},n.prototype.onSeaSunDataChanged=function(){this.times=SeaSunVillage.curTimes,this.buyTimes=SeaSunVillage.buyTimes},n.prototype.onGuideReminder=function(){var e=this;if(this.visible){var t=guide.info.operation;guide.pushMovie({weight:2,handle:function(){e.playGuideMovie(t)}})}},n.prototype.playGuideMovie=function(e){e==guide.GuideOperation.GuideSeasunVillage&&guide.AddMovieClip(this.btnSign)},n}(e.FitComponent);e.SeaSunEntrance=t,__reflect(t.prototype,"UI.SeaSunEntrance",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="SeaSunHUDSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.onSeaSunDataChanged(),e}return __extends(n,t),n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.SeaSunData,this.onSeaSunDataChanged,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.SeaSunData,this.onSeaSunDataChanged,this)},n.prototype.onQuit=function(){return SeaSunVillage.quit(),!0},n.prototype.onExplore=function(){return SeaSunVillage.applyExplore(),!0},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnQuit:if("tasking"==this.currentState){if(null==e.offcheckPanel&&(e.offcheckPanel=new e.SeasunOffcheck),null!=e.offcheckPanel.parent)return;return e.offcheckPanel.OnOk=this.onQuit,void UIManager.pushPage(e.offcheckPanel)}SeaSunVillage.quit();break;case this.btnExplore:if(SeaSunVillage.curTimes>0){if("tasking"==this.currentState){if(null==e.offcheckPanel&&(e.offcheckPanel=new e.SeasunOffcheck),null!=e.offcheckPanel.parent)return;return e.offcheckPanel.OnOk=this.onExplore,void UIManager.pushPage(e.offcheckPanel)}SeaSunVillage.applyExplore()}else SeaSunVillage.buyTimes>0?UIManager.pushPage(new e.BuySeaSunTimes):PopUpMessage.push(lang.String("explore times used up"),color.RED)}},n.prototype.onSeaSunDataChanged=function(){this.times=SeaSunVillage.curTimes,this.times<=0?this.tip.visible=!1:this.tip.visible=!0,this.currentState=SeaSunVillage.getHUDState()},n}(e.FitComponent);e.SeaSunHUD=t,__reflect(t.prototype,"UI.SeaSunHUD",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="SeasunOffcheckSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.onTouchTap=function(t){switch(t.target){case this.btnYes:(null==this.OnOk||this.OnOk())&&(this.btnYes.enabled=!1,UIManager.pop(this),e.offcheckPanel=null);break;default:this.close()}},n.prototype.close=function(){UIManager.pop(this),e.offcheckPanel=null},n}(e.FitComponent);e.SeasunOffcheck=t,__reflect(t.prototype,"UI.SeasunOffcheck",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="RoshanboSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.btnStart.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onStart,e),e}return __extends(n,t),n.prototype.assetLoaded=function(){this.btnStart.enabled=!0,this.timerId=egret.setTimeout(this.onTimeout,this,3*Game.Second)},n.prototype.onTimeout=function(){switch(this.timerId=null,this.list.selectedIndex){case 0:case 1:case 2:return;default:this.list.selectedIndex=Math.round(3*Math.random()),this.onStart()}},n.prototype.onAddToStage=function(){},n.prototype.onRemoveFromStage=function(){null!=this.timerId&&(egret.clearTimeout(this.timerId),this.timerId=null)},n.prototype.setResult=function(e){switch(this.currentState="end",this.btnStart.enabled=!0,e){case 3:switch(this.npcRoshambo.gotoAndStop("bo"),this.list.selectedIndex){case 0:this.result.text="Thất bại",this.result.textColor=13421772;break;case 1:this.result.text="Thắng",this.result.textColor=15900425;break;case 2:default:this.result.text="Hòa",this.result.textColor=1484815}break;case 1:switch(this.npcRoshambo.gotoAndStop("ro"),this.list.selectedIndex){case 1:this.result.text="Thất bại",this.result.textColor=13421772;break;case 2:this.result.text="Thắng",this.result.textColor=15900425;break;case 0:default:this.result.text="Hòa",this.result.textColor=1484815}break;case 2:switch(this.npcRoshambo.gotoAndStop("sham"),this.list.selectedIndex){case 2:this.result.text="Thất bại",this.result.textColor=13421772;break;case 0:this.result.text="Thắng",this.result.textColor=15900425;break;case 1:default:this.result.text="Hòa",this.result.textColor=1484815}}},n.prototype.onStart=function(){if(null!=this.timerId&&(egret.clearTimeout(this.timerId),this.timerId=null),"end"==this.currentState)UIManager.pop(this),e.roshambo=null;else{var t=void 0;if(null==this.list||null==this.list.selectedIndex)return;switch(this.list.selectedIndex){case 0:t=1;break;case 1:t=2;break;case 2:t=3;break;default:return void(t=0)}this.list.touchChildren=!1,this.btnStart.enabled=!1;var n=new net.def.C2SRoshambo;n.choice=t,net.socket.write(52,n.toArrayBuffer())}},n}(e.Roshambo);e.SeaSunRoshambo=t,__reflect(t.prototype,"UI.SeaSunRoshambo")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.nowarn=!1,e.skinName="ArenaShopSkin",e.timer=new RemainingTime,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.restTimes=ArenaShop.restRefreshTimes(),e.makeGoods(),e}return __extends(n,t),n.prototype.onEnterFrame=function(){if(null!=this.timer){var e=this.timer.getHourMinuteSecond();e!=this.nextTime&&(this.nextTime=e)}},n.prototype.onSyncRefreshTimes=function(){this.restTimes=ArenaShop.restRefreshTimes(),this.btnRefresh.enabled=this.restTimes>0},n.prototype.makeGoods=function(){var e=[];null!=ArenaShop.specialGoods&&e.push(ArenaShop.specialGoods);for(var t=0;t<ArenaShop.GoodsCount;t++)e.push(ArenaShop.goods[t]);null==this.goodsDataProvider?this.goodsDataProvider=new eui.ArrayCollection(e):this.goodsDataProvider.replaceAll(e)},n.prototype.onAddToStage=function(){this.shop=Shop,this.timer.deltaMillisecond=ArenaShop.nextTime,this.nextTime=this.timer.getHourMinuteSecond(),Game.dispatcher.addEventListener(Game.EVENT.CurrencyChange[Game.Currency.Arena],this.onSyncCurrency,this),Game.dispatcher.addEventListener(Game.EVENT.SyncArenaGoods,this.onSyncGoods,this),Game.dispatcher.addEventListener(Game.EVENT.RemoveArenaGoods,this.onSyncGoods,this),Game.dispatcher.addEventListener(Game.EVENT.SyncArenaRefreshTimes,this.onSyncRefreshTimes,this),SecondTicker.addEventListener(this.onEnterFrame,this),this.onSyncCurrency(),this.makeGoods(),guide.addEventListener(guide.GuideOperation.GuideArenaShop,this.onGuideReminder,this)},n.prototype.onRemoveFromStage=function(){SecondTicker.removeEventListener(this.onEnterFrame,this),Game.dispatcher.removeEventListener(Game.EVENT.CurrencyChange[Game.Currency.Arena],this.onSyncCurrency,this),Game.dispatcher.removeEventListener(Game.EVENT.SyncArenaGoods,this.onSyncGoods,this),Game.dispatcher.removeEventListener(Game.EVENT.RemoveArenaGoods,this.onSyncGoods,this),Game.dispatcher.removeEventListener(Game.EVENT.SyncArenaRefreshTimes,this.onSyncRefreshTimes,this),guide.removeEventListener(guide.GuideOperation.GuideArenaShop,this.onGuideReminder,this),this.shop=null},n.prototype.onSyncCurrency=function(){this.CurrencyArena=PlayerAttribute.currency[Game.Currency.Arena]},n.prototype.onSyncGoods=function(){this.makeGoods(),this.timer.deltaMillisecond=ArenaShop.nextTime,this.nextTime=this.timer.getHourMinuteSecond()},n.prototype.tapRefresh=function(){var t=this,n=PlayerAttribute.currency[Game.Currency.SilverCoin],i=PlayerAttribute.currency[Game.Currency.GoldCoin],a=10;if(this.shop.refreshItem<1&&a>n)if(i+n>=a){var r=function(){var e=PlayerAttribute.currency[Game.Currency.SilverCoin],t=PlayerAttribute.currency[Game.Currency.GoldCoin];return a>t+e?void PopUpMessage.push(lang.String("not enough goldcoin"),color.RED):void net.socket.write(123,null)};if(this.nowarn)r();else{var o=new e.SliverCoinPrompt;o.title=lang.String("operation confirm"),o.content=lang.StringWithFormat("if replace {1} silver with gold",a-n),o.cb=function(e){r(),t.nowarn=e,UIManager.pop(o)},UIManager.push(o)}}else PopUpMessage.push(lang.String("not enough anyCoin"),color.RED);else net.socket.write(123,null)},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnGoArena:if(!Game.isWildMap())return void PopUpMessage.push(lang.String("operation not permitted"),color.RED);ArenaChallenge.onOpenArena(),UIManager.closeMall();break;case this.btnRefresh:this.tapRefresh()}},n.prototype.onGuideReminder=function(){var e=this;this.visible&&guide.pushMovie({weight:1,handle:function(){e.goodsDataProvider.refresh()}})},n}(eui.Component);e.ArenaShopView=t,__reflect(t.prototype,"UI.ArenaShopView",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="FameGoodsSkin",e.onDataChanged=MakeDelayExecute(e.dataChanged,e,100),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.btnBuy.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onBtnBuy,e),e.cell.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTipShow,e),e.soldOut.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTipShow,e),e}return __extends(n,t),n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.CurrencyChange[Game.Currency.SilverCoin],this.onDataChanged,this),Game.dispatcher.addEventListener(Game.EVENT.CurrencyChange[Game.Currency.GuildContribution],this.onDataChanged,this),this.onDataChanged()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.CurrencyChange[Game.Currency.SilverCoin],this.onDataChanged,this),Game.dispatcher.removeEventListener(Game.EVENT.CurrencyChange[Game.Currency.GuildContribution],this.onDataChanged,this),this.onDataChanged.stop()},n.prototype.onBtnBuy=function(){if(null!=this.data){switch(this.data.type){case Shop.GoodsType.Equip:if(PlayerAttribute.bag.capacity(Game.BagPage.Equip)<=0)return void PopUpMessage.push(lang.String("bag room full"),color.RED);break;case Shop.GoodsType.Prop:var t=this.data,n=PlayerAttribute.bag.calcItemOccupancy(t.genre,t.detailType,t.count);if(PlayerAttribute.bag.capacity(n.page)<n.occupancy)return void PopUpMessage.push(lang.String("bag room full"),color.RED)}switch(this.data.currency){case Game.Currency.GoldCoin:if(PlayerAttribute.currency[this.data.currency]<this.data.currentPrice)return void UIManager.push(new e.GoldCoinPrompt);this.data.type==Shop.GoodsType.Coin?UIManager.push(new e.ItemNum(this.data)):this.btnBuy.enabled=this.data.buy(this.data.pos,null);break;case Game.Currency.SilverCoin:if(this.groupStock.visible){if(PlayerAttribute.currency[this.data.currency]<this.data.currentPrice){var t=this.data.clone();return t.param=1,void UIManager.push(new e.SilverPrompt(t))}this.btnBuy.enabled=this.data.buy(this.data.pos,1)}else this.data.type==Shop.GoodsType.Coin?UIManager.push(new e.ItemNum(this.data)):this.btnBuy.enabled=this.data.buy(this.data.pos,null);break;case Game.Currency.GuildContribution:this.btnBuy.enabled=this.data.buy(this.data.pos,this.data.param);break;case Game.Currency.BetScore:this.btnBuy.enabled=this.data.buy(this.data.pos,this.data.param);break;case Game.Currency.BetCoin:this.data.type==Shop.GoodsType.Coin?UIManager.push(new e.ItemNum(this.data)):this.btnBuy.enabled=this.data.buy(this.data.pos,null);break;case Game.Currency.Fubi:this.btnBuy.enabled=this.data.buy(this.data.pos,null)}}},n.prototype.dataChanged=function(){if(null==this.data)return this.cell.icon=null,this.cell.quality=null,this.cell.visible=!1,this.btnBuy.enabled=!1,this.soldOut.visible=!0,void(this.itemName.text="");if(this.cell.visible=!0,this.cell.rbcorner=null,this.btnBuy.enabled=!0,this.soldOut.visible=!1,null!=this.btnBuy&&null!=this.cell){switch(this.currencyIcon=Game.currency2Icon[this.data.currency],this.labelPrice.text=""+this.data.currentPrice,this.data.type!=Shop.GoodsType.Coin&&(this.data.param.money<this.data.currentPrice?this.labelPrice.textColor=color.RED:this.labelPrice.textColor=color.YELLOW,this.labelLeftStock.text="Tồn kho: "+this.data.param.leftStock,0==this.data.param.leftStock?this.labelLeftStock.textColor=color.RED:this.labelLeftStock.textColor=color.YELLOW),this.data.type){case Shop.GoodsType.Prop:this.cell.rbcorner=""+this.data.count,this.cell.UpdatePiecesIcon(this.data.genre);break;case Shop.GoodsType.Coin:this.cell.rbcorner=""+this.data.count}if(this.itemName.textFlow=Game.HtmlTextParser.parse("<font color="+egret.toColorString(Item.QualityColor[this.data.quality])+">"+this.data.name+"</font>"),this.cell.icon=this.data.icon,this.cell.quality=this.data.quality,null!=this.data.param.leftStock?(this.groupStock.visible=this.data.param.leftStock>=0&&this.data.param.leftStock<Shop.MaxLeftStack,this.soldOut.visible=this.data.param.leftStock<=0,this.btnBuy.enabled=!this.soldOut.visible):(this.groupStock.visible=!1,this.soldOut.visible=!1,this.btnBuy.enabled=!0),null!=this.data.param.discountIcon)this.discountIcon=this.data.param.discountIcon;else switch(this.data.discount){case 30:case 40:case 50:case 60:case 70:case 80:this.discountIcon="ui/shop/"+this.data.discount+".png";break;default:this.discountIcon=""}}},n.prototype.onTipShow=function(){if(null!=this.data){var t;switch(this.data.type){case Shop.GoodsType.Equip:var n=this.data;t={type:"equip",content:{id:n.id,part:Item.EquipFormatPart[n.part],quality:this.data.quality}};break;case Shop.GoodsType.Prop:var i=this.data;t={type:"item",content:{genre:i.genre,detailType:i.detailType,count:i.count}};break;case Shop.GoodsType.Book:var a=this.data;t={type:"book",content:{id:a.id}};break;case Shop.GoodsType.Coin:var r=this.data;t={type:r.awardType,content:r.count}}var o=e.ItemTips.instance;o.data=t,UIManager.push(e.ItemTips.instance)}},n}(eui.ItemRenderer);e.FameGoods=t,__reflect(t.prototype,"UI.FameGoods")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="GoldCoinShopSkin",n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.list.itemRenderer=e.FameGoods,n.list.dataProvider=new eui.ArrayCollection(GoldCoinShop.goods),n}return __extends(n,t),n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.GoldCoinShopSync,this.onDataChanged,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.GoldCoinShopSync,this.onDataChanged,this)},n.prototype.onDataChanged=function(){this.list.dataProvider.replaceAll(GoldCoinShop.goods)},n}(eui.Component);e.GoldCoinShopView=t,__reflect(t.prototype,"UI.GoldCoinShopView",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="Goods",e.onDataChanged=MakeDelayExecute(e.dataChanged,e,100),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btnBuy.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),this.cell.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTipShow,this)},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.CurrencyChange[Game.Currency.CopperCoin],this.onDataChanged,this),Game.dispatcher.addEventListener(Game.EVENT.CurrencyChange[Game.Currency.SilverCoin],this.onDataChanged,this),Game.dispatcher.addEventListener(Game.EVENT.CurrencyChange[Game.Currency.GoldCoin],this.onDataChanged,this),Game.dispatcher.addEventListener(Game.EVENT.CurrencyChange[Game.Currency.Arena],this.onDataChanged,this),Game.dispatcher.addEventListener(Game.EVENT.BagItemChange,this.onDataChanged,this),this.onDataChanged()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.BagItemChange,this.onDataChanged,this),Game.dispatcher.removeEventListener(Game.EVENT.CurrencyChange[Game.Currency.CopperCoin],this.onDataChanged,this),Game.dispatcher.removeEventListener(Game.EVENT.CurrencyChange[Game.Currency.SilverCoin],this.onDataChanged,this),Game.dispatcher.removeEventListener(Game.EVENT.CurrencyChange[Game.Currency.GoldCoin],this.onDataChanged,this),Game.dispatcher.removeEventListener(Game.EVENT.CurrencyChange[Game.Currency.Arena],this.onDataChanged,this),this.onDataChanged.stop()},n.prototype.onTouchTap=function(){if(null!=this.data){switch(this.data.type){case Shop.GoodsType.Equip:if(PlayerAttribute.bag.capacity(Game.BagPage.Equip)<=0)return void PopUpMessage.push(lang.String("bag room full"),color.RED);break;case Shop.GoodsType.Prop:var t=this.data,n=PlayerAttribute.bag.calcItemOccupancy(t.genre,t.detailType,t.count);if(PlayerAttribute.bag.capacity(n.page)<n.occupancy)return void PopUpMessage.push(lang.String("bag room full"),color.RED)}if(this.data.param&&!this.data.isItemCurrency){if(PlayerAttribute.currency[this.data.currency]<this.data.currentPrice){switch(this.data.currency){case Game.Currency.Arena:UIManager.push(new e.ArenaCoinPrompt);break;case Game.Currency.GoldCoin:UIManager.push(new e.GoldCoinPrompt);break;case Game.Currency.SilverCoin:UIManager.push(new e.SilverPrompt(this.data));break;case Game.Currency.CopperCoin:e.ResourceObtain.Open([e.ObtResId.CopperCoin]),PopUpMessage.push(lang.String("not enough copperCoin"),color.RED)}return}this.btnBuy.enabled=this.data.buy(this.data.pos,this.data.param)}else this.btnBuy.enabled=this.data.buy(this.data.pos,this.data.param)}},n.prototype.dataChanged=function(){if(null==this.data)return this.cell.icon=null,this.cell.quality=null,this.cell.visible=!1,this.btnBuy.enabled=!1,this.soldOut.visible=!0,void(this.itemName.text="");if(this.cell.visible=!0,this.btnBuy.enabled=!0,this.soldOut.visible=!1,null!=this.btnBuy&&null!=this.cell){var e=this.data;switch(null!=e.guide&&e.guide?guide.AddMovieClip(this.btnBuy):guide.removeMovieClip(this.btnBuy),this.itemName.textFlow=Game.HtmlTextParser.parse("<font color="+egret.toColorString(Item.QualityColor[e.quality])+">"+e.name+"</font>"),this.cell.icon=this.data.icon,this.cell.quality=this.data.quality,e.isItemCurrency?(this.cost.data=e.Currency,this.cost.visible=!0,this.imgCurrency.visible=!1):(this.imgCurrency.source=e.Currency,this.imgCurrency.visible=!0,this.cost.visible=!1),null!=e.param.curDailyBuyLimit&&null!=e.param.dailyBuyLimit&&e.param.dailyBuyLimit>0?(this.dailyBuyLimit=lang.Format("Giới hạn: {1}/{2}",e.param.curDailyBuyLimit,e.param.dailyBuyLimit),this.btnBuy.enabled=e.param.curDailyBuyLimit<e.param.dailyBuyLimit):this.dailyBuyLimit="",this.data.type){case Shop.GoodsType.Equip:this.cell.rbcorner="Lv"+this.data.level,this.cell.plugin=null;break;case Shop.GoodsType.Prop:this.cell.rbcorner=""+this.data.count,this.cell.UpdatePiecesIcon(this.data.genre);break;default:this.cell.rbcorner=null,this.cell.plugin=null}switch(this.data.discount){case 30:case 40:case 50:case 60:case 70:case 80:this.discountIcon="ui/shop/"+this.data.discount+".png";break;default:this.discountIcon=""}}},n.prototype.onTipShow=function(){if(null!=this.data){var t;switch(this.data.type){case Shop.GoodsType.Equip:var n=this.data;t={type:"equip",content:{id:n.id,part:Item.EquipFormatPart[n.part],quality:n.quality,attributes:n.attributes}};break;case Shop.GoodsType.Prop:var i=this.data;t={type:"item",content:{genre:i.genre,detailType:i.detailType,count:i.count}};break;case Shop.GoodsType.Book:var a=this.data;t={type:"book",content:{id:a.id}}}var r=e.ItemTips.instance;r.data=t,UIManager.push(e.ItemTips.instance)}},n}(eui.ItemRenderer);e.Goods=t,__reflect(t.prototype,"UI.Goods")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="GuildShopSkin",e.shopId=0,e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.GuildShopDataChange,this.onDataChange,this),Game.dispatcher.addEventListener(Game.EVENT.CurrencyChange[Game.Currency.GuildContribution],this.onDataChange,this),this.tab.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTabTap,this),this.list.itemRenderer=e.FameGoods,this.selectShop(this.shopId),this.onDataChange()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.GuildShopDataChange,this.onDataChange,this),Game.dispatcher.removeEventListener(Game.EVENT.CurrencyChange[Game.Currency.GuildContribution],this.onDataChange,this),this.tab.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTabTap,this)},n.prototype.onTabTap=function(e){this.selectShop(e.itemIndex)},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnGetContribution:e.ResourceObtain.Open([e.ObtResId.guildcontribute]);break;case this.imgClose:this.close()}},n.prototype.close=function(){UIManager.pop(this)},n.prototype.onDataChange=function(){this.money=PlayerAttribute.currency[Game.Currency.GuildContribution],null==this.list.dataProvider?this.list.dataProvider=new eui.ArrayCollection(GuildShopCore.GetShopData(this.shopId)):this.list.dataProvider.replaceAll(GuildShopCore.GetShopData(this.shopId))},n.prototype.selectShop=function(e){this.currentState=""+e,this.shopId=e,this.list.dataProvider=new eui.ArrayCollection(GuildShopCore.GetShopData(this.shopId))},n.prototype.SetPage=function(e){this.selectShop(e)},n}(e.FitComponent);e.GuildShop=t,__reflect(t.prototype,"UI.GuildShop",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(e){var n=t.call(this)||this;switch(n.MaxCount=999,n.discountIcon="",n.skinName="ItemNumSkin",n.data=e,n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.data.type){case Shop.GoodsType.Book:var i=n.data;n.itemDesc.textFlow=Game.HtmlTextParser.parse(table.books[i.id].desc),n.currentState="otherItem",n.MaxCount=1;break;case Shop.GoodsType.Equip:var a=n.data,r=table.equips[a.part][a.id],o=Game.Faction[PlayerAttribute.faction];n.itemDesc.textFlow=Game.HtmlTextParser.parse(r[o].desc),n.currentState="otherItem",n.MaxCount=1;break;case Shop.GoodsType.Prop:var s=n.data,l=table.props[s.genre][s.detailType],u=l.desc;if(1==s.genre)switch(l.params.type){case"dailyAwardZhenqi":u+="\n"+Meridian.GetHuiXianDanDesc()}s.count&&(n.showcase.rbcorner=""+s.count),n.itemDesc.textFlow=Game.HtmlTextParser.parse(u),n.currentState="propItem";break;case Shop.GoodsType.Custom:n.itemDesc.textFlow=Game.HtmlTextParser.parse(n.data.desc),n.currentState="propItem";break;case Shop.GoodsType.Coin:var c=n.data;n.itemDesc.textFlow=Game.HtmlTextParser.parse(n.data.desc),n.currentState="propItem",c.count&&(n.showcase.rbcorner=""+c.count);break;default:return void UIManager.pop(n)}switch(n.showcase.icon=n.data.icon,n.showcase.quality=n.data.quality,n.itemname.text=n.data.name,n.itemname.textColor=Item.QualityColor[n.data.quality],n.priveBeforeDiscount=n.data.price,console.log(e.param.configLimit,e.param.leftStock),e.param.configLimit>0&&(n.MaxCount=e.param.leftStock,n.soldOut.visible=0==n.MaxCount?!0:!1,n.btnBuy.enabled=0==n.MaxCount?!1:!0,n.MaxCount=0==n.MaxCount?1:n.MaxCount),n.price=n.data.price*n.data.discount/100,n.data.discount){case 30:case 40:case 50:case 60:case 70:case 80:n.discountIcon="ui/shop/"+n.data.discount+".png";break;default:n.discountIcon=""}return n.boxNumer=1,n.totalprice=n.boxNumer*n.price,n.currencyIcon=Game.currency2Icon[n.data.currency],n}return __extends(n,t),n.prototype.onAddToStage=function(e){egret.Capabilities.isMobile||(this.labBoxNumber.type=egret.TextFieldType.INPUT,this.labBoxNumber.restrict="0-9",this.labBoxNumber.addEventListener(egret.Event.CHANGE,this.onNumberChange,this),KeyBoardSystem.focus(this))
},n.prototype.onKeyDown=function(){},n.prototype.onRemoveFromStage=function(e){egret.Capabilities.isMobile||(this.labBoxNumber.removeEventListener(egret.Event.CHANGE,this.onNumberChange,this),KeyBoardSystem.restore())},n.prototype.onTouchTap=function(t){switch(this.boxNumer=parseInt(this.labBoxNumber.text),t.target){case this.btnBuy:if(PlayerAttribute.currency[this.data.currency]<this.priveBeforeDiscount*this.boxNumer){switch(this.data.currency){case Game.Currency.Arena:UIManager.push(new e.ArenaCoinPrompt);break;case Game.Currency.GoldCoin:UIManager.push(new e.GoldCoinPrompt);break;case Game.Currency.SilverCoin:var n=this.data.clone();n.param=this.boxNumer,n.price=this.priveBeforeDiscount*this.boxNumer,UIManager.push(new e.SilverPrompt(n));break;case Game.Currency.CopperCoin:PopUpMessage.push(lang.String("not enough copperCoin"),color.RED);break;case Game.Currency.BetCoin:PopUpMessage.push(lang.String("not enough betCoin"),color.RED)}return}return this.data.buy(this.data.pos,this.boxNumer),void this.close();case this.imgClose:return void this.close();case this.btnMinus:this.boxNumer-=1;break;case this.btnMinus10:this.boxNumer-=10;break;case this.btnPlus:this.boxNumer+=1;break;case this.btnPlus10:this.boxNumer+=10}this.boxNumer<1&&(this.boxNumer=1),this.MaxCount>0&&this.boxNumer>this.MaxCount&&(this.boxNumer=this.MaxCount),this.totalprice=this.boxNumer*this.price},n.prototype.close=function(){UIManager.pop(this)},n.prototype.onNumberChange=function(e){var t=parseInt(this.labBoxNumber.text);isNaN(t)&&(t=1),t=Math.min(t,this.MaxCount),t=Math.max(1,t),this.labBoxNumber.text=t.toString(),this.totalprice=t*this.price},n}(e.FitComponent);e.ItemNum=t,__reflect(t.prototype,"UI.ItemNum",["eui.UIComponent","egret.DisplayObject","KeyBoradComponent"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="MallSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.get=function(e){return null==this._instance&&(this._instance=new n),null!=e&&(this._instance.page=e),this._instance},n.close=function(){null!=this._instance&&UIManager.pop(this._instance)},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.AddItem,this.onItemChange,this),Game.dispatcher.addEventListener(Game.EVENT.RemoveItem,this.onItemChange,this),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,this.onItemChange,this),this.onMaterialChange(),this.tab.selectedIndex=this.page},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.AddItem,this.onItemChange,this),Game.dispatcher.removeEventListener(Game.EVENT.RemoveItem,this.onItemChange,this),Game.dispatcher.removeEventListener(Game.EVENT.UpdateItem,this.onItemChange,this)},n.prototype.onItemChange=function(e){var t=e.data;10==t.Item.Type&&this.onMaterialChange()},n.prototype.onMaterialChange=function(){var e=(Player.instance,PlayerAttribute.bag.CalcCount(10,1));Shop.refreshItem=e},n.prototype.close=function(){UIManager.closeMall()},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnRules:var n=new e.Rule;n.skinName="MallRulesSkin",UIManager.pushPage(n)}},n}(e.FitComponent);e.Mall=t,__reflect(t.prototype,"UI.Mall",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.nowarn=!1,e.skinName="MysteryShopSkin",e.remainingTime=new RemainingTime,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.makeGoods(),e.btnRefresh.addEventListener(egret.TouchEvent.TOUCH_TAP,e.tapRefresh,e),e.onSyncRefreshTimes(),e}return __extends(n,t),n.prototype.onAddToStage=function(){this.fa=PlayerAttribute.fa,this.shop=Shop,this.remainingTime.deltaMillisecond=MysteryShop.nextTime,this.nextTime=this.remainingTime.getHourMinuteSecond(),Game.dispatcher.addEventListener(Game.EVENT.SyncMysteryGoods,this.onSyncGoods,this),Game.dispatcher.addEventListener(Game.EVENT.RemoveMysteryGoods,this.onSyncGoods,this),Game.dispatcher.addEventListener(Game.EVENT.SyncMysterRefreshTimes,this.onSyncRefreshTimes,this),SecondTicker.addEventListener(this.onEnterFrame,this),guide.addEventListener(guide.GuideOperation.MysteryShop,this.onGuideReminder,this),this.onSyncRefreshTimes(),this.makeGoods()},n.prototype.onRemoveFromStage=function(){SecondTicker.removeEventListener(this.onEnterFrame,this),Game.dispatcher.removeEventListener(Game.EVENT.SyncMysteryGoods,this.onSyncGoods,this),Game.dispatcher.removeEventListener(Game.EVENT.RemoveMysteryGoods,this.onSyncGoods,this),Game.dispatcher.removeEventListener(Game.EVENT.SyncMysterRefreshTimes,this.onSyncRefreshTimes,this),guide.removeEventListener(guide.GuideOperation.MysteryShop,this.onGuideReminder,this),this.shop=null,this.fa=null},n.prototype.makeGoods=function(){var e=[];null!=MysteryShop.specialGoods&&e.push(MysteryShop.specialGoods);for(var t=0;t<MysteryShop.GoodsCount;t++)e.push(MysteryShop.goods[t]);null==this.goodsDataProvider?this.goodsDataProvider=new eui.ArrayCollection(e):this.goodsDataProvider.replaceAll(e)},n.prototype.onSyncRefreshTimes=function(){this.restTimes=MysteryShop.restRefreshTimes(),this.btnRefresh.enabled=this.restTimes>0},n.prototype.onSyncGoods=function(){this.makeGoods(),this.remainingTime.deltaMillisecond=MysteryShop.nextTime,this.nextTime=this.remainingTime.getHourMinuteSecond()},n.prototype.onEnterFrame=function(){if(null!=this.remainingTime){var e=this.remainingTime.getHourMinuteSecond();e!=this.nextTime&&(this.nextTime=e)}},n.prototype.tapRefresh=function(){var t=this,n=PlayerAttribute.currency[Game.Currency.SilverCoin],i=PlayerAttribute.currency[Game.Currency.GoldCoin],a=10;if(this.shop.refreshItem<1&&a>n)if(i+n>=a){var r=function(){var e=PlayerAttribute.currency[Game.Currency.SilverCoin],n=PlayerAttribute.currency[Game.Currency.GoldCoin];return a>n+e?void PopUpMessage.push(lang.String("not enough goldcoin"),color.RED):(t.btnRefresh.enabled=!1,void net.socket.write(121,null))};if(this.nowarn)r();else{var o=new e.SliverCoinPrompt;o.title=lang.String("operation confirm"),o.content=lang.StringWithFormat("if replace {1} silver with gold",a-n),o.cb=function(e){r(),t.nowarn=e,UIManager.pop(o)},UIManager.push(o)}}else PopUpMessage.push(lang.String("not enough anyCoin"),color.RED);else this.btnRefresh.enabled=!1,net.socket.write(121,null)},n.prototype.onGuideReminder=function(){var e=this;this.visible&&guide.pushMovie({weight:1,handle:function(){e.goodsDataProvider.refresh()}})},n}(eui.Component);e.MysteryShopView=t,__reflect(t.prototype,"UI.MysteryShopView",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var g_nSin=[1024,1019,1004,979,946,903,851,791,724,649,568,482,391,297,199,100,0,-100,-199,-297,-391,-482,-568,-649,-724,-791,-851,-903,-946,-979,-1004,-1019,-1024,-1019,-1004,-979,-946,-903,-851,-791,-724,-649,-568,-482,-391,-297,-199,-100,0,100,199,297,391,482,568,649,724,791,851,903,946,979,1004,1019],g_nCos=[0,-100,-199,-297,-391,-482,-568,-649,-724,-791,-851,-903,-946,-979,-1004,-1019,-1024,-1019,-1004,-979,-946,-903,-851,-791,-724,-649,-568,-482,-391,-297,-199,-100,0,100,199,297,391,482,568,649,724,791,851,903,946,979,1004,1019,1024,1019,1004,979,946,903,851,791,724,649,568,482,391,297,199,100],g_InternalDirSinCosCodeBuffer=[139,68,36,8,133,192,124,22,139,76,36,12,59,193,125,14,193,224,6,153,247,249,139,76,36,4,139,4,129,195,131,200,255,195],g_LogicDir2DisplayAngle=[0,11.104339435589694,21.624084737655394,31.24692941347699,39.57844526114937,46.87134423385098,53.16239530804981,58.64190888981446,63.434948822922024,67.6945898145398,71.54485527396199,75.05673587609846,78.3236494060418,81.37481682182957,84.34026359904496,87.19088011392233,90,-267.19088011392233,-264.340263599045,-261.37481682182954,-258.3236494060418,-255.05673587609846,-251.54485527396199,-247.6945898145398,-243.43494882292202,-238.64190888981446,-233.1623953080498,-226.87134423385098,-219.57844526114937,-211.246929413477,-201.62408473765538,-191.10433943558968,-180,-168.89566056441032,-158.37591526234462,-148.75307058652305,-140.42155473885066,-133.12865576614902,-126.8376046919502,-121.35809111018557,-116.56505117707799,-112.30541018546022,-108.45514472603804,-104.94326412390154,-101.67635059395823,-98.62518317817046,-95.65973640095507,-92.80911988607767,-90,-87.19088011392233,-84.34026359904493,-81.37481682182954,-78.32364940604177,-75.05673587609846,-71.54485527396196,-67.69458981453978,-63.43494882292201,-58.64190888981443,-53.162395308049796,-46.87134423385097,-39.578445261149334,-31.246929413476956,-21.62408473765538,-11.10433943558968],UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="EggAwardItemSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),n.prototype.onAddToStage=function(){this.btnGetAward.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGetAward,this)},n.prototype.onRemoveFromStage=function(){},n.prototype.dataChanged=function(){null!=this.data&&(0==this.data.enable?(this.btnGetAward.enabled=!1,this.btnString="Nhận"):1==this.data.enable?(this.btnGetAward.enabled=!0,this.btnString="Nhận"):2==this.data.enable&&(this.btnGetAward.enabled=!1,this.btnString="Đã nhận"),this.list.itemRenderer=e.AwardCell,this.list.dataProvider=new eui.ArrayCollection(this.data.awardList.content))},n.prototype.onGetAward=function(){var e=new net.def.C2SSmashEggIdx;e.type=1,e.idx=this.data.count,net.socket.write(2201,e.toArrayBuffer())},n}(eui.ItemRenderer);e.EggAwardItem=t,__reflect(t.prototype,"UI.EggAwardItem")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="EggItemSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.tweenEgg.addEventListener("complete",this.onTweenGroupComplete,this),this.tweenEgg1.addEventListener("complete",this.onTweenGroupComplete1,this)},n.prototype.onAddToStage=function(){this.image.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSmash,this),this.image.$setAlpha(1),this.mc.removeWhenComplete=!1,this.mc.visible=!1,this.mc.Load("skill/zadan/zadan.json","zadan")},n.prototype.onRemoveFromStage=function(){this.tweenEgg.stop(),this.tweenEgg1.stop(),this.data.tweening=!1,this.dataChanged(),this.mc.visible=!1,this.mc.stop(),this.mc.free()},n.prototype.dataChanged=function(){1==this.data.type?(this.normal="ui/smashEggs/a101.png",this.broken="ui/smashEggs/a103.png"):(this.normal="ui/smashEggs/a100.png",this.broken="ui/smashEggs/a102.png"),0==this.data.opened?(this.currentState="step1",this.imagepath=this.normal,this.data.tween=!0,0==this.data.tweening):0==this.data.tweening&&(1==this.data.tween?(this.data.tween=!1,this.data.tweening=!0,this.mc.gotoAndPlay(0,1),this.tweenEgg.play(0)):(null!=this.data.awardInfo?(this.currentState="step2",this.cell.data=this.data.awardInfo):this.currentState="step3",this.imagepath=this.broken))},n.prototype.onTweenGroupComplete=function(){null!=this.data.awardInfo?(this.currentState="step2",this.cell.data=this.data.awardInfo):this.currentState="step3",this.imagepath=this.broken,this.tweenEgg1.play(0)},n.prototype.onTweenGroupComplete1=function(){this.data.tweening=!1,Game.dispatcher.dispatchEventWith(Game.EVENT.ActivitySmashEggsRefresh)},n.prototype.onSmash=function(){if("step1"==this.currentState){if(PlayerAttribute.bag.capacity(Game.BagPage.Prop)<1)return PopUpMessage.push(lang.StringWithFormat("bag room full{1}",1),color.RED),!1;if(this.data.smashCost>PlayerAttribute.currency[Game.Currency.GoldCoin])return void UIManager.push(new e.GoldCoinPrompt);ActivitySmashEggs.DoSmashEgg(this.data.idx)}},n}(eui.ItemRenderer);e.EggItem=t,__reflect(t.prototype,"UI.EggItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="SmashEggsSkin",n.currentState="smash_egg",n.CumuAwardList.itemRenderer=e.EggAwardItem,n.AwardShowList.itemRenderer=e.AwardCell,n.EggList.itemRenderer=e.EggItem,n.autoTrain=MakeDelayExecute(n.onSmashInTurn,n,800),n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.tab.addEventListener(eui.ItemTapEvent.ITEM_TAP,n.onBarTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n}return __extends(n,t),n.prototype.close=function(){UIManager.pop(this)},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.ActivitySmashEggs,this.onUpdate,this),Game.dispatcher.addEventListener(Game.EVENT.ActivitySmashEggsAward,this.onUpdateAward,this),Game.dispatcher.addEventListener(Game.EVENT.ActivitySmashEggsRefresh,this.onCheckFresh,this),this.AwardShowList.dataProvider=new eui.ArrayCollection(ActivitySmashEggs.cfg.itemshow.content),this.onUpdate(),this.onCheckFresh()},n.prototype.onRemoveFromStage=function(){this.autoTrain.stop(),Game.dispatcher.removeEventListener(Game.EVENT.ActivitySmashEggs,this.onUpdate,this),Game.dispatcher.removeEventListener(Game.EVENT.ActivitySmashEggsAward,this.onUpdateAward,this)},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnSmashAll:this.onSmashInTurn();break;case this.btnFresh:this.onFresh()}},n.prototype.onBarTap=function(e){switch(e.itemIndex){case 0:this.onSwitchType("smash_egg");break;case 1:this.onSwitchType("get_award")}},n.prototype.onSwitchType=function(e){this.currentState=e},n.prototype.onUpdate=function(){null!=ActivitySmashEggs._data&&null!=ActivitySmashEggs.cfg&&(this.refreshEggList(),this.initAwardList())},n.prototype.initAwardList=function(){this.cumulativeTimes=ActivitySmashEggs._data.count,this.RefreshCost=ActivitySmashEggs.cfg.refreshCost;for(var e=6,t=0;t<ActivitySmashEggs._data.vector.length;t++)e-=ActivitySmashEggs._data.vector[t].opened;this.SmashAllCost=e*ActivitySmashEggs.cfg.smashCost,""!=ActivitySmashEggs._data.playername&&""!=ActivitySmashEggs._data.itemname&&(this.playerName=ActivitySmashEggs._data.playername+"Đập trứng được nhận:",this.itemName=ActivitySmashEggs._data.itemname);var n;n=new Array;for(var t=0;t<ActivitySmashEggs.cfg.accaward.length;t++){var i=ActivitySmashEggs.cfg.accaward[t],a=0;1==this.getCumuAwardByBit(t+1)?a=2:ActivitySmashEggs._data.count>=i.count&&(a=1);var r={count:i.count,enable:a,awardList:i.award};n.push(r)}var o=this.CumuAwardList.dataProvider;null==o?this.CumuAwardList.dataProvider=new eui.ArrayCollection(n):o.replaceAll(n)},n.prototype.refreshEggList=function(){if(null==this.EggListInfo){this.EggListInfo=new Array;for(var e=0;e<ActivitySmashEggs._data.vector.length;e++){var t={idx:e,type:ActivitySmashEggs._data.vector[e].type,opened:ActivitySmashEggs._data.vector[e].opened,tweening:!1,smashCost:ActivitySmashEggs.cfg.smashCost,awardInfo:null};this.EggListInfo.push(t)}}else for(var e=0;e<ActivitySmashEggs._data.vector.length;e++)this.EggListInfo[e].type=ActivitySmashEggs._data.vector[e].type,this.EggListInfo[e].opened=ActivitySmashEggs._data.vector[e].opened;var n=this.EggList.dataProvider;null==n?this.EggList.dataProvider=new eui.ArrayCollection(this.EggListInfo):n.replaceAll(this.EggListInfo)},n.prototype.onUpdateAward=function(){var e=ActivitySmashEggs._award,t={genre:e.award.params[0],detailType:e.award.params[1],count:e.award.params[2]},n={type:"item",content:t};this.EggListInfo[ActivitySmashEggs._award.idx].awardInfo=n;var i=this.EggList.dataProvider;null==i?this.EggList.dataProvider=new eui.ArrayCollection(this.EggListInfo):i.replaceAll(this.EggListInfo)},n.prototype.onFresh=function(){var t=this;if(this.RefreshCost>PlayerAttribute.currency[Game.Currency.GoldCoin])return void UIManager.push(new e.GoldCoinPrompt);if(!this.nowarn&&this.checkGoldEgg()){var n=new e.SliverCoinPrompt;n.title=lang.String("operation confirm"),n.content="Còn có trứng vàng chưa đập, bạn có xác nhận đổi mới không ?",n.cb=function(e){var i=new net.def.C2SSmashEggIdx;i.type=0,i.idx=6,net.socket.write(2201,i.toArrayBuffer()),PopUpMessage.push("Đổi mới thành công",color.GREEN),t.nowarn=e,UIManager.pop(n)},UIManager.push(n)}else{var i=new net.def.C2SSmashEggIdx;i.type=0,i.idx=6,net.socket.write(2201,i.toArrayBuffer()),PopUpMessage.push("Đổi mới thành công",color.GREEN)}},n.prototype.checkGoldEgg=function(){for(var e=0;e<ActivitySmashEggs._data.vector.length;e++)if(2==ActivitySmashEggs._data.vector[e].type&&0==ActivitySmashEggs._data.vector[e].opened)return!0;return!1},n.prototype.onSmashInTurn=function(){if(PlayerAttribute.bag.capacity(Game.BagPage.Prop)<1)return PopUpMessage.push(lang.StringWithFormat("bag room full{1}",1),color.RED),!1;if(ActivitySmashEggs.cfg.smashCost>PlayerAttribute.currency[Game.Currency.GoldCoin])return void UIManager.push(new e.GoldCoinPrompt);for(var t=-1,n=6,i=0;i<ActivitySmashEggs._data.vector.length;i++)n-=ActivitySmashEggs._data.vector[i].opened,0==ActivitySmashEggs._data.vector[i].opened&&0>t&&(t=i);if(-1!=t){var a=this.EggList.dataProvider;a.getItemAt(t).tween=!0,ActivitySmashEggs.DoSmashEgg(t),n>1&&this.autoTrain()}},n.prototype.onCheckFresh=function(){var e=this.EggList.dataProvider;if(null!=e){for(var t=0,n=0;6>n;n++){var i=e.getItemAt(n);1==i.opened&&0==i.tweening&&t++}if(t>=6){var a=new net.def.C2SSmashEggIdx;return a.type=0,a.idx=6,void net.socket.write(2201,a.toArrayBuffer())}}},n.prototype.getCumuAwardByBit=function(e){var t=ActivitySmashEggs._data.awardinfo;return t>>e-1&1},n}(eui.Component);e.SmashEggs=t,__reflect(t.prototype,"UI.SmashEggs",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.data=[{type:"clientitem",icon:"icon/client_item/partner.png",name:"Mảnh Môn Khách",quality:5,desc:"Có cơ hội nhận Mảnh Môn Khách các phẩm chất",count:"",plugin:"ui/public/pieces_icon.png"},{type:"clientitem",icon:"icon/item/gold.png",name:"KNB Khóa",quality:3,desc:"Nhận nhiều KNB Khóa",count:""},{type:"item",content:{genre:9,detailType:1}},{type:"clientitem",icon:"icon/client_item/exp.png",name:"Nhiều EXP",quality:2,desc:"Được nhận thưởng EXP",count:""}],n.skinName="CrossServerSongJinWarSkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.list.itemRenderer=e.AwardCell,n}return __extends(n,t),n.prototype.onTouchTap=function(t){switch(t.target){case this.btnSign:this.onSign();break;case this.imgClose:this.close();break;case this.btnRules:var n=new e.Rule;n.skinName="SongJinRuleSkin",n.currentState="crossserver",UIManager.pushPage(n)}},n.prototype.close=function(){UIManager.pop(this)},n.prototype.onSign=function(){return PersonalMatchScene.isOpenTime()?void(this.txtWarStatus=lang.StringWithFormat("tipNextWarTime","22:00")):void net.socket.write(266,null)},n.prototype.onAddToStage=function(){this.list.dataProvider=new eui.ArrayCollection(this.data),this.isSign(),Game.dispatcher.addEventListener(Game.EVENT.SongjinEnrollResult,this.onSignResult,this),this.initUiData()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.SongjinEnrollResult,this.onSignResult,this)},n.prototype.isSign=function(){1!=this.btnSign.enabled&&(PlayerAttribute.Level<SongJin.OpenLevelForCrossServer?this.btnSign.enabled=!1:this.btnSign.enabled=!0)},n.prototype.initUiData=function(){SongJin.getDefaultTaskData();this.txtWarStatus=""},n.prototype.onSignResult=function(t){if(null!=t.data){var n=t.data.code;switch(n){case 0:UIManager.pop(this),e.HUD.instance.showBattle();break;case 3:this.txtWarStatus=lang.String("levelTooLow");break;case 2:this.txtWarStatus=lang.String("haveNoTimes");break;case 1:var i=FormatTimeByRelativeDate(t.data.nextStartTime,!1);if(t.data.countdownTime>=0&&t.data.countdownTime<=600){var a=Math.floor(t.data.countdownTime/60),r=t.data.countdownTime-60*a;this.txtWarStatus=lang.StringWithFormat("tipNextWarTimeCountdown",i,a,r)}else this.txtWarStatus=lang.StringWithFormat("tipNextWarTime",i);break;default:this.txtWarStatus=lang.String("enrollFailed")}}},n}(e.FitComponent);e.CrossServerSongJinWar=t,__reflect(t.prototype,"UI.CrossServerSongJinWar",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.remainingTime=new RemainingTime,e.killStreak=0,e.imgTip="",e.showTip=!1,e.skinName="SongJinNoteaSkin",e.touchEnabled=!1,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),null!=SongJin.data&&(e.showScorePannel=SongJin.hasScoreAward()),e}return __extends(n,t),n.prototype.onAddToStage=function(){SecondTicker.addEventListener(this.updateRestTime,this),Game.dispatcher.addEventListener(Game.EVENT.SongjinTaskData,this.onTaskDataChange,this),SecondTicker.addEventListener(this.onTimer,this)},n.prototype.onRemoveFromStage=function(){SecondTicker.removeEventListener(this.onTimer,this),SecondTicker.removeEventListener(this.updateRestTime,this),Game.dispatcher.removeEventListener(Game.EVENT.SongjinTaskData,this.onTaskDataChange,this)},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnLeave:e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],lang.String("operation confirm"),lang.String("songjin confirm leave"),function(){return net.socket.write(141,null),!0},null,null)}},Object.defineProperty(n.prototype,"restTime",{get:function(){return this.remainingTime.delta},set:function(e){this.remainingTime.delta=e,this.updateRestTime()},enumerable:!0,configurable:!0}),n.prototype.updateRestTime=function(){this.time=this.remainingTime.getMinuteSecond()},n.prototype.onTaskDataChange=function(){null!=SongJin.data&&(this.showScorePannel=SongJin.hasScoreAward())},n.prototype.onTimer=function(){var e=this.remainingTime;if(0==this.remainingTime.minute){var t=e.second;t>=1&&3>=t&&(this.imgTip="ui/guild/arenaNum"+t+".png",this.showTip=!0,this.tipGroup.play(1))}},n}(e.FitComponent);e.SongJinNote=t,__reflect(t.prototype,"UI.SongJinNote",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.awarddata=[],e.skinName="SongJinResultSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=e.SongJinResultItem,this.list.dataProvider=new eui.ArrayCollection(this.data),this.awardlist.itemRenderer=e.AwardCell,this.awardlist.dataProvider=new eui.ArrayCollection(this.awarddata),1==this.winner?this.currentState="win":this.currentState="lose";for(var i=0;i<this.data.length;i++){var a=this.data[i].name;if(a==Player.instance.Name){this.myRank=i+1,this.myName=this.data[i].name,this.myScroe=this.data[i].score,this.myKill=this.data[i].kill,this.myKillStreak=this.data[i].maxKillStreak,this.data[i].camp==SongJin.CampSong?(this.myCamp=StringWithFormat(n.myCampName,"Tống"),this.otherCamp=StringWithFormat(n.otherCampName,"Kim "),this.myCampScroe=SongJin.note.scoreSong,this.otherCampScroe=SongJin.note.scoreJin):(this.myCamp=StringWithFormat(n.myCampName,"Kim "),this.otherCamp=StringWithFormat(n.otherCampName,"Tống"),this.myCampScroe=SongJin.note.scoreJin,this.otherCampScroe=SongJin.note.scoreSong);break}}switch(this.myRank){case 1:this.rankBg.source="ui/ranking/first_icon.png";break;case 2:this.rankBg.source="ui/ranking/second_icon.png";break;case 3:this.rankBg.source="ui/ranking/third_icon.png";break;default:this.rankBg.source="ui/ranking/0.png"}},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},n.prototype.close=function(){UIManager.pop(this)},n.myCampName="{1}-Điểm Ta",n.otherCampName="{1}-Điểm Địch",n}(e.FitComponent);e.SongJinResult=t,__reflect(t.prototype,"UI.SongJinResult",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.dataChanged=function(){switch(this.data.camp){case SongJin.CampSong:this.currentState="win";break;case SongJin.CampJin:this.currentState="lose"}switch(null!=table.faction[this.data.faction]&&(this.icon=table.faction[this.data.faction].logo),this.rank=null,this.data.rank){case 1:this.rankIcon="ui/ranking/first_icon.png";break;case 2:this.rankIcon="ui/ranking/second_icon.png";break;case 3:this.rankIcon="ui/ranking/third_icon.png";break;default:this.rankIcon="ui/ranking/0.png",this.rank=this.data.rank}},t}(eui.ItemRenderer);e.SongJinResultItem=t,__reflect(t.prototype,"UI.SongJinResultItem")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.remainingTime=new RemainingTime,e.skinName="SongJinTimeSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.onAddToStage=function(){SecondTicker.addEventListener(this.updateRestTime,this)},n.prototype.onRemoveFromStage=function(){SecondTicker.removeEventListener(this.updateRestTime,this)},Object.defineProperty(n.prototype,"restTime",{set:function(e){this.remainingTime.delta=e},enumerable:!0,configurable:!0}),n.prototype.updateRestTime=function(){this.time=this.remainingTime.getMinuteSecond()},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnRules:var n=new e.Rule;n.skinName="SongJinRuleSkin",n.currentState="default",UIManager.pushPage(n);break;case this.btnExit:this.onExit()}},n.prototype.onExit=function(){if(!SongJin.isCrossServer())return void net.socket.write(141,null);var t=lang.String("operation confirm"),n=lang.StringWithFormat("songjinx confirm leave");e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],t,n,function(){return net.socket.write(141,null),!0},null,null)},n}(e.FitComponent);e.SongJinTime=t,__reflect(t.prototype,"UI.SongJinTime",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.data=[{type:"item",content:{genre:1,detailType:201}},{type:"clientitem",icon:"icon/client_item/partner.png",name:"Mảnh Môn Khách",quality:5,desc:"Có cơ hội nhận Mảnh Môn Khách các phẩm chất",count:"",plugin:"ui/public/pieces_icon.png"},{type:"clientitem",icon:"icon/item/gold.png",name:"KNB Khóa",quality:3,desc:"Nhận nhiều KNB Khóa",count:""},{type:"clientitem",icon:"icon/client_item/gem.png",name:"Bảo Thạch Lv1",quality:2,desc:"Có cơ hội nhận Bảo Thạch Lv1-Ngẫu Nhiên",count:""},{type:"clientitem",icon:"icon/client_item/exp.png",name:"Nhiều EXP",quality:2,desc:"Được nhận thưởng EXP",count:""}],n.skinName="SongJinWarSkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.list.itemRenderer=e.AwardCell,n}return __extends(n,t),n.prototype.onTouchTap=function(t){switch(t.target){case this.btnSign:this.onSign();break;case this.imgClose:this.close();break;case this.btnRules:var n=new e.Rule;n.skinName="SongJinRuleSkin",n.currentState="default",UIManager.pushPage(n)}},n.prototype.close=function(){UIManager.pop(this)},n.prototype.onSign=function(){SongJin.enrollScene!=World.scene&&SongJin.enrollScene2!=World.scene&&SongJin.combatScene!=World.scene&&SongJin.enrollSceneExp!=World.scene&&net.socket.write(118,null)},n.prototype.onAddToStage=function(){this.list.dataProvider=new eui.ArrayCollection(this.data),this.isSign(),Game.dispatcher.addEventListener(Game.EVENT.LevelUp,this.isSign,this),Game.dispatcher.addEventListener(Game.EVENT.SongjinEnrollResult,this.onSignResult,this),this.initUiData(),guide.addEventListener(guide.GuideOperation.GuideSongJin,this.onGuideReminder,this),guide.completed()||this.playGuideMovie(guide.info.operation)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.LevelUp,this.isSign,this),Game.dispatcher.removeEventListener(Game.EVENT.SongjinEnrollResult,this.onSignResult,this),guide.removeEventListener(guide.GuideOperation.GuideSongJin,this.onGuideReminder,this)},n.prototype.isSign=function(){1!=this.btnSign.enabled&&(PlayerAttribute.Level<SongJin.OpenLevel?this.btnSign.enabled=!1:this.btnSign.enabled=!0)},n.prototype.initUiData=function(){SongJin.getDefaultTaskData();this.txtWarStatus=""},n.prototype.onSignResult=function(t){if(null!=t.data){var n=t.data.code;switch(n){case 0:UIManager.pop(this),e.HUD.instance.showBattle();break;case 3:this.txtWarStatus=lang.String("levelTooLow");break;case 2:this.txtWarStatus=lang.String("haveNoTimes");break;case 1:var i=FormatTimeByRelativeDate(t.data.nextStartTime,!1);if(t.data.countdownTime>=0&&t.data.countdownTime<=600){var a=Math.floor(t.data.countdownTime/60),r=t.data.countdownTime-60*a;this.txtWarStatus=lang.StringWithFormat("tipNextWarTimeCountdown",i,a,r)}else this.txtWarStatus=lang.StringWithFormat("tipNextWarTime",i);break;default:this.txtWarStatus=lang.String("enrollFailed")}}},n.prototype.onGuideReminder=function(){var e=this;this.visible&&guide.pushMovie({weight:1,handle:function(){e.playGuideMovie(guide.info.operation)}})},n.prototype.playGuideMovie=function(e){switch(e){case guide.GuideOperation.GuideSongJin:guide.AddMovieClip(this.btnSign);break;default:return}},n}(e.FitComponent);e.SongJinWar=t,__reflect(t.prototype,"UI.SongJinWar",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;n.onDelayAddToStage=MakeDelayExecute(n.delayAddToStage,n,200),n.skinName="SwapAttributeUISkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.mc=[];for(var i=0;i<Game.EquipPart.EquipCount;i++){var a=new e.MovieClipComponent;a.removeWhenComplete=!1,a.position="TL",a.x=47+420*(i%2),a.y=173+92*~~(i/2),n.mc.push(a),a.visible=!1}n.targetButtons=[],n.alternateButtons=[],n.targetRadioButtonGroup=n.targetButton0.group,n.alternateRadioButtonGroup=n.alternateButton0.group,n.targetRadioButtonGroup.addEventListener(eui.UIEvent.CHANGE,n.onTouchLeftRadioGroup,n),n.alternateRadioButtonGroup.addEventListener(eui.UIEvent.CHANGE,n.onTouchRightRadioGroup,n),n.targetButtons=[n.targetButton0,n.targetButton1,n.targetButton2,n.targetButton3,n.targetButton4,n.targetButton5],n.alternateButtons=[n.alternateButton0,n.alternateButton1,n.alternateButton2,n.alternateButton3,n.alternateButton4,n.alternateButton5];for(var i=0;i<Game.EquipPart.EquipCount;i++)n.addChild(n.mc[i]);return n.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,n.onClickItem,n),n}return __extends(n,t),n.prototype.onAddToStage=function(){this.autoSelectEquip(),Game.dispatcher.addEventListener(Game.EVENT.EquipsChange,this.onRefreshTarge,this),Game.dispatcher.addEventListener(Game.EVENT.BagEquipChanged,this.onRefreshAlternate,this),Game.dispatcher.addEventListener(Game.EVENT.SwapAttributeSuccess,this.onSuccess,this),Game.dispatcher.addEventListener(Game.EVENT.CurrencyChange[Game.Currency.CopperCoin],this.onRefreshCoinCost,this),this.onDelayAddToStage()},n.prototype.delayAddToStage=function(){null!=this.scroller&&(this.scroller.viewport.scrollV=0),this.onRefreshTarge(),this.onSelectAlternateItem()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.EquipsChange,this.onRefreshTarge,this),Game.dispatcher.removeEventListener(Game.EVENT.BagEquipChanged,this.onRefreshAlternate,this),Game.dispatcher.removeEventListener(Game.EVENT.SwapAttributeSuccess,this.onSuccess,this),Game.dispatcher.removeEventListener(Game.EVENT.CurrencyChange[Game.Currency.CopperCoin],this.onRefreshCoinCost,this),this.selectedPart=null,this.onClearAlternate(),this.onDelayAddToStage.stop()
},n.prototype.onRefreshCoinCost=function(){if(this.coinCost.textColor=color.Title2,this.coinCost.text="0",null!=this.selectedPart&&null!=this.alternateItem&&null!=PlayerAttribute.Equips[this.selectedPart]){var e=PlayerAttribute.Equips[this.selectedPart],t=this.alternateItem.Item,n=t.Level-e.Level;if(!(0>=n)){var i=SwapAttribute.calcCost(n);this.coinCost.text=""+i,PlayerAttribute.currency[Game.Currency.CopperCoin]<i&&(this.coinCost.textColor=color.Warning)}}},n.prototype.onTouchTap=function(t){if(t.target instanceof e.EquipCell){this.selectedPart=t.target.data.part,badge.onLight(badge.SwapAttributeParts[this.selectedPart],!1);var n=PlayerAttribute.Equips[this.selectedPart];return null!=this.scroller&&(this.scroller.viewport.scrollV=0),this.onRefreshTarge(),this.alternateItem=null,this.onSelectAlternateItem(),void this.onRefreshCoinCost()}switch(t.target){case this.btnSwap:if(null==this.alternateItem)return void PopUpMessage.push(lang.String("swapattribute select no alternateequip"),color.RED);var i=this.alternateItem.Item;badge.onLight(badge.SwapAttributeParts[i.Part],!1);var a=parseInt(this.targetRadioButtonGroup.selectedValue),r=parseInt(this.alternateRadioButtonGroup.selectedValue);if(isNaN(a))return void PopUpMessage.push(lang.String("swapattribute select no attribute"),color.RED);if(isNaN(r))return void PopUpMessage.push(lang.String("swapattribute select no attribute"),color.RED);var n=PlayerAttribute.Equips[this.selectedPart],o=i.Level-n.Level;if(o>0){var s=SwapAttribute.calcCost(o);if(PlayerAttribute.currency[Game.Currency.CopperCoin]<s)return e.ResourceObtain.Open([e.ObtResId.CopperCoin]),void PopUpMessage.push(lang.String("not enough copperCoin"),color.Warning)}SwapAttribute.swapEquipAttribute(this.alternateItem.Id,a,r);break;case this.btnGainEquip:e.ResourceObtain.Open([e.ObtResId.equip])}},n.prototype.autoSelectEquip=function(){if(null==this.selectedPart){for(var e=[],t=0;t<Game.EquipPart.EquipCount;t++)null!=PlayerAttribute.Equips[t]&&PlayerAttribute.Equips[t].Level>=SwapAttribute.MinLevel&&e.push({level:PlayerAttribute.Equips[t].Level,part:t});e.length<=0?this.selectedPart=Game.EquipPart.EquipWeapon:(e.sort(n.compare),this.selectedPart=e[0].part)}},n.compare=function(e,t){return e.level==t.level?e.part-t.part:t.level-e.level},n.prototype.onRefreshTarge=function(){var e=this.selectedPart,t=PlayerAttribute.Equips[e];if(null!=t){this.targetEquip.icon=t.Icon,this.targetEquip.quality=t.Quality,this.targetFPDesc=lang.StringWithFormat("fp:{1}",t.FightingPower),this.targetLevel=lang.StringWithFormat("{1}level",t.Level);var n=t.Level>=SwapAttribute.MinLevel,i=t.LightAttributes;n?this.tips=null:this.tips=lang.String("swapattribute need equip 30 level");for(var a=0;a<this.targetButtons.length;a++){var r=this.targetButtons[a];r.enabled=n,r.selected=!1,a<i.length?(r.context.text=Buff.GetDesc(i[a].id,i[a].values),r.arrow.text=""):(r.context.text=lang.String("None"),r.arrow.text="",a>i.length&&(r.enabled=!1))}this.targetRadioButtonGroup.selectedValue=null}else for(var a=0;a<this.targetButtons.length;a++){var r=this.targetButtons[a];r.enabled=!1,r.selected=!1,r.context.text=lang.String("None"),r.arrow.text=""}},n.prototype.onClearAlternate=function(){for(var e=0;e<this.alternateButtons.length;e++){var t=this.alternateButtons[e];t.enabled=!1,t.context.text=lang.String("None"),t.arrow.text=""}this.alternateEquip.icon=null,this.alternateEquip.quality=null,this.alternateFPDesc=null,this.alternateItem=null;var n=this.list.dataProvider;null!=n&&n.removeAll(),this.alternateLevel=null},n.prototype.onSelectAlternateItem=function(){this.onAutoSelectAlternate(),null!=this.alternateItem&&this.onSetAlternateAttribute(this.alternateItem.Item),this.onRefreshCoinCost()},n.prototype.onAutoSelectAlternate=function(){var e=this.selectedPart,t=PlayerAttribute.Equips[e];if(null==t)return void this.onClearAlternate();if(t.Level<SwapAttribute.MinLevel)return this.tips=lang.String("swapattribute need equip 30 level"),void this.onClearAlternate();var n=PlayerAttribute.bag.equips[e],i=[];for(var a in n){var r=PlayerAttribute.bag.GetBagItem(Number(a)),o=r.Item;1==this.checkEquipLimit(o,t)&&i.push(r)}if(0==i.length)return this.tips=lang.String("swapattribute no alternateequip"),void this.onClearAlternate();if(i.sort(PlayerAttribute.bag.sortEquipByFinghtingPower),null==this.list.dataProvider)this.list.dataProvider=new eui.ArrayCollection(i);else{var s=this.list.dataProvider;s.replaceAll(i)}var l=!0;if(null!=this.alternateItem)for(var u=0;u<i.length;u++)if(i[u].Id==this.alternateItem.Id){(null==this.list.selectedItem||this.list.selectedIndex!=u)&&(this.list.selectedIndex=u,this.tips=null),l=!1;break}l&&(this.list.selectedIndex=0,this.tips=null,this.alternateItem=this.list.selectedItem)},n.prototype.checkEquipLimit=function(e,t){return e.Level<SwapAttribute.MinLevel?!1:e.Quality>t.Quality&&e.Level>=t.Level?!1:e.Quality==t.Quality&&e.Level>t.Level?!1:!0},n.prototype.onClickItem=function(e){this.targetRadioButtonGroup.selectedValue=null,this.alternateItem=this.list.selectedItem,this.onSelectAlternateItem()},n.prototype.onRefreshAlternate=function(e){var t=e.data;if(this.alternateItem.Id==t.Id){if(this.alternateItem=t,this.onSetAlternateAttribute(t.Item),null!=this.list.selectedItem){var n=this.list.dataProvider;n.replaceItemAt(this.alternateItem,this.list.selectedIndex)}}else this.onAutoSelectAlternate()},n.prototype.cmpAttrFightPwer=function(e,t){var n=this.selectedPart,i=PlayerAttribute.Equips[n];if(null!=i){for(var a=Buff.GetFightingPower(e,t),r=0;r<i.LightAttributes.length;r++)if(i.LightAttributes[r].id==e)return a-Buff.GetFightingPower(i.LightAttributes[r].id,i.LightAttributes[r].values);return 0}},n.prototype.onSetAlternateAttribute=function(e){this.alternateEquip.icon=e.Icon,this.alternateEquip.quality=e.Quality,this.alternateFPDesc=lang.StringWithFormat("fp:{1}",e.FightingPower),this.alternateLevel=lang.StringWithFormat("{1}level",e.Level);var t=e.LightAttributes,n=!1;e.Quality>=1&&e.Quality<=5&&(n=!0);for(var i=0;i<this.alternateButtons.length;i++){var a=this.alternateButtons[i];if(a.enabled=n,a.selected=!1,i<t.length){a.context.text=Buff.GetDesc(t[i].id,t[i].values);var r=this.cmpAttrFightPwer(t[i].id,t[i].values);r>0?a.arrow.textFlow=Game.TextParser.parse("<font color='0x00FF00'>↑</font>"):0>r?a.arrow.textFlow=Game.TextParser.parse("<font color='0xFF0000'>↓</font>"):a.arrow.text=""}else a.context.text=lang.String("None"),a.arrow.text="",a.enabled=!1}this.alternateRadioButtonGroup.selectedValue=null},n.prototype.onTouchLeftRadioGroup=function(){var e=parseInt(this.targetRadioButtonGroup.selectedValue);if(!isNaN(e)){var t=parseInt(this.alternateRadioButtonGroup.selectedValue);if(null!=this.alternateItem){var n=this.alternateItem.Item,i=this.selectedPart,a=PlayerAttribute.Equips[i];if(null!=a)if(e>=a.LightAttributes.length){if(!isNaN(t))for(var r=0;r<a.LightAttributes.length;r++)if(n.LightAttributes[t].id==a.LightAttributes[r].id){this.alternateRadioButtonGroup.selectedValue=null;var o=this.alternateButtons[t];return void(o.enabled=!1)}for(var r=0;r<a.LightAttributes.length;r++)for(var s=0;s<n.LightAttributes.length;s++)if(n.LightAttributes[s].id==a.LightAttributes[r].id){var o=this.alternateButtons[s];return void(o.enabled=!1)}}else{for(var r=0;r<n.LightAttributes.length;r++)if(a.LightAttributes[e].id==n.LightAttributes[r].id){var o=this.alternateButtons[r];return o.enabled=!0,void(o.selected=!0)}if(!isNaN(t))for(var r=0;r<a.LightAttributes.length;r++)if(n.LightAttributes[t].id==a.LightAttributes[r].id&&r!=e){this.alternateRadioButtonGroup.selectedValue=null;var o=this.alternateButtons[t];return void(o.enabled=!1)}}}}},n.prototype.onTouchRightRadioGroup=function(){var e=parseInt(this.alternateRadioButtonGroup.selectedValue);if(!isNaN(e)){var t=this.selectedPart,n=PlayerAttribute.Equips[t];if(null!=n&&null!=this.alternateItem){for(var i=this.alternateItem.Item,a=0;a<n.LightAttributes.length;a++)if(i.LightAttributes[e].id==n.LightAttributes[a].id){var r=this.targetButtons[a];return void(r.selected=!0)}var o=parseInt(this.targetRadioButtonGroup.selectedValue);if(isNaN(o)){var s=n.LightAttributes.length;if(6>s){var r=this.targetButtons[s];return void(r.selected=!0)}}}}},n.prototype.onSuccess=function(){var e=this.mc[this.selectedPart];e.Load("skill/Ui_qianghua01/Ui_qianghua01.json","Ui_qianghua01"),e.gotoAndPlay(0,1),e.visible=!0,null!=this.alternateItem&&this.onSetAlternateAttribute(this.alternateItem.Item)},n}(eui.Component);e.SwapAttributeUI=t,__reflect(t.prototype,"UI.SwapAttributeUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="TaohuaIncomeSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.checkDog.addEventListener(eui.UIEvent.CHANGE,e.onSelectBox,e),e.checkDouble.addEventListener(eui.UIEvent.CHANGE,e.onSelectBox,e),e.checkFree.addEventListener(eui.UIEvent.CHANGE,e.onSelectBox,e),e.checkThrice.addEventListener(eui.UIEvent.CHANGE,e.onSelectBox,e),e}return __extends(n,t),n.prototype.onRemoveFromStage=function(){this.checkFree.selected=!1,this.checkDog.selected=!1,this.checkDouble.selected=!1,this.checkThrice.selected=!1},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnJoin:var n=0,i=0,a=0,r=!1;if(this.checkDog.selected&&(n+=TaohuaIsland.COST[3],r=!0),this.checkFree.selected){if(TaohuaIsland.freeTimes>=1)return void PopUpMessage.push(lang.StringWithFormat("daily use item {1} times full","Miễn phí x2"),color.RED);a=1}else this.checkDouble.selected?(i+=TaohuaIsland.COST[1],a=2):this.checkThrice.selected&&(n+=TaohuaIsland.COST[2],a=3);if(PlayerAttribute.currency[Game.Currency.SilverCoin]<i)return void UIManager.push(new e.SilverPromptByCost(i,function(){return PlayerAttribute.currency[Game.Currency.GoldCoin]+PlayerAttribute.currency[Game.Currency.SilverCoin]<i?(PopUpMessage.push(lang.String("not enough goldcoin"),color.RED),UIManager.popNoTweens(this),void UIManager.push(new e.GoldCoinPrompt)):(UIManager.popNoTweens(this),void e.TaohuaMain.instance.JoinPlant(a,r))}));if(PlayerAttribute.currency[Game.Currency.GoldCoin]<n)return UIManager.push(new e.GoldCoinPrompt),void PopUpMessage.push(lang.String("not enough goldcoin"),color.RED);TaohuaIsland.joinPlant(a,r),this.close()}},n.prototype.onSelectBox=function(e){if(0!=e.target.selected)switch(e.target){case this.checkFree:this.checkDouble.selected=!1,this.checkThrice.selected=!1;break;case this.checkDouble:this.checkFree.selected=!1,this.checkThrice.selected=!1;break;case this.checkThrice:this.checkFree.selected=!1,this.checkDouble.selected=!1}},n.prototype.setFreeCheckStatus=function(){TaohuaIsland.freeTimes>0?this.checkFree.enabled=!1:this.checkFree.selected=!0},n.prototype.close=function(){e.TaohuaMain.instance.closeMineIncome()},n}(e.FitComponent);e.TaohuaIncome=t,__reflect(t.prototype,"UI.TaohuaIncome",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.awarddatas=[],e.skinName="TaohuaIslandResultSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.onAddToStage=function(){this.awarddatas.length>0&&(this.list.dataProvider=new eui.ArrayCollection(this.awarddatas),this.list.itemRenderer=e.AwardCell)},n.prototype.onRemoveFromStage=function(){this.awarddatas=[]},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:UIManager.pop(this)}},n.prototype.close=function(){UIManager.pop(this),TaohuaIsland.onOpenTaohuaIsland()},n}(e.FitComponent);e.TaohuaIslandResult=t,__reflect(t.prototype,"UI.TaohuaIslandResult",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="TaohuaMainSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.JoinPlant=function(e,t){TaohuaIsland.joinPlant(e,t),this.closeMineIncome()},n.prototype.closeMineIncome=function(){this.incomePanel.visible=!1},n.prototype.onTouchTap=function(t){switch(t.target){case this.imgClose:this.close();break;case this.btnHarvest:TaohuaIsland.onHarvest();break;case this.myMine:1==this.incomePanel.visible?this.closeMineIncome():0==TaohuaIsland.planting&&(this.incomePanel.visible=!0,guide.completed()||guide.info.operation!=guide.GuideOperation.GuideTaohuaIslandPlant||guide.AddMovieClip(this.incomePanel.btnJoin));break;case this.btnRules:var n=new e.Rule;n.skinName="TaohuaIslandRulesSkin",UIManager.push(n)}},n.prototype.close=function(){UIManager.pop(this)},n.prototype.onAddToStage=function(){SecondTicker.addEventListener(this.onEnterFrame,this),Game.dispatcher.addEventListener(Game.EVENT.TaohuaIslandStatus,this.onStatus,this),net.socket.write(67,null),this.chance=TaohuaIsland.plantChances,this.robChances=TaohuaIsland.robFreeChances,guide.addEventListener(guide.GuideOperation.GuideTaohuaIslandPlant,this.onGuideReminder,this),Game.dispatcher.addEventListener(Game.EVENT.GuideCompleted,this.onGuideCompleted,this)},n.prototype.onRemoveFromStage=function(){SecondTicker.removeEventListener(this.onEnterFrame,this),Game.dispatcher.removeEventListener(Game.EVENT.TaohuaIslandStatus,this.onStatus,this),this.harvestCount=null,this.nextTime=null,this.showTime=null,this.lastTime.visible=!1,this.freeTimes=0,this.myMine.data={id:null,name:"",faction:0,fp:0};for(var e=0;5>e;e++){var t=this.othersMine.getChildAt(e);t.data={id:0,name:lang.String("My Mine"),faction:0,fp:0},t.visible=!1}this.closeMineIncome(),guide.removeEventListener(guide.GuideOperation.GuideTaohuaIslandPlant,this.onGuideReminder,this),Game.dispatcher.removeEventListener(Game.EVENT.GuideCompleted,this.onGuideCompleted,this),guide.completed()&&guide.notify()},n.prototype.onStatus=function(){TaohuaIsland.planting?(this.incomePanel.btnJoin.enabled=!1,TaohuaIsland.harvestCount>0?this.btnHarvest.visible=!0:this.btnHarvest.visible=!1,this.myMine.data={id:null,name:lang.String("My Mine"),faction:PlayerAttribute.faction,fp:PlayerAttribute.fp}):(this.incomePanel.btnJoin.enabled=!0,this.btnHarvest.visible=!1,this.myMine.data={id:null,name:lang.String("My Mine"),faction:0,fp:0})},n.prototype.onEnterFrame=function(){TaohuaIsland.planting?(0==this.lastTime.visible&&(this.lastTime.visible=!0),null!=this.nextTime&&this.nextTime<Game.getServerDate().getTime()&&(TaohuaIsland.getStatus(),this.nextTime=null),this.showTime=TaohuaIsland.leftRemain.getHourMinuteSecond()):(this.showTime=null,this.lastTime.visible=!1)},n.prototype.setBattleStatus=function(){this.harvestCount=TaohuaIsland.harvestCount,this.freeTimes=TaohuaIsland.freeTimes,this.incomePanel.setFreeCheckStatus(),this.chance=TaohuaIsland.plantChances,this.robChances=TaohuaIsland.robFreeChances,TaohuaIsland.harvestTime>0&&(this.nextTime=Game.getServerDate().getTime()+TaohuaIsland.harvestTime*Game.Second)},n.prototype.setListRob=function(e){for(var t=0;5>t;t++){var n=this.othersMine.getChildAt(t);n.visible=!1}var i=5;e.length<5&&(i=e.length);for(var t=0;i>t;t++){var n=this.othersMine.getChildAt(t);n.visible=!0,n.data={id:e[t].id,name:e[t].name,faction:e[t].faction,fp:e[t].fp}}},n.prototype.onGuideReminder=function(){var e=this;this.incomePanel.visible&&guide.pushMovie({weight:3,handle:function(){guide.AddMovieClip(e.incomePanel.btnJoin)}})},n.prototype.onGuideCompleted=function(){var e=this;guide.pushMovie({weight:2,handle:function(){guide.AddMovieClip(e.panel.btnBack)}})},n}(e.FitComponent);e.TaohuaMain=t,__reflect(t.prototype,"UI.TaohuaMain",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.bgImg=!1,t.skinName="TaohuaPortraitSkin",t.guide="none",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.head.addEventListener(egret.Event.COMPLETE,t.onTweenGroupComplete,t),t.head.play(0),t}return __extends(t,e),t.prototype.onAddToStage=function(){switch(this.guide){case"planting":guide.addEventListener(guide.GuideOperation.GuideTaohuaIslandPlant,this.onGuideReminder,this);break;case"rob":guide.addEventListener(guide.GuideOperation.GuideTaohuaIslandRob,this.onGuideReminder,this)}guide.completed()||this.playGuideMovie(guide.info.operation)},t.prototype.onRemoveFromStage=function(){switch(this.guide){case"planting":guide.removeEventListener(guide.GuideOperation.GuideTaohuaIslandPlant,this.onGuideReminder,this);break;case"rob":guide.removeEventListener(guide.GuideOperation.GuideTaohuaIslandRob,this.onGuideReminder,this)}},t.prototype.dataChanged=function(){return this.data.faction<=0?void(this.img=""):(this.img=table.faction[this.data.faction].portrait,void(this.data.fp>PlayerAttribute.fp?this.bgImg=!0:this.bgImg=!1))},t.prototype.onTouchTap=function(){if(null!=this.data.id&&"others"==this.currentState){var e=new net.def.C2STaohuaIslandRob;e.setIndex(this.data.id),e.setName(this.data.name),net.socket.write(68,e.toArrayBuffer())}},t.prototype.onTweenGroupComplete=function(){this.head.play(0)},t.prototype.onGuideReminder=function(){var e=this;guide.pushMovie({weight:2,handle:function(){e.playGuideMovie(guide.info.operation)}})},t.prototype.playGuideMovie=function(e){e==guide.GuideOperation.GuideTaohuaIslandPlant&&"planting"==this.guide?guide.AddMovieClip(this.portrait):e==guide.GuideOperation.GuideTaohuaIslandRob&&"rob"==this.guide&&guide.AddMovieClip(this.btnRob)},t}(eui.ItemRenderer);e.TaohuaPortrait=t,__reflect(t.prototype,"UI.TaohuaPortrait")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="MemberListSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.dataChanged=function(){return null==this.data||null==this.data.name||""==this.data.name?void(this.currentState="empty"):(this.currentState="member",this.txtFaction=table.faction[this.data.faction].name,this.data.online?this.portrait=table.faction[this.data.faction].portrait:this.portrait=table.faction[this.data.faction].offlinePortrait,void(this.data.inviteState?this.btnInvite.label=lang.String("dungeon invite btn msg wait"):this.btnInvite.label=lang.String("dungeon invite btn msg invite")))},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnInvite:this.onInvite()}},t.prototype.onInvite=function(){if(null!=this.data){var e=this.data.name;DungeonHallMgr.InviteRoom(e),DungeonHallMgr.CloseDungeonInvite()}},t}(eui.ItemRenderer);e.MemberList=t,__reflect(t.prototype,"UI.MemberList")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="TeamMenuSkin",n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.list.itemRenderer=e.TeamMenuButton,n.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,n.onItemTap,n),n}return __extends(n,t),n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.onAddToStage=function(){this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onFocusOut,this)},n.prototype.onRemoveFromStage=function(){this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onFocusOut,this)},n.prototype.onFocusOut=function(t){(null==t.target.parent||t.target.parent.parent!=this.list)&&(UIManager.pop(this),e.teamMenu=null,t.stopImmediatePropagation())},n.prototype.onItemTap=function(){switch(this.list.selectedItem.action){case"chat":Player.instance.Name!=this.playerName&&ChatSys.createNewPrivateChannel(this.playerName,this.playerFaction);break;case"addFriend":Player.instance.Name!=this.playerName&&friend.sendRequest(this.playerName);break;case"leaveTeam":DungeonHallMgr.IsInRoom()&&e.closeDungeonHall(),WulinLiansai.IsInRoom()&&WulinLiansai.ClosePanel()}UIManager.pop(this),e.teamMenu=null},n}(eui.Component);e.TeamMenu=t,__reflect(t.prototype,"UI.TeamMenu",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="TeamMenuButtonSkin",e}return __extends(n,t),n.prototype.dataChanged=function(){this.menuButton.label=this.data.label,"addFriend"==this.data.action&&(this.menuButton.enabled=!friend.checkByName(e.teamMenu.playerName))},n}(eui.ItemRenderer);e.TeamMenuButton=t,__reflect(t.prototype,"UI.TeamMenuButton")}(UI||(UI={}));var UI;!function(UI){var TitleBreakThrough=function(_super){function TitleBreakThrough(){var e=_super.call(this)||this;return e.skinName="TitleBreakThroughSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.levelUpEffect=new UI.MovieClipComponent,e.levelUpEffect.horizontalCenter=0,e.levelUpEffect.verticalCenter=-150,e.levelUpEffect.visible=!1,e.levelUpEffect.removeWhenComplete=!1,e.onDataChange=MakeDelayExecute(e.onRefreshCost,e,100),e}return __extends(TitleBreakThrough,_super),Object.defineProperty(TitleBreakThrough,"instance",{get:function(){return null==this._instance&&(this._instance=new TitleBreakThrough),this._instance},enumerable:!0,configurable:!0}),TitleBreakThrough.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.FactionTitleLevelUp,this.onLevelUp,this),Game.dispatcher.addEventListener(Game.EVENT.AddItem,this.onItemChange,this,!1,1),Game.dispatcher.addEventListener(Game.EVENT.RemoveItem,this.onItemChange,this,!1,1),Game.dispatcher.addEventListener(Game.EVENT.UpdateItem,this.onItemChange,this,!1,1),Game.dispatcher.addEventListener(Game.EVENT.CurrencyChange[Game.Currency.CopperCoin],this.onDataChange,this,!1,1),this.update(),this.onDataChange(),this.addChild(this.levelUpEffect),guide.addEventListener(guide.GuideOperation.LevelUpFactionTitle,this.onGuideReminder,this),guide.completed()||this.playGuideMovie(guide.info.operation)},TitleBreakThrough.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.FactionTitleLevelUp,this.onLevelUp,this),Game.dispatcher.removeEventListener(Game.EVENT.AddItem,this.onItemChange,this),Game.dispatcher.removeEventListener(Game.EVENT.RemoveItem,this.onItemChange,this),Game.dispatcher.removeEventListener(Game.EVENT.UpdateItem,this.onItemChange,this),Game.dispatcher.removeEventListener(Game.EVENT.CurrencyChange[Game.Currency.CopperCoin],this.onDataChange,this),this.titleEffect.free(),null!=this.levelUpEffect&&(this.levelUpEffect.visible=!1,this.levelUpEffect.stop(),this.levelUpEffect.free()),guide.removeEventListener(guide.GuideOperation.LevelUpFactionTitle,this.onGuideReminder,this),this.onDataChange.stop()},TitleBreakThrough.prototype.update=function(){this.btnGainRes.visible=!1,this.curLevel=FactionTitle.level,this.level=FactionTitle.getLevel(),this.FightingPower=FactionTitle.getCurFP(),this.nextFightingPower=FactionTitle.getFP(),this.btnLevelUp.enabled=this.level<FactionTitle.MaxLevel;var isActivate=FactionTitle.isNeedActivate();isActivate?this.btnLevelUp.label=lang.String("activate"):this.btnLevelUp.label=lang.String("level up"),this.level>=FactionTitle.MaxLevel&&(this.cost=null);var attrs=FactionTitle.getAttributes();if(attrs.length>0)for(var i=0;i<attrs.length;i++){var parts=attrs[i].split(": ");1==parts.length&&(parts=attrs[i].split(":")),eval("this.lblAttr"+(i+1)+".text = parts[0]"),eval("this.attrValue"+(i+1)+" = parts[1]")}else for(var i=0;4>i;i++)eval("this.lblAttr"+(i+1)+'.text = ""'),eval("this.attrValue"+(i+1)+' = ""');if(attrs=FactionTitle.getNextAttributes(),attrs.length>0)for(var i=0;i<attrs.length;i++){var parts=attrs[i].split(": ");1==parts.length&&(parts=attrs[i].split(":")),eval("this.lblNextAttr"+(i+1)+".text = parts[0]"),eval("this.nextAttrValue"+(i+1)+" = parts[1]")}else for(var i=0;4>i;i++)eval("this.lblAttr"+(i+1)+'.text = ""'),eval("this.attrValue"+(i+1)+' = ""');var id=0==FactionTitle.id?1:FactionTitle.id,resource=FactionTitle.getResource(id);null!=resource&&(this.titleEffect.Load("title/"+resource+"/"+resource+".json",resource),this.titleEffect.play(-1));var nextId=0==FactionTitle.id?1:FactionTitle.id+1,nextCond=FactionTitle.getDesc(nextId);nextCond=null==nextCond?"":lang.StringWithFormat("faction title next title cond{1}",nextCond),this.nextTitleCond.textFlow=Game.TextParser.parse(nextCond)},TitleBreakThrough.prototype.onItemChange=function(e){if(null!=e){var t=e.data;if(2!=t.Item.Type)return}this.onDataChange()},TitleBreakThrough.prototype.onRefreshCost=function(){return this.level>=FactionTitle.MaxLevel?void(this.cost=null):(null==this.cost?this.cost=new eui.ArrayCollection(FactionTitle.getCostDesc()):this.cost.replaceAll(FactionTitle.getCostDesc()),void this.update())},TitleBreakThrough.prototype.onLevelUp=function(){this.playEffect(),this.onRefreshCost()},TitleBreakThrough.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close();break;case this.btnLevelUp:FactionTitle.LevelUp();break;case this.btnGainRes:}},TitleBreakThrough.prototype.close=function(){UIManager.pop(this)},TitleBreakThrough.prototype.playEffect=function(){this.levelUpEffect.visible=!0,this.levelUpEffect.Load("skill/Ui_petup/Ui_petup.json","Ui_petup"),this.levelUpEffect.gotoAndPlay(0,1)},TitleBreakThrough.prototype.onGuideReminder=function(){var e=this;this.visible&&guide.pushMovie({weight:2,handle:function(){e.playGuideMovie(guide.GuideOperation.LevelUpFactionTitle)}})},TitleBreakThrough.prototype.playGuideMovie=function(e){e==guide.GuideOperation.LevelUpFactionTitle&&guide.AddMovieClip(this.btnLevelUp)},TitleBreakThrough}(UI.FitComponent);UI.TitleBreakThrough=TitleBreakThrough,__reflect(TitleBreakThrough.prototype,"UI.TitleBreakThrough",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.dataChanged=function(){this.invalidateState()},t.prototype.getCurrentState=function(){var e=this.data;if(null!=e)return e.count<e.require?"NotEnough":"Enough"},t}(eui.ItemRenderer);e.TitleCostItemRenderer=t,__reflect(t.prototype,"UI.TitleCostItemRenderer")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="TitleItemSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.mc.touchEnabled=!0},t.prototype.onRemoveFromStage=function(){this.mc.free()},t.prototype.dataChanged=function(){var e=this.data;if(null!=e){this.currentState=e.state;for(var t="",n=0;n<e.attributes.length;n++)0!=n&&(t+="\n"),t+=e.attributes[n];if(this.lblAttribute.textFlow=Game.HtmlTextParser.parse(t),null==e.expiryTime)this.expiryTimeGroup.visible=!1;else{this.expiryTimeGroup.visible=!0;var i=e.expiryTime;this.expiryTime=i.getFullYear()+"-"+NumberFormat(i.getMonth()+1,2)+"-"+NumberFormat(i.getDate(),2)+" "+NumberFormat(i.getHours(),2)+":"+NumberFormat(i.getMinutes(),2)}var a=e.resource;this.mc.Load("title/"+a+"/"+a+".json",a),this.txtFP="+"+this.data.FP}},t.prototype.onTouchTap=function(e){switch(e.target){case this.btn:var t=this.data.handle;null!=t&&t.apply(this.data)}},t.prototype.getCurrentState=function(){return null==this.data||null==this.data.state?"inactivated":this.data.state},t}(eui.ItemRenderer);e.TitleItem=t,__reflect(t.prototype,"UI.TitleItem")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="TitleSimpleItemSkin",t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.prototype.onRemoveFromStage=function(){this.mc.free()},t.prototype.dataChanged=function(){var e=this.data;if(null!=e){var t=e.resource;this.mc.Load("title/"+t+"/"+t+".json",t)}},t}(eui.ItemRenderer);e.TitleSimpleItem=t,__reflect(t.prototype,"UI.TitleSimpleItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="TitleUISkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.comp=function(e,n){var i=t.state2weight[e.state],a=t.state2weight[n.state];return i==a?e.weight-n.weight:i-a},t.prototype.onAddToStage=function(){if(null==this.titles2){this.titles2=[];for(var e in CommonTitle.titles)this.titles2.push(CommonTitle.titles[e]);this.title2dataProvider=new eui.ArrayCollection(this.titles2)}else this.title2dataProvider.refresh();this.titles2.sort(t.comp),this.list.dataProvider=this.title2dataProvider,this.titleFp=CommonTitle.getFP(),Game.dispatcher.addEventListener(Game.EVENT.CommonTitleChange,this.onCommonTitleChange,this)},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.CommonTitleChange,this.onCommonTitleChange,this)},t.prototype.onCommonTitleChange=function(){this.titles2.sort(t.comp),this.title2dataProvider.refresh(),this.titleFp=CommonTitle.getFP()},t.state2weight={maxlevel:0,levelup:0,using:1,activated:2,inactivated:3},t}(eui.Component);e.TitleUI=t,__reflect(t.prototype,"UI.TitleUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="TBCellTipsSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.onTouchTap=function(e){switch(e.target){case this.BtnChoose:this.onBtnChoose()}this.close()},t.prototype.close=function(){UIManager.pop(this)},t.prototype.onBtnChoose=function(){"add"==this.state?ActivityTreasureBowl.addItem(this.type,this.idx):ActivityTreasureBowl.delItem(this.idx)},t.prototype.onAddToStage=function(){this.itemTip.update(this.data,{desc:this.desc}),"add"==this.state?this.btnLabel="Vào":this.btnLabel="Xóa"},t.prototype.onRemoveFromStage=function(){this.data=null,this.desc=null},t}(e.FitComponent);e.TBCellTips=t,__reflect(t.prototype,"UI.TBCellTips",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="TBFlopAwardSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.CanAward=function(){return null==this.data?!0:!1},t.prototype.onAddToStage=function(){this.currentState="question",this.ain.addEventListener("itemComplete",this.onTweenGroupItemComplete,this)},t.prototype.onRemoveFromStage=function(){this.ain.stop(),this.ain.removeEventListener("itemComplete",this.onTweenGroupItemComplete,this)},t.prototype.OnRefresh=function(){this.touchChildren=!1,this.ain.play(0)},t.prototype.onTweenGroupItemComplete=function(e){var t=e.data;switch(t.target){case this.group:this.DataRefresh();break;case this.group0:this.touchChildren=!0}},t.prototype.CostRefresh=function(){var e=this.cost;this.costTip.textFlow=Game.TextParser.parse("<font color='"+color.GoldCoin+"'>"+e+"</font>")
},t.prototype.DataRefresh=function(){return null==this.data?(this.currentState="question",void(this.touchChildren=!0)):(this.currentState="award",this.cell.data=this.data,void(this.itemname.textFlow=Game.TextParser.parse(this.cell.AwardDesc)))},t}(eui.ItemRenderer);e.TBFlopAward=t,__reflect(t.prototype,"UI.TBFlopAward",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="TreasureBowlSkin",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.TypeList0.itemRenderer=e.AwardCell,n.TypeList1.itemRenderer=e.AwardCell,n.TypeList2.itemRenderer=e.AwardCell,n.ItemList.itemRenderer=e.AwardCell,n.ItemListShow.itemRenderer=e.AwardCell,n.TypeList0.addEventListener(eui.ItemTapEvent.ITEM_TAP,n.onTapList0,n),n.TypeList1.addEventListener(eui.ItemTapEvent.ITEM_TAP,n.onTapList1,n),n.TypeList2.addEventListener(eui.ItemTapEvent.ITEM_TAP,n.onTapList2,n),n.ItemList.addEventListener(eui.ItemTapEvent.ITEM_TAP,n.onDelItem,n),n}return __extends(n,t),n.prototype.close=function(){UIManager.pop(this)},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.ActivityTreasureBowl,this.onUpdate,this),Game.dispatcher.addEventListener(Game.EVENT.ActivityTreasureBowlAward,this.onUpdateAward,this),Game.dispatcher.addEventListener(Game.EVENT.ActivityTreasureBowlItem,this.onUpdateItemList,this),this.TypeList0.dataProvider=new eui.ArrayCollection(ActivityTreasureBowl.cfg.chooseItem[0].slice()),this.TypeList1.dataProvider=new eui.ArrayCollection(ActivityTreasureBowl.cfg.chooseItem[1].slice()),this.TypeList2.dataProvider=new eui.ArrayCollection(ActivityTreasureBowl.cfg.chooseItem[2].slice()),this.ItemList.dataProvider=new eui.ArrayCollection(ActivityTreasureBowl.ItemListData),this.onUpdate(),this.FlopCellGroup.touchChildren=!0},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.ActivityTreasureBowl,this.onUpdate,this),Game.dispatcher.removeEventListener(Game.EVENT.ActivityTreasureBowlAward,this.onUpdateAward,this),Game.dispatcher.removeEventListener(Game.EVENT.ActivityTreasureBowlItem,this.onUpdateItemList,this)},n.prototype.onUpdate=function(){if(null!=ActivityTreasureBowl._data&&null!=ActivityTreasureBowl.cfg){this.RoundNum.text=StringWithFormat("{1}/{2}",ActivityTreasureBowl._data.rounds,ActivityTreasureBowl.cfg.totalRounds);var e=ActivityTreasureBowl._data.endTime,t=StringWithFormat("{1}-{2}-{3}",~~(e/1e4),~~(e/100%100),~~(e%100));this.ActivityEnd.textFlow=Game.TextParser.parse("<font color='13868844'>Hoạt động kết thúc: </font><font color='"+color.WHITE+"'>"+t+"</font>"),ActivityTreasureBowl._data.drawTimes<0?(this.currentState="ChooseItem",this.onUpdateActivity(),this.onUpdateItemList()):(this.currentState="DrawCard",this.onUpdateItemShowList(),this.onUpdateFlopCell())}},n.prototype.onUpdateAward=function(){var e=ActivityTreasureBowl._data,t=(ActivityTreasureBowl.cfg,ActivityTreasureBowl._award);e.drawTimes++;var n=StringWithFormat("{1}/{2}",e.drawTimes,e.chooseItem.length);this.TipsForNum.textFlow=Game.TextParser.parse("<font color='13868844'>Rút Thưởng: </font><font color='"+color.WHITE+"'>"+n+"</font>");for(var i=0;i<this.FlopCellGroup.$children.length;i++){var a=this.FlopCellGroup.getChildAt(i);t.cardIdx==i?(a.data=ActivityTreasureBowl.cfg.chooseItem[t.type][t.idx],a.OnRefresh()):(a.cost=ActivityTreasureBowl.cfg.cost[e.drawTimes],a.CostRefresh()),e.chooseItem[i].type==t.type&&e.chooseItem[i].idx==t.idx&&(e.drawLocation[i]=t.cardIdx)}this.FlopCellGroup.touchChildren=!0},n.prototype.onUpdateActivity=function(){ActivityTreasureBowl.ChooseItem=new Array,ActivityTreasureBowl.ItemListData=new Array,ActivityTreasureBowl.TypeItemNum=new Array;for(var e=0;e<ActivityTreasureBowl.cfg.itemChooseNum.length;e++)ActivityTreasureBowl.TypeItemNum.push(0);for(var e=0;e<ActivityTreasureBowl._data.chooseItem.length;e++)if(-1!=ActivityTreasureBowl._data.chooseItem[e].type){var t={type:ActivityTreasureBowl._data.chooseItem[e].type,idx:ActivityTreasureBowl._data.chooseItem[e].idx};ActivityTreasureBowl.ItemListData.push(ActivityTreasureBowl.cfg.chooseItem[t.type][t.idx]),ActivityTreasureBowl.ItemListData[e].forbidTip=!0,ActivityTreasureBowl.ChooseItem.push(t),ActivityTreasureBowl.TypeItemNum[t.type]++}else{var t={type:-1,idx:-1};ActivityTreasureBowl.ItemListData.push(null),ActivityTreasureBowl.ChooseItem.push(t)}},n.prototype.onUpdateItemShowList=function(){for(var e=ActivityTreasureBowl._data.chooseItem,t=new Array,n=0;n<e.length;n++){if(-1==e[n].type||-1==e[n].idx)return;t.push(ActivityTreasureBowl.cfg.chooseItem[e[n].type][e[n].idx]),t[n].forbidTip=null}var i=this.ItemListShow.dataProvider;null==i?this.ItemListShow.dataProvider=new eui.ArrayCollection(t):i.replaceAll(t)},n.prototype.onUpdateFlopCell=function(){var t=StringWithFormat("{1}/{2}",ActivityTreasureBowl._data.drawTimes,ActivityTreasureBowl._data.chooseItem.length);this.TipsForNum.textFlow=Game.TextParser.parse("<font color='13868844'>Rút Thưởng: </font><font color='"+color.WHITE+"'>"+t+"</font>"),this.FlopCellGroup.removeChildren();for(var n=0;n<ActivityTreasureBowl._data.chooseItem.length;n++){var i=new e.TBFlopAward;i.data=null,i.DataRefresh(),ActivityTreasureBowl._data.drawTimes>=0&&(i.cost=ActivityTreasureBowl.cfg.cost[ActivityTreasureBowl._data.drawTimes],i.CostRefresh()),this.FlopCellGroup.addChild(i)}for(var n=0;n<ActivityTreasureBowl._data.drawLocation.length;n++){var a=ActivityTreasureBowl._data.drawLocation[n];if(-1!=a){var i=this.FlopCellGroup.getChildAt(a),r=ActivityTreasureBowl._data.chooseItem[n];i.data=ActivityTreasureBowl.cfg.chooseItem[r.type][r.idx],i.data.forbidTip=null,i.DataRefresh()}}},n.prototype.onUpdateItemList=function(){var e=ActivityTreasureBowl.TypeItemNum,t=ActivityTreasureBowl.cfg.itemChooseNum;this.TypeNum0=StringWithFormat("{1}/{2}",e[0],t[0]),this.TypeNum1=StringWithFormat("{1}/{2}",e[1],t[1]),this.TypeNum2=StringWithFormat("{1}/{2}",e[2],t[2]);var n=e[0]+e[1]+e[2],i=t[0]+t[1]+t[2];this.TipsForNum.textFlow=Game.TextParser.parse("<font color='13868844'>Chọn Thưởng: </font><font color='"+color.WHITE+"'>"+n+"/"+i+"</font>");var a=this.ItemList.dataProvider;null==a?this.ItemList.dataProvider=new eui.ArrayCollection(ActivityTreasureBowl.ItemListData):a.replaceAll(ActivityTreasureBowl.ItemListData);for(var r=ActivityTreasureBowl.ChooseItem,o=new Array,s=0;3>s;s++){var l=ActivityTreasureBowl.cfg.chooseItem[s].slice();o.push(l)}for(var s=0;s<r.length;s++)-1!=r[s].type&&(o[r[s].type][r[s].idx]=null);var u=this.TypeList0.dataProvider;u.replaceAll(o[0]);var c=this.TypeList1.dataProvider;c.replaceAll(o[1]);var h=this.TypeList2.dataProvider;h.replaceAll(o[2])},n.prototype.onTouchTap=function(t){if(null!=t.target.parent&&t.target.parent.parent instanceof e.TBFlopAward){var n=t.target.parent.parent,i=n;if(!i.CanAward())return;if(!this.checkPlayerState())return;var a=this.FlopCellGroup.getChildIndex(n);return this.onFlopAward(a),void(this.FlopCellGroup.touchChildren=!1)}switch(t.target){case this.BtnStartDrawCard:this.sendItemListInfo();break;case this.BtnNextRound:this.sendNextRoundReq()}},n.prototype.onTapList0=function(e){var t=this.TypeList0.dataProvider.getItemAt(e.itemIndex);this.onAddItem(t,0,e.itemIndex)},n.prototype.onTapList1=function(e){var t=this.TypeList1.dataProvider.getItemAt(e.itemIndex);this.onAddItem(t,1,e.itemIndex)},n.prototype.onTapList2=function(e){var t=this.TypeList2.dataProvider.getItemAt(e.itemIndex);this.onAddItem(t,2,e.itemIndex)},n.prototype.onAddItem=function(t,n,i){if(null!=t){var a=e.TBCellTips.instance;a.state="add",a.type=n,a.idx=i,a.desc=t.desc,a.data=t,UIManager.push(e.TBCellTips.instance)}},n.prototype.onDelItem=function(t){var n=e.TBCellTips.instance,i=this.ItemList.dataProvider.getItemAt(t.itemIndex);null!=i&&(n.state="delete",n.idx=t.itemIndex,n.desc=i.desc,n.data=i,UIManager.push(e.TBCellTips.instance))},n.prototype.sendItemListInfo=function(){var e=new net.def.C2SChooseItem;e.type=[],e.idx=[];for(var t=0;t<ActivityTreasureBowl.ChooseItem.length;t++){var n=ActivityTreasureBowl.ChooseItem[t];if(-1==n.type||-1==n.idx)return void PopUpMessage.push("Đạo cụ vẫn chưa chọn hết",color.RED);e.type[t]=ActivityTreasureBowl.ChooseItem[t].type,e.idx[t]=ActivityTreasureBowl.ChooseItem[t].idx}net.socket.write(2202,e.toArrayBuffer())},n.prototype.sendNextRoundReq=function(){var t=this;if(ActivityTreasureBowl._data.rounds>=ActivityTreasureBowl.cfg.totalRounds)return void PopUpMessage.push("Đã đạt số đợt tối đa",color.RED);if(!this.nowarn&&ActivityTreasureBowl._data.drawTimes<ActivityTreasureBowl._data.chooseItem.length){var n=new e.SliverCoinPrompt;n.title=lang.String("operation confirm"),n.content="Vẫn còn thưởng chưa rút, xác nhận muốn vào đợt kế?",n.cb=function(e){var i=new net.def.C2SDrawCard;i.idx=8,net.socket.write(2203,i.toArrayBuffer()),PopUpMessage.push("Đã vào đợt kế",color.GREEN),t.nowarn=e,UIManager.pop(n)},UIManager.push(n)}else{var i=new net.def.C2SDrawCard;i.idx=8,net.socket.write(2203,i.toArrayBuffer()),PopUpMessage.push("Đã vào đợt kế",color.GREEN)}},n.prototype.onFlopAward=function(e){var t=(this.FlopCellGroup.getChildAt(e),new net.def.C2SDrawCard);t.idx=e,net.socket.write(2203,t.toArrayBuffer())},n.prototype.checkPlayerState=function(){if(PlayerAttribute.bag.capacity(Game.BagPage.Prop)<1)return PopUpMessage.push(lang.StringWithFormat("bag room full{1}",1),color.RED),!1;var e=PlayerAttribute.currency[Game.Currency.GoldCoin],t=lang.String("not enough goldcoin");return"silverCoin"==ActivityTreasureBowl.cfg.currencyType&&(e+=PlayerAttribute.currency[Game.Currency.SilverCoin],t=lang.String("not enough silvercoin")),e<ActivityTreasureBowl.cfg.cost[ActivityTreasureBowl._data.drawTimes]?(PopUpMessage.push(t,color.RED),!1):!0},n}(eui.Component);e.TreasureBowl=t,__reflect(t.prototype,"UI.TreasureBowl",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.tipName=null,n.data=null,n.skinName="GameTipSkin",n.listContent.itemRenderer=e.gameTipItem,n.imgClose.addEventListener(egret.TouchEvent.TOUCH_TAP,n.close,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.open=function(e,t){if(this.close(),t)this.tipName=e,this.data=t;else{var n=table.gameTipData_[e];if(null==n)return void egret.error("tipName:"+e+" not find game_tips.json");this.tipName=n.title,this.data=n.tips}UIManager.push(this)},n.prototype.close=function(){UIManager.pop(this)},n.prototype.onAddToStage=function(){this.title=this.tipName,this.listContent.dataProvider=new eui.ArrayCollection(this.data)},n.prototype.onRemoveFromStage=function(){this.tipName=null,this.data=null},n}(e.FitComponent);e.GameTip=t,__reflect(t.prototype,"UI.GameTip",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="GameTipItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){null!=this.data.textFlow?this.labelDisplay.textFlow=Game.HtmlTextParser.parse(this.data.textFlow):(null!=this.data.font&&(this.labelDisplay.size=this.data.font),null!=this.data.textColor&&(this.labelDisplay.textColor=this.data.textColor),this.labelDisplay.text=this.data.text)},t}(eui.ItemRenderer);e.gameTipItem=t,__reflect(t.prototype,"UI.gameTipItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="PopupMenuSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.imgClose.addEventListener(egret.TouchEvent.TOUCH_TAP,t.close,t),t.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,t.onItemTap,t),t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.onAddToStage=function(){this.list.dataProvider=new eui.ArrayCollection(this.data)},t.prototype.Open=function(e,t,n,i,a){this.onClick=t,this.thisObject=n,this.data=e,UIManager.push(this)},t.prototype.onItemTap=function(e){if(null!=this.onClick){var t=this.onClick;t(this.thisObject,e.itemIndex)}UIManager.pop(this)},t}(e.FitComponent);e.PopupMenu=t,__reflect(t.prototype,"UI.PopupMenu",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="PopupSkillSkin",t.touchEnabled=!1,t.touchChildren=!1,t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.generate=function(e,n){var i=this.objectPool.pop();return null==i&&(i=new t),i.init(e,n),i},t.prototype.init=function(e,t){this.currentState=e,this.skillName=t},t.prototype.__recycle=function(){this.alpha=1,this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.anchorOffsetX=0,this.anchorOffsetY=0,this.skillName=null,egret.Tween.removeTweens(this)},t.prototype.onRemoveFromStage=function(){t.objectPool.push(this)},t.objectPool=new egret.Recycler,t}(eui.Component);e.popupSkill=t,__reflect(t.prototype,"UI.popupSkill",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="PopupTextSkin",t.touchEnabled=!1,t.touchChildren=!1,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.generate=function(e,n,i,a){var r=this.objectPool.pop();return null==r&&(r=new t),r.init(e,n,i,a),r},t.prototype.init=function(e,t,n,i){this.text=e,this.fontRes=t,this.imgPath=n,i?this.currentState="imgPrefix":this.currentState=""},t.prototype.onAddToStage=function(){this.bitMapText.visible=null!=this.fontRes&&""!=this.fontRes,this.bitMapText.visible?(this.bitMapText.font=this.fontRes,this.bitMapText.text=this.text):(this.bitMapText.font=null,this.bitMapText.text=null),this.imgText.visible=null!=this.imgPath&&""!=this.imgPath,this.imgText.visible?this.imgText.source=this.imgPath:this.imgText.source=null,this.x=this.x-this.width/2},t.prototype.__recycle=function(){this.alpha=1,this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.anchorOffsetX=0,this.anchorOffsetY=0,this.imgText.source=null,this.bitMapText.font=null,this.bitMapText.text=null,egret.Tween.removeTweens(this)},t.prototype.onRemoveFromStage=function(){t.objectPool.push(this)},t.objectPool=new egret.Recycler,t}(eui.Component);e.PopupText=t,__reflect(t.prototype,"UI.PopupText",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){function t(){return null==e.wanderingsUI&&(e.wanderingsUI=new a),e.wanderingsUI}function n(t){if(3==t){if(PlayerAttribute.Level<Guild.limitLevel)return void PopUpMessage.push(lang.StringWithFormat("wanderings entrance guild open in level {1}",Guild.limitLevel),color.RED);if(""==Player.instance.guildName)return void PopUpMessage.push(lang.String("require guild"),color.RED)}null==e.wanderingsUI&&(e.wanderingsUI=new a),null!=t&&(e.wanderingsUI.page=t),1==e.wanderingsUI.page&&WildBoss.requestServerMissions(),UIManager.pushPage(e.wanderingsUI)}function i(){null!=e.wanderingsUI&&UIManager.pop(e.wanderingsUI)}e.getWanderingsUI=t,e.openWanderingsUI=n,e.closeWanderingsUI=i;var a=function(t){function n(){var e=t.call(this)||this;return e.skinName="WanderingsEntranceSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,e.onBarItemTap,e),e}return __extends(n,t),n.prototype.onAddToStage=function(){this.dataProvider0=new eui.ArrayCollection(table.wanderings[0]);for(var e=[],t=0;t<table.wanderings[1].length;t++)("Thông Thiên Tháp"!=table.wanderings[1][t].name||WorldLine.IsOpen("BabelScene"))&&("Kiếm Môn Quan Chiến"!=table.wanderings[1][t].name||WorldLine.IsOpen("JianMenGuanScene"))&&e.push(table.wanderings[1][t]);this.dataProvider1=new eui.ArrayCollection(e);for(var n=[],t=0;t<table.wanderings[2].length;t++)("Khiêu chiến Tình Nghĩa"!=table.wanderings[2][t].name||WorldLine.IsOpen("QingyiScene")||WorldLine.IsOpen("QingyiHeroScene"))&&n.push(table.wanderings[2][t]);this.dataProvider2=new eui.ArrayCollection(n);for(var i=[],t=0;t<table.wanderings[3].length;t++)("Thiên Bảo Khố"!=table.wanderings[3][t].name||WorldLine.IsOpen("GuildDungeon"))&&("Dũng Võ Điện"!=table.wanderings[3][t].name||WorldLine.IsOpen("BravePalace"))&&i.push(table.wanderings[3][t]);this.dataProvider3=new eui.ArrayCollection(i),null!=this.page?this.tabbar.selectedIndex=this.page:this.tabbar.selectedIndex=0,this.onLevelUp(),Game.dispatcher.addEventListener(Game.EVENT.LevelUp,this.onLevelUp,this),Game.dispatcher.addEventListener(Game.EVENT.UpdateVip,this.onLevelUp,this),guide.addEventListener(guide.GuideOperation.GuideCatchThief,this.onGuideReminder,this),guide.addEventListener(guide.GuideOperation.GuideFengLingDu,this.onGuideReminder,this),Game.dispatcher.addEventListener(Game.EVENT.WildBossInfo,this.onWildBossDataChanged,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.LevelUp,this.onLevelUp,this),Game.dispatcher.removeEventListener(Game.EVENT.UpdateVip,this.onLevelUp,this),guide.removeEventListener(guide.GuideOperation.GuideCatchThief,this.onGuideReminder,this),guide.removeEventListener(guide.GuideOperation.GuideFengLingDu,this.onGuideReminder,this),Game.dispatcher.removeEventListener(Game.EVENT.WildBossInfo,this.onWildBossDataChanged,this),this.page=null},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},n.prototype.close=function(){i()},n.prototype.onBarItemTap=function(e){this.scroller.viewport.scrollV=0;var t=e.itemIndex;3==t&&(PlayerAttribute.Level<Guild.limitLevel?(PopUpMessage.push(lang.StringWithFormat("wanderings entrance guild open in level {1}",Guild.limitLevel),color.RED),this.tabbar.selectedIndex=this.selectedTabIndex):""==Player.instance.guildName&&(Guild.openGuildEnroll(),PopUpMessage.push(lang.String("require guild"),color.RED),this.tabbar.selectedIndex=this.selectedTabIndex)),1==t&&WildBoss.requestServerMissions()},n.prototype.onLevelUp=function(){var t=WildBoss.selectTwoBossesByRoleLevel(),n=0;for(var i in table.wanderings)for(var a=table.wanderings[i],r=a.length,o=0;r>o;o++){var s=a[o];if(s.txtInfo1=s.tips1,PlayerAttribute.Level>=s.level)switch(s.txtInfo2="",s.color2=color.GREEN,s.kind){case 0:s.txtInfo2=StringWithFormat(s.tips2,MasterChallenge.challengeLeft),s.txtInfo3=StringWithFormat(s.tips3,MasterChallenge.ibLeft),s.color2=color.GREEN,s.color3=color.GREEN,s.light=badge.blackboard[badge.action.MasterChallenge];break;case 1:s.txtInfo2=StringWithFormat(s.tips2,TaohuaIsland.plantChances),s.txtInfo3=StringWithFormat(s.tips3,TaohuaIsland.robFreeChances),s.color2=color.GREEN,s.color3=color.GREEN,s.light=badge.blackboard[badge.action.TaoHuaIsland];break;case 2:s.txtInfo2=StringWithFormat(s.tips2,ArenaChallenge.getJoinTimes()),s.txtInfo3=StringWithFormat(s.tips3,ArenaChallenge.getBuyTimes()),s.color2=color.GREEN,s.color3=color.GREEN,s.light=badge.blackboard[badge.action.ArenaChallenge];break;case 4:s.txtInfo2=StringWithFormat(s.tips2,SeaSunVillage.curTimes),s.txtInfo3=StringWithFormat(s.tips3,SeaSunVillage.buyTimes),s.color2=color.GREEN,s.color3=color.GREEN,s.light=badge.blackboard[badge.action.SeaSunVillage];break;case 5:s.light=badge.blackboard[badge.action.LittleBoss];break;case 14:s.txtInfo2=StringWithFormat(s.tips2,DungeonHallMgr.getDungeonCond_LeftTimes(DungeonHallMgr.DungeonTarget_FerryBoat)),s.color2=color.GREEN,s.txtInfo3=FenglingBoat.getVipHint(),s.color3=color.GREEN,s.light=badge.blackboard[badge.action.Dungeon_FerryBoat];break;case 15:s.txtInfo2=StringWithFormat(s.tips2,DungeonHallMgr.getDungeonCond_LeftTimes(DungeonHallMgr.DungeonTarget_CatchThief)),s.color2=color.GREEN,s.txtInfo3=CatchThief.getVipHint(),s.color3=color.GREEN,s.light=badge.blackboard[badge.action.Dungeon_CatchThief];break;case 11:s.light=badge.blackboard[badge.action.GuildGarden],s.txtInfo3=PrizeWheel.getCountTxt(),s.color3=color.GREEN;break;case 7:var l=0==n?badge.action.WildBossTip1:badge.action.WildBossTip2;s.light=badge.blackboard[l];var u=t[n];u&&this.setWildBossItemInfo(u,s,!0),n++;break;case 6:s.color2=color.GREEN,s.color3=color.GREEN,s.txtInfo2=s.tips2;var c=SongJin.MaxEnrollTimes-SongJin.data.times;0>c&&(c=0),s.txtInfo3=StringWithFormat(s.tips3,c);break;case 16:s.light=badge.blackboard[badge.action.WulinLiansai],s.txtInfo2=StringWithFormat(s.tips2,e.WulinLiansaiPanel.instance.chance),e.WulinLiansaiPanel.instance.chance>0?s.color2=color.GREEN:s.color2=color.RED;break;case 20:s.light=badge.blackboard[badge.action.YanemperorLogin],s.txtInfo4=s.tips4,s.txtInfo2=s.tips2,s.txtInfo3=StringWithFormat(s.tips3,YanEmperor.curAwarded+"/"+YanEmperor.maxAwarded),s.color2=color.GREEN,s.color3=color.GREEN,s.color4=color.GREEN;break;case 21:s.light=badge.blackboard[badge.action.Babel],s.awards=Babel.awards,s.color4=color.GREEN,s.color2=color.GREEN,s.txtInfo4=s.tips4,s.txtInfo2=s.tips2;break;case 3:s.light=badge.blackboard[badge.action.HuashanPKDailyAward],s.txtInfo2=s.tips2,s.txtInfo3=s.tips3,s.txtInfo4=s.tips4,s.color2=color.GREEN,s.color3=color.GREEN,s.color4=color.GREEN;break;case 22:s.light=badge.blackboard[badge.action.GuildDungeonOpen],s.txtInfo2=s.tips2,s.txtInfo3=s.tips3,s.txtInfo4=s.tips4,s.color2=color.GREEN,s.color3=color.GREEN,s.color4=color.GREEN;break;case 24:s.txtInfo2=StringWithFormat(s.tips2,Foursymbols.freeTimes+Foursymbols.extendTimes),s.txtInfo3=StringWithFormat(s.tips3,Foursymbols.buyTimes),s.color2=color.GREEN,s.color3=color.GREEN;break;case 28:s.txtInfo2=StringWithFormat(s.tips2,Foursymbols.gmdFreeTimes+Foursymbols.gmdExtendTimes),s.txtInfo3=StringWithFormat(s.tips3,Foursymbols.gmdBuyTimes),s.color2=color.GREEN,s.color3=color.GREEN;break;case 25:s.light=badge.blackboard[badge.action.BravePalaceActivated],s.txtInfo2=s.tips2,s.txtInfo3=s.tips3,s.txtInfo4=s.tips4,s.color2=color.GREEN,s.color3=color.GREEN,s.color4=color.GREEN;break;case 26:s.txtInfo3=s.tips3,s.txtInfo4=s.tips4,s.color2=color.GREEN,s.color3=color.GREEN,s.color4=color.GREEN;break;default:s.txtInfo2=s.tips2,s.txtInfo3=s.tips3,s.txtInfo4=s.tips4,s.color2=color.GREEN,s.color3=color.GREEN,s.color4=color.GREEN}else switch(s.kind){case 7:var u=t[n];u&&this.setWildBossItemInfo(u,s,!1),n++;break;case 21:s.txtInfo2=lang.StringWithFormat("wanderings entrance open level is {1}",s.level),s.color2=color.RED,s.awards=Babel.awards;break;default:s.txtInfo2=lang.StringWithFormat("wanderings entrance open level is {1}",s.level),s.color2=color.RED}}this.dataProvider0.refresh(),this.dataProvider1.refresh(),this.dataProvider2.refresh(),this.dataProvider3.refresh()},n.prototype.onGuideReminder=function(){var e=this;this.visible&&guide.pushMovie({weight:2,handle:function(){e.dataProvider2.refresh()}})},n.prototype.setWildBossItemInfo=function(e,t,n){7==t.kind&&(t.icon=e.wanderingsicon,t.txtInfo1=e.name,t.txtInfo2=e.tip,n?(t.color2=color.GREEN,t.color3=color.GREEN,t.txtInfo3=e.status):(t.color2=color.RED,t.txtInfo3=""))},n.prototype.onWildBossDataChanged=function(){for(var e=WildBoss.selectTwoBossesByRoleLevel(),t=0,n=table.wanderings[1],i=n.length,a=0;i>a;a++){var r=n[a];if(PlayerAttribute.Level>=r.level)switch(r.kind){case 7:var o=0==t?badge.action.WildBossTip1:badge.action.WildBossTip2;r.light=badge.blackboard[o];var s=e[t];s&&this.setWildBossItemInfo(s,r,!0),t++}else switch(r.kind){case 7:var s=e[t];s&&this.setWildBossItemInfo(s,r,!1),t++}}this.dataProvider1.refresh()},n}(e.FitComponent);e.WanderingsEntrance=a,__reflect(a.prototype,"UI.WanderingsEntrance",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="WanderingsItemSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.btnEnter.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchEnter,e),e}return __extends(n,t),n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.CrossServerBossStatusChanged,this.onCrossBossChanged,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.CrossServerBossStatusChanged,this.onCrossBossChanged,this)},n.prototype.dataChanged=function(){switch(this.itemList.itemRenderer=e.AwardCell,this.itemList.dataProvider=new eui.ArrayCollection(this.data.awards),null==this.data.icon?this.tagIcon="icon/item/hlb.png":this.tagIcon=this.data.icon,null!=this.data.desc&&(this.descLabel=Game.HtmlTextParser.parse(this.data.desc)),this.info2.textColor=this.data.color2,this.info3.textColor=this.data.color3,this.info4.textColor=this.data.color4,this.badge=this.data.light,this.btnEnter.enabled=!0,this.btnEnter.label=lang.String("wanderings item button label enter"),this.data.kind){case 15:case 14:DungeonHallMgr.IsInRoom()&&(this.btnEnter.label=lang.String("wanderings item button label inroom state"));break;case 18:this.onCrossBossChanged();break;case 11:this.btnEnter.enabled=PrizeWheel.UsedCount<PrizeWheel.countLimit}(15==this.data.kind&&guide.info.operation==guide.GuideOperation.GuideCatchThief||14==this.data.kind&&guide.info.operation==guide.GuideOperation.GuideFengLingDu)&&!guide.completed()?guide.AddMovieClip(this.btnEnter):guide.removeMovieClip(this.btnEnter)},n.prototype.onTouchEnter=function(){var t=this,n=DungeonHallMgr.IsInRoom();if(n)switch(this.data.kind){case 15:DungeonHallMgr.curTarget==DungeonHallMgr.DungeonTarget_CatchThief&&(n=!1);break;case 14:DungeonHallMgr.curTarget==DungeonHallMgr.DungeonTarget_FerryBoat&&(n=!1)}if(n){var i=lang.String("operation confirm"),a=lang.StringWithFormat("dungeon you are in {1} room, this opt will quit the room",DungeonHallMgr.curTargetName);e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],i,a,function(){return DungeonHallMgr.ApplyQuitRoom(),DungeonHallMgr.ClearRoomData(),t.Enter(),!0},null,null)}else this.Enter()},n.prototype.Enter=function(){null!=this.data.operation?(Operation.open(this.data.operation),e.closeWanderingsUI()):PopUpMessage.push(lang.String("not open yet!"),color.RED)},n.prototype.onCrossBossChanged=function(){this.btnEnter.enabled=!!Player.instance.guildName&&Game.countDay()+1>=Reminder.events[Reminder.EventName.CrossServerBoss].openDayLimit},n}(eui.ItemRenderer);e.WanderingsItem=t,__reflect(t.prototype,"UI.WanderingsItem")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(eui.ItemRenderer);e.WeekendRecruitRankItem=t,__reflect(t.prototype,"UI.WeekendRecruitRankItem");var n=function(e){function t(){var t=e.call(this)||this;return t.skinName="WeekendRecruitRankUISkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.dataRecord=new eui.ArrayCollection,t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.onAddToStage=function(){this.list.dataProvider=this.dataRecord},t.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},t.prototype.close=function(){UIManager.pop(this)},t}(e.FitComponent);e.WeekendRecruitRankUI=n,__reflect(n.prototype,"UI.WeekendRecruitRankUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="WeekendRecruitUISkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),n.prototype.onAddToStage=function(){this.updateAwards(),Game.dispatcher.addEventListener(Game.EVENT.WeekendRecruitSyncTimes,this.updateAwards,this),this.showDate=WeekendRecruit.showDateDesc(),this.backgroup=WeekendRecruit.backgroup},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.WeekendRecruitSyncTimes,this.updateAwards,this),Partner.recruiting=!1},n.prototype.updateAwards=function(){this.awards=[],this.awards.push(this.award0),this.awards.push(this.award1),this.awards.push(this.award2),this.awards.push(this.award3),this.awards.push(this.award4);for(var e=0;e!=this.awards.length;e++){var t=WeekendRecruit.weekendRecruitAward[e];this.awards[e].selected=WeekendRecruit.RecruitTimes>=t.times}this.curValue=WeekendRecruit.RecruitTimes,this.freeTimes=WeekendRecruit.FreeTimes,this.freeTimes>0?(this.groupFree.visible=!0,this.groupCostGold.visible=!1):(this.groupFree.visible=!1,this.groupCostGold.visible=!0)},n.prototype.onClickAward=function(t){var n=WeekendRecruit.weekendRecruitAward[t];null!=n&&(e.ItemTips.instance.data={type:"item",content:{genre:n.genre,detailType:n.detai,count:n.count}},UIManager.push(e.ItemTips.instance))},n.prototype.openRule=function(){var t=new e.Rule;t.skinName="WeekendRecruitRuleSkin",UIManager.push(t)},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnClose:case this.btnBack:case this.imgClose:UIManager.pop(this);break;case this.btnRule:this.openRule();break;case this.btnRecruitOnce:WeekendRecruit.Recruit(WeekendRecruit.RECRUITTYPE_ONCE);break;case this.btnRecruitTen:WeekendRecruit.Recruit(WeekendRecruit.RECRUITTYPE_TEN);break;case this.btnRecords:WeekendRecruit.GetRecords();break;case this.awardImage0:this.onClickAward(0);break;case this.awardImage1:this.onClickAward(1);break;case this.awardImage2:this.onClickAward(2);break;case this.awardImage3:this.onClickAward(3);break;case this.awardImage4:this.onClickAward(4)}},n}(eui.Component);e.WeekendRecruitUI=t,__reflect(t.prototype,"UI.WeekendRecruitUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="DailyGiftSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),n.prototype.onAddToStage=function(){this.updateDailyGiftInfo(),Game.dispatcher.addEventListener(Game.EVENT.DailyGiftInfo,this.updateDailyGiftInfo,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.DailyGiftInfo,this.updateDailyGiftInfo,this)},n.prototype.updateDailyGiftInfo=function(){var t="Cập nhật lúc 4 giờ sáng mỗi ngày";Recharge.IsBuySevenDaysGift&&(t+="\n<font color='0xFF0000'>(Bạn đã mua gói Quà Ngày dùng cho 7 ngày)</fond>"),this.tips.textFlow=Game.TextParser.parse(t);var n=[],i=Recharge.getConfig();for(var a in i){var r=i[a],o=Recharge.DailyGift[a],s=!0;null!=o&&o&&(s=!1),n.push({wareId:a,name:r.name,used:s,vnd:r.vnd,awards:r.awards,backdrop:r.backdrop})}this.list.itemRenderer=e.DailyGiftItem,this.list.dataProvider=new eui.ArrayCollection(n)},n}(eui.Component);e.DailyGift=t,__reflect(t.prototype,"UI.DailyGift",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="DailyGiftItemSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.dataChanged=function(){this.btnBuy.visible=this.data.used,this.imgClose.visible=!this.btnBuy.visible,this.vnd=this.data.vnd+" VND",this.awards.itemRenderer=e.AwardCell,this.awards.dataProvider=new eui.ArrayCollection(this.data.awards)},n.prototype.onTouchTap=function(e){switch(e.target){case this.btnBuy:Payment.buy(this.data.wareId)}},n}(eui.ItemRenderer);e.DailyGiftItem=t,__reflect(t.prototype,"UI.DailyGiftItem",["eui.UIComponent","egret.DisplayObject"])
}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="FundingAwardSkin",t.touchEnabled=!1,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.FundingAward,this.dataChanged,this),this.dataChanged()},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.FundingAward,this.dataChanged,this)},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnBuy:var t=Recharge.getFundingAwardWareId(Recharge.FundingAward.buyLevel);t&&Payment.buy(t.wareId)}},t.prototype.dataChanged=function(){if(null==Recharge.FundingAward)return void(this.btnBuy.enabled=!1);var e=Recharge.getFundingAwardWareId(Recharge.FundingAward.buyLevel);this.fundingname=lang.Format("Đầu Tư (Lv{1})",Recharge.FundingAward.buyLevel),this.fundingdesc=lang.Format("Nhận vật đạt Lv{1}, nạp {2} VND và mua gói Đầu Tư, nhận ngay {3} KNB, khi đạt cấp yêu cầu được nhận thêm {4} KNB Khóa.",Recharge.FundingAward.buyLevel,e.vnd,e.goldCoin,Recharge.FundingAward.silverCoin),this.btnBuy.enabled=Recharge.FundingAward.canBuy?PlayerAttribute.Level>=Recharge.FundingAward.buyLevel:!1,this.btnBuy.label=Recharge.FundingAward.canBuy?"Mua ngay":"Đã mua";var t=[],n=[];for(var i in Recharge.FundingAward.levels){var a=Recharge.FundingAward.levels[i],r=Recharge.FundingAward.canAward[i];r?t.push({buylevel:Recharge.FundingAward.buyLevel,level:a,desc:lang.Format("Cấp đạt Lv<font color='#f5f5f5'> {1} </font>",a),count:Recharge.FundingAward.silverCoin,status:!0,buyed:!Recharge.FundingAward.canBuy}):n.push({buylevel:Recharge.FundingAward.buyLevel,level:a,desc:lang.Format("Cấp đạt Lv<font color='#f5f5f5'> {1} </font>",a),count:Recharge.FundingAward.silverCoin,status:!1,buyed:!Recharge.FundingAward.canBuy})}t.push.apply(t,n),this.dataGroup.dataProvider=new eui.ArrayCollection(t)},t}(eui.Component);e.FundingAward=t,__reflect(t.prototype,"UI.FundingAward",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="FundingAwardItemSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.onTouchTap=function(e){switch(e.target){case this.btnDraw:if(PlayerAttribute.Level<this.data.level)return void PopUpMessage.push(lang.Format("Chưa đạt Lv{1}, tạm không thể nhận.",this.data.level),color.RED);var t=new net.def.C2SFundingLevelAward;t.buyLevel=this.data.buylevel,t.awardLevel=this.data.level,net.socket.write(2041,t.toArrayBuffer()),this.btnDraw.enabled=!1}},t.prototype.dataChanged=function(){this.data.buyed?(this.btnDraw.visible=this.data.status,this.btnDraw.enabled=this.data.status&&PlayerAttribute.Level>=this.data.level,this.btnDraw.label=this.data.status?"Nhận":"Đã nhận"):(this.btnDraw.visible=!0,this.btnDraw.enabled=!1,this.btnDraw.label="Nhận"),this.desc.textFlow=Game.HtmlTextParser.parse(this.data.desc)},t}(eui.ItemRenderer);e.FundingAwardItem=t,__reflect(t.prototype,"UI.FundingAwardItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="WelfareHallSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new e.WelfareHall),this._instance},enumerable:!0,configurable:!0}),n.open=function(){var e=this.instance;return UIManager.pushPage(e),e},n.close=function(){null!=this._instance&&UIManager.pop(this._instance)},n.prototype.onAddToStage=function(){Game.removeFromParent.apply(this.btnHeroicCard),HeroicCard.inTime()&&this.btnGroup.addChildAt(this.btnHeroicCard,2),CumulativeLogin.finish()&&Game.removeFromParent.apply(this.btnSevenGift),this.scroller.viewport.scrollH=0;var e=this.btnGroup.getChildAt(0);e.selected=!0,this.onTouchTapTarget(e),Game.dispatcher.addEventListener(Game.EVENT.CumulativeLogin,this.onSevenGiftGroup,this),Game.dispatcher.addEventListener(Game.EVENT.HeroicCardOpen,this.openHeroicCardUI,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.CumulativeLogin,this.onSevenGiftGroup,this),Game.dispatcher.removeEventListener(Game.EVENT.HeroicCardOpen,this.openHeroicCardUI,this);for(var e=0;e<this.btnGroup.numChildren;e++){var t=this.btnGroup.getChildAt(e);t.selected=!1}},n.prototype.onTouchTap=function(e){this.onTouchTapTarget(e.target)},n.prototype.onTouchTapTarget=function(t){switch(t){case this.btnDailySign:this.dailyMark||(this.dailyMark=new e.DailyMark),this.addObjecttoView(this.dailyMark);break;case this.btnMoneyTree:this.moneytree||(this.moneytree=new e.MoneyTree),this.addObjecttoView(this.moneytree);break;case this.btnRedPacket:this.redPacket||(this.redPacket=new e.MyRedPackets),this.addObjecttoView(this.redPacket);break;case this.btnRetrieve:this.rewardRetrieve||(this.rewardRetrieve=new e.RewardRetrieve),this.addObjecttoView(this.rewardRetrieve);break;case this.btGiftCode:this.giftCode||(this.giftCode=new e.GiftCode),this.addObjecttoView(this.giftCode);break;case this.btnSevenGift:this.sevenGift||(this.sevenGift=new e.SevenGift),this.addObjecttoView(this.sevenGift);break;case this.btnHeroicCard:if(PlayerAttribute.Level<HeroicCard.SYS_OPEN_LEVEL){PopUpMessage.push(lang.StringWithFormat("open on level {1}",HeroicCard.SYS_OPEN_LEVEL),color.Warning);var n=this.btnGroup.getChildAt(0);n.selected=!0,this.onTouchTapTarget(n);break}this.herociCardUI||(this.herociCardUI=e.HeroicCardUI.instance),this.addObjecttoView(this.herociCardUI);break;case this.imgClose:this.close();break;case this.arrowLeft:this.onFlipTitle(!1);break;case this.arrowRight:this.onFlipTitle(!0)}},n.prototype.onFlipTitle=function(e){var t=this.scroller.width-50;if(e){if(this.scroller.viewport.scrollH+t>=this.scroller.viewport.contentWidth)return;this.scroller.viewport.scrollH+=t}else this.scroller.viewport.scrollH>=t?this.scroller.viewport.scrollH-=t:this.scroller.viewport.scrollH=0},n.prototype.onSevenGiftGroup=function(){if(CumulativeLogin.finish()&&this.btnSevenGift&&this.btnSevenGift.parent==this.btnGroup){if(1==this.btnSevenGift.selected){var e=this.btnGroup.getChildAt(0);e.selected=!0,this.onTouchTapTarget(e)}Game.removeFromParent.apply(this.btnSevenGift)}},n.prototype.addObjecttoView=function(e){e.parent!=this.view&&(this.view.removeChildren(),this.view.addChild(e))},n.prototype.close=function(){UIManager.pop(this)},n.prototype.ShowHeroicCardPage=function(){var e=this.btnGroup.getChildAt(0);e.selected=!1,this.onTouchTapTarget(this.btnHeroicCard),this.btnHeroicCard.selected=!0},n.prototype.openHeroicCardUI=function(e){if(null!=e)if(1==e.data)HeroicCard.inTime()&&this.btnHeroicCard.parent!=this.btnGroup&&this.btnGroup.addChildAt(this.btnHeroicCard,2);else if(0==e.data&&this.btnHeroicCard.parent==this.btnGroup)if(1==this.btnHeroicCard.selected){Game.removeFromParent.apply(this.btnHeroicCard);var t=this.btnGroup.getChildAt(0);t.selected=!0,this.onTouchTapTarget(t)}else Game.removeFromParent.apply(this.btnHeroicCard)},n.prototype.ShowRedPacket=function(){var e=this.btnGroup.getChildAt(0);e.selected=!1,this.onTouchTapTarget(this.btnRedPacket),this.btnRedPacket.selected=!0},n.prototype.ShowSevenGift=function(){if(!CumulativeLogin.finish()){var e=this.btnGroup.getChildAt(0);e.selected=!1,this.onTouchTapTarget(this.btnSevenGift),this.btnSevenGift.selected=!0}},n.prototype.ShowMoneyTree=function(){var e=this.btnGroup.getChildAt(0);e.selected=!1,this.onTouchTapTarget(this.btnMoneyTree),this.btnMoneyTree.selected=!0},n}(e.FitComponent);e.WelfareHall=t,__reflect(t.prototype,"UI.WelfareHall",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="WulinLiansaiInviteSkin",n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.friendList.itemRenderer=e.WulinLiansaiInviteItem,n.friendList.dataProvider=WulinLiansai.dataFriendList,n}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.SyncFriends,DungeonHallMgr.updateDataInviteFriend,null)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.SyncFriends,DungeonHallMgr.updateDataInviteFriend,null)},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},n.prototype.close=function(){WulinLiansai.dataFriendList.removeAll(),UIManager.pop(this)},n}(e.FitComponent);e.WulinLiansaiInvite=t,__reflect(t.prototype,"UI.WulinLiansaiInvite",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="WulinLiansaiInviteItemSkin",t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.dataChanged=function(){this.txtFaction=table.faction[this.data.faction].name,this.portrait=table.faction[this.data.faction].portrait,"normal"==this.data.state?(this.btnInvite.label=lang.String("wlls invite btn msg normal"),this.btnInvite.enabled=!0):(this.btnInvite.label=lang.String("wlls invite btn msg success"),this.btnInvite.enabled=!1)},t.prototype.onTouchTap=function(e){if(null!=this.data)switch(e.target){case this.btnInvite:if(this.data.chance<=0)return void PopUpMessage.push(lang.String("wlls friend no chance"),color.RED);if(this.data.playerLevel<WulinLiansai.NEEDLEVEL)return void PopUpMessage.push(lang.String("wlls low level cannot be invited"),color.RED);WulinLiansai.InviteFriend(this.data.name)}},t}(eui.ItemRenderer);e.WulinLiansaiInviteItem=t,__reflect(t.prototype,"UI.WulinLiansaiInviteItem")}(UI||(UI={}));var UI;!function(e){var t={0:"ui/meridian/btn_0.png",1:"ui/meridian/ren_btn2.png"},n=function(e){function n(){var t=e.call(this)||this;return t.skinName="WulinLiansaiNoteSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(n,e),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onAddToStage=function(){this.datalistOur=[],this.datalistOther=[];for(var e=0;e!=n.campMaxLife;e++)this.datalistOur.push({img:t[1]}),this.datalistOther.push({img:t[1]});this.ourCampLife.dataProvider=new eui.ArrayCollection(this.datalistOur),this.otherCampLife.dataProvider=new eui.ArrayCollection(this.datalistOther),this.ourLife=0,this.otherLife=0,this.killNum=0,this.dieNum=0},n.prototype.SetCampLife=function(e,i){this.ourLife=e,this.otherLife=i;for(var a=0;a!=n.campMaxLife;a++){var r=a+1;e>=r?this.datalistOur[a].img=t[1]:this.datalistOur[a].img=t[0]}for(var a=0;a!=n.campMaxLife;a++){var r=a+1;i>=r?this.datalistOther[a].img=t[1]:this.datalistOther[a].img=t[0]}},n.campMaxLife=5,n}(e.FitComponent);e.WulinLiansaiNote=n,__reflect(n.prototype,"UI.WulinLiansaiNote",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="WulinLiansaiPanelSkin",n.matching=!1,n.matchTime=0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.memberList.dataProvider=WulinLiansai.dataMemberList,n.memberList.itemRenderer=e.MyTeamList,n}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onAddToStage=function(){this.matching=!1,this.matchTime=0,this.updateBtnMsg(),SecondTicker.addEventListener(this.onTimer_UpdateTime,this),this.matchStateDescGroup.visible=!1},n.prototype.onRemoveFromStage=function(){this.matchStateDescGroup.visible=!1,SecondTicker.removeEventListener(this.onTimer_UpdateTime,this)},n.prototype.onTouchTap=function(t){switch(t.target){case this.imgClose:this.close();break;case this.btnRules:var n=new e.Rule;n.skinName="WulinLiansaiRule",UIManager.pushPage(n);break;case this.btnMatch:this.onClickMatch();break;case this.btnBuyChance:WulinLiansai.BuyChance()}},n.prototype.close=function(){WulinLiansai.ClosePanel()},n.prototype.updateBtnMsg=function(){this.matching?this.btnMatch.label=lang.String("wlls btn msg end match"):this.btnMatch.label=lang.String("wlls btn msg begin match")},n.prototype.onClickMatch=function(){this.matching?(WulinLiansai.EndMatch(),this.matchTimeDesc="",this.matchTime=0,this.matchStateDescGroup.visible=!1):(WulinLiansai.BeginMatch(),this.matchTime=0,this.onTimer_UpdateTime(),this.matchStateDescGroup.visible=!0),this.matching=!this.matching,this.updateBtnMsg()},n.prototype.onTimer_UpdateTime=function(){var e=Math.floor(this.matchTime/60),t=Math.floor(this.matchTime%60);this.matchTimeDesc=NumberFormat(e,2)+":"+NumberFormat(t,2),this.matchTime++,this.nextAddChanceTime<0&&(this.nextAddChanceTime=0);var n=Math.floor(this.nextAddChanceTime/3600);e=Math.floor(this.nextAddChanceTime/60%60),t=Math.floor(this.nextAddChanceTime%60),this.nextAddChanceTimeDesc=NumberFormat(n,2)+":"+NumberFormat(e,2)+":"+NumberFormat(t,2),this.nextAddChanceTime--},n}(e.FitComponent);e.WulinLiansaiPanel=t,__reflect(t.prototype,"UI.WulinLiansaiPanel",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.awards=[],n.skinName="WulinLiansaiResultSkin",n.dataAwardList=new eui.ArrayCollection,n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.mc=new e.MovieClipComponent,n.mc.horizontalCenter=0,n.mc.verticalCenter=10,n.mc.removeWhenComplete=!1,n.list.itemRenderer=e.WulinLiansaiResultItem,n.list.dataProvider=WulinLiansai.dataResultList,n.awardList.itemRenderer=e.AwardCell,n.addChild(n.mc),n}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.SyncFriends,DungeonHallMgr.updateDataInviteFriend,null),WulinLiansai.resultWin?(this.currentState="win",this.awards[0]={type:"silverCoin",content:n.WINAWARD}):(this.currentState="lose",this.awards[0]={type:"silverCoin",content:n.LOSEAWARD}),this.dataAwardList.replaceAll(this.awards),this.playAnimation()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.SyncFriends,DungeonHallMgr.updateDataInviteFriend,null),this.mc.visible=!1,this.mc.stop(),this.mc.free()},n.prototype.playAnimation=function(){this.mc.visible=!0,this.levelUp&&this.mc.Load("skill/ui_duanweiu/ui_duanweiu.json","ui_duanweiu"),this.levelDown&&this.mc.Load("skill/ui_duanweid/ui_duanweid.json","ui_duanweid"),this.mc.gotoAndPlay(0,1)},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},n.prototype.close=function(){WulinLiansai.dataResultList.removeAll(),UIManager.pop(this)},n.WINAWARD=15,n.LOSEAWARD=5,n}(e.FitComponent);e.WulinLiansaiResult=t,__reflect(t.prototype,"UI.WulinLiansaiResult",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="WulinLiansaiResultItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){this.select=this.data.name==Player.instance.Name,this.bg=this.data.win?"ui/liquidation/w_5.png":"ui/liquidation/s_5.png"},t}(eui.ItemRenderer);e.WulinLiansaiResultItem=t,__reflect(t.prototype,"UI.WulinLiansaiResultItem")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="WuxingshiDetailSkin",e.attributeListData=new eui.ArrayCollection,e.attributeList.dataProvider=e.attributeListData,e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.btnLevelup.addEventListener(egret.TouchEvent.TOUCH_BEGIN,e.onLevelUpBegin,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},n.prototype.setSelectSuitId=function(e){this.selectSuitId=e},n.prototype.setSelectWuxingshiId=function(e){this.selectWuxingshiId=e},n.prototype.onAddToStage=function(){this.updateData(),Game.dispatcher.addEventListener(Game.EVENT.WuxingshiActive,this.updateData,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingshiLevelup,this.onLevelupSuccess,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingshiRestore,this.updateData,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingshiEnchase,this.updateData,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingshiEnchaseSuit,this.updateData,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingshiSplit,this.updateMaterialNum,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingyinBadge,this.updateBadge,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.WuxingshiActive,this.updateData,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingshiLevelup,this.onLevelupSuccess,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingshiRestore,this.updateData,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingshiEnchase,this.updateData,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingshiEnchaseSuit,this.updateData,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingshiSplit,this.updateMaterialNum,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingyinBadge,this.updateBadge,this),this.stopAutoLevelup()},n.prototype.getActivedWuxingshiNum=function(){for(var e=0,t=Wuxingyinmanager.GetWuxingshiSuitConfig(this.selectSuitId),n=Wuxingyinmanager.jingzhiwuxingyinData.getStones(),i=0;i!=n.length;i++){var a=n[i];if(a.actived)for(var r=0;r!=t.stones.length;r++)t.stones[r]==a.id&&(e+=1)}return e},n.prototype.updateBadge=function(){this.levelUpBadge();for(var e=Wuxingyinmanager.GetWuxingshiSuitConfig(this.selectSuitId),t=0;t!=e.stones.length;t++){var n=e.stones[t],i=this.activeBadgeGroup.getChildAt(t);i.visible=Wuxingyinmanager.badgeJingZhiWuxingshiActive[n]}},n.prototype.levelUpBadge=function(){this.selectWuxingshiId<=0?this.badgeLevelup.visible=!1:this.badgeLevelup.visible=Wuxingyinmanager.badgeJingZhiWuxingshiLevelup[this.selectWuxingshiId]},n.prototype.updateData=function(){this.autoSelectDisplay(),this.updateBadge(),this.updateSuit(),this.updateWuxingshi(),this.updateMaterialNum(),this.updateEnchasedWuxingshi()},n.prototype.updateEnchasedWuxingshi=function(){for(var e=0;e!=Wuxingyinmanager.wuxingyinSlotNum;e++){var t=Wuxingyinmanager.jingzhiwuxingyinData.getSlots()[e],n=this.groupEnchased.getChildAt(e);n.data={id:t,select:!1,mode:Wuxingyinmanager.WuxingyinUI_DisplayMode_Self}}},n.prototype.autoSelectDisplay=function(){var e=!0,t=Wuxingyinmanager.GetWuxingshiSuitConfig(this.selectSuitId);if(this.selectWuxingshiId>0)for(var n=0;n!=t.stones.length;n++)if(t.stones[n]==this.selectWuxingshiId){e=!1;break}if(e){this.selectWuxingshiId=0;for(var i=Wuxingyinmanager.jingzhiwuxingyinData.getStones(),n=0;n!=t.stones.length;n++)for(var a=t.stones[n],r=0;r!=i.length;r++){var o=i[r];if(o.actived&&o.id==a)return void(this.selectWuxingshiId=a)}}},n.prototype.autoSelectLevelup=function(){for(var e=0,t=9999,n=Wuxingyinmanager.GetWuxingshiSuitConfig(this.selectSuitId),i=0;i!=Wuxingyinmanager.wuxingyinSlotNum;i++){var a=n.stones[i];if(Wuxingyinmanager.IsActived(a)){var r=Wuxingyinmanager.GetWuxingshiLevel(a);t>r&&(t=r,e=a)}}this.selectWuxingshiId=e},n.prototype.updateSuit=function(){var e=Wuxingyinmanager.GetWuxingshiSuitConfig(this.selectSuitId);this.suitName.text=e.name,this.suitName.textColor=Item.QualityColor[e.quality];for(var t=0;t!=e.stones.length;t++){var n=e.stones[t],i=Wuxingyinmanager.GetWuxingshiAttributeConfig(n),a=i.slotIndex,r=Wuxingyinmanager.IsUsing(n),o=(Wuxingyinmanager.IsActived(n),this.selectWuxingshiId==n),s=this.cellGroup.getChildAt(a);s.data={id:n,select:o,mode:Wuxingyinmanager.WuxingyinUI_DisplayMode_Self};var l=this.usedFlagGroup.getChildAt(a);l.visible=r,0==t&&(this.suitIcon=i.source)}var u=this.getActivedWuxingshiNum();this.btnEnchaseSuit.enabled=u>0;var c=Wuxingyinmanager.activedSuit[this.selectSuitId];this.suitAttribute0.text="",this.suitAttribute1.text="",this.suitAttribute2.text="",this.suitAttribute3.text="";for(var t=0;t!=e.attributes.length;t++){var h=e.attributes[t],d=Buff.GetDesc(h.buff[0],h.buff.slice(1));switch(d="["+h.needNum+"] "+d,t){case 0:this.suitAttribute0.text=d,this.suitAttribute0.textColor=c>t?color.WHITE:color.GRAY;break;case 1:this.suitAttribute1.text=d,this.suitAttribute1.textColor=c>t?color.WHITE:color.GRAY;break;case 2:this.suitAttribute2.text=d,this.suitAttribute2.textColor=c>t?color.WHITE:color.GRAY;break;case 3:this.suitAttribute3.text=d,this.suitAttribute3.textColor=c>t?color.WHITE:color.GRAY}}},n.prototype.updateWuxingshi=function(){if(this.selectWuxingshiId<=0||!Wuxingyinmanager.IsActived(this.selectWuxingshiId))return void(this.groupDetail.visible=!1);this.groupDetail.visible=!0;var e=Wuxingyinmanager.GetWuxingshiAttributeConfig(this.selectWuxingshiId),t=Wuxingyinmanager.GetWuxingshiSuitConfig(this.selectSuitId);this.wuxingshiName.text=e.name,this.wuxingshiName.textColor=Item.QualityColor[t.quality],this.udpateWuxingshiAttributes(e);var n=Wuxingyinmanager.GetWuxingshiLevel(this.selectWuxingshiId),i=n+1,a=Wuxingyinmanager.GetWuxingshiAttributeConfig(this.selectWuxingshiId);if(0>=n)this.groupRestoreGetInfo.visible=!1,this.btnRestore.enabled=!1;else{this.groupRestoreGetInfo.visible=!0,this.btnRestore.enabled=!0,this.restoreGetMaterialCell.data={type:"item",content:{genre:a.split.genre,detailType:a.split.detail}};var r=a.split.count[n];this.restoreGetNum.text="+"+r}if(n>=Wuxingyinmanager.wuxingshiMaxLevel)this.groupLevelupCostInfo.visible=!1,this.btnLevelup.enabled=!1;else{this.groupLevelupCostInfo.visible=!0,this.btnLevelup.enabled=!0,this.levelupCostMaterialCell.data={type:"item",content:{genre:a.cost.genre,detailType:a.cost.detail}};var o=a.cost.count[i];this.levelupCostNum.text="-"+o}this.btnEnchase.enabled=Wuxingyinmanager.IsActived(this.selectWuxingshiId)&&!Wuxingyinmanager.IsUsing(this.selectWuxingshiId)},n.prototype.udpateWuxingshiAttributes=function(e){var t=Wuxingyinmanager.GetWuxingshiLevel(this.selectWuxingshiId),n=t+1,i=[],a=e.normalAttribute.buffId,r=e.normalAttribute.params[t],o=e.normalAttribute.params[n],s=null!=o;null==o&&(o=0);var l=Buff.GetName(a);i.push({attribute:l,curParam:r,nextParam:o,hasNext:s});for(var u=0;u!=e.dungeonAttribute.length;u++){var c=e.dungeonAttribute[u],h=Wuxingyinmanager.getDungeonAttributeName(c.dungeonId,c.attribute),r=c.Param[t],o=c.Param[n],s=null!=o;null==o&&(o=0),i.push({attribute:h,curParam:r,nextParam:o,hasNext:s})}this.attributeListData.replaceAll(i)},n.prototype.updateMaterialNum=function(){var e=Wuxingyinmanager.jingzhiwuxingjinghuaGD[0],t=Wuxingyinmanager.jingzhiwuxingjinghuaGD[1];this.materialCell.data={type:"item",content:{genre:e,detailType:t}},this.materialNum.text=PlayerAttribute.GetItemCount(e,t).toString()},n.prototype.onLevelUp=function(t,n){var i=this;if(t){if(this.stopAutoLevelup(),!Wuxingyinmanager.wuxingshiLevelup(this.selectWuxingshiId))return;var a=function(){Wuxingyinmanager.wuxingshiLevelup(i.selectWuxingshiId)&&(i.timerLevelUp=egret.setTimeout(a,i,300))};this.timerLevelUp=egret.setTimeout(a,this,700),this.stage.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onLevelUpEnd,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onLevelUpEnd,this),this.stage.addEventListener(egret.TouchEvent.DEACTIVATE,this.onLevelUpEnd,this)}else{var r=lang.String("prompt title"),o=lang.String("jingzhiwuxingshilevelup"),s=this;e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],r,o,function(){return s.onLevelUp(!0,n),!0},null,null)}},n.prototype.onLevelUpBegin=function(e){this.onLevelUp(!1,e)},n.prototype.onLevelUpEnd=function(e){var t=e.$currentTarget;t.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onLevelUpEnd,this),t.removeEventListener(egret.TouchEvent.TOUCH_END,this.onLevelUpEnd,this),t.removeEventListener(egret.TouchEvent.DEACTIVATE,this.onLevelUpEnd,this),null!=this.timerLevelUp&&(egret.clearTimeout(this.timerLevelUp),this.timerLevelUp=null)},n.prototype.onTouchTap=function(t){switch(t.target){case this.cell0:this.onSelectCell(0);break;case this.cell1:this.onSelectCell(1);break;case this.cell2:this.onSelectCell(2);break;case this.cell3:this.onSelectCell(3);break;case this.cell4:this.onSelectCell(4);break;case this.btnEnchase:this.stopAutoLevelup(),Wuxingyinmanager.wuxingshiEnchase(this.selectWuxingshiId);break;case this.btnEnchaseSuit:this.stopAutoLevelup(),Wuxingyinmanager.wuxingshiEnchaseSuit(this.selectSuitId);break;case this.btnRestore:this.onRestore(!1);break;case this.btnSplitUI:this.stopAutoLevelup(),UIManager.push(new e.WuxingshiSplitUI(2));break;case this.enchasedCell0:this.onClickEnchasedWuxingshi(0);break;case this.enchasedCell1:this.onClickEnchasedWuxingshi(1);break;case this.enchasedCell2:this.onClickEnchasedWuxingshi(2);break;case this.enchasedCell3:this.onClickEnchasedWuxingshi(3);break;case this.enchasedCell4:this.onClickEnchasedWuxingshi(4)}},n.prototype.onRestore=function(t){if(t)this.stopAutoLevelup(),Wuxingyinmanager.wuxingshiRestore(this.selectWuxingshiId);else{var n=lang.String("prompt title"),i=lang.String("jingzhiwuxingshirestore"),a=this;e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],n,i,function(){return a.onRestore(!0),!0},null,null)}},n.prototype.onClickEnchasedWuxingshi=function(t){var i=1,a=Wuxingyinmanager.jingzhiwuxingyinData.getSlots()[t];a>0?(i=Wuxingyinmanager.GetSuitIdByWuxingshiId(a),n.instance.setSelectSuitId(i),n.instance.setSelectWuxingshiId(a)):(a=Wuxingyinmanager.findBestWuxingshi(t,2),a>0?(i=Wuxingyinmanager.GetSuitIdByWuxingshiId(a),n.instance.setSelectSuitId(i),n.instance.setSelectWuxingshiId(a)):(n.instance.setSelectSuitId(i),n.instance.setSelectWuxingshiId(0))),e.JingZhiWuxingyinPanel.change(i)},n.prototype.autoLevelup=function(){this.timer=null,this.autoSelectLevelup(),this.updateSuit(),this.updateWuxingshi(),this.updateMaterialNum(),Wuxingyinmanager.wuxingshiLevelup(this.selectWuxingshiId)||this.stopAutoLevelup()},n.prototype.stopAutoLevelup=function(){this.runing=!1,null!=this.timer&&(egret.clearTimeout(this.timer),this.timer=null)},n.prototype.onLevelupSuccess=function(){this.runing?null==this.timer&&(this.timer=egret.setTimeout(this.autoLevelup,this,300)):this.updateData()},n.prototype.onSelectCell=function(e){this.stopAutoLevelup();for(var t=0,n=Wuxingyinmanager.GetWuxingshiSuitConfig(this.selectSuitId),i=0;i!=n.stones.length;i++){var a=n.stones[i],r=Wuxingyinmanager.GetWuxingshiAttributeConfig(a);if(r.slotIndex==e){t=a;break}}t!=this.selectWuxingshiId&&(this.selectWuxingshiId=t,this.levelUpBadge(),this.updateSuit(),this.updateWuxingshi())},n}(eui.Component);e.JingZhiWuxingshiDetail=t,__reflect(t.prototype,"UI.JingZhiWuxingshiDetail",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="WuxingyinPanelSkin",n.dataList=new eui.ArrayCollection,n.list.itemRenderer=e.WuxingyinButtonItem,n.list.dataProvider=n.dataList,n.onChange=MakeDelayExecute(n.scrollToButton,n,10*Game.MSPF),n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.list.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onSelectList,n),n}return __extends(n,t),n.open=function(e){return PlayerAttribute.Level<Wuxingyinmanager.openLevel?void PopUpMessage.push(lang.StringWithFormat("open on level {1}",Wuxingyinmanager.openLevel),color.RED):(null==e&&(e=0),this.instance.selectSuitId=e,void UIManager.pushPage(n.instance))},n.change=function(e){var t=e-1;this.instance.selectSuitId=e;for(var n=0;n!=Wuxingyinmanager.jingzhiwuxingshiSuitNun;n++){var i=this.instance.list.getChildAt(n);i.onSelect(t==n)}this.instance.btnWuxingyin.onSelect(!1),this.instance.updateDetail(),this.instance.updateSuitButtons(),this.instance.onChange()},Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.Close=function(){null!=this._instance&&UIManager.pop(this._instance)},n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.onTouchTap=function(t){switch(t.target){case this.imgClose:this.close();break;case this.btnWuxingyin:this.onSelectWuxingyin();break;case this.btnRule:var n=new e.Rule;n.skinName="WuxingyinRuleSkin",UIManager.pushPage(n)}},n.prototype.close=function(){UIManager.pop(this)},n.prototype.onAddToStage=function(){this.updateSuitButtons(),this.updateDetail(),this.onChange(),Game.dispatcher.addEventListener(Game.EVENT.WuxingshiEnchase,this.updateSuitButtons,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingshiEnchaseSuit,this.updateSuitButtons,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingshiActive,this.updateSuitButtons,this)},n.prototype.onRemoveFromStage=function(){this.onChange.stop(),Game.dispatcher.removeEventListener(Game.EVENT.WuxingshiEnchase,this.updateSuitButtons,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingshiEnchaseSuit,this.updateSuitButtons,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingshiActive,this.updateSuitButtons,this)},n.prototype.updateSuitButtons=function(){var e=[];if(0==this.selectSuitId){this.btnWuxingyin.data={id:0,select:!0};for(var t=Wuxingyinmanager.wuxingshiSuitNun;t!=Wuxingyinmanager.wuxingshiSuitNun+Wuxingyinmanager.jingzhiwuxingshiSuitNun;t++)e.push({id:t+1,select:!1})}else{this.btnWuxingyin.data={id:0,select:!1};for(var t=Wuxingyinmanager.wuxingshiSuitNun;t!=Wuxingyinmanager.wuxingshiSuitNun+Wuxingyinmanager.jingzhiwuxingshiSuitNun;t++)e.push({id:t+1,select:t+1==this.selectSuitId})}this.dataList.replaceAll(e)},n.prototype.updateDetail=function(){this.leftGroup.removeChildren(),0==this.selectSuitId?this.leftGroup.addChild(e.WuxingyinDetail.instance):(e.JingZhiWuxingshiDetail.instance.setSelectSuitId(this.selectSuitId),this.leftGroup.addChild(e.JingZhiWuxingshiDetail.instance))},n.prototype.onSelectList=function(){var e=this.list.selectedIndex;this.selectSuitId=Wuxingyinmanager.wuxingshiSuitNun+e+1;for(var t=0;t!=Wuxingyinmanager.jingzhiwuxingshiSuitNun;t++){var n=this.list.getChildAt(t);n.onSelect(e==t)}this.btnWuxingyin.onSelect(!1),this.updateDetail()},n.prototype.onSelectWuxingyin=function(){this.selectSuitId=0;for(var e=0;e!=Wuxingyinmanager.jingzhiwuxingshiSuitNun;e++){var t=this.list.getChildAt(e);t.onSelect(!1)}this.btnWuxingyin.onSelect(!0),this.updateDetail()},n.prototype.scrollToButton=function(){if(!(this.selectSuitId<=0)){var e=this.sc.height,t=this.sc.viewport.contentHeight-this.sc.height,n=(this.selectSuitId-1)/Wuxingyinmanager.jingzhiwuxingshiSuitNun*this.sc.viewport.contentHeight;e>n&&(n=0),n>t&&(n=t),this.sc.viewport.scrollV=n
}},n}(e.FitComponent);e.JingZhiWuxingyinPanel=t,__reflect(t.prototype,"UI.JingZhiWuxingyinPanel",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="WuxingshiDetailSkin",e.attributeListData=new eui.ArrayCollection,e.attributeList.dataProvider=e.attributeListData,e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.btnLevelup.addEventListener(egret.TouchEvent.TOUCH_BEGIN,e.onLevelUpBegin,e),e}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},n.prototype.setSelectSuitId=function(e){this.selectSuitId=e},n.prototype.setSelectWuxingshiId=function(e){this.selectWuxingshiId=e},n.prototype.onAddToStage=function(){this.updateData(),Game.dispatcher.addEventListener(Game.EVENT.WuxingshiActive,this.updateData,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingshiLevelup,this.onLevelupSuccess,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingshiRestore,this.updateData,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingshiEnchase,this.updateData,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingshiEnchaseSuit,this.updateData,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingshiSplit,this.updateMaterialNum,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingyinBadge,this.updateBadge,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.WuxingshiActive,this.updateData,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingshiLevelup,this.onLevelupSuccess,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingshiRestore,this.updateData,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingshiEnchase,this.updateData,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingshiEnchaseSuit,this.updateData,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingshiSplit,this.updateMaterialNum,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingyinBadge,this.updateBadge,this),this.stopAutoLevelup()},n.prototype.getActivedWuxingshiNum=function(){for(var e=0,t=Wuxingyinmanager.GetWuxingshiSuitConfig(this.selectSuitId),n=Wuxingyinmanager.wuxingyinData.getStones(),i=0;i!=n.length;i++){var a=n[i];if(a.actived)for(var r=0;r!=t.stones.length;r++)t.stones[r]==a.id&&(e+=1)}return e},n.prototype.updateBadge=function(){this.levelUpBadge();for(var e=Wuxingyinmanager.GetWuxingshiSuitConfig(this.selectSuitId),t=0;t!=e.stones.length;t++){var n=e.stones[t],i=this.activeBadgeGroup.getChildAt(t);i.visible=Wuxingyinmanager.badgeWuxingshiActive[n]}},n.prototype.levelUpBadge=function(){this.selectWuxingshiId<=0?this.badgeLevelup.visible=!1:this.badgeLevelup.visible=Wuxingyinmanager.badgeWuxingshiLevelup[this.selectWuxingshiId]},n.prototype.updateData=function(){this.autoSelectDisplay(),this.updateBadge(),this.updateSuit(),this.updateWuxingshi(),this.updateMaterialNum(),this.updateEnchasedWuxingshi()},n.prototype.updateEnchasedWuxingshi=function(){for(var e=0;e!=Wuxingyinmanager.wuxingyinSlotNum;e++){var t=Wuxingyinmanager.wuxingyinData.getSlots()[e],n=this.groupEnchased.getChildAt(e);n.data={id:t,select:!1,mode:Wuxingyinmanager.WuxingyinUI_DisplayMode_Self}}},n.prototype.autoSelectDisplay=function(){var e=!0,t=Wuxingyinmanager.GetWuxingshiSuitConfig(this.selectSuitId);if(this.selectWuxingshiId>0)for(var n=0;n!=t.stones.length;n++)if(t.stones[n]==this.selectWuxingshiId){e=!1;break}if(e){this.selectWuxingshiId=0;for(var i=Wuxingyinmanager.wuxingyinData.getStones(),n=0;n!=t.stones.length;n++)for(var a=t.stones[n],r=0;r!=i.length;r++){var o=i[r];if(o.actived&&o.id==a)return void(this.selectWuxingshiId=a)}}},n.prototype.autoSelectLevelup=function(){for(var e=0,t=9999,n=Wuxingyinmanager.GetWuxingshiSuitConfig(this.selectSuitId),i=0;i!=Wuxingyinmanager.wuxingyinSlotNum;i++){var a=n.stones[i];if(Wuxingyinmanager.IsActived(a)){var r=Wuxingyinmanager.GetWuxingshiLevel(a);t>r&&(t=r,e=a)}}this.selectWuxingshiId=e},n.prototype.updateSuit=function(){var e=Wuxingyinmanager.GetWuxingshiSuitConfig(this.selectSuitId);this.suitName.text=e.name,this.suitName.textColor=Item.QualityColor[e.quality];for(var t=0;t!=e.stones.length;t++){var n=e.stones[t],i=Wuxingyinmanager.GetWuxingshiAttributeConfig(n),a=i.slotIndex,r=Wuxingyinmanager.IsUsing(n),o=(Wuxingyinmanager.IsActived(n),this.selectWuxingshiId==n),s=this.cellGroup.getChildAt(a);s.data={id:n,select:o,mode:Wuxingyinmanager.WuxingyinUI_DisplayMode_Self};var l=this.usedFlagGroup.getChildAt(a);l.visible=r,0==t&&(this.suitIcon=i.source)}var u=this.getActivedWuxingshiNum();this.btnEnchaseSuit.enabled=u>0;var c=Wuxingyinmanager.activedSuit[this.selectSuitId];this.suitAttribute0.text="",this.suitAttribute1.text="",this.suitAttribute2.text="",this.suitAttribute3.text="";for(var t=0;t!=e.attributes.length;t++){var h=e.attributes[t],d=Buff.GetDesc(h.buff[0],h.buff.slice(1));switch(d="["+h.needNum+"] "+d,t){case 0:this.suitAttribute0.text=d,this.suitAttribute0.textColor=c>t?color.WHITE:color.GRAY;break;case 1:this.suitAttribute1.text=d,this.suitAttribute1.textColor=c>t?color.WHITE:color.GRAY;break;case 2:this.suitAttribute2.text=d,this.suitAttribute2.textColor=c>t?color.WHITE:color.GRAY;break;case 3:this.suitAttribute3.text=d,this.suitAttribute3.textColor=c>t?color.WHITE:color.GRAY}}},n.prototype.updateWuxingshi=function(){if(this.selectWuxingshiId<=0||!Wuxingyinmanager.IsActived(this.selectWuxingshiId))return void(this.groupDetail.visible=!1);this.groupDetail.visible=!0;var e=Wuxingyinmanager.GetWuxingshiAttributeConfig(this.selectWuxingshiId),t=Wuxingyinmanager.GetWuxingshiSuitConfig(this.selectSuitId);this.wuxingshiName.text=e.name,this.wuxingshiName.textColor=Item.QualityColor[t.quality],this.udpateWuxingshiAttributes(e);var n=Wuxingyinmanager.GetWuxingshiLevel(this.selectWuxingshiId),i=n+1,a=Wuxingyinmanager.GetWuxingshiAttributeConfig(this.selectWuxingshiId);if(0>=n)this.groupRestoreGetInfo.visible=!1,this.btnRestore.enabled=!1;else{this.groupRestoreGetInfo.visible=!0,this.btnRestore.enabled=!0,this.restoreGetMaterialCell.data={type:"item",content:{genre:a.split.genre,detailType:a.split.detail}};var r=a.split.count[n];this.restoreGetNum.text="+"+r}if(n>=Wuxingyinmanager.wuxingshiMaxLevel)this.groupLevelupCostInfo.visible=!1,this.btnLevelup.enabled=!1;else{this.groupLevelupCostInfo.visible=!0,this.btnLevelup.enabled=!0,this.levelupCostMaterialCell.data={type:"item",content:{genre:a.cost.genre,detailType:a.cost.detail}};var o=a.cost.count[i];this.levelupCostNum.text="-"+o}this.btnEnchase.enabled=Wuxingyinmanager.IsActived(this.selectWuxingshiId)&&!Wuxingyinmanager.IsUsing(this.selectWuxingshiId)},n.prototype.udpateWuxingshiAttributes=function(e){var t=Wuxingyinmanager.GetWuxingshiLevel(this.selectWuxingshiId),n=t+1,i=[],a=e.normalAttribute.buffId,r=e.normalAttribute.params[t],o=e.normalAttribute.params[n],s=null!=o;null==o&&(o=0);var l=Buff.GetName(a);i.push({attribute:l,curParam:r,nextParam:o,hasNext:s});for(var u=0;u!=e.dungeonAttribute.length;u++){var c=e.dungeonAttribute[u],h=Wuxingyinmanager.getDungeonAttributeName(c.dungeonId,c.attribute),r=c.Param[t],o=c.Param[n],s=null!=o;null==o&&(o=0),i.push({attribute:h,curParam:r,nextParam:o,hasNext:s})}this.attributeListData.replaceAll(i)},n.prototype.updateMaterialNum=function(){var e=Wuxingyinmanager.wuxingjinghuaGD[0],t=Wuxingyinmanager.wuxingjinghuaGD[1];this.materialCell.data={type:"item",content:{genre:e,detailType:t}},this.materialNum.text=PlayerAttribute.GetItemCount(e,t).toString()},n.prototype.onLevelUpBegin=function(e){var t=this;if(this.stopAutoLevelup(),Wuxingyinmanager.wuxingshiLevelup(this.selectWuxingshiId)){var n=function(){Wuxingyinmanager.wuxingshiLevelup(t.selectWuxingshiId)&&(t.timerLevelUp=egret.setTimeout(n,t,300))};this.timerLevelUp=egret.setTimeout(n,this,700),this.stage.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onLevelUpEnd,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onLevelUpEnd,this),this.stage.addEventListener(egret.TouchEvent.DEACTIVATE,this.onLevelUpEnd,this)}},n.prototype.onLevelUpEnd=function(e){var t=e.$currentTarget;t.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onLevelUpEnd,this),t.removeEventListener(egret.TouchEvent.TOUCH_END,this.onLevelUpEnd,this),t.removeEventListener(egret.TouchEvent.DEACTIVATE,this.onLevelUpEnd,this),null!=this.timerLevelUp&&(egret.clearTimeout(this.timerLevelUp),this.timerLevelUp=null)},n.prototype.onTouchTap=function(t){switch(t.target){case this.cell0:this.onSelectCell(0);break;case this.cell1:this.onSelectCell(1);break;case this.cell2:this.onSelectCell(2);break;case this.cell3:this.onSelectCell(3);break;case this.cell4:this.onSelectCell(4);break;case this.btnEnchase:this.stopAutoLevelup(),Wuxingyinmanager.wuxingshiEnchase(this.selectWuxingshiId);break;case this.btnEnchaseSuit:this.stopAutoLevelup(),Wuxingyinmanager.wuxingshiEnchaseSuit(this.selectSuitId);break;case this.btnRestore:this.stopAutoLevelup(),Wuxingyinmanager.wuxingshiRestore(this.selectWuxingshiId);break;case this.btnSplitUI:this.stopAutoLevelup(),UIManager.push(new e.WuxingshiSplitUI(1));break;case this.enchasedCell0:this.onClickEnchasedWuxingshi(0);break;case this.enchasedCell1:this.onClickEnchasedWuxingshi(1);break;case this.enchasedCell2:this.onClickEnchasedWuxingshi(2);break;case this.enchasedCell3:this.onClickEnchasedWuxingshi(3);break;case this.enchasedCell4:this.onClickEnchasedWuxingshi(4)}},n.prototype.onClickEnchasedWuxingshi=function(t){var i=1,a=Wuxingyinmanager.wuxingyinData.getSlots()[t];a>0?(i=Wuxingyinmanager.GetSuitIdByWuxingshiId(a),n.instance.setSelectSuitId(i),n.instance.setSelectWuxingshiId(a)):(a=Wuxingyinmanager.findBestWuxingshi(t,1),a>0?(i=Wuxingyinmanager.GetSuitIdByWuxingshiId(a),n.instance.setSelectSuitId(i),n.instance.setSelectWuxingshiId(a)):(n.instance.setSelectSuitId(i),n.instance.setSelectWuxingshiId(0))),e.WuxingyinPanel.change(i)},n.prototype.autoLevelup=function(){this.timer=null,this.autoSelectLevelup(),this.updateSuit(),this.updateWuxingshi(),this.updateMaterialNum(),Wuxingyinmanager.wuxingshiLevelup(this.selectWuxingshiId)||this.stopAutoLevelup()},n.prototype.stopAutoLevelup=function(){this.runing=!1,null!=this.timer&&(egret.clearTimeout(this.timer),this.timer=null)},n.prototype.onLevelupSuccess=function(){this.runing?null==this.timer&&(this.timer=egret.setTimeout(this.autoLevelup,this,300)):this.updateData()},n.prototype.onSelectCell=function(e){this.stopAutoLevelup();for(var t=0,n=Wuxingyinmanager.GetWuxingshiSuitConfig(this.selectSuitId),i=0;i!=n.stones.length;i++){var a=n.stones[i],r=Wuxingyinmanager.GetWuxingshiAttributeConfig(a);if(r.slotIndex==e){t=a;break}}t!=this.selectWuxingshiId&&(this.selectWuxingshiId=t,this.levelUpBadge(),this.updateSuit(),this.updateWuxingshi())},n}(eui.Component);e.WuxingshiDetail=t,__reflect(t.prototype,"UI.WuxingshiDetail",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(e){var n=t.call(this)||this;return n.skinName="WuxingshiSplitUISkin",n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.type=e,n}return __extends(n,t),n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.onAddToStage=function(){this.panel.btnBack.visible=!1,1==this.type?this.cell.data={type:"item",content:{genre:Wuxingyinmanager.wuxingjinghuaGD[0],detailType:Wuxingyinmanager.wuxingjinghuaGD[1]}}:this.cell.data={type:"item",content:{genre:Wuxingyinmanager.jingzhiwuxingjinghuaGD[0],detailType:Wuxingyinmanager.jingzhiwuxingjinghuaGD[1]}},this.canGet=Wuxingyinmanager.getSplitMaterialNum(),this.getNum.text=this.canGet.toString()},n.prototype.onTouchTap=function(t){switch(t.target){case this.imgClose:this.close();break;case this.btnGetWuxingshi:1==this.type?(e.ResourceObtain.Open([e.ObtResId.wuxingshi]),UIManager.pop(this)):(e.ResourceObtain.Open([e.ObtResId.jingzhiwuxingshi]),UIManager.pop(this));break;case this.btnSplit:this.canGet>0?(Wuxingyinmanager.wuxingshiSplit(this.type),UIManager.pop(this)):(e.ResourceObtain.Open([e.ObtResId.wuxingshi]),UIManager.pop(this),PopUpMessage.push(lang.String("wuxingshi no wuxingshi to split"),color.RED))}},n}(e.FitComponent);e.WuxingshiSplitUI=t,__reflect(t.prototype,"UI.WuxingshiSplitUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="WuxingyinAttributeItemSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.WuxingyinAttributeLevelup,this.dataChanged,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingyinGradeLevelup,this.dataChanged,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingyinBadge,this.updateBadge,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.WuxingyinAttributeLevelup,this.dataChanged,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingyinGradeLevelup,this.dataChanged,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingyinBadge,this.updateBadge,this)},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnLevelup:Wuxingyinmanager.wuxingyinAttributeLevelup(this.data.index);break;case this.imgMaterial:e.ItemTips.instance.data={type:"item",content:{genre:this.costItem.Type,detailType:this.costItem.DetailType}},UIManager.push(e.ItemTips.instance)}},n.prototype.updateBadge=function(){this.badge.visible=Wuxingyinmanager.badgeWuxingyinAttribute[this.data.index]},n.prototype.dataChanged=function(){this.updateBadge();var e=Wuxingyinmanager.GetWuxingyinAttributeLevel(this.data.index),t=e+1,n=Wuxingyinmanager.GetWuxingyinAttributeLevelConfig(this.data.index,e),i=Wuxingyinmanager.GetWuxingyinAttributeLevelConfig(this.data.index,t);if(null!=n||null!=i){var a=Wuxingyinmanager.GetWuxingyinAttributeConfig(this.data.index);if(null!=a){var r=Wuxingyinmanager.getWuxingyinAttributeCurMaxLevel();if(this.btnLevelup.enabled=r>e&&e<Wuxingyinmanager.wuxingyinAttributeMaxLevel,this.attributeIcon.source=a.source,this.attributeName.text=a.name,this.attributeLevel.text="Lv."+e,null!=n?(this.attributeDesc.text=Buff.GetName(n.buff[0]),this.curParam.text=n.buff[1].toString()):(this.attributeDesc.text=Buff.GetName(i.buff[0]),this.curParam.text="0"),null==i)this.arrow.visible=!1,this.nextParam.visible=!1,this.imgMaterial.visible=!1,this.materialNum.visible=!1;else{this.arrow.visible=!0,this.nextParam.visible=!0,this.imgMaterial.visible=!0,this.materialNum.visible=!0,this.nextParam.text=i.buff[1].toString();var o=i.cost[0],s=i.cost[1],l=i.cost[2],u=PlayerAttribute.GetItemCount(o,s);null==this.costItem&&(this.costItem=Item.makeProp2(o,s,null)),this.imgMaterial.source=this.costItem.Icon,this.materialNum.text=u+"/"+l,this.materialNum.textColor=u>=l?color.GREEN:color.RED}}}},n}(eui.ItemRenderer);e.WuxingyinAttributeItem=t,__reflect(t.prototype,"UI.WuxingyinAttributeItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.defaultKeyColor=7248228,t.defaultValueColor=16119285,t}return __extends(t,e),t.prototype.dataChanged=function(){var e;e=this.data.enable?StringWithFormat("{1}:<font color="+color.Title1_Value+">{2}</font>",this.data.key,this.data.value):StringWithFormat("<font color="+color.GRAY+">{1}:{2}</font>",this.data.key,this.data.value),this.label0.textFlow=Game.HtmlTextParser.parse(e)},t}(eui.ItemRenderer);e.WuxingyinAttributeLableItem=t,__reflect(t.prototype,"UI.WuxingyinAttributeLableItem");var n=function(e){function t(){var t=e.call(this)||this;return t.skinName="WuxingyinAttributePanelSkin",t.dataListWuxingyinAttribute=new eui.ArrayCollection,t.listAttributeWuxingyin.dataProvider=t.dataListWuxingyinAttribute,t.dataListWuxingshiAttribute=new eui.ArrayCollection,t.listAttributeWuxingshi.dataProvider=t.dataListWuxingshiAttribute,t.dataListSuit0=new eui.ArrayCollection,t.listSuit0.dataProvider=t.dataListSuit0,t.dataListSuit1=new eui.ArrayCollection,t.listSuit1.dataProvider=t.dataListSuit1,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.onAddToStage=function(){this.dataListWuxingyinAttribute.replaceAll(Wuxingyinmanager.GetAllWuxingyinAttributesDesc()),this.dataListWuxingshiAttribute.replaceAll(Wuxingyinmanager.GetAllWuxingshiAttributesDesc()),this.suitGroup0.visible=!1,this.suitGroup1.visible=!1;var e=0;for(var t in Wuxingyinmanager.activedSuit){var n=Number(t),i=Wuxingyinmanager.activedSuit[n];0>=i||(this.showSuitAttribute(e,n,i),e+=1)}},t.prototype.showSuitAttribute=function(e,t,n){for(var i=Wuxingyinmanager.GetWuxingshiSuitConfig(t),a=[],r=0;r!=i.attributes.length;r++){var o=i.attributes[r].buff,s=o[0],l=o[1];a.push({key:"["+i.attributes[r].needNum+"] "+Buff.GetName(s),value:l.toString(),enable:n>r})}0==e&&(this.suitGroup0.visible=!0,this.suitName0.text=i.name,this.dataListSuit0.replaceAll(a)),1==e&&(this.suitGroup1.visible=!0,this.suitName1.text=i.name,this.dataListSuit1.replaceAll(a))},t.prototype.onTouchTap=function(e){switch(e.target){case this.imgClose:this.close()}},t}(e.FitComponent);e.WuxingyinAttributePanel=n,__reflect(n.prototype,"UI.WuxingyinAttributePanel",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.imgNoActived="ui/Wuxingyin/jiHuo_1.png",t.imgActivedAll="ui/Wuxingyin/jiHuo_2.png",t.imgActived="ui/Wuxingyin/jiHuo_3.png",t.skinName="WuxingyinButtonItemSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.onAddToStage=function(){Game.dispatcher.addEventListener(Game.EVENT.WuxingyinBadge,this.updateBadge,this)},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.WuxingyinBadge,this.updateBadge,this)},t.prototype.updateBadge=function(){var e=this.data.id;if(0==e)this.badge.visible=Wuxingyinmanager.badgeWuxingyinPage;else{var t=Wuxingyinmanager.wuxingshiSuitConfig[e];1==t.type?this.badge.visible=Wuxingyinmanager.badgeWuxingshiSuitPage[e]:this.badge.visible=Wuxingyinmanager.badgeJingZhiWuxingshiSuitPage[e]}},t.prototype.dataChanged=function(){var e=this.data.id;0==e?this.displayWuxingyin():this.displaySuit(e),this.btn.currentState=this.data.select?"upAndSelected":"up",this.updateBadge()},t.prototype.displayWuxingyin=function(){this.btn.label=lang.String("wuxingyin wuxingyin"),this.imgUsing.visible=!1,this.imgJihuo.source=this.imgActivedAll},t.prototype.displaySuit=function(e){var t=Wuxingyinmanager.GetWuxingshiSuitConfig(e);this.btn.label=t.name;for(var n=!1,i=0;i!=t.stones.length;i++)if(Wuxingyinmanager.IsUsing(t.stones[i])){n=!0;break}this.imgUsing.visible=n;for(var a=0,i=0;i!=t.stones.length;i++)Wuxingyinmanager.IsActived(t.stones[i])&&(a+=1);0>=a?this.imgJihuo.source=this.imgNoActived:a==Wuxingyinmanager.wuxingyinSlotNum?this.imgJihuo.source=this.imgActivedAll:this.imgJihuo.source=this.imgActived},t.prototype.onSelect=function(e){e?this.btn.currentState="upAndSelected":this.btn.currentState="up"},t}(eui.ItemRenderer);e.WuxingyinButtonItem=t,__reflect(t.prototype,"UI.WuxingyinButtonItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.imgAdd="ui/forge/add_bg1.png",t.imgLock="ui/common/lock1.png",t.skinName="WuxingyinCellSkin",t.touchChildren=!1,t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.dataChanged=function(){if(this.cell.clearcell(),this.imgSelect.visible=!1,this.imgState.source="",0==this.data.id)return this.txtLv.text="",void(this.cell.qualityImg=this.imgAdd);var e=Wuxingyinmanager.GetWuxingshiDetailById(this.data.id);this.cell.data={type:"item",content:{genre:20,detailType:e}};var t=this.data.mode==Wuxingyinmanager.WuxingyinUI_DisplayMode_Self?Wuxingyinmanager.getWuxingshiInfo(this.data.id):Wuxingyinmanager.getWuxingshiInfoPlayerView(this.data.id);null==t?(this.txtLv.text="",this.cell.alpha=.3,this.imgState.source=this.imgLock):(this.txtLv.text=t.getLevel()>0?lang.StringWithFormat("{1}level",t.getLevel()):"",this.imgSelect.visible=this.data.select,this.cell.alpha=1)},t.prototype.onTouchTap=function(e){if(0!=this.data.id){var t=Wuxingyinmanager.getWuxingshiInfo(this.data.id);return null==t?void this.onClickActiveWuxingshi():void 0}},t.prototype.onClickActiveWuxingshi=function(){Wuxingyinmanager.wuxingshiActive(this.data.id)},t}(eui.ItemRenderer);e.WuxingyinCell=t,__reflect(t.prototype,"UI.WuxingyinCell",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="WuxingyinDetailSkin",n.listData=new eui.ArrayCollection,n.list.itemRenderer=e.WuxingyinAttributeItem,n.list.dataProvider=n.listData,n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.onAddToStage=function(){this.updateBadge(),this.updateWuxingyin(),this.updateAttribute(),Game.dispatcher.addEventListener(Game.EVENT.WuxingyinGradeLevelup,this.updateData,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingyinBadge,this.updateData,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.WuxingyinGradeLevelup,this.updateData,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingyinBadge,this.updateData,this)},n.prototype.updateBadge=function(){this.badgeGrade.visible=Wuxingyinmanager.badgeWuxingyinGrade},n.prototype.updateData=function(){this.updateBadge(),this.updateWuxingyin()},n.prototype.updateWuxingyin=function(){var e=Wuxingyinmanager.wuxingyinData.grade,t=Wuxingyinmanager.GetWuxingyinGradeConfig(e);if(null!=t){var n=e+1,i=Wuxingyinmanager.GetWuxingyinGradeConfig(n);if(this.gradeSource.source=t.source,this.gradeName.text=t.name,this.curMaxLevel.text=t.maxLevel.toString(),null==i)this.arrow.visible=!1,this.newMaxLevel.visible=!1,this.imgMaterial.visible=!1,this.gradeLevelUpMaterialCost.visible=!1,this.btnUpgrade.enabled=!1;else{this.arrow.visible=!0,this.newMaxLevel.visible=!0,this.imgMaterial.visible=!0,this.gradeLevelUpMaterialCost.visible=!0,this.btnUpgrade.enabled=!0,this.newMaxLevel.text=i.maxLevel.toString();var a=i.cost[0],r=i.cost[1],o=i.cost[2],s=PlayerAttribute.GetItemCount(a,r);null==this.costItem&&(this.costItem=Item.makeProp2(a,r,null)),this.imgMaterial.source=this.costItem.Icon,this.gradeLevelUpMaterialCost.text=s+"/"+o,this.gradeLevelUpMaterialCost.textColor=s>=o?color.GREEN:color.RED}}},n.prototype.updateAttribute=function(){for(var e=[],t=0;t!=Wuxingyinmanager.wuxingyinAttributeNum;t++)e.push({index:t});this.listData.replaceAll(e)},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnUpgrade:Wuxingyinmanager.wuxingyinGradeLevelup();break;case this.imgMaterial:e.ItemTips.instance.data={type:"item",content:{genre:this.costItem.Type,detailType:this.costItem.DetailType}},UIManager.push(e.ItemTips.instance)}},n}(e.FitComponent);e.WuxingyinDetail=t,__reflect(t.prototype,"UI.WuxingyinDetail",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="WuxingyinPage1Skin",e.dataDungeonAttribute=new eui.ArrayCollection,e.list.dataProvider=e.dataDungeonAttribute,e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),n.prototype.onAddToStage=function(){this.updateData(),this.displayMode==Wuxingyinmanager.WuxingyinUI_DisplayMode_Self&&(Game.dispatcher.addEventListener(Game.EVENT.WuxingyinGradeLevelup,this.updateData,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingshiEnchase,this.updateData,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingshiEnchaseSuit,this.updateData,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingshiLevelup,this.updateData,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingshiRestore,this.updateData,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingyinAttributeLevelup,this.updateData,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingyinBadge,this.updateBadge,this))},n.prototype.onRemoveFromStage=function(){this.displayMode==Wuxingyinmanager.WuxingyinUI_DisplayMode_Self&&(Game.dispatcher.removeEventListener(Game.EVENT.WuxingyinGradeLevelup,this.updateData,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingshiEnchase,this.updateData,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingshiEnchaseSuit,this.updateData,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingshiLevelup,this.updateData,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingshiRestore,this.updateData,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingyinAttributeLevelup,this.updateData,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingyinBadge,this.updateBadge,this))},n.prototype.onTouchTap=function(t){switch(t.target){case this.imgBagua:this.displayMode==Wuxingyinmanager.WuxingyinUI_DisplayMode_Self&&e.WuxingyinPanel.open(0);break;case this.cell0:this.onClickWuxingshi(0);break;case this.cell1:this.onClickWuxingshi(1);break;case this.cell2:this.onClickWuxingshi(2);break;case this.cell3:this.onClickWuxingshi(3);break;case this.cell4:this.onClickWuxingshi(4);break;case this.btnTujian:this.displayMode==Wuxingyinmanager.WuxingyinUI_DisplayMode_Self&&e.WuxingyinPanel.open(0);break;case this.btnWuxingdesc:this.displayMode==Wuxingyinmanager.WuxingyinUI_DisplayMode_Self&&UIManager.pushPage(new e.WuxingyinAttributePanel)}},n.prototype.updateData=function(){var e=this.displayMode==Wuxingyinmanager.WuxingyinUI_DisplayMode_Self?Wuxingyinmanager.wuxingyinData:Wuxingyinmanager.wuxingyinDataPlayerView;this.fpItem.FightingPower=this.displayMode==Wuxingyinmanager.WuxingyinUI_DisplayMode_Self?Wuxingyinmanager.fightingPower.toString():Wuxingyinmanager.fightingPowerPlayerView.toString();for(var t=0;t!=Wuxingyinmanager.wuxingyinSlotNum;t++){var n=e.getSlots()[t],i=this.groupWuxingshi.getChildAt(t);i.data={id:n,select:!1,mode:this.displayMode}}for(var t=0;t!=Wuxingyinmanager.wuxingyinAttributeNum;t++){var a=e.getAttributeLevels()[t],r=this.groupAttributeLevel.getChildAt(t);r.text=a.toString()}this.displayMode==Wuxingyinmanager.WuxingyinUI_DisplayMode_Self?this.dataDungeonAttribute.replaceAll(Wuxingyinmanager.GetAllDungeonAttributsDesc()):this.dataDungeonAttribute.replaceAll(Wuxingyinmanager.GetAllDungeonAttributsDescPlayerView());var o=e.getGrade(),s=Wuxingyinmanager.GetWuxingyinGradeConfig(o);this.gradeSource.source=s.source,this.updateBadge(),this.btnTujian.visible=this.displayMode==Wuxingyinmanager.WuxingyinUI_DisplayMode_Self?!0:!1,this.btnWuxingdesc.visible=this.displayMode==Wuxingyinmanager.WuxingyinUI_DisplayMode_Self?!0:!1},n.prototype.updateBadge=function(){if(this.displayMode==Wuxingyinmanager.WuxingyinUI_DisplayMode_Self){for(var e=0;e!=Wuxingyinmanager.wuxingyinSlotNum;e++){var t=this.groupSlotBadge.getChildAt(e);t.visible=Wuxingyinmanager.badgeWuxingyinSlot[e]}this.badgeWuxingyin.visible=Wuxingyinmanager.badgeWuxingyinPage,this.badgeTujian.visible=Wuxingyinmanager.badgeWuxingyinTujian}else{for(var e=0;e!=Wuxingyinmanager.wuxingyinSlotNum;e++){var n=this.groupSlotBadge.getChildAt(e);n.visible=!1}this.badgeWuxingyin.visible=!1,this.badgeTujian.visible=!1}},n.prototype.onClickWuxingshi=function(t){if(this.displayMode==Wuxingyinmanager.WuxingyinUI_DisplayMode_Self){var n=1,i=Wuxingyinmanager.wuxingyinData.getSlots()[t];i>0?(n=Wuxingyinmanager.GetSuitIdByWuxingshiId(i),e.WuxingshiDetail.instance.setSelectSuitId(n),e.WuxingshiDetail.instance.setSelectWuxingshiId(i)):(i=Wuxingyinmanager.findBestWuxingshi(t,1),i>0?(n=Wuxingyinmanager.GetSuitIdByWuxingshiId(i),e.WuxingshiDetail.instance.setSelectSuitId(n),e.WuxingshiDetail.instance.setSelectWuxingshiId(i)):(e.WuxingshiDetail.instance.setSelectSuitId(n),e.WuxingshiDetail.instance.setSelectWuxingshiId(0))),e.WuxingyinPanel.open(n)}},n}(eui.Component);e.WuxingyinPage1=t,__reflect(t.prototype,"UI.WuxingyinPage1",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="WuxingyinPage2Skin",e.dataDungeonAttribute=new eui.ArrayCollection,e.list.dataProvider=e.dataDungeonAttribute,e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),n.prototype.onAddToStage=function(){this.updateData(),this.displayMode==Wuxingyinmanager.WuxingyinUI_DisplayMode_Self&&(Game.dispatcher.addEventListener(Game.EVENT.WuxingyinGradeLevelup,this.updateData,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingshiEnchase,this.updateData,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingshiEnchaseSuit,this.updateData,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingshiLevelup,this.updateData,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingshiRestore,this.updateData,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingyinAttributeLevelup,this.updateData,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingyinBadge,this.updateBadge,this))},n.prototype.onRemoveFromStage=function(){this.displayMode==Wuxingyinmanager.WuxingyinUI_DisplayMode_Self&&(Game.dispatcher.removeEventListener(Game.EVENT.WuxingyinGradeLevelup,this.updateData,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingshiEnchase,this.updateData,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingshiEnchaseSuit,this.updateData,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingshiLevelup,this.updateData,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingshiRestore,this.updateData,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingyinAttributeLevelup,this.updateData,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingyinBadge,this.updateBadge,this))},n.prototype.onTouchTap=function(t){switch(t.target){case this.imgBagua:this.displayMode==Wuxingyinmanager.WuxingyinUI_DisplayMode_Self&&e.JingZhiWuxingyinPanel.open(0);break;case this.cell0:this.onClickWuxingshi(0);break;case this.cell1:this.onClickWuxingshi(1);break;case this.cell2:this.onClickWuxingshi(2);break;case this.cell3:this.onClickWuxingshi(3);break;case this.cell4:this.onClickWuxingshi(4);
break;case this.btnTujian:this.displayMode==Wuxingyinmanager.WuxingyinUI_DisplayMode_Self&&e.JingZhiWuxingyinPanel.open(0);break;case this.btnWuxingdesc:this.displayMode==Wuxingyinmanager.WuxingyinUI_DisplayMode_Self&&UIManager.pushPage(new e.WuxingyinAttributePanel)}},n.prototype.onClickWuxingshi=function(t){if(this.displayMode==Wuxingyinmanager.WuxingyinUI_DisplayMode_Self){var n=1,i=Wuxingyinmanager.jingzhiwuxingyinData.getSlots()[t];i>0?(n=Wuxingyinmanager.GetSuitIdByWuxingshiId(i),e.JingZhiWuxingshiDetail.instance.setSelectSuitId(n),e.JingZhiWuxingshiDetail.instance.setSelectWuxingshiId(i)):(i=Wuxingyinmanager.findBestWuxingshi(t,2),i>0?(n=Wuxingyinmanager.GetSuitIdByWuxingshiId(i),e.JingZhiWuxingshiDetail.instance.setSelectSuitId(n),e.JingZhiWuxingshiDetail.instance.setSelectWuxingshiId(i)):(e.JingZhiWuxingshiDetail.instance.setSelectSuitId(n),e.JingZhiWuxingshiDetail.instance.setSelectWuxingshiId(0))),e.JingZhiWuxingyinPanel.open(n)}},n.prototype.updateData=function(){var e=Wuxingyinmanager.jingzhiwuxingyinData;this.fpItem.FightingPower=this.displayMode==Wuxingyinmanager.WuxingyinUI_DisplayMode_Self?Wuxingyinmanager.fightingPower.toString():Wuxingyinmanager.fightingPowerPlayerView.toString();for(var t=0;t!=Wuxingyinmanager.wuxingyinSlotNum;t++){var n=e.getSlots()[t],i=this.groupWuxingshi.getChildAt(t);i.data={id:n,select:!1,mode:this.displayMode}}for(var t=0;t!=Wuxingyinmanager.wuxingyinAttributeNum;t++){var a=Wuxingyinmanager.wuxingyinData.getAttributeLevels()[t],r=this.groupAttributeLevel.getChildAt(t);r.text=a.toString()}this.displayMode==Wuxingyinmanager.WuxingyinUI_DisplayMode_Self?this.dataDungeonAttribute.replaceAll(Wuxingyinmanager.GetAllJingZhiDungeonAttributsDesc()):this.dataDungeonAttribute.replaceAll(Wuxingyinmanager.GetAllDungeonAttributsDescPlayerView());var o=Wuxingyinmanager.wuxingyinData.getGrade(),s=Wuxingyinmanager.GetWuxingyinGradeConfig(o);this.gradeSource.source=s.source,this.updateBadge(),this.btnTujian.visible=this.displayMode==Wuxingyinmanager.WuxingyinUI_DisplayMode_Self?!0:!1,this.btnWuxingdesc.visible=this.displayMode==Wuxingyinmanager.WuxingyinUI_DisplayMode_Self?!0:!1},n.prototype.updateBadge=function(){if(this.displayMode==Wuxingyinmanager.WuxingyinUI_DisplayMode_Self){for(var e=0;e!=Wuxingyinmanager.wuxingyinSlotNum;e++){var t=this.groupSlotBadge.getChildAt(e);t.visible=Wuxingyinmanager.badgeJingZhiWuxingyinSlot[e]}this.badgeWuxingyin.visible=Wuxingyinmanager.badgeWuxingyinPage,this.badgeTujian.visible=Wuxingyinmanager.badgeJingZhiWuxingyinTujian}else{for(var e=0;e!=Wuxingyinmanager.wuxingyinSlotNum;e++){var n=this.groupSlotBadge.getChildAt(e);n.visible=!1}this.badgeWuxingyin.visible=!1,this.badgeTujian.visible=!1}},n}(eui.Component);e.WuxingyinPage2=t,__reflect(t.prototype,"UI.WuxingyinPage2",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var n=t.call(this)||this;return n.skinName="WuxingyinPanelSkin",n.dataList=new eui.ArrayCollection,n.list.itemRenderer=e.WuxingyinButtonItem,n.list.dataProvider=n.dataList,n.onChange=MakeDelayExecute(n.scrollToButton,n,10*Game.MSPF),n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.list.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onSelectList,n),n}return __extends(n,t),n.open=function(e){return PlayerAttribute.Level<Wuxingyinmanager.openLevel?void PopUpMessage.push(lang.StringWithFormat("open on level {1}",Wuxingyinmanager.openLevel),color.RED):(null==e&&(e=0),this.instance.selectSuitId=e,void UIManager.pushPage(n.instance))},n.change=function(e){var t=e-1;this.instance.selectSuitId=e;for(var n=0;n!=Wuxingyinmanager.wuxingshiSuitNun;n++){var i=this.instance.list.getChildAt(n);i.onSelect(t==n)}this.instance.btnWuxingyin.onSelect(!1),this.instance.updateDetail(),this.instance.updateSuitButtons(),this.instance.onChange()},Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.Close=function(){null!=this._instance&&UIManager.pop(this._instance)},n.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},n.prototype.onTouchTap=function(t){switch(t.target){case this.imgClose:this.close();break;case this.btnWuxingyin:this.onSelectWuxingyin();break;case this.btnRule:var n=new e.Rule;n.skinName="WuxingyinRuleSkin",UIManager.pushPage(n)}},n.prototype.close=function(){UIManager.pop(this)},n.prototype.onAddToStage=function(){this.updateSuitButtons(),this.updateDetail(),this.onChange(),Game.dispatcher.addEventListener(Game.EVENT.WuxingshiEnchase,this.updateSuitButtons,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingshiEnchaseSuit,this.updateSuitButtons,this),Game.dispatcher.addEventListener(Game.EVENT.WuxingshiActive,this.updateSuitButtons,this)},n.prototype.onRemoveFromStage=function(){this.onChange.stop(),Game.dispatcher.removeEventListener(Game.EVENT.WuxingshiEnchase,this.updateSuitButtons,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingshiEnchaseSuit,this.updateSuitButtons,this),Game.dispatcher.removeEventListener(Game.EVENT.WuxingshiActive,this.updateSuitButtons,this)},n.prototype.updateSuitButtons=function(){var e=[];if(0==this.selectSuitId){this.btnWuxingyin.data={id:0,select:!0};for(var t=0;t!=Wuxingyinmanager.wuxingshiSuitNun;t++)e.push({id:t+1,select:!1})}else{this.btnWuxingyin.data={id:0,select:!1};for(var t=0;t!=Wuxingyinmanager.wuxingshiSuitNun;t++)e.push({id:t+1,select:t+1==this.selectSuitId})}this.dataList.replaceAll(e)},n.prototype.updateDetail=function(){this.leftGroup.removeChildren(),0==this.selectSuitId?this.leftGroup.addChild(e.WuxingyinDetail.instance):(e.WuxingshiDetail.instance.setSelectSuitId(this.selectSuitId),this.leftGroup.addChild(e.WuxingshiDetail.instance))},n.prototype.onSelectList=function(){var e=this.list.selectedIndex;this.selectSuitId=e+1;for(var t=0;t!=Wuxingyinmanager.wuxingshiSuitNun;t++){var n=this.list.getChildAt(t);n.onSelect(e==t)}this.btnWuxingyin.onSelect(!1),this.updateDetail()},n.prototype.onSelectWuxingyin=function(){this.selectSuitId=0;for(var e=0;e!=Wuxingyinmanager.wuxingshiSuitNun;e++){var t=this.list.getChildAt(e);t.onSelect(!1)}this.btnWuxingyin.onSelect(!0),this.updateDetail()},n.prototype.scrollToButton=function(){if(!(this.selectSuitId<=0)){var e=this.sc.height,t=this.sc.viewport.contentHeight-this.sc.height,n=(this.selectSuitId-1)/Wuxingyinmanager.wuxingshiSuitNun*this.sc.viewport.contentHeight;e>n&&(n=0),n>t&&(n=t),this.sc.viewport.scrollV=n}},n}(e.FitComponent);e.WuxingyinPanel=t,__reflect(t.prototype,"UI.WuxingyinPanel",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="WuxingyinUISkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e}return __extends(n,t),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.tab.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this)},n.prototype.onItemTap=function(){var e=this.tab.selectedIndex;this.page!=e&&this.setPage(e)},n.prototype.setPage=function(e){switch(this.page=e,e){case 0:this.viewPage=0;break;case 1:this.viewPage=1}},n.open=function(e){return PlayerAttribute.Level<Wuxingyinmanager.openLevel?void PopUpMessage.push(lang.StringWithFormat("open on level {1}",Wuxingyinmanager.openLevel),color.RED):(null==this.instance&&(this.instance=new n),null==e?this.instance.displayMode=Wuxingyinmanager.WuxingyinUI_DisplayMode_Self:this.instance.displayMode=e,void(this.instance.displayMode==Wuxingyinmanager.WuxingyinUI_DisplayMode_Self?UIManager.pushPage(this.instance):UIManager.push(this.instance)))},n.prototype.close=function(){UIManager.pop(this)},n.prototype.onTouchTap=function(t){switch(t.target){case this.imgClose:this.close();break;case this.btnRule:if(this.displayMode==Wuxingyinmanager.WuxingyinUI_DisplayMode_Self){var n=new e.Rule;n.skinName="WuxingyinRuleSkin",UIManager.pushPage(n)}}},n.prototype.onAddToStage=function(){this.Page1UI.displayMode=this.displayMode,this.Page2UI.displayMode=this.displayMode,this.btnRule.visible=this.displayMode==Wuxingyinmanager.WuxingyinUI_DisplayMode_Self?!0:!1,this.updateBadge(),Game.dispatcher.addEventListener(Game.EVENT.WuxingyinBadge,this.updateBadge,this)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.WuxingyinBadge,this.updateBadge,this)},n.prototype.updateBadge=function(){var e=this.activeBadgeGroup.getChildAt(0);e.visible=Wuxingyinmanager.badgeWuxingyinUiPageBtn[1],e=this.activeBadgeGroup.getChildAt(1),e.visible=Wuxingyinmanager.badgeWuxingyinUiPageBtn[2]},n}(e.FitComponent);e.WuxingyinUI=t,__reflect(t.prototype,"UI.WuxingyinUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="YanEmperorApplicantItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){var e=Game.getServerDate();e>=this.data.date?(this.statusTip="Quá hạn",this.status=!1):(this.statusTip="Hiệu lực",this.status=!0)},t}(eui.ItemRenderer);e.YanEmperorApplicantItem=t,__reflect(t.prototype,"UI.YanEmperorApplicantItem")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="YanEmperorApplicantUISkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchTap,t),t.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,t.onClickItem,t),t}return __extends(t,e),t.prototype.close=function(){UIManager.pop(this)},t.prototype.onAddToStage=function(){this.updateList(),Game.dispatcher.addEventListener(Game.EVENT.YanEmperorApplication,this.updateList,this)},t.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.YanEmperorApplication,this.updateList,this),YanEmperor.updateApplicant()},t.prototype.updateList=function(){this.list.dataProvider=new eui.ArrayCollection(YanEmperor.applicantMembers),this.list.selectedIndex=-1,this.btnAgree.enabled=!1,this.btnRefuse.enabled=!1},t.prototype.onTouchTap=function(e){switch(e.target){case this.btnAgree:if(YanEmperor.myTeamInfo.members.length>=4)return void PopUpMessage.push(lang.String("team full"),color.Warning);YanEmperor.c2s_approve(this.list.selectedItem.player.name,this.list.selectedIndex);break;case this.btnRefuse:YanEmperor.delApplication(this.list.selectedIndex);break;case this.imgClose:this.close()}},t.prototype.onClickItem=function(){return this.list.selectedIndex<0?(this.btnAgree.enabled=!1,void(this.btnRefuse.enabled=!1)):(this.btnRefuse.enabled=!0,void(this.btnAgree.enabled=!0))},t}(e.FitComponent);e.YanEmperorApplicantUI=t,__reflect(t.prototype,"UI.YanEmperorApplicantUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(t){var n=e.call(this)||this;return n.skinName="YanEmperorCreateTeamSkin",null!=t?n.currentState=t:n.currentState="create",n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onTouchTap,n),"create"==n.currentState?n.textInput.text=lang.StringWithFormat("yanemperor {1}teamname",Player.instance.Name):"rename"==n.currentState&&(n.textInput.text=YanEmperor.myTeamInfo.name),n}return __extends(t,e),t.prototype.onTouchTap=function(e){switch(e.target){case this.btnSure:if(""==this.textInput.text)return;if("create"==this.currentState)YanEmperor.c2s_creatteam(this.textInput.text);else if("rename"==this.currentState){if(this.textInput.text==YanEmperor.myTeamInfo.name)return void PopUpMessage.push(lang.String("yanemperor the same name"),color.RED);YanEmperor.c2s_rename(this.textInput.text)}this.close();break;case this.btnCancel:this.close()}},t.prototype.close=function(){UIManager.pop(this)},t}(e.FitComponent);e.YanEmperorCreateTeam=t,__reflect(t.prototype,"UI.YanEmperorCreateTeam",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="YanEmperorHUDSkin",e.remainingTime=new RemainingTime,e.eventTime=new RemainingTime,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.btnApply.freeMovie(),Game.removeFromParent.apply(e.btnApply),e}return __extends(n,t),n.prototype.onTimer=function(){"adytum"==this.currentState&&(this.rest=this.remainingTime.getMinuteSecond(),this.eventRest=this.eventTime.getMinuteSecond()),null!=this.teamList&&null!=this.teamList.parent&&this.teamList.updateRestTime()},n.prototype.onAddToStage=function(){this.onRefreshMyTeam(),this.onRefreshAwardCount(),Game.dispatcher.addEventListener(Game.EVENT.YanEmperorMyTeam,this.onRefreshMyTeam,this),Game.dispatcher.addEventListener(Game.EVENT.YanEmperorApplication,this.onRefreshApplicant,this),Game.dispatcher.addEventListener(Game.EVENT.YanEmperorAwardCount,this.onPushAdytumMessage,this),SecondTicker.addEventListener(this.onTimer,this)},n.prototype.onRemoveFromStage=function(){SecondTicker.removeEventListener(this.onTimer,this),Game.dispatcher.removeEventListener(Game.EVENT.YanEmperorMyTeam,this.onRefreshMyTeam,this),Game.dispatcher.removeEventListener(Game.EVENT.YanEmperorApplication,this.onRefreshApplicant,this),Game.dispatcher.removeEventListener(Game.EVENT.YanEmperorAwardCount,this.onPushAdytumMessage,this)},Object.defineProperty(n.prototype,"second",{set:function(e){this.remainingTime.delta=e,this.onTimer()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"eventSecond",{set:function(e){this.eventTime.delta=e,this.onTimer()},enumerable:!0,configurable:!0}),n.prototype.onTouchTap=function(t){switch(t.target){case this.btnQuit:e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],lang.String("operation confirm"),lang.String("yanemperor leave,sure?"),function(){return YanEmperor.c2s_leave(),!0},null,null);break;case this.btnTeam:UIManager.push(new e.YanEmperorManagerUI);break;case this.btnTransfer:-1==YanEmperor.myAspect.floor?YanEmperor.c2s_shift(null,null):e.YanEmperorTransfer.open(YanEmperor.myAspect.floor);break;case this.imgClose:this.close();break;case this.btnApply:UIManager.push(new e.YanEmperorApplicantUI)}},n.prototype.onRefreshMyTeam=function(){YanEmperor.myTeamId?(this.teamList.updateMyTeam(YanEmperor.myTeamInfo.members),null==this.teamList.parent&&this.mainGroup.addChild(this.teamList),this.teamList.setRestTime(YanEmperor.myTeamInfo.wineTime,YanEmperor.myTeamInfo.addition)):(this.teamList.updateMyTeam([]),this.teamList.setRestTime(0,0),Game.removeFromParent.apply(this.teamList))},n.prototype.addApplicant=function(e){e?null==this.btnApply.parent&&(this.mainGroup.addChild(this.btnApply),this.btnApply.playMovie(-1)):(this.btnApply.freeMovie(),Game.removeFromParent.apply(this.btnApply))},n.prototype.onRefreshApplicant=function(){0==YanEmperor.applicantMembers.length&&this.addApplicant(!1)},n.prototype.onRefreshAwardCount=function(){this.curAward=YanEmperor.curAwarded+"/"+YanEmperor.maxAwarded},n.prototype.onPushAdytumMessage=function(){ChatSys.pushSys(lang.StringWithFormat("yanemperor adytum award count:{1}",YanEmperor.maxAwarded-YanEmperor.curAwarded)),this.onRefreshAwardCount()},n}(e.FitComponent);e.YanEmperorHUD=t,__reflect(t.prototype,"UI.YanEmperorHUD",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.teams=[],e.skinName="YanEmperorManagerUISkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.teamList.addEventListener(eui.ItemTapEvent.ITEM_TAP,e.onTouchList,e),e}return __extends(n,t),n.prototype.close=function(){UIManager.pop(this)},n.prototype.onTouchTap=function(t){switch(t.target){case this.imgClose:this.close();break;case this.btnCreateTeam:UIManager.push(new e.YanEmperorCreateTeam);break;case this.checkBox:if(this.teamList.selectedIndex<0)return;var n=this.teamList.selectedItem;YanEmperor.myTeamId==n.id&&1==YanEmperor.myCaptain&&YanEmperor.c2s_setapproval(this.checkBox.selected);break;case this.btnQuitTeam:e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],lang.String("operation confirm"),lang.String("yanemperor quit team, sure?"),function(){return YanEmperor.c2s_quitteam(),!0},null,null);break;case this.btnRename:1==YanEmperor.myCaptain&&UIManager.push(new e.YanEmperorCreateTeam("rename"));break;case this.btnJoinTeam:if(null==YanEmperor.myTeamId||0==YanEmperor.myTeamId){if(this.teamList.selectedIndex<0)return;var i=this.teamList.selectedItem;YanEmperor.c2s_jointeam(i.id)}}},n.prototype.onAddToStage=function(){this.onRefreshMyTeam(),Game.dispatcher.addEventListener(Game.EVENT.YanEmperorSyncTeams,this.onRefreshTeamList,this),Game.dispatcher.addEventListener(Game.EVENT.YanEmperorMyTeam,this.onRefreshMyTeam,this),YanEmperor.c2s_getteamlist()},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.YanEmperorSyncTeams,this.onRefreshTeamList,this),Game.dispatcher.removeEventListener(Game.EVENT.YanEmperorMyTeam,this.onRefreshMyTeam,this)},n.prototype.onRefreshTeamList=function(){var e=this.teamList.dataProvider;if(this.teams=[],this.btnRename.visible=!1,this.btnJoinTeam.visible=!1,null!=YanEmperor.myTeamId&&0!=YanEmperor.myTeamId?(this.teams.push(YanEmperor.myTeamInfo),this.btnCreateTeam.visible=!1,this.btnQuitTeam.visible=!0,1==YanEmperor.myCaptain&&(this.btnRename.visible=!0)):(this.btnCreateTeam.visible=!0,this.btnQuitTeam.visible=!1,this.btnJoinTeam.visible=!0),YanEmperor.otherTeams)for(var t=0;t<YanEmperor.otherTeams.length;t++)if(YanEmperor.myTeamId!=YanEmperor.otherTeams[t].id){var n=YanEmperor.otherTeams[t];this.teams.push(n)}else this.teams[0].approval=YanEmperor.otherTeams[t].approval;null==e?this.teamList.dataProvider=new eui.ArrayCollection(this.teams):e.replaceAll(this.teams),this.onTouchList()},n.prototype.onRefreshMyTeam=function(){this.scroller.viewport.scrollV=0,this.onRefreshTeamList()},n.prototype.onTouchList=function(){var e=this.memList.dataProvider;if(this.teamList.selectedIndex<0)return this.teamName=null,this.teamCount=null,this.checkBox.enabled=!1,this.memList.dataProvider=new eui.ArrayCollection([]),void(this.btnJoinTeam.enabled=!1);var t=this.teamList.selectedItem;this.teamName=t.name,this.teamCount=t.members.length+"/4",this.checkBox.selected=t.approval,this.checkBox.enabled=!0,YanEmperor.myTeamId==t.id&&1==YanEmperor.myCaptain?this.checkBox.touchEnabled=!0:this.checkBox.touchEnabled=!1;for(var n=[],i=0;i<t.members.length;i++)n.push(t.members[i]);null==e?this.memList.dataProvider=new eui.ArrayCollection(n):e.replaceAll(n),n.length>=4?this.btnJoinTeam.enabled=!1:this.btnJoinTeam.enabled=!0},n}(e.FitComponent);e.YanEmperorManagerUI=t,__reflect(t.prototype,"UI.YanEmperorManagerUI",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="YanEmperorMemItemSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.dataChanged=function(){this.captainflag.visible=this.data.bCaptain,this.data.online?this.iconUI.imgHead=table.faction[this.data.faction].portrait:this.iconUI.imgHead=table.faction[this.data.faction].offlinePortrait,this.lblPos.text=YanEmperor.getSceneName({floor:this.data.floor,room:this.data.room})},n.prototype.onTouchTap=function(e){switch(e.target){case this.iconUI:this.showMemberMenu()}},n.prototype.showMemberMenu=function(){if(null==YanEmperor.teamMenu){YanEmperor.teamMenu=new e.YanEmperorTeamMenu;var t=this.data.name,n=this.iconUI.localToGlobal(0,0);YanEmperor.teamMenu.x=n.x+this.iconUI.width/2,YanEmperor.teamMenu.y=n.y+this.iconUI.height/2,YanEmperor.teamMenu.playerName=t,YanEmperor.teamMenu.playerFaction=this.data.faction;var i=[];Player.instance.Name==t?i.push({label:"Rời đội",action:"quitTeam"}):(i.push({label:"Mật",action:"chat"}),friend.checkByName(t)||i.push({label:"Thêm Hảo Hữu",action:"addFriend"}),YanEmperor.myCaptain&&i.push({label:"Trục xuất",action:"kick"})),YanEmperor.teamMenu.buttons=i,YanEmperor.noteHUD.addChild(YanEmperor.teamMenu)}},n}(eui.ItemRenderer);e.YanEmperorMemItem=t,__reflect(t.prototype,"UI.YanEmperorMemItem")}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="YanEmperorMyTeamHUDSkin",e.remainingTime=new RemainingTime,e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.updateRestTime=function(){this.remainingTime.delta>=0?this.lefttime=this.remainingTime.getHourMinuteSecond():(this.lefttime="00:00:00",this.addition=lang.String("None"),YanEmperor.myTeamInfo&&(YanEmperor.myTeamInfo.addition=0))},n.prototype.updateMyTeam=function(e){var t=this.list.dataProvider;null==t?this.list.dataProvider=new eui.ArrayCollection(e):t.replaceAll(e)},n.prototype.setRestTime=function(e,t){this.remainingTime.delta=e,t?this.addition=t+"%":this.addition=lang.String("None")},n.prototype.onTouchTap=function(e){switch(e.target){case this.imgJiu:this.onToast()}},n.prototype.onToast=function(){if(0==YanEmperor.myTeamId)return void PopUpMessage.push(lang.String("need team when toast"),color.Warning);if(YanEmperor.myTeamInfo.addition==YanEmperor.maxToast)return void PopUpMessage.push(lang.String("cannot use of max addition"),color.Warning);var t=PlayerAttribute.bag.CalcCount(YanEmperor.toastItem.genre,YanEmperor.toastItem.detailType),n=table.props[YanEmperor.toastItem.genre][YanEmperor.toastItem.detailType];if(0==t){PopUpMessage.push(lang.StringWithFormat("need {1}{2}",1,n.name),color.Warning);var i=GoldCoinShop.mapGoods[YanEmperor.toastItem.genre][YanEmperor.toastItem.detailType];return void(null!=i?GoldCoinShop.buy(i.pos,i.id):UIManager.openGoldCoinShop())}e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],lang.String("operation confirm"),lang.StringWithFormat("jiu additon {1}%,sure?",YanEmperor.radioToast),function(){return YanEmperor.c2s_toast(),!0},null,null)},n}(eui.Component);e.YanEmperorMyTeamHUD=t,__reflect(t.prototype,"UI.YanEmperorMyTeamHUD",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="YanEmperorTeamItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){this.data.id==YanEmperor.myTeamId?this.lblTeamName.textColor=16748174:this.lblTeamName.textColor=7911830,this.lblCaptainName.text=this.data.members[0].name+"  "+lang.StringWithFormat("{1}level",this.data.members[0].level),this.lblCount.text=this.data.members.length+"/4",this.checkBox.selected=this.data.approval},t}(eui.ItemRenderer);e.YanEmperorTeamItem=t,__reflect(t.prototype,"UI.YanEmperorTeamItem")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="YanEmperorTeamMemItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){this.captainflag.visible=this.data.bCaptain,this.data.online?this.iconUI.imgHead=table.faction[this.data.faction].portrait:this.iconUI.imgHead=table.faction[this.data.faction].offlinePortrait,this.lblLevel.text=lang.StringWithFormat("{1}level",this.data.level),this.lblFP.text=lang.StringWithFormat("fp:{1}",this.data.fp),this.lblPos.text=YanEmperor.getSceneName({floor:this.data.floor,room:this.data.room})},t}(eui.ItemRenderer);e.YanEmperorTeamMemItem=t,__reflect(t.prototype,"UI.YanEmperorTeamMemItem")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.menuButton||(t.menuButton=new eui.Button,t.menuButton.skinName="ButtonTemp4Skin",t.menuButton.horizontalCenter=0,t.menuButton.verticalCenter=0),t.addChild(t.menuButton),t}return __extends(t,e),t.prototype.dataChanged=function(){this.menuButton.label=this.data.label},t}(eui.ItemRenderer);e.YanEmperorMenuButton=t,__reflect(t.prototype,"UI.YanEmperorMenuButton");var n=function(t){function n(){var n=t.call(this)||this;return n.list||(n.list=new eui.List,n.list.left=0,n.list.top=0),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n.buttons=[],n.list.itemRenderer=e.YanEmperorMenuButton,n.addChild(n.list),n.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,n.onItemTap,n),n}return __extends(n,t),n.prototype.onAddToStage=function(){this.list.dataProvider=new eui.ArrayCollection(this.buttons),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onFocusOut,this)},n.prototype.onRemoveFromStage=function(){this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onFocusOut,this),this.buttons=[]},n.prototype.onFocusOut=function(e){(null==e.target.parent||e.target.parent.parent!=this.list)&&(UIManager.pop(this),YanEmperor.teamMenu=null,e.stopImmediatePropagation())},n.prototype.onItemTap=function(){var t=this;switch(this.list.selectedItem.action){case"chat":Player.instance.Name!=this.playerName&&ChatSys.createNewPrivateChannel(this.playerName,this.playerFaction);break;case"addFriend":Player.instance.Name!=this.playerName&&friend.sendRequest(this.playerName);break;case"quitTeam":e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],lang.String("operation confirm"),lang.String("yanemperor quit team, sure?"),function(){return YanEmperor.c2s_quitteam(),!0},null,null);break;case"kick":e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],lang.String("operation confirm"),lang.StringWithFormat("yanemperor kick{1},sure?",this.playerName),function(){return YanEmperor.c2s_kick(t.playerName),!0},null,null)}UIManager.pop(this),YanEmperor.teamMenu=null},n}(eui.Component);e.YanEmperorTeamMenu=n,__reflect(n.prototype,"UI.YanEmperorTeamMenu",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="YanEmperorTransferSkin",e.tabItem=[],e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoveFromStage,e),e.tab.addEventListener(eui.ItemTapEvent.ITEM_TAP,e.onTouchTabBar,e),e}return __extends(n,t),n.open=function(t){if(PlayerAttribute.Level<YanEmperor.openLevel)return void PopUpMessage.push(lang.StringWithFormat("open on level {1}",YanEmperor.openLevel),color.RED);if(null==this._instance&&(this._instance=new n),badge.onLight(badge.action.YanemperorLogin,!1),-1==t||null==YanEmperor.myAspect)this._instance.page=0,this._instance.tabItem=[{name:lang.StringWithFormat("{1}floor",1),idx:0}];else{null==t&&(t=YanEmperor.myAspect.floor);var i=void 0,a=void 0;switch(t){case 0:case 1:case 2:i=0,a=2;break;case-1:return void e.ConfirmBox.Show(e.ConfirmBoxStyle["default"],lang.String("operation confirm"),lang.String("yanemperor leave adytum,sure?"),function(){return YanEmperor.c2s_shift(null,null),!0},null,null);default:return}this._instance.page=t,this._instance.tabItem=[];for(var r=i;a>=r;r++)this._instance.tabItem.push({name:lang.StringWithFormat("{1}floor",r+1),idx:r})}return UIManager.push(this._instance),this._instance},n.close=function(){null!=this._instance&&UIManager.pop(this._instance)},n.prototype.onAddToStage=function(){this.tab.dataProvider=new eui.ArrayCollection(this.tabItem),this.tab.selectedIndex=this.page,Game.dispatcher.addEventListener(Game.EVENT.YanEmperorFloorInfo,this.onRefesh,this),YanEmperor.c2s_floorinfo(this.page)},n.prototype.onRemoveFromStage=function(){Game.dispatcher.removeEventListener(Game.EVENT.YanEmperorFloorInfo,this.onRefesh,this);for(var e=0;4>e;e++){var t=this.roomGroup.getChildAt(e);t.floor=0,t.pos=0,t.teamCnt=0,t.memberCnt=0}},n.prototype.onRefesh=function(e){if(null!=e&&null!=e.data){var t=[];if(YanEmperor.myAspect&&(null==t[YanEmperor.myAspect.floor]&&(t[YanEmperor.myAspect.floor]=[]),t[YanEmperor.myAspect.floor][YanEmperor.myAspect.room]=["ui/common1/my_1.png"]),YanEmperor.myTeamId)for(var n=YanEmperor.myTeamInfo.members,i=0;i<n.length;i++)null==t[n[i].floor]&&(t[n[i].floor]=[]),null==t[n[i].floor][n[i].room]&&(t[n[i].floor][n[i].room]=[]),n[i].name!=Player.instance.Name&&t[n[i].floor][n[i].room].push("ui/common1/my_0.png");for(var a=e.data,i=0;4>i;i++){var r=this.roomGroup.getChildAt(i);r.floor=this.page,r.pos=i,t[r.floor]&&t[r.floor][r.pos]?r.imgDatas=t[r.floor][r.pos]:r.imgDatas=[],r.teamCnt=a[i].teamCount,r.memberCnt=a[i].playerCount,r.onRefresh()}}},n.prototype.onTouchTabBar=function(){var e=this.tab.selectedIndex,t=YanEmperor.myAspect.floor,n=Math.abs(t-e);return n>=2?(PopUpMessage.push(lang.StringWithFormat("yanemperor cannot transfer {1}",e+1),color.RED),void(this.tab.selectedIndex=this.page)):(this.page=e,this.floorName=this.tab.selectedItem.name,void YanEmperor.c2s_floorinfo(this.page))},n.prototype.onTouchTap=function(t){switch(t.target){case this.btnRules:var n=new e.Rule;n.skinName="YanEmperoInfoSkin",UIManager.pushNoTween(n)}},n}(e.FitComponent);e.YanEmperorTransfer=t,__reflect(t.prototype,"UI.YanEmperorTransfer",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));var UI;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.skinName="YanEmperorTransferItemSkin",e.title=null,e.level=null,e.memberCnt=null,e.teamCnt=null,e.pos=null,e.floor=null,e.imgDatas=[],e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(n,t),n.prototype.onTouchTap=function(t){switch(t.target){case this.btnJoin:YanEmperor.myAspect?YanEmperor.c2s_shift(this.floor,this.pos):YanEmperor.c2s_join(0,this.pos),e.YanEmperorTransfer.close()}},n.prototype.onRefresh=function(){this.level=YanEmperor.floor_npcLevel[this.floor],null!=YanEmperor.Aspect[this.pos]?this.title=YanEmperor.getSceneName({floor:this.floor,room:this.pos}):this.title="";var e=this.imgList.dataProvider;null==e?this.imgList.dataProvider=new eui.ArrayCollection(this.imgDatas):e.replaceAll(this.imgDatas)},n}(eui.Component);e.YanEmperorTransferItem=t,__reflect(t.prototype,"UI.YanEmperorTransferItem",["eui.UIComponent","egret.DisplayObject"])}(UI||(UI={}));